---
title: Kubespray 2.18 ç‰ˆæœ¬ç‰¹æ€§é¢„è§ˆ
date: 2022-01-05
updated:
slug:
categories:
tag:
copyright: true
comment: true
---

æœ€è¿‘ kubernetes-sig ç¤¾åŒºçš„ [kubespray](https://github.com/kubernetes-sigs/kubespray) é¡¹ç›®æ­£å¼ release äº† [v2.18.0](https://github.com/kubernetes-sigs/kubespray/releases/tag/v2.18.0) ç‰ˆæœ¬ï¼ŒåŒæ—¶å¯¹åº” [k8s-conformance](https://github.com/cncf/k8s-conformance) çš„ [v1.21](https://github.com/cncf/k8s-conformance/pull/1748) å’Œ [v1.22](https://github.com/cncf/k8s-conformance/pull/1760) ç‰ˆæœ¬ kubespray ä¹Ÿéƒ½å·²ç»å¾—åˆ° CNCF çš„ä¸€è‡´æ€§è®¤è¯ã€‚äºæ˜¯ä»Šå¤©å°±å€Ÿè¿™ä¸ªæ–°ç‰ˆæœ¬ release çš„æœºä¼šæ•´ç†ä¸€ä¸‹ 2.18 ç‰ˆæœ¬çš„ kubespray æœ‰å“ªäº›æœ‰è¶£çš„å˜åŒ–ã€‚

## ç»„ä»¶ç‰ˆæœ¬

ä»¥ä¸‹æ˜¯ v2.18.0 ç‰ˆæœ¬ä¸­ kubespray éƒ¨ç½²ç»„ä»¶çš„ä¸€äº›ç‰ˆæœ¬ä¿¡æ¯ï¼š

### K8s æ ¸å¿ƒç»„ä»¶

- kubespray æ”¯æŒçš„ Kubernetes æ”¯æŒä» v1.22.0 åˆ° v1.23.1 ä¹‹é—´çš„æ‰€æœ‰æ­£å¼ç‰ˆæœ¬ï¼Œé»˜è®¤éƒ¨ç½²çš„ç‰ˆæœ¬ä¸º v1.22.5ï¼Œå¹¶ä¸” [v1.22](https://github.com/cncf/k8s-conformance/pull/1760) ç‰ˆæœ¬å¾—åˆ°äº† CNCF å®˜æ–¹çš„ä¸€è‡´æ€§è®¤è¯ï¼›
- etcd ä»åŸæ¥çš„ v3.4.13 å‡çº§åˆ°äº† v3.5.0ï¼›
- coredns ç‰ˆæœ¬å‡çº§åˆ°äº† v1.8.0ï¼Œå®ƒçš„æ­æ¡£ dnsautoscaler åˆ™ä¸º 1.8.5ï¼›
- pod_infra å³ pause é•œåƒçš„ç‰ˆæœ¬æ²¡æœ‰å˜åŒ–ä¾æ—§ä¸º 3.3ï¼›

| Addon     | Version |
| --------- | :------ |
| kube      | v1.22.5 |
| pod_infra | 3.3     |
| etcd      | v3.5.0  |
| coredns   | v1.8.0  |

### å®¹å™¨è¿è¡Œæ—¶

ç›®å‰å¸‚é¢ä¸Šæ‰€æœ‰çš„ Kubernetes é›†ç¾¤éƒ¨ç½²å·¥å…·ä¸­ï¼Œå¯¹å®¹å™¨è¿è¡Œæ—¶çš„æ”¯æŒ kubespray æ— ç–‘æ˜¯æœ€ä¸°å¯Œçš„ã€‚éƒ¨ç½²èƒ½æ”¯æŒ dockerã€containerdã€crunã€kataã€cri-oã€‚é»˜è®¤çš„å®¹å™¨è¿è¡Œæ—¶å·²ç»ä»ä¹‹å‰çš„ docker åˆ‡æ¢åˆ°äº† containerdï¼Œcontainerd çš„ç‰ˆæœ¬æ˜¯ v1.5.8ã€‚

| Addon             | Version  |
| ----------------- | -------- |
| containerd        | 1.5.8    |
| docker            | 20.10    |
| docker_containerd | 1.4.12   |
| crun              | 1.3      |
| runc              | v1.0.3   |
| crio              | 1.22     |
| kata_containers   | 2.2.3    |
| gvisor            | 20210921 |

### CNI

åŒæ ·ï¼Œç›®å‰å¸‚é¢ä¸Šæ‰€æœ‰çš„ Kubernetes é›†ç¾¤éƒ¨ç½²å·¥å…·ä¸­ï¼Œå¯¹ CNI çš„æ”¯æŒ kubespray ä¹Ÿæ— ç–‘æ˜¯æœ€ä¸ºä¸°å¯Œçš„ï¼Œèƒ½æ”¯æŒ 9 ç§ CNI ä»¥åŠå¤šç§ CNI ç»„åˆéƒ¨ç½²çš„ [multus](https://github.com/intel/multus-cni) ã€‚

| Addon       | Version |
| ----------- | ------- |
| calico      | v3.20.3 |
| flannel     | v0.15.1 |
| flannel_cni | v1.0.0  |
| cni         | v1.0.1  |
| weave       | 2.8.1   |
| cilium      | v1.9.11 |
| kube_ovn    | v1.8.1  |
| kube_router | v1.3.2  |
| multus_cni  | 0.4.0   |
| multus      | v3.8    |

### Kubernetes-app

åŒæ—¶ï¼Œkubespray è¿˜æ”¯æŒä¸€äº› CLI å·¥å…·ä»¥åŠç¬¬ä¸‰æ–¹åº”ç”¨çš„éƒ¨ç½²ã€‚

- CLI å·¥å…·

ä¸€äº› CLI å·¥å…·ï¼Œæ¯”å¦‚ helmã€nerdctlã€krewã€crictlã€‚å…¶ä¸­ nerdctl çš„éƒ¨ç½²æ”¯æŒæ˜¯å’±åœ¨ [#7500](https://github.com/kubernetes-sigs/kubespray/pull/7500) ä¸­åŠ å…¥æ”¯æŒçš„ï¼Œç›®çš„æ˜¯ä¸º containerd ç”¨æˆ·æä¾›ä¸€ä¸ªç›¸å¯¹å‹å¥½çš„å‘½ä»¤è¡Œæ“ä½œä½“éªŒï¼Œä»¥æ›¿ä»£ docker CLIã€‚

| addon   | version |
| ------- | ------- |
| helm    | v3.7.1  |
| nerdctl | 0.15.0  |
| krew    | v0.4.2  |
| crictl  | v1.22.0 |

- app

ä¸ªäººæ„Ÿè§‰éƒ¨ç½²ä¸€äº›åƒ `dnsautoscaler`ã€ `argoCD` è¿™æ ·çš„åº”ç”¨ï¼Œè¿˜æ˜¯ä½¿ç”¨ helm æ¯”è¾ƒå¥½ã€‚å› ä¸ºåŸºäº ansible çš„ kubespray ç»´æŠ¤è¿™ä¹ˆå¤šç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œä»¥åŠå®ƒä»¬çš„å‡çº§ç®¡ç†éƒ½è¿œä¸å¦‚ helm æ–¹ä¾¿ã€‚å› æ­¤è€ƒè™‘åˆ°è¿™äº›ç»„ä»¶çš„å‡çº§ç»´æŠ¤æˆæœ¬ï¼Œä¸ªäººè¿˜æ˜¯ä¸å¤ªå»ºè®®ä½¿ç”¨ kubespray æ¥éƒ¨ç½²è¿™äº›ç»„ä»¶ã€‚

| Addon                | Version |
| -------------------- | ------- |
| dnsautoscaler        | 1.8.5   |
| netcheck             | v1.2.2  |
| nodelocaldns         | 1.21.1  |
| metrics_server       | v0.5.0  |
| cert_manager         | v1.5.4  |
| addon_resizer        | 1.8.11  |
| cinder_blockstorage  | v3      |
| external_vsphere     | 6.7u3   |
| nvidia_driver        | 390.87  |
| oci_cloud_controller | 0.7.0   |
| metallb              | v0.10.3 |
| argocd               | v2.1.6  |

## æ”¯æŒçš„ OS

| distribution                       | version              |
| ---------------------------------- | -------------------- |
| Amazon Linux                       | 2                    |
| Fedora CoreOS                      | 34.x/35.x            |
| Flatcar Container Linux by Kinvolk |                      |
| Alma Linux                         | 8                    |
| Rocky Linux                        | 8                    |
| CentOS/RHEL                        | 7/8                  |
| Oracle Linux                       | 7/8                  |
| Debian                             | 8/9/10/11            |
| Ubuntu                             | 16.04/18.04/20.04    |
| Fedora                             | 34/35                |
| openSUSE                           | Leap 15.x/Tumbleweed |

## ä¸»è¦å˜åŒ–

### åºŸé™¤

- åœ¨ [#8086](https://github.com/kubernetes-sigs/kubespray/pull/8086) ä¸­ç§»é™¤äº†å¯¹ Ambassador çš„æ”¯æŒï¼›
- åœ¨ [#8327](https://github.com/kubernetes-sigs/kubespray/pull/8327) ä¸­ç§»é™¤äº†å¯¹ registry-proxy çš„æ”¯æŒï¼›
- åœ¨ [#8246](https://github.com/kubernetes-sigs/kubespray/pull/8246) ä¸­ç§»é™¤äº†å¯¹ Fedora 33 çš„æ”¯æŒï¼Œå› ä¸º  Fedora 33 åœ¨ 2021-11-30 å°±å·²ç» EOL äº†ï¼Œæ‰€ä»¥è¢«åºŸå¼ƒæ”¯æŒä¹Ÿç†æ‰€å½“ç„¶ï¼›
- åœ¨ [#8265](https://github.com/kubernetes-sigs/kubespray/pull/8265) ä¸­ç§»é™¤äº†å¯¹ Mitogen çš„æ”¯æŒï¼ŒMitogen çš„ä½œç”¨å°±æ˜¯ç”¨æ¥ä¼˜åŒ– Ansible çš„æ€§èƒ½ï¼Œä½† Mitogen å¯¹äºä¸€äº›æ–°çš„ Linux å‘è¡Œç‰ˆæ”¯æŒçš„é¢å¹¶ä¸æ˜¯å¾ˆå‹å¥½ï¼Œåœ¨ Kubespray ä¸­ç»´æŠ¤çš„æˆæœ¬ä¹Ÿæ¯”è¾ƒå¤§ï¼Œå› æ­¤ç¤¾åŒºå°±åºŸå¼ƒå®ƒäº†ï¼›

### æ–°ç‰¹æ€§

- åœ¨ [#7895](https://github.com/kubernetes-sigs/kubespray/pull/7895) ä¸­æ–°å¢äº† ArgoCD çš„éƒ¨ç½²æ”¯æŒï¼Œé€šè¿‡è®¾ç½® `argocd_enabled` å³å¯åœ¨éƒ¨ç½²é›†ç¾¤çš„æ—¶å€™å®‰è£… ArgoCDã€‚ä¸è¿‡ä¸ªäººè®¤ä¸ºï¼ŒArgoCD è¿™ç©æ„å„¿ä¸å¤ªé€‚åˆæ”¾åœ¨ K8s éƒ¨ç½²å½“ä¸­æ¥ï¼Œçœ‹çœ‹ [ks-installer](https://github.com/kubesphere/ks-installer) çš„ä»£ç ä½ å°±èƒ½æ˜ç™½äº†ğŸ˜‚ã€‚
- åœ¨ [#8175](https://github.com/kubernetes-sigs/kubespray/pull/8175) ä¸­é»˜è®¤ä½¿ç”¨ containerd ä½œä¸ºé»˜è®¤çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œæ›¿ä»£æ‰äº† dockerã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å‰ç‰ˆæœ¬çš„ kubespray æ˜¯ä½¿ç”¨ [containerd](https://github.com/containerd/containerd) å®˜æ–¹ repo release çš„äºŒè¿›åˆ¶å®‰è£…åŒ…ï¼Œä½†äºŒè¿›åˆ¶å®‰è£…åŒ…å¹¶æ²¡æœ‰ arm64 ç‰ˆæœ¬çš„ã€‚æ‰€ä»¥å¦‚æœè¦éƒ¨ç½²çš„é›†ç¾¤èŠ‚ç‚¹åŒ…å« arm64 çš„æœºå™¨ï¼Œæœ€å¥½è¿˜æ˜¯ä½¿ç”¨ docker ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ã€‚
- åœ¨ [#8291](https://github.com/kubernetes-sigs/kubespray/pull/8291) æ–°å¢äº† registry éƒ¨ç½²æ”¯æŒå¤šç§ ServiceTypes çš„æ”¯æŒï¼›
- åœ¨ [#8229](https://github.com/kubernetes-sigs/kubespray/pull/8229) ä¸­æ–°å¢äº†æ”¯æŒ registry è®¤è¯çš„æ–¹å¼ï¼Œç§æœ‰åŒ–éƒ¨ç½²çš„æ—¶å€™ä½¿ç”¨å¸¦æœ‰è®¤è¯çš„ registry ä¼šç”¨åˆ°ï¼›

### å·²çŸ¥é—®é¢˜

- åœ¨ [#8239](https://github.com/kubernetes-sigs/kubespray/pull/8239) ä¸­ [cristicalin](https://github.com/cristicalin) å¤§ä½¬å¼•å…¥äº†ä¸€ä¸ªä¿®æ”¹ï¼Œå¦‚æœæ˜¯ containerd è¿è¡Œæ—¶ï¼Œåˆ™ä½¿ç”¨ nerdctl ä¸‹è½½é•œåƒã€‚è¿™å°†ä¼šå¯¼è‡´é…ç½®äº† containerd registry mirrors çš„å‚æ•°å°†ä¼šå¤±æ•ˆã€‚
