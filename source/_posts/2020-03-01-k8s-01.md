---
title: kubernets ç›¸å…³æŠ€æœ¯è°ƒç ”
date: 2020-03-01
updated: 2020-03-01
slug:
categories: æŠ€æœ¯
tag:
  - K8s
  - å®¹å™¨
  - è°ƒç ”
copyright: true
comment: true
---

> ä¿—è¯è¯´æ–‡æ¡£å†™å¾—å¥½ï¼ŒåŒè¡ŒæŠ„åˆ°è€ğŸ˜‚ã€‚

åœ¨å‰æœŸçš„æŠ€æœ¯é€‰å‹è°ƒç ”è¿‡ç¨‹ä¸­ï¼Œå¯¹ K8s å¯†åˆ‡ç›¸å…³çš„è§£å†³æ–¹æ¡ˆï¼šç½‘ç»œæ’ä»¶ã€å­˜å‚¨è§£å†³æ–¹æ¡ˆã€ç›‘æ§å‘Šè­¦ç³»ç»Ÿã€æ—¥å¿—æ”¶é›†å’Œå¤„ç†ã€æŒç»­é›†æˆå’Œäº¤ä»˜ç³»ç»Ÿç­‰åšäº†å……åˆ†çš„è°ƒç ”å’Œæµ‹è¯•å·¥ä½œï¼Œç°å¦‚ä»Šæ€»ç»“ä¸€ä¸‹è°ƒç ”è¿‡ç¨‹ä¸­çš„è®°å½•ã€‚

## å‚è€ƒ

ä¿—è¯è¯´æ–‡æ¡£å†™å¾—å¥½ï¼ŒåŒè¡ŒæŠ„åˆ°è€ğŸ˜‚ã€‚ä¸è¿‡å’±æœ¨å­è¿˜æ˜¯æœ‰ç‚¹åŸåˆ™çš„ï¼Œæœ€èµ·ç æ ‡æ³¨å¼•ç”¨æ¥æºï¼Œå°Šé‡åŸä½œè€…çš„ç‰ˆæƒã€‚æ‰€ä»¥å°±åœ¨æ­¤ç½—åˆ—äº†æœ¬æ–‡ ~~å‰½çªƒ~~ å¼•ç”¨çš„æ¥æºã€‚ç”±äºæ˜¯æŠ€æœ¯è°ƒç ”ï¼Œæ–‡ä¸­æåˆ°çš„ç›¸å…³å¼€æºè½¯ä»¶ä»‹ç»å¤šæ•°éƒ½æ˜¯å¼•ç”¨è‡ªå®˜æ–¹æ–‡æ¡£æˆ–è€…è‹±æ–‡ç¿»è¯‘çš„æ–‡æ¡£ã€‚å…·ä½“çš„ç»†èŠ‚ç¨åå†æ›´æ–°åšå®¢è¡¥å……ã€‚æœ¬æ–‡çš„å†…å®¹æ¶‰åŠæ¯”è¾ƒå¤šï¼Œä¸»è¦å‚è€ƒå’Œå¼•ç”¨äº†ä»¥ä¸‹ç«™ç‚¹ã€‚

| ç«™ç‚¹                                                         | ä¸»è¦å†…å®¹                                                     | å°è±¡                                          |
| ------------------------------------------------------------ | ------------------------------------------------------------ | --------------------------------------------- |
| [Jimmy Song - å®‹å‡€è¶…çš„åšå®¢](https://jimmysong.io/)           | å¾®æœåŠ¡ã€æœåŠ¡ç½‘æ ¼ã€äº‘åŸç”Ÿ                                     | èš‚èšé‡‘æœäº‘åŸç”Ÿå¸ƒé“å¸ˆ                          |
| [Cloud Native Wiki](https://jimmysong.io/cloud-native/ )     | äº‘åŸç”Ÿç™¾ç§‘ã€å›¾ä¹¦ã€ç¼–å¹´å²                                     | èš‚èšé‡‘æœäº‘åŸç”Ÿå¸ƒé“å¸ˆ                          |
| [æ•–å°å‰‘çš„åšå®¢](https://skyao.io/)                            | å¾®æœåŠ¡ã€æœåŠ¡ç½‘æ ¼ã€äº‘åŸç”Ÿ                                     | èš‚èšé‡‘æœäº‘åŸç”Ÿå¸ƒé“å¸ˆ                          |
| [äº‘åŸç”Ÿå®éªŒå®¤ - ç±³å¼€æœ—åŸºæ¨çš„åšå®¢](https://fuckcloudnative.io/) | Cloud Native                                                 | äº‘åŸç”Ÿå¸ƒé“å¸ˆ                                  |
| [zhangguanzhang's Blog](https://zhangguanzhang.github.io/)   | Kubernetesã€åµŒå…¥å¼ã€Linux                                    | å¼ é¦†é•¿ğŸ˜‚                                       |
| [æ¼ ç„¶çš„åšå®¢mritd Blog](https://mritd.me/)                    | Kubernetesã€Golang                                           | Java Web å¼€å‘è€… 1 æš                          |
| [MoeLove](https://moelove.info/)                             | Kubernetes ç”Ÿæ€ç›¸å…³ã€å¼€æº                                    | æ¯å‘¨åšæŒå‘¨æŠ¥ğŸ‘                                 |
| [KaiRen's Blog](https://k2r2bai.com/)                        | Kubernetesã€Docker å®¹å™¨                                      | å°æ¹¾åšä¸»                                      |
| [Hwchiu Learning Note](https://www.hwchiu.com/)              | Kubernetesã€SDNã€DevOps                                      | å°æ¹¾åšä¸»                                      |
| [Kakashi's Blog](https://kkc.github.io/)                     | AWSã€Kubernetesã€Prometheus                                  | å°æ¹¾åšä¸»                                      |
| [Aylei's Blog](https://aleiwu.com/)                          | Kubernetesã€äº‘åŸç”Ÿã€TiDB                                     | åœ¨ [PingCAP](https://www.pingcap.com/) çš„é˜¿ç£Š |
| [é’æœ¨ã®Javaå°å±‹](https://qingmu.io/)                         | [SpringCloud on Kubernetes](https://qingmu.io/2019/09/03/Spring-cloud-on-Kubernetes-index/) | æ‰“æ‚ç¨‹åºçŒ¿                                    |
| [å¼€å…ƒDevOpsçŸ¥è¯†åº“](https://nicksors.cc/)                     |                                                              |                                               |
| [èµ·é£äº†](https://xuchao918.github.io/)                       |                                                              |                                               |
| [èŒ¶æ­‡é©¿ç«™ ](https://maiyang.me/)                             |                                                              |                                               |
| [Polar Snow Documentation](https://docs.lvrui.io/)           |                                                              |                                               |
| [DevOps â€“ æˆé•¿ä¹‹è·¯](http://www.rhca.me/)                     |                                                              |                                               |
| [æ¢¦æ—­éšæƒ³](https://blog.ihypo.net/index.html)                | Kubernetes ã€å®¹å™¨                                            | æ— æ ˆå·¥ç¨‹å¸ˆğŸ˜‚                                   |
| [æˆ‘çˆ±è¥¿çº¢æŸ¿](https://www.bladewan.com/)                      |                                                              |                                               |
| [Bingo Huang](https://bingohuang.com/)                       | Golangã€Docker                                               | ä¸€ä¸ªç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»                          |
| [å›½å—ä¹‹å¢ƒ](https://hansedong.github.io/)                     | CoreDNS ã€Kubernetesã€Golang                                 |                                               |
| [åšå®¢é«˜ç­–](http://gaocegege.com/Blog/)                       | æœºå™¨å­¦ä¹ ã€Kubernetesã€kubebuilder                            | æ±Ÿæ¹–å°è™¾ç±³                                    |
| [birdben](https://birdben.github.io/)                        |                                                              |                                               |
| [æµ®ç”Ÿè‹¥æ¢¦](https://fs.tn/)                                   |                                                              |                                               |
| [ictfox blog](http://www.yangguanjun.com/)                   |                                                              |                                               |
| [æœå±¹ä¸œçš„åšå®¢å­¦æ— æ­¢å¢ƒ](https://www.duyidong.com/)            |                                                              |                                               |
| [CloudNative æ¶æ„](http://team.jiunile.com/)                 |                                                              |                                               |
| [Doublemine](https://notes.doublemine.me/)                   |                                                              |                                               |
| [Arthur Chunqi Li's Blog](http://chunqi.li/)                 |                                                              |                                               |
| [Archive Arthur Chunqi Li's Blog](http://chunqi.li/archives/) |                                                              |                                               |
| [ITæŠ€æœ¯å·¥ä½œå­¦ä¹ æŠ˜è…¾ç¬”è®° æä½¶æ¾³çš„åšå®¢](https://www.lijiaocn.com/) |                                                              |                                               |
| [å¢¨è·ç¼æ—å®˜ç½‘-ç¼–ç¨‹æ—¥å¿—](http://moheqionglin.com/site/blogs/1/list.html) |                                                              |                                               |
| [Archive - Nolla](https://cmgs.me/archive)                   |                                                              |                                               |
| [Tomoya's Blog](https://tomoyadeng.github.io/blog/)          |                                                              |                                               |
| [å›æ— æ­¢å¢ƒ](https://youendless.com/)                          |                                                              |                                               |
| [Jamin Zhang](https://jaminzhang.github.io/)                 |                                                              |                                               |
| [roc çš„åšå®¢ - imroc.io](https://imroc.io/)                   | [ã€ŠKuberneteså®è·µæŒ‡å—ã€‹](https://k8s.imroc.io/)ã€ ç®—æ³•       |                                               |
| [Blog - Sysdig](https://sysdig.com/blog/)                    |                                                              |                                               |
| [sleeleçš„åšå®¢](https://sleele.com/)                          |                                                              |                                               |
| [TauCeti blog Â· TauCeti blog](https://www.tauceti.blog/)     |                                                              |                                               |
| [Solar](https://zhangchenchen.github.io/)                    |                                                              |                                               |
| [Infvie's Blogè¿ç»´SREç¤¾åŒºåšå®¢](https://www.infvie.com/)      |                                                              |                                               |
| [æ°´æ™¶å‘½åŒ£](http://ghoulich.xninja.org/)                      |                                                              |                                               |
| [è‹æ´‹åšå®¢](https://soulteary.com/)                           |                                                              |                                               |
| [Zlatan Eevee](https://ieevee.com/)                          |                                                              |                                               |

## å¼€æºå®¹å™¨å¹³å°

### [OpenShift](https://www.openshift.com/)

#### ç®€ä»‹

OpenShift æ˜¯çº¢å¸½çš„äº‘å¼€å‘å¹³å°å³æœåŠ¡ï¼ˆPaaSï¼‰ã€‚ é€šè¿‡ OpenShiftï¼Œä¼ä¸šå¯ä»¥å¿«é€Ÿæ­å»ºç¨³å®šã€å®‰å…¨ã€é«˜æ•ˆçš„å®¹å™¨åº”ç”¨å¹³å°ã€‚åœ¨è¿™ä¸ªå¹³å°ä¸Šï¼š

- å¯ä»¥æ„å»ºä¼ä¸šå†…éƒ¨çš„å®¹å™¨åº”ç”¨å¸‚åœºï¼Œä¸ºå¼€å‘äººå‘˜å¿«é€Ÿæä¾›åº”ç”¨å¼€å‘æ‰€ä¾èµ–çš„ä¸­é—´ä»¶ã€æ•°æ®åº“ç­‰æœåŠ¡ã€‚
- é€šè¿‡è‡ªåŠ¨åŒ–çš„æµç¨‹ï¼Œå¼€å‘äººå‘˜å¯ä»¥å¿«é€Ÿè¿›è¡Œåº”ç”¨çš„æ„å»ºã€å®¹å™¨åŒ–åŠéƒ¨ç½²ã€‚
- é€šè¿‡ OpenShiftï¼Œç”¨æˆ·å¯ä»¥è´¯é€šä»åº”ç”¨å¼€å‘åˆ°æµ‹è¯•ï¼Œå†åˆ°ä¸Šçº¿çš„å…¨æµç¨‹ï¼Œå¼€å‘ã€æµ‹è¯•å’Œè¿ç»´ç­‰ä¸åŒçš„è§’è‰²å¯ä»¥åœ¨ä¸€ä¸ªå¹³å°ä¸Šè¿›è¡Œåä½œã€‚
- æ”¯æŒ LDAP ç”¨æˆ·æƒé™ç®¡ç†ï¼Œæ”¯æŒç»†ç²’åº¦çš„æƒé™èµ„æºç®¡ç†ã€‚
- OpenShift å¯ä»¥æé«˜åº”ç”¨ä»ç ”å‘åˆ°ä¸Šçº¿çš„æ•ˆç‡å’Œé€Ÿåº¦ï¼Œç¼©çŸ­äº§å“ä¸Šå¸‚çš„æ—¶é—´ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å¸®åŠ©ä¼ä¸šæ¨è¿›DevOpsï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ï¼Œæå‡ç”Ÿäº§æ•ˆç‡ã€‚

### [KubeSphere](https://kubesphere.io/zh-CN/projects/)

#### ç®€ä»‹

[KubeSphere](https://kubesphere.io) æ˜¯åœ¨ç›®å‰ä¸»æµå®¹å™¨è°ƒåº¦å¹³å° [Kubernetes](https://kubernetes.io)  ä¹‹ä¸Šæ„å»ºçš„ä¼ä¸šçº§åˆ†å¸ƒå¼å¤šç§Ÿæˆ·å®¹å™¨å¹³å°ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„æ“ä½œç•Œé¢ä»¥åŠå‘å¯¼å¼æ“ä½œæ–¹å¼ï¼Œåœ¨é™ä½ç”¨æˆ·ä½¿ç”¨å®¹å™¨è°ƒåº¦å¹³å°å­¦ä¹ æˆæœ¬çš„åŒæ—¶ï¼Œæå¤§å‡è½»å¼€å‘ã€æµ‹è¯•ã€è¿ç»´çš„æ—¥å¸¸å·¥ä½œçš„å¤æ‚åº¦ï¼Œæ—¨åœ¨è§£å†³ Kubernetes  æœ¬èº«å­˜åœ¨çš„å­˜å‚¨ã€ç½‘ç»œã€å®‰å…¨å’Œæ˜“ç”¨æ€§ç­‰ç—›ç‚¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¹³å°å·²ç»æ•´åˆå¹¶ä¼˜åŒ–äº†å¤šä¸ªé€‚ç”¨äºå®¹å™¨åœºæ™¯çš„åŠŸèƒ½æ¨¡å—ï¼Œä»¥å®Œæ•´çš„è§£å†³æ–¹æ¡ˆå¸®åŠ©ä¼ä¸šè½»æ¾åº”å¯¹æ•æ·å¼€å‘ä¸è‡ªåŠ¨åŒ–è¿ç»´ã€å¾®æœåŠ¡æ²»ç†ã€å¤šç§Ÿæˆ·ç®¡ç†ã€å·¥ä½œè´Ÿè½½å’Œé›†ç¾¤ç®¡ç†ã€æœåŠ¡ä¸ç½‘ç»œç®¡ç†ã€åº”ç”¨ç¼–æ’ä¸ç®¡ç†ã€é•œåƒä»“åº“ç®¡ç†å’Œå­˜å‚¨ç®¡ç†ç­‰ä¸šåŠ¡åœºæ™¯ã€‚

KubeSphere é«˜çº§ç‰ˆæä¾›ä¼ä¸šçº§å®¹å™¨åº”ç”¨ç®¡ç†æœåŠ¡ï¼Œæ”¯æŒæ›´å¼ºå¤§çš„åŠŸèƒ½å’Œçµæ´»çš„é…ç½®ï¼Œæ»¡è¶³ä¼ä¸šå¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ã€‚æ¯”å¦‚æ”¯æŒ  Master å’Œ etcd èŠ‚ç‚¹é«˜å¯ç”¨ã€å¯è§†åŒ– CI/CD æµæ°´çº¿ã€å¤šç»´åº¦ç›‘æ§å‘Šè­¦æ—¥å¿—ã€å¤šç§Ÿæˆ·ç®¡ç†ã€LDAP é›†æˆã€æ–°å¢æ”¯æŒ HPA  (æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©) ã€å®¹å™¨å¥åº·æ£€æŸ¥ä»¥åŠ Secretsã€ConfigMaps  çš„é…ç½®ç®¡ç†ç­‰åŠŸèƒ½ï¼Œæ–°å¢å¾®æœåŠ¡æ²»ç†ã€ç°åº¦å‘å¸ƒã€s2iã€ä»£ç è´¨é‡æ£€æŸ¥ç­‰ï¼Œåç»­è¿˜å°†æä¾›å’Œæ”¯æŒå¤šé›†ç¾¤ç®¡ç†ã€å¤§æ•°æ®ã€äººå·¥æ™ºèƒ½ç­‰æ›´ä¸ºå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ã€‚

### [Rancher](https://rancher.com/)

#### ç®€ä»‹

Rancher æ˜¯ä¸€ä¸ªå¼€æºçš„ä¼ä¸šçº§å¤šé›†ç¾¤ Kubernetes ç®¡ç†å¹³å°ã€‚é€šè¿‡ Rancherï¼Œä¼ä¸šå†ä¹Ÿä¸å¿…è‡ªå·±ä½¿ç”¨ä¸€ç³»åˆ—çš„å¼€æºè½¯ä»¶å»ä»å¤´æ­å»ºå®¹å™¨æœåŠ¡å¹³å°ã€‚å®ƒæä¾›äº†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨çš„ç®¡ç† Docker å’Œ Kubernetes çš„å…¨æ ˆåŒ–å®¹å™¨éƒ¨ç½²ä¸ç®¡ç†å¹³å°ã€‚å®ƒå¯ä»¥å¸®åŠ©ä¼ä¸šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è½»æ¾å¿«æ·çš„éƒ¨ç½²å’Œç®¡ç†å®¹å™¨ï¼Œè½»æ¾åœ°ç®¡ç†å„ç§ç¯å¢ƒçš„ Kubernetes ï¼Œæ»¡è¶³ITéœ€æ±‚å¹¶ä¸ºDevOpså›¢é˜Ÿæä¾›æ”¯æŒã€‚

## éƒ¨ç½²å·¥å…·

### [RKE](https://github.com/rancher/rke)

RKE å…¨ç§°ä¸º Rancher Kubernetes Engineï¼Œæ˜¯ Rancher å¼€æºçš„è½»é‡çº§ K8s é›†ç¾¤éƒ¨ç½²å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿçš„éƒ¨ç½²ä¸€ä¸ª K8s é›†ç¾¤ã€‚å‚è€ƒæ–‡æ¡£ [ä½¿ç”¨RKEéƒ¨ç½²ä¸€ä¸ªK8sé›†ç¾¤å¹¶éƒ¨ç½²Rancher HA](https://fs.tn/post/PmaL-uIiQ) ã€‚

### [Kops](https://github.com/kubernetes/kops)

[kops](https://github.com/kubernetes/kops) æ˜¯ä¸€ä¸ªç”Ÿäº§çº§ Kubernetes é›†ç¾¤éƒ¨ç½²å·¥å…·ï¼Œå¯ä»¥åœ¨ AWSã€GCEã€VMWare vSphere ç­‰å¹³å°ä¸Šè‡ªåŠ¨éƒ¨ç½²é«˜å¯ç”¨çš„ Kubernetes é›†ç¾¤ã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

- å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨

- å…¨è‡ªåŠ¨å®‰è£…æµç¨‹
- ä½¿ç”¨ DNS è¯†åˆ«é›†ç¾¤
- æ”¯æŒè‡ªå®šä¹‰æ‰©å±• add-ons
- æ”¯æŒé«˜å¯ç”¨ - å‚è€ƒ [high_availability.md](https://github.com/kubernetes/kops/blob/master/docs/high_availability.md)
- dry-run å’Œè‡ªåŠ¨å¹‚ç­‰å‡çº§ç­‰åŸºäºçŠ¶æ€åŒæ­¥æ¨¡å‹
- æ”¯æŒä» [kube-up](https://github.com/kubernetes/kops/blob/master/docs/upgrade_from_kubeup.md) åˆ›å»ºçš„é›†ç¾¤å‡çº§åˆ° kops ç‰ˆæœ¬
- è‡ªåŠ¨éƒ¨ç½²é«˜å¯ç”¨çš„ Kubernetes é›†ç¾¤
- è‡ªæˆ‘ä¿®å¤ï¼šä¸€åˆ‡éƒ½åœ¨è‡ªåŠ¨æ‰©å±•ç»„ä¸­è¿è¡Œ
- å¯ä»¥ç›´æ¥æä¾›æˆ–è€…ç”Ÿæˆ terraform æ¸…å• - å‚è€ƒ [terraform.md](https://github.com/kubernetes/kops/blob/master/docs/terraform.md)
- æ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿï¼ˆå¦‚ Debianã€Ubuntu 16.04ã€CentOSã€RHELã€Amazon Linux å’Œ CoreOSï¼‰

### [Kubeadm](https://github.com/kubernetes/kubeadm)

Kubeadm æ˜¯ Kubernetes å®˜æ–¹æ¨å‡ºçš„é›†ç¾¤éƒ¨ç½²å·¥å…·ï¼Œåœ¨ 1.14.0 ç‰ˆæœ¬ä¹‹åå°±å·²ç»è¾¾åˆ°ç”Ÿäº§å¯ç”¨ GA çš„ç¨³å®šæ€§ã€‚å¯¹äºåˆšåˆšæ¥è§¦ Kubernetes çš„äººå‘˜æ¥è¯´ï¼ŒKubeadm æ— ç–‘æ˜¯ä¸ªå¥½å·¥å…·ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ kubeadm æ‰€éœ€è¦çš„é•œåƒæ˜¯åœ¨ gcr.k8s.io ä¸Šçš„ï¼Œè¢« GFW ç»™å¢™æ‰äº†ï¼Œå¯ä»¥å°†é•œåƒä»å¢™å¤–çš„å°æœåŠ¡å™¨ä¸Šæä¸‹æ¥ï¼Œç„¶åé€šè¿‡ docker load çš„æ–¹å¼åŠ è½½é•œåƒï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºæ— æ³• pull é•œåƒ pod ä¸€ç›´å¤„åœ¨ pending çŠ¶æ€ã€‚

### [sealos](https://github.com/fanux/sealos)

sealos åŸºäº kubeadm æ¥éƒ¨ç½²ï¼Œæ—¨åœ¨åšä¸€ä¸ªç®€å•å¹²å‡€è½»é‡çº§ç¨³å®šçš„ kubernetes å®‰è£…å·¥å…·ï¼Œèƒ½å¾ˆå¥½çš„æ”¯æŒé«˜å¯ç”¨å®‰è£…ã€‚ç‰¹æ€§å¦‚ä¸‹ï¼š

- è¯ä¹¦å»¶æœŸ
- ä½¿ç”¨ç®€å•ï¼Œæ”¯æŒè‡ªå®šä¹‰é…ç½®
- å†…æ ¸è´Ÿè½½ï¼Œæå…¶ç¨³å®šï¼Œå› ä¸ºç®€å•æ‰€ä»¥æ’æŸ¥é—®é¢˜ä¹Ÿæå…¶ç®€å•
- æ”¯æŒç¦»çº¿å®‰è£…ï¼Œå·¥å…·ä¸èµ„æºåŒ…ï¼ˆäºŒè¿›åˆ¶ç¨‹åº é…ç½®æ–‡ä»¶ é•œåƒ  yaml æ–‡ä»¶ç­‰ï¼‰åˆ†ç¦»,è¿™æ ·ä¸åŒç‰ˆæœ¬æ›¿æ¢ä¸åŒç¦»çº¿åŒ…å³å¯

### [kubeasz](https://github.com/easzlab/kubeasz)

ä½¿ç”¨ Ansible è„šæœ¬å®‰è£… K8s é›†ç¾¤ï¼Œä»‹ç»ç»„ä»¶äº¤äº’åŸç†ï¼Œæ–¹ä¾¿ç›´æ¥ï¼Œä¸å—å›½å†…ç½‘ç»œç¯å¢ƒå½±å“ã€‚æ˜¯ç›®å‰ kubernetes ä¸­æ–‡ç¤¾åŒºæœ€ä¸ºçƒ­é—¨çš„éƒ¨ç½²å·¥å…·ï¼ŒGitHub ä¸Šçš„ start æ•°è¶…è¿‡äº† 4K5 ã€‚åŸºäºäºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²å’Œåˆ©ç”¨`ansible-playbook`å®ç°è‡ªåŠ¨åŒ–ï¼›æ—¢æä¾›ä¸€é”®å®‰è£…è„šæœ¬, ä¹Ÿå¯ä»¥æ ¹æ®`å®‰è£…æŒ‡å—`åˆ†æ­¥æ‰§è¡Œå®‰è£…å„ä¸ªç»„ä»¶ã€‚

- é›†ç¾¤ç‰¹æ€§ `TLS`åŒå‘è®¤è¯ã€`RBAC`æˆæƒã€[å¤šMasteré«˜å¯ç”¨](https://github.com/easzlab/kubeasz/blob/master/docs/setup/00-planning_and_overall_intro.md#ha-architecture)ã€æ”¯æŒ`Network Policy`ã€å¤‡ä»½æ¢å¤ã€[ç¦»çº¿å®‰è£…](https://github.com/easzlab/kubeasz/blob/master/docs/setup/offline_install.md)
- é›†ç¾¤ç‰ˆæœ¬ kubernetes v1.13, v1.14, v1.15, v1.16
- æ“ä½œç³»ç»Ÿ CentOS/RedHat 7, Debian 9/10, Ubuntu 1604/1804
- è¿è¡Œæ—¶ docker 18.06.x-ce, 18.09.x, [containerd](https://github.com/easzlab/kubeasz/blob/master/docs/guide/containerd.md) 1.2.6
- ç½‘ç»œ [calico](https://github.com/easzlab/kubeasz/blob/master/docs/setup/network-plugin/calico.md), [cilium](https://github.com/easzlab/kubeasz/blob/master/docs/setup/network-plugin/cilium.md), [flannel](https://github.com/easzlab/kubeasz/blob/master/docs/setup/network-plugin/flannel.md), [kube-ovn](https://github.com/easzlab/kubeasz/blob/master/docs/setup/network-plugin/kube-ovn.md), [kube-router](https://github.com/easzlab/kubeasz/blob/master/docs/setup/network-plugin/kube-router.md)

### [kubespray](https://github.com/kubernetes-sigs/kubespray)

[Kubespray](https://github.com/kubernetes-incubator/kubespray) æ˜¯ Kubernetes incubator ä¸­çš„é¡¹ç›®ï¼Œä¹Ÿæ˜¯ kubernetes å®˜æ–¹å‡ºå“ã€‚ç›®æ ‡æ˜¯æä¾›ç”Ÿäº§å¯ç”¨ Kubernetes éƒ¨ç½²æ–¹æ¡ˆï¼Œè¯¥é¡¹ç›®åŸºç¡€æ˜¯é€šè¿‡ Ansible Playbook æ¥å®šä¹‰ç³»ç»Ÿä¸ Kubernetes é›†ç¾¤éƒ¨ç½²çš„ä»»åŠ¡ï¼Œå…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š

- å¯ä»¥éƒ¨ç½²åœ¨ AWS, GCE, Azure, OpenStack ä»¥åŠè£¸æœºä¸Š.
- éƒ¨ç½² High Available Kubernetes é›†ç¾¤.
- å¯ç»„åˆæ€§ (Composable)ï¼Œå¯è‡ªè¡Œé€‰æ‹© Network Plugin (flannel, calico, canal, weave) æ¥éƒ¨ç½².
- æ”¯æŒå¤šç§ Linux distributions(CoreOS, Debian Jessie, Ubuntu 16.04, CentOS/RHEL7).

ä¸è¿‡ç”±äºæ˜¯å›½å¤–å¼€å‘è€…ç»´æŠ¤ï¼Œæœ‰äº›è½¯ä»¶åŒ…å› ä¸ºç½‘ç»œåŸå› æ— æ³•ä¸‹è½½ä¸‹æ¥æ‰€ä»¥ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥å›½å†…ç”¨æˆ·ä¸å»ºè®®è§¦ç¢°ï¼Œé™¤éä½ å†å»æ‰‹åŠ¨ä¿®æ”¹é‚£äº›è½¯ä»¶åŒ…çš„æºä¸ºå›½å†…çš„ã€‚

## ç¨³å®šç‰ˆæœ¬é€‰æ‹©

å¯ä»¥å‚ç…§è¿™å¼ è¡¨æ ¼ï¼Œæ¥é€‰æ‹©å°ç‰ˆæœ¬å·ä»‹äº 5~~8 ä¹‹é—´ä¸”è¿˜åœ¨ç»´æŠ¤çš„ç‰ˆæœ¬ã€‚æ¯”å¦‚ v1.16.7 ï¼Œæœ‰ CVE å®‰å…¨æ¼æ´ä¹‹å‰çš„ç‰ˆæœ¬ä¹Ÿä¸å»ºè®®ä½¿ç”¨ã€‚

| month   | stable                                                       | stable                                                       | stable                                                       | stable                                                       |
| ------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 2020-02 | [v1.17.3](https://github.com/kubernetes/kubernetes/releases/tag/v1.17.3) | [v1.16.7](https://github.com/kubernetes/kubernetes/releases/tag/v1.16.7) | [v1.15.10](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.10) |                                                              |
| 2020-01 | [v1.17.2](https://github.com/kubernetes/kubernetes/releases/tag/v1.17.2)<br> [v1.17.1](https://github.com/kubernetes/kubernetes/releases/tag/v1.17.1) | [v1.16.6](https://github.com/kubernetes/kubernetes/releases/tag/v1.16.6)<br> [v1.16.5](https://github.com/kubernetes/kubernetes/releases/tag/v1.16.5) | [v1.15.9](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.9)<br> [v1.15.8](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.8) | CVE                                                          |
| 2019-12 | [v1.17.0](https://github.com/kubernetes/kubernetes/releases/tag/v1.17.0) | [v1.16.4](https://github.com/kubernetes/kubernetes/releases/tag/v1.16.4) | [v1.15.7](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.7) | [v1.14.10](https://github.com/kubernetes/kubernetes/releases/tag/v1.14.10) |
| 2019-11 | [v1.16.3](https://github.com/kubernetes/kubernetes/releases/tag/v1.16.3) | [v1.15.6](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.6) | [v1.14.9](https://github.com/kubernetes/kubernetes/releases/tag/v1.14.9) |                                                              |
| 2019-10 | [v1.16.1](https://github.com/kubernetes/kubernetes/releases/tag/v1.16.1)  <br>[v1.16.2](https://github.com/kubernetes/kubernetes/releases/tag/v1.16.2) | [v1.15.5](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.5) | [v1.14.8](https://github.com/kubernetes/kubernetes/releases/tag/v1.14.8) | [v1.13.12](https://github.com/kubernetes/kubernetes/releases/tag/v1.13.12) |
| 2019-09 | [v1.16.0](https://github.com/kubernetes/kubernetes/releases/tag/v1.16.0) | [v1.15.4](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.4) | [v1.14.7](https://github.com/kubernetes/kubernetes/releases/tag/v1.14.7) | [v1.13.11](https://github.com/kubernetes/kubernetes/releases/tag/v1.13.11) |
| 2019-08 | [v1.15.2](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.2)<br> [v1.15.3](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.3) | [v1.14.5](https://github.com/kubernetes/kubernetes/releases/tag/v1.14.5) <br> [v1.14.6](https://github.com/kubernetes/kubernetes/releases/tag/v1.14.6) | [v1.13.9](https://github.com/kubernetes/kubernetes/releases/tag/v1.13.9)  <br>[v1.13.10](https://github.com/kubernetes/kubernetes/releases/tag/v1.13.10) | CVE                                                          |
| 2019-07 | [v1.15.1](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.1) | [v1.14.4](https://github.com/kubernetes/kubernetes/releases/tag/v1.14.4) | [v1.13.8](https://github.com/kubernetes/kubernetes/releases/tag/v1.13.8) | [v1.12.10](https://github.com/kubernetes/kubernetes/releases/tag/v1.12.10) |
| 2019-06 | [v1.15.0](https://github.com/kubernetes/kubernetes/releases/tag/v1.15.0) | [v1.14.3](https://github.com/kubernetes/kubernetes/releases/tag/v1.14.3) | [v1.13.7](https://github.com/kubernetes/kubernetes/releases/tag/v1.13.7) |                                                              |

### 1.14.10

#### ä¸Šæ¸¸è¿›å±•

- å¯¹ Windows Node å’Œ container çš„æ”¯æŒè¾¾åˆ°ç”Ÿäº§çº§åˆ«ï¼Œæ”¯æŒ Windows Server 2019ï¼›
- æœ¬åœ°æŒä¹…åŒ–æ•°æ®å·æ­£å¼å¯ç”¨ï¼Œè¿™å¯ä»¥æ–¹ä¾¿ä½¿ç”¨æœ¬åœ° SSD ä¹‹ç±»çš„å­˜å‚¨ï¼Œä½†æ³¨æ„è¿™ä¸ªç‰¹æ€§å®¹é”™æ€§è¾ƒå·®ï¼›
- Pod ä¼˜å…ˆçº§å’ŒæŠ¢å æœºåˆ¶æ­£å¼å¯ç”¨ï¼Œ(å»ºè®®æ…é‡ä½¿ç”¨)ï¼›
- Pod Ready++ (Pod Readiness Gates) è¾¾åˆ°ç¨³å®šï¼Œå¯ä»¥æ›´å¥½çš„åˆ¤æ–­ Pod åŠå…¶éœ€è¦çš„èµ„æºæ˜¯å¦å‡å·²å°±ç»ªï¼›

### 1.15.7

#### ä¸Šæ¸¸è¿›å±•

- v1.15 ç‰ˆæœ¬ç”± 25 ä¸ªå¢å¼ºåŠŸèƒ½ç»„æˆï¼Œå…¶ä¸­ 2 ä¸ªç§»åŠ¨åˆ° stable ï¼Œ13 ä¸ª beta ä»¥åŠ 10 ä¸ª alpha ï¼Œæ•´ä½“ä¸Šé›†ä¸­äºç¨³å®šæ€§æ”¹è¿›å’Œæ‰©å±•çš„å¢å¼ºã€‚

- CRD (Custom Resource Definition) æ˜¯ Kubernetes  æä¾›çš„ä¸€ç§å¯ç”¨äºæ‰©å±•å…¶èƒ½åŠ›çš„æ–¹å¼ï¼Œå½“å‰æœ‰å¾ˆå¤šä½¿ç”¨ CRD æ„å»ºäº Kubernetes ä¸Šçš„å¹³å°/ç³»ç»Ÿï¼Œå¯ä»¥è¯´ä¹‹åå¯¹ Kubernetes  çš„æ‰©å±•ï¼Œæˆ–è€…è¯´æƒ³è¦åŸºäº Kubernetes å¼€å‘ï¼ŒåŒæ—¶åˆæƒ³ä¸ä¸Šæ¸¸ä¿æŒåŒæ­¥çš„è¯ï¼ŒCRD æ˜¯ä¸ªæœ€ä½³çš„é€‰æ‹©ã€‚

- Kubeadm åœ¨æ­¤ç‰ˆæœ¬å¼€å§‹æœ‰äº†è‡ªå·±ç‹¬ç«‹çš„ LOGO ï¼ŒåŒæ—¶åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ kubeadm çš„åŠŸèƒ½ä¹Ÿå¾—åˆ°äº†å¾ˆå¤šçš„å®Œå–„å’Œè¡¥å……ã€‚è¿™ä½¿å¾— kubeadm æˆä¸ºæ›´æ™®é/æ›´å¥½ç”¨çš„æ­å»ºé›†ç¾¤çš„å·¥å…·ï¼ŒåŒæ—¶å¯¹é›†ç¾¤ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ä¹Ÿåšçš„æ›´åŠ åˆ°ä½äº†ã€‚

### 1.16.5

#### ä¸Šæ¸¸è¿›å±•

- CRD è¾¾åˆ° GA ï¼Œè¿™æ˜¯å½“å‰ç¤¾åŒºæœ€ä¸ºæ¨å´‡çš„ä¸€ç§æ‰©å±• Kubernetes çš„æ–¹å¼ï¼Œå¹¶ä¸”è‡ªä» 1.7 åŠ å…¥åï¼Œä¹Ÿè¢«è¶Šæ¥è¶Šå¹¿æ³›çš„ä½¿ç”¨äº†ï¼›
- å‡†å…¥æ§åˆ¶ webhooks è¾¾åˆ° GA ï¼Œå‡†å…¥æ§åˆ¶åœ¨ Kubernetes ä¸­å¤ªè¿‡äºé‡è¦äº†ï¼Œè‡ª 1.9 è¯¥åŠŸèƒ½åŠ å…¥ä»¥æ¥ï¼Œè¢«å¹¿æ³›ç”¨äºæ‰©å±• Kubernetes ç›¸å…³åŠŸèƒ½ï¼›
- ç°åœ¨ CSI è§„èŒƒä¸­æ”¯æŒè°ƒæ•´å·å¤§å°ï¼Œå½“å‰æ­£åœ¨è¿ç§»è‡³ Beta é˜¶æ®µï¼›
- IPv4/IPv6 åŒæ ˆæ”¯æŒï¼›
- ä¸ºäº†æ›´å¥½çš„æ§åˆ¶ kube-apiserver çš„ç½‘ç»œæµé‡ï¼Œæ­£åœ¨å°è¯•ç»™å®ƒå¢åŠ ä¸€ä¸ª[ä»£ç†](https://github.com/kubernetes/enhancements/blob/master/keps/sig-api-machinery/20190226-network-proxy.md)ï¼Œè¯¦æƒ…å¯ç‚¹å‡»é“¾æ¥æŸ¥çœ‹ï¼›
- ç°åœ¨ kubeadm  åœ¨ TLS bootstrap ä¹‹åï¼Œå°†ä¼šåˆ é™¤ `bootstrap-kubelet.conf`ï¼Œå¦‚æœæœ‰ä¾èµ–æ­¤æ–‡ä»¶çš„å°ä¼™ä¼´ï¼Œè¯·å°½å¿«è¿ç§»ä½¿ç”¨ `kubelet.conf` ï¼Œæ­¤å¤–ä¹Ÿå»ºè®®å…ˆçœ‹çœ‹ RBAC ç›¸å…³çš„å†…å®¹ï¼Œäº†è§£ä¸‹åˆ‡æ¢çš„æ„ä¹‰ï¼›
- `beta.kubernetes.io/metadata-proxy-ready` å’Œ `beta.kubernetes.io/kube-proxy-ds-ready` éƒ½è¢«ç§»é™¤äº†ï¼›
- è¿˜æœ‰ä¹‹å‰æåˆ°è¿‡çš„ `pps/v1beta1` å’Œ `apps/v1beta2` å·²ç»è¢« `apps/v1` å–ä»£ç­‰ï¼Œè¿™é‡Œä¸å†ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œæœ‰å…´è¶£å¯å‚è€ƒä¹‹å‰çš„å‘¨æŠ¥å†…å®¹ã€‚

### 1.17.0

#### ä¸Šæ¸¸è¿›å±•

- Kubernetes v1.17 åŒ…å« 22 ä¸ªå¢å¼ºåŠŸèƒ½ï¼Œå…¶ä¸­ 14 ä¸ªå·²ç» stable ï¼Œ4 ä¸ª beta ä»¥åŠå‰©ä½™ 4 ä¸ª alpha ã€‚

- [#87714](https://github.com/kubernetes/kubernetes/pull/87714) kubectl çš„ `--server-dry-run` è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä½¿ç”¨ `--dry-run=server` æ›¿ä»£ã€‚å¹¶ä¸” kubectl çš„ `--dry-run` å‚æ•°æ¥æ”¶çš„å€¼ï¼Œä¹Ÿå˜æˆäº† `client`, `server` ä»¥åŠ `none`ï¼›
- [#86810](https://github.com/kubernetes/kubernetes/pull/86810) `kubeadm config images list` å®ç°äº†ç»“æ„åŒ–è¾“å‡ºï¼Œæ”¯æŒæ–‡æœ¬ï¼ŒJSONï¼ŒYAML å’Œ GO æ¨¡æ¿ç­‰ã€‚ï¼ˆæˆ‘ä¸ªäººè®¤ä¸ºï¼Œè¿™ä¸ªåŠŸèƒ½ä¸é”™çš„ï¼Œä½†ç›®å‰æˆ‘è¿˜æ²¡æƒ³åˆ°ä»€ä¹ˆæƒ…å†µä¸‹æˆ‘ä¼šéœ€è¦å®ƒï¼‰ï¼›
- [#87975](https://github.com/kubernetes/kubernetes/pull/87975) `kubeadm upgrade node config` ä» v1.15 èµ·æ ‡è®°åºŸå¼ƒï¼Œç°åœ¨æ­£å¼ç§»é™¤ï¼Œè¯·ä½¿ç”¨ `kubeadm upgrade node phase kubelet-config` ä»£æ›¿ã€‚

``å…³äºä¸Šæœ‰è¿›å±•å¼•ç”¨è‡ª`` [K8sç”Ÿæ€å‘¨æŠ¥](https://moelove.info/) ï¼Œæ¨èå„ä½å»å…³æ³¨ã€‚

## èŠ‚ç‚¹ OS

### [Photon OS](https://vmware.github.io/photon/)

#### ç‰¹æ€§

Photon OS æ˜¯ VMware å›¢é˜Ÿå¯¹ vSphere ESXi è™šæ‹ŸåŒ–å¹³å°ä¸“é—¨æ‰“é€ çš„å®¹å™¨ä¼˜åŒ–å‹æ“ä½œç³»ç»Ÿï¼Œä»ç›®å‰çš„ä½¿ç”¨æ¥çœ‹æ˜¯åŸºäº RHEL æˆ– CentOS ç³»çš„å‘è¡Œç‰ˆã€‚é’ˆå¯¹ ESXi è™šæ‹Ÿèƒ¡ä¼˜åŒ–å†…æ ¸ï¼Œç†è®ºä¸Šåœ¨ vSphere ESXi è™šæ‹ŸåŒ–ä¸Š Photon OS è¦æ¯”ä¼ ç»Ÿçš„ CentOS/Ubuntu å‘è¡Œç‰ˆæ€§èƒ½è¦å¥½ä¸€äº›ï¼Œç³»ç»Ÿå ç”¨çš„èµ„æºä¹Ÿå°‘ä¸€äº›ã€‚å¦å¤– Photon OS V3.0 çš„å†…æ ¸æ˜¯ 4.19 ç‰ˆæœ¬çš„ï¼Œä½¿ç”¨æ–¹å¼å’Œ CentOS å·®åˆ«ä¸å¤§ã€‚

> Photon OSâ„¢ is an open source Linux container host optimized for cloud-native applications, cloud platforms, and VMware infrastructure. Photon OS provides a secure run-time environment for efficiently running containers. Some of the key highlights of Photon OS are:
>
> - Optimized for VMware hypervisor: The Linux kernel is tuned for performance when Photon OS runs on VMware ESXi.
> - Support for containers: Photon OS includes the Docker daemon and works with container orchestration frameworks, such as Mesos and Kubernetes.
> - Efficient lifecycle management: Photon OS is easy to manage, patch, and update, using the [tdnf package manager](https://github.com/vmware/photon/blob/master/docs/photon-admin-guide.md#tiny-dnf-for-package-management) and the [Photon Management Daemon (pmd)](https://github.com/vmware/pmd).
> - Security hardened: Photon OS provides secure and up-to-date kernel and other packages, and its policies are designed to govern the system securely.
>
> For an overview of Photon OS, see https://vmware.github.io/photon/

### [CoreOS](https://coreos.com/)

CoreOS æ˜¯ä»¥å®‰å…¨æ€§ã€ä¸€è‡´æ€§ã€å¯é æ€§ä¸ºè®¾è®¡ç›®æ ‡çš„ä¸€æ¬¾æ“ä½œç³»ç»Ÿã€‚å› ä¸ºCoreOSçš„è®¾è®¡åˆè¡·åªä¸ºè¿è¡Œåº”ç”¨å®¹å™¨ï¼Œå› æ­¤éœ€è¦å®‰è£…å¾ˆå°‘ç³»ç»Ÿçº§åˆ«çš„ä¾èµ–åŒ…å³å¯ã€‚ç›¸æ¯”å…¸å‹çš„LinuxæœåŠ¡å™¨ï¼Œè¿™å°±æ„å‘³ç€CoreOSéœ€è¦å¾ˆä½è€—çš„CPUå’Œé«˜æ•ˆçš„RAMå³å¯æ»¡è¶³éœ€æ±‚ã€‚CoreOS å‡ ä¹å¯ä»¥è¿è¡Œåœ¨åŒ…æ‹¬ [Vagrant](https://coreos.com/products/), [Amazon EC2](https://coreos.com/os/docs/latest/booting-on-ec2.html), [QEMU/KVM](https://coreos.com/docs/qemu/), [VMware](https://coreos.com/docs/vmware/), [OpenStack](https://coreos.com/docs/openstack/) çš„ä»»ä½•å¹³å°ï¼Œç”šè‡³åœ¨æœªå®‰è£…ä»»ä½•è½¯ä»¶çš„è£¸æœºç¡¬ä»¶ç¯å¢ƒéƒ½å¯ä»¥ã€‚

- æœ€å°åŒ–æ“ä½œç³»ç»Ÿï¼šCoreOS è¢«è®¾è®¡æˆä¸€ä¸ªåŸºäºå®¹å™¨çš„æœ€å°åŒ–çš„ç°ä»£æ“ä½œç³»ç»Ÿã€‚å®ƒæ¯”ç°æœ‰çš„ Linux å®‰è£…å¹³å‡èŠ‚çœ 40% çš„ RAMï¼ˆå¤§çº¦ 114M ï¼‰å¹¶å…è®¸ä» PXE æˆ– iPXE éå¸¸å¿«é€Ÿçš„å¯åŠ¨ã€‚
- CoreOS é‡‡ç”¨ä¸»åŠ¨/è¢«åŠ¨åŒåˆ†åŒºæ–¹æ¡ˆæ¥å®ç°è‡ªåŠ¨æ›´æ–°ã€‚è‡ªåŠ¨æ›´æ–°ä»¥å•ä¸€ä½“ä¸ºå•ä½ï¼Œè€Œä¸æ˜¯é€šè¿‡é€åŒ…æ›¿æ¢çš„æ–¹å¼è¿›è¡Œã€‚ç¨åæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»è¿™ä¸ªã€‚
- CoreOS ä½¿ç”¨ Linux å®¹å™¨åœ¨æ›´é«˜æŠ½è±¡å±‚æ¬¡ä¸Šç®¡ç†æœåŠ¡ï¼Œè€Œæ²¡æœ‰é‡‡ç”¨é€šè¿‡ yum æˆ–è€… APT å·¥å…·åšåŒ…çš„å®‰è£…ç®¡ç†ã€‚å•ä¸€çš„æœåŠ¡ä»£ç ä»¥åŠå®ƒæ‰€æœ‰çš„ä¾èµ–ä¼šè¢«æ‰“åŒ…åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œæ‰“åŒ…è¿›å…¥å®¹å™¨åå°±å¯ä»¥è¿è¡Œåœ¨å•ä¸€çš„CoreOS æœºå™¨ï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨ CoreOS é›†ç¾¤ä¸­ã€‚
- Linux å®¹å™¨æä¾›ä¸å®Œæ•´è™šæ‹Ÿæœºç›¸ä¼¼çš„åŠŸèƒ½ã€‚ä½†æ˜¯å®¹å™¨èšç„¦åœ¨åº”ç”¨ç¨‹åºå±‚æ¬¡ï¼Œè€Œä¸æ˜¯æ•´ä¸ªè™šæ‹Ÿä¸»æœºå±‚æ¬¡ã€‚å› ä¸ºå®¹å™¨ä¸èƒ½è¿è¡Œç‹¬ç«‹çš„Linuxå†…æ ¸ï¼Œä¸éœ€è¦ä¸€ä¸ªä¸­é—´ä»¶å±‚ï¼Œå› æ­¤å®ƒå‡ ä¹æ²¡æœ‰æ€§èƒ½ä¸Šçš„å¼€é”€ã€‚ä½æ€§èƒ½å¼€é”€çš„ç‰¹è´¨æ„å‘³ç€å¯ä»¥éƒ¨ç½²æ›´å°‘çš„æœºå™¨ã€ä½¿ç”¨é…ç½®ä½çš„æœºå™¨å°±å¯ä»¥å®Œæˆè™šæ‹ŸæœºåŒæ ·çš„åŠŸèƒ½ï¼Œä»è€Œé™ä½æˆæœ¬ã€‚

### Rancher OS

RancherOS æ˜¯ Rancher å›¢é˜Ÿæ‰€ç»´æŠ¤çš„å¼€æºé¡¹ç›®ï¼Œä¹Ÿæ˜¯å¯¹æ ‡ CoreOS ä¸€æ ·ï¼Œä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆè‡³å°‘å®˜æ–¹åšäº†è¿™ä¹ˆæ ·çš„æ‰¿è¯ºï¼Œå’±ä¹Ÿæ²¡åœ¨ç”Ÿäº§ç”¨è¿‡ï¼Œä¸å¥½è¯´ã€‚åœ¨ RancherOS ä¸­æ‰€æœ‰çš„è¿›ç¨‹ï¼ˆåŒ…æ‹¬ç³»ç»Ÿæ‰€æœ‰çš„æœåŠ¡ï¼Œæ¯”å¦‚ udev å’Œ syslogï¼‰éƒ½æ˜¯ç”¨ docker æ¥ç®¡ç†ï¼Œè¿™ä¸€ç‚¹è¦æ¯” CoreOS æ›´åŠ æ¿€è¿›ä¸€äº›ï¼Œè€Œ CoreOS è¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­çš„ systemd æ¥ç®¡ç†ç³»ç»Ÿä¸­çš„æœåŠ¡ã€‚é€šè¿‡ç§»é™¤ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­ä¸å¿…è¦çš„æœåŠ¡å’Œåº“æ¥æœ€å°åŒ–ç³»ç»Ÿï¼Œä½¿ä»–ä¸“æ³¨å•ä¸€çš„åŠŸèƒ½ï¼Œå³è¿è¡Œ docker å®¹å™¨ã€‚

> RancherOS is the smallest, easiest way to run Docker in production. Every process in RancherOS is a container managed by Docker. This includes system services such as `udev` and `syslog`. Because it only includes the services necessary to run Docker, RancherOS is significantly smaller than most traditional operating systems. By removing unnecessary libraries and services, requirements for security patches and other maintenance are also reduced. This is possible because, with Docker, users typically package all necessary libraries into their containers.
>
> Another way in which RancherOS is designed specifically for running Docker is that it always runs the latest version of Docker. This allows users to take advantage of the latest Docker capabilities and bug fixes.
>
> Like other minimalist Linux distributions, RancherOS boots incredibly quickly. Starting Docker containers is nearly instant, similar to starting any other process. This speed is ideal for organizations adopting microservices and autoscaling.
>
> Docker is an open-source platform designed for developers, system admins, and DevOps. It is used to build, ship, and run containers, using a simple and powerful command line interface (CLI). To get started with Docker, please visit the [Docker user guide](https://docs.docker.com/engine/userguide/).

## é«˜å¯ç”¨æ¶æ„

### å‚è€ƒ

- [å…³äºKubernetes Masteré«˜å¯ç”¨çš„ä¸€äº›ç­–ç•¥](https://jishu.io/kubernetes/kubernetes-master-ha/)

è¿™å¼ å›¾ä»ç®¡ç†å¹³é¢ã€æ‰§è¡Œå¹³é¢å’Œæ•°æ®å¹³é¢ ä¸‰ä¸ªéƒ¨åˆ†æ¥ç®€å•è¯´æ˜ä¸€ä¸‹è¯¥é«˜å¯ç”¨æ¶æ„æ–¹æ¡ˆä»¥åŠå„ä¸ªç»„ä»¶çš„åŠŸèƒ½ã€‚

![](https://p.k8s.li/20191227151129673.png)

### etcd é«˜å¯ç”¨

etcd æ˜¯ Kubernetes å½“ä¸­å”¯ä¸€å¸¦çŠ¶æ€çš„æœåŠ¡ï¼Œä¹Ÿæ˜¯é«˜å¯ç”¨çš„éš¾ç‚¹ã€‚Kubernetes é€‰ç”¨ etcd ä½œä¸ºå®ƒçš„åç«¯æ•°æ®å­˜å‚¨ä»“åº“æ­£æ˜¯çœ‹é‡äº†å…¶ä½¿ç”¨åˆ†å¸ƒå¼æ¶æ„ï¼Œæ²¡æœ‰å•ç‚¹æ•…éšœçš„ç‰¹æ€§ã€‚etcd çš„é«˜å¯ç”¨åŸºæœ¬æœ‰ä¸‰ç§æ€è·¯ï¼š

#### ç‹¬ç«‹çš„ etcd é›†ç¾¤

ä½¿ç”¨ 3 å°æˆ–è€… 5 å°æœåŠ¡å™¨åªè¿è¡Œ etcdï¼Œç‹¬ç«‹ç»´æŠ¤å’Œå‡çº§ã€‚ç”šè‡³å¯ä»¥ä½¿ç”¨ CoreOS çš„`update-engine`å’Œ`locksmith`ï¼Œè®©æœåŠ¡å™¨å®Œå…¨è‡ªä¸»çš„å®Œæˆå‡çº§ã€‚è¿™ä¸ª etcd é›†ç¾¤å°†ä½œä¸ºåŸºçŸ³ç”¨äºæ„å»ºæ•´ä¸ªé›†ç¾¤ã€‚ é‡‡ç”¨è¿™é¡¹ç­–ç•¥çš„ä¸»è¦åŠ¨æœºæ˜¯ etcd é›†ç¾¤çš„èŠ‚ç‚¹å¢å‡éƒ½éœ€è¦æ˜¾å¼çš„é€šçŸ¥é›†ç¾¤ï¼Œä¿è¯ etcd é›†ç¾¤èŠ‚ç‚¹ç¨³å®šå¯ä»¥æ›´æ–¹ä¾¿çš„ç”¨ç¨‹åºå®Œæˆé›†ç¾¤æ»šåŠ¨å‡çº§ï¼Œå‡è½»ç»´æŠ¤è´Ÿæ‹…ã€‚

#### Master èŠ‚ç‚¹ static pod å½¢å¼

äºŒæ˜¯åœ¨ Kubernetes Masterä¸Šç”¨ static pod çš„å½¢å¼æ¥è¿è¡Œ etcdï¼Œå¹¶å°†å¤šå° Kubernetes Masterä¸Šçš„ etcd ç»„æˆé›†ç¾¤ã€‚ åœ¨è¿™ä¸€æ¨¡å¼ä¸‹ï¼Œå„ä¸ªæœåŠ¡å™¨çš„ etcd å®ä¾‹è¢«æ³¨å†Œè¿›äº† Kubernetes å½“ä¸­ï¼Œè™½ç„¶æ— æ³•ç›´æ¥ä½¿ç”¨`kubectl`æ¥ç®¡ç†è¿™éƒ¨åˆ†å®ä¾‹ï¼Œä½†æ˜¯ç›‘æ§ä»¥åŠæ—¥å¿—æœé›†ç»„ä»¶å‡å¯æ­£å¸¸å·¥ä½œã€‚åœ¨è¿™ä¸€æ¨¡å¼è¿è¡Œä¸‹çš„ etcd å¯ç®¡ç†æ€§æ›´å¼ºã€‚

#### self-hosted etcdæ–¹æ¡ˆ

ä¸‰æ˜¯ä½¿ç”¨ CoreOS æå‡ºçš„ [self-hosted etcdæ–¹æ¡ˆ](https://github.com/kubernetes-incubator/bootkube/issues/31)ï¼Œå°†æœ¬åº”åœ¨åº•å±‚ä¸º Kubernetes æä¾›æœåŠ¡çš„ etcd è¿è¡Œåœ¨Kubernetes ä¹‹ä¸Šã€‚ å®ç° Kubernetes å¯¹è‡ªèº«ä¾èµ–ç»„ä»¶çš„ç®¡ç†ã€‚åœ¨è¿™ä¸€æ¨¡å¼ä¸‹çš„ etcd é›†ç¾¤å¯ä»¥ç›´æ¥ä½¿ç”¨ [etcd-operator](https://github.com/coreos/etcd-operator) æ¥è‡ªåŠ¨åŒ–è¿ç»´ï¼Œæœ€ç¬¦åˆ Kubernetes çš„ä½¿ç”¨ä¹ æƒ¯ã€‚

è¿™ä¸‰ç§æ€è·¯å‡å¯ä»¥å®ç° etcd é«˜å¯ç”¨çš„ç›®æ ‡ï¼Œä½†æ˜¯åœ¨é€‰æ‹©è¿‡ç¨‹ä¸­å´è¦æ ¹æ®å®é™…æƒ…å†µåšå‡ºä¸€äº›åˆ¤æ–­ã€‚ç®€å•æ¥è®²ç¡¬ä»¶èµ„æºå……è¶³ä½†ä¿å®ˆçš„é¡¹ç›®é€‰æ–¹æ¡ˆä¸€ï¼Œ æƒ³ä¸€æ­¥åˆ°ä½å¹¶æ„¿æ„æ‰¿æ‹…ä¸€å®šé£é™©çš„é¡¹ç›®é€‰æ–¹æ¡ˆä¸‰ã€‚æŠ˜ä¸­ä¸€ç‚¹é€‰æ–¹æ¡ˆäºŒã€‚

### kube-apiserver  é«˜å¯ç”¨

apiserver æœ¬èº«æ˜¯ä¸€ä¸ªæ— çŠ¶æ€æœåŠ¡ï¼Œè¦å®ç°å…¶é«˜å¯ç”¨ç›¸å¯¹è¦å®¹æ˜“ä¸€äº›ï¼Œéš¾ç‚¹åœ¨äºå¦‚ä½•å°†è¿è¡Œåœ¨å¤šå°æœåŠ¡å™¨ä¸Šçš„apiserver ç”¨ä¸€ä¸ªç»Ÿä¸€çš„å¤–éƒ¨å…¥å£æš´éœ²ç»™æ‰€æœ‰NodeèŠ‚ç‚¹ã€‚

è¯´æ˜¯éš¾ç‚¹ï¼Œå…¶å®å¯¹äºè¿™ç§æ— çŠ¶æ€æœåŠ¡çš„é«˜å¯ç”¨ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡ä¸šåŠ¡ç³»ç»Ÿçš„é«˜å¯ç”¨æ–¹æ¡ˆæ—¶å·²ç»æœ‰äº†ç›¸å½“å¤šçš„ç»éªŒç§¯ç´¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ apiserver æ‰€ä½¿ç”¨çš„ SSL è¯ä¹¦è¦åŒ…å«å¤–éƒ¨å…¥å£çš„åœ°å€ï¼Œä¸ç„¶ Node èŠ‚ç‚¹æ— æ³•æ­£å¸¸è®¿é—® apiserverã€‚

apiserver çš„é«˜å¯ç”¨ä¹Ÿæœ‰ä¸‰ç§åŸºæœ¬æ€è·¯ï¼š

#### ä½¿ç”¨å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨

ä¸€æ˜¯ä½¿ç”¨å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨å…¬æœ‰äº‘æä¾›çš„è´Ÿè½½å‡è¡¡å™¨æœåŠ¡æˆ–æ˜¯åœ¨ç§æœ‰äº‘ä¸­ä½¿ç”¨`LVS`æˆ–è€…`HaProxy`è‡ªå»ºè´Ÿè½½å‡è¡¡å™¨éƒ½å¯ä»¥å½’åˆ°è¿™ä¸€ç±»ã€‚ è´Ÿè½½å‡è¡¡å™¨æ˜¯éå¸¸æˆç†Ÿçš„æ–¹æ¡ˆï¼Œåœ¨è¿™é‡Œç•¥è¿‡ä¸åšè¿‡å¤šä»‹ç»ã€‚å¦‚ä½•ä¿è¯è´Ÿè½½å‡è¡¡å™¨çš„é«˜å¯ç”¨ï¼Œåˆ™æ˜¯é€‰æ‹©è¿™ä¸€æ–¹æ¡ˆéœ€è¦è€ƒè™‘çš„æ–°é—®é¢˜ã€‚

#### åœ¨ç½‘ç»œå±‚åšè´Ÿè½½å‡è¡¡

äºŒæ˜¯åœ¨ç½‘ç»œå±‚åšè´Ÿè½½å‡è¡¡ã€‚æ¯”å¦‚åœ¨ Master èŠ‚ç‚¹ä¸Šç”¨`BGP`åš`ECMP`ï¼Œæˆ–è€…åœ¨NodeèŠ‚ç‚¹ä¸Šç”¨`iptables`åšNATéƒ½å¯ä»¥å®ç°ã€‚é‡‡ç”¨è¿™ä¸€æ–¹æ¡ˆä¸éœ€è¦é¢å¤–çš„å¤–éƒ¨æœåŠ¡ï¼Œä½†æ˜¯å¯¹ç½‘ç»œé…ç½®æœ‰ä¸€å®šçš„è¦æ±‚ã€‚

#### åœ¨ Node èŠ‚ç‚¹ä¸Šä½¿ç”¨åå‘ä»£ç†å¯¹å¤šä¸ª Master åšè´Ÿè½½å‡è¡¡

ä¸‰æ˜¯åœ¨ Node èŠ‚ç‚¹ä¸Šä½¿ç”¨åå‘ä»£ç†å¯¹å¤šä¸ª Master åšè´Ÿè½½å‡è¡¡ã€‚è¿™ä¸€æ–¹æ¡ˆåŒæ ·ä¸éœ€è¦ä¾èµ–å¤–éƒ¨çš„ç»„ä»¶ï¼Œä½†æ˜¯å½“Master èŠ‚ç‚¹æœ‰å¢å‡æ—¶ï¼Œå¦‚ä½•åŠ¨æ€é…ç½® Node èŠ‚ç‚¹ä¸Šçš„è´Ÿè½½å‡è¡¡å™¨æˆä¸ºäº†å¦å¤–ä¸€ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜ã€‚

ä»ç›®å‰å„ä¸ªé›†ç¾¤ç®¡ç†å·¥å…·çš„é€‰æ‹©æ¥çœ‹ï¼Œè¿™ä¸‰ç§æ¨¡å¼éƒ½æœ‰è¢«ä½¿ç”¨ï¼Œç›®å‰è¿˜æ²¡æœ‰æ˜ç¡®çš„æ¨èæ–¹æ¡ˆäº§ç”Ÿã€‚å»ºè®®åœ¨å…¬æœ‰äº‘ä¸Šçš„é›†ç¾¤å¤šè€ƒè™‘ç¬¬ä¸€ç§æ¨¡å¼ï¼Œåœ¨ç§æœ‰äº‘ç¯å¢ƒä¸­ç”±äºç»´æŠ¤é¢å¤–çš„è´Ÿè½½å‡è¡¡å™¨ä¹Ÿæ˜¯ä¸€é¡¹è´Ÿæ‹…ï¼Œå»ºè®®è€ƒè™‘ç¬¬äºŒç§æˆ–æ˜¯ç¬¬ä¸‰ç§æ–¹æ¡ˆã€‚

### Kube-dns  é«˜å¯ç”¨

ä¸¥æ ¼æ¥è¯´ kube-dns å¹¶ä¸ç®—æ˜¯ Master ç»„ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒæ˜¯å¯ä»¥è·‘åœ¨ Node èŠ‚ç‚¹ä¸Šï¼Œå¹¶ç”¨`Service`å‘é›†ç¾¤å†…éƒ¨æä¾›æœåŠ¡çš„ã€‚ä½†åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œ ç”±äºé»˜è®¤é…ç½®åªè¿è¡Œäº†ä¸€ä»½ kube-dns å®ä¾‹ï¼Œåœ¨å…¶å‡çº§æˆ–æ˜¯æ‰€åœ¨èŠ‚ç‚¹å½“æœºæ—¶ï¼Œä¼šå‡ºç°é›†ç¾¤å†…éƒ¨ dns æœåŠ¡ä¸å¯ç”¨çš„æƒ…å†µï¼Œä¸¥é‡æ—¶ä¼šå½±å“åˆ°çº¿ä¸ŠæœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚

ä¸ºäº†é¿å…æ•…éšœï¼Œè¯·å°† kube-dns çš„`replicas`å€¼è®¾ä¸º 2 æˆ–è€…æ›´å¤šï¼Œå¹¶ç”¨`anti-affinity`å°†ä»–ä»¬éƒ¨ç½²åœ¨ä¸åŒçš„ Node èŠ‚ç‚¹ä¸Šã€‚è¿™é¡¹æ“ä½œæ¯”è¾ƒå®¹æ˜“è¢«ç–å¿½ï¼Œç›´åˆ°å‡ºç°æ•…éšœæ—¶æ‰å‘ç°åŸæ¥æ˜¯ kube-dns åªè¿è¡Œäº†ä¸€ä»½å®ä¾‹å¯¼è‡´çš„æ•…éšœã€‚

### kube-controller-manager ä¸ kube-scheduleré«˜å¯ç”¨

è¿™ä¸¤é¡¹æœåŠ¡æ˜¯ Master èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†ï¼Œä»–ä»¬çš„é«˜å¯ç”¨ç›¸å¯¹å®¹æ˜“ï¼Œä»…éœ€è¦è¿è¡Œå¤šä»½å®ä¾‹å³å¯ã€‚è¿™äº›å®ä¾‹ä¼šé€šè¿‡å‘ apiserver ä¸­çš„`Endpoint`åŠ é”çš„æ–¹å¼æ¥è¿›è¡Œ leader electionï¼Œ å½“ç›®å‰æ‹¿åˆ° leader çš„å®ä¾‹æ— æ³•æ­£å¸¸å·¥ä½œæ—¶ï¼Œåˆ«çš„å®ä¾‹ä¼šæ‹¿åˆ°é”ï¼Œå˜ä¸ºæ–°çš„leaderã€‚

ç›®å‰åœ¨å¤šä¸ª Master èŠ‚ç‚¹ä¸Šé‡‡ç”¨ static pod æ¨¡å¼éƒ¨ç½²è¿™ä¸¤é¡¹æœåŠ¡çš„æ–¹æ¡ˆæ¯”è¾ƒå¸¸è§ï¼Œæ¿€è¿›ä¸€ç‚¹ä¹Ÿå¯ä»¥é‡‡ç”¨ self-hosted çš„æ¨¡å¼ï¼Œåœ¨ Kubernetes ä¹‹ä¸Šç”¨`DaemonSet`æˆ–è€…`Deployment`æ¥éƒ¨ç½²ã€‚

## ç½‘ç»œæ’ä»¶

### å‚è€ƒ

- [kubernetes flannelä»£ç è§£æ](https://ieevee.com/tech/2017/08/12/k8s-flannel-src.html)
- [flannel æºç åˆ†æ](https://cizixs.com/2016/07/16/flannel-source-code-insight/)
- [æŠ€æœ¯å¹²è´§|æ·±å…¥ç†è§£flannel](http://www.sel.zju.edu.cn/?p=690)
- [DockOneæŠ€æœ¯åˆ†äº«ï¼ˆåå…«ï¼‰ï¼šä¸€ç¯‡æ–‡ç« å¸¦ä½ äº†è§£Flannel](http://dockone.io/article/618)
- [è˜‘è‡è¡— K8S ä¸ºä»€ä¹ˆä¸é€‰æ‹© flannel ç½‘ç»œæ¨¡å‹](http://wsfdl.com/kubernetes/2018/07/09/why_not_flanneld.html)
- [flannel ç½‘ç»œæ¶æ„](https://ggaaooppeenngg.github.io/zh-CN/2017/09/21/flannel-%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/)
- [kubernetsçš„ç½‘ç»œæ’ä»¶ï¼šflannel](https://ieevee.com/tech/2017/01/18/k8s-flannel.html#k8s%E7%9A%84flannel%E6%A8%A1%E5%BC%8F)
- [docker å®¹å™¨ç½‘ç»œæ–¹æ¡ˆï¼šcalico ç½‘ç»œæ¨¡å‹](https://cizixs.com/2017/10/19/docker-calico-network/)
- [Calico éƒ¨ç½²è¸©å‘è®°å½•](https://mritd.me/2017/07/31/calico-yml-bug/)
- [Battlefield: Calico, Flannel, Weave and Docker Overlay Network](https://chunqi.li/2015/11/15/Battlefield-Calico-Flannel-Weave-and-Docker-Overlay-Network/#Conclusion)
- [Calico: A Solution of Multi-host Network For Docker](https://chunqi.li/2015/09/06/calico-docker/)
- [Calicoç½‘ç»œçš„åŸç†ã€ç»„ç½‘æ–¹å¼ä¸ä½¿ç”¨](https://www.lijiaocn.com/%E9%A1%B9%E7%9B%AE/2017/04/11/calico-usage.html)

### é™æ€è·¯ç”±

äº‹å…ˆè®¾ç½®å¥½è·¯ç”±å™¨å’Œä¸»æœºä¸­çš„è·¯ç”±è¡¨ä¿¡æ¯ï¼Œç½‘ç»œæ€§èƒ½æœ€ä½³çš„æ–¹æ¡ˆï¼Œä½†ä¸ä¾¿äºç®¡ç†è·¯ç”±è¡¨ã€‚

### [flannel](https://github.com/coreos/flannel)

- Flannel æ˜¯ CoreOS å›¢é˜Ÿé’ˆå¯¹ Kubernetes è®¾è®¡çš„ä¸€ä¸ªç½‘ç»œè§„åˆ’æœåŠ¡ï¼Œç®€å•æ¥è¯´ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯è®©é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸»æœºåˆ›å»ºçš„ Docker å®¹å™¨éƒ½å…·æœ‰å…¨é›†ç¾¤å”¯ä¸€çš„è™šæ‹ŸIPåœ°å€ã€‚
- åœ¨é»˜è®¤çš„ Docker é…ç½®ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ Docker æœåŠ¡ä¼šåˆ†åˆ«è´Ÿè´£æ‰€åœ¨èŠ‚ç‚¹å®¹å™¨çš„IPåˆ†é…ã€‚è¿™æ ·å¯¼è‡´çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸åŒèŠ‚ç‚¹ä¸Šå®¹å™¨å¯èƒ½è·å¾—ç›¸åŒçš„å†…å¤– IP åœ°å€ã€‚å¹¶ä½¿è¿™äº›å®¹å™¨ä¹‹é—´èƒ½å¤Ÿä¹‹é—´é€šè¿‡IPåœ°å€ç›¸äº’æ‰¾åˆ°ï¼Œä¹Ÿå°±æ˜¯ç›¸äº’ ping é€šã€‚
- Flannel çš„è®¾è®¡ç›®çš„å°±æ˜¯ä¸ºé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹é‡æ–°è§„åˆ’ IP åœ°å€çš„ä½¿ç”¨è§„åˆ™ï¼Œä»è€Œä½¿å¾—ä¸åŒèŠ‚ç‚¹ä¸Šçš„å®¹å™¨èƒ½å¤Ÿè·å¾—â€œåŒå±ä¸€ä¸ªå†…ç½‘â€ä¸”â€ä¸é‡å¤çš„â€ IP åœ°å€ï¼Œå¹¶è®©å±äºä¸åŒèŠ‚ç‚¹ä¸Šçš„å®¹å™¨èƒ½å¤Ÿç›´æ¥é€šè¿‡å†…ç½‘ IP é€šä¿¡ã€‚
- Flannel å®è´¨ä¸Šæ˜¯ä¸€ç§â€œè¦†ç›–ç½‘ç»œï¼ˆoverlaynetworkï¼‰â€ï¼Œä¹Ÿå°±æ˜¯å°†TCPæ•°æ®åŒ…è£…åœ¨å¦ä¸€ç§ç½‘ç»œåŒ…é‡Œé¢è¿›è¡Œè·¯ç”±è½¬å‘å’Œé€šä¿¡ï¼Œç›®å‰å·²ç»æ”¯æŒ UDPã€VXLANã€host-gwã€aws-vpcã€GCE å’Œ Alloc è·¯ç”±ç­‰æ•°æ®è½¬å‘æ–¹å¼ï¼Œé»˜è®¤çš„èŠ‚ç‚¹é—´æ•°æ®é€šä¿¡æ–¹å¼æ˜¯ UDP è½¬å‘ã€‚

#### hostgw æ¨¡å¼

æ€§èƒ½æœ€é«˜ï¼ŒåŸç†éå¸¸ç®€å•ï¼Œç›´æ¥æ·»åŠ è·¯ç”±ï¼Œå°†ç›®çš„ä¸»æœºå½“åšç½‘å…³ï¼Œç›´æ¥è·¯ç”±åŸå§‹å°åŒ…ã€‚è¿™æ­£æ˜¯ host-gw çš„å«ä¹‰ã€‚æ‰€æœ‰çš„å­ç½‘å’Œä¸»æœºçš„ä¿¡æ¯ï¼Œéƒ½ä¿å­˜åœ¨ etcd ä¸­ï¼Œflanneld åªéœ€è¦ watch è¿™äº›æ•°æ®çš„å˜åŒ– ï¼Œå®æ—¶æ›´æ–°è·¯ç”±è¡¨å°±è¡Œäº†ã€‚ æ ¸å¿ƒæ˜¯ IP åŒ…åœ¨å°è£…æˆæ¡¢çš„æ—¶å€™ï¼Œä½¿ç”¨è·¯ç”±è¡¨çš„â€œä¸‹ä¸€è·³â€è®¾ç½®ä¸Šçš„ MAC åœ°å€ï¼Œè¿™æ ·å¯ä»¥ç»è¿‡äºŒå±‚ç½‘ç»œåˆ°è¾¾ç›®çš„å®¿ä¸»æœºã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä» etcd ä¸­ç›‘å¬åˆ°ä¸€ä¸ª Event Added äº‹ä»¶ subnet ä¸º 10.1.15.0/24 è¢«åˆ†é…ç»™ä¸»æœº Public IP 192.168.0.100ï¼Œhostgw è¦åšçš„å·¥ä½œå°±æ˜¯åœ¨æœ¬ä¸»æœºä¸Šæ·»åŠ ä¸€æ¡ç›®çš„åœ°å€ä¸º 10.1.15.0/24ï¼Œç½‘å…³åœ°å€ä¸º192.168.0.100ï¼Œè¾“å‡ºè®¾å¤‡ä¸ºä¸Šæ–‡ä¸­é€‰æ‹©çš„é›†ç¾¤é—´äº¤äº’çš„ç½‘å¡å³å¯ã€‚å¯¹äº Event Removed äº‹ä»¶ï¼Œåªéœ€åˆ é™¤å¯¹åº”çš„è·¯ç”±ã€‚

#### udp æ¨¡å¼

æ ¸å¿ƒå°±æ˜¯é€šè¿‡ TUN è®¾å¤‡ flannel0 å®ç°ï¼ˆ TUN è®¾å¤‡æ˜¯å·¥ä½œåœ¨ä¸‰å±‚çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼ŒåŠŸèƒ½æ˜¯ï¼šåœ¨æ“ä½œç³»ç»Ÿå†…æ ¸å’Œç”¨æˆ·åº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’ IP åŒ…ï¼‰ç›¸æ¯”ä¸¤å°å®¿ä¸»æœºç›´æ¥é€šä¿¡ï¼Œå¤šå‡ºäº† flanneld çš„å¤„ç†è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ï¼Œä½¿ç”¨äº†flannel0 è¿™ä¸ª TUN è®¾å¤‡ï¼Œä»…åœ¨å‘å‡ºIPåŒ…çš„è¿‡ç¨‹ä¸­å°±è¦ç»è¿‡äº†ä¸‰æ¬¡ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„æ•°æ®æ‹·è´ï¼ˆ linux çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä»£ä»·æ¯”è¾ƒå¤§ï¼‰ï¼Œæ‰€ä»¥æ€§èƒ½éå¸¸å·®ã€‚

#### vxlan æ¨¡å¼

VXLANï¼Œå³ Virtual Extensible LANï¼ˆè™šæ‹Ÿå¯æ‰©å±•å±€åŸŸç½‘ï¼‰ï¼Œæ˜¯ Linux æœ¬èº«æ”¯æŒçš„ä¸€ç½‘ç§ç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ã€‚VXLAN å¯ä»¥å®Œå…¨åœ¨å†…æ ¸æ€å®ç°å°è£…å’Œè§£å°è£…å·¥ä½œï¼Œä»è€Œé€šè¿‡â€œéš§é“â€æœºåˆ¶ï¼Œæ„å»ºå‡ºè¦†ç›–ç½‘ç»œï¼ˆOverlay Networkï¼‰

VXLAN çš„è®¾è®¡æ€æƒ³æ˜¯ï¼šåœ¨ç°æœ‰çš„ä¸‰å±‚ç½‘ç»œä¹‹ä¸Šï¼Œâ€œè¦†ç›–â€ä¸€å±‚è™šæ‹Ÿçš„ã€ç”±å†…æ ¸ VXLAN æ¨¡å—è´Ÿè´£ç»´æŠ¤çš„äºŒå±‚ç½‘ç»œï¼Œä½¿å¾—è¿æ¥åœ¨è¿™ä¸ª VXLAN äºŒ nfcu ç½‘ç»œä¸Šçš„â€œä¸»æœºâ€ï¼ˆè™šæ‹Ÿæœºæˆ–å®¹å™¨éƒ½å¯ä»¥ï¼‰ï¼Œå¯ä»¥åƒåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ï¼ˆLANï¼‰é‡Œé‚£æ ·è‡ªç”±é€šä¿¡ã€‚ä¸ºäº†èƒ½å¤Ÿåœ¨äºŒ nfcu ç½‘ç»œä¸Šæ‰“é€šâ€œéš§é“â€ï¼ŒVXLAN ä¼šåœ¨å®¿ä¸»æœºä¸Šè®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„ç½‘ç»œè®¾å¤‡ä½œä¸ºâ€œéš§é“â€çš„ä¸¤ç«¯ï¼Œå«VTEPï¼šVXLAN Tunnel End Pointï¼ˆè™šæ‹Ÿéš§é“ç«¯ç‚¹ï¼‰

### [Calico](https://www.projectcalico.org/)

- Calico æ˜¯ä¸€ä¸ªçº¯ 3 å±‚çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ–¹æ¡ˆï¼Œè€Œä¸”æ— ç¼é›†æˆåƒ OpenStack è¿™ç§ IaaS äº‘æ¶æ„ï¼Œèƒ½å¤Ÿæä¾›å¯æ§çš„VMã€å®¹å™¨ã€è£¸æœºä¹‹é—´çš„IPé€šä¿¡ã€‚Calico ä¸ä½¿ç”¨å åŠ ç½‘ç»œæ¯”å¦‚ Flannel å’Œ Libnetwork å åŠ ç½‘ç»œé©±åŠ¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ–¹æ³•ï¼Œä½¿ç”¨è™šæ‹Ÿè·¯ç”±ä»£æ›¿è™šæ‹Ÿäº¤æ¢ï¼Œæ¯ä¸€å°è™šæ‹Ÿè·¯ç”±é€šè¿‡ BGP åè®®ä¼ æ’­å¯è¾¾ä¿¡æ¯ï¼ˆè·¯ç”±ï¼‰åˆ°å‰©ä½™æ•°æ®ä¸­å¿ƒã€‚
- Calico åœ¨æ¯ä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹åˆ©ç”¨ Linux Kernel å®ç°äº†ä¸€ä¸ªé«˜æ•ˆçš„ vRouter æ¥è´Ÿè´£æ•°æ®è½¬å‘ï¼Œè€Œæ¯ä¸ª vRouter é€šè¿‡ BGP åè®®è´Ÿè´£æŠŠè‡ªå·±ä¸Šè¿è¡Œçš„ workload çš„è·¯ç”±ä¿¡æ¯åƒæ•´ä¸ª Calico ç½‘ç»œå†…ä¼ æ’­â€”â€”å°è§„æ¨¡éƒ¨ç½²å¯ä»¥ç›´æ¥äº’è”ï¼Œå¤§è§„æ¨¡ä¸‹å¯é€šè¿‡æŒ‡å®šçš„ BGP route reflector æ¥å®Œæˆã€‚
- Calico èŠ‚ç‚¹ç»„ç½‘å¯ä»¥ç›´æ¥åˆ©ç”¨æ•°æ®ä¸­å¿ƒçš„ç½‘ç»œç»“æ„ï¼ˆæ— è®ºæ˜¯ L2 æˆ–è€… L3ï¼‰ï¼Œä¸éœ€è¦é¢å¤–çš„ NATï¼Œéš§é“æˆ–è€…Overlay Network ã€‚
- Calico åŸºäº iptables è¿˜æä¾›äº†ä¸°å¯Œè€Œçµæ´»çš„ç½‘ç»œ Policyï¼Œä¿è¯é€šè¿‡å„ä¸ªèŠ‚ç‚¹ä¸Šçš„ ACLs æ¥æä¾› Workload çš„å¤šç§Ÿæˆ·éš”ç¦»ã€å®‰å…¨ç»„ä»¥åŠå…¶ä»–å¯è¾¾æ€§é™åˆ¶ç­‰åŠŸèƒ½ã€‚

### [NSX-T](https://docs.vmware.com/cn/VMware-NSX-T-Data-Center/index.html)

ä¸»è¦é€‚ç”¨äº vSphere è™šæ‹ŸåŒ–å¹³å°ï¼ŒESXi è™šæ‹ŸåŒ–çš„ä¸äºŒä¹‹é€‰ã€‚ä»¥ä¸‹å†…å®¹æ‘˜è‡ªå®˜æ–¹æ–‡æ¡£ [é€‚ç”¨äº Kubernetes å’Œ Cloud Foundry çš„ NSX Container Plug-in - å®‰è£…å’Œç®¡ç†æŒ‡å—](https://docs.vmware.com/cn/VMware-NSX-T-Data-Center/2.4/nsxt_24_ncp_kubernetes.pdf) ã€‚

VMware NSX-Tâ„¢ Data Centerï¼ˆä»¥å‰ç§°ä¸º NSX-Tï¼‰æä¾›äº†ä¸€ä¸ªæ•æ·å¼è½¯ä»¶å®šä¹‰åŸºç¡€æ¶æ„ï¼Œç”¨æ¥æ„å»ºäº‘åŸç”Ÿåº”ç”¨ç¨‹åºç¯å¢ƒã€‚ä¸“æ³¨äºä¸ºå…·æœ‰å¼‚æ„ç«¯ç‚¹ç¯å¢ƒå’ŒæŠ€æœ¯å †æ ˆçš„æ–°å…´åº”ç”¨ç¨‹åºæ¡†æ¶å’Œæ¶æ„æä¾›ç½‘ç»œã€å®‰å…¨å’Œè‡ªåŠ¨åŒ–å¹¶ç®€åŒ–æ“ä½œã€‚NSX-T Data Center æ”¯æŒäº‘åŸç”Ÿåº”ç”¨ç¨‹åºã€è£¸æœºå·¥ä½œè´Ÿè½½ã€å¤šç®¡ç†ç¨‹åºç¯å¢ƒã€å…¬æœ‰äº‘å’Œå¤šä¸ªäº‘ã€‚æ—¨åœ¨ç”±å¼€å‘ç»„ç»‡ç®¡ç†ã€æ“ä½œå’Œä½¿ç”¨ã€‚NSX-T Data Center å…è®¸ IT å’Œå¼€å‘å›¢é˜Ÿé€‰æ‹©æœ€é€‚åˆå…¶åº”ç”¨ç¨‹åºçš„æŠ€æœ¯ã€‚

NSX Container Plug-in(NCP) æä¾› NSX-T Data Center ä¸å®¹å™¨åè°ƒå™¨ï¼ˆå¦‚ Kubernetesï¼‰ä¹‹é—´çš„é›†æˆä»¥åŠ NSX-T Data Center ä¸åŸºäºå®¹å™¨çš„ PaaSï¼ˆå¹³å°å³æœåŠ¡ï¼‰äº§å“ï¼ˆå¦‚ OpenShift å’Œ Pivotal Cloud Foundryï¼‰ä¹‹é—´çš„é›†æˆã€‚NCP çš„ä¸»è¦ç»„ä»¶åœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œå¹¶ä¸ NSX Manager å’Œ Kubernetes æ§åˆ¶å±‚é¢è¿›è¡Œé€šä¿¡ã€‚NCP è°ƒç”¨ NSX API ä»¥ç›‘æ§å¯¹å®¹å™¨å’Œå…¶ä»–èµ„æºçš„æ›´æ”¹ä»¥åŠç®¡ç†ç½‘ç»œèµ„æºï¼Œå¦‚å®¹å™¨çš„é€»è¾‘ç«¯å£ã€äº¤æ¢æœºã€è·¯ç”±å™¨å’Œå®‰å…¨ç»„ã€‚NSX CNI æ’ä»¶åœ¨æ¯ä¸ª Kubernetes èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚å®ƒç›‘æ§å®¹å™¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œå°†å®¹å™¨æ¥å£è¿æ¥åˆ°å®¢æˆ·æœº vSwitchï¼Œå¹¶å¯¹å®¢æˆ·æœº vSwitch è¿›è¡Œç¼–ç¨‹ä»¥æ ‡è®°å’Œè½¬å‘å®¹å™¨æ¥å£å’Œ vNIC ä¹‹é—´çš„å®¹å™¨æµé‡ã€‚

#### åŠŸèƒ½ç‰¹æ€§

- è‡ªåŠ¨ä¸º Kubernetes ç¾¤é›†åˆ›å»º NSX-T Data Center é€»è¾‘æ‹“æ‰‘ï¼Œå¹¶ä¸ºæ¯ä¸ª Kubernetes å‘½åç©ºé—´åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é€»è¾‘ç½‘ç»œã€‚

- å°† Kubernetes pod è¿æ¥åˆ°é€»è¾‘ç½‘ç»œï¼Œå¹¶åˆ†é… IP å’Œ MAC åœ°å€ã€‚
- æ”¯æŒç½‘ç»œåœ°å€è½¬æ¢ (NAT) å¹¶ä¸ºæ¯ä¸ª Kubernetes å‘½åç©ºé—´åˆ†é…ä¸€ä¸ªå•ç‹¬çš„ SNAT IPã€‚
-  ä½¿ç”¨ NSX-T Data Center åˆ†å¸ƒå¼é˜²ç«å¢™å®ç° Kubernetes ç½‘ç»œç­–ç•¥ã€‚
- æ”¯æŒè¾“å…¥å’Œè¾“å‡ºç½‘ç»œç­–ç•¥ã€‚
- æ”¯æŒç½‘ç»œç­–ç•¥ä¸­çš„ IPBlock é€‰æ‹©å™¨ã€‚
- ä¸ºç½‘ç»œç­–ç•¥æŒ‡å®šæ ‡ç­¾é€‰æ‹©å™¨æ—¶ï¼Œæ”¯æŒ matchLabels å’Œ matchExpressionã€‚
- æ”¯æŒåœ¨å…¶ä»–å‘½åç©ºé—´ä¸­é€‰æ‹© podã€‚
- å®ç° ClusterIP ç±»å‹çš„ Kubernetes æœåŠ¡å’Œ LoadBalancer ç±»å‹çš„æœåŠ¡ã€‚
- ä½¿ç”¨ NSX-T ç¬¬ 7 å±‚è´Ÿè½½å¹³è¡¡å™¨å®ç° Kubernetes Ingressã€‚
- é€šè¿‡ TLS Edge ç»ˆæ­¢æ”¯æŒ HTTP Ingress å’Œ HTTPS Ingressã€‚
- æ”¯æŒ Ingress é»˜è®¤åç«¯é…ç½®ã€‚
- æ”¯æŒ Ingress URI é‡å†™ã€‚
- åœ¨ NSX-T Data Center é€»è¾‘äº¤æ¢æœºç«¯å£ä¸Šä¸ºå‘½åç©ºé—´ã€pod åç§°å’Œ pod æ ‡ç­¾åˆ›å»ºæ ‡è®°ï¼Œå¹¶å…è®¸ç®¡ç†å‘˜æ ¹æ®æ ‡è®°å®šä¹‰ NSX-T å®‰å…¨ç»„å’Œç­–ç•¥ã€‚

## æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆ

### å‚è€ƒ

- [GlusterFSå°æ–‡ä»¶åº”ç”¨è°ƒä¼˜ - æŠ€æœ¯ - TaoCloud - è½¯ä»¶å®šä¹‰æ™ºèƒ½å­˜å‚¨](http://www.taocloudx.com/index.php?a=shows&catid=4&id=102)

- [GlusterFSæŠ€æœ¯è¯¦è§£ | Zero's Blog](https://czero000.github.io/2016/04/05/glusterfs-technical-explanation.html)

- [RedHat Cephå­˜å‚¨â€”â€”ã€Šé¢å‘ç”Ÿäº§ç¯å¢ƒçš„Ceph å¯¹è±¡ç½‘å…³æŒ‡å—ã€‹ â€“ Cephå¼€æºç¤¾åŒº](http://ceph.org.cn/2018/06/05/redhat-cephå­˜å‚¨-ã€Šé¢å‘ç”Ÿäº§ç¯å¢ƒçš„ceph-å¯¹è±¡ç½‘å…³æŒ‡å—ã€‹/)

- [cephè¿ç»´å¸¸ç”¨å‘½ä»¤ | å¥‹æ–—çš„æ¾é¼  - blog](http://www.strugglesquirrel.com/2018/03/09/cephè¿ç»´å¸¸ç”¨å‘½ä»¤/)

- [Red Hat Cephå­˜å‚¨â€”ã€Šæ·±å…¥ç†è§£Cephæ¶æ„ã€‹ â€“ Cephå¼€æºç¤¾åŒº](http://ceph.org.cn/2018/06/29/red-hat-cephå­˜å‚¨-ã€Šæ·±å…¥ç†è§£cephæ¶æ„ã€‹/)

- [K8S å­˜å‚¨çš„é‚£ç‚¹äº‹å„¿ï¼š3 ç§ Ceph RBD ç¾å¤‡æ–¹æ¡ˆå¯¹æ¯” â€“ Cephå¼€æºç¤¾åŒº](http://ceph.org.cn/2019/04/29/k8s-å­˜å‚¨çš„é‚£ç‚¹äº‹å„¿ï¼š3-ç§-ceph-rbd-ç¾å¤‡æ–¹æ¡ˆå¯¹æ¯”/)

- [å¦‚ä½•åŸºäº Ceph æ”»ç ´æµ·é‡å°æ–‡ä»¶å­˜å‚¨éš¾é¢˜-è…¾è®¯äº‘èµ„è®¯](https://cloud.tencent.com/info/f66bfb4df31ac6e6c52c0180c02ebcc8.html)

- [æµ·é‡å°æ–‡ä»¶çš„å¼€æºå­˜å‚¨æ–¹æ¡ˆé€‰å‹å»ºè®® - äº‘+ç¤¾åŒº - è…¾è®¯äº‘](https://cloud.tencent.com/developer/news/137215)

- [vSphere Cloud Provider | vSphere Storage for Kubernetes](https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/overview.html#vsphere-storage-concepts)

- [Configuring for VMWare vSphere | Installation and Configuration | OpenShift Container Platform 3.6](https://docs.openshift.com/container-platform/3.6/install_config/configuring_vsphere.html)

- [Using VMware vSphere volumes for persistent storage - Configuring Persistent Storage | Installation and Configuration | OpenShift Container Platform 3.6](https://docs.openshift.com/container-platform/3.6/install_config/persistent_storage/persistent_storage_vsphere.html#install-config-persistent-storage-persistent-storage-vsphere)

- [GlusterFSæ­å»º Â· ç‹åº·å®çš„ç¬”è®° Â· çœ‹äº‘](https://www.kancloud.cn/ningjing_home/ceph/462428)

- [NFSæ€»ç»“ | Win-Man's Blog](https://win-man.github.io/2017/08/25/NFSæ€»ç»“/)

- [çº¢å¸½ Cephå‘å¸ƒæœ€æ–°3.2ç‰ˆæœ¬_åˆ†å¸ƒå¼å­˜å‚¨_ä¸­å›½å­˜å‚¨ç½‘](http://www.chinastor.com/distristor/012J01022019.html)

- [Kubernetes ä½¿ç”¨ Ceph å­˜å‚¨ - æ¼ ç„¶çš„åšå®¢ | mritd Blog](https://mritd.me/2017/06/03/use-ceph-storage-on-kubernetes/)

- [vSphere Storage](https://rancher.com/docs/rancher/v2.x/en/cluster-admin/volumes-and-storage/examples/vsphere/)

### [NFS](https://kubernetes.io/docs/concepts/storage/persistent-volumes/)

### [vSphere vSAN](https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/overview.html)

### [Gluster](https://www.gluster.org/)

### [Ceph](https://ceph.io/)

#### [Rook](https://rook.io/)

## æ—¥å¿—æ–¹æ¡ˆ

### é‡‡é›†æ–¹å¼ï¼š

#### åœ¨å®¿ä¸»æœºä¸Šå®ç°æ—¥å¿—é‡‡é›†

#### åœ¨å®¹å™¨é•œåƒä¸­æ·»åŠ é‡‡é›† Agent

#### åŸºäºSidecaræ—¥å¿—é‡‡é›†æ–¹å¼

### [ELK](https://www.elastic.co/cn/what-is/elk-stack) æ–¹æ¡ˆ

#### [Elasticsearch](https://www.elastic.co/cn/)

#### [Logstash](https://www.elastic.co/cn/products/logstash)

#### [Kibana](https://www.elastic.co/cn/products/kibana)

### [EFK](https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/fluentd-elasticsearch) æ–¹æ¡ˆ

å’Œ ELK ä¸åŒçš„æ˜¯  EFK æ–¹æ¡ˆä¸­ä½¿ç”¨ Fluentd æ¥é‡‡é›†æ—¥å¿—ã€‚

#### [Fluentd](https://www.fluentd.org)

## ç›‘æ§æ–¹æ¡ˆ

### Cadvisor+InfluxDB+Grafana

### Heapster+InfluxDB+Grafana

### Promethus+metrics+Grafana

| é‡‡é›† | cAdvisorã€Heapster,ã€collectd,ã€Statsdã€ Tcollectorã€ Scout |
| :--: | ----------------------------------------------------------- |
| å­˜å‚¨ | InfluxDbã€OpenTSDBã€ Elasticsearch                          |
| å±•ç¤º | Graphiteã€Grafanaã€facetteã€ Cactiã€Gangliaã€DataDog        |
| å‘Šè­¦ | Nagiosã€prometheusã€Icingaã€Zabbix                          |

#### [Grafana](https://grafana.com)

å¼€æºDashBoardï¼Œåç«¯æ”¯æŒå¤šç§æ•°æ®åº“ï¼Œå¦‚ï¼šInfluxdbã€Prometheusâ€¦ï¼Œæ’ä»¶ä¹Ÿæ¯”è¾ƒå¤šï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚éå¸¸é€‚åˆç”¨äºåšå±•ç¤ºã€‚

#### [InfluxDB](https://www.influxdata.com)

å¼€æºåˆ†å¸ƒå¼æ—¶é—´æ—¶åºã€äº‹ä»¶å’ŒæŒ‡æ ‡æ•°æ®åº“ï¼Œä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œæ€§èƒ½é«˜æ•ˆï¼Œæ— éœ€å¤–éƒ¨ä¾èµ–ï¼Œå…¶è®¾è®¡ç›®æ ‡æ˜¯å®ç°åˆ†å¸ƒå¼å’Œæ°´å¹³ä¼¸ç¼©æ‰©å±•ã€‚

##### ç‰¹æ€§

- ä½¿ç”¨ç±» SQL è¯­å¥ï¼›
- æä¾› min, max, sum, count, mean ç­‰èšåˆå‡½æ•°ï¼›
- é‡‡ç”¨ Schemaless ï¼Œåˆ—å­˜å‚¨ï¼Œå‹ç¼©ç‡é«˜ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„æ•°é‡çš„åˆ—ï¼›
- å¯ä»¥å°†ç§’çº§ç›‘æ§åœ¨åå°è½¬æ¢ä¸ºåˆ†é’Ÿçº§ï¼Œå‡å°å­˜å‚¨ç©ºé—´ (Continuous Queries)ï¼›
- Built-in Explorer è‡ªå¸¦ç®¡ç†å·¥å…·ï¼Œé»˜è®¤ä¸æ‰“å¼€ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼›
- Native HTTP APIï¼Œé‡‡ç”¨å†…ç½® HTTP æœåŠ¡ (Protobuf API æš‚æ—¶ä¸æä¾›)ã€‚
- æ”¯æŒ Regular Timeseries ä»¥åŠ Irregular Timeseriesï¼Œå‰è€…æ˜¯æŒ‡æ—¶é—´é—´éš”å›ºå®šï¼Œåè€…æŒ‡ä¸å›ºå®šï¼Œä¾‹å¦‚æŠ¥è­¦ã€å…¥ä¾µäº‹ä»¶ç­‰ï¼›

#### [cAdvisor](https://github.com/google/cadvisor)

 æ¥è‡ª Google çš„å®¹å™¨ç›‘æ§å·¥å…·ï¼Œä¹Ÿæ˜¯ Kubelet å†…ç½®çš„å®¹å™¨èµ„æºæ”¶é›†å·¥å…·ã€‚å®ƒä¼šè‡ªåŠ¨æ”¶é›†æœ¬æœºå®¹å™¨ CPUã€å†…å­˜ã€ç½‘ç»œå’Œæ–‡ä»¶ç³»ç»Ÿçš„èµ„æºå ç”¨æƒ…å†µï¼Œå¹¶å¯¹å¤–æä¾› cAdvisor åŸç”Ÿçš„ APIã€‚

#### [Heapster](https://github.com/kubernetes-retired/heapster)

ç”±äº cAdvisor åªæä¾›äº†å•æœºçš„å®¹å™¨èµ„æºå ç”¨æƒ…å†µï¼Œè€Œ Heapster åˆ™æä¾›äº†æ•´ä¸ªé›†ç¾¤çš„èµ„æºç›‘æ§ï¼ˆkubernetes 1.11 ä¹‹å‰ï¼Œhpaéƒ½æ˜¯ä»heapsterè·å–æ•°æ®ï¼‰ï¼Œå¹¶æ”¯æŒæŒä¹…åŒ–æ•°æ®å­˜å‚¨åˆ° InfluxDB

#### [kube-state-metrics](https://github.com/kubernetes/kube-state-metrics)

åœ¨è¿™é‡Œä½œä¸ºprometheusçš„ä¸€ä¸ªexporteræ¥ä½¿ç”¨ï¼Œæä¾›deploymentã€daemonsetã€cronjobç­‰æœåŠ¡çš„ç›‘æ§æ•°æ®ï¼Œç”±kubernesteså®˜æ–¹æä¾›ï¼Œä¸prometheusç´§å¯†ç»“åˆã€‚

#### [Promethues](https://prometheus.io)

åœ¨Kubernetesç¤¾åŒºä¸­ï¼Œå¾ˆå¤šäººè®¤ä¸º Prometheus æ˜¯å®¹å™¨åœºæ™¯ä¸­ç›‘æ§çš„ç¬¬ä¸€æ–¹æ¡ˆï¼Œæˆä¸ºå®¹å™¨ç›‘æ§æ ‡å‡†çš„åˆ¶å®šè€…ã€‚å…¶æä¾›å¼ºå¤§çš„æ•°æ®é‡‡é›†ã€æ•°æ®å­˜å‚¨ã€æ•°æ®å±•ç¤ºã€å‘Šè­¦ç­‰ï¼Œå¤©ç”Ÿå®Œç¾æ”¯æŒ kubernetesï¼ŒCNCFåŸºé‡‘ä¼šçš„ç¬¬äºŒä¸ªæˆå‘˜ï¼Œç¬¬ä¸€ä¸ªæ˜¯ Kubernetes ã€‚è€Œä¸” Prometheus é‡Œé¢å¾ˆå¤šæ€æƒ³éƒ½æ¥æºäº Google å†…éƒ¨çš„ç›‘æ§ç³»ç»Ÿ Borgmonï¼Œå…¶æ–¹æ¡ˆç›¸å½“æˆç†Ÿã€‚

##### ç‰¹æ€§

- å¤šç»´æ•°æ®æ¨¡å‹ï¼ˆæœ‰metricåç§°å’Œé”®å€¼å¯¹ç¡®å®šçš„æ—¶é—´åºåˆ—ï¼‰
- çµæ´»çš„æŸ¥è¯¢è¯­è¨€
- ä¸ä¾èµ–åˆ†å¸ƒå¼å­˜å‚¨
- é€šè¿‡pullæ–¹å¼é‡‡é›†æ—¶é—´åºåˆ—ï¼Œé€šè¿‡httpåè®®ä¼ è¾“
- æ”¯æŒé€šè¿‡ä¸­ä»‹ç½‘å…³çš„pushæ—¶é—´åºåˆ—çš„æ–¹å¼
- ç›‘æ§æ•°æ®é€šè¿‡æœåŠ¡æˆ–è€…é™æ€é…ç½®æ¥å‘ç°
- æ”¯æŒå¤šç»´åº¦å¯è§†åŒ–åˆ†æå’Œdashboardç­‰

##### ç›‘æ§å±‚é¢

- åŸºç¡€è®¾æ–½å±‚ï¼šç›‘æ§å„ä¸ªä¸»æœºæœåŠ¡å™¨èµ„æº(åŒ…æ‹¬Kubernetesçš„Nodeå’ŒéKubernetesçš„Node)ï¼Œå¦‚CPU,å†…å­˜,ç½‘ç»œååå’Œå¸¦å®½å ç”¨,ç£ç›˜I/Oå’Œç£ç›˜ä½¿ç”¨ç­‰æŒ‡æ ‡ã€‚
- ä¸­é—´ä»¶å±‚ï¼šç›‘æ§ç‹¬ç«‹éƒ¨ç½²äºKubernetesé›†ç¾¤ä¹‹å¤–çš„ä¸­é—´ä»¶ï¼Œä¾‹å¦‚ï¼šMySQLã€Redisã€RabbitMQã€ElasticSearchã€Nginxç­‰ã€‚
- Kubernetes é›†ç¾¤ï¼šç›‘æ§Kubernetesé›†ç¾¤æœ¬èº«çš„å…³é”®æŒ‡æ ‡
- Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²çš„åº”ç”¨ï¼šç›‘æ§éƒ¨ç½²åœ¨Kubernetesé›†ç¾¤ä¸Šçš„åº”ç”¨

##### ç»„ä»¶

- prometheus-serverï¼šæ•°æ®å­˜å‚¨ä»¥åŠç›‘æ§æ•°æ®èšåˆ
- prometheus-config-reloaderï¼šåŠ¨æ€æ›´æ–°prometheusé…ç½®
- rules-configmap-reloaderï¼šåŠ¨æ€æ›´æ–°prometheusæŠ¥è­¦é…ç½®
- alert managerï¼šæŠ¥è­¦ç»„ä»¶
- node-exporterï¼šèŠ‚ç‚¹èµ„æºä¿¡æ¯é‡‡é›†ç»„ä»¶
- kube-state-metricsï¼šåŠ¨æ€å‘ç°endpointï¼Œä¸‰æ–¹ç›‘æ§çš„æ ¸å¿ƒç»„ä»¶
- prometheus-operatorï¼šprometheusé…ç½®çš„operator
- grafanaï¼šæ•°æ®å±•ç°

## CI/CD æ–¹æ¡ˆ

### å‚è€ƒ

### [Jenkins](https://jenkins.io/)

### [Gitlab CI](https://docs.gitlab.com/ee/ci/)

### [Drone](https://drone.io/)

## é•œåƒ registry

é•œåƒä»“åº“è´Ÿè´£å­˜å‚¨å’Œå‘å¸ƒåº”ç”¨çš„é•œåƒéƒ¨ç½²ç‰ˆæœ¬ï¼Œåœ¨åŠŸèƒ½ä¸Šå¹¶ä¸å¤æ‚ï¼Œä½†ç”±äºå®‰å…¨æ€§çš„è¦æ±‚ã€‚ç”¨äºç”Ÿäº§å‘å¸ƒçš„é•œåƒç‰ˆæœ¬å¿…é¡»é€šè¿‡ä¸¥æ ¼çš„æµ‹è¯•é˜¶æ®µï¼Œä»¥åŠä¸¥å¯†çš„å®‰å…¨æ£€æŸ¥æ­¥éª¤ï¼Œå› æ­¤å»ºè®®å¯¹ç”Ÿäº§ç¯å¢ƒè¿è¡Œä¸“ç”¨çš„ç”Ÿäº§é•œåƒä»“åº“ï¼›åŒæ—¶ï¼Œåœ¨æŒç»­é›†æˆè¶Šæ¥è¶Šæ™®éçš„æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯å¼€å‘å’Œæµ‹è¯•çš„æ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦æµ‹è¯•é•œåƒä»“åº“ã€‚å»ºè®®ç”Ÿäº§é•œåƒåº“å’Œæµ‹è¯•é•œåƒåº“åœ¨ç‰©ç†ä¸Šåˆ†å¼€ã€ç½‘ç»œä¸Šçš„è¿é€šé€šè¿‡é˜²ç«å¢™ç­–ç•¥åšé™åˆ¶ï¼ˆåªå¼€æ”¾å¿…é¡»çš„ç«¯å£ç”¨äºé•œåƒåŒæ­¥ï¼‰ã€‚

åœ¨ä½¿ç”¨è§„åˆ™ä¸Šï¼Œæµ‹è¯•é•œåƒä»“åº“å…è®¸éšæ—¶çš„é•œåƒä¸Šä¼ å’Œæ›´æ–°ï¼Œé€šå¸¸éƒ½ä¼šå¯¹æ¥æŒç»­é›†æˆç³»ç»Ÿï¼›è€Œå¯¹äºç”Ÿäº§é•œåƒä»“åº“ï¼Œä¸ºäº†ä¿è¯é•œåƒæ¥æºçš„å®‰å…¨ã€å¯æ§ï¼Œå»ºè®®é™åˆ¶ä¸ºåªèƒ½ä»æµ‹è¯•é•œåƒåŒæ­¥ï¼Œè§„å®šåªæœ‰åœ¨æµ‹è¯•é•œåƒä»“åº“ä¸­æ ‡è®°ä¸ºå®Œæˆæµ‹è¯•ã€ç»è¿‡å®‰å…¨æ£€æŸ¥çš„é•œåƒï¼Œç”±æœ‰ç›¸åº”æƒé™çš„è´¦å·ï¼Œåœ¨ç»è¿‡å¿…è¦çš„å®¡æ‰¹æˆ–è€…æ»¡è¶³ä¸€å®šè§„åˆ™çš„æƒ…å†µä¸‹ï¼Œä»æµ‹è¯•é•œåƒä»“åº“ä¸­æŠŠé•œåƒåŒæ­¥åˆ°ç”Ÿäº§é•œåƒä»“åº“ã€‚ä¸€æ—¦é•œåƒè¿›å…¥ç”Ÿäº§é•œåƒä»“åº“ï¼Œå°±è¢«å½“åšæ­£å¼çš„ç”Ÿäº§å‘å¸ƒç‰ˆæœ¬ï¼Œæ¥ä¸‹æ¥å°±æŒ‰ç…§ç°æœ‰çš„ç”Ÿäº§å‘å¸ƒå’Œå˜æ›´æµç¨‹ï¼Œåœ¨æŒ‡å®šçš„å˜æ›´çª—å£ï¼Œä»ç”Ÿäº§é•œåƒåº“ä¸­æ‹‰å–é•œåƒè¿›è¡Œéƒ¨ç½²ï¼Œè¿™æ ·åšä¹Ÿå¾ˆå¥½åœ°æ»¡è¶³å®‰å…¨ç›‘ç®¡è¦æ±‚ã€‚

### [harbor](https://goharbor.io/)

Harboræ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†å‘Dockeré•œåƒçš„ä¼ä¸šçº§RegistryæœåŠ¡å™¨ã€‚é€šè¿‡æ·»åŠ ä¸€äº›ä¼ä¸šå¿…éœ€çš„åŠŸèƒ½ç‰¹æ€§ï¼Œä¾‹å¦‚å®‰å…¨ã€æ ‡è¯†å’Œç®¡ç†ç­‰ï¼Œæ‰©å±•äº†å¼€æº Docker Distributionã€‚ä½œä¸ºä¸€ä¸ªä¼ä¸šçº§ç§æœ‰RegistryæœåŠ¡å™¨ï¼ŒHarboræä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œå®‰å…¨ã€‚æå‡ç”¨æˆ·ä½¿ç”¨Registryæ„å»ºå’Œè¿è¡Œç¯å¢ƒä¼ è¾“é•œåƒçš„æ•ˆç‡ã€‚Harboræ”¯æŒå®‰è£…åœ¨å¤šä¸ªRegistryèŠ‚ç‚¹çš„é•œåƒèµ„æºå¤åˆ¶ï¼Œé•œåƒå…¨éƒ¨ä¿å­˜åœ¨ç§æœ‰Registryä¸­ï¼Œ ç¡®ä¿æ•°æ®å’ŒçŸ¥è¯†äº§æƒåœ¨å…¬å¸å†…éƒ¨ç½‘ç»œä¸­ç®¡æ§ã€‚å¦å¤–ï¼ŒHarborä¹Ÿæä¾›äº†é«˜çº§çš„å®‰å…¨ç‰¹æ€§ï¼Œè¯¸å¦‚ç”¨æˆ·ç®¡ç†ï¼Œè®¿é—®æ§åˆ¶å’Œæ´»åŠ¨å®¡è®¡ç­‰ã€‚

#### ç‰¹æ€§

- é•œåƒæ³¨å†Œä¸­å¿ƒ:æ”¯æŒå®¹å™¨é•œåƒå’ŒHelmã€‚ä¸ºé•œåƒæä¾›ä¸€ä¸ªæ³¨å†ŒæœåŠ¡å’Œç¼–æ’å¹³å°ã€‚
- åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶: ç”¨æˆ·å¯ä»¥åˆ›å»ºä¸åŒçš„â€˜é¡¹ç›®â€˜ï¼Œå¹¶ä¸”æ‹¥æœ‰ä¸åŒæƒé™ã€‚
- é•œåƒå¤åˆ¶:Harborä¼šåœ¨å¤åˆ¶é‡åˆ°ä»»ä½•é”™è¯¯æ—¶è‡ªåŠ¨é‡è¯•ã€‚ é€‚ç”¨äºè´Ÿè½½å‡è¡¡ã€é«˜å¯ç”¨æ€§ã€å¤šæ•°æ®ä¸­å¿ƒã€æ··åˆå’Œå¤šäº‘åœºæ™¯
- æ¼æ´æ‰«æï¼šHarborå®šæœŸæ‰«æé•œåƒå¹¶è­¦å‘Šç”¨æˆ·å­˜åœ¨æ¼æ´ã€‚
- AD/LDAP æ”¯æŒ:Harborå¯ä»¥é›†æˆä¼ä¸šå†…éƒ¨å·²æœ‰çš„AD/LDAPï¼Œç”¨äºé‰´æƒè®¤è¯ç®¡ç†ã€‚
- OIDCæ”¯æŒ:ä¸€ç§åŸºäºOAuth2çš„åè®®
- åƒåœ¾å›æ”¶:é•œåƒè¢«åˆ é™¤çš„æ—¶å€™å¯ä»¥è‡ªåŠ¨åƒåœ¾å›æ”¶ã€‚å¹¶ä¸”å¯ä»¥å®šæ—¶è®¾ç½®åƒåœ¾æ¸…ç†ã€‚
- å‹å¥½çš„ç•Œé¢æ“ä½œ:ç”¨æˆ·å¯ä»¥è½»æ¾æ–¹ä¾¿çš„é•œåƒç®¡ç†ï¼Œæ”¯æŒä¸­è‹±æ–‡ç­‰å¤šè¯­è¨€ã€‚
- å®¡è®¡:è·Ÿè¸ªç”¨æˆ·å¯¹é•œåƒçš„æ“ä½œå†å²
- RESTful APIï¼šå¤§å¤šæ•°ç®¡ç†æ“ä½œçš„RESTful Apiï¼Œæ˜“äºä¸å¤–éƒ¨ç³»ç»Ÿé›†æˆã€‚ åµŒå…¥å¼Swagger UIå¯ç”¨äºæ¢ç´¢å’Œæµ‹è¯•APIï¼ˆç®¡ç†ç•Œé¢å·¦ä¸‹è§’çš„â€˜APIæ§åˆ¶ä¸­å¿ƒ)
- è½»æ¾éƒ¨ç½²ï¼šæä¾›è”æœºå’Œè„±æœºå®‰è£…ç¨‹åºã€‚ æ­¤å¤–ï¼ŒHelm Chartç”¨äºåœ¨Kubernetesä¸Šéƒ¨ç½²Harborã€‚

### [quay](https://quay.io/)

åœ¨ 11 æœˆä»½çº¢å¸½å®£å¸ƒå¼€æº quay

#### ç‰¹æ€§

1. é•œåƒä»“åº“é«˜å¯ç”¨å’Œç¾å¤‡ï¼šæ•°æ®ä¸­å¿ƒå†…éƒ¨ HAï¼Œåœ¨æ•°æ®ä¸­å¿ƒä¹‹é—´åŒæ­¥é•œåƒ
2. æ”¯æŒ CIï¼šå½“å¼€å‘äººå‘˜æäº¤ä»£ç ä»¥åï¼Œè‡ªåŠ¨è§¦å‘ä»£ç æ„å»ºã€‚
3. æ”¯æŒå®‰å…¨æ‰«æï¼šè‡ªåŠ¨æ‰«æå®¹å™¨é•œåƒï¼Œä»¥æŸ¥æ‰¾å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚
4. ä¼ä¸šè®¤è¯ï¼šé›†æˆåˆ°ç°æœ‰çš„èº«ä»½åŸºç¡€æ¶æ„ï¼šLDAPï¼ŒKeystone ç­‰
5. çµæ´»çš„å­˜å‚¨åç«¯ï¼šå°†å®¹å™¨å­˜å‚¨åœ¨ Amazon S3ï¼ŒOpenStack Swiftï¼ŒGoogle äº‘ç«¯å­˜å‚¨ä¸­ï¼Œæˆ–ç›´æ¥å­˜å‚¨åˆ°ç£ç›˜ã€‚
6. è®°å½•å’Œå®¡è®¡ å®¡è®¡å¯¹äº CI ç®¡é“ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½è‡³å…³é‡è¦ã€‚è·Ÿè¸ªé€šè¿‡ API å’Œ UI æ‰§è¡Œçš„æ“ä½œã€‚

##### Quayçš„ä¼ä¸šçº§åŠŸèƒ½

- å¼‚åœ°å¤åˆ¶
- é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§
- å®‰å…¨æ‰«æ
- è‡ªåŠ¨æ„å»ºè§¦å‘å™¨
- æ—¶é—´æœºå™¨imageå›æ»šï¼ˆåŸºäºbuildç‰ˆæœ¬çš„å›é€€ï¼‰
- ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶
- è‡ªåŠ¨è¿ç»­åƒåœ¾æ”¶é›†ï¼Œæ— éœ€åœæœº
- ä¸å¤šä¸ªå­˜å‚¨åç«¯é›†æˆï¼ˆcephç­‰ï¼‰
- åŠ å¯†çš„CLIå¯†ç 
- æ´ªæµåˆ†å¸ƒ
- å®¹å™¨å’Œåº”ç”¨ç¨‹åºæ³¨å†Œ
- ä¸Quay.ioä¿æŒä¸€è‡´çš„UIå’Œä»£ç åº“

##### é•œåƒæ‰«æï¼š

quayçš„é•œåƒå®‰å…¨æ‰«æåŸºäºclairï¼šClairé¡¹ç›®æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä½¿Quay Security Scannerèƒ½å¤Ÿæ£€æµ‹Quay Enterpriseä¸­æ‰€æœ‰å›¾åƒçš„æ¼æ´ï¼Œå¹¶åœ¨å‘ç°è¿™äº›é—®é¢˜æ—¶é€šçŸ¥å¼€å‘äººå‘˜ã€‚

##### è‡ªåŠ¨æ„å»ºï¼š

é€šè¿‡é›†æˆåˆ°GitHubï¼ŒBitbucketç­‰ï¼Œè‡ªåŠ¨æ„å»ºå­˜å‚¨åº“æ¨é€æ“ä½œä¸Šçš„æ˜ åƒã€‚éšç€ä»£ç ï¼ˆGitHubï¼ŒBitbucketï¼ŒGitLabå’ŒGitï¼‰ä¸­çš„æ¨é€æ“ä½œå‘ç”Ÿï¼ŒQuayå°†è‡ªåŠ¨æ„å»ºæ–°ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åº

##### imageå›æ»š:

Time Machineæä¾›å›¾åƒå›æ»šï¼ŒæŸ¥çœ‹æ ‡ç­¾å†å²è®°å½•ï¼Œå¿«é€Ÿè½»æ¾åœ°åˆ‡æ¢å›¾åƒæ„å»ºã€‚

æŸ¥çœ‹image buildå†å²è®°å½•ï¼Œå¹¶å¯ä»¥é€‰æ‹©æŸä¸ªç‰ˆæœ¬çš„æ„å»ºè¿›è¡Œå›é€€;

##### ç»†é¢—ç²’åº¦çš„RBACé…ç½®:

æ”¯æŒè®¸å¤šèº«ä»½æä¾›å•†ï¼šLDAPï¼ŒOAuthï¼ŒOpenStack Keystoneç­‰ã€‚

##### äº‹ä»¶å’Œä½¿ç”¨æ—¥å¿—ï¼š

- é’ˆå¯¹å­˜å‚¨åº“æ•è·æ‰€æœ‰äº‹ä»¶
- Pull, push events
- æƒé™æ›´æ”¹
- buildäº‹ä»¶
- æ ‡ç­¾æ›´æ”¹

##### è‡ªåŠ¨å‹ç¼©imageï¼š

å°†å¤šä¸ªdocker layerå‹ç¼©æˆä¸€ä¸ªï¼Œä»¥åˆ›å»ºä¸€ä¸ªlayeræ›´å°‘çš„imageï¼š

##### è‡ªåŠ¨è¿›è¡ŒK8Såº”ç”¨éƒ¨ç½²ï¼š

$ helm registry install quay.io/jzelinskie/nginx

##### äº‹ä»¶é€šçŸ¥

å‘å¸ƒç”µå­é‚®ä»¶ã€quayé€šçŸ¥ã€webhookå‘å¸ƒã€flowdockï¼Œhipchatï¼ŒåŸºäºQuay Enterpriseå†…éƒ¨å„ç§äº‹ä»¶çš„é€šçŸ¥

## é›†ç¾¤ä¼˜åŒ–

### ç½‘ç»œ MTU

### å†…æ ¸ç‰ˆæœ¬

#### å‚è€ƒæ–‡æ¡£

- [å¹²è´§ | æºç¨‹å®¹å™¨å¶å‘æ€§è¶…æ—¶é—®é¢˜æ¡ˆä¾‹åˆ†æï¼ˆä¸€ï¼‰](https://mp.weixin.qq.com/s/bSNWPnFZ3g_gciOv_qNhIQ)
- [å¹²è´§ | æºç¨‹å®¹å™¨å¶å‘æ€§è¶…æ—¶é—®é¢˜æ¡ˆä¾‹åˆ†æï¼ˆäºŒ)](https://mp.weixin.qq.com/s/7ZZqWPE1XNf9Mn_wj1HjUw)
- [Debugging network stalls on Kubernetes](https://github.blog/2019-11-21-debugging-network-stalls-on-kubernetes/)

### service å®ç°å½¢å¼

æ€§èƒ½å¯¹æ¯”å‚è€ƒæ–‡ç«   [kube-proxy æ¨¡å¼å¯¹æ¯”ï¼šiptables è¿˜æ˜¯ IPVS](https://blog.fleeto.us/post/iptables-or-ipvs/)

kube-proxy æ˜¯ Kubernetes ä¸­çš„å…³é”®ç»„ä»¶ã€‚ä»–çš„è§’è‰²å°±æ˜¯åœ¨æœåŠ¡ï¼ˆClusterIP å’Œ NodePortï¼‰å’Œå…¶åç«¯ Pod ä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚kube-proxy æœ‰ä¸‰ç§è¿è¡Œæ¨¡å¼ï¼Œæ¯ç§éƒ½æœ‰ä¸åŒçš„å®ç°æŠ€æœ¯ï¼šuserspaceã€iptables æˆ–è€… IPVSã€‚

userspace æ¨¡å¼éå¸¸é™ˆæ—§ã€ç¼“æ…¢ï¼Œå·²ç»ä¸æ¨èä½¿ç”¨ã€‚ä½†æ˜¯ iptables å’Œ IPVS è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿæœ¬æ–‡ä¸­æˆ‘ä»¬ä¼šå¯¹è¿™ä¸¤ç§æ¨¡å¼è¿›è¡Œæ¯”è¾ƒï¼Œçœ‹çœ‹ä»–ä»¬åœ¨çœŸæ­£çš„å¾®æœåŠ¡ä¸Šä¸‹æ–‡ä¸­çš„è¡¨ç°ï¼Œå¹¶è§£é‡Šåœ¨ç‰¹å®šæƒ…å†µä¸‹çš„é€‰æ‹©æ–¹æ³•ã€‚

#### æ€§èƒ½å¯¹æ¯”

iptables çš„è¿æ¥å¤„ç†ç®—æ³•å¤æ‚åº¦æ˜¯ O(n)ï¼Œè€Œ IPVS æ¨¡å¼æ˜¯ O(1)ï¼Œä½†æ˜¯åœ¨å¾®æœåŠ¡ç¯å¢ƒä¸­ï¼Œå…¶å…·ä½“è¡¨ç°å¦‚ä½•å‘¢ï¼Ÿ

åœ¨å¤šæ•°åœºæ™¯ä¸­ï¼Œæœ‰ä¸¤ä¸ªå…³é”®å±æ€§éœ€è¦å…³æ³¨ï¼š

- å“åº”æ—¶é—´ï¼šä¸€ä¸ªå¾®æœåŠ¡å‘å¦ä¸€ä¸ªå¾®æœåŠ¡å‘èµ·è°ƒç”¨æ—¶ï¼Œç¬¬ä¸€ä¸ªå¾®æœåŠ¡å‘é€è¯·æ±‚ï¼Œå¹¶ä»ç¬¬äºŒä¸ªå¾®æœåŠ¡ä¸­å¾—åˆ°å“åº”ï¼Œä¸­é—´æ¶ˆè€—äº†å¤šå°‘æ—¶é—´ï¼Ÿ
- CPU æ¶ˆè€—ï¼šè¿è¡Œå¾®æœåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œæ€»ä½“ CPU ä½¿ç”¨æƒ…å†µå¦‚ä½•ï¼ŸåŒ…æ‹¬ç”¨æˆ·å’Œæ ¸å¿ƒç©ºé—´çš„ CPU ä½¿ç”¨ï¼ŒåŒ…å«æ‰€æœ‰ç”¨äºæ”¯æŒå¾®æœåŠ¡çš„è¿›ç¨‹ï¼ˆä¹ŸåŒ…æ‹¬ kube-proxyï¼‰ã€‚

ä¸ºäº†è¯´æ˜é—®é¢˜ï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸ªå¾®æœåŠ¡ä½œä¸ºå®¢æˆ·ç«¯ï¼Œè¿™ä¸ªå¾®æœåŠ¡ä»¥ Pod çš„å½¢å¼è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹ä¸Šï¼Œæ¯ç§’é’Ÿå‘å‡º 1000 ä¸ªè¯·æ±‚ï¼Œè¯·æ±‚çš„ç›®æ ‡æ˜¯ä¸€ä¸ª Kubernetes æœåŠ¡ï¼Œè¿™ä¸ªæœåŠ¡ç”± 10 ä¸ª Pod ä½œä¸ºåç«¯ï¼Œè¿è¡Œåœ¨å…¶å®ƒçš„èŠ‚ç‚¹ä¸Šã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯èŠ‚ç‚¹ä¸Šè¿›è¡Œäº†æµ‹é‡ï¼ŒåŒ…æ‹¬ iptables ä»¥åŠ IPVS æ¨¡å¼ï¼Œè¿è¡Œäº†æ•°é‡ä¸ç­‰çš„ Kubernetes æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰ 10 ä¸ª Podï¼Œæœ€å¤§æœ‰ 10,000 ä¸ªæœåŠ¡ï¼ˆä¹Ÿå°±æ˜¯ 100,000 ä¸ª Podï¼‰ã€‚æˆ‘ä»¬ç”¨ golang ç¼–å†™äº†ä¸€ä¸ªç®€å•çš„æµ‹è¯•å·¥å…·ä½œä¸ºå®¢æˆ·ç«¯ï¼Œç”¨æ ‡å‡†çš„ NGINX ä½œä¸ºåç«¯æœåŠ¡ã€‚

#### å“åº”æ—¶é—´

å“åº”æ—¶é—´å¾ˆé‡è¦ï¼Œæœ‰åŠ©äºæˆ‘ä»¬ç†è§£è¿æ¥å’Œè¯·æ±‚çš„å·®å¼‚ã€‚å…¸å‹æƒ…å†µä¸‹ï¼Œå¤šæ•°å¾®æœåŠ¡éƒ½ä¼šä½¿ç”¨æŒä¹…æˆ–è€… `keepalive` è¿æ¥ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªè¿æ¥éƒ½ä¼šè¢«å¤šä¸ªè¯·æ±‚å¤ç”¨ï¼Œè€Œä¸æ˜¯æ¯ä¸ªè¯·æ±‚ä¸€æ¬¡è¿æ¥ã€‚è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºå¤šæ•°è¿æ¥çš„æ–°å»ºè¿‡ç¨‹éƒ½éœ€è¦å®Œæˆä¸‰æ¬¡ TCP æ¡æ‰‹çš„è¿‡ç¨‹ï¼Œè¿™éœ€è¦æ¶ˆè€—æ—¶é—´ï¼Œä¹Ÿéœ€è¦åœ¨ Linux ç½‘ç»œæ ˆä¸­è¿›è¡Œæ›´å¤šæ“ä½œï¼Œä¹Ÿå°±ä¼šæ¶ˆè€—æ›´å¤š CPU å’Œæ—¶é—´ã€‚

![](https://p.k8s.li/Picture1.png)

è¿™å¼ å›¾å±•ç¤ºäº†ä¸¤ä¸ªå…³é”®ç‚¹ï¼š

- iptables å’Œ IPVS çš„å¹³å‡å“åº”æ—¶é—´åœ¨ 1000 ä¸ªæœåŠ¡ï¼ˆ10000 ä¸ª Podï¼‰ä»¥ä¸Šæ—¶ï¼Œä¼šå¼€å§‹è§‚å¯Ÿåˆ°å·®å¼‚ã€‚
- åªæœ‰åœ¨æ¯æ¬¡è¯·æ±‚éƒ½å‘èµ·æ–°è¿æ¥çš„æƒ…å†µä¸‹ï¼Œä¸¤ç§æ¨¡å¼çš„å·®å¼‚æ‰æ¯”è¾ƒæ˜æ˜¾ã€‚

ä¸ç®¡æ˜¯ iptables è¿˜æ˜¯ IPVSï¼Œkube-proxy çš„å“åº”æ—¶é—´å¼€é”€éƒ½æ˜¯å’Œå»ºç«‹è¿æ¥çš„æ•°é‡ç›¸å…³çš„ï¼Œè€Œä¸æ˜¯æ•°æ®åŒ…æˆ–è€…è¯·æ±‚æ•°é‡ï¼Œè¿™æ˜¯å› ä¸º Linux ä½¿ç”¨äº† Conntrackï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°å°†æ•°æ®åŒ…å’Œç°å­˜è¿æ¥å…³è”èµ·æ¥ã€‚å¦‚æœæ•°æ®åŒ…èƒ½å¤Ÿè¢« Conntrack æˆåŠŸåŒ¹é…ï¼Œé‚£å°±ä¸éœ€è¦é€šè¿‡ kube-proxy çš„ iptables æˆ– IPVS è§„åˆ™æ¥æ¨ç®—å»å‘ã€‚Linux conntrack éå¸¸æ£’ï¼ï¼ˆç»å¤§å¤šæ•°æ—¶å€™ï¼‰

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¾‹å­ä¸­çš„æœåŠ¡ç«¯å¾®æœåŠ¡ä½¿ç”¨ NGINX æä¾›ä¸€ä¸ªé™æ€å°é¡µé¢ã€‚å¤šæ•°å¾®æœåŠ¡è¦åšæ›´å¤šæ“ä½œï¼Œå› æ­¤ä¼šäº§ç”Ÿæ›´é«˜çš„å“åº”æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯ kube-proxy å¤„ç†è¿‡ç¨‹åœ¨æ€»ä½“æ—¶é—´ä¸­çš„å æ¯”ä¼šå‡å°‘ã€‚

è¿˜æœ‰ä¸ªéœ€è¦è§£é‡Šçš„å¤æ€ªé—®é¢˜ï¼šæ—¢ç„¶ IPVS çš„è¿æ¥è¿‡ç¨‹å¤æ‚åº¦æ˜¯ O(1)ï¼Œä¸ºä»€ä¹ˆåœ¨ 10,000 æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œé Keepalive çš„å“åº”æ—¶é—´è¿˜æ˜¯æé«˜äº†ï¼Ÿæˆ‘ä»¬éœ€è¦æ·±å…¥æŒ–æ˜æ›´å¤šå†…å®¹æ‰èƒ½è§£é‡Šè¿™ä¸€é—®é¢˜ï¼Œä½†æ˜¯å…¶ä¸­ä¸€ä¸ªå› ç´ å°±æ˜¯å› ä¸ºä¸Šå‡çš„ CPU ç”¨é‡æ‹–æ…¢äº†æ•´ä¸ªç³»ç»Ÿã€‚è¿™å°±æ˜¯ä¸‹ä¸€ä¸ªä¸»é¢˜éœ€è¦æ¢ç©¶çš„å†…å®¹ã€‚

#### CPU ç”¨é‡

ä¸ºäº†æè¿° CPU ç”¨é‡ï¼Œä¸‹å›¾å…³æ³¨çš„æ˜¯æœ€å·®æƒ…å†µï¼šä¸ä½¿ç”¨æŒä¹…/keepalive è¿æ¥çš„æƒ…å†µä¸‹ï¼Œkube-proxy ä¼šæœ‰æœ€å¤§çš„å¤„ç†å¼€é”€ã€‚

![](https://p.k8s.li/Picture2.png)

ä¸Šå›¾è¯´æ˜äº†ä¸¤ä»¶äº‹ï¼š

- åœ¨è¶…è¿‡ 1000 ä¸ªæœåŠ¡ï¼ˆä¹Ÿå°±æ˜¯ 10,000 ä¸ª Podï¼‰çš„æƒ…å†µä¸‹ï¼ŒCPU ç”¨é‡å·®å¼‚æ‰å¼€å§‹æ˜æ˜¾ã€‚
- åœ¨ä¸€ä¸‡ä¸ªæœåŠ¡çš„æƒ…å†µä¸‹ï¼ˆåä¸‡ä¸ªåç«¯ Podï¼‰ï¼Œiptables æ¨¡å¼å¢é•¿äº† 0.35 ä¸ªæ ¸å¿ƒçš„å ç”¨ï¼Œè€Œ IPVS æ¨¡å¼ä»…å¢é•¿äº† 8%ã€‚

æœ‰ä¸¤ä¸ªä¸»è¦å› ç´ é€ æˆ CPU ç”¨é‡å¢é•¿ï¼š

ç¬¬ä¸€ä¸ªå› ç´ æ˜¯ï¼Œç¼ºçœæƒ…å†µä¸‹ kube-proxy æ¯ 30 ç§’ä¼šç”¨æ‰€æœ‰æœåŠ¡å¯¹å†…æ ¸é‡æ–°ç¼–ç¨‹ã€‚è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆ IPVS æ¨¡å¼ä¸‹ï¼Œæ–°å»ºè¿æ¥çš„ O(1) å¤æ‚åº¦ä¹Ÿä»ç„¶ä¼šäº§ç”Ÿæ›´å¤šçš„ CPU å ç”¨ã€‚å¦å¤–ï¼Œå¦‚æœæ˜¯æ—§ç‰ˆæœ¬å†…æ ¸ï¼Œé‡æ–°ç¼–ç¨‹ iptables çš„ API ä¼šæ›´æ…¢ã€‚æ‰€ä»¥å¦‚æœä½ ç”¨çš„å†…æ ¸è¾ƒæ—§ï¼Œiptables æ¨¡å¼å¯èƒ½ä¼šå ç”¨æ›´å¤šçš„ CPUã€‚

å¦ä¸€ä¸ªå› ç´ æ˜¯ï¼Œkube-proxy ä½¿ç”¨ IPVS æˆ–è€… iptables å¤„ç†æ–°è¿æ¥çš„æ¶ˆè€—ã€‚å¯¹ iptables æ¥è¯´ï¼Œé€šå¸¸æ˜¯ O(n) çš„å¤æ‚åº¦ã€‚åœ¨å­˜åœ¨å¤§é‡æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°æ˜¾è‘—çš„ CPU å ç”¨å‡é«˜ã€‚ä¾‹å¦‚åœ¨ 10,000 æœåŠ¡ï¼ˆ100,000 ä¸ªåç«¯ Podï¼‰çš„æƒ…å†µä¸‹ï¼Œiptables ä¼šä¸ºæ¯ä¸ªè¯·æ±‚çš„æ¯ä¸ªè¿æ¥å¤„ç†å¤§çº¦ 20000 æ¡è§„åˆ™ã€‚å¦‚æœä½¿ç”¨ NINGX ç¼ºçœæ¯è¿æ¥ 100 è¯·æ±‚çš„ keepalive è®¾ç½®ï¼Œkube-proxy çš„ iptables è§„åˆ™æ‰§è¡Œæ¬¡æ•°ä¼šå‡å°‘ä¸º 1%ï¼Œä¼šæŠŠ iptables çš„ CPU æ¶ˆè€—é™ä½åˆ°å’Œ IPVS ç±»ä¼¼çš„æ°´å¹³ã€‚

å®¢æˆ·ç«¯å¾®æœåŠ¡ä¼šç®€å•çš„ä¸¢å¼ƒå“åº”å†…å®¹ã€‚çœŸå®ä¸–ç•Œä¸­è‡ªç„¶ä¼šè¿›è¡Œæ›´å¤šå¤„ç†ï¼Œä¹Ÿä¼šé€ æˆæ›´å¤šçš„ CPU æ¶ˆè€—ï¼Œä½†æ˜¯ä¸ä¼šå½±å“ CPU æ¶ˆè€—éšæœåŠ¡æ•°é‡å¢é•¿çš„äº‹å®ã€‚

#### ç»“è®º

åœ¨è¶…è¿‡ 1000 æœåŠ¡çš„è§„æ¨¡ä¸‹ï¼Œkube-proxy çš„ IPVS æ¨¡å¼ä¼šæœ‰æ›´å¥½çš„æ€§èƒ½è¡¨ç°ã€‚è™½ç„¶å¯èƒ½æœ‰å¤šç§ä¸åŒæƒ…å†µï¼Œä½†æ˜¯é€šå¸¸æ¥è¯´ï¼Œè®©å¾®æœåŠ¡ä½¿ç”¨æŒä¹…è¿æ¥ã€è¿è¡Œç°ä»£å†…æ ¸ï¼Œä¹Ÿèƒ½å–å¾—è¾ƒå¥½çš„æ•ˆæœã€‚å¦‚æœè¿è¡Œçš„å†…æ ¸è¾ƒæ—§ï¼Œæˆ–è€…æ— æ³•ä½¿ç”¨æŒä¹…è¿æ¥ï¼Œé‚£ä¹ˆ IPVS æ¨¡å¼å¯èƒ½æ˜¯ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚

æŠ›å¼€æ€§èƒ½é—®é¢˜ä¸è°ˆï¼ŒIPVS æ¨¡å¼è¿˜æœ‰ä¸ªå¥½å¤„å°±æ˜¯å…·æœ‰æ›´å¤šçš„è´Ÿè½½å‡è¡¡ç®—æ³•å¯ä¾›é€‰æ‹©ã€‚

å¦‚æœä½ è¿˜ä¸ç¡®å®š IPVS æ˜¯å¦åˆé€‚ï¼Œé‚£å°±ç»§ç»­ä½¿ç”¨ iptables æ¨¡å¼å¥½äº†ã€‚è¿™ç§ä¼ ç»Ÿæ¨¡å¼æœ‰å¤§é‡çš„ç”Ÿäº§æ¡ˆä¾‹æ”¯æ’‘ï¼Œä»–æ˜¯ä¸€ä¸ªä¸å®Œç¾çš„ç¼ºçœé€‰é¡¹ã€‚

#### è¡¥å……ï¼šCalico å’Œ kube-proxy çš„ iptables æ¯”è¾ƒ

æœ¬æ–‡ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œkube-proxy ä¸­çš„ iptables ç”¨æ³•åœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­å¯èƒ½ä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜ã€‚æœ‰äººé—®æˆ‘ Calico ä¸ºä»€ä¹ˆæ²¡æœ‰ç±»ä¼¼çš„é—®é¢˜ã€‚ç­”æ¡ˆæ˜¯ Calico ä¸­ kube-proxy çš„ç”¨æ³•æ˜¯ä¸åŒçš„ã€‚kube-proxy ä½¿ç”¨äº†ä¸€ä¸ªå¾ˆé•¿çš„è§„åˆ™é“¾æ¡ï¼Œé“¾æ¡é•¿åº¦ä¼šéšç€é›†ç¾¤è§„æ¨¡è€Œå¢é•¿ï¼ŒCalico ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå¾ˆçŸ­çš„ä¼˜åŒ–è¿‡çš„è§„åˆ™é“¾ï¼Œç»ç”± ipsets çš„åŠ æŒï¼Œä¹Ÿå…·å¤‡äº† O(1) å¤æ‚åº¦çš„æŸ¥è¯¢èƒ½åŠ›ã€‚

ä¸‹å›¾è¯æ˜äº†è¿™ä¸€è§‚ç‚¹ï¼Œå…¶ä¸­å±•ç¤ºäº†æ¯æ¬¡è¿æ¥è¿‡ç¨‹ä¸­ï¼Œkube-proxy å’Œ Calico ä¸­ iptables è§„åˆ™æ•°é‡çš„å¹³å‡å€¼ã€‚è¿™é‡Œå‡è®¾é›†ç¾¤ä¸­çš„èŠ‚ç‚¹å¹³å‡æœ‰ 30 ä¸ª Podï¼Œæ¯ä¸ª Pod å…·æœ‰ 3 ä¸ªç½‘ç»œè§„åˆ™ã€‚

![](https://p.k8s.li/Picture3.png)

å³ä½¿æ˜¯ä½¿ç”¨ 10,000 ä¸ªæœåŠ¡å’Œ 100,000 ä¸ª Pod çš„æƒ…å†µä¸‹ï¼ŒCalico æ¯è¿æ¥æ‰§è¡Œçš„ iptables è§„åˆ™ä¹Ÿåªæ˜¯å’Œ kube-proxy åœ¨ 20 æœåŠ¡ 200 ä¸ª Pod çš„æƒ…å†µåŸºæœ¬ä¸€è‡´ã€‚

## å®‰å…¨åŠ å›º

### [ç®€ä»‹ï¼šCIS Kubernetes å®‰å…¨åŸºå‡†æŒ‡å—](https://blog.fleeto.us/post/cis-benchmark-brief/)

### [33 ä¸ª Kubernetes å®‰å…¨å·¥å…·](https://blog.fleeto.us/post/33-kubernetes-security-tools/)

### å·¥å…·

#### [TUF](https://theupdateframework.github.io/)

TUF æ˜¯ä¸€é¡¹ç”¨äºä¿æŠ¤è½¯ä»¶æ›´æ–°ç³»ç»Ÿçš„å¼€æºå®‰å…¨æŠ€æœ¯ï¼Œä¹Ÿæ˜¯ä»äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šæ¯•ä¸šçš„ç¬¬ä¸€ä¸ªä»¥è§„èŒƒä¸å®‰å…¨æ€§ä¸ºé‡ç‚¹çš„é¡¹ç›®ã€‚ä¸æ­¤åŒæ—¶ï¼ŒTUF è¿˜æ˜¯é¦–ä¸ªæºè‡ªé«˜æ ¡çš„ CNCF æ¯•ä¸šé¡¹ç›®ã€‚

#### [kube-score](https://github.com/zegl/kube-score)

kube-score æ˜¯ K8s å¯¹è±¡é™æ€æ£€æŸ¥å·¥å…·ï¼Œé€šè¿‡åˆ†æ K8s å¯¹è±¡çš„ Yaml æ–‡ä»¶åšä¸€äº›æ¨èï¼Œä»¥æå‡å¯é æ€§å’Œå®‰å…¨æ€§ã€‚

## Ingress

### å¸¸è§ ingress å¯¹æ¯”åˆ—è¡¨

| [å…¨æ–‡](https://medium.com/flant-com/comparing-ingress-controllers-for-kubernetes-9b397483b46b) | Kubernetes Ingress                                           | NGINX Ingress                                                | Traefik                                                      | HAproxy                                                      | Contour                                                      |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Protocol                                                     | http/https, http2, grpc, tcp/udp (partial)                   | http/https, http2, grpc, tcp/udp                             | http/https, http2 (h2c), grpc, tcp, tcp+tls                  | http/https, http2, grpc, tcp, tcp+tls                        | http/https, http2, grpc, tcp/udp, tcp+tls                    |
| base                                                         | nginx                                                        | nginx/nginx plus                                             | traefik                                                      | haproxy                                                      | envoy                                                        |
| Traffic routing                                              | host, path (with regex)                                      | host, path                                                   | host (regex), path (regex), headers (regex), query, path prefix, method | host, path                                                   | host, path                                                   |
| Namespace limitations                                        | All cluster or specified namespaces                          | All cluster or specified namespaces                          | All cluster or specified namespaces                          | All cluster or specified namespaces                          | All cluster or specified namespaces                          |
| Traffic distribution                                         | canary, a/b (cookie balancing)                               | -                                                          | canary, blue-green, shadowing                                | blue-green, shadowing                                        | canary, blue-green                                           |
| Upstream probes                                              | retry, timeouts                                              | retry, active health checks (based on http probe for pod)   | retry, timeouts, active, circuit breaker                     | check-uri, check-address, check-port                         | timeouts, active                                             |
| è´Ÿè½½å‡è¡¡                                                     | round-robin, sticky sessions, least-conn, ip-hash, ewma      | round-robin, least-conn, least-time, random, sticky sessions | weighted-round-robin, dynamic-round-robin, sticky sessions   | round-robin, static-rr, leastconn, first, source, uri, url_param, header, sticky sessions | round-robin, sticky sessions, weighted-least-request, ring hash, maglev, random |
| Authentication                                               | Basic, Client cert, external Basic, external OAuth           | Basic                                                        | Basic, auth-url, auth-tls, external auth                     | Basic, OAuth, Auth TLS                                       | -                                                          |
| Paid subscription                                            | -                                                          | +                                                            | +                                                            | +                                                            | -                                                          |
| GUI                                                          | -                                                          | +                                                         | +                                                            | -                                                          | -                                                          |
| JWT validation                                               | -                                                          | +                                                           | -                                                          | +                                                          | -                                                          |
| Basic DDoS protection                                        | rate limit, limit conn, liimt rps, limit rpm, limit-rate-after, limit-whitelist | rate limit, rate-limit-burst                                 | max-conn, rate limit, ip whitelist                           | limit-rps, limit-connections, limit-whitelist                | max-conn, max-request                                        |
| Requests tracing                                             | +                                                            | -                                                          | +                                                            | -                                                          | -                                                          |
| Config customization                                         | +                                                            | +                                                            | +                                                            | +                                                            | -                                                          |
| WAF                                                          | lua-resty-waf, ModSecurity                                   | +                                                           | -                                                          | ModSecurity                                                  | -                                                          |

### [Ingress NGINX](https://github.com/kubernetes/ingress-nginx)

Kubernetes å®˜æ–¹ç»´æŠ¤çš„æ–¹æ¡ˆ

### [Traefik](https://github.com/containous/traefik)

æ˜¯ä¸€ä¸ªç”¨ Golang å¼€å‘çš„è½»é‡çº§çš„ http åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ï¼Œè™½ç„¶ç›¸æ¯”äº nginx ï¼Œå®ƒæ˜¯åèµ·ä¹‹ç§€ï¼Œä½†æ˜¯å®ƒå¤©ç„¶æ‹¥æŠ± Kubernetesï¼Œç›´æ¥ä¸é›†ç¾¤ K8s çš„ api Serveré€šä¿¡ï¼Œååº”éå¸¸è¿…é€Ÿï¼Œå®æ—¶æ„ŸçŸ¥é›†ç¾¤ä¸­ ingress å®šä¹‰çš„è·¯ç”±è§„åˆ™é›†åˆå’Œåç«¯ Serviceã€Pod çš„å˜åŒ–ï¼Œè‡ªåŠ¨çƒ­æ›´æ–° Traefik åç«¯é…ç½®ï¼Œæ ¹æœ¬ä¸ç”¨åˆ›å»º ingress controller å¯¹è±¡ï¼ŒåŒæ—¶è¿˜æä¾›äº†å‹å¥½çš„æ§åˆ¶é¢æ¿å’Œç›‘æ§ç•Œé¢ï¼Œä¸ä»…å¯ä»¥æ–¹ä¾¿åœ°æŸ¥çœ‹ Traefik æ ¹æ® ingress ç”Ÿæˆçš„è·¯ç”±é…ç½®ä¿¡æ¯ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹ç»Ÿè®¡çš„ä¸€äº›æ€§èƒ½æŒ‡æ ‡æ•°æ®ï¼Œå¦‚ï¼šæ€»å“åº”æ—¶é—´ã€å¹³å‡å“åº”æ—¶é—´ã€ä¸åŒçš„å“åº”ç è¿”å›çš„æ€»æ¬¡æ•°ç­‰ã€‚

### [Contour](https://github.com/projectcontour/contour)

Contour ä¸ä»…åŸºäº Envoyï¼Œè€Œä¸”è¿˜ä¸è¯¥æµè¡Œä»£ç†çš„ä½œè€…å…±åŒå¼€å‘ã€‚é€šè¿‡ç‰¹æ®Šçš„ CRDï¼ˆç§°ä¸º Ingress Route çš„æ–°API ï¼‰ç®¡ç† Ingress èµ„æºçš„èƒ½åŠ›æ˜¯å…¶ç‰¹æ®ŠåŠŸèƒ½ã€‚å¯¹äºå…·æœ‰å¤šä¸ªå¼€å‘å›¢é˜Ÿå¹¶å‘ä½¿ç”¨ä¸€ä¸ªé›†ç¾¤çš„ç»„ç»‡ï¼Œè¿™æœ‰åŠ©äºä¿æŠ¤ç›¸é‚»ç¯å¢ƒä¸­çš„æµé‡å¹¶ä¿æŠ¤å®ƒä»¬å…å— Ingress èµ„æºæ›´æ”¹æ—¶äº§ç”Ÿçš„é”™è¯¯çš„å½±å“ã€‚

å®ƒè¿˜æä¾›äº†ä¸€ç»„æ‰©å±•çš„å¹³è¡¡ç®—æ³•ï¼ˆé•œåƒï¼Œè‡ªåŠ¨é‡å¤ï¼Œé™åˆ¶è¯·æ±‚ç‡ç­‰ç­‰ï¼‰ï¼Œè¯¦ç»†çš„æµé‡å’Œæ•…éšœç›‘æ§ã€‚å¯¹äºæŸäº›äººæ¥è¯´ï¼Œä¹Ÿè®¸ç¼ºå°‘å¯¹ç²˜æ€§ä¼šè®®çš„æ”¯æŒå°†æ˜¯ä¸€ä¸ªä¸¥é‡çš„ç¼ºé™·ï¼ˆæœè¿™ä¸ªæ–¹å‘çš„ [æŒç»­åŠªåŠ›](https://link.zhihu.com/?target=https%3A//github.com/projectcontour/contour/issues/361) å·²ç»èµ°äº†å¾ˆé•¿ä¸€æ®µè·¯ï¼‰ã€‚

#### [F5 BIG-IP Controller](https://clouddocs.f5.com/products/connectors/K8s-bigip-ctlr/v1.5/)

F5 æ‰€å¼€å‘çš„æ§åˆ¶å™¨ï¼Œå®ƒèƒ½å¤Ÿè®©ç®¡ç†å‘˜é€šè¿‡ CLI æˆ– API è®© Kubernetes ä¸ OpenShift ç®¡ç† F5 BIG-IP è®¾å¤‡ã€‚

## æ€§èƒ½æµ‹è¯•

### é«˜å¯ç”¨æµ‹è¯•

#### åº”ç”¨é«˜å¯ç”¨

ä½¿ç”¨å·¥å…·éšæœºæ€æ­»é›†ç¾¤ä¸­ä¸€åŠçš„ Pod ï¼Œæ¥æµ‹è¯•å·¥ä½œè´Ÿè½½çš„å¯ç”¨æ€§ã€‚

-  [berkay-dincer/kubethanos](https://github.com/berkay-dincer/kubethanos)

- [asobti](https://github.com/asobti)/[kube-monkey](https://github.com/asobti/kube-monkey)
-  [linki](https://github.com/linki)/[chaoskube](https://github.com/linki/chaoskube)

### ç½‘ç»œæ€§èƒ½æµ‹è¯•

#### [End-to-End Testing in Kubernetes](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-testing/e2e-tests.md)

### å­˜å‚¨æ€§èƒ½æµ‹è¯•

- [Kubernetes å­˜å‚¨æ€§èƒ½å¯¹æ¯”](https://blog.fleeto.us/post/kubernetes-storage-performance-comparison/)_
- [K8såˆ†å¸ƒå¼å­˜å‚¨æ–¹æ¡ˆçš„é€‰æ‹©](https://www.v2ex.com/t/453961)
- [Kubernetesç½‘ç»œåŸç†åŠæ–¹æ¡ˆ](http://www.youruncloud.com/blog/131.html)
- [kubernetesé‡Œå­˜å‚¨æ¦‚å¿µçš„è§£ç–‘](http://www.yangguanjun.com/2017/09/04/kubernetes-storage-confuse/)
- [åŸºäº GlusterFS å®ç° Docker é›†ç¾¤çš„åˆ†å¸ƒå¼å­˜å‚¨](https://www.ibm.com/developerworks/cn/opensource/os-cn-glusterfs-docker-volume/index.html)
- [ä¸ºä»€ä¹ˆKubernetesçš„å­˜å‚¨å¦‚æ­¤è‰°éš¾?](http://storage.it168.com/a2019/0114/5145/000005145601.shtml)
- [Rook & Ceph ç®€ä»‹](https://blog.fleeto.us/post/the-ultimate-rook-and-ceph-survival-guide/)
- [åŸºäºRookçš„Kuberneteså­˜å‚¨æ–¹æ¡ˆ](https://blog.gmem.cc/rook-based-K8s-storage-solution)
- [cephå­˜å‚¨ä¸‰åäº¿ä¸ªå°æ–‡ä»¶çš„å®è·µ](http://www.strugglesquirrel.com/2018/08/09/cephå­˜å‚¨ä¸‰åäº¿ä¸ªå°æ–‡ä»¶çš„å®è·µ/)
- [åˆ†å¸ƒå¼å—å­˜å‚¨ç³»ç»ŸUrsaçš„è®¾è®¡ä¸å®ç°](https://tech.meituan.com/2016/03/11/block-store.html)
- [æœ€è¿‘ä¹Ÿåœ¨æŠ˜è…¾ kubernetesç»™ä½ ä¸€ä¸ªåˆ†äº«](http://www.yangguanjun.com/2017/09/04/kubernetes-storage-confuse/)

## å‘¨è¾¹

### [dashboard](https://github.com/kubernetes/dashboard)

### [Octant](https://github.com/vmware/octant)

### [Kuboard](https://kuboard.cn/)

### [Kustomize](https://github.com/kubernetes-sigs/kustomize/releases)

**ç‰¹æ€§ï¼š**

- åŠŸèƒ½ç®€å•æ¸…æ™°ï¼Œkubectl ç›´æ¥æ”¯æŒã€‚
- ä¸è€ƒè™‘æ´¾ç”Ÿï¼Œä»…ä½œä¸ºåº”ç”¨çš„ YAML ç»„ç»‡æ–¹å¼ä¹Ÿå¾ˆæœ‰å¸®åŠ©ã€‚
- ä¹Ÿæœ‰è‡ªå·±çš„æ’ä»¶ç³»ç»Ÿã€‚ä¾‹å¦‚å¯ä»¥ç”¨ç®€å•çš„ YAML å®šä¹‰ï¼Œä½¿ç”¨æ–‡ä»¶ç”Ÿæˆ Configmap/Secretã€‚

### [helm](https://helm.sh/)

**ç‰¹æ€§ï¼š**

- å¼ºå¤§çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šæœ‰ Tiller çš„å¸®åŠ©ï¼Œå¯ä»¥å®ç°å¯¹åº”ç”¨ç¨‹åºå®ä¾‹ï¼ˆReleaseï¼‰çš„æŸ¥è¯¢ã€å®‰è£…ã€å¸è½½ã€å‡çº§ã€å›æ»šç­‰å¤æ‚æ“ä½œã€‚
- ä¸¥æ ¼çš„åŸºç¡€ç‰ˆæœ¬ç®¡æ§ï¼šChart æ˜¯ä¸€ç§æ¨¡æ¿ï¼ŒChart çš„ç”¨æˆ·ä»…èƒ½é€šè¿‡å¯¹ `values` çš„æ§åˆ¶æ¥å®šåˆ¶åº”ç”¨çš„éƒ¨ç½²è¡Œä¸ºï¼Œæ¨¡æ¿ä¸­æ²¡æœ‰æä¾›å˜é‡çš„ä½ç½®ï¼Œæ˜¯æ— æ³•åœ¨ä¸‹æ¸¸ç›´æ¥è¿›è¡Œå˜æ›´çš„ã€‚
- æ–¹ä¾¿çš„å‘½ä»¤è¡Œï¼šå¯¹äºç®€å•å˜é‡ï¼Œå¯ä»¥åœ¨éƒ¨ç½²çš„åŒæ—¶ç›´æ¥æŒ‡å®šå†…å®¹ï¼Œæ–¹ä¾¿éƒ¨ç½²ã€‚
- æ’ä»¶å’Œå·¥å…·ï¼šHelm æ‹¥è¶¸ä¼—å¤šï¼Œæä¾›äº†ä¸å°‘ç”¨äº CICD æˆ–è€…å…¶å®ƒæ–¹é¢è¾…åŠ©åŠŸèƒ½çš„æ’ä»¶å’Œå·¥å…·ã€‚

 **V3**

- ç§»é™¤Tiller ç»„ä»¶ï¼šåªæœ‰helmè¿™ä¸ªå®¢æˆ·ç«¯æ¥å’Œkubernetesé›†ç¾¤è¿›è¡Œäº¤äº’æ“ä½œã€‚helm2çš„äº¤äº’æµç¨‹ï¼š `helm client â€“gRPCâ€“> helm server (Tiller) â€“> kubernetes api (install chart)`
- Release name å¯ç¼©å°è‡³NamespaceèŒƒå›´ï¼ˆæ„å‘³ç€release name å¯é‡å¤ï¼‰ï¼šhelm2 ä¸­çš„ release name æ˜¯å…¨å±€çš„ï¼Œæ„å‘³ç€å³ä½¿å®‰è£…æŸä¸ªchartåˆ°ä¸åŒçš„Namespaceï¼Œrelease nameåå­—ä¹Ÿä¸èƒ½ä¸€æ ·ã€‚Chart Release è®°å½•éƒ½å’Œ Tiller æœåŠ¡ä¸€èµ·ï¼Œåœ¨ä¸€ä¸ª Namespace ä¸­ã€‚ç°åœ¨ç”±äºç§»é™¤äº† Tiller ç»„ä»¶ï¼Œæ¯ä¸ª chart çš„ Release è®°å½•ä¸å®ƒéƒ¨ç½²åˆ°å“ªä¸ª namespace ä¸€æ ·ï¼Œå­˜åœ¨åŒä¸€ä¸ª Namespaceä¸­ ã€‚è¿™æ ·å°±å¯ä»¥åœ¨ä¸åŒ Namespace ä¸­ä½¿ç”¨åŒä¸€ä¸ªRelease nameã€‚
- é»˜è®¤å…³é—­éšæœºç”Ÿæˆrelease nameï¼Œéœ€è¦æ˜¾ç¤ºå¯ç”¨é€‰é¡¹ `--generate-name`
- ç§»é™¤ helm serve æä¾›æœ¬åœ°repository åŠŸèƒ½
- å°†requirements.yamlçš„å†…å®¹ç§»åˆ°Chart.yamlæ–‡ä»¶ä¸­
- æ”¯æŒ helm push åˆ°è¿œç«¯ chart repositoryï¼Œæ”¯æŒç™»é™†è®¤è¯
- æ”¯æŒ Chart Libraryï¼ˆkeeping charts DRY.ï¼‰
- ç®€åŒ–å†…ç½®æ¨¡ç‰ˆé‡Œé¢çš„å¯¹è±¡
- ä½¿ç”¨JSONSchemaéªŒè¯chartçš„Values

### [Operator](https://coreos.com/operators/)

Operator æ˜¯ç”± CoreOS å¼€å‘çš„ï¼Œç”¨æ¥æ‰©å±• Kubernetes APIï¼Œç‰¹å®šçš„åº”ç”¨ç¨‹åºæ§åˆ¶å™¨ï¼Œå®ƒç”¨æ¥åˆ›å»ºã€é…ç½®å’Œç®¡ç†å¤æ‚çš„æœ‰çŠ¶æ€åº”ç”¨ï¼Œå¦‚æ•°æ®åº“ã€ç¼“å­˜å’Œç›‘æ§ç³»ç»Ÿã€‚Operator åŸºäº Kubernetes çš„èµ„æºå’Œæ§åˆ¶å™¨æ¦‚å¿µä¹‹ä¸Šæ„å»ºï¼Œä½†åŒæ—¶åˆåŒ…å«äº†åº”ç”¨ç¨‹åºç‰¹å®šçš„é¢†åŸŸçŸ¥è¯†ã€‚åˆ›å»ºOperator çš„å…³é”®æ˜¯CRDï¼ˆè‡ªå®šä¹‰èµ„æºï¼‰çš„è®¾è®¡ã€‚

Kubernetes 1.7 ç‰ˆæœ¬ä»¥æ¥å°±å¼•å…¥äº†[è‡ªå®šä¹‰æ§åˆ¶å™¨](https://kubernetes.io/docs/concepts/api-extension/custom-resources/)çš„æ¦‚å¿µï¼Œè¯¥åŠŸèƒ½å¯ä»¥è®©å¼€å‘äººå‘˜æ‰©å±•æ·»åŠ æ–°åŠŸèƒ½ï¼Œæ›´æ–°ç°æœ‰çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨æ‰§è¡Œä¸€äº›ç®¡ç†ä»»åŠ¡ï¼Œè¿™äº›è‡ªå®šä¹‰çš„æ§åˆ¶å™¨å°±åƒ Kubernetes åŸç”Ÿçš„ç»„ä»¶ä¸€æ ·ï¼ŒOperator ç›´æ¥ä½¿ç”¨ Kubernetes APIè¿›è¡Œå¼€å‘ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä»¬å¯ä»¥æ ¹æ®è¿™äº›æ§åˆ¶å™¨å†…éƒ¨ç¼–å†™çš„è‡ªå®šä¹‰è§„åˆ™æ¥ç›‘æ§é›†ç¾¤ã€æ›´æ”¹ Pods/Servicesã€å¯¹æ­£åœ¨è¿è¡Œçš„åº”ç”¨è¿›è¡Œæ‰©ç¼©å®¹ã€‚

Operator Framework åŒæ ·ä¹Ÿæ˜¯ CoreOS å¼€æºçš„ä¸€ä¸ªç”¨äºå¿«é€Ÿå¼€å‘ Operator çš„å·¥å…·åŒ…ï¼Œè¯¥æ¡†æ¶åŒ…å«ä¸¤ä¸ªä¸»è¦çš„éƒ¨åˆ†ï¼š

- Operator SDK: æ— éœ€äº†è§£å¤æ‚çš„ Kubernetes API ç‰¹æ€§ï¼Œå³å¯è®©ä½ æ ¹æ®ä½ è‡ªå·±çš„ä¸“ä¸šçŸ¥è¯†æ„å»ºä¸€ä¸ª Operator åº”ç”¨ã€‚
- Operator Lifecycle Manager OLM: å¸®åŠ©ä½ å®‰è£…ã€æ›´æ–°å’Œç®¡ç†è·¨é›†ç¾¤çš„è¿è¡Œä¸­çš„æ‰€æœ‰ Operatorï¼ˆä»¥åŠä»–ä»¬çš„ç›¸å…³æœåŠ¡ï¼‰

 **å·¥ä½œæµç¨‹ï¼š**

1. ä½¿ç”¨ SDK åˆ›å»ºä¸€ä¸ªæ–°çš„ Operator é¡¹ç›®
2. é€šè¿‡æ·»åŠ è‡ªå®šä¹‰èµ„æºï¼ˆCRDï¼‰å®šä¹‰æ–°çš„èµ„æº API
3. æŒ‡å®šä½¿ç”¨ SDK API æ¥ watch çš„èµ„æº
4. å®šä¹‰ Operator çš„åè°ƒï¼ˆreconcileï¼‰é€»è¾‘
5. ä½¿ç”¨ Operator SDK æ„å»ºå¹¶ç”Ÿæˆ Operator éƒ¨ç½²æ¸…å•æ–‡ä»¶

### [kubebuilder](https://github.com/kubernetes-sigs/kubebuilder/releases)

ç›®å‰æ‰©å±• Kubernetes çš„ API çš„æ–¹å¼æœ‰åˆ›å»º [CRD](https://jimmysong.io/kubernetes-handbook/concepts/crd.html)ã€ä½¿ç”¨ [Operator](https://jimmysong.io/kubernetes-handbook/develop/operator.html) SDK ç­‰æ–¹å¼ï¼Œéƒ½éœ€è¦å†™å¾ˆå¤šçš„æ ·æœ¬æ–‡ä»¶ï¼ˆboilerplateï¼‰ï¼Œä½¿ç”¨èµ·æ¥ååˆ†éº»çƒ¦ã€‚ä¸ºäº†èƒ½å¤Ÿæ›´æ–¹ä¾¿æ„å»º Kubernetes API å’Œå·¥å…·ï¼Œå°±éœ€è¦ä¸€æ¬¾èƒ½å¤Ÿäº‹åŠåŠŸå€çš„å·¥å…·ï¼Œä¸å…¶ä»– Kubernetes API æ‰©å±•æ–¹æ¡ˆç›¸æ¯”ï¼Œkubebuilder æ›´åŠ ç®€å•æ˜“ç”¨ï¼Œå¹¶è·å¾—äº†ç¤¾åŒºçš„å¹¿æ³›æ”¯æŒã€‚

é€šè¿‡ Operator çš„æ–¹æ¡ˆï¼Œå¯ä»¥å¯¹ Kubernetes çš„åŠŸèƒ½è¿›è¡Œå‹å¥½åœ°æ‰©å±•ã€‚Operatpr = CRD + Controllerã€‚é¦–å…ˆé€šè¿‡ yaml å®šä¹‰ï¼Œç”Ÿæˆ CRD ï¼Œç„¶å Controller ä¸æ–­åœ°ç›‘å¬ etcd ä¸­çš„æ•°æ®ï¼Œæ‰§è¡Œç›¸åº”åŠ¨ä½œã€‚å¼€å‘ Operator æ—¶ï¼Œæœ‰å¾ˆå¤šç¹çä¸”é‡å¤çš„äº‹æƒ…ã€‚KubeBuilder å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç”Ÿæˆéª¨æ¶ä»£ç ï¼Œå¼€å‘ä¸€ä¸ª Kubernetes çš„æ‰©å±•åŠŸèƒ½ï¼Œ æ›´å¤šä»‹ç»å¯ä»¥å‚è€ƒæ–‡æ¡£ï¼š[Kubernetes å¤æ‚æœ‰çŠ¶æ€åº”ç”¨ç®¡ç†æ¡†æ¶ â€“ Operator](https://www.chenshaowen.com/blog/complex-application-management-framework-operator-for-kubernetes.html)

**å·¥ä½œæµç¨‹ï¼š**

1. åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹ç›®å½•
2. åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªèµ„æº API CRD ç„¶åå°†å­—æ®µæ·»åŠ åˆ°èµ„æº
3. åœ¨æ§åˆ¶å™¨ä¸­å®ç°åè°ƒå¾ªç¯ï¼ˆreconcile loopï¼‰ï¼Œwatch é¢å¤–çš„èµ„æº
4. åœ¨é›†ç¾¤ä¸­è¿è¡Œæµ‹è¯•ï¼ˆè‡ªåŠ¨å®‰è£… CRD å¹¶è‡ªåŠ¨å¯åŠ¨æ§åˆ¶å™¨ï¼‰
5. æ›´æ–°å¼•å¯¼é›†æˆæµ‹è¯•æµ‹è¯•æ–°å­—æ®µå’Œä¸šåŠ¡é€»è¾‘
6. ä½¿ç”¨ç”¨æˆ·æä¾›çš„ Dockerfile æ„å»ºå’Œå‘å¸ƒå®¹å™¨
