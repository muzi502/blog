---
title: åƒåœ¾ä½¬çš„ Homelab æŠ˜è…¾è®°å½•
date: 2020-08-21
updated: 202008-21
slug: 
categories: æŠ€æœ¯
tag:
  - æ¡åƒåœ¾
  - NAS
copyright: true
comment: true
---

## æ¡åƒåœ¾

æ¥è‡ª [@awpak78 ](https://space.bilibili.com/1292029)çš„å›¾ğŸ‘‡

![20200801_150112](https://blog.k8s.li/img/20200801_150112.jpg)

ä½œä¸ºä¸€åè¿ç»´å·¥ç¨‹å¸ˆï¼Œç™½å¤©åœ¨å·¥åœ°ä¸Šæ¬ç –å…»å®¶ç³Šå£ï¼Œæ™šä¸Šä¸‹ç­å›å®¶åå°±å¼€å§‹æŠ˜è…¾ä¸€å †ç ´é“œçƒ‚é“è‡ªå¨±è‡ªä¹ğŸ˜‚ã€‚æœ€è¿‘ä¸œæ‹¼è¥¿å‡‘èŠ±äº† 2000 æ¥å—é’±æ¡åƒåœ¾æ•´äº†å° HomeLab ç©ç©ï¼ŒæŠ˜è…¾ä¸€äº›æ²¡ç”¨çš„ä¸œè¥¿ğŸ™ƒ

å…¶å®å¾ˆæ—©ä¹‹å‰å°±æƒ³æä¸€å°ä½åŠŸè€—çš„ HomeLab ä¸»æœºç©å„¿äº†ï¼Œæœ€æ—©å¼€å§‹é€‰æ‹©çš„æ˜¯ Dell T1700 SFF + E3-1271V3 +32GB DDR3ï¼Œä½†æ˜¯å‘¢ï¼ŒE3 V3 ç³»åˆ—æ˜¯ Intel ç¬¬å››ä»£  CPU ï¼Œ1150 èŠ¯ç‰‡ç»„æ— æ³•ä» M.2 å¯åŠ¨ï¼Œç£ç›˜é€Ÿåº¦åªèƒ½è¾¾åˆ° SATA III ä¹Ÿå°±æ˜¯é¡¶å¤š 600 MB/s çš„è¯»å†™é€Ÿåº¦ï¼Œè€Œç›®å‰éšä¾¿ä¸€å—æ”¯æŒ  PCI-e M.2 NVMe çš„ä¸»æ¿æ™®ééƒ½èƒ½è¾¾åˆ° 3000MB/s äº†ã€‚æ‰€ä»¥è¿™ä¸€ç‚¹æ¥è®² E3 V3 å·²ç»ä¸å€¼å¾—æ¡äº†ã€‚è€Œä¸”æˆ‘æƒ³æŠŠæˆ‘å°å¼æœºä¸Š SN750 500GB æ¢åˆ°è¿™å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥è¿˜æ˜¯è¦é€‰æ‹©ä¸€ä¸ªæ”¯æŒ PCI-e M.2 NVMe çš„ä¸»æ¿ã€‚

| ç¡¬ä»¶ | é…ç½®                                         | ä»·æ ¼ |
| :--: | -------------------------------------------- | :--: |
| CPU  | Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz 35w | 480  |
| ä¸»æ¿ | Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼šIntel Â®Q170       | 400  |
| å†…å­˜ | é•å…‰ DDR4 16GB 2666MHz                       | 310  |
| æ˜¾å¡ | è‹±ç‰¹å°”Â® æ ¸èŠ¯æ˜¾å¡ 530                         |  0   |
| æœºç®± | Dell OptiPlex 7040 å‡†ç³»ç»Ÿ                    |  0   |
| ç”µæº | Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼š290W å¼€å…³ç”µæº     |  0   |
| UPS  | æŸæ‚ç‰Œ UPS 650VA360W                         | 160  |
| å›ºæ€ | ä¸‰æ˜Ÿ 970PRO 512GB                            | 820  |
| æ€»ä»· |                                              | 2170 |

### CPU

è‡³äº 6600T çš„æ€§èƒ½ï¼Œåœ¨ 500 å—é’±çš„ä»·ä½å†… 35Wä½åŠŸè€—çš„ 6600T è¿˜ç®—å¯ä»¥èƒ½æ¥å—ï¼Œä¸ºä»€ä¹ˆä¸ä¹° 7200U è¿™ç§ä½å‹ U å‘¢ï¼Ÿï¼Œä¸€æ˜¯ä½å‹ U çš„è£…æœºæˆæœ¬å¤ªé«˜ï¼Œè€Œä¸”æ€§ä»·æ¯”å¾ˆä½ï¼Œæˆ‘è¿˜è¦åœ¨ä¸Šé¢è·‘ä¸€å †è™šæ‹Ÿæœºï¼Œä½å‹ U ææ€•æ‰›ä¸ä½ï¼Œæ‰€ä»¥ä¸€å¼€å§‹å°±æ”¾å¼ƒäº†ä½å‹ U çš„è£…æœºæ–¹æ¡ˆã€‚

![](https://blog.k8s.li/img/HomeLab-1.jpg)

### ä¸»æ¿

ç”±äº Dell SFF ç³»åˆ—çš„æœºç®±æ˜¯å®šåˆ¶çš„ï¼Œå’Œæ™®é€šçš„ä¸»æ¿ä¸å¤ªä¸€æ ·ï¼Œä¹Ÿåªæœ‰è¿™æ ·æ‰èƒ½å¡è¿›è¿™ä¹ˆå°çš„ç©ºé—´ï¼Œå¯¹äº MFF ç³»åˆ—çš„åˆ™æ›´å°ä¸€ç‚¹ã€‚å¯¹äºè¿™ç§å°æœºç®±è€Œè¨€ï¼Œæ‹¥æœ‰ 2ä¸ª PCI-e\*4 å’Œä¸€ä¸ª PIC-e\*16 æ˜¯ç›¸å½“ä¸é”™äº†ï¼ŒPCI-e\*4å¯ä»¥è£…ä¸€ä¸ªé˜µåˆ—å¡ä¸ªä¸€ä¸ªå››ç½‘å£çš„ç½‘å¡ï¼ŒPIC-e\*16åˆå¯ä»¥è£…ä¸€ä¸ªä½åŠŸè€—çš„åˆ€å¡æ˜¾å¡ã€‚ç­‰åˆ°ä»¥åå°å¼æœºå‡çº§çš„ç¡¬ä»¶çš„æ—¶å€™å†æŠŠå°å¼æœºä¸Šçš„ GT1030 äº®æœºå¡æ”¾ä¸Šå»ã€‚ä¸‰ä¸ª SATA ä¸€ä¸ª M.2 æœ‰ç‚¹æ‰è¥Ÿè§è‚˜ï¼Œæœºç®±ç©ºé—´å°±é‚£ä¹ˆç‚¹ï¼Œå£å­å¤šäº†ç¡¬ç›˜ä¹Ÿå¡ä¸ä¸‹å‘€ğŸ˜‚ã€‚

| Model:          | [*Dell OptiPlex 7040 SFF*](https://www.dell.com/support/manuals/us/en/04/optiplex-7040-desktop/opti7040_sff_om/specifications?guid=guid-f058d593-d332-479e-9d55-6c6031fa6cba&lang=en-us) |
| --------------- | ------------------------------------------------------------ |
| Form factor:    | Small Form Factor                                            |
| CPU options:    | Intel Gen6 i3/i5/i7                                          |
| Chipset:        | [Intel Q170](https://ark.intel.com/content/www/us/en/ark/products/90587/intel-q170-chipset.html) |
| RAM slots:      | (4x) DIMM DDR4-2133                                          |
| Max RAM:        | 64 GB                                                        |
| USB Ports:      | (6x) USB3.0; (4x) USB2.0;                                    |
| Video Ports:    | (2x) Display Port 1.2; HDMI 1.4;                             |
| Other Ports:    | Serial; (2x) PS2; RJ45; Headset; Line-Out;                   |
| Optional Ports: | VGA; Media Card Reader;                                      |
| SATA:           | (3x) SATA 3.0*                                               |
| PCIe:           | PCIe 3.0 x16 (low profile); PCIe 3.0 x4 (low profile);       |
| M.2 slots:      | M.2 2280 M-key (PCIe 3.0 x4, SATA 3.0)                       |
| Drive bays:     | 3.5-inch/(2x)2.5-inch; 5.25-inch (slim);                     |
| Hard Drive:     | max 2TB; RAID 0 & 1;                                         |
| PSU:            | 180 W                                                        |
| Weight:         | 6.00 kg (13.22 lb)                                           |

-   ä» [The difference between Dell OptiPlex 3040 vs. 5040 vs. 7040](https://www.hardware-corner.net/guides/difference-optiplex-3040-vs-5040-vs-7040/) å·æ¥çš„ä¸€å¼ å›¾ç‰‡ğŸ‘‡

![img](https://blog.k8s.li/img/OptiPlex_5040SFF_motherboard.jpg)

### å†…å­˜

ä¸¤æ¡ 8GB DDR4 å†…ä»ä»æˆ‘å°å¼æœºä¸Šæ‹†ä¸‹æ¥çš„ï¼ŒåˆèŠ±äº† 300 å—é’±ä¹°äº†ä¸ªé•å…‰çš„ 16GB DDR4 è£…äº†ä¸Šå»ï¼Œè¿«äº æˆ‘çš„å°å¼æœº B350M-K çš„ç¼©æ°´æ¿åªæœ‰ä¸¤ä¸ªå†…å­˜æ’æ§½è€Œä¸”æ”¯æŒåˆ° 32GBï¼Œæš‚æ—¶è£…ä¸€ä¸ª 16GB çš„å§ï¼Œèƒ½ä»¥åå†è£…ä¸€ä¸ªä¸Šå»ã€‚

### å›ºæ€

å…¶å®æœ¬æ¥çš„é¢„ç®—ä¸‰æ˜Ÿ 970PRO 512GBæ²¡æ‰“ç®—ä¹°ï¼Œæ˜¯æˆ‘åœ¨æ‰¾ Dell OptiPlex 7040 æ—¶æ„å¤–ç¢°åˆ°çš„ä¸€ä¸ªè€å“¥ï¼Œè€Œä¸”è¿™å—å›ºæ€æ˜¯å¾·äºšçš„ï¼Œè¿˜ç®—é è°±ä¸€äº›ï¼Œäºæ˜¯å‰æ‰‹ä¹°äº†è¿™ä¸ªå—å›ºæ€ã€‚970PRO ç³»åˆ—çš„éƒ½æ˜¯ MLC çš„é¢—ç²’çš„å›ºæ€ç¡¬ç›˜ï¼Œé€š SM961 ä¸€æ ·æ˜¯å±äºä¼ å®¶å®ç³»åˆ—ğŸ˜‚ï¼Œä½†æ˜¯ SM961 æ·˜å®ä¸Šæ°´å¤ªæ·±ï¼Œæ¸…é›¶ç›˜å æ®å¤šæ•°ï¼Œæ‰€ä»¥ä¸å»ºè®®ä¹°ã€‚

æ­£å¥½æŠŠè¿™å— 970PRO æ¢åˆ°æˆ‘çš„å°å¼æœºä¸Šï¼ŒæŠŠå°å¼æœºä¸Šçš„ SN750 512GB æ¢åˆ° HomeLab æœºå™¨ä¸Šï¼Œç»™ ESXi ä¸Šçš„è™šæ‹Ÿæœºç”¨ã€‚åœ¨ç©å„¿è™šæ‹ŸåŒ–çš„æ—¶å€™æ·±æœ‰æ„Ÿè§¦ï¼Œå®¿ä¸»æœºçš„ç£ç›˜æ˜¯æœºæ¢°ç¡¬ç›˜çš„è¯ï¼Œä¸Šé¢çš„è™šæ‹Ÿæœºè¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå¾ˆå¡ï¼Œæ‰€ä»¥ç© ESXi è™šæ‹ŸåŒ–ï¼Œæœ‰å—å›ºæ€çš„ä½“éªŒæ˜¯éå¸¸çˆ½æ»´ğŸ˜‹ã€‚

## è£…æœº

å…¶å®è£…æœºå¾ˆå¿«ï¼Œç”±äºæ˜¯ä¹°çš„ Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼Œæ‰€ä»¥åªéœ€è¦æŠŠ CPU ã€å†…å­˜ã€ç¡¬ç›˜è£…ä¸Šå»å°±å®Œäº‹å„¿äº†ã€‚

æ”¶åˆ°å‡†ç³»ç»Ÿåå‘ç°æ²¡æœ‰å¸¦ M.2 èºä¸ï¼Œåªèƒ½ä¸´æ—¶æ‹¿èƒ¶å¸¦ç²˜ç³Šä¸Šå»ï¼Œå‹‰å¼ºæ’‘äº†ä¸¤å¤©ï¼Œåæ¥ä¹°äº†ä¸ªèºä¸å’Œæ•£çƒ­ç‰‡å®Œç¾åœ°è§£å†³äº†ã€‚

![](https://blog.k8s.li/img/HomeLab-5.jpg)

ä»ä»¥å‰æ—§ç¬”è®°æœ¬æ·˜æ±°ä¸‹æ¥çš„ 2TB 5400RPM çš„çŸ³å¤´ç›˜ï¼Œå·²ç»å‡ºç°åé“äº†ï¼Œä¸´æ—¶å½“ä¸ªä¸‹è½½ç›˜å§ï¼Œåœ¨å®ƒè¿˜æ²¡å½»åº•å´©ç›˜ä¹‹å‰å†å‹æ¦¨ä¸€ä¸‹å®ƒå§ğŸ˜‚ã€‚åé¢æ‰“ç®—å†æ·»åŠ ä¸€å—12TBçš„æ°¦æ°”ç›˜å½“ä»“åº“ç›˜å’Œå¤‡ä»½æ•°æ®ä½¿ç”¨ï¼Œæœ‰äº† UPS å’Œè¿™å°ä¸»æœº 7*24 å°æ—¶å¼€æœºä¹Ÿæ²¡å•¥é—®é¢˜äº†ã€‚

![](https://blog.k8s.li/img/HomeLab-3.jpg)

åé¢é‚£å°æ˜¯æˆ‘çš„å°å¼æœºï¼Œä¹Ÿæ˜¯å»å¹´è¿™æ—¶å€™ä¹°çš„ï¼Œä¸¤è€…æ¯”è¾ƒèµ·æ¥ SFF çš„å‹å·ç¡®å®å°å¾ˆå¤šã€‚Dell çš„è¿™ç§ä¸»æœºè¿˜æœ‰ä¸€ç§ MFF å‹å·çš„ï¼Œé‚£ç§æ›´å°ä¸€äº›ï¼Œå·®ä¸å¤šæ¯”è·¯ç”±å™¨å¤§ä¸€äº›è€Œå·²ï¼Œä¸è¿‡æ‰©å±•æ€§ä¸å¥½ï¼Œè€Œä¸”è¿˜éœ€è¦å¤–ç½®ç”µæºï¼Œä¹Ÿå°±æ²¡è€ƒè™‘ï¼Œä¸è¿‡ç°åœ¨æƒ³æƒ³æœ‰ç‚¹åæ‚”äº†ï¼Œå½“åˆåº”è¯¥å¤šåŠ ç‚¹é’±ä¹° SFF çš„ï¼Œä¸è¿‡è¿˜å¥½ä¹Ÿèƒ½æ¥å—ï¼Œåªä¸è¿‡ä½“ç§¯å¤§äº†äº›ï¼Œæ¬å®¶çš„æ—¶å€™ä¸å¤ªæ–¹ä¾¿ã€‚

![](https://blog.k8s.li/img/HomeLab-4.jpg)

## ESXi

è£…å®Œæœºå™¨ä¹‹åå°±å¼€å§‹è£… ESXi ï¼Œå¯¹äºè™šæ‹ŸåŒ–ï¼ŒESXi ç®—æ˜¯æ¯”è¾ƒç†Ÿæ‚‰çš„äº†ï¼Œå¬è¯´ Proxmox VE ä¹Ÿä¸é”™ğŸ¤”ï¼Œç­‰åˆ°åé¢ç¡¬ç›˜åˆ°äº†å†æŠ˜è…¾ä¸€ä¸‹ Proxmox VEã€‚çœ‹åˆ°éš”å£ [Proxmox VEï¼šä¼˜ç§€çš„è‡ªå»ºè™šæ‹ŸåŒ–æ–¹æ¡ˆ](https://wzyboy.im/post/1293.html) æ„ˆå‘æƒ³ç©ç©äº†ã€‚

>   è´¯å½»ã€Œä¸é‡å¤é€ è½®å­ã€çš„åŸåˆ™ï¼Œå½“å‰ç‰ˆæœ¬çš„ PVE åŸºäºæˆç†Ÿç¨³å®šçš„ Debian 9 "Stretch" æ„å»ºã€‚åœ¨ç†Ÿæ‚‰å’Œä½¿ç”¨ PVE çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è¶Šå‘å–œæ¬¢å®ƒã€Œä¸é‡å¤é€ è½®å­ã€çš„ç‰¹æ€§ã€‚ç›¸è¾ƒä¹‹å‰ç”¨è¿‡çš„å…¶ä»–è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼ŒPVE çš„å†…éƒ¨æ„é€ å’Œå·¥ä½œåŸç†å¯¹æˆ‘æ¥è¯´ä¸å†æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œæˆ‘å¯ä»¥æ¸…æ™°åœ°è§‚æµ‹åˆ°å®ƒåœ¨å¹²ä»€ä¹ˆâ€”â€”æ¯”å¦‚è¦è¿ç§»ä¸€å°è™šæ‹Ÿæœºåˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘å°±å¯ä»¥é€šè¿‡ `ps` è§‚å¯Ÿåˆ°å®ƒå¯åŠ¨äº†ä¸€ä¸ª `dd` è¿›ç¨‹ï¼Œå¯¹æ¥ `ssh` ç®¡é“ï¼Œå°†ç£ç›˜æ•°æ®é€šè¿‡ç½‘ç»œå¤åˆ¶åˆ°ç›®æ ‡æœºå™¨â€”â€”è¿™ç§ä»¿ä½›é€æ˜æ‰‹è¡¨ä¸€æ ·èƒ½çœ‹åˆ°å†…éƒ¨å·¥ä½œåŸç†çš„æ„Ÿè§‰çœŸæ˜¯å¤ªæ£’äº†ï¼

ä» VMware å®¶ä¸‹è½½å¥½ `VMware-VMvisor-Installer-7.0.0-15843807.x86_64.iso` é•œåƒï¼Œæ‰¾äº†ä¸¤ä¸ª U ç›˜ï¼Œä¸€ä¸ªç”¨äº ESXi çš„å®‰è£…ç›˜ï¼Œä¸€ä¸ªç”¨äº ESXi çš„ç³»ç»Ÿç›˜ï¼Œå…¶ä¸­ä¸€ä¸ª U ç›˜è¿˜æ˜¯æˆ‘ç”¨è¯»å¡å™¨+16GBå†…å­˜å¡æ‹¼å‡‘è€Œæˆçš„ï¼Œç›®çš„æ˜¯ä¸ºäº†æŠŠ ESXi è£…åˆ° U ç›˜é‡Œæ–¹ä¾¿è¿ç§»æ•°æ®ä¹‹ç±»çš„ï¼Œä¹‹ååœ¨ç½‘ä¸Šæ‰¾ä¸€ä¸ªç¥ KEY æ¿€æ´»ä¸€ä¸‹ï¼ˆğŸ¤«å°å£°

![](https://blog.k8s.li/img/HomeLab-6.jpg)

### Ubuntu 20.04

å½“ä½œç½‘å…³æœºä½¿ç”¨ï¼Œå’Œæˆ‘æ‰€æœ‰çš„ äº‘ä¸»æœºæ‰“é€šç½‘ç»œï¼Œä½¿ç”¨ WireGuard ç»„æˆä¸€ä¸ªå°å†…ç½‘ï¼Œå…³äº WireGuard çš„ä½¿ç”¨å»ºè®®é˜…è¯»å¤§ä½¬å†™å¾—åšå®¢ [WireGuard æ•™ç¨‹ï¼šWireGuard çš„æ­å»ºä½¿ç”¨ä¸é…ç½®è¯¦è§£](https://fuckcloudnative.io/posts/wireguard-docs-practice/) ä»¥åŠ [WireGuard æ•™ç¨‹ï¼šWireGuard çš„å·¥ä½œåŸç†](https://fuckcloudnative.io/posts/wireguard-docs-theory/)ã€‚

é¡ºå¸¦ç”¨ [ZBench](https://github.com/Aniverse/ZBench) æµ‹äº†ä¸€ä¸‹è™šæ‹Ÿæœºçš„ç£ç›˜æ€§èƒ½ï¼Œè¿˜ç®—å‹‰å¼ºè¯´çš„è¿‡å»ï¼Œå®é™…ä¸Š SN750 512GB åªæœ‰ 2GB å·¦å³çš„ç¼“å­˜ï¼Œå†™æ»¡æ¢ç²—ä¹‹åï¼Œå†™å…¥çš„æ€§èƒ½ä¼šç›´çº¿ä¸‹é™åˆ° 800MB/sï¼Œè¯»çš„æ€§èƒ½å€’æ˜¯å¯ä»¥è¾¾åˆ° 3200MB/s ä»¥ä¸Šï¼Œæˆ–è®¸æ˜¯ä¸»æ¿çš„é™åˆ¶ï¼Œæ²¡èƒ½è¾¾åˆ°ç†æƒ³çš„è¯»å†™æ€§èƒ½ã€‚

```ini
--------------------------------------------------------------------------
CPU model            : Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz
Number of cores      : 4
CPU frequency        : 2712.000 MHz
Total size of Disk   : 33.3 GB (7.7 GB Used)
Total amount of Mem  : 3935 MB (306 MB Used)
Total amount of Swap : 3934 MB (0 MB Used)
System uptime        : 4 days, 19 hour 47 min
Load average         : 0.13, 0.08, 0.03
OS                   : Ubuntu 20.04 LTS
Arch                 : x86_64 (64 Bit)
Kernel               : 5.4.0-42-generic
Virt                 : vmware
--------------------------------------------------------------------------
I/O speed(1st run)   :1.3 GB/s
I/O speed(2nd run)   :1.3 GB/s
I/O speed(3rd run)   :1.3 GB/s
```

### PhotonOS

è¿™ä¸ªæ˜¯ç³»ç»Ÿåœ¨æˆ‘å¦ä¸€ç¯‡åšå®¢ [Container Linux OS ä»å…¥å‘åˆ°çˆ¬å‡ºæ¥](https://blog.k8s.li/container-linux-os.html) é‡Œæåˆ°è¿‡ï¼ŒPhoton OSâ„¢ æ˜¯é’ˆå¯¹ VMware vSphereÂ® è™šæ‹ŸåŒ–å¹³å°è¿›è¡Œå†…æ ¸ä¼˜åŒ–çš„å®¹å™¨ä¸“ç”¨æ“ä½œç³»ç»Ÿï¼Œå°±å’Œ CoreOS ä¸€æ ·ã€‚ååˆ†é€‚åˆä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ï¼Œå½“ä½œ Kubernetes é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½æ¥ä½¿ç”¨ã€‚

-   ç³»ç»Ÿåˆå§‹åŒ–å¯åŠ¨ä¹‹åå†…å­˜ä»…ä»…ä½¿ç”¨äº† 45Mi

```shell
root@photon-machine [ ~ ]# free -h
              total        used        free      shared  buff/cache   available
Mem:          2.0Gi        45Mi       1.8Gi       0.0Ki        93Mi       1.8Gi
Swap:            0B          0B          0B
```

-   å¯åŠ¨ docker è¿›ç¨‹ä¹‹åçš„å ç”¨æƒ…å†µï¼Œä¹Ÿä»…ä»… 109Mi

```shell
root@photon-machine [ ~ ]# free -h
              total        used        free      shared  buff/cache   available
Mem:          2.0Gi       109Mi       1.6Gi       0.0Ki       238Mi       1.8Gi
Swap:            0B          0B          0B
```

-   ä½¿ç”¨ OVA è™šæ‹Ÿæœºæ¨¡æ¿å¯åŠ¨åçš„è™šæ‹Ÿæœºï¼Œç£ç›˜ä»…ä»…å ç”¨äº† 515MB ï¼Œç¡®å®æ˜¯ç›¸å½“è½»é‡åŒ–ï¼Œè¿™è¿˜æ˜¯åŒ…å«äº† dockerã€‚

```shell
root@photon-machine [ ~ ]# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/root        16G  515M   15G   4% /
devtmpfs        998M     0  998M   0% /dev
tmpfs          1000M     0 1000M   0% /dev/shm
tmpfs          1000M  532K  999M   1% /run
tmpfs          1000M     0 1000M   0% /sys/fs/cgroup
tmpfs          1000M     0 1000M   0% /tmp
/dev/sda2        10M  2.2M  7.9M  22% /boot/efi
tmpfs           200M     0  200M   0% /run/user/0
```

æ€»ä¹‹ï¼ŒPhotonOS æ˜¯ä¸ªå¾ˆè½»é‡çš„ OS ï¼Œé€‚åˆä¸“é—¨ç”¨æ¥è¿è¡Œä¸€äº›å®¹å™¨åŒ–çš„æœåŠ¡ï¼Œè¿™æ­£å¥½ç¬¦åˆæˆ‘çš„éœ€æ±‚ã€‚åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆä¸ç”¨ CoreOS ï¼ŒCoreOS å·²ç»å‡‰äº†ã€‚

### Alpine NFS

æŠŠæˆ‘ä¸€å—ç£ç›˜ç›´é€šç»™è¿™ä¸ªè™šæ‹Ÿæœºï¼Œä¸»è¦ç”¨æ¥ç»™ k8s é›†ç¾¤ä¸­çš„ Pod æŒ‚è½½ PVC æŒä¹…åŒ–å­˜å‚¨ä½¿ç”¨ã€‚

### Debian

ä¸»è¦æ˜¯ç”¨æ¥è¿è¡Œ K8s é›†ç¾¤ï¼Œç›®å‰åªæœ‰ä¸€ä¸ª  master å’Œä¸€ä¸ª node ç©ç©å„¿ï¼Œè·‘äº†ä¸€äº›è‡ªç”¨çš„æœåŠ¡ã€‚

### Windows

å½“ä¸‹è½½æœºä½¿ç”¨ï¼Œå¤–åŠ è¿è¡Œä¸€äº›ä¸å¾—ä¸ä½¿ç”¨çš„å›½äº§æ¯’ç˜¤è½¯ä»¶ğŸ˜¡

## é¢å¤–ç¡¬ä»¶

æ¡åƒåœ¾çš„ä¹è¶£å°±åœ¨äºè¶ŠæŠ˜è…¾è¶Šå¥½ç©ï¼Œäºæ˜¯åˆå¼€å§‹æ‰“ç®—æŠ˜è…¾ä¸€äº›

### UPS

ç”±äºæœ€è¿‘æˆ¿ä¸œå®¶é‡Œç»å¸¸æ–­ç”µï¼Œæœ‰æ—¶ä¸€å¤©æ–­ç”µå…«ä¹æ¬¡ï¼Œæ¯æ¬¡æ–­ç”µæˆ‘éƒ½æ‹…å¿ƒç€ç¡¬ç›˜é‡Œçš„è€å©†ä»¬ä¼šä¸ä¼šæŒ‚æ‰ï¼Œç´¢æ€§è¿˜æ˜¯ä¹°äº† UPS ï¼Œåœ¨é©¬äº‘å®¶çœ‹äº†çœ‹ï¼Œå¸¦ç»™ NAS è‡ªåŠ¨æ–­ç”µçš„ UPS æ™®éåœ¨ 400å—é’±ä»¥ä¸Šï¼Œè€Œä¸”æˆ‘è¿™ä¸ªè¿˜æ˜¯ä¸ªå‡çš„ NAS ï¼ŒUPS ä¸Šçš„ USB å£ä¸ä¸€å®šæ”¯æŒæˆ‘çš„ä¸»æœºã€‚æœ€åä¸ºäº†èŠ‚çœä¸€ä¸‹é¢„ç®—èŠ±å„¿ 160 å—é’±ä¹°äº†ä¸ªä¸æ”¯æŒ USB çš„ UPS ï¼Œä½†æ˜¯åˆä¸èƒ½æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºå®¶é‡Œçš„ 220V å¸‚ç”µæ–­ç”µä¹‹åï¼ŒUPS çš„ç”µé‡åªèƒ½ç»™ä¸»æœºç»­å‘½ 10~20min å·¦å³ï¼ŒUPS çš„ç”µé‡ç”¨å®Œä¹‹åå°±å—å±äº†ï¼Œç…§é˜³è¿˜æ˜¯æ–­ç”µã€‚æ‰€ä»¥åœ¨ UPS ç”¨å°½ç”µé‡è¿˜æ˜¯æ²¡æœ‰æ¥ç”µä¹‹å‰ï¼Œä¸€å®šè¦æƒ³åŠæ³•æŠŠä¸»æœºé€šè¿‡ poweroff çš„æ–¹å¼å®‰å…¨ä¼˜é›…æ»´å…³æœºã€‚

é¦–å…ˆè¦è€ƒè™‘çš„æ˜¯æ€ä¹ˆçŸ¥é“ 220V å¸‚ç”µæ–­ç”µäº†ï¼Œèµ·åˆæƒ³æœ‰æ²¡æœ‰ä¸ª 220V çš„ä¼ æ„Ÿå™¨ï¼Œæˆ‘å»ï¼Œæœ‰ç‚¹éš¾åº¦è¿˜æ˜¯ç®—äº†å§ã€‚æœ€åä¸€æƒ³ï¼Œå¯ä»¥é€šè¿‡ ping æˆ¿ä¸œå®¶å…‰çŒ«çš„æ–¹å¼ã€‚æˆ‘çš„è·¯ç”±å™¨å’Œä¸»æœºç­‰è®¾å¤‡è¿æ¥ UPS ï¼Œæˆ¿ä¸œå®¶çš„å…‰çŒ«å¹¶æ²¡æœ‰è¿æ¥ UPS ï¼Œæˆ‘åœ¨è·¯ç”±å™¨ä¸Šè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿå» ping æˆ¿ä¸œå®¶çš„å…‰çŒ«ï¼Œæ²¡æœ‰ ping é€šè¯´æ˜å°±æ˜¯æ–­ç”µäº†ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç½‘çº¿è¢«æ‹”æ‰äº†ï¼Œä½†æ¦‚ç‡å¾ˆå°ã€‚`! ping -c 8 A && ssh B "poweroff"` ä¸€è¡Œç®€å•çš„å‘½ä»¤å°±æ»¡è¶³äº†æˆ‘çš„éœ€æ±‚ï¼Œ

```shell
#!/bin/sh
echo "start" >> /tmp/power_status
if ! ping -c 32 192.168.1.1
then
    sleep 300
    ping -c 32 192.168.1.1 && exit 0
    sshpass -p "pwd" ssh root@192.168.0.210 "net rpc shutdown -I 192.168.0.240 -U admin%poweroff"
    sshpass -p "pwd" ssh root@192.168.0.200 "sh -c /suspend_vm.sh"
    echo "220v poweroff" >> /tmp/power_status
fi
```

å¯¹äº ESXi ä¸Šçš„è™šæ‹Ÿæœºï¼Œè¿˜æ˜¯é‡‡ç”¨äº†æŒ‚èµ·çš„æ–¹å¼ï¼Œå°†è™šæ‹Ÿæœºçš„å†…å­˜çŠ¶æ€ä¿å­˜åœ¨æ•°æ®å­˜å‚¨çš„ç£ç›˜é‡Œï¼Œè¿™æ ·é‡æ–°å¼€å¯è™šæ‹Ÿæœºåå°±èƒ½æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œè¿™ä¸€ç‚¹æœ‰ç‚¹åƒ Windows çš„ä¼‘çœ ã€‚

```shell
#!/bin/sh
for vm in $(/sbin/vmdumper -l | grep -v Alpine |  awk '{print $1}' | sed 's/wid=//g')
do
     /sbin/vmdumper ${vm} suspend_vm
done
```

### ç½‘ç®¡äº¤æ¢æœº

å½“æˆ‘ä»å°å¼æœºå‘ ESXI é‡Œçš„è™šæ‹Ÿæœºä¼ è¾“æ–‡ä»¶çš„æ—¶å€™ï¼Œå‘ç°ç½‘ç»œé€Ÿåº¦æœ€å¿«åªèƒ½è¾¾åˆ° 700Mbits/sec ï¼Œçœ‹æ¥åº”è¯¥æ˜¯è·¯ç”±å™¨çš„æ€§èƒ½ç“¶é¢ˆï¼Œäºæ˜¯æƒ³ç€å‡çº§ä¸€ä¸‹ç½‘ç»œè®¾å¤‡ï¼ŒæŠŠ R6300V2 è·¯ç”±å™¨å½“ä½œ AP æ¥ç”¨ï¼Œå°†æµé‡éƒ½æ±‡èšåˆ°ç½‘ç®¡äº¤æ¢æœºä¸Šã€‚

```shell
[  4] local 192.168.0.240 port 50718 connected to 192.168.0.123 port 5201
[ ID] Interval           Transfer     Bandwidth
[  4]   0.00-1.00   sec  83.8 MBytes   702 Mbits/sec
[  4]   1.00-2.00   sec  83.4 MBytes   700 Mbits/sec
[  4]   2.00-3.00   sec  83.6 MBytes   701 Mbits/sec
[  4]   3.00-4.00   sec  82.9 MBytes   695 Mbits/sec
[  4]   4.00-5.00   sec  83.8 MBytes   702 Mbits/sec
[  4]   5.00-6.00   sec  83.6 MBytes   701 Mbits/sec
[  4]   6.00-7.00   sec  83.5 MBytes   701 Mbits/sec
[  4]   7.00-8.00   sec  83.8 MBytes   703 Mbits/sec
[  4]   8.00-9.00   sec  83.8 MBytes   702 Mbits/sec
[  4]   9.00-10.00  sec  83.8 MBytes   702 Mbits/sec
[  4]  10.00-11.00  sec  83.8 MBytes   703 Mbits/sec
[  4]  11.00-12.00  sec  83.8 MBytes   703 Mbits/sec
[  4]  12.00-13.00  sec  83.9 MBytes   703 Mbits/sec
[  4]  13.00-14.00  sec  83.8 MBytes   703 Mbits/sec
[  4]  14.00-15.00  sec  83.8 MBytes   703 Mbits/sec
[  4]  15.00-16.00  sec  83.9 MBytes   704 Mbits/sec
[  4]  16.00-17.00  sec  83.4 MBytes   699 Mbits/sec
[  4]  17.00-18.00  sec  83.9 MBytes   703 Mbits/sec
[  4]  18.00-19.00  sec  83.6 MBytes   702 Mbits/sec
[  4]  19.00-20.00  sec  83.8 MBytes   702 Mbits/sec
[  4]  20.00-21.00  sec  83.9 MBytes   704 Mbits/sec
[  4]  21.00-22.00  sec  83.8 MBytes   703 Mbits/sec
[  4]  22.00-23.00  sec  83.9 MBytes   704 Mbits/sec
[  4]  23.00-24.00  sec  83.9 MBytes   703 Mbits/sec
[  4]  24.00-25.00  sec  83.9 MBytes   703 Mbits/sec
[  4]  25.00-25.20  sec  16.6 MBytes   698 Mbits/sec
```

```ini
â•­â”€debian@debian ~
â•°â”€$ qperf 192.168.0.123 -t 30 -vvu tcp_lat udp_lat tcp_bw udp_bw conf
tcp_lat:
    latency   =  98.7 us
    msg_size  =     1 bytes
    time      =    30 sec
    timeout   =     5 sec
udp_lat:
    latency   =  98 us
    msg_size  =   1 bytes
    time      =  30 sec
    timeout   =   5 sec
tcp_bw:
    bw        =  87.9 MB/sec
    msg_size  =    64 KiB (65,536)
    time      =    30 sec
    timeout   =     5 sec
udp_bw:
    send_bw   =  56.7 MB/sec
    recv_bw   =  56.7 MB/sec
    msg_size  =    32 KiB (32,768)
    time      =    30 sec
    timeout   =     5 sec
conf:
    loc_node   =  debian
    loc_cpu    =  16 Cores: AMD Ryzen 7 1700 Eight-Core   3.0GHz
    loc_os     =  Linux 4.4.0-18362
    loc_qperf  =  0.4.11
    rem_node   =  gateway
    rem_cpu    =  4 Cores: Intel Core i5-6600T @ 2.70GHz
    rem_os     =  Linux 5.4.0-42-generic
    rem_qperf  =  0.4.11
```

å‡†å¤‡ä¹° GS108E V2 æˆ–è€… GS105E V2ï¼Œ

### å››ç½‘å£ç½‘å¡

ä¸ºäº†æŠ˜è…¾ä¸€ä¸‹ç½‘å¡ç›´é€šã€ç«¯å£æ±‡èšã€overlay ç½‘ç»œå¸è½½ç­‰ç‰¹æ€§ï¼Œåé¢è¿˜è¦æ·»åŠ ä¸€å— [intel I350 T4 V2](https://www.intel.cn/content/www/cn/zh/products/docs/network-io/ethernet/10-25-40-gigabit-adapters/ethernet-i350-server-adapter-brief.html) ï¼Œé—²é±¼ä¸Šçš„ä»·æ ¼ä¹Ÿä¸æ˜¯å¾ˆè´µã€‚

![image-20200822195450798](https://blog.k8s.li/img/20200822195450798.png)

### é˜µåˆ—å¡

ç”±äºä¸»æ¿çš„ SATA æ¥å£æœ€å¤§åªæ”¯æŒåˆ° 2TB ï¼Œä¸ºäº†æ‰©å±•ä¸€ä¸‹å­˜å‚¨ï¼Œåªèƒ½é¢å¤–æ·»åŠ ä¸€å—é˜µåˆ—å¡äº†ï¼Œç”±äºä¸»æ¿çš„ PCIe æœ‰é™ï¼Œè€Œä¸”è¿™ä¹ˆå¤§ç‚¹çš„æœºç®±æœ€å¤šä¹Ÿå°±èƒ½å¡ä¸‹ 1 å— 3.5 å¯¸ç¡¬ç›˜å’Œ 3 å— 2.5 å¯¸ç¡¬ç›˜ï¼Œæ‰€ä»¥æ‰¾ä¸€å—å…¥é—¨çº§çš„é˜µåˆ—å¡å°±å¤Ÿäº†ï¼Œæœ€ç»ˆèŠ±äº† 50 å—é’±æ¡äº†ä¸€å— [ServeRAID H1110 SAS/SATA Controller](https://lenovopress.com/tips0831-serveraid-h1110) é˜µåˆ—å¡ï¼Œçœ‹æ¥ä¸€ä¸‹æ‰‹å†Œé‡Œçš„å‚æ•°ï¼Œå¤§æ¦‚ä¹Ÿèƒ½æš‚æ—¶æ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚

>   -   Four internal 6 Gbps SAS/SATA ports
>   -   One x4 mini-SAS internal connector (SFF-8087)
>   -   6 Gbps throughput per port
>   -   Based on LSI SAS2004 6 Gbps RAID on Chip (ROC) controller
>   -   x4 PCI Express 2.0 host interface
>   -   Supports RAID 0, 1, 1E, and 10
>   -   Connects to up to four SAS or SATA drives
>   -   SAS and SATA drives are supported, but the mixing of SAS and SATA in the same integrated volume is not supported
>   -   Supports simple-swap SATA and hot-swap SAS and SATA drives
>   -   Supports up to two integrated volumes
>   -   Supports up to two global hot-spare drives
>   -   Supports drive sizes greater than 2 TB for RAID 0, 1E, and 10 (not RAID 1)
>   -   Fixed stripe size of 64 KB
>   -   Compliant with Disk Data Format (DDF)
>   -   S.M.A.R.T. support

## åè®°

æ‡’å¾—å†™äº†