---
title: è½»é‡çº§å®¹å™¨ä¼˜åŒ–å‹ Linux å‘è¡Œç‰ˆ Photon OS
date: 2020-09-25
updated: 2020-09-25
slug:
categories: æŠ€æœ¯
tag:
  - å®¹å™¨
  - PhotonOS
  - Linux
copyright: true
comment: true
---

å‰æ®µæ—¶é—´æ¡åƒåœ¾ä¸œæ‹¼è¥¿å‡‘æäº†å° Homelab ğŸ‘‡ç©ç© ğŸ‘‰[ã€Šåƒåœ¾ä½¬çš„ Homelab æŠ˜è…¾è®°å½•ã€‹](https://blog.k8s.li/homelab.html) ã€‚

![](https://p.k8s.li/20200913_esxi_01.png)

æ€»ä½“æ¥è®²æ€§ä»·æ¯”é«˜ï¼ŒIntel i5-6600T çš„æ€§èƒ½å’Œ i5-6600 æŒå¹³ï¼Œæ¯”é‚£ç§ 8250U ä¹‹ç±»çš„ä½å‹ U è¦é«˜å¾ˆå¤šï¼Œè·‘ä¸€å †è™šæ‹Ÿæœºä¹Ÿä¸æˆé—®é¢˜ï¼Œç”šè‡³è·‘ä¸ªä¸‰ master + ä¸¤ node çš„ kubernetes é›†ç¾¤ä¹Ÿæ˜¯å¯ä»¥ğŸ˜‚ã€‚è‡³äºåŠŸè€—ï¼Œæ•´æœºå¾…æœºæ—¶ä¸åˆ° 30W ï¼Œä¸€å¤©ä¸åˆ° 1 åº¦ç”µï¼Œä¸ç”¨æ‹…å¿ƒç”µè´¹çˆ†è¡¨äº†ï¼›è‡³äºä»·æ ¼ï¼Œä¸€é¢— Intel i5-6600T  ä¸åˆ° 450 å—é’±ï¼Œè¿˜ä¸é¦™å˜›ğŸ™ƒã€‚

åœ¨ ESXi è¿è¡Œç€ä¸€äº›è™šæ‹Ÿæœºï¼Œæ¯”å¦‚ç”¨ WireGuard æ‰“é€š VPS ä¹‹é—´çš„ç½‘ç»œï¼Œè¿è¡Œåœ¨ä¸€ä¸ª alpine è™šæ‹Ÿæœºé‡Œä½œä¸ºç½‘å…³æœºä½¿ç”¨ï¼›æ¯”å¦‚ä½¿ç”¨ [Pi-holeÂ®](https://pi-hole.net/) æ¥æ„å»ºè‡ªå·±çš„ DNS æœåŠ¡å™¨ï¼Œç”¨æ¥æ‹¦æˆªå±è”½åŸŸåï¼›æ¯”å¦‚è¿è¡Œ time-machine æœåŠ¡ç”¨æ¥å®šæ—¶å¤‡ä»½ MacBook ï¼›æ¯”å¦‚ Windows è™šæ‹Ÿæœºé‡Œè¿è¡Œç€ä¸€äº›å›½äº§æ¯’ç˜¤è½¯ä»¶ğŸ˜¡ï¼›æ¯”å¦‚ä½¿ç”¨ [Drone](https://docs.drone.io/) è·‘ä¸€å¥—è½»é‡çº§çš„ CI æµæ°´çº¿ç³»ç»Ÿï¼Œæ€»ä¹‹å¯ç©æ€§éå¸¸é«˜å“¦ï¼Œåªè¦ä½ åˆæ—¶é—´çæŠ˜è…¾ï¼Œæ€»èƒ½æ‰¾ç‚¹ä¹å­ç©ğŸ˜‚ã€‚

## Linux Container OS ?

æœ‰äº†ä¸€å°è¿è¡Œç€ ESXi çš„ Homelab ï¼Œä»Šå¤©å°±ç©ä¸€ä¸‹ Linux container OS ï¼Œå³ Linux å®¹å™¨  OS ã€å®¹å™¨ä¼˜åŒ–å‹ OSï¼Œè¿™æ˜¯ä¸€ç±»ä¸“é—¨é’ˆå¯¹è¿è¡Œå®¹å™¨å®šåˆ¶åŒ–å¼€å‘çš„ Linux å‘è¡Œç‰ˆï¼Œè£å‰ªæ‰ä¸€äº›ä¸å¿…è¦çš„è½¯ä»¶å’Œå†…æ ¸æ¨¡å—ï¼Œä½¿ç³»ç»Ÿæ›´åŠ è½»é‡ä¸€äº›ã€‚è™½ç„¶æ¥è¯´æ°‘ç”¨çº§çš„ Intel i5-6600T æ€§èƒ½ä¹Ÿä¸ç®—å¤ªå·®ï¼Œä½†å’Œ E3  å°ç‹å­ï¼ŒE5 è€å¤§å“¥æ¯”è¿˜æ˜¯å·®ä¸ªåä¸‡å…«åƒé‡Œã€‚å› æ­¤ä¸ºäº†èŠ‚çœä¸€äº› CPU èµ„æºï¼Œå‡å°‘è™šæ‹ŸåŒ–å¸¦æ¥çš„å¼€é”€ï¼Œå°±é€‰æ‹©äº†å®¹å™¨åŒ–è¿è¡Œä¸€äº›åº”ç”¨ï¼ŒåŒæ—¶å†ä¸ºè¿™äº›å®¹å™¨æ‰¾ä¸€ä¸ªè½»é‡çº§çš„å®¿ä¸»æœº OS ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæƒ³è¦ä½¿ç”¨ Linux container OS çš„åŸå› ã€‚

### GKE çš„ [Container-Optimized OS](https://cloud.google.com/container-optimized-os/docs/)

Kubernetes çš„äº²çˆ¸çˆ¸ Google å®¶çš„ [Google Kubernetes Engine](https://cloud.google.com/kubernetes-engine) å³ GKE é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä½¿ç”¨ [Container-Optimized OS](https://cloud.google.com/container-optimized-os/docs/) æ¥è¿è¡Œå·¥ä½œè´Ÿè½½ï¼Œä¸è¿‡ä»…ä»…æ˜¯é’ˆå¯¹ GCE æ¥è¿›è¡Œä¼˜åŒ–çš„ï¼Œå¯èƒ½åœ¨ OpenStack æˆ–è€… vSphere ä¸Šè¿è¡Œä¸èµ·æ¥ï¼Œ(ççŒœğŸ˜‚ã€‚

>   Container-Optimized OS æ˜¯é€‚ç”¨äº [Compute Engine](https://cloud.google.com/compute) è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿæ˜ åƒï¼Œä¸“ä¸ºè¿è¡Œ Docker å®¹å™¨è€Œä¼˜åŒ–ã€‚å€ŸåŠ© Container-Optimized OSï¼Œæ‚¨å¯ä»¥å¿«é€Ÿã€é«˜æ•ˆã€å®‰å…¨åœ°åœ¨ Google Cloud Platform ä¸Šå¯åŠ¨ Docker å®¹å™¨ã€‚Container-Optimized OS ç”± Google ç»´æŠ¤ï¼ŒåŸºäº [Chromium OS](https://www.chromium.org/chromium-os) å¼€æ”¾æºä»£ç é¡¹ç›®ã€‚

ç‰¹ç‚¹å°±æ˜¯ä¸åŒäºå…¶ä»–çš„ Linux å‘è¡Œç‰ˆï¼Œè¿™ä¸ªæ˜¯åŸºäº [Chromium OS](https://www.chromium.org/chromium-os) å®šåˆ¶åŒ–å¼€å‘çš„ï¼Œå¯¹å†…æ ¸ç‰ˆæœ¬é€‰ç”¨çš„ä¹Ÿæ¯”è¾ƒæ¿€è¿›ï¼Œä¸€èˆ¬æ˜¯ `4.19.112+` æˆ–è€… `5.x` ç‰ˆæœ¬ï¼Œè¿™æ ·ä½ å°±ä¸ç”¨å†æ‹…å¿ƒåƒ CentOS 7.x ç³»åˆ—é‚£æ ·å„ç§å†…æ ¸ bug äº†ã€‚

```yaml
apiVersion: v1
items:
- apiVersion: v1
  kind: Node
  metadata:
    nodeInfo:
      architecture: amd64
      bootID: 0c517083-aaf6-75fc4b2204ba
      containerRuntimeVersion: docker://19.3.1
      kernelVersion: 4.19.112+
      kubeProxyVersion: v1.16.13-gke.1
      kubeletVersion: v1.16.13-gke.1
      machineID: 33a96ff3203d88c0a542
      operatingSystem: linux
      osImage: Container-Optimized OS from Google
      systemUUID: 33a96ff33d88c0a542
```

Chromium OS å°±æ˜¯ Google åŸºäº Linux å†…æ ¸å¼€å‘çš„æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥ Google ä¹Ÿæœ‰è¿™ä¸ªå®åŠ›é’ˆå¯¹è‡ªå®¶çš„ GCP äº‘å¹³å°è¿›è¡Œå®šåˆ¶åŒ–å¼€å‘ä¸ª OS å‡ºæ¥ï¼Œä¸“é—¨ç»™ kubernetes é›†ç¾¤è¿è¡Œä½¿ç”¨ï¼Œå®šåˆ¶åŒ–å¼€å‘çš„å¥½å¤„å°±æ˜¯å¯ä»¥å¸¦æ¥æ›´å¤šçš„æ–°ç‰¹æ€§ï¼ŒäºŒä¸å—åˆ¶äºä¸Šæ¸¸çš„ Linux å‘è¡Œç‰ˆçš„é™åˆ¶ã€‚æ¯”å¦‚ä¸ä¹…å‰ Google å®£å¸ƒå°†ä½¿ç”¨ [Cilium](https://cilium.io/) ä½œä¸º GKE çš„ä¸‹ä¸€ä»£æ•°æ®é¢ï¼Œ[New GKE Dataplane V2 increases security and visibility for containers](https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine) ï¼Œè€Œ Cilium è¿™é¡¹æŠ€æœ¯æ˜¯ä¾èµ–äºå¯¹ eBPF æŠ€æœ¯ï¼Œè€Œ eBPF åˆä¾èµ–äºå†…æ ¸ç‰¹æ€§çš„æ”¯æŒã€‚

### AWS çš„ [Bottlerocket OS](https://github.com/bottlerocket-os/bottlerocket)

è¿™ä¸ªæ˜¯ AWS æœ€è¿‘å¼€æºä¸“é—¨é’ˆå¯¹  EC2 è¿›è¡Œä¼˜åŒ–çš„ Linux Container OSï¼Œå’Œ GKE ä¸€æ ·ï¼Œåªæ˜¯é’ˆå¯¹äºè‡ªå®¶çš„ AWS å…¬æœ‰äº‘ï¼Œç”±äºæ˜¯æœ€è¿‘åˆšåˆšæ¨å‡ºçš„ï¼Œè¿˜æ²¡æ¥å¾—åŠå…³æ³¨ï¼Œæ‰€ä»¥å°±ä¸ä»‹ç»äº†ã€‚åŒ GKE çš„ Container-Optimized OS ä¸€æ ·ï¼Œä¸€èˆ¬å…¬æœ‰äº‘å®šåˆ¶åŒ–å¼€å‘çš„ Container OS ä»…ä»…åªé’ˆå¯¹è‡ªå®¶çš„äº‘å¹³å°ã€‚

>   ### Optimized performance through AWS integrations
>
>   AWS provided builds of Bottlerocket are optimized to run on Amazon EC2 and include support for the latest Amazon EC2 instance capabilities. They also have built-in integrations with AWS services for container orchestration, registries, and observability.

### CoreOS Container Linux

æ¥è‡ª CoreOS å›¢é˜Ÿçš„ CoreOS Container Linux ï¼Œå®ƒåº”è¯¥æ˜¯æœ€å¤è€çš„ Linux Container OS ï¼Œæ—©åœ¨ 2013 å¹´ 10 æœˆå°±å·²ç» release ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œé‚£æ—¶å€™çš„ docker è¿˜æ²¡æœ‰åœ¨ 0.x.x ç‰ˆæœ¬ã€‚

>   [v94.0.0](https://github.com/coreos/manifest/releases/tag/v94.0.0)
>
>   -   Git is now included by default as a number of people use it for shipping around assets, code, etc like a distributed rsync
>   -   Docker is upgraded to 0.6.3
>   -   xz is included to support new compression types
>   -   Custom OEMs can be provided via the cpio on PXE images

å®ƒæ²¡æœ‰åƒ yum æˆ– apt è¿™æ ·çš„åŒ…ç®¡ç†å™¨æ¥å®‰è£…è½¯ä»¶ï¼Œåœ¨ CoreOS ä¸­ä½ ä¸éœ€è¦å®‰è£…è½¯ä»¶ï¼Œå› ä¸ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½è¦ä½¿ç”¨ docker æ¥æ‰“åŒ…ã€‚

-   æœ€å°åŒ–çš„æ“ä½œç³»ç»Ÿï¼š å ç”¨å†…å­˜å¾ˆå°‘ï¼Œæ¯”å…¸å‹çš„æœåŠ¡å™¨ç‰ˆæœ¬ Linux å°‘å  40%çš„å†…å­˜ã€‚
-   æ˜“äºå‡çº§ï¼š CoreOS é‡‡ç”¨åŒç³»ç»Ÿåˆ†åŒºï¼ˆä¸»åŠ¨åˆ†åŒº/è¢«åŠ¨åˆ†åŒºï¼‰è®¾è®¡è€Œä¸æ˜¯é‡‡ç”¨ä¼ ç»Ÿçš„é€šè¿‡å‡çº§åŒ…æ¥å‡çº§ç³»ç»Ÿï¼Œè¿™ä½¿å¾—æ¯æ¬¡å‡çº§æ›´åŠ å¿«é€Ÿï¼Œå¯é å’Œæ˜“äºå›æ»šã€‚è¿™ä¸€ç‚¹æœ‰ç‚¹åƒ Android çš„ A/B åˆ†åŒºï¼Ÿ
-   é›†æˆ Dockerï¼š CoreOS é»˜è®¤é›†æˆ Docker å¹¶ä½œäº†å¾ˆå¥½çš„æ”¯æŒå’Œä¼˜åŒ–ï¼Œçœå»ç”¨æˆ·å®‰è£…ï¼Œé…ç½®ï¼Œä¼˜åŒ– Docker çš„æ—¶é—´ï¼Œæå¤§åœ°æ–¹ä¾¿äº†ç”¨æˆ·ã€‚
-   æ˜“äºé›†ç¾¤åŒ–ï¼š CoreOS æœ¬èº«æä¾›äº†å¤§å‹ Docker å®¹å™¨é›†ç¾¤çš„æ•´ä½“è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å†…ç½®çš„ fleet å·¥å…·åœ¨å¤šå°ç³»ç»Ÿä¸­éƒ¨ç½²å®¹å™¨å¹¶è¿›è¡Œé›†ç¾¤åŒ–ç®¡ç†ã€‚åŒæ—¶é€šè¿‡æä¾› Discovery Serviceï¼Œä¾¿äºåŠ¨æ€éƒ¨ç½²å’Œç®¡ç†é›†ç¾¤ï¼Œè§£å†³æ–¹æ¡ˆæ¯”è¾ƒæˆç†Ÿã€‚
-   è‡ªåŠ¨åŒ–çš„å¤§è§„æ¨¡éƒ¨ç½²ï¼š CoreOS è‡ªèº«æä¾›çš„è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿè‡ªåŠ¨åœ°å¤§è§„æ¨¡æ‰¹é‡éƒ¨ç½²å¹¶æ“ä½œç³»ç»Ÿï¼Œæå¤§åœ°å‡å°‘ç”¨æˆ·å·¥ä½œé‡ã€‚
-   ä½¿ç”¨ systemd åšä¸ºç³»ç»ŸæœåŠ¡ç®¡ç†å·¥å…·ï¼Œæ€§èƒ½æ¯”è¾ƒå¥½ï¼Œsystemd æœ‰ç°ä»£åŒ–çš„æ—¥å¿—åŠŸèƒ½ï¼ŒåŒæ—¶é‡‡ç”¨ socket å¼ä¸ D-Bus æ€»çº¿å¼æ¿€æ´»æœåŠ¡.

ä¸è¿‡ CoreOS æ—©åœ¨ä»Šå¹´å››æœˆä»½å°±å·²ç» EOF äº†ï¼Œ[Fedora CoreOS](https://getfedora.org/coreos/) æˆä¸º CoreOS çš„ç»§ä»»è€…ï¼š

>   As we've [previously announced](https://groups.google.com/d/msg/coreos-user/zgqkG88DS3U/PFP9yrKbAgAJ), [Fedora CoreOS](https://getfedora.org/coreos/) is the official successor to CoreOS Container Linux. Fedora CoreOS is a [new Fedora Edition](https://fedoramagazine.org/fedora-coreos-out-of-preview/) built specifically for running containerized workloads securely and at scale. It combines the provisioning tools and automatic update model of Container Linux with the packaging technology, OCI support, and SELinux security of Atomic Host. For more on the Fedora CoreOS philosophy, goals, and design, see the [announcement of the preview release](https://fedoramagazine.org/introducing-fedora-coreos/) and the [Fedora CoreOS documentation](https://docs.fedoraproject.org/en-US/fedora-coreos/).

### çº¢å¸½çš„ [RHCOS](https://docs.openshift.com/container-platform/4.1/architecture/architecture-rhcos.html)

æ¥è‡ªçº¢å¸½å­å®¶çš„ [Red Hat Enterprise Linux CoreOS (RHCOS)](https://docs.openshift.com/container-platform/4.1/architecture/architecture-rhcos.html)ï¼Œæ˜¯åŸºäºä¸è¿‡è¿™ä¸ª OS ä»…ä»…é€‚ç”¨äºå®ƒè‡ªå®¶çš„ [OpenShift](https://docs.openshift.com/)ï¼Œè€Œä¸”å®¹å™¨è¿è¡Œæ—¶ä»…æ”¯æŒ CRI-Oã€‚

>   At the moment, CRI-O is only available as a container engine within OpenShift Container Platform clusters.

å› ä¸º CoreOS å›¢é˜Ÿç°å¦‚ä»Šå·²ç»è¢« Red HatÂ® æ”¶è´­äº†ï¼Œæ­£å¦‚åœ¨ [OpenShift æ–‡æ¡£](https://access.redhat.com/documentation/zh-cn/openshift_container_platform/4.2/html/architecture/architecture-rhcos) ä¸­æåˆ°çš„ï¼š Red Hat Enterprise Linux CoreOS (RHCOS) ä»£è¡¨äº†ä¸‹ä¸€ä»£å•ç”¨é€”å®¹å™¨æ“ä½œç³»ç»ŸæŠ€æœ¯ã€‚RHCOS ç”±åˆ›å»ºäº† Red Hat Enterprise Linux Atomic Host å’Œ CoreOS Container Linux çš„åŒä¸€å¼€å‘å›¢é˜Ÿæ‰“é€ ï¼Œå®ƒå°† Red Hat Enterprise Linux (RHEL) çš„è´¨é‡æ ‡å‡†ä¸ Container Linux çš„è‡ªåŠ¨åŒ–è¿œç¨‹å‡çº§åŠŸèƒ½ç»“åˆåœ¨ä¸€èµ·ã€‚

### RancherOS

RancherOS æ˜¯ Rancher å›¢é˜Ÿæ‰€ç»´æŠ¤çš„å¼€æºé¡¹ç›®ï¼Œä¹Ÿæ˜¯å¯¹æ ‡ CoreOS ä¸€æ ·ï¼Œä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆè‡³å°‘å®˜æ–¹åšäº†è¿™ä¹ˆæ ·çš„æ‰¿è¯ºï¼Œå’±ä¹Ÿæ²¡åœ¨ç”Ÿäº§ç”¨è¿‡ï¼Œä¸å¥½è¯´ã€‚åœ¨ RancherOS ä¸­æ‰€æœ‰çš„è¿›ç¨‹ï¼ˆåŒ…æ‹¬ç³»ç»Ÿæ‰€æœ‰çš„æœåŠ¡ï¼Œæ¯”å¦‚ udev å’Œ syslogï¼‰éƒ½æ˜¯ç”¨ docker æ¥ç®¡ç†ï¼Œè¿™ä¸€ç‚¹è¦æ¯” CoreOS æ›´åŠ æ¿€è¿›ä¸€äº›ï¼Œè€Œ CoreOS è¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­çš„ systemd æ¥ç®¡ç†ç³»ç»Ÿä¸­çš„æœåŠ¡ã€‚RancherOS é€šè¿‡ç§»é™¤ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­ä¸å¿…è¦çš„æœåŠ¡å’Œåº“æ¥æœ€å°åŒ–ç³»ç»Ÿï¼Œä½¿ä»–ä¸“æ³¨å•ä¸€çš„åŠŸèƒ½ï¼Œå³è¿è¡Œ docker å®¹å™¨ã€‚ä¸è¿‡ä¹‹å‰ä½“éªŒäº†ä¸€ç•ªï¼Œå ç”¨èµ„æºæ¯”è¾ƒå¤šğŸ˜‚ï¼Œå¥½åƒå¹¶æ²¡æœ‰å¤ªå¤§çš„ä¼˜åŠ¿ï¼ˆ

`Everything in RancherOS is a Docker container.` æ„Ÿè§‰è¿™ä¸ªè¦æ¯” CoreOS æ›´åŠ å®¹å™¨åŒ–ï¼Œç”šè‡³ä½¿ç”¨ docker å–ä»£äº† systemd æ¥ç®¡ç†ç³»ç»Ÿçš„å„ç§æœåŠ¡ã€‚ç³»ç»Ÿå¯åŠ¨åè¿è¡Œä¸¤ä¸ª docker æœåŠ¡è¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿ docker ï¼Œåœ¨æ­¤ä¹‹ä¸Šåœ¨è¿è¡Œç³»ç»ŸæœåŠ¡å®¹å™¨ï¼Œå’Œç”¨æˆ·å±‚é¢çš„ docker ã€‚ä¸è¿‡çœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™å¼ å›¾ä½ å°±ä¼šæ˜ç™½ã€‚æ€»çš„æ¥è®² RancherOS æ˜¯ä½¿ç”¨ docker æ¥ç®¡ç†æ•´ä¸ªç³»ç»Ÿçš„æœåŠ¡çš„ï¼ŒåŒ…æ‹¬ç”¨æˆ·å±‚é¢çš„ docker ã€‚

![](https://p.k8s.li/rancheroshowitworks.png)

### VMware çš„ [Photon OS](https://vmware.github.io/photon/)

ä»Šå¤©çš„ä¸»è§’ï¼ŒVMware  å¼€æºçš„ Photon OSï¼Œè¿™ä¸ª OS ä½ å¯èƒ½æ²¡å¬è¯´è¿‡ï¼Œä½† VMware å¼€æºçš„ Harbor æƒ³å¿…å¾ˆç†Ÿæ‚‰ï¼Œè€Œ Harbor çš„åŸºç¡€é•œåƒä½¿ç”¨çš„å°±æ˜¯ä»–å®¶çš„ Photon OSğŸ˜‚ã€‚

```ini
root [ /harbor ]# cat /etc/os-release
NAME="VMware Photon OS"
VERSION="2.0"
ID=photon
VERSION_ID=2.0
PRETTY_NAME="VMware Photon OS/Linux"
ANSI_COLOR="1;34"
HOME_URL="https://vmware.github.io/photon/"
BUG_REPORT_URL="https://github.com/vmware/photon/issues"
```

åœ¨ Photon OS çš„æ„å»ºè„šæœ¬ [build.py](https://github.com/vmware/photon/blob/master/build.py) ä¸­å¯ä»¥çœ‹åˆ°å®ƒæ„å»ºçš„äº§ç‰©æ”¯æŒ ISO å’Œ docker é•œåƒï¼Œä»¥åŠä¼—å¤šå…¬æœ‰äº‘çš„è™šæ‹Ÿæœºæ ¼å¼ï¼Œä¸¤è€…éƒ½æ˜¯æ¥è‡ªç›¸åŒçš„æºç ï¼Œæ ¹æ®æ„å»ºå‡ºæ¥çš„æ˜¯å½¢å¼ä¸åŒï¼Œæ‰€åŒ…å«çš„è½¯ä»¶ä¹Ÿä¸åŒã€‚å› ä¸ºè£å‰ªæ‰äº†ä¸€äº›ä¸å¿…è¦çš„ç³»ç»ŸæœåŠ¡ï¼Œ docker é•œåƒæ ¼å¼çš„è¦æ›´ç²¾ç®€ä¸€äº›ã€‚

```json
targetList = {
        "image":["iso", "ami", "gce", "azure", "rpi3", "ova", "ova_uefi", "all", "src-iso",
                "photon-docker-image", "k8s-docker-images", "all-images", "minimal-iso", "rt-iso"],

        "rpmBuild": ["packages", "packages-minimal", "packages-initrd", "packages-docker",
                "updated-packages", "tool-chain-stage1", "tool-chain-stage2", "check",
                "ostree-repo", "generate-yaml-files", "create-repo", "distributed-build"],

        "buildEnvironment": ["packages-cached", "sources", "sources-cached", "publish-rpms",
                "publish-x-rpms", "publish-rpms-cached", "publish-x-rpms-cached", "photon-stage"]
```

æ€»çš„æ¥è®²ï¼Œä¸Šé¢æåˆ°çš„å‡ ç§å®¹å™¨ä¼˜åŒ–å‹ OS ä¸­ ï¼ŒPhoton OS æ¯”è¾ƒå¼€æ”¾ä¸€äº›ï¼Œè™½ç„¶æ¥è¯´æ˜¯é’ˆå¯¹äºè‡ªå®¶ vSphere è¿›è¡Œä¼˜åŒ–çš„ï¼Œä½†å…¶ä»–å…¬æœ‰äº‘å’Œç§æœ‰äº‘ä¹Ÿæ˜¯æ”¯æŒï¼Œç”šè‡³è¿˜æ”¯æŒæ ‘è“æ´¾ğŸ“ï¼æ‰€ä»¥ä¸ªäººç”¨æˆ·æƒ³æ‹¿æ¥ç©ç©ï¼Œè¿˜æ˜¯ä¸é”™æ»´ã€‚å°¤å…¶æ˜¯é’ˆå¯¹å’±è¿™ç§ç© ESXi è½¯è·¯ç”±çš„åƒåœ¾ä½¬ï¼Œåœ¨ Photon OS ä¸Šè·‘ä¸€äº›å®¹å™¨åº”ç”¨ï¼Œå†é€‚åˆä¸è¿‡äº†ã€‚

## å¯¹æ¯”

| Providers |                             Name                             | STAR | FORK |
| :-------: | :----------------------------------------------------------: | :--: | :--: |
|  Google   | [Container-Optimized OS](https://github.com/GoogleCloudPlatform/cos-customizer) |  -   |  -   |
|  Amazon   | [Bottlerocket OS](https://github.com/bottlerocket-os/bottlerocket) | 4.8K | 185  |
|  CoreOS   |                    CoreOS Container Linux                    |  -   |  -   |
|  Red Hat  |                            RHCOS                             |  -   |  -   |
|  Rancher  |         [Rancher OS](https://github.com/rancher/os)          |  6k  | 625  |
|  Flatcar  |  [Flatcar Linux](https://github.com/flatcar-linux/Flatcar)   | 117  |  3   |
|  VMware   |        [Photon OS](https://github.com/vmware/photon)         | 2.1k | 591  |

| Providers |          Name          | Runtime |                       Support Platform                       |
| :-------: | :--------------------: | :-----: | :----------------------------------------------------------: |
|  Google   | Container-Optimized OS | docker  |                             GCP                              |
|  Amazon   |    Bottlerocket OS     | docker  |                             AWS                              |
|  CoreOS   | CoreOS Container Linux | docker  | AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean |
|  Red Hat  |         RHCOS          |  CRI-O  |                    AWS/vSphere/Bare Metal                    |
|  Rancher  |       Rancher OS       | docker  | AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean |
|  Flatcar  |     Flatcar Linux      | docker  | AWS/GCP/OpenStack/VMware<BR>Alibaba Cloud/Azure/DigitalOcean |
|  VMware   |       Photon OS        | docker  | AWS/GCE/Azure/OpenStack<br>vSphere/bare metal/Raspberry Pi 3 |

ç›®å‰æ¥è®² Photon OS ä½œä¸º Harbor çš„åŸºç¡€é•œåƒï¼Œåœ¨å®¹å™¨æ–¹é¢æ¯”è¾ƒçªå‡ºä¸€äº›ï¼Œä½†ä½œä¸ºå®¹å™¨çš„å®¿ä¸»æœº OS ï¼Œè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚ç”±äºæˆ‘æ˜¯ä½¿ç”¨çš„ VMware å®¶çš„ ESXi è™šæ‹ŸåŒ–ï¼Œé‚£ä¹ˆé€‰æ‹©ä»–å®¶çš„ Photon OS æ˜¯æœ€å¥½çš„å–½ï¼Œè€Œä¸” Photon OS æ˜¯é’ˆå¯¹ ESXi åšè¿‡ä¼˜åŒ–çš„ï¼Œå†…æ ¸éƒ½æ˜¯é’ˆå¯¹ ESXi è™šæ‹ŸåŒ–è¿›è¡Œäº†å®šåˆ¶åŒ–çš„å¼€å‘ï¼Œæ‰€ä»¥ç†è®ºä¸Šé€‰æ‹© Photon OS åº”è¯¥æ˜¯æœ€åˆé€‚çš„ã€‚

## å®‰è£…

### [Download Format](https://github.com/vmware/photon/wiki/Downloading-Photon-OS)

| Format              | Description                                                  |
| ------------------- | ------------------------------------------------------------ |
| ISO Image           | Contains everything needed to install either the minimal or full installation of Photon OS. The bootable ISO has a manual installer or can be used with PXE/kickstart environments for automated installations. |
| OVA                 | Pre-installed minimal environment, customized for VMware hypervisor environments. These customizations include a highly sanitized and optimized kernel to give improved boot and runtime performance for containers and Linux applications. Since an OVA is a complete virtual machine definition, we've made available a Photon OS OVA that has virtual hardware version 11; this will allow for compatibility with several versions of VMware platforms or allow for the latest and greatest virtual hardware enhancements. |
| Amazon AMI          | Pre-packaged and tested version of Photon OS made ready to deploy in your Amazon EC2 cloud environment. Previously, we'd published documentation on how to create an Amazon compatible instance, but, now we've done the work for you. |
| Google GCE Image    | Pre-packaged and tested Google GCE image that is ready to deploy in your Google Compute Engine Environment, with all modifications and package requirements for running Photon OS in GCE. |
| Azure VHD           | Pre-packaged and tested Azure HD image that is ready to deploy in your Microsoft Azure Cloud, with all modifications and package requirements for running Photon OS in Azure. |
| Raspberry Pi3 Image | Pre-packaged and tested Raspberry Pi3 Image (Version 3.0 onwards) on ARM64 architecture. |

Photon OS æä¾›äº†å¤šç§å®‰è£…æ–¹å¼ï¼Œå…¶ä¸­ ISO æ˜¯é€šç”¨æ€§çš„ï¼Œå°±å’Œå®‰è£…å…¶ä»– Linux å‘è¡Œç‰ˆçš„è¿‡ç¨‹å·®ä¸å¤šï¼ŒOVA æ˜¯è™šæ‹Ÿæœºæ¨¡æ¿ï¼Œå¯ä»¥å¯¼å…¥åˆ° VMware è™šæ‹ŸåŒ–å¹³å°ä¸Šä½¿ç”¨ï¼ŒçœåŒºå®‰è£…çš„æ­¥éª¤ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚OVA è™šæ‹Ÿæœºæ¨¡æ¿çš„ç‰ˆæœ¬ä¸º 11 ï¼Œæ ¹æ® [Virtual machine hardware versions](https://kb.vmware.com/s/article/1003746) ä¸­çš„å®šä¹‰ï¼Œéœ€è¦ ESXi 6.0 Fusion 7.x Workstation 11.x Player 7.x ç‰ˆæœ¬ä»¥ä¸Šçš„è™šæ‹ŸåŒ–æ”¯æŒã€‚

| **Virtual Hardware Version** | **Products**                                                 |
| ---------------------------- | ------------------------------------------------------------ |
| 18                           | ESXi 7.0.1                                                   |
| 17                           | ESXi 7.0.0                                                   |
| 16                           | Fusion 11.x Workstation Pro 15.x Workstation Player 15.x     |
| 15                           | VMware Cloud on AWS ESXi 6.7 U2                              |
| 14                           | ESXi 6.7 Fusion 10.x Workstation Pro 14.x Workstation Player 14.x |
| 13                           | ESXi 6.5                                                     |
| 12                           | Fusion 8.x Workstation Pro 12.x Workstation Player 12.x      |
| 11                           | ESXi 6.0 Fusion 7.x Workstation 11.x Player 7.x              |
| 10                           | ESXi 5.5 Fusion 6.x Workstation 10.x Player 6.x              |

å¦å¤–è¿˜æ”¯æŒ `Raspberry Pi 3` ï¼Œä¸è¿‡éœ€è¦æ‹¿æºç è‡ªè¡Œç¼–è¯‘é•œåƒï¼Œç„¶ååˆ·åˆ°æ ‘è“æ´¾ä¸Šï¼Œä½ åƒç°çš„æ ‘è“æ´¾åˆæœ‰ç”¨é€”å•¦ğŸ˜‚ã€‚

[ä¸‹è½½æ–¹å¼](https://github.com/vmware/photon/wiki/Downloading-Photon-OS) ğŸ‘‡

### Photon OS 3.0 Revision 2 Update3 Binaries

Aug 14, 2020 An update to 3.0 revision 2 Update3 binaries are now available.

| Download                                                     | Size | md5 checksum                     |
| ------------------------------------------------------------ | ---- | -------------------------------- |
| [Full ISO x86_64](https://packages.vmware.com/photon/3.0/Rev3/iso/photon-3.0-a383732.iso) | 5.2G | 2dd9f18c5162a7367f2463f4a9bb4890 |
| [Minimal ISO x86_64](https://packages.vmware.com/photon/3.0/Rev3/iso/photon-minimal-3.0-a383732.iso) | 299M | 0119f0f275f246fd382d419ff41898a4 |
| [ISO x86_64 Real-Time flavour](https://packages.vmware.com/photon/3.0/Rev3/iso/photon-rt-3.0-a383732.iso) | 489M | d2bfce95b54a29174b5beaef9962dbc1 |
| [OVA-hw11](https://packages.vmware.com/photon/3.0/Rev3/ova/photon-hw11-3.0-a383732.ova) | 188M | ba52abd88c5b22cd4498cf0e88457f28 |
| [OVA-hw13_uefi](https://packages.vmware.com/photon/3.0/Rev3/ova/photon-hw13_uefi-3.0-a383732.ova) | 214M | 95614f3b08c1a93306ababcc826572df |

åœ¨æ­¤ä½¿ç”¨ OVA-hw11 æ ¼å¼çš„ OVA è™šæ‹Ÿæœºæ¨¡æ¿ï¼Œåé¢é‚£ä¸ªå¸¦ uefi çš„éœ€è¦è®¾ç½®è™šæ‹Ÿæœºä¸º EFI æ¨¡å¼å¯åŠ¨ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚

-   åˆ›å»ºè™šæ‹Ÿæœºçš„æ—¶å€™ä½¿ç”¨ OVA æ–‡ä»¶å¯¼å…¥

![](https://p.k8s.li/20200922-esxi_ova_01.png)

-   é»˜è®¤çš„ç”¨æˆ·åä¸º `root` ï¼Œå¯†ç ä¸º `changeme`ï¼Œç™»å½•ä¹‹åå†è¾“å…¥ä¸€é `changeme`ï¼Œç„¶åä¿®æ”¹ä¸ºæ–°çš„å¯†ç ã€‚

![](https://p.k8s.li/20200922-esxi_photonos-01.png)

## ç³»ç»Ÿä¿¡æ¯

-   å†…æ ¸ç‰ˆæœ¬ä¸º `4.19.132-5.ph3-esx`ï¼Œ4.19 æ˜¯ä¸ª LTS ç‰ˆæœ¬çš„å†…æ ¸ï¼Œç»“å°¾çš„ `esx` åˆ™ä»£è¡¨ç€ä¸º `ESXi` è™šæ‹ŸåŒ–å®šåˆ¶çš„å†…æ ¸ã€‚

```shell
Linux photon-machine 4.19.132-5.ph3-esx #1-photon SMP Wed Aug 12 21:02:13 UTC 2020 x86_64 GNU/Linux
```

-   rpm åŒ…æ•°é‡ä»…ä»…ä¸º 146 ä¸ªï¼Œä¸€èˆ¬çš„ CentOS å‘è¡Œç‰ˆè‡ªå¸¦çš„ rpm åŒ…æ•°é‡ä¸º 300 ä¸ªå·¦å³ã€‚

```shell
root@photon-machine [ ~ ]# rpm -qa | wc
    146     146    4307
```

-   ç³»ç»Ÿè¿›ç¨‹ä¿¡æ¯ï¼Œè¿˜æ˜¯é‡‡ç”¨ systemd æ¥ç®¡ç†è¿›ç¨‹

```shell
root@photon-machine [ ~ ]# systemctl status
â— photon-machine
    State: running
     Jobs: 0 queued
   Failed: 0 units
    Since: Tue 2020-09-22 08:07:29 UTC; 10min ago
   CGroup: /
           â”œâ”€user.slice
           â”‚   â”œâ”€session-c2.scope
           â”‚   â”‚ â”œâ”€413 sshd: root@pts/0
           â”‚   â”‚ â”œâ”€420 -bash
           â”‚   â”‚ â”œâ”€443 systemctl status
           â”‚   â”‚ â””â”€444 systemctl status
           â”‚   â””â”€user@0.service
           â”‚     â””â”€init.scope
           â”‚       â”œâ”€393 /lib/systemd/systemd --user
           â”‚       â””â”€394 (sd-pam)
           â”œâ”€init.scope
           â”‚ â””â”€1 /lib/systemd/systemd
           â””â”€system.slice
             â”œâ”€systemd-networkd.service
             â”‚ â””â”€245 /lib/systemd/systemd-networkd
             â”œâ”€systemd-udevd.service
             â”‚ â””â”€124 /lib/systemd/systemd-udevd
             â”œâ”€vgauthd.service
             â”‚ â””â”€159 /usr/bin/VGAuthService -s
             â”œâ”€systemd-journald.service
             â”‚ â””â”€97 /lib/systemd/systemd-journald
             â”œâ”€sshd.service
             â”‚ â””â”€352 /usr/sbin/sshd -D
             â”œâ”€vmtoolsd.service
             â”‚ â””â”€161 /usr/bin/vmtoolsd
             â”œâ”€systemd-resolved.service
             â”‚ â””â”€247 /lib/systemd/systemd-resolved
             â”œâ”€dbus.service
             â”‚ â””â”€157 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only
             â”œâ”€systemd-timesyncd.service
             â”‚ â””â”€151 /lib/systemd/systemd-timesyncd
             â””â”€systemd-logind.service
               â””â”€158 /lib/systemd/systemd-logind
```

-   ç£ç›˜æ ¹ç›®å½•åªä½¿ç”¨äº†ä¸åˆ° 600M

```
root@photon-machine [ ~ ]# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/root        16G  577M   15G   4% /
```

-   å†…å­˜ä¹Ÿåªä½¿ç”¨äº† 43Miï¼Œå¯åŠ¨ dockerd ä¹‹åå†…å­˜å ç”¨ 108Miï¼Œæ¢æˆ containerd å°†ä¼šå°ä¸€äº›ã€‚

```shell
root@photon-machine [ ~ ]# free -h
              total        used        free      shared  buff/cache   available
Mem:          2.0Gi        43Mi       1.8Gi       0.0Ki       103Mi       1.8Gi
# å¯åŠ¨ dockerd å®ˆæŠ¤è¿›ç¨‹ä¹‹åå†…å­˜å ç”¨ 108Mi
root@photon-machine [ ~ ]# free -h
              total        used        free      shared  buff/cache   available
Mem:          2.0Gi       108Mi       1.6Gi       0.0Ki       298Mi       1.8Gi
```

-   å†…æ ¸æ¨¡å—çš„æ•°é‡ä¹Ÿæ¯”è¾ƒå°‘ 30 ä¸ªå·¦å³ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€äº›ç½‘ç»œç›¸å…³çš„å†…æ ¸æ¨¡å—ã€‚å¸¸è§„çš„ Linux å‘è¡Œç‰ˆçš„å†…æ ¸æ¨¡å—å¾€å¾€åœ¨ 60 ä¸ªä»¥ä¸Šã€‚

```shell
root@photon-machine [ ~ ]# lsmod
Module                  Size  Used by
xt_conntrack           16384  2
ip6table_mangle        16384  0
ip6table_nat           16384  0
nf_nat_ipv6            16384  1 ip6table_nat
iptable_mangle         16384  0
iptable_nat            16384  0
nf_nat_ipv4            16384  1 iptable_nat
nf_nat                 28672  2 nf_nat_ipv6,nf_nat_ipv4
ip6table_filter        16384  1
ip6_tables             24576  3 ip6table_filter,ip6table_nat,ip6table_mangle
iptable_filter         16384  1
xt_LOG                 16384  0
nf_conntrack           90112  4 xt_conntrack,nf_nat,nf_nat_ipv6,nf_nat_ipv4
nf_defrag_ipv6         20480  1 nf_conntrack
nf_defrag_ipv4         16384  1 nf_conntrack
mousedev               20480  0
vfat                   20480  1
fat                    61440  1 vfat
evdev                  20480  1
vmwgfx                253952  1
psmouse                90112  0
drm_kms_helper        106496  1 vmwgfx
ttm                    86016  1 vmwgfx
drm                   323584  4 vmwgfx,drm_kms_helper,ttm
sr_mod                 24576  0
i2c_core               40960  2 drm_kms_helper,drm
cdrom                  49152  1 sr_mod
rdrand_rng             16384  0
rng_core               16384  1 rdrand_rng
ipv6                  368640  16 nf_nat_ipv6,ip6table_mangle
root@photon-machine [ ~ ]# lsmod | wc
     31     109    1273
```

-   ç³»ç»Ÿè‡ªå¸¦çš„ docker ç‰ˆæœ¬ä¸º `19.03.10`ï¼Œå­˜å‚¨é©±åŠ¨ä½¿ç”¨çš„æ˜¯ `overlay2`

```ini
Client:
 Debug Mode: false

Server:
 Containers: 0
  Running: 0
  Paused: 0
  Stopped: 0
 Images: 0
 Server Version: 19.03.10
 Storage Driver: overlay2
  Backing Filesystem: extfs
  Supports d_type: true
  Native Overlay Diff: true
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
 Swarm: inactive
 Runtimes: runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: b34a5c8af56e510852c35414db4c1f4fa6172339
 runc version: d736ef14f0288d6993a1845745d6756cfc9ddd5a
 init version: fec3683
 Security Options:
  apparmor
  seccomp
   Profile: default
 Kernel Version: 4.19.132-5.ph3-esx
 Operating System: VMware Photon OS/Linux
 OSType: linux
 Architecture: x86_64
 CPUs: 1
 Total Memory: 1.951GiB
 Name: photon-machine
 ID: HXBT:Z4LZ:4HZM:3YII:U7ZA:RVOH:Z7CL:L4FA:YGA4:Y2V6:DSVR:NWPD
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 Registry: https://index.docker.io/v1/
 Labels:
 Experimental: false
 Insecure Registries:
  127.0.0.0/8
 Live Restore Enabled: false
 Product License: Community Engine
```

## ç³»ç»Ÿç®¡ç†

### ç½‘ç»œç®¡ç†

-   æŸ¥çœ‹ç½‘å¡çŠ¶æ€ï¼Œå¯ä½¿ç”¨è‡ªå¸¦çš„ `networkctl` å‘½ä»¤è¡Œå·¥å…·ï¼Œåƒ ifconfigã€ipã€ss ç­‰å‘½ä»¤éƒ½å·²ç»é»˜è®¤å®‰è£…ã€‚

```shell
root@photon-machine [ /mnt/RPMS ]# networkctl status eth0
â— 2: eth0
       Link File: /usr/lib/systemd/network/99-default.link
    Network File: /etc/systemd/network/99-dhcp-en.network
            Type: ether
           State: routable (configured)
            Path: pci-0000:0b:00.0
          Driver: vmxnet3
          Vendor: VMware
           Model: VMXNET3 Ethernet Controller
      HW Address: 00:0c:29:74:13:16 (VMware, Inc.)
         Address: 192.168.0.235
                  fe80::20c:29ff:fe74:1316
         Gateway: 192.168.0.1 (NETGEAR)
             DNS: 119.29.29.29
                  223.6.6.6
        CLIENTID: ffb6220feb00020000ab113bc2c88225c0d29b
    Connected To: n/a on port 00:e0:4c:68:54:12
                  n/a on port 00:e0:4c:68:54:13
                  n/a on port 00:e0:4c:68:54:15
```

-   ç³»ç»Ÿå®‰è£…æ—¶é»˜è®¤ä½¿ç”¨çš„ DHCP è·å– IP ï¼Œå¯ä»¥ä½¿ç”¨ systemd æ¥è®¾ç½®é™æ€ IP

```shell
# é¦–å…ˆä¿®æ”¹ DHCP çš„ systemd æ–‡ä»¶ï¼Œå…³é—­ DHCP
sed -i 's/yes/no/' /etc/systemd/network/99-dhcp-en.network
# åˆ›å»ºé™æ€ IP çš„ systemd æ–‡ä»¶
cat > /etc/systemd/network/10-static-en.network << "EOF"

[Match]
Name=eth0

[Network]
Address=198.168.0.235/24
Gateway=198.168.0.1
DNS=192.168.0.100
EOF

# ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶æƒé™ä¸º 644 ï¼Œä¸ç„¶å¯åŠ¨çš„æ—¶å€™ä¼šæŠ¥é”™æç¤ºæƒé™é—®é¢˜
chmod 644 /etc/systemd/network/10-static-en.network
# é‡å¯ä¸€ä¸‹ç½‘ç»œ
systemctl restart systemd-networkd
```

-   æŒ‚è½½ NFS æ–‡ä»¶ç³»ç»Ÿéœ€è¦å®‰è£… `nfs-utils`

```shell
tdnf install nfs-utils -y
mount 192.168.0.100:/nfs /mnt/nfs
```



### åŒ…ç®¡ç†

Photon OS ä½¿ç”¨çš„æ˜¯ yum/tdnf ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œä½¿ç”¨æ–¹æ³•å’Œ RedHat ç³»çš„å‘è¡Œç‰ˆåŸºæœ¬ç›¸åŒï¼Œrepo ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š

```shell
ls /etc/yum.repos.d/
lightwave.repo
photon-extras.repo
photon-iso.repo
photon-updates.repo
photon.repo 
```

### æºç ç¼–è¯‘

## è¿è¡Œå®¹å™¨

### Pi-hole

>   Pi-hole æ˜¯ä¸€æ¬¾å¼€æºä¸”å…è´¹çš„ DNS æ²‰æ´æœåŠ¡å™¨ï¼ˆDNS sinkholeï¼‰ï¼Œèƒ½å¤Ÿåœ¨ä¸å®‰è£…ä»»ä½•å®¢æˆ·ç«¯ä¾§è½¯ä»¶çš„å‰æä¸‹ä¸ºè®¾å¤‡æä¾›ç½‘ç»œå†…å®¹å±è”½æœåŠ¡ï¼Œéå¸¸è½»é‡æ˜“ç”¨ã€‚æ­é…ä¸Šå®¶ä¸­åƒç°å·²ä¹…çš„æ ‘è“æ´¾ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿè½»æ¾æ‰“é€ å±äºè‡ªå·±çš„å¹¿å‘Šå±è”½åŠ©æ‰‹ã€‚
>   åœ¨[å®˜ç½‘](https://pi-hole.net/)çš„ä»‹ç»ä¸­ï¼ŒPi-hole ä¸»è¦å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š
>
>   -   æ˜“äºå®‰è£…å’Œé…ç½®ï¼ˆå·ç§° 10 åˆ†é’Ÿå®‰è£…é…ç½®ä¸€æ¡é¾™ï¼‰ã€‚
>   -   å…¨å¹³å°ï¼Œå¹¿å‘Šå±è”½æœåŠ¡å¯ä½œç”¨äºä»»ä½•è®¾å¤‡ï¼ŒåŒ…æ‹¬PCã€æ‰‹æœºã€å¹³æ¿ç”µè„‘ã€‚
>   -   è½»é‡ï¼Œå¯¹ç¡¬ä»¶è¦æ±‚æä½ã€‚
>   -   åŠŸèƒ½ç¨³å®šä¸”å¼ºå¤§ï¼Œèƒ½è½»æ¾ hold ä½ç™¾ä¸‡çº§åˆ«çš„è¯·æ±‚ã€‚
>   -   æä¾›äº†ç¾è§‚çš„ Web æ•°æ®ç›‘æ§ä»ªè¡¨ç›˜ã€‚
>   -   å¼€æºä¸”å…è´¹ã€‚

-   é¦–å…ˆéœ€è¦å…³é—­ systemd è‡ªå¸¦çš„ DNS æœåŠ¡ï¼Œä¸ç„¶ Pi-hole åšæŒºçš„ 53 ç«¯å£ä¼šè¢«å ç”¨

```shell
systemctl stop systemd-resolved
systemctl disable systemd-resolved
```

-   å®‰è£… docker-composeï¼Œä¿®æ”¹ docker-compose.yaml æ–‡ä»¶

```yaml
version: "3"
# More info at https://github.com/pi-hole/docker-pi-hole/ and https://docs.pi-hole.net/
services:
  pihole:
    container_name: pihole
    image: pihole/pihole:latest
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "67:67/udp"
      - "80:80/tcp"
      - "443:443/tcp"
    environment:
      TZ: 'Asia/Shanghai'
      WEBPASSWORD: 'changeme'
    # Volumes store your data between container upgrades
    volumes:
      - './etc-pihole/:/etc/pihole/'
      - './etc-dnsmasq.d/:/etc/dnsmasq.d/'
    # Recommended but not required (DHCP needs NET_ADMIN)
    #   https://github.com/pi-hole/docker-pi-hole#note-on-capabilities
    restart: unless-stopped
```

-   docker-compose up èµ°èµ·ï¼

```shell
root@PhotonOS [ /opt/docker/pihole ]# docker-compose up
Creating network "pihole_default" with the default driver
Creating pihole ... done
Attaching to pihole
pihole    | [s6-init] making user provided files available at /var/run/s6/etc...exited 0.
pihole    | [s6-init] ensuring user provided files have correct perms...exited 0.
pihole    | [fix-attrs.d] applying ownership & permissions fixes...
pihole    | [fix-attrs.d] 01-resolver-resolv: applying...
pihole    | [fix-attrs.d] 01-resolver-resolv: exited 0.
pihole    | [fix-attrs.d] done.
pihole    | [cont-init.d] executing container initialization scripts...
pihole    | [cont-init.d] 20-start.sh: executing...
pihole    |  ::: Starting docker specific checks & setup for docker pihole/pihole
  [âœ“] Update local cache of available packages
pihole    |   [i] Existing PHP installation detected : PHP version 7.0.33-0+deb9u8
pihole    |
pihole    |   [i] Installing configs from /etc/.pihole...
pihole    |   [i] Existing dnsmasq.conf found... it is not a Pi-hole file, leaving alone!
  [âœ“] Copying 01-pihole.conf to /etc/dnsmasq.d/01-pihole.conf
pihole    | chown: cannot access '': No such file or directory
pihole    | chmod: cannot access '': No such file or directory
pihole    | chown: cannot access '/etc/pihole/dhcp.leases': No such file or directory
pihole    | ::: Pre existing WEBPASSWORD found
pihole    | Using default DNS servers: 8.8.8.8 & 8.8.4.4
pihole    | DNSMasq binding to default interface: eth0
pihole    | Added ENV to php:
pihole    |                     "PHP_ERROR_LOG" => "/var/log/lighttpd/error.log",
pihole    |                     "ServerIP" => "0.0.0.0",
pihole    |                     "VIRTUAL_HOST" => "0.0.0.0",
pihole    | Using IPv4 and IPv6
pihole    | ::: Preexisting ad list /etc/pihole/adlists.list detected ((exiting setup_blocklists early))
pihole    | https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
pihole    | https://mirror1.malwaredomains.com/files/justdomains
pihole    | ::: Testing pihole-FTL DNS: FTL started!
pihole    | ::: Testing lighttpd config: Syntax OK
pihole    | ::: All config checks passed, cleared for startup ...
pihole    |  ::: Docker start setup complete
pihole    |   [i] Neutrino emissions detected...
  [âœ“] Pulling blocklist source list into range
pihole    |
  [âœ“] Preparing new gravity database
pihole    |   [i] Target: https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
pihole    |   [i] Received 55654 domains
pihole    |   [i] Target: https://mirror1.malwaredomains.com/files/justdomains
  [âœ“] Status: No changes detected
pihole    |   [i] Received 26854 domains
  [âœ“] Storing downloaded domains in new gravity database
  [âœ“] Building tree
  [âœ“] Swapping databases
pihole    |   [i] Number of gravity domains: 82508 (82465 unique domains)
pihole    |   [i] Number of exact blacklisted domains: 0
pihole    |   [i] Number of regex blacklist filters: 0
pihole    |   [i] Number of exact whitelisted domains: 0
pihole    |   [i] Number of regex whitelist filters: 0
  [âœ“] Cleaning up stray matter
pihole    |
pihole    |   [âœ“] DNS service is running
pihole    |   [âœ“] Pi-hole blocking is Enabled
pihole    |   Pi-hole version is v5.1.2 (Latest: v5.1.2)
pihole    |   AdminLTE version is v5.1.1 (Latest: v5.1.1)
pihole    |   FTL version is v5.2 (Latest: v5.2)
pihole    | [cont-init.d] 20-start.sh: exited 0.
pihole    | [cont-init.d] done.
pihole    | [services.d] starting services
pihole    | Starting pihole-FTL (no-daemon) as root
pihole    | Starting lighttpd
pihole    | Starting crond
pihole    | [services.d] done.
```

-   æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ `http://ip:port/admin` å³å¯è¿›å…¥ Pi-hole çš„åå°ç®¡ç†é¡µé¢ï¼Œåœ¨è¿™é‡Œå¯ä»¥æŸ¥çœ‹åˆ° DNS è§£æçš„è¯¦ç»†è®°å½•ï¼Œå…³äº Pi-hole çš„ä½¿ç”¨å¯ä»¥å‚è€ƒä¸€äº›å¤§ä½¬çš„åšå®¢ï¼Œæ¯”å¦‚ [æ­å»º Pi-Hole ä¸ºç½‘ä¸Šå†²æµªä¿é©¾æŠ¤èˆª](https://wzyboy.im/post/1372.html)ã€‚

![](https://p.k8s.li/20200925-pihole.png)

å¦‚æœæƒ³è¦è®©å†…ç½‘çš„æœºå™¨éƒ½èµ° Pi-hole æ¥è¿›è¡Œ DNS ï¼Œå¯ä»¥å°†è·¯ç”±å™¨çš„ DHCP çš„  DNS çš„ IP è®¾ç½®ä¸º Pi-hole çš„ IPã€‚

## å‚è€ƒ

-   [New GKE Dataplane V2 increases security and visibility for containers](https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine)
-   [è¢« Google é€‰æ‹©çš„ä¸‹ä¸€ä»£æ•°æ®é¢ Cilium æ˜¯ä»€ä¹ˆ](https://moelove.info/2020/09/02/%E8%A2%AB-Google-%E9%80%89%E6%8B%A9%E7%9A%84%E4%B8%8B%E4%B8%80%E4%BB%A3%E6%95%B0%E6%8D%AE%E9%9D%A2-Cilium-%E6%98%AF%E4%BB%80%E4%B9%88/)