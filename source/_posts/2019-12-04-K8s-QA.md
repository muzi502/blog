---
title: (2000+) kubernetes ç¤¾ç¾¤åˆ†äº« QA æ±‡æ€»
date: 2019-12-04
updated: 2020-06-02
categories: æŠ€æœ¯
slug:
tag:
  - kubernetes
  - QA
copyright: true
comment: true
---

### README

å†…å®¹ä¸»è¦æ¥è‡ªåœ¨é‡Œ [dock one](http://dockone.io/) å¾®ä¿¡ç¾¤é‡Œæœ‰å…³ä¼ä¸š Kubernetes å®žè·µè¿‡ç¨‹çš„ç›´æ’­åˆ†äº«ï¼Œä¸‹é¢æˆªå–èŠå¤©è®°å½•çš„è‡ª QA éƒ¨åˆ† ã€‚ç”±äºŽæé—®é“¾æŽ¥åœ¨çŸ³å¢¨æ–‡æ¡£ä¸Šåä½œç¼–è¾‘ï¼Œè€ŒçŸ³å¢¨æ–‡æ¡£é‡Œçš„å†…å®¹æ˜¯æ— æ³•è¢«æœç´¢å¼•æ“Žæ£€ç´¢åˆ°çš„ã€‚è¿™äº›é—®é¢˜ä¸æ•´ç†èµ·æ¥å°±æ°¸è¿œåœ°èººå°¸åœ¨çŸ³å¢¨æ–‡æ¡£äº†ï¼Œæ‰€ä»¥å°±æŠŠè¿™äº›æé—®çš„é—®é¢˜æ±‡æ€»åˆ°ä¸€èµ·ï¼Œæ–¹ä¾¿å¤§å®¶è‡ªæŸ¥ã€‚

### 2020-06-02ï¼šè°Šå“ç”Ÿé²œå¦‚ä½•ä»Žé›¶å¼€å§‹å¿«é€Ÿæ‰“é€  CI/CD æµæ°´çº¿

> Q1ï¼šæœ‰å¯¹ç…§è¿‡ jenkinsï¼Œdrone ç­‰å…¶ä»– CICD å·¥å…·å—ï¼Œå¤„äºŽä»€ä¹ˆè€ƒè™‘æœ€åŽé€‰æ‹© gitlab-runnerï¼Œæœªæ¥æœ‰è€ƒè™‘è¿‡ k8s è¿™æ–¹é¢çš„é›†æˆå—

Aï¼šgitlab-runnerï¼Œjenkinsï¼Œdrone éƒ½å±žäºŽé…ç½®å³æ“ä½œçš„å·¥å…·ï¼Œå› ä¸ºä½¿ç”¨ gitlab æ¥ç®¡ç†ä»£ç ï¼Œgitlab-runner åˆå¾ˆå¥½è´´è¿‘ gitlabï¼Œç»´æŠ¤æˆæœ¬ä¹Ÿä¸ 24177411244444117 æœŸ 71 ä¸ªé«˜ï¼Œç±» 714 ä¸ª jenkins çš„ nodeï¼Œå®‰è£…æ³¨å†Œï¼Œå°±èƒ½æ‹¿æ¥ç”¨ã€‚ æ­£åœ¨å¼•å…¥ K8S ä¸­ 71477448 7d;)eexsnjnkm&/hfb6;

> Q2ï¼šä»Žé•œåƒåˆ°éƒ¨ç½²åˆ° k8sï¼Œæ˜¯é€šè¿‡ä»€ä¹ˆå®žçŽ°çš„ï¼Œkubectl è¿˜æ˜¯é•œåƒæ›´æ–°è§¦å‘ï¼Ÿåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­èƒ½ä¸èƒ½è°ƒæ•´ä¸€äº› deployment çš„é…ç½®ï¼Œæ¯”å¦‚ resource.cpu.request æˆ–è€…ingres1PS7hig4 æ˜¯ GPSPSPPSPPSPPSP ç¡®å®žå¥½ 1 æ˜¯ 1iss çš„ä¸€äº›é…ç½®ï¼ŸåŠ¡

Aï¼šè¿™è¾¹ï¼ŒçŽ°åœ¨æ²¡æœ‰ä½¿ç”¨ k8s(äºŒå­£åº¦å°† 1 å¼•å…¥ k8s)ï¼Œåªå°†åº”ç”¨ docker é•œåƒï¼Œå‘å¸ƒå¿…è¦æ€§ç»™ä¸‡å…´ä¹Ÿç»Ÿè®¡ï¼šï¼šåˆ°ç›®æ ‡æœºå™¨ä¸Š å¦‚æžœå¼•å…¥ k8sï¼Œå°†å¼€å‘è°ƒç”¨ k8s çš„ api server æŽ¥å£ï¼Œä¼ é€’ yaml é…ç½®æ–‡ä»¶å®‹*æ˜¯å•¥è¯´åˆ‡è®©é€è¯´åˆ‡è®©é€è¯´åˆ‡è®©é€è¯´åˆ‡è®©é€è¯´åˆ‡è®©é€è¯´åˆ‡è®©é€ 1 å¥½ hi

> Q3ï¼šå¯¹äºŽé¡¹ç›®æ˜¯å¦‚ä½•è¿›è¡Œä»»éƒ¨ç½²æ£€æµ‹çš„ï¼Ÿå¯¹ tag è¿›è¡Œç›‘å¬å—ï¼Ÿ

Aï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ·»åŠ é… 49377071607499984 çš„å›¾  æ‹’ç»ç½®æ–‡ä»¶.gitlab-ci.ymlï¼Œæœ‰ only å’Œ except æ•°ç»„ï¼Œæ”¯æŒ branchï¼Œtagï¼ŒçŽ¯å¢ƒå˜é‡ï¼ŒMRï¼Œæ–‡ä»¶å˜åŠ¨(åƒ README.md)

> Q4ï¼šç›¸æ¯” jenkins å¦‚ä½•

æ˜¯ 1 åŽ»çˆ¬å±±åŽ» 1

> Q5ï¼šäº§å“ä»£ç è¿­ä»£æäº¤ä¸­ï¼Œå¦‚ä½•åŒºåˆ«æ­£å¸¸çš„åˆå¹¶ä»£ç ã€ä»¥åŠæž„å»ºè¯·æ±‚å‘¢

Aï¼šæž„å»ºè¯·æ±‚æ—¶ï¼Œæ˜¯è®©å¼€å‘é€‰æ‹©è¦å‘å¸ƒçš„åˆ†æ”¯ï¼Œè¿›è¡Œæ‰“åŒ…å‘å¸ƒ

> Q6ï¼šgitlab-ci.yml æ”¾åœ¨æ ¹ç›®å½•ä¸‹ï¼Œ æ˜¯å¦ä¼šå¢žåŠ ç»´æŠ¤æˆæœ¬ã€‚è¿™äº›æ–‡ä»¶çš„æ”¹åŠ¨æ˜¯ä¸šåŠ¡ç ”å‘ä¿®æ”¹ï¼Œè¿˜æ˜¯ä¸“äººç»´æŠ¤å‘¢ï¼Ÿ

Aï¼š.gitlab-ci.yml å››è¡Œä»£ç ï¼Œå°±è¿™å››è¡Œå›ºå®šï¼ŒåŠ åˆ°é¡¹ç›®è„šæ‰‹æž¶é‡Œï¼Œæ²¡æœ‰ç»´æŠ¤æˆæœ¬ï¼Œé€šè¿‡ include cicd é¡¹ç›®ï¼Œè¿ç»´åœ¨ cicd é¡¹ç›®é‡Œè¿›è¡Œç»´æŠ¤æ‰“åŒ…å’Œå‘å¸ƒæ“ä½œä»£ç ï¼Œå¯¹ä¸šåŠ¡ä»£ç ï¼Œé›¶å½±å“

> Q7-0.1  è¯·é—®è‡ªåŠ¨åŒ–æµ‹è¯•å‡†å¤‡æ€Žä¹ˆåŠ å…¥å‘¢ï¼Œ

A: å‘å¸ƒæˆåŠŸåŽï¼Œè°ƒç”¨è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å° API

> Q7ï¼šé’ˆå¯¹ gitlab runner æ˜¯è¦é©±åŠ¨æ•´ä¸ªäº§å“çš„ç ”å‘åŽ»è§¦å‘ CICD å§ï¼Œå¯¹äºŽä¸æ‡‚ docker åŠ k8s yaml è¯­æ³•çš„åŒäº‹ï¼Œæ€Žä¹ˆè®©ä»–ä»¬æŽ¥å—æ–°çš„å‘å¸ƒä½“ç³»åŠä½¿ç”¨å‘¢ï¼Ÿ

Aï¼š.gitlab-ci.yml çš„è¯­æ³•æ˜¯è¿ç»´å†™å¥½çš„ï¼Œå¼€å‘åªè¦åœ¨é¡µé¢ä¸Šç‚¹å‡»å‘å¸ƒï¼Œå‘å¸ƒç³»ç»Ÿè§¦å‘

> Q8ï¼šè¯·é—®æœ‰æ²¡æœ‰é«˜å¹¶å‘æ‹‰å–é•œåƒçš„é—®é¢˜ï¼Ÿæœ‰æ²¡æœ‰é‡åˆ°è¿‡åœ¨é«˜å¹¶å‘ä¸‹ gitlab æ€§èƒ½ä¸‹é™çš„é—®é¢˜ï¼Ÿ

Aï¼šharborï¼ˆæœºå™¨é…ç½®åä½Žï¼‰é‡åˆ°è¿‡é«˜å¹¶å‘æ‹‰å–é—®é¢˜ï¼Œåœ¨ä¸€æ¬¡å¤§é‡è¿ç§»çš„æ—¶å€™ï¼Œæ²¡æœ‰æŒ‰æ‰¹æ¬¡æ“ä½œï¼Œå¹³å¸¸å¼€å‘å‘å¸ƒï¼Œharbor å®Œå…¨å¯ä»¥èƒœä»»ï¼Œé«˜å¹¶å‘ä¸‹å¯¹ gitlab å½±å“ä¸å¤§ï¼Œgitlab ä¸»è¦è¿˜æ˜¯è§¦å‘ gitlab-runner åŽ»è¿è¡Œæ‰“åŒ…å’Œå‘å¸ƒï¼Œgitlab-runner æœºå™¨é…ç½®ç¨å¾®é«˜äº›ï¼Œå› ä¸ºé™¤äº† java çš„ maven å’Œ gradleï¼Œæˆ‘è¿™è¾¹è¿˜å°† node æ‰“åŒ…ä¹Ÿé›†æˆåœ¨è¿™ä¸ªé¡¹ç›®é‡Œ

> Q9ï¼šk8s æŒä¹…åŒ–å­˜å‚¨æœ‰ä»€ä¹ˆæ–¹æ¡ˆæŽ¨èï¼Ÿ

Aï¼šå› ä¸ºè¿™è¾¹éƒ½ä¸Šé˜¿é‡Œäº‘ï¼ŒçŽ°åœ¨å¼•å…¥ k8s ä½¿ç”¨é˜¿é‡Œäº‘ ASKï¼Œå­˜å‚¨ç›´æŽ¥ä½¿ç”¨äº‘ç¡¬ç›˜ï¼Œåƒé˜¿é‡Œäº‘çš„ ACKï¼Œå¯ä»¥ä½¿ç”¨ OSS å¯¹è±¡å­˜å‚¨

> Q10ï¼šè¯¦ç»†ä»‹ç»ä¸€ä¸‹ç°åº¦å‘å¸ƒæ˜¯æ€Žä¹ˆåšçš„å§ï¼Œä¾‹å¦‚ä¸¤æ¬¡å‘ç‰ˆæ•°æ®åº“ç»“æž„ä¸ä¸€è‡´ï¼Œæ˜¯å¦‚ä½•åšå‘å¸ƒå’Œå›žæ»šçš„ï¼Œæµé‡æ€Žä¹ˆåˆ†å‘åˆ°æ–°æ—§ç‰ˆçš„

Aï¼šå‘å¸ƒå‰ï¼Œå‡çº§æ•°æ®åº“ç»“æž„ç‰ˆæœ¬ï¼Œå…ˆæ‰§è¡Œæ•°æ®åº“ç»“æž„å˜æ›´ï¼ˆå‡Œæ™¨ï¼‰å›žæ»š: å°†æ•°æ®åº“ç»“æž„å›žæ»šï¼Œåº”ç”¨ retry ä¸Šä¸€æ¬¡å‘å¸ƒè®°å½•æµé‡é€šè¿‡ç½‘å…³é…ç½®

> Q11:   ç³»ç»Ÿç“¶é¢ˆå¦‚ä½•æµ‹è¯•ï¼Œä½¿ç”¨ä»€ä¹ˆå·¥å…·ï¼Œæµ‹è¯•æ–¹æ³•æ˜¯æ€Žæ ·çš„ï¼ŒåŒ…æ‹¬åº”ç”¨å±‚å’Œä¸­é—´ä»¶

A:åº”ç”¨å±‚ï¼Œä½¿ç”¨é˜¿é‡Œäº‘æ€§èƒ½æµ‹è¯•ï¼Œè¯·æ±‚ç›¸å…³ API

> Q12 å…¬å¸ç›®å‰å°± 20 æ¥ä¸ªå¼€å‘ï¼Œé€‚åˆè‡ªå·±æžè¿™å¥—å—ï¼Ÿ

A:å¦‚æžœä½ ä»¬è¿˜åœ¨æ‰‹åŠ¨å‘å¸ƒçš„è¯ï¼Œå»ºè®®ä½ ä»¬ä½¿ç”¨ gitlab-runnerï¼Œå¯ä»¥ä½¿ç”¨ git tag æ–¹å¼ï¼Œå‘å¸ƒï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ä¸€æ­¥ä¸€æ­¥èµ°è¿‡æ¥çš„ï¼Œå…ˆå‰æ²¡æœ‰å‘å¸ƒç³»ç»Ÿï¼Œå¼€å‘ä½¿ç”¨æ‰“ tag æ–¹å¼å‘å¸ƒï¼Œè¿™ä¸ªæ²¡æœ‰çº¦æŸçœ‹å¼€å‘ä¸ªäººï¼ŒåŽé¢å¼€å‘äº†å¥—å‘å¸ƒç³»ç»Ÿï¼Œåœ¨ä¸Šé¢åšäº†å·¥ä½œæµç®¡ç†

> Q13 å‘å¸ƒç³»ç»Ÿæƒé™æ€Žä¹ˆæŽ§åˆ¶çš„ï¼Ÿ

Aï¼šåˆ†åº”ç”¨å¼€å‘å’Œåº”ç”¨ onwerï¼Œrbac å…·ä½“è®²è®²æƒé™æŽ§åˆ¶ç»†èŠ‚å—å…ˆå¯¹å¼€å‘åˆ†é…è§’è‰²ï¼Œdevï¼Œonwerï¼Œå…·ä½“å®žçŽ°ï¼Œå¯ä»¥å‚çœ‹ RBAC

### 2020-05-19ï¼šKubernetes åœ¨ AI å¹³å°çš„è½åœ°å®žè·µ

[çŸ³å¢¨æ–‡æ¡£](https://shimo.im/docs/rT3hdXjCjPJtRDtH)

> Q1ï¼šk8s åœ¨åšåº”ç”¨éƒ¨ç½²çš„æ—¶å€™ï¼Œå¦‚æžœä½¿ç”¨ statefulset åšéƒ¨ç½²ï¼Œæ˜¯å¦å¤±åŽ»äº†æ•…éšœæ¢å¤åŠŸèƒ½ï¼Ÿæ¯”å¦‚ node èŠ‚ç‚¹ down æœº

Aï¼šæˆ‘çš„ç†è§£æ˜¯å¦‚æžœæ˜¯é€‰åž‹ statefuleset ä½œä¸ºéƒ¨ç½²çš„èµ„æºç±»åž‹ï¼Œé€šå¸¸æ˜¯æŒ‡åƒ kafkaã€elasticsearchã€etcd ç­‰ç­‰è¿™ç±»çš„ç»„ä»¶æˆ–æœåŠ¡ï¼Œè€Œè¿™äº›æœ¬å°±æœ‰é«˜å¯ç”¨æœºåˆ¶å¯ä»¥ä¿éšœ

> Q2ï¼šå¯å¦åˆ†äº«éƒ¨ç½²æ–‡æ¡£å’Œè¸©å‘çš„è®°å½•ï¼Œæˆ‘ä»¬å¥½è·Ÿç€æ­å»ºï¼ŒåŠ¨æ‰‹å®žè·µä¸‹ï¼Œè¿™æ ·æ˜¯å¦å¯ä»¥é¿å…è¸©å‘ï¼Ÿ

Aï¼šå¯ä»¥ï¼ŒåŽæœŸå¯ä»¥å¤šåˆ†äº«ä¸€äº›æ–‡ç« åœ¨ç¤¾åŒºè¿™è¾¹

> Q3ï¼šæ€Žä¹ˆçœ‹å¾… kubeOperator è¿™ä¸ªé¡¹ç›®

Aï¼šè¿™ä¸ªè¿˜æ²¡åŽ»äº†è§£è¿‡ï¼ŒåŽæœŸå¯ä»¥å…³æ³¨ä¸€ä¸‹

> Q4ï¼šæ—¥å¿—æ”¶é›†å¦‚æžœä¿ç•™åŽŸæ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æžœä½¿ç”¨ deployment æ€Žä¹ˆåšåˆ°å¤š container å„è‡ªå†™ä¸å†²çªï¼Œå¦‚æžœä¸è½å®žåˆ°æ–‡ä»¶ï¼Œæ˜¯å¦ä¼šæœ‰è¾“å‡ºå†…å®¹è¿‡å¤šçš„é—®é¢˜ï¼Œæ€Žä¹ˆåšæ—¥å¿—æ¸…ç†

Aï¼šæ—¥å¿—æ”¶é›†å’Œç®¡ç†è¦åšå¥½ï¼Œå®žé™…ä¸Šæ˜¯ä¸€ä¸ªå¤§å·¥ç¨‹ï¼Œå¾ˆå¤šå…¬å¸éƒ½æ˜¯è‡ªå·±å•ç‹¬åšäº†æ—¥å¿—ç®¡ç†ç³»ç»Ÿï¼Œåƒä½ è¯´çš„åšåˆ°å„è‡ªå†™ä¸å†²çªï¼Œå®žé™…ä¸Šå¦‚æžœä½¿ç”¨ EFK è¿™ç±»çš„äº‘åŽŸç”Ÿæ—¥å¿—ç®¡ç†æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ï¼Œå¯¹äºŽè¾“å‡ºè¿‡å¤šï¼Œå®žé™…ä¸Šä½ çš„ client é‡‡é›†å™¨é‡‡é›†åˆ°æ¯”å¦‚ ES ä¸Šçš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™çš„èšç„¦ç‚¹åº”è¯¥æ˜¯åœ¨ ES çš„ç®¡ç†ä¸Šï¼Œæ€Žä¹ˆå®šæœŸæ¸…ç† ES çš„æ•°æ®æˆ–è€…å†·å¤‡ç­‰ç­‰ï¼Œè€Œè¿™ä¸ª ES æ˜¯æœ‰ä¸“é—¨ api æŽ¥å£å¯ä»¥çµæ´»åšç­–ç•¥çš„

> Q5ï¼šè¯·é—®ä½ ä»¬å½“å‰ calico æ”¯æŒäº†å¤šå¤§è§„æ¨¡çš„é›†ç¾¤ï¼Ÿ

Aï¼šæˆ‘ä»¬ç›®å‰æ˜¯ 30 å°ç‰©ç†æœº

> Q6ï¼šå„ä¸ª AI åŽ‚å•†çš„è®¡ç®—æ¨¡åž‹ä¸ç»Ÿä¸€ï¼Œå¦‚ä½•ä½¿ç”¨ç»Ÿä¸€çš„ AI å¹³å°ç®¡ç†å„ç§ AI æ¨¡åž‹ï¼Œæ˜¯å¦æœ‰ç»Ÿä¸€çš„å»ºè®¾æ ‡å‡†ï¼Ÿ

Aï¼šæˆ‘çš„ç†è§£æ˜¯è¿™ä¸ªå®žé™…ä¸Šå°±æ¶‰åŠåˆ°æ›´åŠ åº•å±‚çš„å°è£…äº†ï¼ŒçŽ°åœ¨ AI åƒæ·±åº¦å­¦ä¹ è¿™ä¸€å—ï¼Œä½¿ç”¨çš„ä¸»æµæ¡†æž¶å¤§å®¶éƒ½å·®ä¸å¤šï¼Œåƒ tensorflowï¼Œpytorch ç­‰ç­‰ï¼Œæ—¢ç„¶è¿™äº›æ¡†æž¶åŸºæœ¬å¤§å®¶ä½¿ç”¨æ–¹å¼éƒ½ä¸€æ ·çš„è¯ï¼ŒåŸºæœ¬å°±å¯ä»¥ç»Ÿä¸€æ ‡å‡†äº†ï¼Œå®žé™…ä¸Šæˆ‘çš„ç†è§£æ˜¯è¿™ä¸€å—åº”è¯¥è¿˜åœ¨é«˜é€Ÿå‘å±•ä¸­ï¼Œè¿˜ä¸å¤ªé€‚åˆè¿‡æ—©è¿›è¡Œç»Ÿä¸€

> Q7ï¼šè¯·é—® dubbo æž¶æž„å®¹å™¨åŒ–ï¼Œæ³¨å†Œä¸­å¿ƒæœ‰é›†ç¾¤å†…å·²å®¹å™¨åŒ–å’Œä¼ ç»Ÿéƒ¨ç½²åŒæ—¶å­˜åœ¨é˜¶æ®µï¼Œèƒ½å¦åˆ†äº«ä¸‹è¿‡åº¦æœŸçš„ç»éªŒï¼Ÿè°¢è°¢

Aï¼šè¿™ä¸ªå…¶å®žå°±æ˜¯æ¶‰åŠåˆ° dubbo çš„æ³¨å†Œæœºåˆ¶äº†ï¼Œåº•å±‚ä½¿ç”¨çš„è¿˜æ˜¯ ip å’Œç«¯å£è¿›è¡Œé€šä¿¡ï¼Œå…³é”®é—®é¢˜åº”è¯¥æ˜¯ä¼ ç»Ÿéƒ¨ç½²çš„ç½‘ç»œå¦‚ä½•ä¸Žå®¹å™¨ç½‘ç»œæ‰“é€šçš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¹‹å‰å¦å¤–ä¸€ä¸ªå¹³å°ä¹Ÿæ˜¯é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæœ€ç»ˆæ˜¯å°† calico ç½‘ç»œå’Œä¼ ç»Ÿç½‘ç»œåšäº†èžåˆ

> Q8ï¼šå¯¹å®¹å™¨ç›‘æŽ§æ¨¡å— prometheus æ˜¯å¦æœ‰é«˜å¯ç”¨æž¶æž„å®žè·µåˆ†äº«ï¼Ÿè°¢è°¢

Aï¼šå—¯è¿™ä¸ªå¯ä»¥åŽæœŸåˆ†äº«ç»™ç¤¾åŒº

> Q9ï¼šè¯·é—® tf åˆ†å¸ƒå¼è®­ç»ƒä¸­ï¼Œå¯¹äºŽè®­ç»ƒæ•°æ®çš„å¤š worker èŠ‚ç‚¹è®¿é—®ï¼Œé‡‡ç”¨çš„ä»€ä¹ˆæ–¹æ¡ˆï¼Ÿ

Aï¼šè¿™ä¸ªå¹³å°æš‚æ—¶è¿˜æ²¡å¼•å…¥åˆ†å¸ƒå¼è®­ç»ƒï¼Œä¸è¿‡åŽç»­æœ‰åœ¨è€ƒè™‘

> Q10ï¼šè¯·é—®æœ‰æ²¡æœ‰ä½¿ç”¨ vgpu çš„æ–¹æ¡ˆï¼Ÿ

Aï¼šè¿™ä¸ªç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ nvidia å®˜æ–¹çš„æ’ä»¶ï¼Œè·‘åœ¨ K8s ä¸Šï¼Œä»¥å•é¢— GPU ä¸ºç»´åº¦è¿›è¡Œè™šåŒ–åˆ’åˆ†è°ƒåº¦ï¼ŒåŽç»­å‡†å¤‡ç»“åˆå¼€æºæ–¹æ¡ˆæŠŠå•é¢— GPU å†è™šåŒ–æ›´å°é¢—ç²’åº¦çš„ï¼Œæ¯”å¦‚ 16G æ˜¾å­˜çš„ GPU åˆ‡å‰²æˆ 8 å— 2G æ˜¾å­˜çš„ GPU

> Q11ï¼šè¿™é‡ŒåŸºäºŽ k8s å¤§æ•°æ®çš„æ–¹æ¡ˆï¼Œk8s çš„å®¹å™¨æ˜¯è·‘åœ¨è™šæ‹Ÿæœºé‡Œé¢çš„ï¼Œè¿˜æ˜¯ baremetal çš„ç‰©ç†æœº?

Aï¼šè¿™ä¸ªæ˜¯è·‘åœ¨è£¸æœºä¸Šçš„

> Q12ï¼šå¤§æ•°æ®éƒ¨åˆ†ï¼Œæ”¯æŒå“ªäº›è®¡ç®—æ¡†æž¶ï¼Œæ¯”å¦‚ï¼Œhadoop, spark, flink ç­‰ï¼Œä»–ä»¬åœ¨åŸºäºŽ k8s éƒ¨ç½²æ—¶ï¼ŒåŸºäºŽæ€§èƒ½ä¸Šçš„ä¸åŒè€ƒé‡åˆ†åˆ«æ˜¯ä»€ä¹ˆ?

Aï¼šå¤§æ•°æ®ç»„ä»¶å®¹å™¨åŒ–æˆ‘ä»¬ä¹Ÿè¿˜åœ¨æŽ¢ç´¢ä¸­ï¼Œåƒ spark on k8s ä»Žç›®å‰çš„æµ‹è¯•æ•ˆæžœæ¥çœ‹ï¼Œè®¡ç®—æ€§èƒ½æ˜¯ä¸ªå¤§é—®é¢˜
æˆ‘ hefwehfweh
ä¼Ÿå¤§

> Q13ï¼šå…³äºŽ spark on k8s è¿™å—å„¿æ‚¨é‚£è¾¹ç›®å‰æœ‰ä»€ä¹ˆé¢„æƒ³æ–¹æ¡ˆå—ï¼Œæ¯”å¦‚è¯´å­˜å‚¨ç³»ç»Ÿç”¨å“ªä¸ªï¼Œæ˜¯éƒ¨ç½²åœ¨ k8s ä¸Šè¿˜æ˜¯å•ç‹¬éƒ¨ç½²ï¼Œæ•°æ®åˆå¦‚ä½•ä¼ å…¥å­˜å‚¨ç³»ç»Ÿä¹‹ç±»çš„

Aï¼šç›®å‰æˆ‘ä»¬çš„æµ‹è¯•æ–¹æ¡ˆä¸­ä½¿ç”¨çš„å­˜å‚¨è¿˜æ˜¯åŸºäºŽ HDFS çš„ï¼Œå•ç‹¬éƒ¨ç½²ï¼Œå¦‚ä½•ä¼ å…¥å­˜å‚¨ï¼Œè¿™ä¸ªå±žäºŽå…·ä½“çš„å®žçŽ°äº†ï¼ŒåŽæœŸç­‰ spark on k8s æˆç†Ÿäº†ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹è¿™ä¸ª topic åšä¸€æ¬¡åˆ†äº«

> Q14: è¯·é—®ä½ ä»¬æœ‰ä¸“é—¨é’ˆå¯¹ç›‘æŽ§æˆ–è€…æ—¥å¿—ç³»ç»Ÿè€ƒè™‘è¯ä¹¦ä¸€ç±»çš„å®‰å…¨ç­–ç•¥å¦ï¼Ÿ

Aï¼šè¿™ä¸ªæš‚æ—¶æ²¡æœ‰è€ƒè™‘ï¼Œä¼˜å…ˆçº§ä¸é«˜

> Q15ï¼šæ˜¯å¦æœ‰äº›åº”ç”¨äº§å“å¦‚ springboot çš„å¯ä»¥ç›´æŽ¥é›†æˆï¼Œè¿˜æ˜¯å¦å¤–ç”¨ sidecar ä¹‹ç±»åˆ†å¼€äº’ç›¸è°ƒç”¨,æˆ–æ˜¯æœåŠ¡è°ƒç”¨ä¼šæœ‰ä»€ä¹ˆç­–ç•¥é—®é¢˜ä¹ˆ

Aï¼šå¹³å°åŽå°åº”ç”¨ä½¿ç”¨çš„å°±æ˜¯ spring bootï¼Œæˆ‘ä»¬ç›´æŽ¥ä½¿ç”¨çš„å°±æ˜¯å®ƒæœ¬èº«çš„æœåŠ¡å‘çŽ°æœºåˆ¶ï¼ŒæœåŠ¡è°ƒç”¨ç­–ç•¥äº¤ç»™äº† istioï¼ŒåŒ…æ‹¬é‰´æƒï¼Œç°åº¦å‘å¸ƒç­‰ç­‰

> Q16: workflow æœ‰ä½•å¼€æºé¡¹ç›®å¯ä»¥å€Ÿé‰´ï¼Ÿ

Aï¼šworkflow æˆ‘ä»¬å‡†å¤‡ä¸Šçº¿ argoï¼Œå¯ä»¥å…³æ³¨ä¸€ä¸‹

> Q17: k8s å®¹ç¾å¦‚ä½•è€ƒè™‘çš„ï¼Ÿæ˜¯å¦è€ƒè™‘ k8s å’Œç‰©ç†æœºæ··å¸ƒï¼Ÿ

Aï¼šé’ˆå¯¹ k8s æˆ‘ä»¬æœ¬èº«åšäº†é«˜å¯ç”¨ï¼Œæ¯”å¦‚å¤š masterï¼Œè¿™é‡Œé¢æœ‰ä¸ªæ³¨æ„ç‚¹å°±æ˜¯å°½é‡ä½¿ç”¨ä¸åŒæœºæž¶æ¥éƒ¨ç½² master ç»„ä»¶ï¼Œè¿™æ ·å³ä½¿æœºæž¶ä¸Šçš„ç½‘ç»œè®¾å¤‡å‡ºé—®é¢˜ï¼Œä¹Ÿå¯ä»¥è½»æ¾åº”å¯¹ï¼Œå¦‚æžœæ¡ä»¶å…è®¸çš„è¯ï¼Œå¤šæœºæˆ¿éƒ¨ç½² k8s é›†ç¾¤ï¼Œæš‚æ—¶æ²¡æœ‰è€ƒè™‘ k8s å’Œç‰©ç†æœºæ··å¸ƒ

### 2020-05-12ï¼šKubernetes åœ¨æ™ºè”æ‹›è˜å†…ç½‘çš„åº”ç”¨åœºæ™¯

[çŸ³å¢¨æ–‡æ¡£](https://shimo.im/docs/GRTTvvcjcpVjG8rt)

> Q1ï¼šç®¡ç†å­˜å‚¨ï¼ˆPVC/PVï¼‰åˆ›å»ºå®¹é‡ç›¸å…³å®žè·µæ˜¯æ€Žä¹ˆæ ·çš„ï¼Ÿå¦‚ä½•è¿›è¡Œé™åˆ¶åº”ç”¨éƒ¨ç½²éšä¾¿åˆ›å»ºè¶…çº§å¤§çš„å­˜å‚¨ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬ç”Ÿäº§çŽ¯å¢ƒå¹¶æœªä½¿ç”¨ pvc/pvã€‚è¿™ä¸¤ç§å­˜å‚¨æ–¹å¼ï¼Œä»…ä»…æ˜¯åœ¨éªŒæ”¶çŽ¯å¢ƒåšè¿‡ä¸€äº›åŠŸèƒ½æµ‹è¯•ã€‚ç”Ÿäº§çŽ¯å¢ƒä¸»è¦æ˜¯æ— çŠ¶æ€åº”ç”¨ã€‚åŽæœŸå¯èƒ½ä¼šä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼åšéƒ¨ç½²æœ‰çŠ¶æ€åº”ç”¨çš„æœåŠ¡ã€‚è°ƒç ”è¿‡ ceph/glusterfsï¼Œä¼°è®¡ä¼šé‡‡ç”¨ ceph åš pvc/pv çš„åº”ç”¨ã€‚

> Q2ï¼šk8s è°ƒåº¦ç­–ç•¥æ˜¯æ€Žæ ·çš„ï¼Ÿæœ‰æ²¡æœ‰å‡ºçŽ°è°ƒåº¦ä¸å‡è¡¡é—®é¢˜ï¼Ÿæ¯”å¦‚æœ‰äº›æœåŠ¡å™¨å†…å­˜å‰©ä½™ä¸å¤šäº†ï¼Œè¿˜é¢‘ç¹è°ƒåº¦è¿‡åŽ»

Aï¼šk8s çš„è°ƒåº¦ç­–ç•¥æ˜¯ scheduler è¿™ä¸ªç»„ä»¶å®Œæˆçš„ï¼Œé‡Œé¢æœ‰å¤šç§è¯„åˆ†æ–¹å¼ï¼Œæ ¹æ®èŠ‚ç‚¹çš„è¯„åˆ†åŽ»åš pod çš„èµ„æºè°ƒåº¦ï¼Œè¿™ä¸ªé—®é¢˜å†è¸©å‘åˆ†äº«é‡Œæœ‰ä»‹ç»éƒ¨åˆ†ï¼Œå¦‚æžœæ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹ç›¸å…³çš„è°ƒåº¦ç®—æ³•æºç ã€‚

> Q3ï¼šæ˜¯å¦ä½¿ç”¨åˆ° HPA æ ¹æ®å†…å­˜ä½¿ç”¨æƒ…å†µæˆ–è‡ªå®šä¹‰ metric æŒ‡æ ‡è¿›è¡Œè‡ªåŠ¨åŒ–æ‰©ç¼©å®¹ï¼Ÿæœ‰é‡åˆ°ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ

Aï¼šHPA ç›®å‰ç”Ÿäº§çŽ¯å¢ƒä»…éƒ¨åˆ†ä¸šåŠ¡ä½¿ç”¨ã€‚æ ¹æ®å†…å­˜/è‡ªå®šä¹‰ metric æŒ‡æ ‡çš„è‡ªåŠ¨æ‰©å±•ï¼Œå¹¶æœªåœ¨ç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨ã€‚ä¸»è¦è¿˜æ˜¯ä»¥ cpu/mem çš„æŒ‡æ ‡ä½œä¸º hpa çš„ scale ç­–ç•¥ã€‚

> Q4ï¼šæ‰€è¯´çš„å®žä¾‹æ•°é‡ 600 å¤šä¸ªï¼Œæ˜¯æŒ‡ 600 å¤šä¸ª pod å—ï¼Ÿæ˜¯å¦åšåˆ°å¹³æ»‘æ›´æ–°ï¼Ÿæ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼š600 å¤šå®žä¾‹æ˜¯æŒ‡ pod çš„æ•°é‡ã€‚å¹³æ»‘æ›´æ–°é‡‡ç”¨ deployment çš„æ›´æ–°ç­–ç•¥åŽ»å®Œæˆçš„ã€‚

> Q5ï¼šè¯·é—®ä¸€ä¸‹æ™ºè”å†…éƒ¨æ˜¯æ€Žä¹ˆåšé›†ç¾¤å‡çº§çš„ï¼Ÿæ˜¯åŽŸåœ°å‡çº§è¿˜æ˜¯è¿ç§»å‡çº§ï¼Œå¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„å½±å“æœ€å°åŒ–ï¼Ÿ

Aï¼šå‡çº§æ–¹å¼æˆ‘ä»¬é‡‡ç”¨æ¯”è¾ƒå®‰å…¨çš„åšæ³•ã€‚å¤šé›†ç¾¤æ»šåŠ¨å‡çº§ï¼Œæ¯”å¦‚ç”Ÿäº§æœ‰ä¸¤å¥—é›†ç¾¤ï¼Œæˆ‘ä»¬ä»Žå‰ç«¯çš„æµé‡å†…å–å‡ºä¸€å¥—é›†ç¾¤åšå®Œå‡çº§åŽï¼Œåšæµé‡çš„å¹³æ»‘åˆ‡æ¢

> Q6ï¼šè¯·é—®ä¸€ä¸‹æ™ºè”å†…éƒ¨æœ‰æ²¡æœ‰åšå¤š AZ å¤šæ´»æž¶æž„ï¼Œæµé‡åˆ†å‘ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šå½“å‰ä½¿ç”¨åˆ°çš„æ˜¯ A/B é›†ç¾¤çš„æ¨¡å¼ï¼Œå‰ç«¯æµé‡åšè½®è¯¢è‡³ä¸¤å¥—é›†ç¾¤ï¼Œå¦‚æžœè¦åšç°åº¦çº§åˆ«çš„åº”ç”¨å‘å¸ƒï¼Œé‡‡ç”¨ cookie çš„æ–¹å¼ï¼Œä»Žå‰ç«¯çš„ nginx åšæµé‡çš„è´Ÿè½½

> Q7ï¼šæœ‰æ²¡æœ‰å¯¹é›†ç¾¤å†…çš„ä¸œè¥¿å‘å’Œå—åŒ—å‘æµé‡åšé‡‡é›†åˆ†æžï¼ŸæŠ€æœ¯æ ˆæœ‰å“ªäº›ï¼Ÿ

Aï¼šä¸å¥½æ„æ€ï¼Œè¿™ä¸ªæ²¡å¤ªæ˜Žç™½å…·ä½“æ˜¯æŒ‡å“ªé‡Œ

> Q8ï¼šè¯·é—®æ™ºè”å†…éƒ¨åŸºäºŽå“ªäº›å› ç´ æ¥é€‰åž‹å®¹å™¨ç½‘ç»œæ’ä»¶çš„ï¼Ÿè¿‡ç¨‹æœ‰æ²¡æœ‰è¸è¿‡å“ªäº›å‘ï¼Ÿ

Aï¼šæˆ‘ä»¬ä»Žæœ€æ—©ä½¿ç”¨çš„ flannel ç½‘ç»œåˆ‡æ¢è‡³ calico ç½‘ç»œã€‚é€‰åž‹ä¸»è¦æ˜¯è€ƒè™‘ç½‘ç»œçš„ç¨³å®šåŠåžåé‡ã€‚calico ä¸»è¦æ˜¯è§£å†³ä¸šåŠ¡ç³»ç»ŸæŽ’æŸ¥é—®é¢˜ï¼Œæ‰¾ä¸åˆ°çœŸå®žå®¹å™¨çš„ IP æ‰åšçš„åˆ‡æ¢

> Q9ï¼šæ‚¨å¥½ï¼Œæƒ³é—®ä¸€ä¸‹å†…éƒ¨ api æŽ¥å£è¯·æ±‚æ˜¯ç›´æŽ¥ç”¨çš„ k8s çš„ service å˜›ï¼Ÿæ‰æŽ¥è§¦åˆ°ï¼Œæ„Ÿè°¢ ðŸ™

Aï¼šå†…éƒ¨æœåŠ¡ä¹‹é—´ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯ service çš„æ–¹å¼è°ƒç”¨ã€‚å› ä¸ºå¦‚æžœä½¿ç”¨åŸŸåçš„æ–¹å¼ï¼Œç›¸å½“äºŽæµé‡è¦å†ç»•ä¸€åœˆã€‚ä½†æ˜¯éƒ¨åˆ†ä¸šåŠ¡ä¹Ÿæ˜¯éœ€è¦èµ°åŸŸåçš„æ–¹å¼è°ƒç”¨ï¼Œè¿™ä¸ªå–å†³äºŽåº”ç”¨è‡ªèº«

> Q10ï¼šæˆ‘æƒ³é—®ä¸‹å¦‚ä½•éƒ¨ç½²å‡ ç™¾ä¸ªæœåŠ¡ä¿è¯é«˜å¯ç”¨ï¼Œæœºå™¨æœ‰é™æƒ…å†µä¸‹

Aï¼šæƒ³è¦åœ¨æœºå™¨æœ‰é™çš„æƒ…å†µä¸‹ä¿è¯å¤šä¸ªæœåŠ¡çš„é«˜å¯ç”¨å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªæ–¹é¢è€ƒè™‘ã€‚1. åº”ç”¨è‡ªèº«çš„æ¶ˆè€—ï¼Œæ¯”å¦‚ CPU/MEM ç­‰ï¼ŒåŸºäºŽè¿™ä¸ªçœŸå®žçš„ä½¿ç”¨åšå¥½èµ„æºçš„é™åˆ¶ã€‚2. æœ€å°‘æä¾› 2 ä¸ªåŠä»¥ä¸Šçš„å‰¯æœ¬æ•°ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ï¼Œåˆ©ç”¨ k8s çš„æŽ¢é’ˆåŽ»åšæœåŠ¡é«˜å¯ç”¨

> Q11ï¼šå¯¹äºŽå®¹å™¨å®‰å…¨æ–¹é¢æœ‰æ²¡æœ‰å¥½çš„å®žè·µåˆ†äº«ï¼Ÿä¾‹å¦‚åŸºç¡€é•œåƒï¼ŒPSPï¼Œæ“ä½œç³»ç»Ÿå±‚é¢å®‰å…¨åŠ å›ºç­‰

A: å®¹å™¨çš„å®‰å…¨æ–¹é¢ï¼Œç›®å‰æˆ‘ä»¬ä»…ä½¿ç”¨äº† harbor çš„é•œåƒæ‰«æç»„ä»¶ï¼Œåˆ«çš„å®‰å…¨åŠ å›ºæœ‰å®‰å…¨å›¢é˜Ÿè´Ÿè´£åœ¨åš

> Q12:  å››å¥— k8s é›†ç¾¤æ˜¯æŒ‡ 4 å¥—çŽ¯å¢ƒï¼Œæ¯å¥—çŽ¯å¢ƒå¯¹åº”ä¸€å¥— k8s é›†ç¾¤å—ï¼Ÿç›‘æŽ§ç³»ç»Ÿå‡ å¥—ï¼Ÿæ˜¯å¦åšäº†ç›‘æŽ§ç³»ç»Ÿçš„é«˜å¯ç”¨ï¼Œå¦‚ä½•åšçš„ï¼Ÿ

Aï¼š4 å¥—é›†ç¾¤ï¼Œæˆ‘ä»¬è¿™è¾¹æ˜¯æ ¹æ®çŽ¯å¢ƒåˆ’åˆ†çš„ã€‚éªŒæ”¶ 1 å¥—ï¼Œé¢„ä¸Šçº¿ 1 å¥—ï¼Œç”Ÿäº§ 2 å¥—ã€‚ç›‘æŽ§ç³»ç»Ÿåœ¨å„è‡ªé›†ç¾¤éƒ½æœ‰æŒ‡æ ‡é‡‡é›†å™¨ï¼Œè¿™ä¸ªåœ¨åˆ†äº«å†…æœ‰æž¶æž„è¯´æ˜Žã€‚ç›‘æŽ§ç³»ç»Ÿçš„é«˜å¯ç”¨ä¹Ÿæ˜¯é‡‡ç”¨çš„ prometheus çš„å¤šæœºæ–¹å¼åšçš„

> Q13: è¯·é—®ä½ ä»¬ K8S é›†ç¾¤å®‰è£…æ˜¯ç”¨ä»€ä¹ˆæ–¹å¼çš„å‘¢ï¼Ÿå¯ä¸å¯ä»¥åˆ†äº«ä¸€ä¸‹ä¹ˆï¼Ÿ

A:ç›®å‰é‡‡ç”¨çš„æ˜¯äºŒè¿›åˆ¶åŒ…çš„æ–¹å¼å®‰è£…ï¼Œåˆ©ç”¨ ansible åŽ»åšçš„ã€‚éšç€ kubeadm çš„ç¨³å®šï¼ŒåŽæœŸå¯èƒ½ä¼šé‡‡ç”¨ kubeadm çš„æ–¹å¼åšéƒ¨ç½²ã€‚è·Ÿä½ åˆ†äº«ä¸€ä¸ªæ¯”è¾ƒä¸é”™çš„å¼€æºéƒ¨ç½²è§£å†³æ–¹æ¡ˆï¼ˆ[https://github.com/easzlab/kubeasz](https://github.com/easzlab/kubeasz)ï¼‰

> Q14:éƒ¨ç½²æ–‡æ¡£å’Œè¸©è¿‡å‘çš„æ–‡æ¡£èƒ½åˆ†äº«å‡ºæ¥ä¹ˆï¼Ÿæ€Žä¹ˆæŸ¥çœ‹é›†ç¾¤çš„æ•´ä½“èµ„æºï¼Œç”¨ç›‘æŽ§çœ‹çš„ä¹ˆï¼Ÿå…¬å¼€äº†å¤§ä¼™å¥½ä»¿ç…§æ­å»ºä¸€ä¸ªç±»ä¼¼çš„ ï½ž

A:è¿™ä¸ªåŽæœŸä¼šè€ƒè™‘åˆ†äº«ï¼Œå› ä¸ºæ–‡æ¡£å†…æœ‰ä¸€äº›æ•°æ®ä¸æ–¹ä¾¿å…¬å¼€ã€‚æ•´ä½“èµ„æºçš„ç›‘æŽ§ï¼Œå¯ä»¥ç”¨ prometheus æ”¶é›†åŽï¼Œé€šè¿‡ grafana çœ‹åˆ°

> Q15:é—®é—® vmware ç”¨ calico æ€Žä¹ˆåˆ›å»ºingress è·Ÿ load balanxe ç±»åž‹çš„ servicep

A:è¿™ä¸ªæˆ‘å€’æ˜¯æ²¡æœ‰å°è¯•è¿‡ã€‚ä½ æ˜¯æŒ‡è¦åˆ›å»ºç±»ä¼¼äºŽé˜¿é‡Œ/GCE æ–¹å¼çš„æœåŠ¡ IP ç›´æŽ¥æš´éœ²å…¬ç½‘çš„ä¹ˆï¼Ÿå¦‚æžœæ˜¯è¿™æ ·çš„è¯ï¼Œä¼°è®¡éœ€è¦å¼€å‘å¯¹åº”çš„ç»„ä»¶æ‰å¯ä»¥

> Q16:ä½ ä»¬çš„ es é›†ç¾¤é…ç½®æ˜¯å¤šå°‘ï¼Ÿé«˜å³°æœŸæœ‰æ²¡æœ‰ç»Ÿè®¡è¿‡æ¯åˆ†é’Ÿæˆ–è€…æ¯ç§’å†™å…¥æ—¥å¿—çš„é‡ï¼Œä¹Ÿå°±æ˜¯èƒ½æ‰¿è½½å¤šå°‘ qpsï¼Ÿä¸»è¦æ˜¯å‚è€ƒ

A:ç›®å‰æˆ‘ä»¬ es é›†ç¾¤å…±æœ‰ 13 ä¸ª nodeï¼Œä¸è¿‡é…ç½®ä¸å¤ªé«˜ï¼Œå› ä¸ºç£ç›˜ä¸å¥½ã€‚å¦‚æžœä½ ä»¬è¦ç”Ÿäº§çº§åˆ«ä½¿ç”¨ï¼Œå»ºè®®ç”¨ ssd çš„ç£ç›˜ï¼Œè¿™æ ·ä¼šå¥½å¾ˆå¤šã€‚QPS åœ¨å³°å€¼åŸºæœ¬å¯ä»¥åˆ° 8000-1W

> Q17:è¯·é—®åº”ç”¨éƒ¨ç½²æœ‰æ²¡æœ‰åšè·¨é›†ç¾¤éƒ¨ç½²

A:æˆ‘ä»¬ç›®å‰å°±æ˜¯å¤šé›†ç¾¤çš„åº”ç”¨éƒ¨ç½²æ–¹å¼

> Q18:æœ‰çŠ¶æ€åº”ç”¨è¯·é—®æ˜¯å¦‚ä½•ç®¡ç†çš„ï¼Ÿä½¿ç”¨ statefulset?è¿˜æ˜¯ operatorï¼Ÿæˆ–è€…å…¶å®ƒæ–¹å¼å‘¢ï¼Ÿ

A:ç›®å‰æœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œæˆ‘ä»¬åªç”¨åˆ°äº†å°‘æ•°ï¼Œä½¿ç”¨çš„æ˜¯ statefulset

> Q19:è¯·é—® filebeat æ€Žä¹ˆåœ¨èŠ‚ç‚¹æ”¶é›†åº”ç”¨ç³»ç»Ÿæ—¥å¿—

A:æˆ‘ä»¬æ˜¯æŒ‚è½½ç‰©ç†èŠ‚ç‚¹çš„å®¹å™¨æ—¥å¿—ï¼Œä½¿ç”¨ filebeat çš„ kubernetes æ¨¡å—åŽ»åšçš„æ”¶é›†ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ filebeat çš„å®˜æ–¹ kubernetes éƒ¨ç½²æ–¹æ¡ˆï¼Œé‡Œé¢æœ‰æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»

> Q20:ä½ ä»¬ node èŠ‚ç‚¹å†…æ ¸æ˜¯ 3.10 ç‰ˆæœ¬ï¼Œæ˜¯å¦è€ƒè™‘å‡çº§å†…æ ¸ç‰ˆæœ¬ï¼Œæ¥ä¼˜åŒ–æ€§èƒ½ï¼Ÿ

A:ä¹‹å‰åšè¿‡å‡çº§è‡³ centos8 çš„å°è¯•ï¼Œå‘çŽ°ä¸è¡Œã€‚ä¸»è¦æ˜¯å› ä¸ºé˜²ç«å¢™è¿™é‡Œçš„åŠŸèƒ½å‡çº§å¯¼è‡´ã€‚åŽé¢ä¼°è®¡ä¼šè€ƒè™‘å‡çº§ç³»ç»Ÿå†…æ ¸çš„æ–¹å¼åŽ»åšä¸€äº›æ€§èƒ½ä¼˜åŒ–

> Q21:æ—¥å¿—æŠ¥è­¦æ€Žä¹ˆåšçš„ï¼Ÿ

A:

> Q22:è´µå…¬å¸çš„ pod æ—¥å¿—æ”¶é›†ä½¿ç”¨ logsider äº†å—ï¼Œå¦å¤–è´µå…¬å¸ä½¿ç”¨ hpa æ—¶æ˜¯å¦è°ƒæ•´è¿‡ hpa çš„ä¼¸ç¼©é€Ÿåº¦

A:

> Q23:å‰æ®µæ—¶é—´å…¬å¸é›†ç¾¤èŠ‚ç‚¹æŠ¥é”™ï¼Œimagecollect åžƒåœ¾å›žæ”¶å‡ºé—®é¢˜äº†å¯¼è‡´ pod æ— æ³•åˆ›å»ºåœ¨è¯¥èŠ‚ç‚¹ï¼Œè¯·é—®é‡åˆ°è¿‡é©¬ï¼Ÿæœ‰ä»€ä¹ˆå»ºè®®ï¼Ÿ

A:

> Q24:600 ä¸ª podï¼Œnode æ•°é‡å¤§æ¦‚å¤šå°‘å°ï¼Ÿ

A:

> Q25:master replica a/b/c ä¸­ api-server,etcd åšé›†ç¾¤ï¼Œå…¶ä½™ç»„ä»¶åªæ˜¯ master replica a æä¾›æœåŠ¡ï¼Ÿ

A:

> Q26:è¯·é—®å¤šé›†ç¾¤éƒ¨ç½²æ€Žä¹ˆåšçš„ï¼Œèƒ½è®²è®²ç»†èŠ‚å˜›ï¼Ÿ

A:

### 2020-05-07ï¼šé…·å®¶ä¹æœåŠ¡ç½‘æ ¼ä¸Ž Serverless è½åœ°æƒ…å†µ

[çŸ³å¢¨æ–‡æ¡£](https://shimo.im/docs/VYjJQkv9d6kHqCg6)

> Q1ï¼šå¦‚ä½•è§£å†³ knative Queue proxy æ€§èƒ½é—®é¢˜ï¼Ÿå’Œå®¹å™¨ç›¸æ¯” Knative å¼•å…¥ queue proxy å¯¼è‡´ Qps æ€§èƒ½æœ‰å¾ˆå¤§çš„é™ä½Žï¼Œè¿™æ–¹é¢æœ‰è°ƒä¼˜ï¼Ÿ èƒ½å¦ä»‹ç»ä¸‹ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜è¦è¾©è¯æ¥çœ‹ï¼Œå°±åƒ Istio ä¹Ÿå¼•å…¥äº† istio-proxy è¿™ä¸ªè¾¹è½¦ï¼Œä¹ŸåŒæ ·å¸¦æ¥æ€§èƒ½ä¸‹é™æ˜¯ä¸€è‡´çš„ã€‚å°±æ˜¯è¯´ä½ ä»Žå¼•å…¥è¿™ä¸ªæ–°æ¡†æž¶ï¼Œç»™ä¸šåŠ¡å’Œå›¢é˜Ÿå¸¦æ¥çš„æ”¶ç›Šï¼Œèƒ½å¦è¦†ç›–å¼•å…¥è¿™ä¸ªæ–°æ¡†æž¶å¸¦æ¥çš„æŸå¤±ï¼Ÿä½ æ˜¯å¦æŽ¥å—è¿™æ ·çš„æŸå¤±ï¼Œè¿™ä¸ªæŸå¤±æ˜¯å¦å¯èƒ½ä¼šè¢«ä½ ä»¬å›¢é˜Ÿæˆ–è€…ç¤¾åŒºä¼˜åŒ–ï¼Ÿè¿™äº›é—®é¢˜è€ƒè™‘æ¸…æ¥šçš„è¯ï¼Œæ‰å¯ä»¥ä¸‹å†³ç­–æˆ–è€…åˆ¤æ–­ã€‚

åœ¨æˆ‘ä»¬è½åœ°çš„å®žè·µä¸­ï¼Œæˆ‘ä»¬å°šæœªå¯¹ queueproxy æœ¬èº«è¿›è¡Œè°ƒä¼˜ï¼Œè¿™å—æˆ‘ä»¬çš„è®¡åˆ’æ˜¯ç­‰ç¤¾åŒºæˆç†Ÿåˆ°ä¸€å®šç‰ˆæœ¬ä¹‹åŽï¼Œå†è€ƒè™‘è‡ªå·±çš„ä¼˜åŒ–ï¼Œä¸è¦ Hit a running targetã€‚ä¸¾ä¸ªåä¾‹ï¼Œæˆ‘ä»¬ä¹‹å‰æ›¾å¯¹ K8s, Istio åšè¿‡ä¸€äº›æ”¹é€ ï¼Œä½†æ˜¯ç”±äºŽç‰ˆæœ¬æ›´æ–°å¾ˆå¿«ï¼Œæœ€åŽå¸¦æ¥çš„å…¼å®¹æ€§é—®é¢˜ï¼Œå‡çº§å‡ä¸äº†ç­‰é—®é¢˜ä¹Ÿå¾ˆå¤šã€‚æ‰€ä»¥æˆ‘çš„æ–¹æ³•è®ºæ˜¯ç¨³å®šä¹‹å‰ä¸è¦æå‰ä¼˜åŒ–ï¼Œä¸è¦è¿‡åº¦ä¼˜åŒ–ã€‚

> Q2ï¼šIstio æ¡†æž¶ä¸­å¯¹äºŽç½‘ç»œè¯·æ±‚çš„æ¥æº IP æ˜¯å¦‚ä½•é€šè¿‡åº”ç”¨å±‚èŽ·å–åˆ°çš„å‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´ IP åœ°å€ä¼šè¢«æ¢æˆ Sidecar çš„åœ°å€æˆ–è€…æ˜¯è¢« K8s çš„ LB æ¢æˆ Node çš„ä¸»æœºåœ°å€ã€‚ å½“ç„¶æœ‰ä¸€ç§åŠžæ³•æ˜¯åœ¨è¯·æ±‚è¿›å…¥ K8s å‰é¢åŠ  Reverse Proxyï¼Œå†™å…¥ HTTP headerã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„åŠžæ³•å—ï¼Ÿ

Aï¼šè¿™å—ä¼¼ä¹Žä¸æ˜¯ä¸€ä¸ªæœåŠ¡ç½‘æ ¼æˆ–è€… k8s çš„é—®é¢˜å§ï¼Œhttp è¯·æ±‚é‡Œé¢æœ‰å¤šä¸ª header è·Ÿ ip ç›¸å…³ï¼Œä¾‹å¦‚ x-forwarded-for, real-ip ç­‰ç­‰ï¼Œä½ åªè¦ä¿è¯ç½‘å…³å±‚æ²¡æœ‰ä¸¢æŽ‰è¿™äº› headerï¼Œå…¶ä»–ä¸­é—´å±‚é€ä¼ äº†è¿™äº› headerï¼Œåº”è¯¥ä¸ä¼šé‡åˆ°æ‹¿ä¸åˆ°å®¢æˆ·ç«¯ ip çš„æƒ…å†µå•Šã€‚æˆ‘é‡è§è¿‡çš„ç±»ä¼¼æƒ…å†µéƒ½æ˜¯å› ä¸ºæŸäº›ä¸šåŠ¡éœ€æ±‚é­”æ”¹äº† nginx å¯¼è‡´çš„ã€‚ã€‚ä¸é­”æ”¹åº”è¯¥ä¸ä¼šå‡ºè¿™ä¹ˆåŸºç¡€çš„é—®é¢˜ã€‚

> Q3ï¼šCustom Gateway åœ¨ Istio æ¡†æž¶ä¸­æ˜¯æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼ŸCustom Gatway å¦‚ä½•ä¸Ž Istio çš„ Gatway å…±å­˜ï¼Ÿä¾‹å¦‚ WAN -> istio Gatway(all-to-my-own-gatway) -> my gatway -> back to istio gateway(routing) -> microservice æ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡ä¹ˆï¼Ÿ

Aï¼šä½ è¯´çš„ä¸¤ç§ Gateway å…±å­˜æˆ‘æ²¡é‡è§è¿‡ï¼Œä¸å¥½è¯´ã€‚æˆ‘ä»¬å†…éƒ¨çš„ç½‘å…³éƒ½æ˜¯è‡ªå·±çš„å†™çš„ï¼Œå¯ä»¥å½“ä½œä¸€ä¸ª service æ¥ä½¿ç”¨ï¼Œä¸¥æ ¼æ¥è¯´ä¸è·Ÿ istiogateway å¹¶åˆ—ã€‚ä½ è¯´çš„è¿™ä¸ªé“¾è·¯æˆ‘ç›´è§‚æ„Ÿè§‰æ˜¯å¤ªé•¿äº†ï¼Œå¯èƒ½ä¸æ˜¯ä¸ªæœ€ä¼˜è®¾è®¡

> Q4ï¼šå½“å‰ Knative æˆç†Ÿåº¦æ€Žä¹ˆæ ·ï¼Ÿæ˜¯å¦ç”Ÿäº§ä¸Šä½¿ç”¨ï¼Œèƒ½å¦ä»‹ç»ä¸‹è¸©äº†å“ªäº›å‘ï¼Ÿ

Aï¼šæ¯”è¾ƒæˆç†Ÿï¼Œå¯ä»¥åœ¨ç”Ÿäº§ä¸Šå°è§„æ¨¡ä½¿ç”¨(å¤§è§„æ¨¡ä½¿ç”¨å»ºè®®ç­‰ä»–å‘å¸ƒ 1.0). å¤§å‘åœ¨åˆ†äº«ä¸­å·²ç»æåˆ°è¿‡äº†ï¼Œå°å‘ä¸å°‘ï¼Œå¯ä»¥ä¸¾å‡ ä¸ªä¾‹å­

ç”±äºŽæˆ‘ä»¬è‡ªå·±æ”¹äº† K8S çš„æºç å¯¼è‡´ Knative çš„ activator ä¸èƒ½æ­£å¸¸æ‰©ç¼©å®¹

æ–°çš„ Revision å¡ä½èµ·ä¸æ¥

webhook ç»„ä»¶å¶å°”ä¸æ­£å¸¸å·¥ä½œ

è¿™äº›å°å‘æœ€åŽä¹Ÿéƒ½è§£å†³äº†ï¼Œä¸æ˜¯ä»€ä¹ˆé‡å¤§å½±å“:

> Q5ï¼šMicroService ç»Ÿä¸€é…ç½®ç®¡ç† æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½åœ°è§£å†³æ–¹å¼ä¹ˆï¼Ÿå°¤å…¶æ˜¯å¯¹ç”Ÿäº§æ•°æ®åº“å¯†é’¥çš„ä¸‹æ”¾ã€‚

Aï¼šè¿™ä¸ªé—®é¢˜åº”è¯¥æ˜¯æ”¾åœ¨é…ç½®ä¸­å¿ƒæˆ–è€…æ•°æ®åº“ä¸­é—´ä»·é‡Œï¼Ÿè¿™åº”è¯¥æ˜¯ä¸€ä¸ªæœåŠ¡æ²»ç†çš„åŸºç¡€é—®é¢˜å§ï¼Œå¾ˆå¤šå…¬å¸å’Œå›¢é˜Ÿè§£å†³è¿‡äº†ï¼Œå¯ä»¥æœä¸€ä¸‹ nacos, tddl, etcd ç­‰

> Q6ï¼šä½ è®¤ä¸ºå½“å‰ Knative å­˜åœ¨å“ªäº›æ¡†æž¶ä¸Šçš„é—®é¢˜å’Œç¼ºé™·ï¼Ÿè¿™äº›é—®é¢˜ç¤¾åŒºè¿›å±•æ€Žä¹ˆæ ·ï¼Ÿ

Aï¼šå†·å¯åŠ¨æ—¶é—´å¤ªé•¿ï¼Œè¿™ä¸ªç¤¾åŒºæœ‰ä¸“é¡¹è·Ÿè¸ªï¼Œåº”è¯¥ä¼šä¸æ–­ä¼˜åŒ–ï¼›proxy è‡ƒè‚¿ï¼Œè¿™ä¸ªç¤¾åŒºé‡Œä¼¼ä¹Žè¿˜ä¸æ€¥ï¼ŒçŽ°åœ¨åªèƒ½ä½œä¸ºä¸€ä¸ªå‰ææ¥æŽ¥å—äº†ï¼›è¿˜æœ‰ä¸€äº›æ‚ä¸ƒéº»å…«çš„ç®¡ç†é—®é¢˜ï¼Œè¿™äº›è‚¯å®šä¼šè¢«ç¤¾åŒºé€æ­¥å®Œå–„ï¼Œæˆ–è€…ä¼šå‡ºçŽ°ä¸“é—¨ç®¡ç† kantive çš„ä¸‰æ–¹ç³»ç»Ÿã€‚ä¸ªäººè§‰å¾— knative ç¤¾åŒºè¿›å–å¿ƒè¿˜æ˜¯å¯ä»¥çš„ï¼Œç¼ºç‚¹æ˜¯äººæ¯”è¾ƒå°‘ï¼ŒåŠ³åŠ¨åŠ›ä¸è¶³ã€‚

> Q7ï¼šKNative çš„å†·å¯åŠ¨æƒ…å†µæ˜¯æ€Žä¹ˆæ ·çš„ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆç›‘æµ‹æ•°æ®å¯ä»¥å…±äº«ä¸€ä¸‹ã€‚å®˜æ–¹è¯´ä¼šæœ‰ 10s ä»¥ä¸Šçš„å†·å¯åŠ¨æ—¶é—´ä¸”è‡³ä»Šæ— è§£ã€‚ç›¸æ¯” AWS Lambda çš„å†·å¯åŠ¨æ—¶é—´ä¼šçŸ­å¾ˆå¤šã€‚[https://github.com/knative/serving/blob/master/docs/roadmap/scaling-2019.md](https://github.com/knative/serving/blob/master/docs/roadmap/scaling-2019.md)

Aï¼šAWS çš„å†·å¯åŠ¨åšçš„å·²ç»éžå¸¸å¥½äº†ï¼Œä»–ä»¬é‡Œé¢æœ‰å¾ˆå¤šä¼˜åŒ–ã€‚æˆ‘ä»¬è‡ªå·±å†…éƒ¨ä¸€ç›´åœ¨å…³æ³¨äº†æµ‹è¯•ã€‚æˆ‘ä»¬çš„ benchmark æ˜¯æ‰¾æœ€ç®€å•çš„ go è¯­è¨€çš„ helloword æœåŠ¡ï¼Œå…³é—­ istio-proxyï¼Œåšå¥½é•œåƒåœ¨ host æœºå™¨ä¸Šçš„ç¼“å­˜ï¼Œç„¶åŽæµ‹å†·å¯åŠ¨å¹³å‡å€¼ï¼Œè¿™ä¸ªå€¼å·²ç»ä»Ž 0.8 ç‰ˆæœ¬çš„ 4 ç§’ä¸‹é™åˆ°çŽ°åœ¨çš„ 3 ç§’å·¦å³äº†ã€‚ç¤¾åŒºè¿˜æ˜¯åœ¨ä¸æ–­ä¼˜åŒ–çš„.

> Q8ï¼šIstio æœ¬èº«çš„ç‰ˆæœ¬æ›´æ–°ä½ ä»¬æ˜¯æ€Žä¹ˆè‡ªåŠ¨åŒ–çš„ï¼Ÿæˆ‘ç›®å‰é¡¹ç›®è¿˜æ˜¯ç”¨ helm æ‰“åŒ…æˆä¸€ä¸ªæ–°çš„ Chart å®žçŽ°çš„ã€‚ä½†æ˜¯ Helm çš„å®‰è£…æ–¹å¼å·²ç»è¢« deprecated æŽ‰äº†ã€‚
> Aï¼šæˆ‘ä»¬æ²¡æœ‰åš Istio ç‰ˆæœ¬æ›´æ–°çš„è‡ªåŠ¨åŒ–ã€‚æ‰‹åŠ¨å®‰è£…ä¹‹å‰ç”¨çš„å°±æ˜¯ helmã€‚çŽ°åœ¨ Istio æŽ¨èç”¨ istioctl+ é…ç½®çš„å½¢å¼ç›´æŽ¥å®‰è£…å’Œå‡çº§

> Q9ï¼šä½ ä»¬ç°åº¦å‘å¸ƒä¹Ÿæ˜¯æ”¾åœ¨ CI æµç¨‹é‡Œé¢çš„ï¼Œè¿˜æ˜¯ Ops team æ‰‹åŠ¨å‘å¸ƒçš„ï¼Ÿ

Aï¼šæ”¾åœ¨ ci æµç¨‹é‡Œï¼Œå¯ä»¥é€‰æ‹©æ‰‹åŠ¨è§¦å‘æˆ–è€…é€šè¿‡ api è§¦å‘(ci ä¸»è¦æ˜¯ä½¿ç”¨çš„ gitlab-ci)

> Q10ï¼šåŸºäºŽè¿™ä¸ª BFF æž¶æž„å‰ç«¯çš„ API Gateway ä½ ä»¬æœ‰ä»€ä¹ˆé€‰æ‹©ï¼ŸAPI Gateway æ˜¯ç”¨çš„ istioçš„ingress controller å—?

Aï¼šAPI gateway è¿™å±‚æˆ‘ä»¬æ˜¯è‡ªå»ºçš„ï¼Œä½†æ˜¯çŽ°åœ¨ä¹Ÿåœ¨è€ƒè™‘ä¸€äº›æˆç†Ÿçš„å¼€æºå®žçŽ°

> Q11ï¼šå…¼å®¹åŽŸæœ‰æœåŠ¡ä½“ç³»è¿™å—å¯ä»¥å†è¯¦ç»†ä»‹ç»ä¸‹å—ï¼Ÿæ¯”å¦‚ dubbo çš„ provider æ˜¯å¦å¯ä»¥ä¸€éƒ¨åˆ†åœ¨åŽŸæœ‰æœåŠ¡ä½“ç³»ï¼Œä¸€éƒ¨åˆ†åœ¨ istio é‡Œã€‚

Aï¼šå…¼å®¹åŽŸæœ‰æœåŠ¡ä½“ç³»æœ¬è´¨ä¸Šå°±æ˜¯èƒ½è®©ä¸¤è¾¹æœåŠ¡äº’ç›¸è°ƒç”¨ã€‚è¿™ä¸ªä¸¥é‡å–å†³äºŽä½ åŽŸæ¥çš„æœåŠ¡æ²»ç†ä½“ç³»çš„æƒ…å†µï¼Œå› ä¸ºæˆ‘ä»¬çš„æœåŠ¡ä½“ç³»æ˜¯é­”æ”¹ + è‡ªå»ºçš„ï¼Œæ‰€ä»¥å¯èƒ½å¯¹ä½ ç›´æŽ¥å‚è€ƒæ„ä¹‰ä¸å¤§ï¼Œdubbo è¿™ä¸ªé—®é¢˜æˆ‘ä¸æ˜¯ä¸“å®¶ã€‚

> Q12ï¼šknative éƒ¨ç½²çš„æœåŠ¡åˆå§‹èµ„æºå¤šå°‘ï¼ˆcpuï¼Œå†…å­˜ï¼‰ï¼Ÿä»€ä¹ˆæ¡ä»¶åŽ»æ‰©å®¹å’Œç¼©å®¹ï¼Ÿ

Aï¼šå¦‚æžœ queueproxy å’Œ istioproxy éƒ½åœ¨ï¼Œé‚£ä¹ˆèµ·æ­¥è¦ 80m å†…å­˜ + ä½ çš„ä¸šåŠ¡æœåŠ¡å†…å­˜ã€‚æ‰©å®¹ç¼©å®¹çœ‹ä½ ç”¨çš„æ˜¯ä»€ä¹ˆç»„å»ºäº†ï¼Œk8s çš„ hpa ç”¨çš„æ˜¯ cpu æˆ–è€…è‡ªå®šä¹‰æŒ‡æ ‡ï¼Œknative çš„ kpa ç”¨çš„æ˜¯å¹¶å‘é‡

### 2020-04-29ï¼šæ™¨å…‰ç§‘åŠ›æ™®åŸºäºŽ GitLab CI/CD æŒç»­é›†æˆæœåŠ¡çš„åº”ç”¨

[çŸ³å¢¨æ–‡æ¡£](https://shimo.im/docs/kcqhvgCyqGYW6XTj)

> Q1ï¼šgitlab-runner åœ¨æ²¡æœ‰ CICD ä»»åŠ¡æ—¶ä¹Ÿæ˜¯è¿è¡Œä¸­çš„ä¹ˆï¼Ÿé‚£è¿™æ ·æ˜¯å¦ä¼šå ç”¨è¿‡å¤šèµ„æºï¼Ÿæ˜¯å¦å¯ä»¥åšåˆ°ç±»ä¼¼ Jenkins + kubernetes å½“æœ‰ CICD ä»»åŠ¡çš„æ—¶å€™æ‰æŒ‰éœ€å¯åŠ¨ä¸€ä¸ªæ–°çš„ slaver å®¹å™¨ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¸€ä¸ªç»„çš„é¡¹ç›®åªå¯åŠ¨ä¸€ä¸ª runner å®¹å™¨ï¼Œæ³¨å†Œ 4 ä¸ª workerï¼Œrunner ä¾è½®è¯¢æ–¹å¼ç›‘å¬ gitlab æž„å»ºä»»åŠ¡ï¼Œæ²¡ä»»åŠ¡æ—¶å°± 1 ä¸ªå®¹å™¨ï¼Œæœ‰ä»»åŠ¡æ—¶æ‰ä¼šå¯åŠ¨æž„å»ºå®¹å™¨ï¼Œæž„å»ºå®¹å™¨çš„èµ„æºå ç”¨å¯é€šè¿‡é…ç½®æ–‡ä»¶é™åˆ¶ã€‚

> Q2ï¼šæˆ‘çœ‹åˆ°æœ‰äº›ç‰¹æ€§æ˜¯åœ¨æ–°ç‰ˆæœ¬çš„ gitlab é‡Œé¢æ‰æœ‰çš„ï¼Œæ—§ç‰ˆæœ¬åº”è¯¥å‡çº§å—ï¼Ÿä½ ä»¬é‡‡ç”¨çš„ä»€ä¹ˆå‡çº§ç­–ç•¥ï¼Ÿ

Aï¼šå¦‚æžœæ›´æ–°çš„ç‰¹æ€§å¯¹æˆ‘ä»¬å¾ˆæœ‰å¸å¼•åŠ›çš„è¯å¦‚ include å’Œ extendsï¼Œæˆ‘ä»¬ä¼šè¯„ä¼°ä¸€ä¸‹å‡çº§é£Žé™©å’Œè¿‘æœŸæ˜¯ä¸æ˜¯æœ‰é‡è¦ä»»åŠ¡å‘å¸ƒï¼Œéƒ½æ²¡æœ‰çš„è¯ï¼Œæˆ‘ä»¬å°±åšå¥½å¤‡ä»½è¿›è¡Œå‡çº§ï¼Œç‰ˆæœ¬çš„è¯ä¸ä¼šè·Ÿçš„ç‰¹åˆ«è¿‘ï¼Œä¹Ÿæ€•æœ‰é£Žé™©ã€‚

> Q3ï¼šå’Œ Jenkins æ¯”è¾ƒï¼Œä½ è§‰å¾— gitlab ci/cd æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œæˆ–è€…è¯´è¯´ä»–ä»¬çš„å·®åˆ«ï¼Œé€‚ç”¨åœºæ™¯ï¼Ÿ

Aï¼šjenkins åˆ«çš„å›¢é˜Ÿä¹Ÿæœ‰åœ¨ç”¨ï¼Œæˆ‘ä¸ªäººè§‰å¾— gitlab çš„é…ç½®æ›´åŠ ç®€å•ï¼Œå› ä¸ºåˆ†æ”¯ç­–ç•¥ï¼Œæˆ‘ä»¬çš„åˆå¹¶åŠ¨ä½œéƒ½ä¼šåœ¨ gitlab merge request é‡Œè¿›è¡Œï¼Œåˆå¹¶å®Œç›´æŽ¥åˆ‡åˆ° ci cd->pipeline é¡µé¢ï¼Œå›¢é˜Ÿæ¯ä¸ªäººéƒ½èƒ½å®žæ—¶èŽ·å–æž„å»ºè¿›åº¦ã€‚

> Q4ï¼šæœ‰äº†è§£ GitOps å—ï¼Ÿå°†å…¨éƒ¨é…ç½®å…¨éƒ¨ all in gitï¼ŒGitlab CI ç®—ä¸ç®—ç›¸å…³çš„å®žè·µï¼Ÿ

Aï¼šæŠ±æ­‰ï¼Œæš‚æ—¶ä¸å¤ªäº†è§£ã€‚æˆ‘ä»¬é…ç½®çš„ç¡®æ˜¯å…¨éƒ¨ä¿å­˜åœ¨ git ä¸Šçš„ï¼Œå·²ç»æ•´åˆäº† 2 ä¸ªç»„çš„é…ç½®ï¼Œç®¡ç†æ¯”ä»¥å‰æ–¹ä¾¿ã€‚

> Q5ï¼šé—®ä¸‹ä½ ä»¬å®žè·µçš„åœºæ™¯è§„æ¨¡æœ‰å¤šå¤§ï¼Ÿå¤šå¤§å›¢é˜Ÿï¼Œå¤šå°‘ä»“åº“ï¼Œå å…¬å¸å¤šå°‘æ¯”ä¾‹çš„ä»“åº“ï¼Œå¤šå°‘å¹¶å‘å’Œæµé‡çš„åº”ç”¨ï¼Œå‘å¸ƒé¢‘çŽ‡å¤šå°‘ï¼Œæ¯å¤©ä¸€æ¬¡å—ï¼Ÿ

Aï¼šæˆ‘ä»¬ç»„åŽ»å¹´ç»„å»ºçš„çŽ°åœ¨æœ‰ 10 ä¸ªå·¦å³ä»“åº“ï¼Œåˆ«çš„ç»„é¡¹ç›®æ¯”è¾ƒå¤šï¼Œæ•´ä½“å¤§æ¦‚æœ‰ 100 å¤šä¸ªé¡¹ç›®ã€‚ä½¿ç”¨ gitlab ci/cd çš„å ä¸€åŠã€‚æˆ‘ä»¬ç»„å·²ç»å®Œæˆäº† CI/CD çš„é…ç½®æ•´åˆï¼Œæ­£åœ¨å‘åˆ«çš„ç»„æŽ¨å¹¿ã€‚å‘å¸ƒé¢‘çŽ‡çš„è¯ï¼Œdevã€testã€uat æ¯”è¾ƒé¢‘ç¹ï¼Œçº¿ä¸ŠçŽ¯å¢ƒçœ‹æµ‹è¯•è¿›åº¦ 1 å¤© 1 æ¬¡ã€‚

> Q6ï¼šå¦‚æžœéœ€è¦å®¡æ‰¹å‘å¸ƒã€é€šçŸ¥è¿™äº›åŠŸèƒ½ï¼ŒGitLab CI èƒ½å®žçŽ°å—ï¼Ÿ

Aï¼šè¿™ä¸€å—çš„æˆ‘ä»¬æš‚æ—¶è¿˜æ²¡æœ‰å®žè·µã€‚

> Q7ï¼šä½ ä»¬é‡‡ç”¨çš„ç§æœ‰éƒ¨ç½²ï¼ˆce è¿˜æ˜¯ eeï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼‰ï¼Œè¿˜æ˜¯å…¬æœ‰æœåŠ¡ï¼Ÿ

Aï¼šç§æœ‰éƒ¨ç½²ï¼ŒåŒºåˆ«æˆ‘è¿™é‡Œäº†è§£çš„ä¸å¤šã€‚

> Q8ï¼šèƒ½å¦å¼€æºä½ ä»¬å®žè·µçš„ä¸€äº› yaml ï¼Œæˆ‘æƒ³å¯¹å…¶ä»–æƒ³è¯•è¯• gitlab ci çš„äººä¼šéžå¸¸æœ‰å¸®åŠ©

Aï¼šè¿™ä¸ªè¿˜åœ¨æŽ¢ç´¢å½“ä¸­ï¼Œå®˜æ–¹æä¾›çš„æœ‰å¾ˆå¤šæ¨¡æ¿ç¤ºä¾‹ [templates](https://gitlab.com/gitlab-org/gitlab/tree/master/lib/gitlab/ci/templates.) æˆ‘ä»¬è¿™è¾¹è¿˜è¦å¾ˆå¤šæ²¡æœ‰å®Œå–„ï¼Œæœ‰é—®é¢˜å¯ä»¥åœ¨ç¾¤é‡Œæˆ–é€šè¿‡ç®¡ç†å‘˜ @ æˆ‘éšæ—¶æ²Ÿé€šã€‚

> Q9ï¼šä½ ä»¬çš„ ci runner æ‹‰å–ç§æœ‰ä»“åº“çš„ ssh key æ€Žä¹ˆé…ç½®ï¼Œå¯ä»¥ä»‹ç»ä¸‹ç»éªŒå—ï¼Ÿ

Aï¼šæž„å»ºå®¹å™¨é•œåƒå¯é€šè¿‡ runner é…ç½®æ–‡ä»¶é…ç½®ã€‚å¦‚æžœæ˜¯ä¸šåŠ¡çš„åŸºç¡€é•œåƒï¼Œæž„å»ºè„šæœ¬é‡Œç›´æŽ¥ doker login -u -p æ“ä½œã€‚æŠ±æ­‰æˆ‘å½“æˆç§æœ‰é•œåƒä»“åº“çš„æƒé™äº†ï¼Œä½ éœ€è¦çš„å¯èƒ½æ˜¯è¿™ä¸ª [README.html](https://docs.gitlab.com/ee/ci/ssh_keys/README.html) ã€[repository_mirroring](https://gitlab.colipu.com/help/workflow/repository_mirroring)

> Q10ï¼šæœ‰ä¸ªå°å»ºè®®ï¼Œé€šè¿‡åˆ¤æ–­ git log é‡Œé¢çš„æ—¥å¿—ï¼Œå¯ä»¥æŽ§åˆ¶ä¸€äº› step çš„æ‰§è¡Œ ã€‚æ¯”å¦‚ï¼Œæäº¤é‡Œé¢æœ‰ ã€deployã€‘æ‰å‘å¸ƒï¼›æ²¡æœ‰çš„è¯å°±ä¸å‘å¸ƒã€‚

Aï¼šæ„Ÿè°¢å»ºè®®ï¼Œæˆ‘ä»¬æ˜¯ä¸ºäº†çœäº‹ï¼ŒæŒ‰éƒ¨ç½²çŽ¯å¢ƒæ‹†åˆ†äº†åˆ†æ”¯ï¼Œpush å¯¹åº”åˆ†æ”¯ç›´æŽ¥å‘å¸ƒï¼Œç”Ÿäº§çŽ¯å¢ƒéœ€æ‰‹åŠ¨è§¦å‘ä¸€ä¸‹ã€‚

> Q11ï¼šç›®å‰é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œmaster å¯¹åº”ç”Ÿäº§çŽ¯å¢ƒï¼Œè™½ç„¶åˆ†æ”¯åšäº†ä¿æŠ¤ï¼Œåœ¨ deploy æ­¥éª¤è®¾ç½®æˆ when munual ï¼Œä½†æ˜¯æ‰€æœ‰ç»„å‘˜éƒ½å¯ä»¥ç‚¹å‡»å‘å¸ƒã€‚é‰´æƒè¿™æ–¹é¢ gitlabci æ¯”è¾ƒå¼±ï¼Œæ˜¯å¦æœ‰è§£å†³ï¼Ÿ

Aï¼šSetting->Repository->Protected Branches ä¸‹å¯ä»¥è®¾ç½®åˆ†æ”¯å¯ç”±é‚£äº›è§’è‰²è¿›è¡Œ merge æˆ–è€… pushï¼Œå¯é€šè¿‡è¿™é‡ŒæŽ§åˆ¶å›¢é˜Ÿæˆå‘˜çš„æƒé™æ˜¯å¦èƒ½åˆå¹¶åˆ° masterã€‚æˆ‘ä»¬åœ¨ master ä¹‹å‰ä¼šæœ‰ä¸ª uat éªŒæ”¶åˆ†æ”¯ï¼ŒçŽ°åœ¨æƒé™å›¢é˜Ÿæˆå‘˜éƒ½æœ‰ï¼ŒåŽè¾¹ä¼šæ‹¿æŽ‰ master çš„ï¼Œäº¤ç»™æµ‹è¯•å›¢é˜Ÿé‚£è¾¹ã€‚æœ‰æ—¶å€™ merge äº†ï¼Œä½†ä¸ç¡®å®šæ˜¯å¦å‘å¸ƒã€‚ æœ‰æ²¡æœ‰æ–¹æ³•è§£å†³ä¸æ˜¯ mainter è§’è‰²ï¼Œæ— æ³•ç‚¹å‡»å‘å¸ƒæŒ‰é’®è¿™ä¸ªåŠŸèƒ½å‘¢æƒé™æŽ§åˆ¶è¿™å—æˆ‘äº†è§£çš„ä¸å¤ªå¤šï¼Œç›®å‰ä¹Ÿæ˜¯é€šè¿‡è§’è‰²æŽ§åˆ¶çš„ã€‚

---

### 2020-04-21ï¼šå“†å•¦ A æ¢¦ï¼šåŸºäºŽ Prometheus çš„ä¼ä¸šç›‘æŽ§æŠ¥è­¦å¹³å°

[çŸ³å¢¨æ–‡æ¡£](https://shimo.im/docs/Gt9pXH93pQRCgDxG)

> Q1ï¼šå‘Šè­¦æ”¯æŒå“ªäº›å¹³å°çš„æŽ¥å£å‘¢ï¼Ÿè‡ªç”±åº¦æ€Žä¹ˆæ ·å‘¢ï¼Ÿå¯ä»¥åœ¨äº§å“ä¸­ï¼Œé…ç½®å®šåˆ¶åŒ–çš„æŽ¥å£çš„ json æ ¼å¼å‘¢ï¼Ÿ

Aï¼šæ”¯æŒ hook å’Œå…¬å¸å†…éƒ¨çš„è“ä¿¡ã€çŸ­ä¿¡ä»¥åŠç”µè¯ï¼Œå¯¹äºŽå…¬å¸å¤–éƒ¨çš„ç”¨æˆ·å¯ä»¥æš‚æ—¶ä½¿ç”¨ hook æ¨¡å¼ï¼ŒåŽç»­ä¼šæ”¯æŒå¾®ä¿¡ã€çŸ­ä¿¡ã€é‚®ä»¶ã€é’‰é’‰

> Q2ï¼šå‘Šè­¦è§¦å‘å™¨æ˜¯å¦‚ä½•ç®¡ç†çš„

Aï¼šprometheus æ ¹æ®æŠ¥è­¦è§„åˆ™çš„é˜ˆå€¼è¿›è¡Œå†…éƒ¨è®¡ç®—å¾—æ¥çš„

> Q3ï¼šprometheus å¦‚ä½•å¯¹æŽ¥å¤šä¸ª k8s é›†ç¾¤å®žçŽ°é›†ç¾¤ pod çš„å¼¹æ€§ä¼¸ç¼©ï¼Ÿ

Aï¼šåˆ©ç”¨ k8s çš„ hpa é€šè¿‡æŠ¥è­¦å¹³å°çš„ hook æœºåˆ¶æ¥åšå¼¹æ€§ä¼¸ç¼©

> Q4ï¼šk8s éƒ½éœ€è¦é…ç½®å“ªäº›æ–¹é¢åŸºç¡€å‘Šè­¦ï¼Ÿkube-prometheus é»˜è®¤çš„å°±å¤Ÿäº†å—ï¼Ÿ

Aï¼šé»˜è®¤å°±æ˜¯èŠ‚ç‚¹ç›‘æŽ§ã€pod ç›‘æŽ§ã€k8s é»˜è®¤ç»„ä»¶çš„ç›‘æŽ§

> Q5ï¼šå®¹å™¨ç›‘æŽ§æŒ‡æ ‡çš„é‡‡é›†æ˜¯è‡ªç ”çš„ï¼Œè¿˜æ˜¯ç”¨çš„ cadvisorï¼Œè¿˜æ˜¯ç”¨çš„å…¶ä»–ä»€ä¹ˆå‘¢

Aï¼šé»˜è®¤çš„

> Q6ï¼šprometheus åŽŸç”Ÿæ˜¯å•ç‚¹ï¼Œåœ¨å‘Šè­¦å’Œå­˜å‚¨æ–¹é¢ï¼Œå“†å•¦ A æ¢¦æ˜¯å¦‚ä½•æ”¯æŒé›†ç¾¤æ¨¡å¼çš„

Aï¼šå‘Šè­¦çš„å­˜å‚¨ä½¿ç”¨ mysqlï¼Œprometheus åªæ˜¯ç”¨äºŽè®¡ç®—è§„åˆ™çš„ã€‚é›†ç¾¤æ¨¡å¼å¯ä»¥ä½¿ç”¨å¤šä¸ª prometheus è¿›è¡Œè®¡ç®—ï¼Œè‡³äºŽ promeheus çš„æž¶æž„ç”±ç”¨æˆ·è‡ªèº«å†³å®š

> Q7ï¼šå¼€æºåœ°å€æ˜¯å“ªé‡Œï¼Ÿå¯ä»¥å‘ä¸‹å—ï¼Ÿ

Aï¼šæ­£åœ¨èµ°å¼€æºæµç¨‹ï¼Œé¢„è®¡ä¸¤å‘¨å†…å¼€æº

> Q8ï¼šalertmanager é’ˆå¯¹çš„æ˜¯ group ç»´åº¦çš„é¢„è­¦ é‚£è‡ªç ”çš„ç‰ˆæœ¬å¦‚ä½•åŽ»å®šä¹‰è¿™ä¸ª groupï¼Œ æ˜¯å¦æœ‰æ–°å¢žé’ˆå¯¹å•ä¸ªå¯¹è±¡åŽ»æŽ¨é€é¢„è­¦åŠé¢„è­¦çš„é¢‘æ¬¡

Aï¼šå“†å•¦ A æ¢¦çš„å‘Šè­¦æ˜¯å“†å•¦ A æ¢¦å†…éƒ¨æœºåˆ¶å®žçŽ°ï¼Œä¸ä¾èµ–äºŽ alertmanager çš„ groupã€‚

> Q9ï¼šprometheus ä½¿ç”¨è¿‡ç¨‹ä¸­å­˜åœ¨å“ªäº›æ€§èƒ½é™·é˜±ï¼Œèƒ½å¦ä¸¾ä¾‹ã€‚å¦‚ä½•è¯„ä¼°é¢„åˆ¤ prometheus æ€§èƒ½å®¹é‡ï¼Ÿ

Aï¼šåœ¨ prometheus çš„æ•°æ®é‡éžå¸¸å¤§çš„æ—¶å€™ä¼šæœ‰æ€§èƒ½ç“¶é¢ˆï¼Œç‰¹åˆ«æ˜¯åœ¨è®¡ç®—ç›´æ–¹å›¾ä»¥åŠé‡‡é›†å¤§é‡èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä½†ä¸€èˆ¬åœºæ™¯ä¸‹ä¸ä¼šæœ‰è¿™æ ·çš„é—®é¢˜

> Q10ï¼šprometheus éƒ¨ç½²åœ¨é›†ç¾¤å†…è¿˜æ˜¯é›†ç¾¤å¤–ï¼Œå¤šä¸ªé›†ç¾¤çš„å®žä¾‹å¦‚ä½•ç»Ÿä¸€ç›‘æŽ§å‘Šè­¦ï¼Ÿæ˜¯å¦æ”¯æŒè·¨é›†ç¾¤åº”ç”¨å®žä¾‹çš„ç›‘æŽ§å‘Šè­¦ï¼Ÿå¦‚ä½•å®žçŽ°ï¼Ÿ

Aï¼šå“†å•¦ A æ¢¦ä¸å…³å¿ƒ prometheus æ˜¯éƒ¨ç½²åœ¨é›†ç¾¤å†…è¿˜æ˜¯é›†ç¾¤å¤–ï¼Œåªè¦èƒ½é€šè¿‡ url è®¿é—®å³å¯ã€‚ç›®å‰ä¸æ”¯æŒåŸºäºŽå¤šä¸ª prometheus çš„å‘Šè­¦èšåˆï¼ŒåŽç»­å¯ä»¥è€ƒè™‘å®žçŽ°

> Q11ï¼šWayne å’Œ Doraemon çš„å…³è”åœ¨å“ªï¼Œæ²¡æœ‰æ‰¾åˆ° Doraemon çš„é“¾æŽ¥

Aï¼šwayne æ˜¯ k8s é›†ç¾¤ç®¡ç†å·¥å…·ï¼Œå“†å•¦ A æ¢¦æ˜¯ wayne å›¢é˜Ÿçš„å¦ä¸€ä¸ªä½œå“ï¼Œæ­£åœ¨èµ°å¼€æºæµç¨‹ï¼Œå¾ˆå¿«ä¼šå¼€æº

> Q12 ä¹‹å‰çœ‹åˆ°ä½ ä»¬åœ¨ç”¨ thanos æ€Žä¹ˆåˆå˜æˆè”é‚¦äº†ï¼Ÿå¯ä»¥å¯¹æ¯”ä¸‹å¸¸è§æ‰©å±•æ–¹æ¡ˆçš„ä¼˜åŠ£å—ï¼Ÿ

Aï¼šå¯èƒ½æ˜¯å…¶ä»–éƒ¨é—¨ä½¿ç”¨ thanosï¼Œæœç´¢éƒ¨é—¨ä½¿ç”¨çš„æ˜¯è”é‚¦ï¼Œå…·ä½“æ¯”è¾ƒå¯ä»¥è§ thanos å®˜æ–¹æ–‡æ¡£

> Q13: æŒ‰åˆšæ‰åˆ†äº«çš„æ¡ˆä¾‹çœ‹, å…¶å®žè¿™ä¸ªç³»ç»Ÿå¯ä»¥ç±»æ¯”ä¸ºåŸºäºŽ alert rule id --> pageduty çš„ä¸€ä¸ªå¤§ç³»ç»Ÿä¹ˆ?

Aï¼šå®žé™…ä¸æ˜¯ï¼Œå› ä¸ºçœŸæ­£çš„ alerts å’Œå‘é€æµç¨‹æ˜¯ç”±å“†å•¦ A æ¢¦æŽ§åˆ¶çš„ï¼Œè€Œä¸æ˜¯ Prometheusï¼Œprometheus åªæ˜¯è´Ÿè´£è®¡ç®—æŠ¥è­¦è§„åˆ™ã€‚

> Q14: å‘Šè­¦è§„åˆ™æ˜¯é€šè¿‡ prometheus çš„æŽ¥å£ä¸‹å‘è‡³èŠ‚ç‚¹åš PROMQL è®¡ç®—çš„ï¼Ÿ

A:æ˜¯çš„

> Q15 è‡ªåŠ¨æ¢å¤è¿™æ–¹é¢æœ‰è€ƒè™‘å—ï¼Ÿæ¯”å¦‚å‘Šè­¦è§¦å‘å¯¹äºŽè„šæœ¬åŽ»è‡ªåŠ¨æ¢å¤ï¼Ÿ

Aï¼šè‡ªåŠ¨æ¢å¤ç›®å‰æ²¡æœ‰åšï¼Œè¿™ä¸ªä¸åŒå…¬å¸ä¸åŒåœºæ™¯å·®å¼‚å¾ˆå¤§ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ® Doraemon å‘å‡ºçš„æŠ¥è­¦ï¼Œè‡ªå®šä¹‰æ¢å¤é€»è¾‘

> Q16 prometheus åœ¨ä½¿ç”¨ promql ä¸­çš„ rate å‡½æ•°ä¼šç»å¸¸é‡åˆ°æ²¡æ•°æ®çš„é—®é¢˜ï¼Œæ•°æ®å›¾è¡¨æ–­æ–­ç»­ç»­ï¼Œè¯·é—®ä½ ä»¬æœ‰é‡åˆ°è¿™ç§é—®é¢˜å—ï¼Œæ€Žä¹ˆè§£å†³ï¼Ÿ

Aï¼šçŒœæµ‹åº”è¯¥æ˜¯ rate è¯­å¥çš„ä½¿ç”¨æ–¹å¼æœ‰é—®é¢˜ï¼Œå…·ä½“å‚è§ prometheus å®˜æ–¹æ–‡æ¡£ rate å‡½æ•°è¯´æ˜Ž

> Q17 æŠ¥è­¦è§„åˆ™ï¼Œä¸‹å‘åˆ°å¤šä¸ª Prometheus Serverï¼Œèƒ½å¦è¯´ä¸‹æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿç›´æŽ¥ä¿®æ”¹ prometheus çš„é…ç½®æ–‡ä»¶ç„¶åŽè°ƒç”¨é‡è½½çš„æŽ¥å£ï¼Ÿ

Aï¼šè¿™æ˜¯åŸºäºŽ prometheus çš„åº“è¿›è¡Œçš„äºŒæ¬¡å°è£…å®žçŽ°çš„

> Q18 è¿™å¥—ç³»ç»ŸèŠ±äº†å¤šå°‘æ—¶é—´å’ŒäººåŠ›å•Šï¼Ÿ

Aï¼šè¿™ä¸ªä¸æ–¹ä¾¿é€éœ²

---

### 2020-04-16ï¼šé˜¿é‡Œäº‘å¦‚ä½•æž„å»ºé«˜æ€§èƒ½äº‘åŽŸç”Ÿå®¹å™¨ç½‘ç»œï¼Ÿ

[çŸ³å¢¨æ–‡æ¡£](https://shimo.im/docs/VpXw3GJWGdtd8Dtt)

> Q1ï¼šæ˜¯å¦æ”¯æŒ IPV6ï¼Œå®žçŽ°ä¸Šé‡åˆ°äº†ä»€ä¹ˆé—®é¢˜å—ï¼Ÿå†…æ ¸æˆ– kube-proxy ä»£ç é—®é¢˜ï¼Ÿ

ç›®å‰æ”¯æŒé€šè¿‡ IPV6 çš„ LoadBalancer æš´éœ²ï¼Œä½†å®žçŽ°è¿˜æ˜¯åœ¨ LoadBalancer ä¸­åš 6to4 è½¬æ¢

ç›®å‰ Pod è¿˜æœªæ”¯æŒ IPV6ï¼Œk8s ä»Ž 1.16 ä¸­ kube-proxy ç­‰å¼€å§‹æ”¯æŒ IPV6ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨ç§¯æžè·Ÿè¿›ï¼Œè®¡åˆ’ä»Šå¹´ä¼šå’Œé˜¿é‡Œäº‘ IAAS ä¸€èµ·å®žçŽ°åŽŸç”Ÿçš„ Pod IPv4/IPv6 åŒæ ˆ

> Q2ï¼šæ¯æ¬¡è¯·æ±‚ coredns è§£æžï¼Œéƒ½åŽ»æ ¹æ®æº ip åŽ»èŽ·å–ç›´æŽ¥è®¿é—®çš„æœåŠ¡ï¼Œæ˜¯è°ƒç”¨ k8s  api èŽ·å–å—ï¼Œä¼šä¸ä¼šå¢žåŠ  api çš„åŽ‹åŠ›?

Aï¼šä¸ä¼šçš„ï¼Œé‚£é‡Œé‚£æ ·ç”»æ˜¯ä¸ºäº†è®©ç»“æž„æ›´æ˜“äºŽç†è§£ï¼Œå®žé™…ä¸Š Coredns çš„ AutoPath ä¼šé€šè¿‡ watch&list çš„æœºåˆ¶åŽ»ä»Ž ApiServer é‚£é‡Œç›‘å¬ Pod å’Œ Svc çš„å˜åŒ–ï¼Œç„¶åŽæ›´æ–°æœ¬åœ°çš„ç¼“å­˜

> Q3ï¼šk8s çš„ service è¯·æ±‚åˆ°ä¸€ç»„ podï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯è½®è¯¢çš„å—ï¼Œè¯·æ±‚åˆ°æ¯ä¸ª pod çš„æ¦‚çŽ‡æ˜¯ä¸€æ ·çš„å—

Aï¼šå¯¹ï¼Œæ¦‚çŽ‡æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥ç†è§£ä¸º LB é¢†åŸŸçš„ roundrobin ç®—æ³•

> Q4ï¼šipvlan å’Œ ebpf å¥½åƒæ˜¯é«˜å†…æ ¸æ‰æ”¯æŒçš„ï¼Œæ˜¯ä¸æ˜¯å¯¹å®¿ä¸»æœºå†…æ ¸æœ‰è¦æ±‚ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œåœ¨é˜¿é‡Œäº‘ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ aliyunlinux2 çš„ 4.19 çš„å†…æ ¸ã€‚å¯¹äºŽä½Žå†…æ ¸ï¼ŒTerway ä¹Ÿæ˜¯æ”¯æŒ veth pair+ ç­–ç•¥è·¯ç”±æ–¹å¼æ¥å…±äº« ENI ä¸Šçš„è¾…åŠ© IPï¼Œåªæ˜¯æ€§èƒ½ä¼šä½Žä¸€äº›

> Q5ï¼šcilium æ˜¯å¦‚ä½•ç®¡ç† ip çš„å‘¢ï¼Œæˆ–è€…è¯´åˆ†é… ipï¼Ÿç±»ä¼¼å…¶ä»–çš„ cni æ’ä»¶ç®¡ç† ip pool å—

Aï¼š1. cilium æœ¬èº«æœ‰ä¸¤ç§åˆ†é… IP çš„åŠžæ³•ï¼Œhost-localï¼šå°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹åˆ†æ®µï¼Œç„¶åŽé¡ºåºåˆ†é…ï¼Œ å¦å¤–ä¸€ç§æ˜¯ CRD-backendï¼Œå¯ä»¥è®© IPAM æ’ä»¶è‡ªå·±å®žçŽ°åˆ†é…

2. Terway ä¸­çš„ cilium åªä¼šåšç½‘ç»œç­–ç•¥å’Œ Service çš„åŠ«æŒå’Œè´Ÿè½½ï¼Œä¸ä¼šåš IP åˆ†é…å’Œé…ç½®

> Q6ï¼šå¦‚æžœæ²¡æœ‰ç”¨è¿™å¥—ç½‘ç»œæ–¹æ¡ˆï¼Œåˆè§‰å¾— service å¤§è§„æ¨¡ä½¿ç”¨å½±å“æ€§èƒ½ï¼Œæœ‰ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆå—

Aï¼škube-proxy ipvs æ¨¡å¼çš„æ€§èƒ½åœ¨å¤§è§„æ¨¡ä¸­æŸå¤±è¿˜å¥½ï¼Œä½†å…¶å®žæ•´ä½“å¼•å…¥äº†è¿‡é•¿çš„é“¾è·¯ï¼Œæ‰€ä»¥å»¶æ—¶ä¼šå¢žåŠ ä¸€äº›

![](https://uploader.shimo.im/f/HpLAgcOAcKXrdaiK.png)

> Q7ï¼šcilium åº”è¯¥ä¸æ˜¯æ³¨å…¥ bpf åˆ°å®¹å™¨çš„ vethï¼Œè€Œæ˜¯æ³¨å…¥åˆ° host ç«¯çš„ vethï¼Ÿä½ ä»¬åšäº†ä»€ä¹ˆä¿®æ”¹å—ï¼Ÿ

Aï¼šcilium åº”è¯¥ä¸æ˜¯æ³¨å…¥ bpf åˆ°å®¹å™¨çš„ vethï¼Œè€Œæ˜¯æ³¨å…¥åˆ° host ç«¯çš„ vethï¼Ÿä½ ä»¬åšäº†ä»€ä¹ˆä¿®æ”¹å—ï¼Ÿ

æ˜¯çš„ï¼Œcilium æ˜¯ä¿®æ”¹çš„å®¹å™¨å¯¹ä¾§çš„ vethï¼Œæˆ‘ä»¬ç»è¿‡æµ‹è¯•å‘çŽ° IPvlan çš„æ€§èƒ½ä¼˜äºŽ vethï¼ŒTerway ä¸­æ˜¯ä½¿ç”¨ IPvlan åšçš„é«˜æ€§èƒ½ç½‘ç»œï¼Œæ˜¯ä¸å­˜åœ¨å¯¹ä¾§ veth çš„

æˆ‘ä»¬é€‚é…çš„ä¿®æ”¹è¯·å‚è€ƒï¼š [https://github.com/cilium/cilium/pull/10251](https://github.com/cilium/cilium/pull/10251)  å¦å¤– Terway ä½¿ç”¨ Cilium åªä¼šåš NetworkPolicy å’Œ Service çš„åŠ«æŒå’Œè´Ÿè½½

> Q8ï¼šä½¿ç”¨ terway æ’ä»¶åŽï¼Œ pod æ˜¯å¦‚ä½•è®¿é—® service çš„ clusterip çš„ï¼Ÿ

Aï¼šä½¿ç”¨å†…ç½®åœ¨ Pod ç½‘å¡ä¸Šçš„ ebpf ç¨‹åºç›´æŽ¥å°† serviceIP è´Ÿè½½åˆ°åŽç«¯çš„ pod

> Q9ï¼šèƒ½èŠä¸‹é˜¿é‡Œäº‘å¯¹ service mesh è¿™å—æœ‰ä»€ä¹ˆè§„åˆ’å—

Aï¼šé˜¿é‡Œäº‘ç›®å‰å·²ç»äº§å“åŒ–äº† ASM çš„ Service Mesh äº§å“ï¼ŒåŽé¢çš„å‘å±•ä¼šåœ¨æ˜“ç”¨æ€§ï¼Œæ€§èƒ½ï¼Œä»¥åŠå…¨çƒè·¨åœ°åŸŸäº‘è¾¹ç«¯ä¸€ä½“åŒ–è¿žæŽ¥ç­‰æ–¹å‘ã€‚

> Q10ï¼šå’Œ node çš„ç½‘ç»œæ‰“é€šåŽï¼Œå¦‚æžœä¸€ä¸ª pod çš„ ip è¢«å¤ç”¨ï¼Œä¹‹å‰çš„ arp ç¼“å­˜åº”è¯¥ä¼šæœ‰å½±å“å§ï¼ŸåŒæ—¶å‡ºçŽ°èŠ‚ç‚¹çº§åˆ«çš„æ•…éšœï¼Œæ˜¯å¦ä¼šæœ‰ IP å†²çªï¼Ÿ

Aï¼šé¦–å…ˆäº‘ä¸Šçš„ç½‘ç»œä¸ä¼šå­˜åœ¨ arp çš„é—®é¢˜ï¼Œä¸€èˆ¬ IAAS å±‚çš„è½¬å‘é‡‡ç”¨ 3 å±‚çš„è½¬å‘ã€‚å¦‚æžœäº‘ä¸‹è‡ªå·±ä½¿ç”¨ IPvlan ä¹Ÿä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨ Macvlan çš„è¯ä¼šæœ‰ arp ç¼“å­˜çš„å½±å“ï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥é‡‡ç”¨ macnat çš„æ–¹å¼ï¼ˆebtables,ebpf éƒ½å¯ä»¥å®žçŽ°å“ˆï¼‰

æ˜¯å¦å­˜åœ¨ IP å†²çªæ˜¯è¦çœ‹ IP ç®¡ç†ç­–ç•¥ï¼Œåœ¨ç›®å‰çš„ Terway æ–¹æ¡ˆä¸­ IPAM ç›´æŽ¥è°ƒç”¨ IAAS çš„ IPAMï¼Œæ˜¯ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜çš„ï¼Œè‡ªå·±çº¿ä¸‹æ­å»ºå¾—è€ƒè™‘ DHCP ç­–ç•¥æˆ–é™æ€åˆ†é… IP åœ°å€åŽ»è§„é¿ã€‚

> Q11ï¼šâ€œé€šè¿‡ eBPF å¯¹é“¾è·¯çš„ç®€åŒ–ï¼Œæ€§èƒ½æœ‰æ˜Žæ˜¾æå‡ï¼Œç›¸å¯¹ iptables æå‡ 32%, ç›¸å¯¹ ipvs æå‡ 62%ï¼›â€ä¸ºä»€ä¹ˆå¯¹ ipvs æ€§èƒ½çš„æå‡æ›´æ˜Žæ˜¾ï¼Ÿå¦‚æžœä¸»è¦æ˜¯å¯¹ iptables çš„çº¿æ€§åŒ¹é…å’Œæ›´æ–°ä¼˜åŒ–çš„è¯ï¼Ÿ

A: è¿™é‡Œçš„è¿™ä¸ªå¯¹æ¯”æ˜¯é’ˆå¯¹åªæœ‰ä¸€ä¸ª Service çš„å¯¹æ¯”ï¼Œæ˜¯ä¸»è¦çœ‹é“¾è·¯ç®€åŒ–çš„å½±å“ã€‚iptables æ¨¡å¼æ˜¯ nat è¡¨è¿›è¡Œçš„ DNATï¼Œæ˜¯åªæœ‰ forward æµç¨‹ï¼Œè€Œ ipvs æ˜¯ä¼šç»è¿‡ INPUT å’Œ OUTPUT çš„ï¼Œæ‰€ä»¥åœ¨å•ä¸ªæœåŠ¡çš„æƒ…å†µä¸‹ iptables å¯èƒ½è¿˜ä¼šæ›´å¥½ä¸€äº›ï¼Œä½†æ˜¯ iptables çš„çº¿æ€§åŒ¹é…ä¼šè®©æœåŠ¡æ•°é‡å¾ˆå¤šæ—¶æ€§èƒ½ä¸‹é™æ˜Žæ˜¾ã€‚

![](https://uploader.shimo.im/f/IlSeFxtvE7di2KuO.png) æ¯”å¦‚ 5000 service æ—¶å°± ipvs æ›´å¥½å•¦ XDï¼›

---

### 2020-04-14ï¼šSpring Cloud Gateway å…¨é“¾è·¯å®žçŽ°

[çŸ³å¢¨æ–‡æ¡£](https://shimo.im/docs/YkCPTVXd96QWQg9T)

> Q1ï¼šæœ‰æ²¡æœ‰ SpringCloud é«˜å¯ç”¨ demo å¯ä¾›å­¦ä¹ ï¼Œæˆ–è€…æœ‰æ²¡æœ‰æŽ¨ä»‹çš„èµ„æ–™

Aï¼šdemo å¯ä»¥åŽ» github æˆ– gitee ä¸Šæœç´¢ï¼Œä¹¦ç±æŽ¨èã€ŠSpring Cloud å¾®æœåŠ¡å®žæˆ˜ã€‹å’Œã€ŠSpring Cloud ä¸Ž Dockerã€‹ã€‚

> Q2ï¼šå¦‚ä½•ä»£ç†çš„ Socket

Aï¼šå…¨é“¾è·¯æ²¡æœ‰æ”¯æŒ socket

> Q3ï¼šGateway æœåŠ¡è¿™å—å¦‚æžœè¦åšé˜²è·¨ç«™æ”»å‡»ï¼Œæœ‰ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆï¼Ÿ

Aï¼šä½¿ç”¨å‰ç½®çš„ Filter è¿‡æ»¤ï¼ŒJsoup çš„æ ‡ç­¾ç™½åå•æœºåˆ¶å¯ä»¥ç”¨æ¥è¿›è¡Œé˜²æ­¢ XSS æ”»å‡»

> Q1ï¼šç°åº¦æ–¹æ¡ˆå®žçŽ°ï¼Ÿ

Aï¼šç½‘å…³ä»Žé…ç½®ä¸­å¿ƒèŽ·å–å®žæ—¶çš„é…ç½®ï¼ŒåŠ¨æ€å˜æ›´è·¯ç”±æƒé‡ä¿¡æ¯

> Q4ï¼šå¦‚ä½•åœ¨ gateway åšæƒé™è®¤è¯ã€‚ä½ ä»¬æ˜¯å¦‚æžœåšçš„

Aï¼šé€šè¿‡ jwt å®žçŽ°ï¼Œæ¯ä¸ªè¯·æ±‚ä¼ é€’ token è¿›è¡Œæƒé™è®¤è¯

> Q5ï¼šæ˜¯åœ¨ç½‘å…³ç»Ÿä¸€è®¤è¯å¥½ï¼Œè¿˜æ˜¯æ¯ä¸ªæœåŠ¡éƒ½åŽ»åšè®¤è¯ã€‚è¯´è¯´ä½ ä»¬çš„å»ºè®®å—ï¼Ÿæœ‰ demo ä¾‹å­å—

Aï¼šç½‘å…³å±‚åšè®¤è¯ï¼Œé€šè¿‡è®¤è¯åŽå°†ç”¨æˆ·ä¿¡æ¯ä¼ é€’ç»™åŽç»­æœåŠ¡ï¼ŒåŽç»­æœåŠ¡æŸ¥çœ‹æ˜¯å¦æœ‰è°ƒç”¨è¯¥ url çš„æƒé™

> Q6ï¼šå¦‚ä½•è·Ÿè¸ªåˆ†æž gateway è°ƒç”¨è€—æ—¶çš„é—®é¢˜

Aï¼šç›®å‰ä¸»æµçš„æ–¹æ¡ˆæ˜¯å¯¹å„ç»„ä»¶è¿›è¡ŒåŸ‹ç‚¹ï¼Œä½†ä¸ä¸€å®šèƒ½å®šä½åˆ°çœŸæ­£è€—æ—¶çš„æƒ…å†µï¼Œæ­¤æ—¶è¦è¿›è¡Œ Sampler çš„æ–¹å¼èŽ·å–æ…¢æ–¹æ³•

> Q7ï¼šç›®å‰ gateway å…¨é“¾è·¯å®žçŽ°ï¼Œæ¯”å¦‚ skywalking æŽ¢é’ˆèƒ½åšåˆ°ä¹ˆï¼Ÿè¿˜æ˜¯å¾—è‡ªå·±åŽ»åŸ‹ç‚¹ï¼Ÿ

Aï¼šskywalking æš‚æ—¶æ²¡æ”¯æŒï¼Œå¯ä»¥æ ¹æ®æä¾›çš„æ€è·¯ä¿®æ”¹å®žçŽ°

> Q8ï¼šJWT ä¸€èˆ¬æ€Žä¹ˆåšåŠé”€æˆ–è€…è¶…æ—¶æ ¡éªŒï¼Ÿæ¯æ¬¡éƒ½ä»Ž redis è¯»ä¼šä¸ä¼šåŽ‹åŠ›æ¯”è¾ƒå¤§ï¼Ÿ

Aï¼šå°† jwt å­˜å‚¨åˆ°ä¸­é—´ä»¶ redis ä¸­ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ã€‚åŠé”€é—®é¢˜æ¯”è¾ƒå¥½è§£å†³ï¼Œå®¢æˆ·ç«¯é€€å‡ºæˆ–ä¿®æ”¹å¯†ç åŽè°ƒç”¨ä¸­é—´ä»¶æ¸…é™¤ã€‚æœ¬æ¥ jwt è¿™ç§æ–¹å¼å°±å±žäºŽæ¯”è¾ƒå¼±å®‰å…¨çš„æ–¹å¼ï¼Œjwt æœ¬èº«å¯ä»¥æ”¾æ—¶é—´å±žæ€§ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ã€‚è¿™ç§æ–¹å¼å‘¢å¸¦æ¥çš„é—®é¢˜å°±ä¼šæ˜¯éœ€è¦ç»­ç­¾ï¼Œå®šæ—¶ç»­ç­¾ã€‚å¦å¤–ä¸€ç§æ–¹å¼å°±æ˜¯ redis,ä¸ä¼šè®¾ç½®è¿‡æœŸæ—¶é—´æˆ–è€…è¯´æ—¶é—´æ¯”è¾ƒé•¿ï¼Œä¾èµ– logout æ¥æ³¨é”€ã€‚è¿™ä¸¤ç§æ–¹å¼å¹¶ä¸æ˜¯ä¸€ç›´éƒ½æ˜¯è®¿é—® redisï¼Œå¯¹ redis åŽ‹åŠ›ä¸ä¼šå¾ˆå¤§ï¼Œç»­ç­¾å¯ä»¥è®¾ç½®æ—¶é—´ç¨å¾®é•¿ä¸€ç‚¹ã€‚

> Q9ï¼šå¯ä»¥å±•ç¤ºä¸‹ä½ ä»¬çš„å…¨é“¾è·¯ç›‘æŽ§äº§å“å—ï¼Ÿä½ ä»¬æ€Žä¹ˆæ€Žä¹ˆåšåˆ°ç›‘æŽ§ä¿¡æ¯çš„æ”¶é›†ï¼Œå­˜å‚¨å’Œè½¬å‘ï¼Œå±•ç¤ºä»¥åŠå‘Šè­¦ç­–ç•¥çš„åˆ¶å®šã€‚ä½ ä»Žå¤´åˆ°å°¾è®²è§£ APM ç›‘æŽ§åŽŸç†è®²çš„å¾ˆä¸é”™ï¼Œå¯ä»¥ä»‹ç»ä¸‹ä½ ä»¬çš„äº§å“å—ï¼Ÿä¸Žå¼€æºçš„ pinpoint å’Œ skywalking çš„åŒºåˆ«

Aï¼šæš‚æ—¶æ²¡æœ‰æä¾›å…¬ç½‘è®¿é—®,è¿™æ˜¯æˆ‘å¾®ä¿¡ï¼šjiang1990ingï¼Œæœ‰å…´è¶£åŠ æˆ‘å¾®ä¿¡ï¼Œæˆ‘å¯ä»¥æŠŠå†…ç½‘å¼€æ”¾è®¿é—®ä¸‹ã€‚å¼€æº pinpoint å’Œ skywalking æ˜¯ä¸“ä¸šçš„ apm å¼€æºäº§å“ï¼Œä»Žäº§å“å®šä½ä¸Šè¯´å°±æœ‰åŒºåˆ«ï¼Œæˆ‘ä»¬ç›‘æŽ§äº§å“æ˜¯çŸ©é˜µå¼ç›‘æŽ§ï¼Œapm åªæ˜¯æˆ‘ä»¬å…¶ä¸­ä¸€ä¸ªæŠ€æœ¯ã€‚æˆ‘ä»¬ç›‘æŽ§çš„å®šä½ä¸»è¦ä»Žå®¢æˆ·åœ¨è¿ç»´è¿‡ç¨‹ä¸­å¤„ç†æ•…éšœçš„å®žé™…éœ€æ±‚ï¼Œæ ¹æ®æŠ¥å‘Šæ•…éšœåªæœ‰ 24% æ˜¯çº¯åº”ç”¨é—®é¢˜ï¼Œè¿˜æœ‰å¾ˆå¤§éƒ¨åˆ†æ˜¯ç½‘ç»œçš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ©é˜µä»Žçºµå‘æ¥è¯´åŒ…å«äº†ç½‘ç»œè´¨é‡çš„ç›‘æŽ§å’Œåº”ç”¨ä¾èµ–çš„åŸºç¡€è®¾æ–½çš„èµ„æºç›‘æŽ§ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿ç»´è¿‡ç¨‹ä¸­çš„ç»¼åˆæ€§é—®é¢˜ã€‚æ¨ªå‘æ‰æ˜¯å…¨é“¾è·¯è¿½è¸ªçš„å±‚é¢ã€‚å½“ç„¶åœ¨ apm æœ¬èº«å±‚é¢æˆ‘ä»¬ä¹Ÿåšäº†ä¸€äº›ç»†èŠ‚çš„ä¼˜åŒ–ã€‚

> Q10 ç›®å‰ç”¨ skywalking å®šä½åˆ°è€—æ—¶å‘ç”Ÿåœ¨ Gateway çš„ webflux çš„ handle ä¸Šé¢ ä½†æ˜¯ä¸çŸ¥é“æ€Žä¹ˆåˆ†æžå¦‚ä½•äº§ç”Ÿçš„è€—æ—¶

Aï¼šç¬¬ 9 é¢˜æˆ‘æåˆ°æˆ‘ä»¬å¯¹æ…¢æ–¹æ³•çš„æ•èŽ·åšäº†ä¼˜åŒ–ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹å¼€å‘å†™çš„ä»£ç å‡ºçŽ°æ…¢çš„åœºæ™¯ï¼Œæœ‰æ—¶å€™å¼€æºæ ¹æ®å®žçŽ°åŽŸç†çš„ç»†å¾®å·®åˆ«ä¼šæ•èŽ·ä¸åˆ°ã€‚çŽ°åœ¨æˆ‘è§‰å¾—æ˜¯ skywalking ç›‘æŽ§ç²’åº¦ä¸å¤Ÿï¼Œå¯¼è‡´æ²¡æœ‰èŽ·å–åˆ°æ…¢çš„è°ƒç”¨ï¼Œé€šè¿‡æˆ‘ä»¬è¿™ç§æ–¹å¼åº”ç”¨æ˜¯å¯ä»¥è§£å†³çš„ï¼Œå…·ä½“é—®é¢˜è¿˜æ˜¯éœ€è¦æˆ‘ä»¬æ¥å…·ä½“åˆ†æžã€‚æœ‰éœ€è¦çš„è¯ï¼ŒåŠ ä¸Šé¢çš„å¾®ä¿¡ï¼Œæˆ‘ä»¬å¯ä»¥æä¾› saas æœåŠ¡ï¼Œå¸®åŠ©ä½ ä»¬å®šä½ä¸‹ã€‚å…±åŒè¿›æ­¥ã€‚

> Q11ï¼šæˆ‘ä¸å¤ªç†è§£â€œåŽç»­æœåŠ¡æŸ¥çœ‹æ˜¯å¦æœ‰è°ƒç”¨è¯¥ url çš„æƒé™â€ï¼Œåˆ°äº†åº”ç”¨æœåŠ¡åŽï¼Œè¿˜æ˜¯è¦åŽ»è®¤è¯æœåŠ¡å—ï¼Ÿ

A: ç½‘å…³è·Ÿè®¤è¯æœåŠ¡çš„ç½‘ç»œéš”ç¦»ï¼Œè®¤è¯æœåŠ¡åªå¯¹å†…å¯è§çš„æƒ…å†µä¸‹è¦æ±‚åº”ç”¨æœåŠ¡åŽ»è®¤è¯æœåŠ¡é‰´æƒ

---

### 2020-04-07ï¼šæ»´æ»´å¼€æºç›‘æŽ§å¤œèŽºçš„æž¶æž„è®¾è®¡æ€è€ƒ

[çŸ³å¢¨æ–‡æ¡£](https://shimo.im/docs/rj8H9y3w3PDr9Vxv)

> Q1ï¼šOpen-Falcon åˆ° Nightingale çš„æ”¹é€ è¿‡ç¨‹ä¸­ç»åŽ†äº†å“ªäº›è¿‡ç¨‹å’Œé˜¶æ®µï¼Œè¸©è¿‡å“ªäº›å‘ï¼Œå¯å¦åˆ†äº«ä¸‹ï¼Ÿè°¢è°¢

Aï¼šè¿™ä¸ªè¯é¢˜æœ‰ç‚¹å¤§ï¼Œå±•å¼€å¯ä»¥è¯´å¾ˆå¤šï¼Œå°±è¯´ä¸€ä¸ªå§ï¼Œåœ¨å‘Šè­¦æ–¹é¢çš„æ¼”è¿›ï¼Œæ»´æ»´åœ¨å¼•è¿› falcon ä¹‹åˆï¼Œå°†åŽŸæ¥çš„ judge å¤„ç†æ•°æ®çš„æ–¹å¼æœ‰ push æ”¹ä¸ºäº† pullï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„æ”¯æŒä¸Žæ¡ä»¶ï¼Œnodata ç­‰å‘Šè­¦ï¼ŒåŽé¢ä¸ºäº†æé«˜å‘Šè­¦çš„æ—¶æ•ˆæ€§ï¼Œæˆ‘ä»¬åˆå°† pull æ¨¡å¼æ”¹ä¸ºäº† push æ¨¡å¼ï¼Œå¹¶ä¸”ä¿ç•™äº†ä¸Žæ¡ä»¶ï¼ŒåŒçŽ¯æ¯”ï¼Œnodata å‘Šè­¦çš„èƒ½åŠ›ï¼Œå¼€æºçš„å¤œèŽºå°±æ˜¯æ¼”è¿›åˆ°æœ€åŽçš„çŠ¶æ€

> Q2 èƒ½å¦ç¨å¾®è§£è¯»ä¸‹ä¸ªæ¨¡å—ä½œç”¨ä»¥åŠå¦‚ä½•æ–¹ä¾¿äºŒå¼€

Aï¼šæˆ‘ä»¬æŠŠæ¯ä¸ªæ¨¡å—çš„åŠŸèƒ½éƒ½å°è£…æˆäº† pkgï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼ŒçŽ°åœ¨å¯ä»¥ç›´æŽ¥çœ‹ä»£ç ï¼ŒåŽç»­æˆ‘ä»¬ä¼šå‘å¸ƒæ¯ä¸ªæ¨¡å—çš„æºç è§£è¯»æ–‡ç« ï¼Œå¯ä»¥å…³æ³¨æˆ‘ä»¬çš„å®˜æ–¹åŠ¨æ€ï¼šï¼‰

> Q3ï¼šroadmap å’Œç¤¾åŒºå»ºè®¾èƒ½å¦åˆ†äº«ä¸€ä¸‹

Aï¼šå¯ä»¥å‚è€ƒè¿™ä¸ª [https://n9e.didiyun.com/docs/intro/#nightingale%E5%90%8E%E7%BB%AD%E5%8F%91%E5%B1%95](https://n9e.didiyun.com/docs/intro/#nightingale%E5%90%8E%E7%BB%AD%E5%8F%91%E5%B1%95)

> Q4ï¼šfalcon é‡Œå­˜åœ¨å¤§é‡å¾ªçŽ¯ sleep æ£€æŸ¥çš„é€»è¾‘ å‡ºäºŽä»€ä¹ˆç›®çš„è¿™æ ·è®¾è®¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ channel

Aï¼šæ²¡æœ‰ç‰¹åˆ«çš„ç›®çš„ :)

> Q5ï¼šç›¸æ¯” CNCF ä¸‹æŽ¨å‡º prometheusï¼Œå¤œèŽºæœ‰å“ªäº›èƒœå‡ºçš„åœ°æ–¹ï¼Ÿå¯¹äºŽå·²ç»ä½¿ç”¨ Prometheus çš„ï¼Œå¦‚ä½•å‘å¤œèŽºå¹³æ»‘çš„åˆ‡æ¢å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬åœ¨äº§å“çš„æ˜“ç”¨æ€§ä¸Šåšçš„æ›´å¥½:) åŽç»­æˆ‘ä»¬ä¹Ÿæœ‰å…¼å®¹é€‚é… Prometheus çš„è®¡åˆ’

> Q6ï¼šå…¼å®¹é€‚é… Prometheus å¤§æ¦‚ä»€ä¹ˆæ—¶å€™å‘¢ï¼Ÿã€‚

Aï¼šè¿™ä¸ªä»Šå¹´ä¼šåšï¼Œå…·ä½“æ—¶é—´è¿˜æ²¡å®š

> Q7ï¼šçŽ°åœ¨å¤œèŽºåœ¨æ»´æ»´é‡Œé¢çš„æœºå™¨æ•°é‡è§„æ¨¡å¯ä»¥é€éœ²ä¸‹å—

Aï¼šè¿™ä¸ªä¸æ–¹ä¾¿é€éœ²ï¼šï¼‰

> Q8ï¼šè¯·é—®ä½ ä»¬é‡‡é›†çš„æ•°æ®ä¸€èˆ¬æœ€ç»ˆä¼šæŒä¹…å­˜å‚¨åˆ°å“ªé‡Œï¼Ÿ

Aï¼šå¤œèŽºçš„ tsdb æœ‰æ•°æ®å½’æ¡£çš„æœºåˆ¶ï¼Œé»˜è®¤ä¼šä¿å­˜ä¸€å¹´çš„æ•°æ®ï¼Œæˆ‘ä»¬å†…éƒ¨çš„æ ¸å¿ƒæ•°æ®ä¼šä¿å­˜æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼ŒæŒä¹…åŒ–ä¹Ÿæ˜¯ç”¨çš„ rrdtool

> Q10ï¼šæ—¥å¿—æ•°æ®æ˜¯æ€Žä¹ˆé™æµçš„ï¼Ÿæ•´ä¸ªä½“ç³»é™æµæ€Žä¹ˆåšçš„

Aï¼šcollector çš„æ—¥å¿—é‡‡é›†æ˜¯æµå¼å¤„ç†çš„ï¼Œæ²¡æœ‰åšé™æµï¼Œå¦‚æžœæ—¥å¿—äº§ç”Ÿé‡å¤ªå¤§ï¼Œå¯ä»¥å°†æƒ³è¦ç›‘æŽ§ç»Ÿè®¡çš„æ—¥å¿—å•ç‹¬è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­

> Q11: æƒ³é—®ä¸‹ï¼Œæœ‰ä»€ä¹ˆé«˜å¯ç”¨çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ

A:æŒ‡çš„æ˜¯å¤œèŽºä¹ˆï¼Œå¤œèŽºçš„æž¶æž„æœ¬èº«å°±æ˜¯é«˜å¯ç”¨çš„

> Q12 å®¹é‡è¯„ä¼°æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ

A:å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ [https://n9e.didiyun.com/docs/install/product/](https://n9e.didiyun.com/docs/install/product/)

> Q13 è¯·é—®ä½ ä»¬ä¸€èˆ¬ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šæœ‰æ‰©å®¹éœ€æ±‚ï¼Ÿ

A:ä¸»è¦è¿˜æ˜¯çœ‹ç³»ç»Ÿçš„èµ„æºä½¿ç”¨çŽ‡ï¼Œå†…å­˜ã€cpu å’Œç£ç›˜è¿™ä¸‰ä¸ªæŒ‡æ ‡

---

### 2020-03-24ï¼šKubernetes åœ¨è¾¹ç¼˜è®¡ç®—é¢†åŸŸçš„å‘å±•

[çŸ³å¢¨æ–‡æ¡£](https://shimo.im/docs/wWPHkj8xvrtjTdcx)

> Q1ï¼šé€‚ä¸é€‚åˆç”¨æ¥éƒ¨ç½²ç®¡ç† CDN èŠ‚ç‚¹ï¼ŸåŒæ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ

Aï¼šæ˜¯è¯´çš„è¾¹ç¼˜è®¡ç®—è¿˜æ˜¯ KubeEdgeï¼Ÿ æè¿°ä¸æ¸…æ¥šã€‚

> Q2ï¼šè¾¹ç¼˜è®¡ç®—çš„è¾¹åœ¨å“ªé‡Œï¼Ÿç½‘ç»œçš„è¾¹ç¼˜åˆ°åº•æ˜¯æŒ‡ä»€ä¹ˆï¼Œå¦‚ä½•å…·è±¡åŒ–ï¼Ÿå¦‚ä½•ç¡®å®šè¾¹çš„ä½ç½®ï¼Ÿè¾¹çš„ä½ç½®å’Œåº”ç”¨çš„å…³ç³»ï¼Ÿæ‰€è°“çš„è¾¹ä¸Žç«¯çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿæ¯”å¦‚è¯´æ‘„åƒå¤´ç®—æ˜¯è¾¹è¿˜æ˜¯ç«¯ï¼Ÿè¾¹ç¼˜ç½‘å…³ç®—æ˜¯è¾¹è¿˜æ˜¯ç«¯ï¼Ÿè¿™ä¸ªæ¦‚å¿µå¦‚ä½•åˆ¤æ–­

Aï¼šè¾¹ç¼˜è®¡ç®—çš„è¾¹å…·ä½“åœ¨å“ªé‡Œ å…¶å®žæ²¡æœ‰å¾ˆæ˜Žç¡®çš„æ¦‚å¿µï¼Œ ä¸€èˆ¬ä¸»è¦çœ‹ä½ çš„ä¸šåŠ¡åœºæ™¯ã€‚ç½‘ç»œè¾¹ç¼˜ä¸€èˆ¬æ˜¯æŒ‡é è¿‘å®¢æˆ·çŽ°åœºä¸€ä¾§çš„ç½‘ç»œè¾¹ç¼˜ï¼Œåœ¨è¾¹ç¼˜è®¡ç®—åœºæ™¯ä¸‹ï¼Œåº”ç”¨æ˜¯éƒ¨ç½²åœ¨è¾¹ä¾§ï¼Œå°±è¿‘è®¡ç®—ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ‘„åƒå¤´æˆ‘ä»¬å¯ä»¥æ˜¯è®¤ä¸ºæ˜¯ç«¯ï¼Œä½†æ˜¯å¦‚æžœæ‘„åƒå¤´è‡ªå·±æœ‰è®¡ç®—èƒ½åŠ›ï¼Œæœ‰ç½‘ç»œæŽ¥å…¥ï¼Œèƒ½å¤Ÿéƒ¨ç½²åº”ç”¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç†è§£æ˜¯æ˜¯è¾¹ä¾§çš„è®¡ç®—èŠ‚ç‚¹ã€‚
s

> Q3ï¼šè¾¹ç¼˜ cloud èŠ‚ç‚¹é«˜å¯ç”¨æ–¹å¼æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šæ˜¯è¯´çš„ k3s è¿˜æ˜¯ KubeEdgeï¼Ÿ æè¿°ä¸æ¸…æ¥šã€‚

> Q4ï¼šä¸ºä»€ä¹ˆéœ€è¦è¾¹ç¼˜è®¡ç®—ï¼Ÿè¾¹ç¼˜è®¡ç®—è§£å†³ä»€ä¹ˆ hï¼Ÿå‘å±•è¾¹ç¼˜è®¡ç®—éœ€è¦å…·å¤‡ä»€ä¹ˆæ¡ä»¶ï¼Ÿ

Aï¼šåˆ†äº«é‡Œå·²ç»è¯´æ˜Žäº†ã€‚

> Q5ï¼šäº‘è¾¹åŒæ­¥æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šKubeEdge äº‘è¾¹åŒæ­¥ä¸»è¦é€šè¿‡ edgehub å’Œ cloudhub è¿™ä¸¤ä¸ªæ¨¡å—æž„å»ºçš„ websocket è¿žæŽ¥è¿›è¡Œ Kubernetes èµ„æºçš„åŒæ­¥çš„ï¼Œè¿žæŽ¥è¯·æ±‚é¦–å…ˆç”± edge ç«¯å‘èµ·ï¼Œä¸€æ—¦ websocket å»ºç«‹åŽï¼Œäº‘ç«¯å°±å¯ä»¥å‘è¾¹ç¼˜ä¾§ä¼ é€’æ•°æ®ã€‚

> Q6ï¼šå¦‚ä½•ä¿è¯äº‘è¾¹çŠ¶æ€çš„ç»Ÿä¸€ï¼ŸDocker å½¢å¼çš„è¾¹ç¼˜åº”ç”¨çš„ä¼˜ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿ

Aï¼šKubeEdge æœ€æ–°ç‰ˆæ”¯æŒå¯é æ€§æ¶ˆæ¯ä¼ è¾“ã€‚äº‘ç«¯çš„ Kubernetes èµ„æºçŠ¶æ€å‘ç”Ÿå˜åŒ–åŽï¼Œä¼šé»˜è®¤é€šè¿‡ websocket é€šé“è¿›è¡Œä¸‹å‘ï¼Œå¦‚æžœè¿™æ—¶å€™ç½‘ç»œæ–­å¼€æˆ–è€…ç½‘ç»œè´¨é‡ä¸é«˜ï¼Œä¼šè¿›è¡Œé‡ä¼ ã€‚ä½†æ˜¯è¿™é‡Œä¸ºäº†é˜²æ­¢èµ„æºçŠ¶æ€æ•°æ®çš„ç§¯åŽ‹å¯¼è‡´å†…å­˜å ç”¨çŽ‡è¿‡é«˜ï¼ŒKubeedge å……åˆ†åˆ©ç”¨äº† Kubernetes çš„åŽ»é‡é˜Ÿåˆ—ï¼Œå¯¹èµ„æºæ•°æ®è¿›è¡ŒåŽ»é‡å¤„ç†ã€‚

> Q7ï¼šk8s masterï¼Œk8s nodeï¼Œkubeedge edge èŠ‚ç‚¹ä¸‰è€…æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿåœ¨ master ä¸Šéƒ¨ç½² cloudcore åŽ»ç®¡ç† edge èŠ‚ç‚¹ï¼Œé‚£ k8s node æ˜¯å¦å‚ä¸Žå…¶ä¸­ï¼Ÿæ˜¯ä¸æ˜¯è¯´ edge èŠ‚ç‚¹åªéœ€è¦è·Ÿ master èŠ‚ç‚¹ä¸Šçš„ cloudcore è¿›è¡Œé€šä¿¡ï¼Œä¸å…³å¿ƒ nodeï¼›node ä¹Ÿåªåœ¨ k8s é›†ç¾¤å†…é€šä¿¡ï¼Œä¸å…³å¿ƒ edgeï¼Ÿ

Aï¼šK8s node å’Œ KubeEdge edge èŠ‚ç‚¹ æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œk8s çš„ node æ˜¯ç”± kubelet åƒ apiserver è¿›è¡Œæ³¨å†Œçš„ï¼Œè€Œ KubeEdge edge èŠ‚ç‚¹æ˜¯ KubeEdge é€šè¿‡äº‘è¾¹ååŒæœºåˆ¶é€šè¿‡ cloudcore è¿›è¡Œæ³¨å†Œçš„ã€‚é€šè¿‡ kubectl get node çœ‹åˆ°éƒ½æ˜¯ nodeï¼ŒåŒºåˆ«åœ¨äºŽ edge node ä¼šæœ‰ä¸“é—¨çš„æ ‡ç­¾ã€‚

> Q8ï¼šåœ¨ k8s ä¸­ï¼Œäº‘å’Œç»ˆç«¯èŠ‚ç‚¹å¦‚ä½•é€šè®¯çš„ï¼Œå…¨åŒå·¥è¿˜æ˜¯åŠåŒå·¥çš„ï¼Ÿå®žæ—¶è¿˜æ˜¯è½®è¯¢çš„ï¼ŸIpv6 å’Œ 5G æ˜¯å¦åº”ç”¨å…¶ä¸­ï¼Ÿå¦‚ä½•è¿žæŽ¥å…¶ä¸­èŠ‚ç‚¹çš„ï¼Ÿå¯¹äºŽå¤§é‡èŠ‚ç‚¹ä¹‹é—´å¦‚ä½•è§„åˆ’ç½‘åŸŸï¼Ÿæ˜¯å¦å­˜åœ¨å®‰å…¨é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³å®‰å…¨éš”ç¦»é—®é¢˜ï¼Ÿ

Aï¼šk8s ä¸­ï¼Œmaster å’Œ node æ˜¯ç”¨è¿‡ list-watch æœºåˆ¶è¿›è¡Œé€šä¿¡çš„ï¼Œnode ä¸Šçš„ kubelet å¯åŠ¨åŽï¼Œä¼šé¦–å…ˆè¿›è¡Œ list èŽ·å–å…¨é‡çš„æ•°æ®ï¼Œä¹‹åŽè¿›è¡Œ watchï¼Œåª watch å˜åŒ–çš„æ•°æ®ã€‚å¯¹äºŽ k8s çš„å®¹å™¨ç½‘ç»œæ¥è¯´ï¼Œç¤¾åŒºéƒ½æœ‰æ¯”è¾ƒæˆç†Ÿçš„ cni æ’ä»¶ï¼Œflannelï¼Œcalico ç­‰ç­‰ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚æ¥ä½¿ç”¨ä¸åŒçš„ç½‘ç»œæ’ä»¶ã€‚å¦‚æžœå¯¹äºŽå®‰å…¨éš”ç¦»è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥è®© k8s è·‘åœ¨ vm ä¸Šï¼Œä½¿ç”¨ vm æœ¬èº«çš„éš”ç¦»æ€§ã€‚

===ã€‹å†é—®ï¼š æˆ‘è¯´çš„å®‰å…¨é—®é¢˜æ˜¯ï¼Œå› ä¸ºè€ƒè™‘èŠ‚ç‚¹ä¹‹é—´çš„è‡ªæ²»åŠ¿å¿…å­˜åœ¨èŠ‚ç‚¹äº’é€šæƒ…å†µï¼Œæ¯”å¦‚è¿™ç§åœºæ™¯ï¼š æˆ‘å’Œæˆ‘å®¶é‚»å±…å†°ç®±éƒ½ç”¨åŒä¸€ä¸ª cloud æœåŠ¡ï¼Œä¼šä¸ä¼šå‡ºçŽ°å¯¹æ–¹é€šè¿‡èŠ‚ç‚¹ä¹‹é—´çš„é€šè®¯ï¼Œhack è®¿é—®åˆ°æˆ‘çš„å†°ç®±ã€‚

===ã€‹A: è¿™ç§æˆ‘è§‰å¾—åº”è¯¥æ˜¯ç§°ä½œä¸º saas æœåŠ¡ ä¼šæ¯”è¾ƒåˆé€‚ï¼Œè™½ç„¶ä½ å’Œä½ å®¶é‚»å±…çš„å†°ç®±æ„Ÿè§‰æ˜¯åœ¨è¾¹ç¼˜ä¾§ï¼Œä½†æ˜¯è¿™ç§åº”è¯¥ä¸å±žäºŽè¾¹ç¼˜è®¡ç®—åœºæ™¯ï¼Œè€Œä¸”èŠ‚ç‚¹è‡ªæ²»å’ŒèŠ‚ç‚¹äº’é€šä¹Ÿæ²¡å•¥å…³ç³»ã€‚

> Q9ï¼škubeedge å’Œ edgex èƒ½ç»“åˆä½¿ç”¨å—ï¼Ÿ

Aï¼šæˆ‘ä¸ªäººæ²¡æœ‰åº”ç”¨å®žè·µè¿‡ã€‚KubeEdge æ˜¯ Kubernetes åœ¨äº‘ç«¯å‘è¾¹ç«¯çš„å»¶ä¼¸ã€‚å¦‚æžœä½ å¦‚æžœæ›¾ç»å°† Kubernetes å’Œ edgex ç»“åˆä½¿ç”¨è¿‡ï¼Œç†è®ºä¸Š KubeEdge ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

> Q10ï¼šè€å¸ˆæ‚¨å¥½ï¼Œè¯·é—®æ˜¯ä¸æ˜¯ æ¯ä¸€ä¸ªè¾¹ç¼˜ä¾§ edge èŠ‚ç‚¹éƒ½éœ€è¦å…·å¤‡èƒ½å¤Ÿè®¿é—®å…¬ç½‘çš„èƒ½åŠ›ï¼Œä½†æ˜¯ä¸éœ€è¦å…¬ç½‘ ipï¼Ÿå¦‚æžœè¦æŸ¥çœ‹è¢«è°ƒåº¦åˆ° edge ç«¯å®¹å™¨çš„æ—¥å¿—åº”è¯¥æ€Žä¹ˆæŸ¥ï¼Œè¾¹ç¼˜ä¾§æ²¡æœ‰ kubeletï¼Œæ— æ³•ä½¿ç”¨ kubectl logs è°ƒç”¨ kubelet api æŸ¥çœ‹æ—¥å¿—ã€‚

Aï¼šæ˜¯çš„ï¼Œå› ä¸ºè¾¹ç¼˜ä¾§èŠ‚ç‚¹éœ€è¦ä¸Žäº‘ç«¯é€šä¿¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¾¹ç¼˜ä¾§èŠ‚ç‚¹éƒ½éœ€è¦å…·å¤‡è®¿é—®å…¬ç½‘çš„èƒ½åŠ›ï¼Œä½†æ˜¯ä¸éœ€è¦å…¬ç½‘ ipã€‚å…³äºŽ kubectl logs è¿™ä¸ªç‰¹æ€§ç¤¾åŒºä¼šåœ¨ 1.3 ç‰ˆæœ¬å‘å¸ƒã€‚

> Q11ï¼šå®Œå…¨æ˜¯ kubeedge æ–°æ‰‹çš„è¯ï¼Œè¯¥ä»Žå“ªé‡Œå…¥æ‰‹å‘¢?

Aï¼š[https://kubeedge.io/zh/](https://kubeedge.io/zh/)    ,å¦å¤–æœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥åœ¨ KubeEdge ç¤¾åŒºé‡Œæ issue æˆ–è€… slack é‡Œæé—®ã€‚å¦å¤– KubeEdge ç¤¾åŒºæ²¡ä¸¤å‘¨å‘¨ä¸‰ä¸‹åˆä¼šæœ‰ç¤¾åŒºä¾‹ä¼šï¼Œç›¸å…³è¿žæŽ¥å¯ä»¥æŸ¥çœ‹ï¼š[https://github.com/kubeedge/kubeedge](https://github.com/kubeedge/kubeedge)

> Q12:è¾¹ç¼˜è®¾å¤‡ä¸Šè¿è¡Œçš„å®¹å™¨æ”¯æŒ armï¼Œæœ‰åœ¨ Android ä¸Šè·‘è¿‡æ²¡ï¼Œéœ€è¦å“ªäº›é€‚é…ï¼Ÿä¹‹å‰è¯•è¿‡ k3s å¡åœ¨ cgroup

A:android æš‚æ—¶æ²¡æœ‰è·‘è¿‡ã€‚

> Q13: KubeEdge å½“å‰æ˜¯å¦æœ‰åº”ç”¨äºŽå“ªäº›å•†ä¸šåœºæ™¯ï¼Ÿ

A: æœ€å…¸åž‹çš„æ˜¯æ‘„åƒå¤´ç±»åœºæ™¯ï¼Œæ¯”å¦‚æ±½è½¦ä¿å…»é—¨åº—ï¼Œå›­åŒºäººè„¸è¯†åˆ«å…¥å›­ï¼Œè½¦ç‰Œè¯†åˆ«ç­‰ç­‰ã€‚æŠŠ AI è®¡ç®—ç±»åº”ç”¨éƒ¨ç½²åœ¨å®¢æˆ·çŽ°åœºä¸€ä¾§ï¼ˆæ¯”å¦‚æ±½è½¦é—¨åº—æˆ–è€…å›­åŒºï¼‰ï¼Œç›´æŽ¥å°±è¿›å›¾åƒè¯†åˆ«ã€‚

> Q14: KubeEdge çŽ°åœ¨æœ‰æ”¯æŒå“ªäº›ç»ˆç«¯ç›´æŽ¥è·‘ node? é™¤äº†å‰é¢æåˆ°çš„æ ‘èŽ“æ´¾ã€äº¤é€šç¯

A:  æ ‘èŽ“æ´¾ä¸€èˆ¬æ˜¯ç”¨äºŽå¼€å‘æµ‹è¯•åœºæ™¯ã€‚æœ‰å…´è¶£çš„å¯ä»¥å°è¯•ä¸€ä¸‹åŽä¸ºçš„ atlas å¼€å‘è€…å¥—ä»¶ã€‚ä¸€èˆ¬ arm æž¶æž„çš„æœåŠ¡å™¨éƒ½å¯ä»¥ã€‚

> Q15: æ‚¨è§‰å¾—å½“å‰å¾ˆå¤šç»ˆç«¯æ— æ³•è·‘æˆ KubeEdge çš„ä¸»è¦å›°éš¾ç‚¹åœ¨å“ªï¼Ÿ

A:

> Q16:çŽ°åœ¨è¿è¥å•†ä¹Ÿåœ¨å¤§åŠ›åšè¾¹ç¼˜è®¡ç®—ï¼Œè¯·é—® 5G ä¸Žè¾¹ç¼˜è®¡ç®—ç»“åˆçš„å…¸åž‹åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ

A: è¿è¥å•†ä¸»è¦æ˜¯åœ¨åš MEC å±‚é¢ã€‚5G ä¸Žè¾¹ç¼˜è®¡ç®—æœ€å…¸åž‹çš„åœºæ™¯å°±æ˜¯è‡ªåŠ¨é©¾é©¶ã€‚

> Q17:è¯·é—® KubeEdge å®žé™…éƒ¨ç½²ä¸­é‡åˆ°å“ªäº›é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³çš„?  çŽ°ä»Šé¢ä¸´çš„ä¸»è¦æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿ

A:ä¸»è¦æ˜¯è¾¹ç¼˜åœºæ™¯ä¸‹ï¼Œå®¢æˆ·å¯¹äº‘åŽŸç”Ÿï¼ŒKubernetes çš„ç†è§£ç¨‹åº¦ä¸ä¸€æ ·ï¼Œéœ€è¦æ—¶é—´ã€‚è¿™å°±è·Ÿæœ€å¼€å§‹ Kubernetes è¯žç”Ÿä»¥åŽï¼Œå¯¹ä¼ ç»Ÿè§‚å¿µæ˜¯ä¸€ä¸ªå†²å‡»ã€‚

> Q18: KubeEdge å¯¹å…³é”®åŠŸèƒ½æ˜¯å¦æœ‰ç›‘æŽ§ï¼Ÿç›‘æŽ§æ–¹æ¡ˆæ˜¯å¦‚ä½•åšçš„?  æŠ¥è­¦è§„åˆ™åˆ†åˆ«æœ‰å“ªäº›ï¼Ÿ

A: Kubeedge 1.3 ç‰ˆæœ¬è®¡åˆ’æä¾› metric åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨å¼€æºæ™®ç½—ç±³ä¿®æ–¯åŽ»ç›‘æŽ§æŠ¥è­¦ã€‚

> Q19: K8S é€‚åˆè·‘åœ¨ vmware å¹³å°è¿˜æ˜¯ openstack å¹³å°ï¼Ÿ

A: éƒ½å¯ä»¥ã€‚

> Q20:å¯ä»¥ä»‹ç»ä¸‹è¾¹ç¼˜è®¡ç®—åœ¨è‡ªåŠ¨é©¾é©¶åœºæ™¯çš„åº”ç”¨å—ï¼Ÿ

### 2020-04-02ï¼šKubernetes åœ¨æœ¬æ¥ç”Ÿæ´»ç½‘çš„è½åœ°å®žè·µ

> Q1:ä¸ä½¿ç”¨ kubeshift  rancher ç­‰ï¼Œç›´æŽ¥ä½¿ç”¨åŽŸç”Ÿ k8sï¼Œå¦‚ä½•å®žçŽ°å¤šç§Ÿæˆ·ç®¡ç†ï¼Ÿé€šè¿‡ä»€ä¹ˆå®žçŽ°ï¼Ÿ

Aï¼šä½ å¯ä»¥å°è¯•ä¸‹æˆ‘åœ¨åˆ†äº«ä¸­æåˆ°çš„ KubeSphere å¹³å°

> Q2ï¼šk8s åœ¨ç”Ÿäº§ä¸Šéƒ¨ç½²ï¼ŒæŽ¨èäºŒè¿›åˆ¶è¿˜æ˜¯ kubeadm å®‰è£…ï¼Ÿkubeadm å®‰è£…é™¤äº†æé«˜è¿ç»´éš¾åº¦ï¼Œåœ¨ç”Ÿäº§ä¸Šè¿˜æœ‰ä»€ä¹ˆå¼Šç«¯

Aï¼šæˆ‘ä»¬ä½¿ç”¨äº† kubeadm éƒ¨ç½² k8sï¼›å»ºè®®é€‰ä½ ä»¬è¿ç»´å›¢é˜Ÿè¾ƒç†Ÿæ‚‰çš„é‚£ç§æ–¹å¼éƒ¨ç½²ã€‚

> Q3ï¼šå¦‚ä½•å…¥é—¨å­¦ä¹  k8s

Aï¼šå¾ˆå¤šæ–¹å¼ï¼Œæœ‰æœ¬ä¹¦å¯ä»¥æŽ¨èã€ŠKubernetes in Actionã€‹

> Q4ï¼šç”¨ prometheus-operator ç›‘æŽ§ k8s çš„æ—¶å€™ï¼Œæœ‰ç‚¹ä¸æ˜Žç™½ä¸ºå•¥é»˜è®¤çš„é˜ˆå€¼è¦é‚£ä¹ˆé…ç½®ï¼Œæ¯”å¦‚è¯´ apiserverï¼Œæˆ‘æ€Žä¹ˆåŽ»å®šä¹‰æˆ‘çš„é˜ˆå€¼ï¼Œåªè¦æŠ¥è­¦äº†ï¼Œæˆ‘å°±çŸ¥é“ apiserver æœ‰é—®é¢˜äº†

Aï¼šè‹¥è¦å¯¹ apiserver çš„é«˜å¯ç”¨è¿›è¡Œç›‘æŽ§ï¼Œå¯å…ˆå¯¹ ready/desired æ•°é‡è¿›è¡Œæ¯”å¯¹ï¼Œå…¶æ¬¡å¯ä»¥åœ¨é›†ç¾¤å¤–éƒ¨å¯¹ apiserver è¿›è¡Œè®¿é—®ç›‘æŽ§ã€‚

> Q5ï¼šæˆ‘çŽ°åœ¨çœ‹å¥½å¤šé¡¹ç›®ï¼Œç”¨æˆ·å¼€å§‹ç”¨ k8s æ›¿æ¢ yarn åšèµ„æºè°ƒåº¦ï¼Œè¿™ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…ä¼˜åŠ£åŠ¿ï¼Ÿ

Aï¼šå¯¹ yarn ä¸æ˜¯å¾ˆäº†è§£ï¼Œä¸å¥½ä¸‹ç»“è®º

> Q6ï¼šæˆ‘ä»¬è¿™ç”¨çš„æ˜¯ dubboï¼Œpod æ›´æ–°çš„æ—¶å€™ï¼Œæ¯”å¦‚è¯´å·²ç»è¿›æ¥çš„æµé‡ï¼Œæˆ‘å¦‚ä½•åŽ»ä¼˜é›…å¤„ç†ï¼Œæˆ‘è¿™ pod æ›´æ–°çš„æ—¶å€™ï¼Œæœ‰ä¾èµ–è¿™ä¸ªæœåŠ¡çš„åº”ç”¨å°±ä¼šæŠ¥ dubbo è¶…æ—¶äº†

Aï¼šè¿™ä¸ªæˆ‘ä»¬ä¹Ÿåœ¨ä¼˜åŒ–ä¸­ï¼Œç›®å‰çš„æ–¹æ¡ˆæ˜¯åœ¨è¿›ç¨‹æ”¶åˆ° SIGTERM ä¿¡å·åŽï¼Œå…ˆç¦æ­¢æ‰€æœ‰æ–°çš„è¯·æ±‚ï¼ˆå¯ä»¥ä½¿ readinessProbe å¤±è´¥ï¼‰ï¼Œç„¶åŽç­‰å¾…æ‰€æœ‰è¯·æ±‚å¤„ç†å®Œæ¯•ï¼Œæ ¹æ®ä¸šåŠ¡ç‰¹æ€§è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤å¯ä»¥ä¸º 30 ç§’ï¼Œè¶…æ—¶åŽè‡ªåŠ¨å¼ºåˆ¶åœæ­¢

> Q7ï¼šè¯·é—®ä½ ä»¬æœåŠ¡å¦‚ä½•åš HPA çš„ï¼Ÿ

Aï¼šç›®å‰è¿˜æ²¡æœ‰ä½¿ç”¨ HPA

> Q8ï¼šæœ€è¿‘æˆ‘ä»¬åœ¨è°ƒç ”æŠŠæ•°æ®åº“è·‘åœ¨ k8s ä¸Šï¼Œä¸çŸ¥é“å¤§ä½¬æœ‰æ²¡æœ‰è¿™æ–¹é¢çš„ç»éªŒå¯ä»¥åˆ†äº«ä¸‹

Aï¼šæ²¡æœ‰è¿™æ–¹é¢ç»éªŒï¼Œç›®å‰æˆ‘ä»¬å¯¹å­˜å‚¨è¿˜å¤„äºŽç ”ç©¶çŠ¶æ€ï¼Œå°šæœªè€ƒè™‘æŠŠæœ‰çŠ¶æ€åº”ç”¨å…¨éƒ¨éƒ¨ç½²åœ¨ k8s ä¹‹ä¸Šã€‚æˆ‘çš„å»ºè®®æ˜¯ï¼Œä½ å¿…é¡»æœ‰ä¸€ä¸ªæ¯”è¾ƒå¯é çš„å­˜å‚¨æ‰èƒ½åšè¿™ä»¶äº‹ã€‚

> Q9ï¼šJar åŒ…å¯åŠ¨æ—¶åŠ  jvm é™åˆ¶å—ï¼Ÿè¿˜æ˜¯åªåš request å’Œ limit é™åˆ¶ï¼Ÿ

Aï¼šæˆ‘çš„ç†è§£æ˜¯  request å’Œ limit åªæ˜¯å¯¹æ•´ä¸ªå®¹å™¨çš„èµ„æºè¿›è¡ŒæŽ§åˆ¶ï¼› è€Œ jvm çš„ç›¸å…³å‚æ•°æ˜¯å¯¹å®¹å™¨å†…éƒ¨çš„åº”ç”¨åšé™åˆ¶ã€‚

è¿™ä¸¤è€…å¹¶ä¸å†²çªï¼›å¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨ request å’Œ limit ï¼›åªä¸è¿‡ jvm çš„é™åˆ¶ä¸Šé™ä¼šå—åˆ° limit çš„åˆ¶çº¦.

> Q10ï¼šå­˜å‚¨ç”¨çš„ä»€ä¹ˆæ–¹æ¡ˆï¼Ÿèƒ½åˆ†äº«ä¸‹ä¹ˆï¼Ÿ

Aï¼šCeph-RBD

> Q11ï¼šceph ç”¨çš„ bluestore è¿˜æ˜¯ filestore?

Aï¼šBlueStore

> Q12ï¼šnet core åº”ç”¨éƒ¨ç½²åœ¨ k8s ä¸­ç›¸æ¯” Java æ“ä½œå¤æ‚å—ï¼Œæƒ³äº†è§£ä¸‹å…·ä½“å¦‚ä½•ä»Ž.net è½¬åˆ° net core çš„

Aï¼š1ï¼‰å®žé™…åœ¨ k8s å†…éƒ¨ç½².netcore å’Œéƒ¨ç½² java éƒ½ä¸€æ ·ï¼Œé€‰æ‹©å¥½å¯¹åº”çš„ dotnetcore åŸºç¡€é•œåƒç‰ˆæœ¬ï¼›ç„¶åŽä»¥è¯¥ç‰ˆæœ¬çš„ä¸ºåŸºç¡€åˆ¶ä½œåº”ç”¨çš„é•œåƒåŽéƒ¨ç½²åˆ° k8s å³å¯

åªä¸è¿‡åœ¨é€‰æ‹© dotnetcore çš„åŸºç¡€é•œåƒæ—¶ï¼Œæˆ‘å»ºè®®ç›´æŽ¥é€‰æ‹© sdk æ­£å¸¸ç‰ˆæœ¬ã€‚æˆ‘ä»¬è¯•è¿‡ runtimeã€sdk-alpine ç­‰ç‰ˆæœ¬ï¼Œè™½ç„¶è¿™äº›ç‰ˆæœ¬å ç”¨ç©ºé—²å°ï¼›ä½†æ˜¯ä½ ä¸çŸ¥é“å®ƒé‡Œé¢ä¼šå°‘é‚£äº›åŸºç¡€åº“çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªä¸Šé¢è¸©äº†å¾ˆå¤šå‘ã€‚æˆ‘ä»¬çŽ°åœ¨é€‰æ‹©çš„åŸºç¡€é•œåƒæ˜¯ï¼šmcr.microsoft.com/dotnet/core/sdk:3.1

2ï¼‰è½¬æ¢è¿‡ç¨‹æ ¹æ®ç¨‹åºçš„å¤æ‚åº¦å†³å®šï¼Œæœ‰äº›åº”ç”¨æ²¡ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæœ‰äº›æ”¹çš„å¾ˆåŽ‰å®³ã€‚

> Q13ï¼šé•œåƒ tag å’Œä»£ç ç‰ˆæœ¬æ˜¯æ€Žæ ·çš„å¯¹åº”å…³ç³»ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„é•œåƒ tag = æºç çš„åˆ†æ”¯: [develop|master] + æ—¥æœŸ + jenkins çš„ç¼–è¯‘ä»»åŠ¡åºå·; å¦‚:master-200401-27 è¿™æ ·ã€‚

å½“è¿™ä¸ª tag çš„é•œåƒåœ¨çº¿ä¸‹éƒ½æµ‹è¯•å®Œæ¯•æ—¶å‡†å¤‡ä¸Šçº¿äº†, é‚£ä¹ˆå°±ä»¥è¿™ä¸ªé•œåƒçš„ Tag ä½œä¸ºåº”ç”¨ä»£ç çš„ Tag ç¼–å·. è¿™æ ·å°±èƒ½å¤Ÿé€šè¿‡é•œåƒçš„ Tag è¿½æº¯åˆ°åº”ç”¨ä»£ç çš„ Tag ç‰ˆæœ¬

> Q14ï¼šCentos7 çš„ç³»ç»Ÿç‰ˆæœ¬å’Œå†…æ ¸ç‰ˆæœ¬å·ï¼Œèƒ½è¯´æ˜Žä¸‹ä¹ˆ

Aï¼šå†…æ ¸ç‰ˆæœ¬ï¼š3.10.0-1062.12.1.el7.x86_64ï¼Œè¿™ä¸ªå¯¹åº”çš„æ˜¯ CentOS 7.7ï¼Œå…·ä½“å¯å‚è§ [https://access.redhat.com/articles/3078](https://access.redhat.com/articles/3078)

> Q15ï¼šæœ¬æ¥ç”Ÿæ´»çš„æ—¥å¿—å’Œç›‘æŽ§æ–¹æ¡ˆæ˜¯æ€Žæ ·è®¾è®¡çš„ï¼Ÿ

Aï¼šç”±äºŽ KubeSphere çš„æ—¥å¿—åœ¨è€ç‰ˆæœ¬æœ‰å»¶æ—¶ï¼Œå› æ­¤æˆ‘ä»¬çº¿ä¸Šæ˜¯é‡‡é›†åˆ° Kafka ç„¶åŽé€šè¿‡çŽ°æœ‰çš„ Kibana è¿›è¡ŒæŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯ ELKï¼Œç›‘æŽ§æ˜¯åŸºäºŽ KubeSphere è‡ªå¸¦çš„ prometheusï¼Œæ²¡åšå¤ªå¤šä¿®æ”¹

> Q16ï¼šKubeSphere æ˜¯å¼€æºçš„å—ï¼Ÿ

Aï¼šæ˜¯å¼€æºçš„ï¼Œé¡¹ç›®åœ°å€ï¼ˆ[https://github.com/kubesphere/kubesphere](https://github.com/kubesphere/kubesphere)ï¼‰ï¼Œæ˜¯ç”±é’äº‘å›¢é˜Ÿç ”å‘çš„

> Q17ï¼šä½ ä»¬æœ‰æ²¡æœ‰å¯¹ Porter è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Ÿ

Aï¼šè¯»è¿‡æºç ï¼Œç›®å‰è¿˜æ²¡æœ‰äººåŠ›å’Œéœ€æ±‚è¿›è¡ŒäºŒæ¬¡å¼€å‘

> Q18ï¼šJenkinsfile è°ƒç”¨æŽ¥å£æ˜¯é‡‡ç”¨æ’ä»¶è¿˜æ˜¯ä½¿ç”¨ shell çš„å‘¢

Aï¼šæˆ‘ä»¬æš‚æ—¶é‡‡ç”¨çš„ shell çš„æ–¹å¼ã€‚

> Q19ï¼škubesphere çš„ terminal ä¸æ˜¯å¾ˆå¥½ç”¨ï¼Œè¯·é—®æ‚¨é‚£è¾¹æ˜¯å¦å¯¹æ­¤æœ‰ä½•æ”¹è¿›ï¼›å¦å¤–æˆ‘ä¹‹å‰æŸ¥çœ‹ kubesphere çš„ä»£ç ï¼Œå‘çŽ°å¼€å¯ elk ä¹‹åŽï¼Œå®¹å™¨æ—¥å¿—è¯»å–ä¼šç›´æŽ¥è½¬å‘ elasticsearchï¼Œå¦‚æžœä¸å¯¹å®¹å™¨åš elk æ—¥å¿—æ”¶é›†çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ kubesphere ç•Œé¢ä¸­å°†æ— æ³•è¯»å–åˆ°å®¹å™¨çš„æ—¥å¿—ï¼Œå¯¹æ­¤æ‚¨é‚£è¾¹æœ‰è¿‡ç±»ä¼¼çš„é­é‡å—ã€‚è°¢è°¢

Aï¼š1ï¼‰æˆ‘ä»¬é‡åˆ°çš„ä¸å¥½ç”¨çš„æƒ…å†µä¸»è¦æœ‰ä¼šè¯ä¿æŒé—®é¢˜ï¼Œåœ¨è¿›å…¥ web terminal æ—¶ï¼Œè¾“å…¥ while :; do sleep 5; echo -n ' ' >&2; done &   å³å¯ä¿æŒä¼šè¯ã€‚

2ï¼‰å…³äºŽæ—¥å¿—å»¶æ—¶çš„é—®é¢˜åœ¨ 2.1.1 ä¸­ä¿®å¤äº†ï¼Œä½ å¯ä»¥å°è¯•ä¸‹

> Q20ï¼šåº”ç”¨çš„å›žæ»šè¿‡ç¨‹ (Deployment æˆ–è€… Statefulset) æ˜¯æ‰‹åŠ¨å›žæ»šè¿˜æ˜¯é€šè¿‡ pipeline è‡ªåŠ¨åŒ–å›žæ»šï¼Ÿ

Aï¼špipeline è‡ªåŠ¨åŒ–ï¼Œåˆ†äº«é‡Œè®²åˆ°æˆ‘ä»¬æœ‰å‡ ç§ pipeline ç±»åž‹ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯åº”ç”¨å›žæ»š

> Q21:ä½ ä»¬å¯¹å®¹å™¨ç›‘æŽ§æ˜¯é‡‡ç”¨å“ªç§æ–¹å¼ï¼Œå¦å¤–åº”ç”¨çš„ç›‘æŽ§æ˜¯å¦‚ä½•åšçš„ï¼Œä¸»è¦æ˜¯æ€§èƒ½è¿™éƒ¨åˆ†ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘çš„ ARMSï¼Œç›®å‰åœ¨çœ‹è¿™ä¸ª

Aï¼šç›‘æŽ§çš„éƒ¨åˆ†æˆ‘ä»¬è¿˜åœ¨ä¼˜åŒ–ä¸­ï¼Œä¸»è¦æ€è·¯æ˜¯å¯¹ ready/desired æ•°é‡è¿›è¡Œæ¯”å¯¹ï¼›åº”ç”¨çš„ç›‘æŽ§æ˜¯æŒ‡ä¸šåŠ¡ç›‘æŽ§å—ï¼Ÿ

> Q22ï¼škubesphere å¯¹ Istio å¾®æœåŠ¡æ²»ç†æ”¯æŒå¾—æ€Žä¹ˆæ ·ï¼Ÿä½ ä»¬åŽç»­çš„å¾®æœåŠ¡æ²»ç†æ˜¯åŸºäºŽ Istio æ¥ç®¡ç†å—ï¼Ÿ

Aï¼šKubeSphere é»˜è®¤æ”¯æŒ Istioï¼Œä¸è¿‡æˆ‘ä»¬ç›®å‰çš„å¾®æœåŠ¡è¿˜æ— æ³•ä¸Ž Istio å¯¹æŽ¥ï¼Œå› æ­¤æ²¡æœ‰ä½¿ç”¨ï¼Œä½ å¯ä»¥å‚è€ƒä»–ä»¬å®˜æ–¹çš„æ–‡æ¡£å’Œè§†é¢‘

> Q23:ä½ ä»¬ yaml æ¨¡ç‰ˆå¤ç”¨æ˜¯æ€Žä¹ˆä½¿ç”¨çš„ï¼Œhelm æœ‰ç”¨åˆ°å—ï¼Ÿ

Aï¼šæˆ‘ä»¬æŠŠ yaml æ–‡ä»¶å†…ä¸€äº›åº”ç”¨ç›¸å…³çš„æ•°æ®æŠ½å–æˆå˜é‡ï¼Œä½¿ä¹‹æˆä¸ºåº”ç”¨ yaml æ–‡ä»¶çš„åŸºç¡€æ¨¡æ¿ï¼›

ç„¶åŽåœ¨ pipeline æž„å»ºæ—¶é€šè¿‡æŽ¥å£èŽ·å–åˆ°å¯¹åº”åº”ç”¨çš„ç›¸å…³å‚æ•°ï¼Œå°†è¿™äº›å‚æ•°ç»“åˆ yaml æ–‡ä»¶æ¨¡æ¿è‡ªåŠ¨å¡«å……åŽç”Ÿæˆå¯¹åº”åº”ç”¨çš„ yaml æ–‡ä»¶ï¼›ç„¶åŽè¿›è¡Œéƒ¨ç½²æ“ä½œã€‚Helm æ²¡æœ‰åœ¨åº”ç”¨éƒ¨ç½²ä¸­ä½¿ç”¨ï¼Œä½†ä¸­é—´ä»¶æœ‰ã€‚

> Q24:pod ç»‘å®šäº† svcï¼Œä½¿ç”¨ LoadBalancer çš„ ip è‡ªåŠ¨æ³¨å†Œæ³¨å†Œä¸­å¿ƒï¼Œè¿™å—å¦‚ä½•å®žçŽ°çš„ã€‚

Aï¼šæˆ‘ä»¬çš„å¾®æœåŠ¡æ˜¯æ‰‹åŠ¨æ³¨å†Œ IPï¼Œå¦‚æžœè‡ªåŠ¨çš„è¯éœ€è¦ä¸Ž pipeline ç»“åˆ

> Q25:æœ‰åšå¤šé›†ç¾¤ç®¡ç†å—ï¼Ÿ

Aï¼šæœªæ¥è®¡åˆ’

> Q26:å†·åŠ è½½æ€Žä¹ˆé‡å¯

Aï¼šä½ è¯´çš„å†·åŠ è½½æ˜¯ä»€ä¹ˆ

---

### 2020-03-17ï¼šå›½å†…æŸçŸ¥åå©šæ‹ç½‘ç«™çš„ Kubernetes è½åœ°å®žè·µ

[çŸ³å¢¨æ–‡æ¡£](https://shimo.im/docs/CWPWQq8ygkg6Qcwy)

> Q1ï¼šè¯·é—® lnmp ç½‘ç«™æž¶æž„å®¹å™¨åŒ–ä¸Š k8sï¼Œnginx å’Œ php æ˜¯å„è®¾ pod å§ï¼Ÿmysql é‡‡ç”¨ä¸€ä¸»å¤šä»Žæž¶æž„ï¼Ÿç”¨ä»€ä¹ˆåšå­˜å‚¨ï¼Ÿ

Aï¼šlnmp å»ºè®®æ˜¯ nginx å’Œ php æ”¾åœ¨åŒä¸€ä¸ª pod ä¸­ï¼Œç„¶åŽå¤–å±‚å†åŠ ä¸€ä¸ª nginxï¼Œåš upstreamã€‚
mysql åº”ç”¨ä¸Š k8s è¦ç”¨ statefulsetã€‚ä¸è¿‡æˆ‘ä»¬ç›®å‰å†…éƒ¨è¿™ä¸€å—æ˜¯è¿˜æ²¡æœ‰è¿ç§»åˆ° k8s é›†ç¾¤ä¸­çš„

> Q2ï¼šå…¬å¸åœ¨ go è¯­è¨€ä¸Šæœ‰å“ªäº›é¡¹ç›®ï¼Œæ€Žä¹ˆçœ‹å¾… go è¯­è¨€

Aï¼šæˆ‘å¸ç›®å‰å°šæœªä½¿ç”¨ go è¯­è¨€ï¼Œjava ä¸ºä¸»

> Q3ï¼špod çš„æ»šåŠ¨æ›´æ–°ï¼ˆä¼˜é›…é‡å¯ï¼‰æ€Žä¹ˆåšçš„ï¼Œæœ‰æ²¡æœ‰åš pod è½åœ°å‡çº§ï¼Ÿ

Aï¼šæ»šåŠ¨æ›´æ–° k8s çš„ deployment ä¸­æœ‰ç›¸å…³çš„ rollingUpdate ç­–ç•¥ï¼Œä¼˜é›…åœæœºæœ‰ä¸¤ä¸ªæ³¨æ„çš„ç‚¹ï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬è¦ç¡®ä¿åº”ç”¨å‘çš„ SIGTERM ä¿¡å·ï¼Œå¦ä¸€ä¸ªæ˜¯ä»£ç è¦ç¡®ä¿æ”¶åˆ° SIGTERM ä¿¡å·åŽä¼˜å…ˆå…³é—­ç«¯å£æˆ–è€…å–æ¶ˆæœåŠ¡æ³¨å†Œã€‚
pod è½åœ°å‡çº§ï¼Ÿæ˜¯æŒ‡åŽŸåœ°å‡çº§å—ï¼Ÿè¿™ä¸€å—æˆ‘ä»¬ç›®å‰æœªåš

> Q4ï¼šharbor çš„ä½¿ç”¨ç‰ˆæœ¬ï¼Ÿé•œåƒçš„åŽç«¯å­˜å‚¨æ˜¯ä»€ä¹ˆï¼Ÿharbor çš„éƒ¨ç½²å½¢æ€ï¼Ÿå¦‚ä½•è§£å†³ harbor çš„é«˜å¯ç”¨é—®é¢˜ï¼Ÿ

Aï¼šharbor ä½¿ç”¨ç‰ˆæœ¬è¿™é‡Œä¸æ–¹ä¾¿è¯´ã€‚ä¸å¥½æ„æ€å“ˆã€‚é•œåƒåŽç«¯å­˜å‚¨æˆ‘ä»¬ç›®å‰ç”¨çš„æ˜¯è…¾è®¯äº‘çš„ cfsï¼Œæ€§èƒ½ä¸Šç›®å‰å¤Ÿç”¨ã€‚harbor éƒ¨ç½²å½¢æ€ï¼Œæˆ‘å¤§æ¦‚æè¿°ä¸€ä¸‹ï¼šng/lb åå‘ä»£ç†åˆ°åŽç«¯ harborï¼Œharbor å­˜å‚¨ç”¨è…¾è®¯äº‘çš„ cfsã€‚å¦‚ä½•è§£å†³ harbor çš„é«˜å¯ç”¨ï¼Œè¿™ä¸€å—æˆ‘ä»¬ç›®å‰æœªåšï¼ŒåŽç»­ç ”ç©¶ä¸€ä¸‹

> Q5ï¼šé™¤å¼€ k8s è‡ªèº«çš„ç›‘æŽ§ï¼Œå®¹å™¨å†…éƒ¨æœåŠ¡ç›‘æŽ§æ˜¯å¦‚ä½•åšçš„ï¼Ÿå¦‚æžœåœ¨å­ç½‘ï¼Œç›‘æŽ§æ€Žä¹ˆé€å‡ºï¼Ÿpinpoint-agent åµŒå…¥åˆ° container é‡Œé¢æœ‰æ²¡æœ‰éœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ï¼Ÿ

Aï¼šå®¹å™¨å†…éƒ¨æœåŠ¡ç›‘æŽ§æˆ‘ä»¬æ˜¯ç”¨ pinpoint åš apm ç›‘æŽ§ã€‚ç›‘æŽ§æ€Žä¹ˆé€å‡ºï¼Ÿè¿™é‡Œä¸æ˜¯å¾ˆæ˜Žç™½è¿™ä¸ªé—®é¢˜ï¼Œä¸å¥½æ„æ€å“ˆã€‚pp-agent åµŒå…¥åˆ° container é‡Œè¾¹æœ‰æ²¡æœ‰éœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ï¼Œè¿™ä¸ªè¿˜å¥½ï¼Œå› ä¸ºæˆ‘ä»¬ç›®å‰è¿™ä¸€å—éƒ½æ˜¯åšåœ¨åŸºç¡€é•œåƒé‡Œè¾¹çš„ï¼Œå¯åŠ¨çš„æ—¶å€™åŠ å¯åŠ¨å‚æ•°å°±å¥½ï¼Œæ­¥éª¤ä¹ŸæŒºç®€å•çš„

> Q6ï¼šè¯·é—®å‰ç«¯æ˜¯æ€Žä¹ˆæš´éœ²åœ¨å¤–é¢çš„ï¼Œssl è¯ä¹¦æ€Žä¹ˆæ‰èƒ½åšåˆ°è‡ªåŠ¨ç­¾å‘ï¼Ÿ

A:å‰ç«¯é™æ€èµ„æºæš´éœ²æˆ‘ä»¬æœ‰ä¸¤ç§å§ã€‚ä¸€ç§æ˜¯ç›´æŽ¥æ”¾åœ¨ ng é™æ€èµ„æºç›®å½•é‡Œè¾¹ç„¶åŽåŠ ä¸Š cdnï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¾åœ¨ k8s é›†ç¾¤ä¸­ï¼Œå‰é¢ nginx åšåå‘ä»£ç†ï¼Œé…ä¸Šé™æ€èµ„æºç›¸å…³çš„ç¼“å­˜ç­–ç•¥ã€‚
ssl è¯ä¹¦è‡ªåŠ¨ç­¾å‘ï¼Œk8s é›†ç¾¤å†…æˆ‘ä»¬ç›®å‰ç”¨çš„æ˜¯æ‰˜ç®¡ç±»åž‹çš„ï¼Œæ‰€ä»¥è¿™ä¸€å—æœªæ¶‰åŠã€‚é›†ç¾¤å¤–å…¶ä»– ssl è¯ä¹¦æœªåšè‡ªåŠ¨ç­¾å‘çš„è¯ä¹¦ã€‚

> Q7ï¼šè¯·é—®åœ¨å“ªé‡Œçœ‹è§†é¢‘??ç›´æ’­åœ¨å“ªâ€¦â€¦

Aï¼šå“Žå‘€ï¼Œæ²¡æœ‰è§†é¢‘ï¼ŒåŽé¢ä¼šæ•´ç†æ–‡ç« ã€‚

> Q8ï¼šå®¹å™¨çš„ tcp è¿žæŽ¥æ•°æ€Žä¹ˆç›‘æŽ§

Aï¼šè¿™ä¸ªç›®å‰æœªç›‘æŽ§ï¼ŒåŽç»­æ‰“ç®—ç”¨ prometheus

> Q9ï¼šgitlab æŽ¥æ”¶ä¸€ä¸ª push event è§¦å‘æž„å»ºï¼Œè¿™ä¸ªæ˜¯ç›‘æŽ§æ‰€æœ‰çš„åˆ†æ”¯å—ï¼Œåˆ†æ”¯æ¨¡åž‹æ˜¯æ€Žä¹ˆæ ·çš„

Aï¼šä¸æ˜¯çš„ï¼ŒæŒ‰éœ€ã€‚æˆ‘ä»¬å†…éƒ¨åˆ†æ”¯æ¨¡åž‹å¤§æ¦‚æœ‰å››ç§ï¼Œdevâ€”â€”>testâ€”â€”>releaseâ€”â€”>masterã€‚master ä»¥å¤–çš„ä¸ºäº†æ•ˆçŽ‡éƒ½ä¼šåšè‡ªåŠ¨è§¦å‘

> Q10ï¼šè¯·é—®è§„æ¨¡æ˜¯ï¼Ÿå¤§æ¦‚å¤šå°‘ nodeï¼Œä¼šè·¨å¾ˆå¤šé›†ç¾¤å—

Aï¼šæˆ‘ä»¬å†…éƒ¨çš„é›†ç¾¤è§„æ¨¡ï¼Œç”Ÿäº§é›†ç¾¤æ•°é‡æ˜¯ 4 ä¸ªï¼Œä¸è¿‡æ˜¯æœ‰å¤§æœ‰å°ï¼Œæ˜¯æŒ‰ä¸šåŠ¡æ¥åˆ’åˆ†çš„ã€‚æœ€å¤§çš„ä¸€ä¸ªé›†ç¾¤æ˜¯ 2700G å†…å­˜ï¼Œnode èŠ‚ç‚¹å°†è¿‘ 50 ä¸ªã€‚node èŠ‚ç‚¹æ•°é‡è¦æ ¹æ®æ¯ä¸ªèŠ‚ç‚¹é…ç½®æ¥çœ‹ï¼Œé…ç½®é«˜ï¼ŒèŠ‚ç‚¹æ•°é‡å°±å°‘ã€‚

> Q11ï¼šä¸ºä»€ä¹ˆä¸ç›´æŽ¥ç”¨ gitlab-runner è€ŒæŽ¥ jenkins

Aï¼šgitlab-runner éœ€è¦æ¯ä¸ªä»“åº“éƒ½é…ç½®æž„å»ºä¿¡æ¯ï¼Œå½“éœ€è¦ç»Ÿä¸€ä¿®æ”¹æž„å»ºçš„æ—¶å€™å¾ˆéº»çƒ¦

> Q12ï¼šâ€œpod å·²å®žçŽ°ä¸Ž node èŠ‚ç‚¹åœ¨åŒä¸€ç½‘ç»œå±‚é¢ï¼Œä¿ƒè¿›äº†æˆ‘ä»¬åŽé¢çš„å¿«é€Ÿè½åœ°ã€‚â€è¿™ä¸ªæ˜¯ä»€ä¹ˆéœ€æ±‚ï¼Ÿ

Aï¼šåŽŸç”Ÿçš„ k8s é›†ç¾¤è·¨é›†ç¾¤è°ƒç”¨ç½‘ç»œä¸Šé»˜è®¤æ˜¯ä¸é€šçš„ã€‚

> Q13ï¼šè¯·é—® dubbo åœ¨è½¬å‘ K8S æˆ– istio ç½‘æ ¼åŒ–æ”¹é€ è¿‡ç¨‹ä¸­ï¼Œä¼ ç»ŸçŽ¯å¢ƒä¸Žå®¹å™¨åŒ–çŽ¯å¢ƒå…±å­˜äº’ç›¸è°ƒç”¨æ—¶ï¼Œæ˜¯å¦é‡åˆ°ä»€ä¹ˆå‘ï¼Ÿå¦‚ä½•åŒ–è§£çš„ï¼Ÿè°¢è°¢~

Aï¼šç½‘æ®µå†²çªå§ã€‚æˆ‘ä»¬æ›¾ç»åšè¿‡ä¸€æ®µæ—¶é—´çš„ docker å•æœºï¼Œä½†æ˜¯å½“æ—¶æ²¡æœ‰é…ç½® docker çš„ç½‘æ®µï¼Œå¯¼è‡´åŽé¢å†²çªçš„æ—¶å€™å‡ºçŽ°ç½‘ç»œä¸é€šã€‚è§£å†³æ–¹æ¡ˆï¼šæŒ‡å®š docker å•æœºçš„ç½‘æ®µ

> Q14ï¼šTKE å¦‚ä½•è·Ÿå…¬å¸å†…éƒ¨ç³»ç»Ÿçš„ç”¨æˆ·æƒé™æ‰“é€šï¼Œèƒ½å¦è¯´ä¸‹ç»†èŠ‚ï¼Ÿ

Aï¼šæƒé™æ²¡æœ‰æ‰“é€šå–”ï¼Œè¿™ä¸ªè¿˜æ˜¯ä¾èµ–è…¾è®¯äº‘çš„æƒé™æŽ§åˆ¶

> Q15ï¼šé•¿è¿žæŽ¥åœ¨ingress-nginx åœºæ™¯ä¸‹ï¼Œnginx reload æ—¶ä¼šæ–­å¼€ã€‚è‹¥ingress è¿›è¡Œå¢žã€åˆ ã€æ”¹æ“ä½œï¼Œæ¯æ¬¡éƒ½éœ€è¦ reloadï¼Œå¦‚ä½•ä¿è¯é•¿è¿žæŽ¥ä¸šåŠ¡çš„ç¨³å®šæ€§ã€‚ingress æœ‰æ²¡æœ‰æ€§èƒ½ç“¶é¢ˆï¼Ÿ

Aï¼šç›®å‰è¿˜æ˜¯ä¾èµ–ä¸šåŠ¡ç«¯çš„é‡è¿žæœºåˆ¶ã€‚æ€§èƒ½ç“¶é¢ˆç›®å‰å¥½åƒè¿˜æ²¡é‡åˆ°è¿‡

> Q16ï¼šã€Žå› ä¸ºæˆ‘ä»¬çš„æœåŠ¡æš´éœ²æ–¹å¼ç”¨çš„æ˜¯ingressï¼Œæ‰€ä»¥ç›´æŽ¥åˆ©ç”¨ kubernetes çš„ service æœåŠ¡å‘çŽ°çš„èƒ½åŠ›æ¥å®žçŽ°ç°åº¦å‘å¸ƒã€ï¼Œè¯·é—®ä¸€ä¸‹å…·ä½“æ€Žä¹ˆåšçš„ï¼Ÿæ ¹æ® header é€‰æ‹© lable å—ï¼Ÿ

Aï¼šä¸æ˜¯çš„ï¼Œç›®å‰æ²¡æœ‰åšåˆ°è¿™ä¹ˆç»†è‡´ã€‚å°±æ˜¯ deploy ä¸¤ä¸ª deploymentï¼Œç”¨ç›¸åŒçš„ labelï¼Œservice é€šè¿‡ label selector åšå‘çŽ°

> Q17: åœ¨ CD çš„è¿‡ç¨‹ä¸­ ï¼Œç‰ˆæœ¬ç®¡ç†æ˜¯æ€Žä¹ˆåšçš„ ï¼Ÿæ˜¯åŸºäºŽé•œåƒçš„ tag è¿˜æ˜¯ helm çš„ç‰ˆæœ¬ï¼ŸåŒ…æ‹¬å›žæ»šçš„ç­–ç•¥ä¸Žæ–¹å¼

Aï¼šç”¨çš„æ˜¯ helm çš„ç‰ˆæœ¬ç®¡ç†ï¼Œå›žæ»šç­–ç•¥å’Œæ–¹å¼éƒ½æ˜¯ç”¨ helm çš„

> Q18: HPA å…·ä½“æ˜¯å’‹åšçš„ï¼Œæ ¹æ®ä»€ä¹ˆæŒ‡æ ‡æ‰©ç¼©å®¹çš„ï¼Ÿé›†ç¾¤å‡çº§å’‹åšçš„

Aï¼šhpa æ˜¯æ ¹æ® cpu åšçš„ã€‚é›†ç¾¤å‡çº§æ˜¯å…ˆå‡çº§ master å†å‡çº§ node èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿˜æ˜¯æŒ‰ç…§ TKE çš„æ¥åš

> Q19: åŽç«¯å­˜å‚¨æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿç”¨çš„æ˜¯åŽ‚å•†çš„å­˜å‚¨è¿˜æ˜¯å¼€æºçš„å­˜å‚¨ï¼Ÿ

Aï¼šåŽ‚å•†çš„

> Q20ï¼šï¼‰ingress-controller èŠ‚ç‚¹ä¸Šçš„çŸ­è¿žæŽ¥é—®é¢˜ï¼ŒçŸ­è¿žæŽ¥å˜é•¿è¿žæŽ¥è¿™ä¸ªæ˜¯æ€Žä¹ˆå¤„ç†çš„ï¼Ÿèƒ½æç¤ºä¸€ä¸‹å—ï¼Ÿ

Aï¼šè¿™ä¸ªä¸æ˜¯æŒ‡é€šè¿‡ingress-controller åŽ»åšçŸ­è¿žæŽ¥å˜é•¿è¿žæŽ¥ï¼Œæ˜¯è¯´å®¢æˆ·ç«¯å‘èµ·çš„è¿žæŽ¥è¦ç”¨é•¿è¿žæŽ¥çš„æ„æ€

---

### 2020-03-12ï¼šKubernetes ç”Ÿæ€ä½“ç³»è½åœ°è¿‡ç¨‹ä¸­çš„é€‰åž‹å’Œè¸©å‘

[çŸ³å¢¨æ–‡æ¡£](https://shimo.im/docs/GCpTQXDddqPRPWPQ)

> Q1ï¼šè½åœ°è¿‡ç¨‹å¿…ç„¶æ¶‰åŠåˆ°ä¹‹å‰å¼€å‘ã€æµ‹è¯•å’Œè¿ç»´æµç¨‹çš„å˜æ›´ï¼Œç»„ç»‡å’Œç›¸å…³äººå‘˜éƒ½ä¼šé¢ä¸´è°ƒæ•´ï¼Œè¿™éƒ¨åˆ†å·¥ä½œè´µå…¬å¸æ˜¯å¦‚ä½•æŽ¨è¿›çš„ï¼Œè¸©äº†å“ªäº›å‘ï¼Œå¦‚ä½•è§£å†³çš„ï¼Ÿ

Aï¼šè¿™ä¸ªâ€¦â€¦ä¸€è¨€éš¾å°½å•Šï¼Œäººçš„é—®é¢˜æ˜¯æœ€éš¾è§£å†³çš„ï¼Œèƒ½ç”¨æŠ€æœ¯è§£å†³çš„éƒ½ä¸æ˜¯é—®é¢˜ï¼Œè¦æ˜¯è¯´å›žç­”çš„è¯ï¼ŒåˆæœŸæ‰“é€šå…¬å¸å„ä¸ªå…³èŠ‚ï¼Œè®©å¤§ boss è®¤å¯è¿™ä»¶äº‹ï¼Œè¡Œæ”¿å‘½ä»¤å¼ºæŽ¨ï¼Œå¾ˆé‡è¦ã€‚ä¸ç„¶åšå‡ºæ¥ä¹Ÿæ²¡äººç”¨ï¼Œå°±æ˜¯ç™½å¿™æ´»åœ¨ç”¨æˆ·ä¸­æ‰¾å°ç™½é¼ è¿­ä»£ï¼Œè€Œä¸æ˜¯è‡ªå·±å¼„ä¸ªè‡ªä»¥ä¸ºå®Œç¾Žçš„æŽ¨å‡ºåŽ»

> Qï¼š JAVA å®¹å™¨çž¬é—´æ‹‰èµ·çš„è¿‡ç¨‹,  æ•´ä¸ªé›†ç¾¤éƒ½ä¼šè¢« CPU ç”¨å°½ï¼Œå¦‚ä½•è§£å†³ JAVA CPU å¯åŠ¨æ—¶å€™ CPU èµ„æºäº’äº‰çš„æƒ…å†µ

Aï¼šè¿™ä¸ªé—®é¢˜æˆ‘ä»¬ä¹Ÿé‡åˆ°è¿‡ï¼ŒåŽæ¥æŠŠå†…æ ¸å‡çº§åˆ° 4.19 åŽå°±ä¸å†å‘ç”Ÿäº†ï¼Œå¾ˆå¤šå†…å­˜è€—å°½ï¼Œcpu çˆ†ç‚¸çš„é—®é¢˜æˆ‘ä»¬éƒ½é€šè¿‡å†…æ ¸å‡çº§è§£å†³äº†

> Q2ï¼šelk è¿˜æœ‰æ–‡ä»¶å­˜å‚¨å¹³å°æ˜¯æ­å»ºåœ¨ k8s ç³»ç»Ÿå†…çš„å—ï¼Ÿå¦å¤–è´µå…¬å¸ç®¡ç† k8s æœåŠ¡æ˜¯å¦é€‰ç”¨äº†è¯¸å¦‚ rancher ä¹‹ç±»çš„ç®¡ç†å¹³å°

Aï¼šelk åœ¨é›†ç¾¤é‡Œï¼Œå¼€å‘æµ‹è¯•çŽ¯å¢ƒç”¨äº† rancherï¼Œçº¿ä¸Šè‡ªå·±å¼€å‘çš„ç®¡ç†å¹³å°ï¼Œæ¯•ç«Ÿ rancher æ˜¯çœŸçš„å¥½ç”¨

> Q3ï¼šæ—¥å¿—å¹³å°æ€Žä¹ˆè§£å†³æ²¡æ³•åƒ grep -C æŸ¥æ‰¾ä¸Šä¸‹æ–‡ï¼Œæ—¥å¿—å¹³å°æ€Žä¹ˆæ ‡å‡†åŒ–æ—¥å¿—æ ¼å¼

Aï¼šè¿™ä¸ªå¾—çœ‹æ—¥å¿—å¹³å°å…·ä½“å¼€å‘æ˜¯æ€Žä¹ˆå®žçŽ°çš„äº†ï¼Œä¸€èˆ¬æ¥è¯´è¿™ä¸æ˜¯é—®é¢˜æ—¥å¿—æ ¼å¼çš„æ ‡å‡†åŒ–ï¼Œå¾—å’Œä¸šåŠ¡åˆä½œã€‚äº‹å®žä¸Šæ—¥å¿—å¹³å°ä¸€èˆ¬æ˜¯ä¸­å°éƒ¨é—¨çš„å•ç‹¬çš„ç³»ç»Ÿï¼Œå®ƒè¦å•ç‹¬å¼€å‘

> Q4 å®¹å™¨åŒ–è½åœ°æ€Žä¹ˆåè°ƒå¼€å‘çš„éœ€æ±‚ï¼Œæ¯”å¦‚å¼€å‘å­¦ä¹ æˆæœ¬ï¼Œæ¯”å¦‚æœ¬åœ°è°ƒè¯•å’ŒçŽ°åœºä¿ç•™å¤çŽ°é—®é¢˜ï¼ŒæŽ’æŸ¥é—®é¢˜çš„æ–¹æ³•æ–¹å¼å¯¹å¼€å‘å‹å¥½

Aï¼šè¿™è¿˜æ˜¯äººçš„é—®é¢˜ï¼Œå¾ˆå¤šä¸šåŠ¡å¼€å‘ä¸æ„¿æ„å­¦ä¹ ï¼Œä¸æŽ¥å—æ–°äº‹ç‰©ï¼Œä¸€å¶éšœç›®å¦å®šå®¹å™¨ï¼Œè¿™çœŸçš„æ²¡åŠžæ³•ã€‚è¿˜æ˜¯ä»Žäººèº«ä¸Šå¯»æ±‚å¦¥åå§ã€‚æ¯ä¸ªäººçš„ç²¾åŠ›éƒ½æ˜¯æœ‰é™çš„ï¼Œè¿™ç§äº‹æƒ…é™·è¿›åŽ»å¾ˆéš¾æ‹”å‡ºæ¥å…¬å¼€åŸ¹è®­ï¼Œè®²åº§ï¼Œé©»åœºæ”¯æŒï¼ŒåŸ¹å…»ä¸šåŠ¡éƒ¨é—¨æ‡‚çš„äºº

> Q5ï¼šå®¹å™¨çŽ¯å¢ƒå¦‚ä½•è½åœ°æ–‡ä»¶å­˜å‚¨ï¼Œæˆ–è€…å¯¹è±¡å­˜å‚¨ï¼Œå¦‚ä½•é€‰æ‹©åŽç«¯çš„å—è®¾å¤‡ã€‚

Aï¼šæˆ‘ä»¬é€‰ç”¨çš„æ˜¯ cephfs å’Œ nfs

> Q6ï¼šçº¿ä¸Š k8s é›†ç¾¤é‡‡ç”¨ä»€ä¹ˆæ–¹å¼éƒ¨ç½²ï¼ŒäºŒè¿›åˆ¶è¿˜æ˜¯ kubeadmin ç­‰ï¼Œéƒ¨ç½²æž¶æž„æ˜¯æ€Žä¹ˆæ ·çš„

Aï¼šå¦‚æžœäº†è§£è¯ä¹¦åˆ¶ä½œå’Œ k8s å„ä¸ªç»„ä»¶çš„ä½œç”¨ï¼Œå»ºè®®ä»ŽäºŒè¿›åˆ¶æ–‡ä»¶å…¥æ‰‹ï¼Œä¼ä¸šçŽ¯å¢ƒå¯ä»¥è‡ªå·±å†™ ansible ç­‰è„šæœ¬ã€‚kubeadm ç»´æŠ¤ä¸€èˆ¬ä¸é€‚ç”¨äºŽçº¿ä¸ŠçŽ¯å¢ƒ

> Q7ï¼šèƒ½å¦ç›´è§‚çš„è°ˆè°ˆçš„ç”¨å®¹å™¨æž„å»ºå¼¹æ€§æœåŠ¡è¿‡ç¨‹ä¸­çš„ä¸šåŠ¡ç³»ç»Ÿå­˜åœ¨å“ªäº›æ–‡åŒ–é—®é¢˜?è¯·ä¸è¦å›žé¿çŽ°å®žï¼Œè°¢è°¢!

Aï¼šæ–‡åŒ–é—®é¢˜ï¼Ÿè¿™æˆ‘å¯ä»¥åæ§½å¾ˆä¹…â€¦â€¦ä½†ä¸é€‚åˆåœ¨è¿™é‡Œè®¨è®º

> Q8ï¼šé›†ç¾¤ç½‘ç»œæ–¹æ¡ˆæ€Žä¹ˆé€‰æ‹©çš„ï¼Œå¯¹å¤–æä¾›æœåŠ¡å¦‚ä½•åšçš„

Aï¼šingress controller å¯ä»¥ç”¨ hostport æš´éœ²ï¼Œå¤–å±‚ nginx åŽ» upstream ä¸€ä¸‹

> Q9ï¼šå¦‚æžœæœåŠ¡å‘çŽ°ç”¨ zookeeperï¼Œé‚£ dubbo æœåŠ¡è¦å®žçŽ°ç°åº¦å‘å¸ƒå¦‚ä½•å®žçŽ°ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬çš„ç°åº¦å‘å¸ƒéƒ½æ˜¯åŸºäºŽingress æ–¹æ¡ˆï¼Œnginx ingress controller å…è®¸ç›´æŽ¥ä½¿ç”¨ nginx è§„åˆ™é…ç½®ï¼Œtraefik åŠŸèƒ½ä¹Ÿè¶³å¤Ÿå¼ºå¤§ç”±äºŽæˆ‘ä¸»è¦çš„å¼€å‘æŠ€æœ¯æ ˆæ˜¯ golangï¼Œä¸å¤ªäº†è§£ dubbo

> Q10ï¼šé•¿æœŸå­˜æ´»çš„å®¹å™¨ä¼šé€ æˆå®¹å™¨æ—¥å¿—å †ç§¯ï¼Œè¯·é—®æœ‰æ²¡æœ‰ä¸é‡å¯å®¹å™¨å°±èƒ½å®žçŽ°æ¸…ç†ä¸Žå½’æ¡£çš„æ–¹æ¡ˆï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜æˆ‘ä»¬æœ‰æƒ³è¿‡ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆæ–¹æ¡ˆã€‚å¦‚æžœä»Žæºå¤´ä¸Šè§„é¿ï¼Œå¯ä»¥è®©ä¸šåŠ¡æ—¥å¿—ä¸è¦è½åœ°æˆæ–‡ä»¶ï¼Œæˆ–è€…è‡ªè¡ŒæŒ‰æ—¥æœŸæµè½¬

> Q11ï¼š å¦‚ä½•é‡‡é›† k8s ä¸­çš„å®¹å™¨å‰å°æ—¥å¿—ï¼Ÿfilebeat è²Œä¼¼åªèƒ½é‡‡é›†æ–‡ä»¶å§

A:å‰å°æ—¥å¿—ä¹Ÿå°±æ˜¯ std æ—¥å¿—ï¼Œåˆ†äº«ä¸­æåˆ°ç”¨ fluentd å’Œ hostpath é‡‡é›†ç‰©ç†æœº docker ç›®å½•ä¸­çš„å†…å®¹å¯ä»¥åŽ»äº†è§£ä¸€ä¸‹ docker ç›®å½•ç»“æž„

> Q12:   ç›‘æŽ§ç³»ç»Ÿæ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿ å¦‚æžœä¿è¯ç›‘æŽ§ç³»ç»Ÿçš„æ•°æ®æ­£ç¡®æ€§å‘¢ï¼Ÿ

B:æ•°æ®æŒä¹…åŒ–æˆ‘ä»¬ç”¨äº† tidbï¼Œå¤–éƒ¨ç”¨ zabbix åšäº†ä¸€å±‚å†—ä½™

> Q13:   æˆ‘æ˜¯ä¸€å Java å·¥ç¨‹å¸ˆï¼Œæœ‰ 7 å¹´ç»éªŒï¼Œæƒ³è½¬è¡Œåˆ°å®¹å™¨ç›¸å…³é¢†åŸŸï¼Œè¯·é—®æˆä¸ºå®¹å™¨å¼€å‘å·¥ç¨‹å¸ˆéœ€è¦å“ªäº›æ¡ä»¶ï¼Ÿ

A: å¯¹ linux è¦éžå¸¸äº†è§£ï¼Œè„±ç¦» jvm çœ‹ä¸€äº›ç³»ç»Ÿæ–¹é¢çš„çŸ¥è¯†ã€‚æ­¤å¤–å®¹å™¨çš„è¯­è¨€åŸºæœ¬ä¸Šéƒ½æ˜¯ goï¼Œå¾®æœåŠ¡é‚£å¥—å’Œ java æ²¡å•¥åŒºåˆ«ï¼Œç†Ÿæ‚‰ protobuf

> Q14  std æ—¥å¿—æ˜¯å¦‚ä½•åŒºåˆ†ä¸åŒ pod çš„ï¼Ÿ

A: fluentd æœ‰å¯¹åº”æ¨¡å—ï¼Œæ”¶é›†åˆ°ä¹‹åŽç›´æŽ¥å°±æœ‰ hostname å’Œ ns

> Q15  å¦‚ä½•ä¿è¯æ—¥å¿— sidecar çš„å­˜æ´»ä¸Žå¦ä¸ä¼šå½±å“åˆ°ä¸šåŠ¡å®¹å™¨ï¼Ÿæœ‰æ²¡æœ‰è€ƒè™‘è¿‡æœªæ¥å¢žåŠ æ•°æ®é¢ä»£ç† sidecar æ¯”å¦‚ istio çš„ envoy åŽï¼Œå• Pod çš„çŠ¶æ€åˆ¤æ–­ä¼šå—åˆ°å½±å“ï¼Ÿ

A: sidecar å’Œä¸šåŠ¡å®¹å™¨æœ¬æ¥å°±æ˜¯äº’ç›¸éš”ç¦»çš„ï¼ŒçŽ°åœ¨ 1.10+ çš„ k8s åœ¨ pod å†…åªä¼šå…±äº«ç½‘ç»œï¼Œä¸ä¼šé»˜è®¤å…±äº« pid äº†ï¼Œåº”è¯¥ä¸ä¼šæœ‰å•¥å½±å“ã€‚åŽä¸€ä¸ªé—®é¢˜ä¸å¤ªæ‡‚

> Q16  event é‡‡é›†æ˜¯å¦‚ä½•å®žçŽ°çš„, æ˜¯å¦å¯ä»¥å¼€æºä»£ç ?

A: æˆ‘è®°å¾— sentry å°±æœ‰ä¸€ä¸ªæ’ä»¶èƒ½å®žçŽ°ã€‚å…¬å¸ä»£ç æœªå¾—è®¸å¯ä¸ä¼šå¼€æº

> Q17 PHP å®¹å™¨é•œåƒæ˜¯è‡ªå·±ç¼–è¯‘çš„è¿˜æ˜¯ç”¨å®˜æ–¹çš„é•œåƒ? nginx å’Œ php ç¼–è¯‘åœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­å—ï¼Ÿå®¹å™¨ä¸­çš„ Nginx ç›´æŽ¥æš´éœ² 80 ç«¯å£å—ï¼Ÿèº«è¾¹ä½¿ç”¨ PHP å®¹å™¨çš„å¥½å°‘ï¼Œæœ‰ä»€ä¹ˆè¦æ³¨æ„çš„åœ°æ–¹æˆ–è€…å‘? è¿™æ–¹é¢çŸ¥è¯†æ¬ ç¼ºï¼Œè°¢è°¢ã€‚

A: è‡ªå·±æ‰“ï¼Œjava åŒ…å«äº† tomcatï¼Œæˆ‘ä»¬çš„ php ä¹ŸåŒ…å«äº† nginxï¼Œæ˜¯çš„

> Q18ï¼šsidecar æ–¹å¼æ”¶é›†æ—¥å¿—ä¼šå‡ºçŽ°å»¶æ—¶ï¼Œç‰¹åˆ«æ˜¯ä¸¢å¤±é—®é¢˜ï¼Œè¿™ä¸ªå¦‚ä½•è§£å†³å‡å°‘ filebeat çš„é‡‡é›†æ—¶é—´ï¼Œè¿™ä¸ªæˆ‘æ„Ÿè§‰æ— è§£ã€‚æˆ–è€…åœ¨ gracefultime ä¸Šåšæ–‡ç« ï¼Œè®© filebeat å¤šæ´»ä¸€ä¼š

> Q19 é›†ç¾¤åŽ‹æµ‹æ–¹é¢å¯ä»¥ä»‹ç»ä¸€ä¸‹ä¹ˆï¼Œk8s å®˜æ–¹çš„ benchmark å·¥å…·ï¼Ÿå®˜æ–¹çš„ç”¨äº†ï¼Œä½†æ˜¯å¾ˆé¸¡è‚‹ï¼Œè¿™å—æˆ‘ä»¬çš„å»ºè®¾å¾ˆä¸å¤Ÿ

> Q20 ä¸ºä»€ä¹ˆåªç»™ sts åšå›ºå®š ip å‘¢ï¼Ÿ

---

### 2020-02-25ï¼šKubernetes åœ¨å–œé©¬æ‹‰é›…çš„å®žè·µï¼šæµ‹è¯•çŽ¯å¢ƒç¨³å®šæ€§

> Q1 æµ‹è¯•çŽ¯å¢ƒåªæ˜¯å¼€å‘è‡ªå·±ç”¨å—ï¼Ÿå¼€å‘å’Œæµ‹è¯•å…±ç”¨ä¸€ä¸ªæµ‹è¯•çŽ¯å¢ƒå§ï¼Ÿ

Aï¼šå¼€å‘æµ‹è¯•å¥½äº†ä¹‹åŽï¼Œé’‰é’‰æ²Ÿé€šï¼Œå“ªä¸ªéš”ç¦»ç»„ä¿¡æ¯çš„ã€‚åŒæ­¥ä¸€ä¸‹è¿™ä¸ªä¿¡æ¯å°±å¥½äº†å“ˆ

> Q2ï¼šéš”ç¦»ç»„å’Œ git åˆ†æ”¯æ˜¯ä¸€ä¸€å¯¹åº”å—ï¼Œå¦‚ä½•å…³è” git åˆ†æ”¯ã€éš”ç¦»ç»„å’Œ pod ç‰ˆæœ¬

Aï¼šéš”ç¦»ç»„å’Œ git åˆ†æ”¯æ˜¯ä¸€ä¸€å¯¹åº”å—ï¼Ÿä¸ä¸€å®šï¼Œå¤§éƒ¨åˆ†åœºæ™¯ä¸‹é¢æ˜¯ä¸€è‡´çš„ã€‚git åˆ†æ”¯ã€éš”ç¦»ç»„å’Œ pod ç‰ˆæœ¬è¿™äº›ä¿¡æ¯ä¼šä»¥çŽ¯å¢ƒå˜é‡çš„å½¢å¼æ³¨å…¥åˆ°å®¹å™¨é‡Œé¢ï¼Œæˆ‘ä»¬è¿™æœ‰ä¸€ä¸ª agent å®¹å™¨ï¼Œå°†è¿™äº›ä¿¡æ¯åŒæ­¥ã€‚

> Q3ï¼šk8s é›†ç¾¤çš„å®¹å™¨ç½‘ç»œæ˜¯æ€Žä¹ˆç»„æˆçš„å‘¢

Aï¼šæµ‹è¯•çŽ¯å¢ƒä½¿ç”¨çš„æ˜¯æœ€ç®€å•çš„ macvlanï¼Œuatã€çº¿ä¸Šç”¨çš„ calico

> Q4ï¼šè¯·é—®ä¸‹å–œé©¬æ‹‰é›…çŽ°åœ¨è¿ç»´å›¢é˜Ÿå¤§æ¦‚æ˜¯å¤šå°‘äºº,k8s è§„æ¨¡èƒ½å¤§æ¦‚è¯´ä¸€ä¸‹å—  K8s çŽ¯å¢ƒæ˜¯è‡ªå»ºçš„è¿˜æ˜¯é€‰æ‹©å…¬æœ‰äº‘çš„ æ˜¯åŸºäºŽä»€ä¹ˆæ ·çš„è€ƒè™‘

Aï¼šè¿ç»´å›¢é˜Ÿæ¯”è¾ƒç²¾ç®€ï¼Œäººæ•°åœ¨ä¸ªä½æ•°ã€‚ä¹‹å‰éƒ½æ˜¯åªæœ‰ä¸€ä¸ªå¤§ä½¬ç»´æŠ¤ã€‚k8s åœ¨æµ‹è¯•çŽ¯å¢ƒå’Œ uat è‡ªå»ºï¼Œçº¿ä¸Šå…¬æœ‰äº‘ã€‚åŸºäºŽä»€ä¹ˆæ ·çš„è€ƒè™‘ï¼Ÿè¿™ä¸ªå¾—è¿ç»´å¤§ä½¬æ¥è§£é‡Šäº†

> Q5ï¼šæ‚¨çš„éš”ç¦»ç»„è®¿é—®çš„åˆ†é…æ˜¯ç”¨çš„ä»€ä¹ˆæŠ€æœ¯ï¼Œistio è¿˜æ˜¯ nginx ingress æˆ–è€…å…¶ä»–ï¼Ÿè¿˜æœ‰ cmdb-docker æ˜¯ cmdb çš„ä¸€éƒ¨åˆ†å—ï¼Ÿéžå¸¸æ„Ÿè°¢

Aï¼šistio å’Œ nginx ingress æš‚æ—¶è¿˜æ²¡æœ‰ä½¿ç”¨ï¼Œè·¯ç”±çš„æ–¹å¼æ¯”è¾ƒä¼ ç»Ÿï¼Œä½¿ç”¨ç½‘å…³ + å¾®æœåŠ¡æ¡†æž¶çš„è·¯ç”±åŠŸèƒ½ã€‚è¯·æ±‚ç›´æŽ¥æ‰“åˆ° nginxï¼Œè½¬å‘ç»™ç½‘å…³ã€‚å°†éš”ç¦»ç»„ä¿¡æ¯æ³¨å…¥åˆ°è¯·æ±‚é‡Œé¢ã€‚cmdb-docker æ˜¯ cmdb çš„ä¸€éƒ¨åˆ†å—ï¼Ÿå’Œ cmdb å¹¶è¡Œçš„å…³ç³»ï¼Œç”¨äºŽå®¹å™¨æœåŠ¡çš„å‘å¸ƒï¼Œè¯´æˆ cmdb ä¹Ÿæ²¡å•¥é”™ã€‚service mesh å·²ç»åœ¨è½åœ°ä¸­ï¼ŒåŽé¢çš„åŒ–åº”è¯¥ä¼šå¯¹ mesh åŒ–çš„çŽ¯å¢ƒè¿›è¡Œéš”ç¦»ç­–ç•¥çš„è°ƒæ•´ï¼Œä¸»è¦çš„è¿˜æ˜¯è·¯ç”±é…ç½®ç›¸å…³çš„

> Q6:å¯¹äºŽå¤šé›†ç¾¤ä½ ä»¬æ€Žä¹ˆç®¡ç†å‘¢ï¼Œä¾‹å¦‚å®‰è£…ï¼Œç›‘æŽ§ï¼Œæ—¥å¸¸ç»´æŠ¤ï¼Œä¸åŒä¸šåŠ¡ä¼šæ€Žä¹ˆéš”ç¦»

Aï¼šè¿™ä¸ªé—®é¢˜å¤ªè¿ç»´äº†ï¼Œæˆ‘è¯·æ•™ä¸€ä¸‹è¿ç»´å¤§ä½¬ï¼Œå†æ¥å›žå¤

> Q7ï¼šæ‚¨é‚£è¾¹æœ‰æ²¡æœ‰è°ƒç ”è¿‡ rancher æˆ–è€… kubesphere ç­‰å…¶ä»–å®¹å™¨ç®¡ç†å¹³å°

Aï¼šæœ‰ç ”ç©¶è¿‡ï¼Œä½†æ˜¯æ²¡æœ‰å¼•ç”¨

> Q8ï¼šè¯·é—®å¾®æœåŠ¡ç›‘æŽ§å…·ä½“æ€Žä¹ˆå®žæ–½ï¼Ÿ

Aï¼šå¾®æœåŠ¡çš„ç›‘æŽ§è¿™ä¸ªå°±æ¶‰åŠåˆ°äº†å¾®æœåŠ¡æ–¹é¢çš„é—®é¢˜äº†ï¼Œå…·ä½“çš„å®žçŽ°å¯ä»¥å‚è€ƒ hystrix é‡Œé¢çš„ç»Ÿè®¡å®žçŽ°ï¼Œæœ¬äººæ²¡å‚ä¸Žè¿‡è¿™æ–¹é¢çš„å¼€å‘å“ˆ

> Q9ï¼šè¿™ä¸ªæµ‹è¯•çŽ¯å¢ƒæ˜¯ä¸æ˜¯æµ‹è¯•å·¥ç¨‹å¸ˆå’Œå¼€å‘å·¥ç¨‹å¸ˆå…±ç”¨çš„ï¼Œåªè¦å¼€å‘éƒ¨ç½²æˆåŠŸï¼Œæµ‹è¯•å°±å¯ä»¥å¼€å§‹éªŒè¯äº†ï¼Ÿ

Aï¼šæ˜¯çš„

> Q10ï¼šè¯·æ•™ä¸€ä¸‹ï¼šç›®å‰å–œé©¬æ‹‰é›…çš„æ¯ä¸ªå®¹å™¨é›†ç¾¤è§„æ¨¡æœ‰å¤šå¤§ï¼Ÿæ˜¯è¿è¡Œåœ¨ç‰©ç†æœºä¸Šè¿˜æ˜¯è™šæ‹ŸåŒ–å¹³å°ä¸Šå‘¢ï¼Ÿ

Aï¼šæ¯ä¸ªå®¹å™¨é›†ç¾¤è§„æ¨¡ 100+ï¼Œç‰©ç†æœº

> Q11: æ•´ä¸ªå¹³å°ä½¿ç”¨çš„å®¹å™¨ç½‘ç»œæ˜¯ä»€ä¹ˆï¼Ÿ ç›®å‰æµ‹è¯•å¹³å°æ˜¯å¦äº¤ç»™å…¬å¸çš„ç‹¬ç«‹çš„è¿ç»´éƒ¨é—¨è¿ç»´ï¼Œè¿˜æ˜¯è¿ç»´å·²ç»å®žçŽ° DevOps äº†ï¼Ÿ

A: ç½‘ç»œï¼šæµ‹è¯•çŽ¯å¢ƒ macvlanï¼Œuatã€pro calicoã€‚äº¤ç»™è¿ç»´ç®¡ç†ã€‚

> Q12: å¦‚æžœæ”¯æŒ canary deploymentï¼Œä¸¤ä¸ªç‰ˆæœ¬çš„è½¯ä»¶æ˜¯æ€Žä¹ˆä¿æŒ session-sticky çš„ï¼Ÿæ˜¯åœ¨
> APIGateway å®žçŽ°çš„ä¹ˆï¼Ÿ

A: æ˜¯çš„

> Q13ï¼šä½ ä»¬ç”¨çš„æ˜¯ä»€ä¹ˆå¾®æœåŠ¡æ¡†æž¶ï¼Ÿæµé‡åˆ°äº† stable çŽ¯å¢ƒä¹‹åŽæ€Žä¹ˆçŸ¥é“è¦å›žè°ƒåˆ° feature çŽ¯å¢ƒï¼Ÿéœ€è¦åœ¨å¾®æœåŠ¡æ¡†æž¶æ³¨å…¥ç›¸å…³ä»£ç å—ï¼Ÿ

---

### 2020-01-07ï¼šç”µè§†äº‘æœåŠ¡çš„å®¹å™¨åŒ–å®žè·µ

[æé—®é“¾æŽ¥](https://shimo.im/docs/PvCx8HcKPXPjdhHd)

> Q1ï¼šå¾®æœåŠ¡ä»£ç†ï¼Œèƒ½è¯¦ç»†è¯´è¯´å˜›ï¼Ÿ

Aï¼šä¸€èˆ¬ä¸¤ä¸ªä½œç”¨ï¼Œç»Ÿä¸€æœåŠ¡åœ°å€å’Œè´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥ç”¨ LVS + Nginx ã€‚åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ä¸­ï¼Œæœ‰äº›ä¸šåŠ¡é€»è¾‘è§£è€¦ç»™äº†ä»£ç†æœåŠ¡ï¼ˆç»Ÿä¸€ç½‘å…³ï¼‰ï¼Œæ¯”å¦‚ JWT ç”¨æˆ·ç»Ÿä¸€è®¤è¯ç­‰ç­‰ï¼Œè¿˜æœ‰ä¸€äº›æ¶‰åŠä¸šåŠ¡é€»è¾‘çš„ï¼Œæ¯”å¦‚ç”µè§†æŠ¢çº¢åŒ…ï¼Œç”¨éšæœºç®—æ³•åªå°†ä¸€éƒ¨åˆ†æµé‡æ”¾åˆ°åŽç«¯ï¼Œè¿›è€Œä½¿ç”¨äº† OpenResty/Lua ç»„åˆã€‚

> Q2ï¼šç›‘æŽ§ä½¿ç”¨çš„å•¥ï¼Ÿ

Aï¼šå½“å‰ç›‘æŽ§ä½¿ç”¨ sysinner/innerstack å†…ç½®çš„ç›‘æŽ§åŠŸèƒ½ï¼ŒåŸºäºŽ docker/sdk-golang å’Œ leveldb-go, ç»“åˆä¸€äº›å‰ç«¯å¼€å‘å·¥ä½œï¼ˆä¸»è¦æ˜¯ chart å±•çŽ°ï¼‰

> Q3ï¼šå¾®æœåŠ¡æ”¹åŠ¨æ—¶ï¼Œä»£ç†æ˜¯å¦‚ä½•æ„ŸçŸ¥çš„ï¼Ÿæ˜¯å¦è¦é¢‘ç¹é‡å¯ä»£ç†ï¼Ÿè¿™ä¸€å—æ˜¯æ€Žä¹ˆå®žçŽ°çš„?

Aï¼šå¾®æœåŠ¡æ”¹åŠ¨ï¼Œå…ˆå°†é…ç½®æŽ¨é€åˆ°ä»£ç†æœåŠ¡ï¼Œå†æ“ä½œå®¹å™¨ï¼ŒLVS å’Œ Nginx/OpenResty å˜æ›´é…ç½®ä¸éœ€è¦é‡å¯ï¼Œå½“ç„¶è¿™ä¸ªåœ°æ–¹ä¹Ÿéœ€è¦å®¹å™¨åº”ç”¨é…åˆï¼Œé¿å…å®¹å™¨ä¹‹é—´ç›´æŽ¥é€šä¿¡ã€‚

> Q5ï¼šlxcfs éƒ¨åˆ†çš„è¯´æ˜Žç¼ºå¤±ï¼Œä½ ä»¬æ˜¯æ€Žä¹ˆå¤„ç†å®¹å™¨å†…è¯»å– cpu memory ä¸€äº›æŒ‡æ ‡åè€Œè¯»å–åˆ°å®¿ä¸»æœºé…ç½®çš„å‘¢ï¼Ÿ(ç›®å‰å·²çŸ¥ JDK8 131 ä¹‹å‰ä¹Ÿå­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå¦å¤–å¯ä»¥é€šè¿‡ä¿®æ”¹æ–‡ä»¶ç³»ç»ŸèŽ·å–åˆ°æ­£ç¡®æŒ‡æ ‡)å¸Œæœ›å¾—åˆ°è§£ç­”ï¼Œè°¢è°¢ã€‚

Aï¼šlxcfs éƒ¨åˆ†æˆ‘ä»¬æ˜¯å‚è€ƒäº† pouch-container é‡Œé¢çš„æ–¹æ¡ˆï¼Œåªä¸è¿‡æ˜¯åˆ›å»ºå®¹å™¨æ—¶æŠŠ lxcfs åŒ…å«çš„ç›®å½• mount åˆ°å®¹å™¨ä¸­å³å¯

> Q6ï¼šä½¿ç”¨ XFS é™åˆ¶å®¹å™¨æŒ‚è½½çš„ç›®å½•å¤§å°å…·ä½“æ˜¯æ€Žä¹ˆåšçš„å‘¢ï¼Ÿèƒ½å¦è¯´ä¸‹æ€è·¯å’Œç›¸å…³å‚è€ƒ

Aï¼šä¸€èˆ¬å‰ç«¯ä¸šåŠ¡ï¼Œå®¹å™¨æŒ‚è½½ç›®å½•åªå­˜æ”¾æ—¥å¿—ï¼Œ10GB å·¦å³ã€‚åŽç«¯æ¶‰åŠåˆ°æ•°æ®æŒä¹…çš„åº”ç”¨ï¼Œæ¯”å¦‚ MySQL ï¼ŒSSDB è¿™ä¸ªæŒ‰ç…§ä¸šåŠ¡é¢„ä¼°ï¼Œä¸€èˆ¬ 50 ~ 500 GB ã€‚å…·ä½“å¯ä»¥æœç´¢ "xfs quota , project quota"

> Q7ï¼šä½ ä»¬çº¿ä¸ŠåŸºäºŽ Docker å•èŠ‚ç‚¹éƒ¨ç½²æœåŠ¡å—ï¼Ÿ

Aï¼šå•èŠ‚ç‚¹æœ‰æµ‹è¯•æœåŠ¡å™¨ï¼›å…¶å®žå•ç»“ç‚¹å’Œé›†ç¾¤å¯¹äºŽ docker çš„æ“ä½œæ—¶ä¸€æ ·çš„

> Q8ï¼šæœ‰æ²¡æœ‰æ ¹æ®ä¸šåŠ¡è´Ÿè½½æ¥æ“ä½œå®¹å™¨ä¼¸ç¼©ï¼ˆå¢žå‡ï¼‰çš„åŠŸèƒ½

Aï¼šæœ‰ï¼Œæ¯”å¦‚å…ƒæ—¦ã€æ˜¥èŠ‚å‰æœŸï¼ŒæŒ‰ç…§é¢„ä¼°æ‰©å®¹ VPS æ—¶ï¼Œä¼šé¢„ç•™éƒ¨åˆ†èµ„æºï¼Œæ­£å¼ä¸Šçº¿è¿è¡Œä¸­å¦‚æžœæœ‰æ¨¡å—è´Ÿè½½é«˜ï¼Œä¼šå®žæ—¶æŠŠè¿™ä¸ªæ¨¡å—æŽ¨é€åˆ°é¢„ç•™èµ„æºï¼›å¦‚æžœæ²¡æœ‰å¯Œä½™æœºå™¨äº†ï¼Œå°±æŒ‰ç…§ä¼˜å…ˆçº§æŠŠéƒ¨åˆ†æ¨¡å—é™çº§æœåŠ¡

> Q9ï¼šCPU é™åˆ¶è¿™ä¸€å—èƒ½ç»†è¯´ä¸€ä¸‹å—ï¼Ÿè²Œä¼¼ç”¨çš„æ›´å¤šçš„æ˜¯ CPUshareï¼Ÿ

Aï¼šæ¯”å¦‚ç»™ä¸€ä¸ªå®¹å™¨ 2 cores èµ„æºï¼Œåˆ™ --cpu-period=1000000 --cpu-quota=20000000 --cpusets-cpus=0,1 (cat /proc/cpuinfo)

> Q10ï¼šå¯ä»¥é—®ä¸€ä¸‹è§†é¢‘å­˜å‚¨ç”¨ä»€ä¹ˆï¼Œè¿˜æœ‰æœç´¢æœåŠ¡ç”¨ä»€ä¹ˆæœç´¢å¼•æ“Žï¼Œè¿˜æœ‰å‘å¸ƒç‰ˆæœ¬çš„æ—¶å€™ï¼Œæ•°æ®åº“ç»“æž„æ›´æ”¹æ€Žä¹ˆåšåˆ°ä¸åœæœºæ›´æ–°çš„ï¼Œä½œä¸ºä¸€ä¸ªå°ç™½æˆ‘å¾ˆå¥½å¥‡

Aï¼šè§†é¢‘å­˜å‚¨ç”¨ä¼ ç»Ÿä¼ä¸šç›˜æŸœï¼› æœç´¢ç”¨ sphinxsearch + å®šåˆ¶ä¿®æ”¹ï¼›æ•°æ®åº“ä¸€èˆ¬å‡†å¤‡ä¸¤å¥—ï¼Œå¦‚æžœå‡çº§æ¶‰åŠæ•°æ®åº“å˜æ›´ï¼ˆå¯èƒ½é”è¡¨ï¼‰ï¼Œåˆ™æ˜¯æš‚åœå†™ä¸šåŠ¡ï¼Œå†æ“ä½œ ï¼ˆè¿™ä¸ªæœŸé—´æŸ¥è¯¢ä¸šåŠ¡ä¸å—å½±å“ï¼‰

> Q11:å…¬æœ‰äº‘çš„æµåª’ä½“è§†é¢‘èµ„æºæ€Žä¹ˆåšåˆ°ä½Žå»¶æ—¶é«˜å¸¦å®½åˆ†å‘åˆ°ä¸åŒåœ°åŸŸçš„ç»ˆç«¯ä¸Šçš„çš„ï¼Œå¤šåœ°éƒ¨ç½²ã€è¿è¥å•†ä¸“çº¿ï¼Ÿ

Aï¼š è¿™ä¸ªå½“ç„¶æ˜¯å…¬æœ‰äº‘æœåŠ¡å•† CDN

---

### 2020-01-02 ï¼šä¸ºä½ å†™è¯—ï¼š3 æ­¥æ­å»º Serverless AI åº”ç”¨

[æé—®é“¾æŽ¥](https://shimo.im/docs/WjgJJR3pTQKyYDJj)

> Q1ï¼šè¿™ä¸ª FUNCRAFT æ˜¯ ALI YUN å®šåˆ¶çš„å—ï¼Ÿæœ‰æ²¡æœ‰å¯ä»¥é‡åŒ–å¯ä»¥è¯´æ˜Žçš„æ”¯æŒå¹¶å‘è®¡ç®—é‡çš„å†…å®¹å‘¢?æˆ‘ç†è§£æ˜¯é€šè¿‡ API å±è”½äº†å®¹å™¨å’Œ ECS å¯¹å—ï¼Ÿ

A1ï¼šFuncraft æ˜¯ aliyun å‡½æ•°è®¡ç®—è‡ªå·±å¼€å‘çš„å·¥å…·ã€‚å‡½æ•°è®¡ç®—çš„é»˜è®¤æœ€å¤§å¹¶å‘åº¦æ˜¯ 100ï¼ˆæ›´é«˜çš„å€¼éœ€è¦å¼€å·¥å•ï¼‰ï¼Œæ¯ç§’è¯·æ±‚æ•° * è¯·æ±‚å¤„ç†æ—¶é—´ï¼ˆç§’ï¼‰ = æœ€å¤§å¹¶å‘åº¦ï¼Œ æ›´å¤šç»†èŠ‚å¯ä»¥å‚è€ƒ[å‡½æ•°è®¡ç®—çš„æ–‡æ¡£](https://help.aliyun.com/knowledge_detail/56103.html?spm=a2c4g.11186623.6.739.1958265ayXAmXW#concurrency-limit) ã€‚å‡½æ•°è®¡ç®—ä¸ä»…ä»…å±è”½äº†å®¹å™¨å’Œ ECS è¿™äº›è®¡ç®—èµ„æºï¼Œè¿˜å±è”½äº†è´Ÿè½½å‡è¡¡ï¼Œè‡ªåŠ¨ä¼¸ç¼©ï¼Œç½‘ç»œèµ„æºå’Œå…±äº«å­˜å‚¨ç­‰ä¸€ç³»åˆ—çš„åŸºç¡€è®¾ç½®ï¼Œæ‰€ä»¥æ‰è¢«ç§°ä½œ Serverlessã€‚

> Q2ï¼šé¢„ç•™èµ„æºçš„å‡½æ•°è®¡ç®—ä¸å°±å’Œå¼¹æ€§å®¹å™¨ä¸€æ ·äº†å—ï¼Ÿé‚£ä¹ˆå‡½æ•°è®¡ç®—çš„æœ€å¤§ä¼˜åŠ¿å¹¶ä¸èƒ½ä½“çŽ°å‡ºæ¥?

A2: é¢„ç•™å’ŒæŒ‰é‡æ˜¯å¯ä»¥ç»“åˆä½¿ç”¨çš„ã€‚çœŸå®žä¸šåŠ¡çš„è´Ÿè½½å¾€å¾€æ˜¯æœ‰åŸºç¡€çš„éƒ¨åˆ†å’Œå˜åŒ–çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥å‡½æ•°è®¡ç®—æŽ¨å‡ºé¢„ç•™å¯ä»¥ä»¥æ›´ä½Žçš„æˆæœ¬æ¥å¤„ç†æŽ‰é‚£åŸºç¡€ä¸å˜éƒ¨åˆ†çš„è´Ÿè½½ã€‚å½“ç„¶å¼¹æ€§å®¹å™¨ä¹Ÿå¯ä»¥å¤„ç†åŸºç¡€éƒ¨åˆ†ã€‚ä½†æ˜¯å¦‚æžœè®©ç”¨æˆ·æŠŠåº”ç”¨éƒ¨ç½²æˆå¼¹æ€§å®¹å™¨å’Œå‡½æ•°è®¡ç®—ç›¸ç»“åˆå½¢å¼ï¼Œé‚£å¯¹åº”ç”¨çš„æž¶æž„è¦æ±‚ä¼šæ¯”è¾ƒé«˜ï¼Œæ‰€ä»¥é¢„ç•™å’ŒæŒ‰é‡çš„ç»“åˆçš„å½¢å¼ä¹Ÿå¯ä»¥é™ä½Žç”¨æˆ·çš„ä½¿ç”¨é—¨æ§›ã€‚

> Q3: åœ¨åšå¾®æœåŠ¡å¼€å‘æœ¬èº«å°±æ˜¯æŠŠå„ç±»åº”ç”¨é€»è¾‘æŽ¥å£åŒ–!è¿™ä¸ªå‡½æ•°å¼è®¡ç®—æ˜¯å¦å°±æ˜¯å¾®æœåŠ¡çš„å…ˆå†³çŽ¯èŠ‚å‘¢ï¼Ÿ

A3: å‡½æ•°è®¡ç®—ä¹Ÿå¯ä»¥ç†è§£ä¸ºå¾®æœåŠ¡çš„ä¸€ç§å½¢å¼ã€‚æœ‰äººè®¤ä¸º FaaS æ˜¯ä¸‹ä¸€ä»£çš„å¾®æœåŠ¡ã€‚å¾®æœåŠ¡ç›¸å¯¹äºŽå•ä½“æœåŠ¡æ¥è¯´ï¼Œè§£å†³äº†ä¸¤æ–¹é¢çš„é—®é¢˜ã€‚ä¸€æ–¹é¢ï¼Œä¸åŒä¸šåŠ¡æ¨¡å—æœ‰æ›´æ¸…æ™°çš„è¾¹ç•Œï¼Œä¸åŒæ¨¡å—æ”¯æŒä»¥ä¸åŒé€Ÿåº¦è¿›è¡Œè¿­ä»£ã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œä¸åŒéƒ¨ç½²æ¨¡å—çš„è´Ÿè½½å’Œå¯¹ç¨³å®šæ€§çš„è¦æ±‚ä¸åŒï¼Œå¯ä»¥æ›´ç»†ç²’åº¦çš„åŽ»è°ƒèŠ‚ä¸åŒæ¨¡å—çš„å®žä¾‹ä¸ªæ•°ã€‚è€Œå‡½æ•°è®¡ç®—ï¼ˆFaaSï¼‰é‡‡ç”¨äº†æŒ‰é‡æˆ–è€…æŒ‰ç…§è¯·æ±‚è¿›è¡Œè°ƒåº¦çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ FaaS å¹³å°ä¸‹ï¼Œå¦‚æžœæŸäº›ä¸šåŠ¡æ¨¡å—æ²¡æœ‰è®¿é—®é‡ï¼Œå®žä¾‹ä¸ªæ•°å¯ä»¥æ”¶ç¼©åˆ°é›¶ã€‚è™½ç„¶å¾®æœåŠ¡æž¶æž„ä¹Ÿèƒ½å¼¹æ€§æ”¶ç¼©ï¼Œä½†æ˜¯æ²¡æ³•æ”¶ç¼©åˆ°é›¶ã€‚ç†è®ºä¸Š FaaS è¿›ä¸€æ­¥æé«˜èµ„æºçš„åˆ©ç”¨çŽ‡ã€‚

> Q4: å¯¹äºŽæ•°æ®é¢ä¸ŽæŽ§åˆ¶é¢åˆ†å¼€ funcraft æœ‰æ²¡æ›´å¥½çš„ç†è§£å‘¢?(æŒ‡çš„æ˜¯å‡½æ•°å¼è®¡ç®—æŽ¥å£æ˜¯åªè€ƒè™‘æ—¶å»¶ï¼Œé€Ÿåº¦ä»¥åŠæˆæœ¬ï¼Œè¿˜æ˜¯æœ‰ä»Žæ•°æ®å’ŒæŽ§åˆ¶å±‚é¢æ•´ä½“ä¼˜åŒ–è€ƒè™‘çš„å‘¢)è°¢è°¢!

A4:  funcraft åªæ˜¯å‡½æ•°è®¡ç®—çš„å·¥ç¨‹å·¥å…·ï¼Œä¸€ä¸ªå‘½ä»¤è¡Œè€Œå·²ã€‚å‡½æ•°è®¡ç®—å¹³å°æ˜¯æœ‰åˆ†æ•°æ®å¹³é¢å’ŒæŽ§åˆ¶å¹³é¢çš„ã€‚æŽ§åˆ¶å¹³é¢åˆæœ‰ç»†åˆ†ï¼Œç”¨æˆ·å¯æ“ä½œçš„å’Œå¹³å°å¯æ“ä½œçš„ã€‚å‡½æ•°è®¡ç®—æš´éœ²ç»™ç”¨æˆ·çš„æŽ§åˆ¶æ¯”è¾ƒå°‘ï¼Œæ¯”å¦‚æ‰©ç¼©å®¹æ˜¯è‡ªåŠ¨çš„ï¼Œä¸éœ€è¦ç”¨æˆ·å¹²é¢„ã€‚

> Q5: FaaS åœºæ™¯ä¸‹æ–‡ä»¶è¿‡å¤§é—®é¢˜,å…·ä½“æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿ

A5: FaaS ä¸ºäº†è¾¾åˆ°ç™¾æ¯«ç§’çš„å»¶æ—¶ï¼Œä¼šè¦æ±‚åº”ç”¨çš„æ‰“åŒ…ä¸å¤§äºŽ 50Mï¼Œè¿™ä¸ªé™åˆ¶ä¼šå½±å“åˆ°å¾ˆå¤šåº”ç”¨ï¼Œæ¯”å¦‚ Python è£…ä¸€ä¸ª Tenserflow å°±ä¸Šç™¾ Mï¼Œjava éšä¾¿æžä¸ª web åº”ç”¨ä¹Ÿå¯ä»¥å¤§å‡ å Mã€‚æˆ‘ä»¬é€šè¿‡å°† FC å’Œ NAS æœåŠ¡ç»“åˆï¼ŒæŠŠä¸€éƒ¨åˆ†åº“å’Œæ•°æ®æ”¾åˆ°äº† NAS ä¸Šï¼Œç„¶åŽè¿è¡Œæ—¶åŠ è½½ï¼Œä»¥è§£å†³å¤§æ–‡ä»¶åŒ…å†·å¯åŠ¨è¿‡æ…¢çš„é—®é¢˜ã€‚

---

### 2019-12-26ï¼šå¦‚ä½•åœ¨ Kubernetes ä¸­ç¼–å†™è‡ªå®šä¹‰æŽ§åˆ¶å™¨

[æé—®é“¾æŽ¥](https://shimo.im/docs/RCj3QYjQcjxJQhrC)

> Q1ï¼šcrd å¦‚ä½•è§£å†³éªŒè¯å‚æ•°åˆæ³•æ€§çš„é—®é¢˜ï¼Ÿ

Aï¼šè¿™ä¸ªçŸ¥è¯†ç‚¹ä¹Ÿæ˜¯æœ¬æ–‡æ¬ ç¼ºçš„ï¼Œå¯ä»¥é€šè¿‡ Open API v3 schema è¿›è¡ŒéªŒè¯

> Q2ï¼šyaml æ–‡ä»¶å¦‚æžœæœ€å°åŒ–å±•ç¤º

Aï¼škubernetes æœ‰å¾ˆå¤šé»˜è®¤å±žæ€§çš„ï¼Œè¿™éœ€è¦å…·ä½“æŸ¥æ–‡æ¡£å‘€

> Q3ï¼šoperator æœ¬èº«æŒ‚äº†æ€Žä¹ˆåŠžï¼Ÿä¾èµ–å…¶ä»–ç³»ç»Ÿé‡æ–°è°ƒåº¦å—ï¼Ÿ

Aï¼šoperator æœ¬èº«è¦æ˜¯æŒ‚äº†ï¼Œè‡ªå®šä¹‰èµ„æºçš„æŽ§åˆ¶å™¨æ˜¯ä¸èƒ½å·¥ä½œçš„ï¼Œè¿™æ—¶å…¶ä»–çš„è°ƒåº¦ç³»ç»Ÿä¹Ÿä¸èƒ½ä»£æ›¿çš„

> Q4ï¼šæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ç›‘æŽ§å¹¶ä¿å­˜ pod çš„ cpuï¼Œmem ä½¿ç”¨æƒ…å†µï¼Œå¹¶å°†ä»–ä»¬ä¿å­˜å…¥æ•°æ®åº“æˆ–è€…ç”Ÿæˆ cvs æ–‡ä»¶ï¼Ÿ

Aï¼šprometheusï¼Œå¯ä»¥çœ‹çœ‹ prometheus operator

> Q5ï¼šæ€Žä¹ˆè§£å†³ crd å‡çº§çš„é—®é¢˜ï¼Œæ¯”å¦‚æ›´æ”¹å­—æ®µï¼Œä½†æ˜¯å·²æœ‰æœåŠ¡å·²ç»è¿è¡Œ

Aï¼šè¿™æ˜¯ kubernetes çš„æŽ§åˆ¶å™¨é€šè¿‡èŽ·å–èµ„æºèµ„æºçš„å®žé™…è¿è¡ŒçŠ¶æ€ä¸ŽæœŸæœ›çš„çŠ¶æ€å¯¹æ¯”ï¼Œå¦‚æžœä¸ç›¸åŒåˆ™åˆ é™¤è€çš„ pod ç„¶åŽæ‹‰èµ·æœŸæœ›çš„ pod

> Q6ï¼šå‡å¦‚æˆ‘æƒ³é€šè¿‡ cpu è´Ÿè½½çš„é¢„æµ‹å€¼æ”¹å˜ pod æ•°é‡ï¼Œæˆ‘å¦‚ä½•å°†é¢„æµ‹å‡½æ•°åŠ å…¥è‡ªå®šä¹‰æŽ§åˆ¶å™¨ï¼Œä»Žè€Œæ”¹å˜ pod æ•°é‡ï¼Ÿ

Aï¼šç†è®ºä¸Šè®²è¿™éƒ¨åˆ†é€»è¾‘å†™åˆ°æŽ§åˆ¶å™¨çš„ reconcile å‡½æ•°ä¸­æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯æˆ‘è§‰å¾—æ›´åº”è¯¥ä»Žè°ƒåº¦ç­–ç•¥ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå³åœ¨è°ƒåº¦æ—¶é€šè¿‡ç­–ç•¥é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹ã€‚

> Q7ï¼šæŽ¥ç€ä¸Šé¢é—®é¢˜ï¼Œæ”¹å˜ pod æ•°é‡æ—¶ï¼Œå¯å¦é€šè¿‡å‡½æ•°åˆ¤æ–­ï¼Œå…ˆä½¿ç”¨åž‚ç›´ä¼¸ç¼©åœ¨è¿›è¡Œæ°´å¹³ä¼¸ç¼©ï¼Œé‚£è¯·é—®å¦‚ä½•å®žçŽ°åž‚ç›´ä¼¸ç¼©ï¼Ÿ

Aï¼šä¸çŸ¥ä½ è¯´çš„åž‚ç›´ä¼¸ç¼©æ˜¯ä¸æ˜¯æ„å‘³ç»™ pod åˆ†é…æ›´å¤šçš„èµ„æºã€‚å¦‚æžœæ˜¯å¯ä»¥é€šè¿‡è‡ªç¼–æŽ§åˆ¶æ—¶å®šä¹‰èµ„æºå±žæ€§ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰å¯¹åº”çš„èµ„æºå±žæ€§å®žçŽ°åž‚ç›´ä¼¸ç¼©

> Q9ï¼šèƒ½å¦è®²è§£ä¸‹ reflector å…·ä½“å·¥ä½œåŽŸç†

Aï¼šå¤§è‡´ä¸ºä¸‹é¢ï¼š1. é€šè¿‡åå°„å™¨å®žçŽ°å¯¹æŒ‡å®šç±»åž‹å¯¹è±¡çš„ç›‘æŽ§ 2. DeltaFiFo é˜Ÿåˆ—ï¼Œå°†ä¸Šä¸€æ­¥ç›‘æŽ§åˆ°æœ‰å˜åŒ–çš„å¯¹è±¡åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ 3.å¹¶å°†é˜Ÿåˆ—ç¼“å­˜åˆ°æœ¬åœ°ï¼Œå¹¶æ ¹æ®äº‹ä»¶ç±»åž‹æ³¨å†Œç›¸åº”çš„äº‹ä»¶ 4. æœ€åŽå°†å¯¹è±¡ pop åˆ° work queue ä¾› control loop è§¦å‘ä¸Šä¸€æ­¥æ³¨å†Œçš„äº‹ä»¶å‡½æ•°

> Q10ï¼šè§¦å‘æ›´æ–°äº‹ä»¶æ—¶ï¼Œä»£ç é‡Œå¦‚ä½•èŽ·å–åˆ° cr æ›´æ–°ä¹‹å‰çš„çŠ¶æ€ï¼Ÿ

Aï¼šé€šè¿‡åŒ… k8s.io/api/core/v1

> Q12: å¦‚ä½•åœ¨ä¸€ä¸ªå¯¹è±¡æŽ§åˆ¶å™¨çš„ eventHander ä¸­è§¦å‘å¦å¤–ä¸€ä¸ªèµ„æº controller çš„ Reconcile å…¥é˜Ÿå‘¢?

Aï¼š ç†è®ºä¸Š kubernetes æŽ§åˆ¶å™¨æ˜¯åœ¨ç›‘æµ‹åˆ°èµ„æºçš„åˆ›å»º/æ›´æ–°/åˆ é™¤äº‹ä»¶åŽï¼Œä¼šè‡ªåŠ¨åŽ»è§¦å‘ reconcile å‡½æ•°ã€‚æˆ‘è§‰å¾—æˆ‘ä»¬åš kubernetes äºŒæ¬¡å¼€å‘é¦–å…ˆè¦éµå¾ª kubernetes çš„ç¼–ç¨‹è§„èŒƒå‘€

---

### 2019-12-19ï¼šé˜¿é‡Œäº‘å¦‚ä½•åŸºäºŽæ ‡å‡† K8s æ‰“é€ è¾¹ç¼˜è®¡ç®—äº‘åŽŸç”ŸåŸºç¡€è®¾æ–½

[æé—®é“¾æŽ¥](https://shimo.im/docs/KH6cCkrKHW33CJx6)

> Q1ï¼šå¦‚ä½•é€‚é…ä¸åŒçš„å¹³å°ï¼ŸOS ä¸åŒï¼ˆlinux åŠå„ç§å‘è¡Œç‰ˆã€éž linuxï¼‰ã€ç¡¬ä»¶æž¶æž„ä¸åŒï¼ˆx86ã€ARM ç­‰ç­‰ï¼‰ã€‚ä¸åŒå¹³å°çš„èŠ‚ç‚¹èƒ½åœ¨åŒä¸€ä¸ªé›†ç¾¤å†…ç®¡ç†å—ï¼Ÿ

A1ï¼šå¯ä»¥çš„ï¼›å½“å‰ ack@edge æ”¯æŒ OS ç±»åž‹ï¼šlinuxï¼ˆcentosã€ubuntuï¼‰ï¼Œwindows serverï¼›CPU æž¶æž„ï¼šX86ï¼Œarm è¾¹ç¼˜èŠ‚ç‚¹æŽ¥å…¥ï¼›æ”¯æŒå¼‚æž„èŠ‚ç‚¹åœ¨åŒä¸€ä¸ªé›†ç¾¤ç®¡ç†ï¼›k8s ç®¡æŽ§æ‰˜ç®¡åœ¨äº‘ä¸Šï¼Œå¼‚æž„èŠ‚ç‚¹çš„æ”¯æŒä¸»è¦åœ¨è¾¹ç¼˜ç«¯å®žæ–½ï¼›

> Q2ï¼šå¦‚ä½•åº”å¯¹ worker èŠ‚ç‚¹ç½‘ç»œä¸ä¸€å®šé€šçš„é—®é¢˜ï¼Œé€šè¿‡ servicename æˆ–è€… clusterIP æ˜¯å¦è¿˜èƒ½è®¿é—®ï¼Ÿ

A2: åˆ†ä¸¤ä¸ªè§’åº¦ï¼š1. ACK@Edge æä¾›äº†å®Œæ•´çš„æ ‡å‡†çš„ k8s èƒ½åŠ›ï¼Œæ‰€ä»¥ servicename å’Œ clusterIP é»˜è®¤æ˜¯å¯ä»¥ work çš„ï¼›2. å¦‚æžœ worker èŠ‚ç‚¹é—´ç½‘ç»œä¸é€šï¼Œé‚£ä¹ˆ Pod é—´ä¸œè¥¿å‘æµé‡æ˜¯ä¸å¯è¾¾çš„ï¼›æ‰€ä»¥æˆ‘ä»¬æ‰©å±•äº† service çš„ scope èƒ½åŠ›ï¼Œservice çš„æµé‡åªä¼šè¢«é™åˆ¶åœ¨ä¸€ç»„ç½‘ç»œå¯è¾¾çš„èŠ‚ç‚¹ä¹‹é—´è½¬å‘ï¼ˆå°±æ˜¯åˆ†äº«ä¸­æåˆ°çš„ edgeunitï¼‰ï¼›

> Qï¼š è¾¹ç¼˜èƒ½è‡ªæ²»åˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œè¿˜èƒ½æ­£å¸¸åšå¢žåˆ æ”¹æŸ¥å—ï¼Ÿapiserver èµ„æºå‘ç”Ÿå˜åŒ–æ—¶èŠ‚ç‚¹è¿˜èƒ½æ„ŸçŸ¥å’ŒåŒæ­¥å—ï¼Ÿç›®å‰å¦‚æžœè§¦å‘äº†è¾¹ç¼˜è‡ªæ²»ï¼Œå¯¹æˆ‘çš„åº”ç”¨ç¨‹åºä¼šæœ‰å“ªäº›å½±å“ï¼Ÿ

A3: é¦–å…ˆï¼Œæ˜Žç¡®è¾¹ç¼˜è‡ªæ²»å·¥ä½œçš„æ—¶æœºæ˜¯åœ¨è¾¹ç¼˜èŠ‚ç‚¹å’Œäº‘ç«¯ç®¡æŽ§å¤±è”åŽï¼Œæ­¤æ—¶ä¸ºäº†é˜²æ­¢è„‘è£‚äº‘ç«¯ä¼šé™åˆ¶ç›¸å…³åº”ç”¨å’ŒèŠ‚ç‚¹èµ„æºçš„æ“ä½œï¼›apiserver èµ„æºçš„å˜åŒ–åªèƒ½å¤Ÿåœ¨ç½‘ç»œæ¢å¤åŽåŒæ­¥åˆ° worker èŠ‚ç‚¹ï¼Œå¹¶ä¸”ç½‘ç»œæ¢å¤åŽï¼Œwoker èŠ‚ç‚¹ç›¸å…³çš„èµ„æºçŠ¶æ€ä»ç„¶ä»¥ apiserver æ•°æ®ä¸ºå‡†ï¼›è¿›å…¥è‡ªæ²»çŠ¶æ€åŽï¼ŒèŠ‚ç‚¹ä¸Š agent å’Œåº”ç”¨éƒ½åªèƒ½å¤Ÿæ¶ˆè´¹æ–­ç½‘å‰ä¸€åˆ»çš„èµ„æºçŠ¶æ€ï¼Œè‡ªæ²»ç»„ä»¶ edgehub æ›¿ä»£ apiserver æŽ¥ç®¡äº†æ‰€æœ‰å‘å¾€ apiserver çš„è¯·æ±‚ï¼›

> Qï¼š k8s å…·å¤‡å¾ˆå¥½çš„åº”ç”¨å®¹ç¾èƒ½åŠ›ï¼Œack@edge åœ¨åº”ç”¨å®¹ç¾æ–¹é¢å…·å¤‡å“ªäº›èƒ½åŠ›ï¼Ÿ

A4: ack@edge å°±æ˜¯æ ‡å‡†çš„ k8sï¼›é™¤äº†å…·å¤‡ k8s åŽŸç”Ÿçš„åº”ç”¨ã€èµ„æºç®¡ç†èƒ½åŠ›ä¹‹å¤–ï¼Œåœ¨è¾¹ç¼˜åœºæ™¯è¿˜æä¾›äº†æ–­ç½‘è‡ªæ²»ï¼Œå…ƒä¿¡æ¯ä¿æŒç­‰ç­‰èƒ½åŠ›ï¼Œè¿™äº›ä¹Ÿéƒ½æ˜¯ä¸ºåº”ç”¨å®¹ç¾è€ƒè™‘ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œå› ä¸ºæä¾›çš„æ ‡å‡† k8s å®Œæ•´èƒ½åŠ›ï¼Œk8s å‘¨è¾¹ç”Ÿæ€ servicemeshã€knative ç­‰éƒ½èƒ½å¾ˆå¥½æ”¯æŒï¼›

> Qï¼š é¡¹ç›®æ˜¯å¦æœ‰å¼€æºçš„è®¡åˆ’

A5: edgehubã€edgetunnelã€edgeunitã€knative-edge ç­‰ç›¸å…³è¾¹ç¼˜èƒ½åŠ›éƒ½åœ¨å¼€æºæµç¨‹ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼›

> Qï¼šå¯å¦ç›´æŽ¥æ‰“é€šäº‘ï¼Œè¾¹ï¼Œç«¯çš„ç½‘ç»œï¼Œæ¯”å¦‚æˆ‘è¾¹ä¸Šçš„ pod è®¿é—®äº‘ä¸Šçš„æœåŠ¡ï¼Œç›´æŽ¥é€šè¿‡ servicename.namespace.cluster.svc.localï¼Œè€Œä¸æ˜¯ç”¨ingress æš´éœ²äº‘ä¸ŠæœåŠ¡ï¼Œç›®å‰ kubeedge ç»è¿‡å®šåˆ¶æ˜¯å…·å¤‡è¿™ä¸ªèƒ½åŠ›çš„ï¼Œè¿˜æœªåšç”Ÿäº§éªŒè¯ã€‚,,,é˜¿é‡Œçš„å’Œ kubeedge åŠ k3s æœ‰ä»€ä¹ˆåŒºåˆ«

A6: è¿™ä¸ªé—®é¢˜çš„æœ¬è´¨æ˜¯å®¹å™¨ç½‘ç»œèƒ½å¦è·¨äº‘ï¼Œè¾¹ï¼Œç«¯ï¼›åœ¨ ack@edge ä¸­æˆ‘ä»¬ä¹Ÿæ”¯æŒ overlay è·¨å…¬ç½‘çš„å®‰å…¨æ–¹æ¡ˆï¼Œæ”¯æŒåå‘ç½‘ç»œç©¿é€æ‰“é€šäº‘ã€è¾¹ï¼Œæ”¯æŒ VPN ç½‘ç»œç­‰ï¼›

> Qï¼šack@edge æ˜¯å¦æœ‰æä¾›åŽŸç”Ÿ k8s API?è¿˜æ˜¯ç»è¿‡å°è£…åŽçš„ API?äº‘è¾¹ç›´è¿žçš„å®‰å…¨é—®é¢˜ï¼Œè¦æŠŠ apiserver ç›´æŽ¥æš´éœ²åˆ°å¤–ç½‘æ˜¯ä¸æ˜¯ä¸å¤ªå®‰å…¨ï¼Ÿ

A7: ack@edge çš„è®¾è®¡ç†å¿µæ˜¯å°†åŽŸç”Ÿçš„ k8s æ‰˜ç®¡åœ¨äº‘ä¸Šï¼Œæ”¯æŒæŽ¥å…¥è¾¹ç¼˜ç®—åŠ›ï¼›ç”¨æˆ·å¯ä»¥å¾ˆä¾¿æ·çš„é€šè¿‡äº§å“ç•Œé¢é…ç½®å¹¶ç”Ÿäº§å‡ºä¸€ä¸ªåŽŸç”Ÿçš„é«˜å¯ç”¨çš„ k8s é›†ç¾¤ï¼Œå¹¶é»˜è®¤å®‰è£…ä¸Šæ”¯æŒè¾¹ç¼˜èƒ½åŠ›çš„ addons å’Œ operatorï¼Œå› æ­¤è¾¹ç¼˜ k8s æä¾›äº†åŽŸç”Ÿçš„ APIï¼›äº‘ä¸Š apiserver é€šè¿‡é˜¿é‡Œäº‘ slb æš´éœ²ï¼Œå¯¹å¤–æä¾›æœåŠ¡ï¼Œé€šè¿‡äº‘ä¸Š slb æœåŠ¡çš„å®‰å…¨èƒ½åŠ›ç»“åˆ k8s çš„è®¤è¯ã€é‰´æƒèƒ½åŠ›ä¿è¯äº†äº‘ä¸Š apiserver çš„å®‰å…¨ï¼›

> Qï¼š ack@edge å®¹å™¨åŒ–åŽçš„ç¨‹åºä¸Žæ¿€å…‰é›·è¾¾ã€æ·±åº¦ç›¸æœºã€imuã€com é€šä¿¡åè®®çš„åº•å±‚æŽ§åˆ¶æ¿ç­‰ä¼ æ„Ÿå™¨çš„é€šä¿¡å’Œæ•°æ®äº¤äº’æ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Ÿæ˜¯å¦èƒ½å¤Ÿæä¾›ç¨³å®šçš„æ•°æ®äº¤äº’é€šé“ï¼Ÿç‚¹äº‘åŠå›¾åƒæ•°æ®çš„ä¼ è¾“ä¸Žç›´æŽ¥è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¸Šçš„ç¨‹åºæ˜¯å¦ä¼šæœ‰å·®åˆ« ï¼Ÿ

A8: åº”ç”¨å®¹å™¨åŒ–ä¸Žå¦å’Œå¯¹ç‰©è”ç½‘åè®®çš„æ”¯æŒä¸å†²çªï¼›ä¼ ç»Ÿçš„è£¸è¿›ç¨‹éƒ¨ç½²å’Œå®¹å™¨åŒ–éƒ¨ç½²å¯¹åº”ç”¨è€Œè¨€æ˜¯ä¸æ„ŸçŸ¥çš„ï¼›æ•°æ®é€šé“éœ€è¦ä¾èµ–å…¶ä»–çš„ç‰©è”ç½‘åè®®æ”¯æŒ

> Q9ï¼šack@edge åœ¨é¢å‘ IoT è®¾å¤‡æŽ¥å…¥æ˜¯é€šè¿‡ä»€ä¹ˆå®žçŽ°çš„ï¼Ÿæ˜¯é€šè¿‡å®¹å™¨åŠ è½½çš„ IoT PaaS è¿˜æ˜¯æœ‰ä¸€äº›ä¸“é—¨çš„ç»„ä»¶æ”¯æŒï¼Œä¾‹å¦‚è®¾å¤‡æŽ¥å…¥ã€M2M å¼•æ“Žã€MQTT Brokerã€è®¾å¤‡å½±å­è¿™äº›ã€‚
>
> Q10: è¯·é—® operator ä¸º k8s å¸¦æ¥çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿoperator çš„åº”ç”¨çŽ°çŠ¶å¯ä»¥ç»™ç®€å•ä»‹ç»å—ã€‚

---

### 2019-12-18:ï¼šOpen Policy Agent åœ¨ Kubernetes ä¸­çš„åº”ç”¨

[æé—®é“¾æŽ¥](https://shimo.im/docs/thXyGRP36CHpjvTk)

> Qï¼šè§„åˆ™æ˜¯å¦ä¼šå¯¹æ€§èƒ½æœ‰å½±å“ï¼Œæ˜¯å¦æœ‰åŽ‹æµ‹çš„æ•°æ®

Aï¼šå†³ç­–è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ RPC è°ƒç”¨ï¼Œå› ä¸ºç­–ç•¥çš„å®šä¹‰æ˜¯å£°æ˜Žå¼çš„æ•°æ®éƒ½æ˜¯é™æ€å­˜å‚¨ï¼Œå†³ç­–è€—æ—¶å¯ä»¥å¿½ç•¥ä¸è®¡ï¼ˆåœ¨æ•´ä¸ªè¯·æ±‚é˜¶æ®µä¸­ï¼‰ï¼Œå³ä½¿æ˜¯å†…éƒ¨ä»£ç†ä¹Ÿä¼šå¸¦æ¥ç½‘ç»œä¸Šçš„æŸè€—ã€‚

> Qï¼šè§„åˆ™æ˜¯å¦å¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œå³ä½¿ç”Ÿæ•ˆï¼Œä¸éœ€è¦é‡å¯æœåŠ¡

Aï¼šä¸éœ€è¦é‡å¯æœåŠ¡ï¼Œå®žæ—¶ç”Ÿæ•ˆï¼Œè¿™ä¹Ÿæ˜¯ OPA çš„ç›®çš„ï¼Œä¸ä¼šå› ä¸ºç­–ç•¥çš„å˜åŠ¨è€Œæ”¹åŠ¨ä»£ç æˆ–æ˜¯é‡å¯æœåŠ¡ã€‚

> Qï¼šæ˜¯å¦å¯ä»¥ä¸Ž istio ç»“åˆï¼Œå®žçŽ°å¾®æœåŠ¡æƒé™ç®¡ç†ä¸‹æ²‰åˆ°ç½‘æ ¼ï¼Ÿ

Aï¼šå½“ç„¶å¯ä»¥ï¼Œç¤¾åŒºæœ‰ç›¸å…³çš„å®žçŽ°ï¼Œè¿™ä¸ªå¾—åŽ»å…³æ³¨å…·ä½“çš„é¡¹ç›®ï¼Œæˆ‘è¿˜æ²¡æœ‰æ·±å…¥äº†è§£ã€‚

> Qï¼šæ˜¯å¦å¯ä»¥ä¸Ž spring cloud ç»“åˆä½¿ç”¨ï¼Œæˆ–æ˜¯ä¸Ž docker é…åˆä½¿ç”¨ï¼Œå› ä¸ºæ²¡æœ‰ç”¨åˆ° k8s

Aï¼šå½“ç„¶å¯ä»¥ï¼ŒOPA å¯ä»¥ç”¨åšç¬¬ä¸‰æ–¹åº“é›†æˆåˆ°ä½ çš„ä»£ç ä¸­ï¼Œé€šè¿‡ API è¿›è¡Œè°ƒç”¨ï¼Œä¸€æ¬¡å†³ç­–å°±æ˜¯ä¸€æ¬¡ RPC è°ƒç”¨ï¼ŒOPA çš„æ ¸å¿ƒç†å¿µåœ¨äºŽæŠŠå†³ç­–è¿™ä¸ªæ­¥éª¤ç»™è§£è€¦å‡ºæ¥ï¼Œè€Œä¸æ˜¯å’Œä¸Šä¸‹æ–‡é€»è¾‘æ··åœ¨ä¸€èµ·ã€‚

> Qï¼šOPA å¯ä»¥è°ƒç”¨æ•°æ®åº“å—ï¼Ÿå®ƒèƒ½å®žçŽ°é‰´æƒå—ï¼Ÿ

Aï¼šå¯ä»¥ï¼Œå¯ä»¥è‡ªå·±å®žçŽ°å¤–éƒ¨è°ƒç”¨çš„æ¨¡å—ï¼Œä½†é€šç”¨çš„åšæ³•æ˜¯äº‹å…ˆæŠŠéœ€è¦å†³ç­–çš„æ•°æ®æŸ¥è¯¢ç»„è£…å¥½å‘é€ç»™ OPA è¿›è¡Œå†³ç­–ã€‚é‰´æƒå°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç­–ç•¥ï¼Œç­–ç•¥éœ€è¦å…³è”åˆ°ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€‚å¯ä»¥æŠŠ OPA å’Œç½‘å…³è¿›è¡Œæ•´åˆï¼Œæ¯æ¬¡ç”¨æˆ·è¯·æ±‚éƒ½è¿›è¡Œé‰´æƒï¼ˆé€šè¿‡ OPA è¿›è¡Œå†³ç­–ï¼Œè¯¥æ¬¡è¯·æ±‚æ˜¯å¦æ”¾è¡Œï¼‰ã€‚

> Qï¼šå¾®æœåŠ¡å’Œ OPA æ˜¯ä¸æ˜¯ç»“åˆçš„æ›´ç´§å¯†ï¼Ÿå¯ä»¥æŠŠå†³ç­–æå‡ºæ¥ï¼Ÿ

Aï¼šå’Œå¾®æœåŠ¡æ¦‚å¿µæœ¬èº«å…³ç³»ä¸å¤§ï¼Œå³ä½¿æ˜¯å•ä½“åº”ç”¨ï¼Œåªè¦ä½ å¯ä»¥æŠŠå†³ç­–è¿‡ç¨‹å‰¥ç¦»å‡ºæ¥å°±å¯ä»¥ç”¨åˆ° OPAï¼Œè¿™ä¸ªå¾ˆç¬¦åˆå¾®æœåŠ¡çš„ç†å¿µï¼ŒOPA å°±æ˜¯ä¸€ä¸ªé›†ä¸­çš„å†³ç­–æœåŠ¡ã€‚

---

### 2019-12-10ï¼šVolcano ä»‹ç»åŠå…¶åœ¨æ·±åº¦å­¦ä¹ åœºæ™¯ä¸‹çš„åº”ç”¨

[æé—®é“¾æŽ¥](https://shimo.im/docs/RtV63PGyjPhGKCvk)

> Q1ï¼šé’ˆå¯¹ kubeflow è¿™ç§å·¥ä½œæµæœ‰æ²¡æœ‰è®¡åˆ’åšå‡ºé’ˆå¯¹æ€§ä¼˜åŒ–ï¼Ÿ#274 å· PR æå‡ºè¦åšæ‹“æ‰‘ä¼˜åŒ–ï¼Œæœ€åŽä¹Ÿ close äº†ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ

Aï¼šé’ˆå¯¹ volcano ä¸Ž kubeflow çš„ç»“åˆï¼Œvolcano ç¤¾åŒºä¸€ç›´åœ¨æŽ¨åŠ¨ï¼Œå¸Œæœ› kubeflow ä¸‹å„ä¸ª operator å¯¹æŽ¥ volcanoï¼ŒçŽ°åœ¨ï¼Œè¿™ä¸€æŽ¨åŠ¨åœ¨ kubeflow ä¸­çš„ä¸€äº›è®¡ç®—æ¡†æž¶å·²ç»å–å¾—äº†æ¯”è¾ƒæ˜Žæ˜¾çš„è¿›å±•ã€‚task-topology çš„ç®—æ³•å·²åœ¨å†…ç½‘å®žçŽ°ï¼ŒæŽ¨å…¥ github çš„è®¡åˆ’æ­£åœ¨åˆ¶å®šä¸­ï¼Œå¦‚æ‚¨æœ‰åˆ‡å®žéœ€æ±‚ï¼Œå¯åˆ° volcano ç¤¾åŒºç•™è¨€[è®¨è®º](https://github.com/volcano-sh/volcano/issues)

> Q2ï¼šé’ˆå¯¹æ•°æ®å±€éƒ¨æ€§æœ‰æ²¡æœ‰ä¼˜åŒ–

Aï¼š data aware scheduling å·²åˆ—å…¥ç‰¹æ€§è®¡åˆ’

> Q3ï¼šèµ„æºæ•æ„Ÿåž‹çš„æ·±åº¦å­¦ä¹ ä»»åŠ¡å…·ä½“æœ‰ä»€ä¹ˆæŒ‘æˆ˜ï¼Ÿ

Aï¼šæœ¬æ¬¡åˆ†äº«ï¼Œé’ˆå¯¹è§£å†³ä¸ºæ·±åº¦å­¦ä¹ æä¾›ç®—åŠ›æ–¹é¢çš„æŒ‘æˆ˜ï¼Œå…¶ä»–æ–¹é¢çš„æŒ‘æˆ˜ï¼Œä¸èƒ½ä¸ºæ‚¨è§£ç­”ã€‚å…³äºŽç®—åŠ›æ–¹é¢çš„æŒ‘æˆ˜å’Œåº”å¯¹ç­–ç•¥ï¼Œè¯·ç•™æ„åŽç»­åˆ†äº«æ–‡æ¡£ã€‚

> Q4ï¼šè¯·é—®å¯¹ä¸€ä¸ªåˆ†å¸ƒå¼ tensorflow è®­ç»ƒï¼Œworker èŠ‚ç‚¹çš„ gpu åž‹å·ä¸åŒï¼Œä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Œæ¯”å¦‚ v100 å’Œ p40 æ··ç”¨

Aï¼šv100 å’Œ p40 å‡ä¸ºæ‰©å±•èµ„æºï¼Œåœ¨è°ƒåº¦è¿‡ç¨‹ä¸­å‡åŒç­‰å¯¹å¾…ï¼Œæ˜¯å¦æŒ‡å®šå¤šä¸ª gpu å¡å¯¹è°ƒåº¦è¿›ç¨‹æ— å½±å“ï¼Œæ¬¢è¿Žæ‚¨ä½¿ç”¨ volcano è¿›è¡Œç›¸å…³æµ‹è¯•ã€‚

> Q5ï¼šåœ¨ä½¿ç”¨ k8s ä¸­ï¼Œå¯¹äºŽ IB ç½‘ç»œå’Œ RDMA çš„æ”¯æŒä¼šä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜

Aï¼šæ²¡æœ‰é—®é¢˜ï¼Œæ”¯æŒè¿‡ç¨‹ä¸­ï¼Œk8s éœ€è¦åšä¸€äº›é€‚é…ã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œä¸€äº›äº‘åŽ‚å•†ä½¿ç”¨ k8s å¯¹ IB ç½‘ç»œå’Œ RDMA çš„æ”¯æŒå·²ç»å•†ç”¨ã€‚

> Q6ï¼šå¯¹äºŽ tf çš„åˆ†å¸ƒå¼è®­ç»ƒï¼Œworker èŠ‚ç‚¹ä¹‹é—´å…±äº«æ•°æ®é›†ï¼Œæ‚¨æŽ¨èç”¨å“ªç§åˆ†å¸ƒå¼å­˜å‚¨

Aï¼šå¯¹è±¡å­˜å‚¨å’Œ NFS å‡å¯ä»¥ï¼Œå–å†³äºŽæ‚¨ä½¿ç”¨çš„åº•å±‚å­˜å‚¨çš„è¯»å–å’Œå†™å…¥é€Ÿåº¦ã€‚

> Q7ï¼šè™½ç„¶ä¸€å¼€å§‹æ‰¹è°ƒåº¦æˆåŠŸã€‚ä½†æ˜¯å¦‚æžœä¸€ä¸ªè®­ç»ƒä½œä¸šæ—¶é—´æ¯”è¾ƒé•¿ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­ä¸€ä¸ª pod æŒ‚äº†æ€Žä¹ˆåŠžï¼Œé‡æ–°è°ƒåº¦ä¹‹åŽ ip ç«¯å£ç­‰ç›¸å…³çš„ä¿¡æ¯å¯èƒ½éƒ½å˜äº†ï¼Ÿ

Aï¼švolcano æ”¯æŒä¸º job é…ç½®ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­–ç•¥ï¼Œæ”¯æŒé…ç½®è®¡ç®—èŠ‚ç‚¹å¤±è´¥åŽï¼Œè®¡ç®—é›†ç¾¤é‡å¯ã€‚å¦‚æžœè®¡ç®—æ¨¡åž‹ä¸æ”¯æŒå®¹é”™ï¼Œå¯è¿›è¡Œç›¸å…³é…ç½®ã€‚

> Q8ï¼šå¤§ä½¬ï¼Œæœ€åŽè¿™ä¸ªåˆ†äº«å†…å®¹èƒ½åŒæ­¥åˆ° github å˜›ï¼Œè®²çš„å¾ˆè¯¦ç»†ï¼Œä½¿ç”¨ kubeflow å¼€å‘ä¸­ï¼Œå¯¹ volcano å¾ˆæ„Ÿå…´è¶£

Aï¼šä¸‹å‘¨å…¬ä¼—å·ä¼šå‘ï¼Œå‘å‡ºåŽå†åŒæ­¥ã€‚

> Q9ï¼švolcano æ˜¯å¹¶è¡Œè°ƒåº¦å¤šä¸ª pod å—ï¼Ÿè°ƒåº¦è¿‡ç¨‹ä¸­ä¼šä¸ä¼šå‘ç”Ÿå†²çªã€‚

Aï¼šæ˜¯å¹¶è¡Œè°ƒåº¦ï¼Œä¸ä¼šå†²çªã€‚batch è°ƒåº¦ï¼Œä¸»è¦é’ˆå¯¹äºŽåŒä¸€æ‰¹è®¡ç®—ä»»åŠ¡ä¸‹ä»»åŠ¡çš„æ‰¹é‡è°ƒåº¦ã€‚è°ƒåº¦è¿‡ç¨‹ä¸­ï¼Œä»ç„¶å­˜åœ¨å¤šä¸ªç»´åº¦çš„ä¼˜å…ˆçº§ã€‚ä¼˜å…ˆçº§å†…æœ‰å…ˆåŽã€‚

> Q10ï¼šçŽ°åœ¨ volcano æ˜¯å…ˆæ¥å…ˆæœåŠ¡æ¨¡åž‹æ˜¯å—ï¼Ÿæœ‰æ²¡æœ‰è€ƒè™‘é€šè¿‡è°ƒæ•´ä½œä¸šé¡ºåºæé«˜é›†ç¾¤èµ„æºåˆ©ç”¨çŽ‡å’Œä½œä¸šå®Œæˆæ—¶é—´ã€‚æ¯”å¦‚ä¸€ä¸ªä½œä¸šæœ‰èµ„æºè¯·æ±‚é‡å’Œè¿è¡Œæ—¶é—´ä¸¤ä¸ªç»´åº¦çš„è¯ï¼Œå°±å¯ä»¥è´ªå¿ƒçš„ä½¿æ‰§è¡Œæ—¶é—´å°‘çš„ä½œä¸šæŽ’åœ¨å‰é¢ä»¥å‡å°‘æ€»ä½“æ‰§è¡Œæ—¶é—´ã€‚ã€ŠY. Fan, Z. Lan, P. Rich, W. Allcock, M. Papka, B. Austin, and D. Paul, "Scheduling Beyond CPUs for HPC", Proc. of HPDC'19 , 2019.ã€‹è¿™ç¯‡è®ºæ–‡å°±æ˜¯é€šè¿‡æ»‘åŠ¨çª—å£è°ƒæ•´é¡ºåºä¼˜åŒ–äº†é›†ç¾¤èµ„æºåˆ©ç”¨çŽ‡ã€‚

Aï¼švolcano è°ƒåº¦è¿‡ç¨‹éµå¾ªä¼˜å…ˆçº§è°ƒåº¦ï¼Œä¼˜å…ˆçº§é«˜çš„ pod å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§èŽ·å–é›†ç¾¤èµ„æºã€‚ä¼˜å…ˆçº§æœ‰å¤šä¸ªç»´åº¦ï¼Œnamespaceã€queueã€job ç­‰ã€‚éšç€é›†ç¾¤ä¸‹èµ„æºçŠ¶å†µå’Œ pod è¿è¡Œæƒ…å†µä¸åŒï¼Œå„ç»´åº¦ä¼˜å…ˆçº§å‡ä¼šåŠ¨æ€è°ƒæ•´ã€‚è™½æœ‰å¤šä¸ªä¼˜å…ˆçº§ç»´åº¦ï¼Œä½†å‡æ²¡æœ‰æ¶µç›–æ‚¨æåˆ°çš„è¿™ç§åœºæ™¯ï¼Œæ¬¢è¿Žåˆ° volcano ç¤¾åŒºç•™è¨€[è®¨è®º](https://github.com/volcano-sh/volcano/issues)

> Q11ï¼šæäº¤ VCJOB æ—¶å¯å¦åªæŒ‡å®šä»»åŠ¡ GPU æ€»æ•°ï¼Œç”±è°ƒåº¦å™¨è‡ªå·±æ ¹æ®é›†ç¾¤ GPU ç©ºé—²æƒ…å†µå†³å®šåˆ†é…å‡ ä¸ª worker ä»¥åŠæ¯ä¸ª worker çš„å¡æ•°å‘¢ï¼Ÿ

Aï¼šä¸æ”¯æŒ

> Q12ï¼šè¯·é—® volcano å’ŒåŽŸç”Ÿçš„ kube-scheduler æœ‰åšåˆ°è°ƒåº¦ cache çš„å…±äº«å—ï¼Ÿä¹Ÿå°±æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥åŒæ—¶è¢«è¿™ä¿©ä¸ªè°ƒåº¦å™¨ç®¡ç†è€Œä¸å†²çªï¼Ÿ

Aï¼šä¸æ”¯æŒã€‚ä½¿ç”¨ä¸¤ä¸ªè°ƒåº¦å™¨è°ƒåº¦åŒä¸€ä¸ª podï¼Œä¸å¯é¿å…ä¼šå‡ºçŽ°è°ƒåº¦å†²çªã€‚ç›®å‰ï¼Œvolcano åªå¤„ç†é…ç½®è°ƒåº¦å™¨åç§°ä¸º volcano çš„ pod è°ƒåº¦

---

### 2019-12-05ï¼šKnative Serverless ä¹‹é“ - å¦‚ä½• 0 è¿ç»´ã€ä½Žæˆæœ¬å®žçŽ°åº”ç”¨æ‰˜ç®¡ï¼Ÿ

[æé—®é“¾æŽ¥](https://shimo.im/docs/RhvYRWy8W3RqGYtW)

> Q1ï¼šå¼€å‘æ€Žä¹ˆè¿œç¨‹è°ƒè¯• k8s ä¸­çš„åº”ç”¨

A1ï¼šKubernetes åº•å±‚é¦–å…ˆæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‚£å’±ä»¬å°±ä»Žå®¹å™¨è°ˆèµ·ã€‚å®¹å™¨ç›¸å¯¹äºŽå®¿ä¸»æœºæ¥è¯´å…¶å®žåªæ˜¯æŠŠä¸šåŠ¡è¿›ç¨‹é™åˆ¶åœ¨ä¸€ä¸ªæ›´åˆç†çš„æƒé™èŒƒå›´å†…ã€‚åœ¨è°ƒè¯•å®¹å™¨é‡Œé¢çš„ä¸šåŠ¡è¿›ç¨‹æ—¶å¯ä»¥ç›´æŽ¥ docker exec åˆ°å®¹å™¨å†…ã€‚åˆ°äº†å®¹å™¨å†…éƒ¨å°±å’Œä¸€ä¸ª vm æ²¡æœ‰ä»€ä¹ˆå·®åˆ«äº†ã€‚è€Œ Kubernetes çš„ Deployment å¯ä»¥è®¤ä¸ºæ˜¯ç¼–æŽ’å¾ˆå¤šå®¹å™¨ï¼Œæ¯ä¸€ä¸ª å®¹å™¨éƒ½å¯ä»¥é€šè¿‡ å®¿ä¸»æœº docker exec è¿›åŽ»ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ Kubernetes çš„æ–¹å¼ kubectl exec åˆ°å®¹å™¨å†…è¿›è¡Œè°ƒè¯•ã€‚å¦‚æžœå®žåœ¨åˆæœŸè°ƒè¯•é˜¶æ®µå»ºè®®ä½¿ç”¨æ¯”è¾ƒå®Œæ•´çš„ CentOS æˆ–è€… Ubuntu é•œåƒï¼ŒåŸºç¡€é•œåƒå†…è¦æœ‰ä¸€äº›åŸºæœ¬çš„è°ƒè¯•å·¥å…·ã€‚æ‘¸ç´¢ç†Ÿæ‚‰äº†ä¹‹åŽå¯ä»¥ä½¿ç”¨ç²¾ç®€çš„åŸºç¡€é•œåƒï¼Œè¿™æ ·æ›´ç»æµŽã€‚

> Q2ï¼šknative çš„ build å’Œå¼€å‘æµç¨‹ç®¡ç†å¯ä»¥ä»£æ›¿ jenkins å—

A2ï¼šKnative çš„ Build çŽ°åœ¨é•¿å¤§äº†ï¼Œå•ç‹¬å¼€å¯äº†ä¸€ä¸ªé¡¹ç›®å°±æ˜¯  Tektonã€‚Tekton çš„å®šä½ä¸æ˜¯æ›¿æ¢ Jenkins ï¼Œè¿™ä¸¤è€…åœ¨ä½¿ç”¨æ–¹å¼ä¸Šå·®åˆ«è¿˜æ˜¯å¾ˆå¤§çš„ã€‚å¯¹äºŽæ¯”è¾ƒä¹ æƒ¯ Jenkins çš„ç”¨æˆ·æ¥è¯´åˆ‡æ¢æˆ Tekton æ˜¯éœ€è¦ä¸€ä¸ªé€‚åº”è¿‡ç¨‹çš„ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¦æžä¸€ä¸ª Tekton å‘¢ï¼ŒJenkins ä¸æ˜¯å·²ç»å¾ˆå¥½äº†å—ï¼Ÿå…·ä½“ Tekton çš„è¯¦ç»†è®¾è®¡å’Œå®žçŽ°å’±ä»¬ä»¥åŽå¯ä»¥å•ç‹¬è¯´æ˜Žï¼Œè¿™é‡Œé€‰å‡ ä¸ªé‡è¦çš„ä»‹ç»ä¸€ä¸‹åŒºåˆ«ï¼šTekton çš„ Kubernetes åŽŸç”Ÿç‰¹æ€§ä½“çŽ°åœ¨å¦‚ä¸‹å‡ ç‚¹ï¼š

- Tekton çš„æ‰€æœ‰ Task éƒ½æ˜¯ä»¥ Pod çš„ç²’åº¦æ‰§è¡Œçš„ï¼Œæ¯ä¸€ä¸ª Task å¯ä»¥åŒ…å«å¾ˆå¤šä¸ª Stepã€‚ä¸€ä¸ª Task çš„æ‰€æœ‰ Step åœ¨åŒä¸€ä¸ª Pod å†…ä¸²è¡Œæ‰§è¡Œã€‚ä¸åŒçš„ Task é€šè¿‡ Tekton Controller ç¼–æŽ’ï¼Œæ˜¯è·¨ Node èŠ‚ç‚¹æ‰§è¡Œçš„ï¼›
- Tekton çš„æœ€åŸºæœ¬çš„æ‰§è¡Œå•å…ƒæ˜¯ Podï¼Œè¿™å’Œ Kubernetes äº‘åŽŸç”Ÿæ“ä½œç³»ç»Ÿæ˜¯éžå¸¸å¥‘åˆçš„ã€‚ä¸€ä¸ªäººå¦‚æžœæŽŒæ¡äº† Kubernetesï¼Œå†å­¦ä¹  Tekton å°±æ˜¯ä¸€ä»¶éžå¸¸å®¹æ˜“çš„äº‹æƒ…ã€‚ä½†æ˜¯æƒ³ä¸€ä¸‹å¦‚æžœæŽŒæ¡äº† Kubernetes ä¼šå¯¹å­¦ä¹  Jenkins æœ‰æ‰€å¸®åŠ©å—ï¼Ÿä¸å¤ªå¯èƒ½ã€‚éšç€ Kubernetes çš„æµè¡Œè¿™ç§å½±å“ä¹Ÿä¼šå˜çš„è¶Šæ¥è¶Šæ˜Žæ˜¾ï¼›
- å†è¯´ä¸€ä¸‹è¢«é›†æˆçš„ç‰¹æ€§ï¼ŒTekton å¦‚æžœçŽ°åœ¨å’Œ Jenkins æ‹¼ç”Ÿæ€çŽ°åœ¨èµ„åŽ†è¿˜ä¸å¤Ÿï¼Œä½†æ˜¯ä»–çš„è®¾è®¡å’Œäº‘åŽŸç”Ÿç”Ÿæ€ä½å†³å®šäº†ä»–å¯ä»¥å¾ˆå®¹æ˜“çš„é€šè¿‡ Kubernetes api è¢«é›†æˆï¼Œè€Œ Jenkins çš„ API éœ€è¦å•ç‹¬å­¦ä¹ ï¼Œè¿™äº›éƒ½æ˜¯æˆæœ¬ï¼›
- Kubernetes ç”Ÿæ€çš„å¾ˆå¤šå·²æœ‰çš„å·¥å…·ï¼Œæ¯”å¦‚ Chart ç­‰ç­‰éƒ½å¯ä»¥å’Œ Tekton éžå¸¸å®¹æ˜“çš„å¥‘åˆåœ¨ä¸€èµ·ï¼ŒJenkins çš„ç”Ÿæ€è‡ªå·±æ¯”è¾ƒå­¤å•ã€‚é•¿è¿œçœ‹ Tekton æ˜¯æœ‰ä¼˜åŠ¿çš„ï¼Œä½† Tekton è‡ªå·±çš„é¢†åŸŸèƒ½åŠ›ä¹Ÿéœ€è¦ä¸æ–­å®Œå–„ï¼›

> Q3ï¼šknative ç¼–æŽ’å’Œ K8S åº”ç”¨ç¼–æŽ’çš„åŒºåˆ«åŠåº”ç”¨åœºæ™¯?

A3ï¼šKubernetes çš„æœ€å¤§ä»·å€¼æ˜¯æŠŠå¯¹ IaaS èµ„æºçš„æ“ä½œæ ‡å‡†åŒ–äº†ï¼Œæ¯”å¦‚æ— è®ºæ˜¯åœ¨ aws è¿˜æ˜¯åœ¨é˜¿é‡Œäº‘ä¸Šé¢ä½¿ç”¨è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œç­‰èµ„æºéƒ½å¯ä»¥ç›´æŽ¥é€šè¿‡ Kubernetes è¯­ä¹‰å®Œæˆï¼Œä¸éœ€è¦å…³å¿ƒä¸åŒåŽ‚å•†åº•å±‚å·®å¼‚åŒ–çš„å®žçŽ°ã€‚è€Œ Knative æ‰æ˜¯é¢å‘åº”ç”¨çš„ç¼–æŽ’ã€‚Knative å¯¹åº”ç”¨çš„ Serverless ç¼–æŽ’ä¸»è¦ä½“çŽ°åœ¨å¯¹ï¼šæµé‡çš„ç®¡ç†ã€ç°åº¦ç­–ç•¥å’Œå¼¹æ€§çš„ç®¡ç†ã€‚å¹¶ä¸”æµé‡ã€ç°åº¦å’Œå¼¹æ€§è¿™ä¸‰è€…æ˜¯å®Œç¾Žçš„å¥‘åˆåœ¨ä¸€èµ·çš„ã€‚ä»Žå¦ä¸€ä¸ªè§’åº¦æ¥è¯´ Knative æ˜¯å»ºç«‹åœ¨ Kubernetes ä¹‹ä¸Šçš„ï¼ŒKnative éœ€è¦ä½¿ç”¨ Kubernetes æä¾›çš„å¯¹ IaaS çš„æ ‡å‡†åŒ–æœåŠ¡ã€‚è¿™äºŒè€…æ˜¯ä¸Šä¸‹å±‚çš„ä¾èµ–å’Œè¢«ä¾èµ–çš„å…³ç³»ï¼Œä¸æ˜¯ç«žäº‰å…³ç³»ã€‚

> Q4ï¼šknative æœ‰å“ªäº›æˆåŠŸçš„è¡Œä¸šåº”ç”¨å®žè·µï¼Ÿ

A4ï¼šåœ¨é˜¿é‡Œäº‘ä¸Šé¢å·²ç»æœ‰å¾ˆå¤šç”¨æˆ·åœ¨ä½¿ç”¨äº†ã€‚å¦å¤– Google çš„ CloudRun äº§å“å®Œå…¨æ˜¯å»ºç«‹åœ¨ Knative ä¹‹ä¸Šçš„ã€‚

> Q5ï¼šknative çš„çŽ°çŠ¶å’Œé¢„æœŸè¾¾åˆ°çš„ç›®çš„?

A5ï¼šKnative çŽ°åœ¨å·²ç»è¢«ä¼—å¤šåŽ‚å•†å¼€å§‹æ”¯æŒäº†ï¼ŒKnative çš„ç›®æ ‡æ˜¯æ ‡å‡†åŒ–åº”ç”¨ Serverless ç¼–æŽ’æ¨¡åž‹ã€‚æ¯”å¦‚ï¼šé€šè¿‡ Knative å¯¹åº”ç”¨è¿›è¡Œç¼–æŽ’ï¼›é€šè¿‡ Knative æ”¯æ’‘ä¸Šå±‚ faas ç³»ç»Ÿå®žçŽ°ã€‚è¿™é‡Œè¯´çš„åº”ç”¨å…¶å®žä¸é™äºŽåœ¨çº¿æœåŠ¡ï¼Œå¾ˆå¤š AI ä»»åŠ¡ä¹Ÿæ˜¯é€šè¿‡ Knative é©±åŠ¨çš„ï¼Œæ¯”å¦‚åˆ†äº«ä¸­æåˆ°çš„ KFServing

> Q6ï¼šç¼©å®¹æ—¶ï¼Œæ€Žä¹ˆæ‰èƒ½å½“ pod å†…çš„æµé‡æ¶ˆè€—å®Œï¼Ÿåœ¨é”€æ¯ï¼Ÿ

A6ï¼šKubernetes ä¸­ Pod æ˜¯å¯ä»¥è®¾ç½® Prestop çš„ï¼ŒPrestop å¯ä»¥ä¿è¯å…ˆå¸è½½æµé‡ï¼Œç„¶åŽå†æ‘˜é™¤æœåŠ¡

> Q7ï¼šk8s åº”ç”¨æœåŠ¡å™¨å†…ç½‘æ— ç½‘ç»œï¼Œå…¥å£åªæœ‰ä¸€å° nginx åœ¨ dmz åŒºåŸŸå¯ä»¥å‡ºå…¬ç½‘ï¼ˆnginx ä¸Žåº”ç”¨æœåŠ¡å™¨ç½‘ç»œåªå¼€æ”¾è®¿é—® 31380/31390ï¼‰ï¼Œå½“ pods å®¹å™¨ç›´æŽ¥å›žè°ƒç¬¬ä¸‰æ–¹åŸŸåæ—¶ï¼Œè¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

A7ï¼šè¿™ä¸ªæ¶‰åŠåˆ°äº†å…·ä½“ä¸šåŠ¡æ¨¡åž‹å’Œç³»ç»Ÿæž¶æž„ï¼Œå¯ä»¥å•ç‹¬è”ç³»æˆ‘ä¸‹çº¿æ²Ÿé€š

> Q8ï¼šæ„Ÿè§‰ knative å°±æ˜¯å¦ä¸€ç§å½¢å¼çš„é…ç½®å³æœåŠ¡ï¼Œå’Œ jenkins X å‘å±•çš„å¼‚åŒ?

A8ï¼šKnative æ˜¯ä¸€ä¸ªåº”ç”¨ Serverless ç¼–æŽ’å¼•æ“Žï¼Œå¯ä»¥å¿«é€Ÿç»™æ™®é€šåº”ç”¨èµ‹äºˆ Serverless èƒ½åŠ›ã€‚æ¯”å¦‚æµé‡ã€ç°åº¦å’Œå¼¹æ€§çš„å®Œç¾Žç»“åˆã€‚å¦å¤– Knative çš„äº‹ä»¶æ¨¡åž‹å¯ä»¥å¯¹æŽ¥å¤–éƒ¨äº‹ä»¶åšåŸºäºŽäº‹ä»¶é©±åŠ¨çš„ Serverless æ¨¡åž‹ã€‚

> Q9ï¼šåœ¨ä¼ä¸šç§æœ‰äº‘çŽ¯å¢ƒéƒ¨ç½² knative ä¼šæœ‰å“ªäº›æŒ‘æˆ˜ï¼Ÿ

A9ï¼šåªè¦æ˜¯æ ‡å‡†çš„ Kubernetes é›†ç¾¤ä¹‹ä¸Šå°±èƒ½éƒ¨ç½² Knativeï¼Œä¸è¿‡å¾ˆå¤šé•œåƒéœ€è¦ç¿»å¢™

> Q10ï¼šé˜¿é‡Œäº‘ä¸Šçš„å®¹å™¨é•œåƒæœåŠ¡æ˜¯å¦‚ä½•å¤„ç†é‰´æƒçš„ï¼Ÿ

A10ï¼šå¯ä»¥å‚è€ƒé˜¿é‡Œäº‘é•œåƒä»“åº“çš„å®˜æ–¹æ–‡æ¡£ï¼š[cn-hangzhou/instances/authorize](https://cr.console.aliyun.com/cn-hangzhou/instances/authorize)ï¼Œ [cn-hangzhou/instances/credentials](https://cr.console.aliyun.com/cn-hangzhou/instances/credentials)

> Q11: istio å±‚é¢çš„ç®¡æŽ§å’Œç»´æŠ¤æˆæœ¬æ¯”è¾ƒé«˜ï¼Œå¦‚ envoy æ€§èƒ½é—®é¢˜ï¼Œç½‘ç»œé—®é¢˜ç­‰ï¼Œè¿™éƒ¨åˆ†å·¥ä½œæ˜¯ç”±äº‘å¹³å°è´Ÿè´£çš„å—ï¼Œknative è¿™è¾¹æœ‰æ²¡æœ‰ç›¸åº”æŽªæ–½

A11: ç›®å‰é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ Kubernetes é›†ç¾¤æŽ§åˆ¶å°å¯ä»¥é€šè¿‡ UI ç®¡ç† Istio å’Œ Knativeï¼Œå¯ä»¥å¿«é€Ÿä¸Šæ‰‹ã€‚æŽ§åˆ¶å°ä¹Ÿæä¾›äº†å¾ˆå¤šä¾¿æ·æ“ä½œé™ä½Žè¿ç»´æˆæœ¬ã€‚Knative ä¸»è¦ä¾èµ–äº† Istio çš„ Gatewayï¼ŒGateway æœ¬èº«æ˜¯å¯ä»¥æ¨ªå‘æ‰©å±•çš„ï¼Œä¸ä¼šæœ‰å¤ªå¤§å½±å“ã€‚

> Q12ï¼šå®¹å™¨çš„å†·å¯åŠ¨é—®é¢˜å¦‚ä½•è§£å†³ï¼Œç¬¬ä¸€ä¸ªæµé‡å²‚ä¸æ˜¯å»¶æ—¶å¾ˆé«˜?

A12: å¦‚æžœç¼©å®¹åˆ°é›¶ä»¥åŽï¼Œåˆ°ä¸€ä¸ªè¯·æ±‚çš„å»¶æ—¶æ˜¯ä¼šå¾ˆé«˜ã€‚ç¬¬ä¸€ä¸ªè¯·æ±‚å†·å¯åŠ¨çš„é—®é¢˜æ˜¯ä¸€ä¸ªå…¬è®¤çš„ä¸šç•Œéš¾é¢˜ï¼Œè¿™ä¹Ÿæ˜¯å„å¤§äº‘åŽ‚å•†åœ¨ç«žç›¸è§£å†³çš„é—®é¢˜ã€‚ç›¸æ¯”ä½¿ç”¨äº‘çš„å®¢æˆ·è€Œè¨€ï¼Œäº‘åŽ‚å•†è‡ªå·±å…¶å®žæ›´è¿«åˆ‡è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ•¬è¯·å…³æ³¨....

> Q13: knative çš„ç»„ä»¶æœ¬èº«æ€Žä¹ˆéƒ¨ç½²ï¼Ÿå¦‚ä½•ä¿è¯ HAï¼Ÿè°¢è°¢

A13: Knative æ˜¯å»ºç«‹åœ¨ Kubernetes ä¹‹ä¸Šçš„ï¼ŒKnative ç»„ä»¶å…¶å®žå°±æ˜¯ CRD çš„ Controllerã€‚åœ¨ Kubernetes ä¸­ Controller æ˜¯å¯ä»¥éƒ¨ç½²å¤šä¸ªå®žä¾‹ï¼Œé€šè¿‡æŠ¢é”ä¿è¯åªæœ‰ä¸€ä¸ª Controller å¯ä»¥æ‰§è¡Œå†™æ“ä½œã€‚HA çš„é—®é¢˜å®¹æ˜“è§£å†³ã€‚

---

### 2019-12-03ï¼šKubernetes åœ¨ä¿¡ä¹Ÿç§‘æŠ€çš„è½åœ°å®žæˆ˜

[æé—®é“¾æŽ¥](https://shimo.im/docs/3RkcgcPq3JjVtxwr)

> Qï¼šdns è®°å½•æ˜¯å¦‚ä½•ç»´æŠ¤çš„ï¼Œè¿˜æœ‰ maclvlan çš„è®°å½•çš„ç»´æŠ¤ï¼Ÿè°¢è°¢è€å¸ˆå›žç­”

Aï¼šdns ç³»ç»Ÿæˆ‘ä»¬å®žçŽ°äº† 2 ä¸ªæœåŠ¡ï¼Œä¸€ä¸ªæ˜¯ç›‘å¬åœ¨ 53 ç«¯å£æä¾› dns æŸ¥è¯¢çš„æœåŠ¡ï¼Œä¸€ä¸ªæ˜¯å‰å°ç®¡ç†ç«™ç‚¹ï¼Œå‰å°ç«™ç‚¹è´Ÿè´£ dns è®°å½•çš„å¢žåˆ æ”¹æŸ¥ã€‚æ”¯æŒå•ç‹¬è®¾ç½®å’Œæ‰¹é‡å¯¼å…¥åŠŸèƒ½ã€‚è¿™ 2 ä¸ªæœåŠ¡å…±äº«åŒä¸€ä¸ªæ•°æ®åº“ã€‚å†…å®¹çš„è¯æ˜¯ç”±ä¿¡ä¹Ÿç§‘æŠ€å„ä¸ªç ”å‘å›¢é˜Ÿå…±åŒç»´æŠ¤çš„ã€‚macvlan æ˜¯åœ¨æ¯å°å®¿ä¸»æœºä¸Šåˆ›å»ºçš„ã€‚æˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨æ¯å°å®¿ä¸»æœºä¸Šåˆ›å»ºå¤šä¸ª macvlan ç½‘æ®µã€‚

> Qï¼šMacvlan æ˜¯æ²¡æœ‰ serviceï¼Œé€‰æ‹© MacVLan æ˜¯åŸºäºŽå“ªäº›è€ƒè™‘å‘¢ï¼ŸMacVLan ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯¹äºŽä¸åŒçš„å†…æ ¸ç‰ˆæœ¬ï¼Œä¸åŒçš„é«˜å¯ç”¨ç»„ç½‘ï¼Œæ˜¯å­˜åœ¨å…¼å®¹æ€§é—®é¢˜çš„ï¼Œè¿™ä¸€å—å®žè·µèƒ½åˆ†äº«ä¸‹ä¹ˆï¼Ÿ

Aï¼šé€‰æ‹© macvlan ä¸€æ˜¯å› ä¸ºå®ƒçš„ç®€å•ï¼Œä½¿ç”¨ docker å‘½ä»¤å°±å¯ä»¥åˆ›å»ºå‡ºæ¥ï¼Œä¸éœ€è¦å…¶ä»–é…å¥—çš„æœåŠ¡æˆ–æ•°æ®åº“æ¥ç®¡ç†ã€‚äºŒæ˜¯å› ä¸ºå®ƒæœ‰ç‹¬ç«‹çš„ IP å’Œ MAC åœ°å€ï¼Œè¿™æ ·å¯ä»¥è®©ä¿¡ä¹Ÿç§‘æŠ€ä¹‹å‰è·‘åœ¨è™šæ‹Ÿæœºä¸Šçš„æœåŠ¡èƒ½å¤Ÿå¿«é€Ÿçš„è¿ç§»åˆ°å®¹å™¨ã€‚æˆ‘ä»¬å¯¹äºŽå®¿ä¸»æœºçš„å†…æ ¸ç‰ˆæœ¬æ˜¯ä¸¥æ ¼æŽ§åˆ¶çš„ï¼Œä¸å­˜åœ¨å†…æ ¸ç‰ˆæœ¬ä¸åŒçš„æƒ…å†µã€‚ä½†æ˜¯ macvlan çš„ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜Žæ˜¾ï¼Œå®ƒä¾èµ–äºŽç¡¬ä»¶ï¼Œå®¿ä¸»æœºéœ€è¦è¿žåˆ°äº¤æ¢æœº trunk å£ã€‚å¹¶ä¸”å®ƒçš„çµæ´»æ€§ä¹Ÿä¸å¤Ÿé«˜ï¼Œä¸é€‚åˆå¤§è§„æ¨¡çš„ç»„ç½‘ã€‚ç”±äºŽç›®å‰ä¿¡ä¹Ÿç§‘æŠ€å†…éƒ¨çš„ç½‘ç»œç»“æž„è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¹¶æ²¡æœ‰é‡åˆ°å…¼å®¹æ€§çš„é—®é¢˜ã€‚

> Qï¼šä¸ºä»€ä¹ˆä¸è¯•ç€å¯¹ k8s è‡ªåŠ¨æ›´æ–°å‘¢ï¼Œæ¯ä¸€æ¬¡æ‰‹åŠ¨æ›´æ–°éƒ½éœ€è¦ä¸€å®šçš„æ—¶é—´æˆæœ¬å§ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬è®¤ä¸ºæ‰‹åŠ¨æ›´æ–°æ¯”è¾ƒç¨³å¦¥ï¼Œå¹¶ä¸”æ›´æ–°ä¸æ˜¯ä¸€ä¸ªé¢‘ç¹çš„æ“ä½œï¼Œæ—¶é—´æˆæœ¬è¿˜å¥½ã€‚

> Qï¼šè¯·é—®ä¸‹ï¼Œè¿™ä¸ªæ˜¯è‡ªå»ºæœºæˆ¿çŽ¯å¢ƒä¸Šçš„é›†ç¾¤ï¼Ÿæ˜¯å¦é€‚ç”¨å…¬æœ‰äº‘çŽ¯å¢ƒï¼Ÿå¤–éƒ¨è®¿é—®æµé‡æ˜¯å¦‚ä½•æŽ¥å…¥çš„å‘¢ï¼Ÿingress controller åŸºäºŽä»€ä¹ˆè€ƒè™‘æ¥é€‰æ‹©çš„ï¼Œè°¢è°¢ã€‚

Aï¼šè¿™ä¸ªæ˜¯è‡ªå»ºæœºæˆ¿çŽ¯å¢ƒä¸Šçš„é›†ç¾¤ã€‚å¤–éƒ¨çš„æµé‡ä¼šå…ˆç»è¿‡ F5ï¼Œç„¶åŽç»è¿‡ nginx é›†ç¾¤ï¼Œæ‰€æœ‰çš„å®¹å™¨å®žä¾‹å’Œè™šæ‹Ÿæœºéƒ½æ˜¯é€šè¿‡ nginx è´Ÿè½½å‡è¡¡çš„ã€‚åœ¨ nginx ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨äº†æ–°æµªå¾®åšçš„ nginx-upsync-module æ¨¡å—ï¼Œå¯ä»¥ä»Ž consul åŒæ­¥ upstream ä¸­çš„å®žä¾‹ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ingress controllerï¼Œè€Œæ˜¯é€šè¿‡ç”¨æˆ·åœ¨æˆ‘ä»¬çš„å®¹å™¨å‘å¸ƒå¹³å°ä¸ŠåŽ»æ‰‹åŠ¨çš„æ‹‰å…¥å’Œæ‹‰å‡ºæµé‡ã€‚ç”¨æˆ·æ‹‰å…¥æµé‡çš„æ“ä½œä¼šåœ¨ consul é‡Œé¢æ·»åŠ å®žä¾‹çš„ IP å’Œç«¯å£ï¼Œnginx è‡ªåŠ¨ä»Ž consul åŒæ­¥å®žä¾‹åŽè¯¥å®žä¾‹å°±æŽ¥å…¥æµé‡äº†ã€‚

> Qï¼šç›´æŽ¥ä½¿ç”¨ Pod çš„è¯ï¼Œå‰¯æœ¬æŽ§åˆ¶æ˜¯å¦‚ä½•åšçš„

Aï¼šå‰¯æœ¬æŽ§åˆ¶ç›®å‰æ˜¯æ¯”è¾ƒé™æ€çš„ã€‚ç”¨æˆ·åœ¨å®¹å™¨å‘å¸ƒå¹³å°éƒ¨ç½²å¯ä»¥é€‰æ‹©å‰¯æœ¬æ•°ã€‚æ­¤åŽå¦‚æžœç”¨æˆ·ä¸æ·»åŠ å’Œåˆ é™¤å®žä¾‹é‚£ä¹ˆå‰¯æœ¬æ•°æ˜¯ä¸ä¼šå˜çš„ã€‚

> Q: å¦‚ä½•æ›´æ–°è¯ä¹¦

Aï¼šå…ˆé‡æ–°ç”Ÿæˆè¯ä¹¦ï¼Œç„¶åŽå…ˆåœ¨ master èŠ‚ç‚¹ä¸Šæ›´æ–°ï¼Œéœ€è¦ä¾æ¬¡é‡å¯ etcdã€apiserverã€controller-manager å’Œ scheduler æœåŠ¡ã€‚master æ›´æ–°å®Œæ¯•åŽï¼Œå†æŠŠæ‰€æœ‰çš„ node èŠ‚ç‚¹ä¸Šè¯ä¹¦æ›´æ–°ä¸€ä¸‹ï¼Œéœ€è¦é‡å¯ kubeletã€‚è¯ä¹¦çš„æ›´æ–°è¿‡ç¨‹ä¸­é™¤äº†é€ æˆé›†ç¾¤çš„çŸ­æš‚ä¸å¯ç”¨ä¹‹å¤–ä¸ä¼šå½±å“å·²ç»è¿è¡Œçš„å®¹å™¨çš„ï¼Œæ‰€ä»¥æ˜¯å®‰å…¨çš„ã€‚

> Qï¼šè“ç»¿å‘å¸ƒå’Œç°åº¦å‘å¸ƒæ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šè¿™ 2 ä¸ªéƒ½æ˜¯é€šè¿‡æˆ‘ä»¬çš„å®¹å™¨å‘å¸ƒå¹³å°å®žçŽ°ã€‚è“ç»¿å‘å¸ƒæ˜¯é€šè¿‡åˆ›å»º 2 ä¸ªå‘å¸ƒç»„ï¼Œæ¯ä¸ªå‘å¸ƒç»„å«æœ‰ç›¸åŒçš„å®žä¾‹æ•°ã€‚é€šå¸¸ä¸€ä¸ªå‘å¸ƒç»„å«æœ‰å½“å‰ç‰ˆæœ¬çš„å®žä¾‹å¹¶ä¸”æ˜¯æŽ¥å…¥æµé‡çš„ï¼Œå¦å¤–ä¸€ä¸ªå‘å¸ƒç»„åŒ…å«ä¸Šä¸€ç‰ˆæœ¬çš„å®žä¾‹æˆ–è€…æ˜¯å³å°†ä¸Šçº¿ç‰ˆæœ¬çš„å®žä¾‹ã€‚é€šè¿‡åœ¨ 2 ä¸ªå‘å¸ƒç»„åˆ‡æ¢æµé‡æ¥ä¸Šçº¿æ–°ç‰ˆæœ¬æˆ–å›žæ»šåˆ°æ—§ç‰ˆæœ¬ã€‚ç°åº¦å‘å¸ƒå¯ä»¥å…ˆä¸Šçº¿ä¸€ä¸ªå®žä¾‹çš„æµé‡ï¼Œæ²¡é—®é¢˜ä¹‹åŽå¯ä»¥æŠŠå‰©ä¸‹çš„å®žä¾‹éƒ½æŽ¥å…¥æµé‡ã€‚è¿™äº›æ“ä½œç›®å‰éƒ½æ˜¯å¹³å°ä¸Šç”¨æˆ·æ‰‹åŠ¨æ“ä½œå®žçŽ°çš„ã€‚

> Qï¼šé›†ç¾¤å¹³å°çš„é«˜å¯ç”¨æ˜¯æ€Žä¹ˆåšäº†ï¼Ÿæœ‰æ²¡æœ‰åšå¤šé›†ç¾¤å¤šæ´»æˆ–è€…ç¾å¤‡ï¼Ÿ

Aï¼šæˆ‘ä»¬ç”Ÿäº§çŽ¯å¢ƒæœ‰éƒ¨ç½²å¤šä¸ª k8s é›†ç¾¤ï¼Œä¹Ÿæœ‰ 2 ä¸ªä¸åŒçš„æœºæˆ¿éƒ¨ç½²ã€‚æˆ‘ä»¬çš„å®¹å™¨å‘å¸ƒå¹³å°ä¼šæŠŠå®žä¾‹å‡è¡¡åˆ†å‘åˆ°ä¸åŒçš„ k8s é›†ç¾¤ã€‚

> Qï¼šå¼€å‘æµ‹è¯•çŽ¯å¢ƒçš„é•œåƒä»“åº“å¦‚ä½•åŒæ­¥åˆ°ç”Ÿäº§é•œåƒä»“åº“ï¼Ÿ

Aï¼šé•œåƒä»“åº“æˆ‘ä»¬æµ‹è¯•å’Œç”Ÿäº§ç”¨çš„æ˜¯åŒä¸€å¥—ã€‚ å…¬å¸ä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„æ‰˜ç®¡ç‰ˆ k8s ä¸Ž,å‘çŽ°æ‰˜ç®¡ç‰ˆçš„ k8s å¹¶æ²¡æœ‰å¤šä¸ªä¸»èŠ‚ç‚¹,é—®ä¸€ä¸‹é˜¿é‡Œçš„æ‰˜ç®¡ç‰ˆ k8s ä¸Žæ ‡å‡†ç‰ˆ k8s

> Qï¼šé—®ä¸€ä¸ªç»†èŠ‚é—®é¢˜ï¼Œè¯·é—® k8s é›†ç¾¤æ‰©å®¹æ˜¯é€šè¿‡ä»€ä¹ˆæ‰‹æ®µå®žçŽ°çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬å®žçŽ°äº†ä¸€å¥— ansible è„šæœ¬åŽ»å®žçŽ°è‡ªåŠ¨æ·»åŠ  node èŠ‚ç‚¹ã€‚

> Qï¼šæˆ‘ä»¬ä¹Ÿæ˜¯ç”¨çš„ macvlanï¼Œè¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œä½ ä»¬ä¸ºä»€ä¹ˆæ²¡ç”¨ cni é…ç½®ç½‘ç»œï¼Œè€Œæ˜¯ç”¨çš„ docker æ¥é…ç½®ï¼Œè¿™æ ·ç»´æŠ¤æˆæœ¬é«˜ä¸€äº›ã€‚å¦å¤–ï¼Œmacvlan æ¨¡å¼ï¼Œä¸»æœºæ— æ³•è®¿é—®æœ¬æœºå†…çš„å®¹å™¨ï¼Œè¿™ä¸ªæ€Žä¹ˆè§£å†³çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯ç”¨ docker å‘½ä»¤åŽ»åˆ›å»º macvlanï¼Œå®žé™…è¿˜æ˜¯ä½¿ç”¨ k8s çš„ cniã€‚ä½¿ç”¨ vlan ä¹‹åŽå¯ä»¥è§£å†³ä¸»æœºæ— æ³•è®¿é—®æœ¬æœºå†…çš„å®¹å™¨ã€‚

> Qï¼šingress ç”¨çš„ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆé€‰æ‹©å®ƒï¼Ÿ

Aï¼šè§ Q5 é—®é¢˜çš„å›žç­”

> Qï¼šåˆšæ‰æåˆ°èŠ‚ç‚¹è¯ä¹¦è¿‡æœŸå¯¼è‡´é›†ç¾¤å¼‚å¸¸ï¼Œk8s æœ¬èº«ä¼šåœ¨èŠ‚ç‚¹å¼‚å¸¸ä»¥åŽï¼Œè°ƒåº¦è¿ç§»éžæ­£å¸¸èŠ‚ç‚¹çš„å®žä¾‹çš„ã€‚æˆ‘çš„é—®é¢˜æ˜¯ï¼Œå¦‚æžœè¯ä¹¦æ›´æ–°éœ€è¦ä¸€ä¸ªè¿‡ç¨‹ï¼Œé‚£ä¹ˆï¼ŒèŠ‚ç‚¹æ¢å¤ä¹Ÿæ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä»åœ¨å¼‚å¸¸çš„èŠ‚ç‚¹å®žä¾‹ï¼Œä¼šè¿ç§»åˆ°æ­£å¸¸èŠ‚ç‚¹ï¼Œè€Œä¸”ï¼Œå› ä¸º corednså’Œingress å¯¹æŽ¥çš„æ˜¯ apiserverï¼Œé‚£ä¹ˆï¼ŒèŠ‚ç‚¹å¼‚å¸¸åŸºæœ¬ä¸Šç­‰åŒäºŽè¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„å®žä¾‹ï¼Œéƒ½ä¼šè¢« apisercer æ‘˜æŽ‰ï¼Œè™½ç„¶å®¹å™¨ä¹Ÿè¿˜åœ¨ï¼Œä½†æ˜¯æµé‡å…¥å£å’Œ dns ä¾§å®žä¾‹ä¸åœ¨äº†ï¼Œè¿™æ ·ä¸€æ¥ï¼Œè¯ä¹¦è¿‡æœŸï¼Œä¸å°±ç­‰åŒäºŽæ‰€æœ‰å®žä¾‹å…¨éƒ¨ä¸å¯ç”¨å˜›ï¼Ÿ

Aï¼šå› ä¸ºæˆ‘ä»¬åªç”¨äº† k8s ä¸­çš„ podï¼Œå¹¶ä¸”å…³é—­äº† k8s ä¸­çš„å¼‚å¸¸èŠ‚ç‚¹è‡ªåŠ¨è¿ç§»å®žä¾‹çš„åŠŸèƒ½ã€‚è¿™äº›é«˜å¯ç”¨åŠŸèƒ½æˆ‘ä»¬è‡ªå·±å®žçŽ°äº†ä¸€ä¸ªç±»ä¼¼çš„ï¼Œè¿™æ ·å¯ä»¥æŒ‰æˆ‘ä»¬çš„éœ€è¦åŽ»å®šåˆ¶ã€‚coredns æˆ‘ä»¬åªæ˜¯ç®€å•çš„ç”¨æ¥ä½œä¸º dns æœåŠ¡å™¨ï¼Œå¹¶æ²¡æœ‰å’Œ apiserver å¯¹æŽ¥ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨ingressï¼Œè§ Q5 çš„å›žç­”ã€‚

> Qï¼šæƒ³é—®ä¸‹è€å¸ˆä½ ä»¬ç›®å‰æ˜¯å‰åŽç«¯å®Œå…¨åˆ†ç¦»çš„ä¹ˆï¼Ÿç›®å‰çš„å‰ç«¯åº”ç”¨éƒ¨ç½²æ–¹å¼æ˜¯æ€Žæ ·çš„ï¼Ÿå¦‚ä½•æŽ§åˆ¶ä¸€äº›å‰ç«¯çš„å‘å¸ƒå·¥ä½œæµï¼Ÿä»¥åŠä¸Žå‰ç«¯ç›¸å…³çš„åŽç«¯å¾®æœåŠ¡éƒ¨åˆ†ï¼Œæ˜¯å¦‚ä½•ä¿è¯å‘å¸ƒé¡ºåºä»¥åŠå…³è”æ€§çš„ã€‚

Aï¼šç›®å‰æˆ‘ä»¬ä¸Šå®¹å™¨çš„è¿˜æ˜¯ä»¥ java ä¸ºä¸»çš„åŽç«¯æœåŠ¡åå¤šã€‚ç›®å‰èƒ½äº†è§£åˆ°çš„æ˜¯å‰ç«¯åº”ç”¨éƒ½æ˜¯æ”¾åˆ° nginx ä¸­æ¥å¯¹å¤–æä¾›æœåŠ¡çš„ã€‚å¯¹äºŽå‰ç«¯å‘å¸ƒçš„å·¥ä½œæµä»¥åŠå¦‚ä½•ä¿è¯å‘å¸ƒé¡ºåºä»¥åŠå…³è”æ€§çš„ç›®å‰éƒ½æ˜¯é€šè¿‡äººè‚‰åŽ»æŽ§åˆ¶å’Œå®Œæˆçš„ï¼Œæ²¡æœ‰åšåˆ°è‡ªåŠ¨åŒ–ã€‚

---

### 2019-11-26ï¼šåŸºäºŽ CDN çš„è¾¹ç¼˜è®¡ç®—å¹³å°è®¾è®¡å’Œæ€è€ƒ

[æé—®é“¾æŽ¥](https://shimo.im/docs/pkxrK9PGDcVgXpkx)

> Qï¼šé˜¿é‡Œçš„ edge æœ‰ç”¨åœ¨é˜¿é‡Œçš„ cdn ä¸Šå—

Aï¼šç›®å‰æˆ‘ä»¬ä»¥åŠæœ‰å¯¹å¤–çš„äº§å“ ENSï¼Œå½¢æ€ä¸Šå°±æ˜¯åœ¨ CDN èŠ‚ç‚¹å”®å–è™šæ‹Ÿæœºã€‚å¦å¤–æˆ‘ä»¬åœ¨åšçš„å¦ä¸€è§äº‹æƒ…ï¼Œå°±æ˜¯æŠŠ CDN ä¸šåŠ¡è¿ç§»åˆ°å®¹å™¨é‡Œé¢ï¼Œè¿™æ ·åˆ°ç›®çš„å°±æ˜¯æœ€å¤§åŒ–é‡Šæ”¾ CDN çš„èµ„æºå’Œèƒ½åŠ›ã€‚

> Qï¼šèƒ½å¦ä»‹ç»ä¸€ä¸‹ï¼Œç›®å‰ cdn èŠ‚ç‚¹æ”¹é€ æˆè¾¹ç¼˜è®¡ç®—èŠ‚ç‚¹ï¼Œä¸»è¦æ¶‰åŠå“ªäº›æ–¹é¢æ”¹é€ ï¼Œé˜¿é‡Œçš„å®žè·µæƒ…å†µï¼Œè°¢è°¢ã€‚

Aï¼šç›®å‰ CDN æ”¹é€ æœ‰ 3 ä¸ªéƒ¨åˆ†ï¼šåŸºç¡€è®¾æ–½åˆ°æ”¹é€ ï¼ˆäº¤æ¢æœºã€æœºåž‹)ï¼Œè½¯ä»¶å±‚é¢çš„æ”¹é€ ï¼ˆå®¹å™¨åŒ–)ï¼ŒCDN èŠ‚ç‚¹æž¶æž„çš„æ”¹é€ ï¼ˆæ¯”å¦‚æŠŠä¼ ç»Ÿçš„ 7 å±‚è´Ÿè½½å‡è¡¡æ”¹æˆ K8S çš„ Ingress Controller)

> Qï¼šç›®å‰åœ¨è¾¹ç¼˜çš„ ENS èŠ‚ç‚¹ï¼Œæœ‰æä¾› GPUï¼Œç‰©ç†æœºç­‰äº§å“å—ï¼Ÿ

Aï¼šENS èƒ½åŠ›ä¸Šæ˜¯å¯¹é½é˜¿é‡Œäº‘ ECS çš„ï¼Œç›®å‰æä¾› CPU å’Œ GPUï¼Œç¥žé¾™è£¸é‡‘å±žå¦‚æžœæœ‰éœ€è¦ä¹Ÿæ˜¯å¯ä»¥æ”¯æŒçš„ã€‚

> Qï¼šCDN åœºæ™¯çš„è½åœ°åœºæ™¯æ¥è¯´ï¼Œå½¢æ€ä¸Šå°±æ˜¯åœ¨äº‘ä¸­å¿ƒéƒ¨ç½² Kuberentes Masterï¼Œå°†äº‘ä¸­å¿ƒæ‰€åœ¨ Region é™„è¿‘çš„ CDN èŠ‚ç‚¹æŽ¥å…¥åˆ° Kubrentes ä¸­ ï¼ŒæŒ‡çš„æ˜¯åœ¨å„ä¸ª Region é‡Œé¢çš„èŠ‚ç‚¹å½“ä½œ k8 çš„ node å¤„ç†å— ï¼Ÿ

Aï¼šæ¯”å¦‚æˆ‘ä»¬åœ¨é˜¿é‡Œäº‘ä¸­å¿ƒçš„æ­å·ž Region åˆ›å»ºä¸€ä¸ª K8S Masterï¼Œç„¶åŽä¼šæŠŠæ­å·žæ•´ä¸ªçœçš„ CDN èŠ‚ç‚¹ï¼Œå…¨éƒ¨æŽ¥å…¥åˆ°è¿™ä¸ª K8S Master é‡Œé¢ï¼ŒCDN èŠ‚ç‚¹æŒ‡çš„æ˜¯ä¸€ä¸ªæœºæˆ¿ï¼Œä¸€ä¸ªæœºæˆ¿ä¼šæœ‰ 1ï½ž100 å°æœºå™¨ï¼Œæ•´ä¸ª CDN èŠ‚ç‚¹çš„æœºå™¨éƒ½ä¼šæŽ¥å…¥ã€‚

> Qï¼šè¯·é—®é˜¿é‡Œè¾¹ç¼˜è®¡ç®—æœ‰å’Œ 5g ç»“åˆçš„è®¡åˆ’å—?å…·ä½“æœ‰å“ªäº›ç»“åˆç‚¹?

Aï¼šåœ¨ä»Šå¹´äº‘æ –å¤§ä¼šä¸Šï¼Œæˆ‘ä»¬ä»¥åŠå‘å¸ƒäº† 5G è¾¹ç¼˜è®¡ç®—æˆ˜ç•¥ï¼Œè¿™ä¸ªå¯ä»¥ç½‘ä¸Šæ‰¾ä¸‹è§†é¢‘å›žæ”¾ã€‚å…·ä½“çš„ç»“åˆç‚¹ç›®å‰æ¥çœ‹æ˜¯åŸŽå¸‚å¤§è„‘å’ŒåŸŽå¸‚äº‘ã€‚ä¸è¿‡å› ä¸º 5G è¿˜æœªå¤§è§„æ¨¡å•†ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿåœ¨æŽ¢ç´¢ã€‚[link](https://yunqi.youku.com/2019/hangzhou/review?spm=a2c4e.11165380.1395223.1)

> Qï¼šè¯·é—®æœªæ¥ docker ä¼šå‘å®‰å…¨å®¹å™¨è½¬åž‹å˜›ï¼Ÿå®‰å…¨å®¹å™¨æ˜¯è¶‹åŠ¿,ä½œä¸ºå¼€å‘è€…è¦æ³¨æ„å“ªäº›ç‚¹ï¼Ÿ

Aï¼šå…¶å®ž kata å’Œæ™®é€š runc å®¹å™¨ï¼Œåœ¨è¡Œä¸ºä¸Šæ²¡æœ‰å¤ªå¤§å·®åˆ«ï¼Œå¦‚æžœéžè¦è¯´å…³æ³¨ç‚¹çš„è¯ï¼Œç›®å‰æˆ‘è§‰å¾—æ˜¯å†…æ ¸éƒ¨åˆ†ï¼Œå› ä¸º kata å®¹å™¨å¯¹äºŽå†…æ ¸è¦æ±‚æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œç¨³å®šæ€§æ–¹é¢è¿˜éœ€è¦æ‰“ç£¨ã€‚

> Qï¼šç›®å‰é˜¿é‡Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ¯”è¾ƒæˆç†Ÿçš„æˆ–è€…å·²ç»åœ¨è®¡åˆ’ä¸­çš„è¾¹ç¼˜è®¡ç®—ç›¸å…³é¡¹ç›®ï¼Ÿå…¬å¸å†…éƒ¨å¯¹äºŽè¾¹ç¼˜è®¡ç®—çš„æ”¯æŒç¨‹åº¦æ˜¯æ€Žä¹ˆæ ·çš„?ï¼ˆè½ç‚¹å¾ˆå¤šï¼Œç»“åˆ 5g ç­‰æ–°å½¢å¼ï¼Œç›¸å¯¹æ„Ÿè§‰è§†é¢‘åˆ†æžç­‰ä¼ ç»Ÿ cv æ–¹é¢å¯èƒ½åº”ç”¨æ€§æ›´å¼ºä¸€ç‚¹

Aï¼šENS å°±æ˜¯æˆ‘ä»¬æˆç†Ÿçš„å¯¹å¤–äº§å“ï¼Œæˆ‘ä»¬å¯¹äºŽè¾¹ç¼˜è®¡ç®—çš„æŠ•å…¥ä¹Ÿæ˜¯ä¸æƒœä»£ä»·çš„ã€‚å…·ä½“åœºæ™¯æˆ‘ä»¬çŽ°åœ¨ä¹Ÿåœ¨è·Ÿæˆ‘ä»¬çš„å®¢æˆ·ã€è¿è¥å•†éƒ½æœ‰å¹¿æ³›åˆä½œã€‚åªè¦æœ‰éœ€æ±‚æˆ–è€…åˆä½œæ„å‘éƒ½å¯ä»¥æ‰¾æˆ‘æ²Ÿé€šã€‚

> Qï¼šåœ¨äº‘ä¸Šéƒ¨ç½² k8s master èŠ‚ç‚¹ï¼Œcdn èŠ‚ç‚¹ä½œä¸ºè¾¹ç¼˜èŠ‚ç‚¹ã€‚å¯¹ k8s æ¥è¯´ï¼ŒèŠ‚ç‚¹ä¹‹å‰çš„ç½‘ç»œé€šè®¯è¦æ±‚ä¼šæ¯”è¾ƒé«˜ï¼Œé‚£å½“ç½‘ç»œä¸ç¨³å®šæ—¶ï¼Œè¾¹ç¼˜èŠ‚ç‚¹å’Œ master èŠ‚ç‚¹æ–­å¼€ï¼Œè¿™æ—¶å¦‚ä½•å®žçŽ°è¾¹ç¼˜èŠ‚ç‚¹ä¸Šçš„æœåŠ¡è‡ªæ²»å‘¢ï¼Ÿ

Aï¼šè¿™ä¸ªå°±æ˜¯ ACK@Edge è§£å†³çš„é—®é¢˜äº†ï¼ŒACK@Edge åœ¨è¾¹ç¼˜æµ‹æœºå™¨ä¸Šéƒ¨ç½²äº†ä¸€ä¸ª Edgehub çš„ç»„ä»¶ï¼Œkubelet å¹¶ä¸æ˜¯ç›´æŽ¥è¯·æ±‚ kube-apiserverï¼Œè€Œæ˜¯é€šè¿‡ edgehub ç„¶åŽå†è¯·æ±‚åˆ° APIServerã€‚edgehub åšäº†ç¼“å­˜å’Œä»£ç†çš„èƒ½åŠ›ï¼Œå³ä½¿åœ¨æ–­ç½‘çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½ä¿éšœè¾¹ç¼˜èŠ‚ç‚¹çš„ kubelet æ­£å¸¸å·¥ä½œã€‚è¿™ä¸ªèƒ½åŠ›å«åšè¾¹ç¼˜è‡ªæ²»ï¼Œæ˜¯ ACK åŠ å¼ºçš„èƒ½åŠ›ã€‚

> Qï¼šè¯·è°ˆè°ˆé˜¿é‡Œçœ‹åˆ°çš„è¾¹ç¼˜è®¡ç®— cover çš„çœŸå®žä»·å€¼åœºæ™¯æˆ–è€…å®¢æˆ·ç¾¤ï¼Œæ„Ÿè§‰å¾ˆå¤šçŽ°æœ‰åœºæ™¯ä¸­å¿ƒè®¡ç®—ä¹Ÿèƒ½æ»¡è¶³ï¼Œä¸ä¸€å®šè¦ç”¨è¾¹ç¼˜è®¡ç®—ã€‚ç‰¹åˆ«æ˜¯è¾¹ç¼˜è®¡ç®—èŠ‚ç‚¹ä¹Ÿå–è™šæœºï¼Œä»·å€¼ä¸å¤§ã€‚è°¢è°¢ã€‚

Aï¼šä»¥ cdn ä¸ºä¾‹ï¼Œcdn å°±æ˜¯é€šè¿‡è¾¹ç¼˜åšåŠ é€Ÿæ¥æé«˜ç”¨æˆ·ä½“éªŒã€‚è™šæ‹Ÿåªæ˜¯ä¸€ç§å½¢æ€ï¼Œæ¯”å¦‚ä½ è´­ä¹°è™šæ‹Ÿæœºè‡ªå»º cdnã€‚æ‰€ä»¥è¾¹ç¼˜çš„åœºæ™¯è‚¯å®šæ˜¯è·Ÿä¸­å¿ƒä¸ä¸€æ ·ï¼Œæ¯”å¦‚åŸŽå¸‚å¤§è„‘ï¼Œå°±æ˜¯éœ€è¦åœ¨å°±è¿‘æœ‰ä¸ªèŠ‚ç‚¹å¯ä»¥åšæŽ¥å…¥ï¼Œå¦‚æžœå…¨éƒ¨å›žä¸­å¿ƒï¼Œå¯¹ä¸­å¿ƒçš„åŽ‹åŠ›ä¹Ÿå¾ˆå¤§ã€‚

> Qï¼šé˜¿é‡Œåœ¨è¾¹ç¼˜å­˜å‚¨ä¸Šæœ‰ä»€ä¹ˆè®¡åˆ’å—ï¼Œèƒ½ä»‹ç»ä¸€ä¸‹æ˜¯å¦æœ‰ä¸šåŠ¡ä¼šéœ€è¦æŠŠå¤§é‡æ•°æ®å­˜å‚¨åœ¨è¾¹ç¼˜ï¼Ÿ

Aï¼šENS èŠ‚ç‚¹çš„è™šæ‹Ÿæœºæä¾›äº‘ç›˜çš„ï¼Œä½†æ˜¯å¹¶ä¸å»ºè®®æŠŠå¤§é‡å­˜å‚¨æ”¾åœ¨ è¾¹ç¼˜ã€‚å› ä¸ºè¾¹ç¼˜çš„å­˜å‚¨å†—ä½™å¹¶æ²¡æœ‰ä¸­å¿ƒé‚£ä¹ˆé«˜ï¼Œå°±åƒæˆ‘è¯´çš„ï¼Œç›®å‰ä¸å»ºè®®åœ¨è¾¹ç¼˜éƒ¨ç½²å¯¹æ•°æ®å¯é æ€§è¦æ±‚éžå¸¸é«˜çš„ä¸šåŠ¡ã€‚

> Qï¼šè¯·é—®å®‰å…¨å®¹å™¨çš„å­˜å‚¨æ€§èƒ½æœ‰è€ƒè™‘è¿‡ä¹ˆï¼ŸæŽ¥å…¥ç‚¹åœ¨è¾¹ç¼˜è¿˜æ˜¯æ”¾äº‘ç«¯ï¼Ÿ

Aï¼šå®‰å…¨å®¹å™¨æœ€ç»ˆæ˜¯è·‘ç€è¾¹ç¼˜ä¸Šçš„ï¼Œå®‰å…¨å®¹å™¨çš„å­˜å‚¨ç›®å‰æ˜¯ä¸€ä¸ªå¤§çš„é—®é¢˜ï¼Œkata å¼€æºçš„å­˜å‚¨æ–¹æ¡ˆæ€§èƒ½å¹¶ä¸å¥½ã€‚é˜¿é‡Œäº‘çš„å†…æ ¸å›¢é˜Ÿåšäº†å¤§é‡çš„ä¼˜åŒ–ï¼Œç›®å‰åº”è¯¥æœ‰äº†æ¯”è¾ƒå¤§çš„æ€§èƒ½æ”¹è¿›ã€‚

> Qï¼šè¯·é—® ACK@Edge æ˜¯å¼€æºçš„å—ï¼Ÿ

Aï¼šACK@Edge æ˜¯é˜¿é‡Œäº‘ä¸Šçš„äº§å“ï¼Œç›®å‰å·²ç»åœ¨å…¬æµ‹ä¸­ï¼Œå¯ä»¥ç›´æŽ¥åœ¨é˜¿é‡Œäº‘å®˜ç½‘å¼€é€šä½¿ç”¨ã€‚

> Qï¼šå®¹å™¨å®‰å…¨æ–¹é¢æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„ï¼Ÿé™¤äº† kata ä¹‹å¤–ï¼Œä½¿ç”¨ dockerd ä¸Ž k8s æœ‰ä»€ä¹ˆå®‰å…¨å»ºè®® psp ä¹‹ç±»çš„ï¼Ÿ

Aï¼šå®‰å…¨å®¹å™¨çš„ä½¿ç”¨ï¼Œç¬¬ä¸€ K8S éœ€è¦åšé€‚é… runtimeClassï¼Œç¬¬äºŒå†…æ ¸ä¹Ÿè¦æ±‚æ¯”è¾ƒé«˜ï¼ˆåº”è¯¥æ˜¯è¦ 4.*å†…æ ¸æ¯”è¾ƒæ–‡æ¡£)
å®‰å…¨å»ºè®®ï¼šå°±æ˜¯åŠ è¯ä¹¦ã€æ”¹ç«¯å£ï¼Œä¸ç„¶å®¹æ˜“è¢«å¤–éƒ¨æ³¨å…¥å®¹å™¨ã€‚å…¶ä»–çš„å®‰å…¨å»ºè®®ï¼šå°±æ˜¯ç›´æŽ¥ä½¿ç”¨äº‘ä¸Šäº§å“ï¼Œäº‘ä¸Šäº§å“å…·å¤‡äº†æ¯”è¾ƒé«˜çš„å®‰å…¨èƒ½åŠ›ã€‚

> Qï¼šæŽ¥ Q8 é—®é¢˜ï¼Œå¦‚æžœäº‘ä¸Š master å’Œè¾¹ç¼˜èŠ‚ç‚¹ç½‘ç»œæ¢å¤äº†ï¼Œä½† master èŠ‚ç‚¹ä¸Šçš„ pod çš„çŠ¶æ€å’Œè¾¹ç¼˜èŠ‚ç‚¹ä¸Šçš„æœåŠ¡çš„çŠ¶æ€ä¸ä¸€è‡´ï¼ˆæ–­å¼€æ—¶é—´é•¿åŽï¼Œäº‘ä¸Š pod çš„çŠ¶æ€é€šå¸¸æ˜¯ terminating çŠ¶æ€ï¼Œè€Œè¾¹ç¼˜èŠ‚ç‚¹ä¸Šçš„æœåŠ¡ä»èƒ½æ­£å¸¸å·¥ä½œ)ï¼Œè¿™æ—¶å€™å¦‚ä½•è§£å†³å‘¢ï¼Ÿç½‘ç»œæ¢å¤åŽï¼Œä¼šå°†è¾¹ç¼˜èŠ‚ç‚¹çš„æœåŠ¡é‡å¯å—ï¼Ÿæ¯”å¦‚ pod é‡å»ºï¼Ÿ

Aï¼šç½‘ç»œæ¢å¤åŽï¼Œå°±æ˜¯ç»§ç»­å¾€ K8S è®¾ç½®çš„ç»ˆæ€å˜åŒ–äº†ï¼Œæ¯”å¦‚ä¸­å¿ƒæŠŠ Pod åˆ äº†ï¼Œé‚£ä¹ˆç½‘ç»œæ¢å¤åŽè‡ªç„¶ç›¸åº”çš„ Pod å°±ä¼šè¢«åˆ é™¤ã€‚å› ä¸ºæœ‰ edghub çš„å­˜åœ¨ï¼Œpod æ˜¯ä¸ä¼šå¤„äºŽ terminating çŠ¶æ€çš„ã€‚ä¸è¿‡å…·ä½“ç»†èŠ‚å¯ä»¥ä»”ç»† ACK çš„åŒå­¦ï¼Œåœºæ™¯å’Œéœ€æ±‚å¯èƒ½ä¸å¤§ä¸€æ ·ã€‚

> Qï¼šCDN çš„æµé‡åˆ†é…æ˜¯åœ¨å“ªé‡Œåšçš„ï¼Ÿæ˜¯ DNS è¿˜æ˜¯ GSLB é‚£ç§?å¼‚åœ°ç¾å¤‡ä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼?

Aï¼šCDN çš„æµé‡åˆ†é…å°±æœ‰ DNSã€HTTPDNSã€302 è°ƒåº¦ï¼ŒCDN æœ¬èº«å°±æ˜¯æˆç†Ÿçš„æŠ€æœ¯äº†ï¼Œè°ƒåº¦è¿™å—éƒ½æ˜¯éžå¸¸æˆç†Ÿçš„æŠ€æœ¯ã€‚

> Qï¼šæƒ³é—® edge èŠ‚ç‚¹çš„å‡çº§é—®é¢˜ï¼Ÿæ¯”å¦‚æœ‰äº†é‡å¤§ CVE æˆ–è€… 0dayï¼Ÿæˆ–è€…å’Œ master ç‰ˆæœ¬å·®å¤ªå¤šï¼Ÿ

Aï¼šå‡çº§çš„è¯ï¼Œæˆ‘ä»¬ç›®æ ‡ä¿æŒè·Ÿ ACK ä¸­å¿ƒåŒæ­¥çš„èŠ‚å¥ã€‚ä¸»è¦æ ¹æ® ACK æä¾›çš„ä¿¡æ¯ã€‚

> Qï¼šè¯·é—®æ‚¨é‚£å—å®¹å™¨ä¸»è¦è·‘åœ¨è™šæ‹Ÿæœºè¿˜æ˜¯ç‰©ç†æœºä¸Šï¼Ÿ

Aï¼šéƒ½æœ‰

---

### 2019-11-21ï¼šç»™ K8s API â€œåšå‡æ³•â€ï¼šé˜¿é‡Œäº‘åŽŸç”Ÿåº”ç”¨ç®¡ç†çš„æŒ‘æˆ˜å’Œå®žè·µ

[æé—®é“¾æŽ¥](https://shimo.im/docs/TX63YhJ8VjVvYXkW)

> Qï¼š rudr æ˜¯æœ‰æŸå…¬å¸å®žé™…çº¿ä¸Šä½¿ç”¨åŽå¼€æºçš„ï¼Œè¿˜æ˜¯çº¯å¼€æºé¡¹ç›®ï¼Ÿ

A1ï¼šrudr æ˜¯ä¸€ä¸ª reference é¡¹ç›®ï¼Œæ„æ€æ˜¯ç”¨æ¥åš OAM å®žçŽ°çš„ä¸€ä¸ªå‚è€ƒï¼Œç›®å‰æ˜¯çº¯å¼€æºé¡¹ç›®ï¼Œä¸æŽ’é™¤ä»¥åŽä¼šæ¼”è¿›ä¸ºç”Ÿäº§å¯ç”¨çš„é¡¹ç›®ã€‚

> Qï¼šoam spec ä¸­ç›®å‰è¿˜æ²¡æœ‰çœ‹åˆ°å±žäºŽ infra operator çš„ç®¡ç†å¯¹è±¡ï¼ˆè¡¥å……ï¼šComponent æ˜¯é¢å‘ app developerï¼Œ Traits å’Œ AppConfiguration é¢å‘ app operatorï¼Œå“ªä¸ªå¯¹è±¡æ˜¯é¢å‘ infra operator çš„ï¼Ÿ)

A2ï¼šOAM æœ¬èº«å°±æ˜¯åŸºç¡€è®¾æ–½è¿ç»´æ‰‹é‡Œçš„æ­¦å™¨ï¼ŒåŒ…æ‹¬ Kubernetesã€Terraform ç­‰ä¸€ç³»åˆ—å¹³å°å±‚çš„å¼€æºé¡¹ç›®ï¼ŒåŸºç¡€è®¾æ–½è¿ç»´å¯ä»¥é€šè¿‡è¿™äº›å¼€æºé¡¹ç›®æž„å»º OAM çš„å®žçŽ°ï¼ˆå¦‚ rudr åŸºäºŽ Kubernetes)ã€‚æ‰€ä»¥ OAM çš„å®žçŽ°å±‚å°±æ˜¯åŸºç¡€è®¾æ–½è¿ç»´æä¾›çš„ï¼Œä»–ä»¬ä¸éœ€è¦é¢å¤–çš„å¯¹è±¡æ¥ä½¿ç”¨ OAMã€‚

> Qï¼šoam controller å’Œ admission controller çš„åˆ†å·¥æ ‡å‡†æ˜¯ä»€ä¹ˆ

A3ï¼šOAM é¡¹ç›®ä¸­çš„ admission controller ç”¨äºŽè½¬æ¢å’Œæ£€éªŒ specï¼Œå®šä½å®Œå…¨ç­‰ä»·äºŽ K8s ä¸­ admission controllerã€‚ç›®å‰å®žçŽ°çš„åŠŸèƒ½åŒ…æ‹¬è½¬æ¢ [fromVariable(VAR)] è¿™ç§ spec ä¸­çš„å‡½æ•°ï¼Œæ£€éªŒ AppConfigã€Componentã€Traitã€Scope ç­‰ CR æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œæ˜¯å¦åˆæ³•ç­‰ã€‚
OAM Controllerï¼Œå³ç›®å‰çš„å¼€æºé¡¹ç›® rudrï¼Œå°±æ˜¯æ•´ä¸ª OAM çš„å®žçŽ°å±‚ï¼Œå®ƒè´Ÿè´£è§£é‡Š OAM çš„ spec å¹¶è½¬æ¢ä¸ºçœŸå®žè¿è¡Œçš„èµ„æºï¼Œè¿™é‡Œçš„èµ„æºå¯ä»¥æ˜¯ K8s åŽŸæœ‰çš„ä¸€äº›ï¼Œä¹Ÿå¯ä»¥æ˜¯åƒé˜¿é‡Œäº‘ä¸Šçš„ RDS è¿™ç±»äº‘èµ„æºã€‚ç›®å‰ rudr é¡¹ç›®æ˜¯ Rust è¯­è¨€å†™çš„ï¼Œè€ƒè™‘åˆ° K8s ç”Ÿæ€å¤§å¤šæ•°éƒ½æ˜¯ç”¨ Go è¯­è¨€å†™çš„ï¼Œæˆ‘ä»¬åŽç»­ä¹Ÿä¼šå¼€æºä¸€ä¸ª go è¯­è¨€ç¼–å†™çš„ OAM-Frameworkï¼Œç”¨äºŽå¿«é€Ÿå®žçŽ°åƒ rudr è¿™æ ·çš„ OAM å®žçŽ°å±‚ã€‚

> Qï¼šè®¡åˆ’å•¥æ—¶å€™å¼€æº go çš„ oam-framework å‘€ï¼Ÿ

A4ï¼š å·²ç»åœ¨èµ°å†…éƒ¨æµç¨‹äº†ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿéœ€è¦è¿›ä¸€æ­¥æ‰“ç£¨ oam-frameworkï¼Œè®©å®ƒé€‚é…å¤§å®¶çš„åœºæ™¯ã€‚

> Qï¼šæƒ³é—®ä¸ªé—®é¢˜ï¼Œé˜¿é‡Œæ˜¯å¦‚ä½•é™ä½Ž k8s çš„å¤æ‚åº¦æ¥æ»¡è¶³è¿ç»´å’Œç ”å‘ä¸€äº›å…±æ€§è¯‰æ±‚çš„ï¼Ÿåœ¨ k8s ä¸­çš„ç”¨æˆ· user è§’è‰²å¯èƒ½æ˜¯å¼€å‘ä¹Ÿå¯èƒ½æ˜¯è¿ç»´ã€‚

A5ï¼šç›®å‰æˆ‘ä»¬é‡åˆ°çš„å¤§å¤šæ•°åœºæ™¯éƒ½èƒ½åŒºåˆ†å“ªäº›æ˜¯è¿ç»´è¦å…³å¿ƒçš„ï¼Œå“ªäº›æ˜¯ç ”å‘è¦å…³å¿ƒçš„ã€‚OAM é™ä½Ž K8s å¤æ‚åº¦çš„ä¸»è¦æ–¹æ³•å°±æ˜¯å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œç»™ K8s çš„ API åšå‡æ³•ï¼Œå°½é‡è®©æŸä¸€æ–¹å¯ä»¥å°‘å…³æ³¨ä¸€äº›å†…å®¹ã€‚å¦‚æžœä½ æœ‰è¿™æ ·ä¸€ä¸ªæ— æ³•åˆ†å‰²çš„åœºæ™¯ï¼Œå…¶å®žæˆ‘ä»¬ä¹Ÿå¾ˆæ„Ÿå…´è¶£ï¼Œæ¬¢è¿ŽæŠŠ case æå‡ºæ¥ä¸€èµ·æŽ¢è®¨ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯å±è”½æŽ‰ K8sï¼ŒOAM spec é¢„ç•™äº†å……è¶³çš„æ‰©å±•æ€§ï¼Œå®Œå…¨å¯ä»¥æŠŠ K8s åŽŸæœ‰çš„èƒ½åŠ›æä¾›ç»™ç”¨æˆ·ã€‚

> Qï¼šæˆ‘è®¤ä¸º OAM æ˜¯åŸºäºŽ k8s é’ˆå¯¹äºŽä¸åŒåº”ç”¨ä¸Šçš„æŠ½è±¡å±‚ï¼ŒçŽ°åœ¨æˆ‘ä»¬æœ‰å¾ˆå¤šåº”ç”¨éƒ½æ˜¯ç”¨ Helm åŒ…åŒ…è£…å¥½çš„ï¼Œå¦‚æžœåˆ‡æ¢æˆ OAM çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„å“ªäº›åœ°æ–¹å‘¢ï¼Ÿ

A6ï¼šå…¶å®žæˆ‘ä»¬ä¸ŠåŠå¹´ä¸€ç›´åœ¨æŽ¨å¹¿ helm åœ¨å›½å†…çš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬æä¾›äº†é˜¿é‡Œçš„ helm [é•œåƒç«™](https://developer.aliyun.com/hub)ç­‰ï¼Œæ‰€ä»¥ OAM è·Ÿ helm ä¹Ÿæ˜¯ç›¸è¾…ç›¸æˆçš„ã€‚ç®€å•çš„è¯´ï¼ŒOAM å…¶å®žå°±æ˜¯ helm åŒ…é‡Œé¢ template æ–‡ä»¶å¤¹é‡Œé¢çš„å†…å®¹ã€‚Helm æ˜¯ OAM åšå‚æ•°æ¸²æŸ“ï¼ˆtemplate)å’Œæ‰“åŒ…ï¼ˆchart)çš„å·¥å…·ã€‚å¦‚æžœåˆ‡æ¢åˆ° OAMï¼Œhelm çš„ä½¿ç”¨æ–¹å¼ä¸éœ€è¦å˜ï¼Œé‡Œé¢çš„ spec æ¢æˆ OAM çš„ spec å³å¯ã€‚

> Qï¼šè¯·é—®ï¼Œrudr ç”¨èµ·æ¥äº†å—ï¼Œæ•ˆæžœå¦‚ä½•ã€‚rudr çš„æž¶æž„æœ‰æ²¡æ›´ä¸°å¯Œçš„èµ„æ–™

A7: rudr ä¸€ç›´æ˜¯å¯ä»¥ç”¨çš„ï¼Œå¤§å®¶è¦æ˜¯ç”¨ä¸èµ·æ¥å¯ä»¥æ issueï¼Œæƒ³è¦ä»€ä¹ˆæ–¹é¢çš„èµ„æ–™æˆ–è€…ç–‘é—®ä¹Ÿå¯ä»¥æ issueï¼Œæˆ‘ä»¬ä¹Ÿåœ¨å®Œå–„æ–‡æ¡£ã€‚ç›®å‰ç›¸å…³çš„ææ–™éƒ½åœ¨è¿™é‡Œï¼š[oam-dev/rudr/tree/master/docs](https://github.com/oam-dev/rudr/tree/master/docs)

> Qï¼šrudr çš„ hello world æ²¡è·‘èµ·æ¥ï¼Œæ˜¯ä¸æ˜¯ k8s ç‰ˆæœ¬éœ€è¦ >1.14 ?

A8ï¼šå…·ä½“è¿™ä¸ªé—®é¢˜å°±åœ¨ github ä¸Šæ issue å§ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½ä¼šå…³æ³¨ issueï¼Œå¯ä»¥è´´ä¸€äº›é”™è¯¯æ—¥å¿—ä¹‹ç±»çš„ã€‚

> Qï¼šæˆ‘ä»¬ä¸€ç›´åœ¨ç”¨ helm æ‰“åŒ…æˆ‘ä»¬çš„åº”ç”¨ï¼ŒåŽ»åš gitops ï¼Œä¸€ä¸ªé€šç”¨çš„ chart å¯¹åº”ä¸åŒçš„ values.yaml åšåˆ°äº†å¤ç”¨ã€‚å¬äº†åˆ†äº«ï¼Œå¾ˆæœŸå¾… OAMï¼Œå½“ç„¶è¿˜æœ‰ openkruiseã€‚

A9ï¼šopenkruise æ˜¯å¼€æºçš„å“ˆï¼Œå¤§å®¶å¯ä»¥å…³æ³¨ [openkruise kruise](https://github.com/openkruise/kruise) æˆ‘ä»¬ä¹Ÿä¸€ç›´åœ¨è¿­ä»£ã€‚

> Qï¼šoam æœ‰å“ªäº›å…¬å¸åœ¨ç”¨ï¼Ÿå®žé™…ä½“éªŒåé¦ˆå¦‚ä½•ï¼Ÿ

A10ï¼šOAM åˆšåˆšå‘å¸ƒä¸€ä¸ªæœˆå·¦å³ï¼Œå…·ä½“æœ‰å“ªäº›å…¬å¸å·²ç»åœ¨ä½¿ç”¨æˆ‘ä»¬è¿˜æ²¡æœ‰æ¥å¾—åŠç»Ÿè®¡ã€‚é˜¿é‡Œå’Œå¾®è½¯å†…éƒ¨éƒ½å·²ç»åœ¨ä½¿ç”¨ï¼Œå¹¶ä¸”éƒ½æœ‰å¯¹å¤–çš„äº§å“ä½¿ç”¨ OAMã€‚å°±æˆ‘ä»¬æŽ¥è§¦åˆ°çš„ç”¨æˆ·æ¥è¯´ï¼Œæ— è®ºæ˜¯ç¤¾åŒºçš„ç”¨æˆ·è¿˜æ˜¯é˜¿é‡Œå†…éƒ¨ï¼Œéƒ½å¯¹ OAM çš„å…³æ³¨ç‚¹åˆ†ç¦»ç­‰ç†å¿µéžå¸¸è®¤åŒï¼Œä¹Ÿéƒ½åœ¨ç§¯æžè½åœ°ã€‚

> Qï¼š rust å†…éƒ¨æœ‰å“ªäº›åœºæ™¯å’Œä¸šåŠ¡ä½¿ç”¨äº†ï¼Ÿè´µå¸åŽç»­ä¼šç»§ç»­è¿ç”¨åœ¨å“ªäº›åœºæ™¯ï¼Ÿ

ç›®å‰æœ‰ä¸€äº›å°çš„åœºæ™¯åœ¨ä½¿ç”¨ï¼Œå…·ä½“è¿˜æ²¡æœ‰ç»Ÿè®¡è¿‡ï¼ŒåŽç»­ä¼šç»§ç»­ç”¨åœ¨ä¸€äº›éœ€è¦è¾ƒé«˜æ€§èƒ½çš„åœºæ™¯ã€‚

---

### 2019-11-19ï¼šåŸºäºŽäº‘åŽŸç”Ÿæ—¥å¿—åˆ†ç±»å¤„ç†æ–¹æ¡ˆä¸Žè½åœ°å®žè·µ

[æé—®é“¾æŽ¥](https://shimo.im/docs/RKYXGj6hvYJWTPQD)

> Qï¼šfilebeat ä¸Ž flunted çš„åŒºåˆ«å¤§ä¸ï¼Ÿè¯¥å¦‚ä½•é€‰æ‹©

Aï¼šFluentd é’ˆå¯¹ç»“æž„åŒ–çš„æ•°æ®ï¼Œçµæ´»æ€§æ˜¯ä¸€ä¸ªè€ƒé‡ã€‚

> Qï¼šfilebeat å•çº¯é‡‡é›† docker æ—¥å¿—å‘çŽ°ä¸èƒ½èŽ·å– docker.container.nameï¼Œdocker.container.image ä¿¡æ¯ä¸çŸ¥ä¸ºä½•ï¼Ÿ

Aï¼šfilebeat æ”¯æŒå¤šç§é‡‡é›†æ–¹å¼ï¼Œå¯ä»¥å°† filebeat ä»¥è¿›ç¨‹è¿è¡Œåœ¨ docker å®¹å™¨ä¸­ï¼Œæ”¶é›†å®¹å™¨æ—¥å¿—ï¼Œä¹Ÿå¯ä»¥å•ç‹¬éƒ¨ç½² filebeat é‡‡é›† docker ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥å‚è€ƒ filebeat å®˜æ–¹ yaml é…ç½®æ–‡ä»¶ã€‚

> Qï¼šèƒ½å¦å¯¹é‡‡é›†åˆ°çš„æ—¥å¿—ä¿¡æ¯åšåˆ°å‘Šè­¦å¤„ç†ï¼Ÿ

Aï¼šå‘Šè­¦éœ€è¦åˆ†åœºæ™¯ï¼Œå…¥åº“ ES å¯ä»¥é€šè¿‡ sentinl æ’ä»¶æŽ¥å…¥å‘Šè­¦ã€‚ è§„èŒƒå¤„ç†æ–¹å¼åº”å°†å„ç±»è½åœ°æ—¥å¿—å¯¹æŽ¥ä¸­å¿ƒå‘Šè­¦å¹³å°ã€‚

> Q: es çš„æœºå™¨å­¦ä¹ åŠŸèƒ½æ˜¯å¦æœ‰å®žé™…ä»·å€¼ï¼Ÿ

Aï¼šåœ¨æœºå™¨å­¦ä¹ æ–¹é¢æ²¡æœ‰å¤ªå¤šæŽ¥è§¦ã€‚

> Qï¼šé‡‡é›† agent æ˜¯ sidecar è¿˜æ˜¯ daemon æ¨¡å¼ï¼Ÿ

Aï¼šå®ˆæŠ¤è¿›ç¨‹ä¸ŽäºŒè¿›åˆ¶éƒ¨ç½²ã€‚åˆ†åœºæ™¯éƒ¨ç½²ï¼Œå¤§éƒ¨åˆ†é‡‡é›†åœºæ™¯ä½¿ç”¨ daemonsetï¼Œéƒ¨åˆ†é›†ç¾¤å¤–ä¸­é—´ä»¶ç­‰ç»„ä»¶ä»¥ systemd éƒ¨ç½²ã€‚

> Qï¼šæœ‰æ²¡æœ‰ EFKoperator ç›¸å…³é¡¹ç›®æŽ¨èï¼Ÿ

Aï¼šæš‚æ—¶æ²¡æœ‰ç›¸å…³æŽ¨èã€‚

> Qï¼šå¯¹äºŽæ—¥å¿—é‡‡é›†ç³»ç»Ÿå ç”¨èµ„æºè¿‡å¤šï¼Œæ€Žä¹ˆè§£å†³ï¼Ÿ

Aï¼šéœ€è¦ä»Žå„æ–¹é¢ä¼˜åŒ–ï¼ŒæŠ€æœ¯å±‚é¢ä¹Ÿæ˜¯ä¼˜åŒ–é¡¹ï¼Œå¦‚æå–åç§»é‡æ–¹å¼å¯¹æµé‡æœ‰å¾ˆå¤§å½±å“ï¼Œå¦‚æ–‡ä»¶æ‰«æé¢‘çŽ‡ï¼Œå¯¹ cpu æœ‰å¾ˆå¤§å½±å“ã€‚ ä¼˜åŒ–ç‚¹é¦–å…ˆä»ŽåŽŸç”Ÿå‚æ•°æ ¹æ®ä¸šåŠ¡åœºæ™¯è¿›è¡Œé€‚é…è°ƒæ•´ï¼Œç‰¹æ®Šåœºæ™¯è€ƒè™‘åŽŸç”Ÿæ‰©å±•ã€‚

> Qï¼šèƒ½ç”¨ filebeat é‡‡é›† journald æ—¥å¿—å—ï¼Ÿæ€Žä¹ˆå°†ç³»ç»Ÿæ—¥å¿—å’Œ pod æ—¥å¿—ç”¨åŒä¸€ä¸ª filebeat é‡‡é›†ï¼Ÿ

Aï¼šæœ‰ journalbeat å¼€æºæ’ä»¶å¯ä»¥é‡‡é›† journald æ—¥å¿—ã€‚ç³»ç»Ÿæ—¥å¿—å’Œ pod æ—¥å¿—éƒ½è½åœ°æ–‡ä»¶ï¼Œä»¥å¤šæºç›®å½•é‡‡é›†ï¼Œä¸€èˆ¬é‡‡ç”¨å¯¹æŽ¥ logstash åšåŒºåˆ†å¤„ç†ï¼Œè‹¥è½¬å‘ä¸é‡‡ç”¨ logstashï¼Œéœ€è¦æ‰©å±• filebeat ç»„ä»¶æ”¯æŒå¤šç›®å½•æŒ‡å®šä¸åŒçš„è¾“å‡ºé‡‡é›†ã€‚

> Qï¼šæœ‰æ²¡æœ‰è°ƒç ”è¿‡é˜¿é‡Œå¼€æºçš„ log-pilot æ¥é‡‡é›† pod æ—¥å¿—ï¼Ÿ

Aï¼šæ²¡æœ‰åšè¿‡ç›¸å…³è°ƒç ”ã€‚

> Qï¼šbeats ç»„ä»¶ä¹‹é—´æ˜¯å¦ä¼šæœ‰äº’ç›¸å½±å“ï¼Ÿæ¯”å¦‚ filebeat MySQL çš„é‡‡é›†å™¨ redis çš„é‡‡é›†å™¨ docker çš„å„ç§ï¼Œéƒ¨ç½²å¾ˆå¤šæ˜¯å¦ä¼šç›¸äº’ä¹‹é—´æœ‰å½±å“

Aï¼šä½ æŒ‡çš„æ˜¯ filebeat å†…ç½® module æ¨¡å—å’Œå¯¹å¤–éƒ¨é‡‡é›†æ–¹å¼å¦‚ä½•ç»Ÿä¸€ä¸€å¥—éƒ¨ç½²é‡‡é›†è€Œä¸ç›¸äº’æœ‰å½±å“ä¹ˆï¼Ÿ å¦‚æžœæ˜¯è¿™æ ·ï¼Œé€šè¿‡ filebeat é…ç½®æ–‡ä»¶æŒ‡å®š module é‡‡é›†ä»¥åŠ docker äº§ç”Ÿçš„æ–‡ä»¶é…ç½®è¿›è¡Œé‡‡é›†ã€‚

> Qï¼šæ—¥å¿—å‘Šè­¦æ˜¯ç”¨çš„å¼€æºé¡¹ç›®è¿˜æ˜¯è‡ªç ”çš„å‘¢ï¼Ÿ

Aï¼šæ ¹æ®è‡ªèº«çš„å¹³å°ç¡®å®šæ–¹æ¡ˆï¼Œæœ¬æ¡ˆä¾‹çš„åœºæ™¯å¯ä»¥é€šè¿‡å¼€æºæ–¹æ¡ˆåšä¸€äº›ç®€å•å‘Šè­¦ï¼Œå¦‚ ES é€šè¿‡ sentinl åšå‘Šè­¦ï¼ŒLoki é€šè¿‡ grafana å‘Šè­¦ï¼Œè‹¥è‡ªæœ‰å¤§æ•°æ®å¹³å°æˆ–è€…å•ç‹¬çš„å‘Šè­¦å¹³å°ï¼ŒæŒ‰ç…§å¹³å°è§„åˆ™å¯¹æŽ¥å‘Šè­¦ã€‚

> Qï¼šæ—¥å¿—ç³»ç»ŸæŽ¥å…¥æ¶ˆæ¯é˜Ÿåˆ—çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ç¼“å†²ï¼Œé‡è¦æ—¥å¿—æŽ¥å…¥æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥æä¾›ç¼“å†²å­˜å‚¨ï¼Œå¤šæ¬¡æ¶ˆè´¹ã€‚

> Qï¼šéƒ½æ˜¯é»˜è®¤ json æ—¥å¿—ä¹ˆï¼Œæœ‰æ²¡æ¯”è¾ƒå…¶ä»– log driver ä½¿ç”¨åœºæ™¯

Aï¼š

> Qï¼šç”¨ loki ä¸»è¦ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯æŸäº›åœºæ™¯ä¸‹ es çš„æ›¿ä»£å“å—ï¼ŸäºŒæ¬¡å¼€å‘è€ƒè™‘å¼€æºå—ï¼Ÿpromtail çš„æ€§èƒ½ç“¶é¢ˆå…·ä½“è¡¨çŽ°åœ¨å“ªé‡Œï¼Ÿå’Œ filebeat ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ

Aï¼š

> Q: æˆ‘çœ‹ loki çŽ°åœ¨è¿˜æ˜¯åœ¨ beta é˜¶æ®µï¼Œä¸ºä»€ä¹ˆè€ƒè™‘ç”¨ï¼Ÿ

---

### 2019-11-12ï¼šæ‰‡è´ Service Mesh å‘å±•åŽ†ç¨‹

[æé—®é“¾æŽ¥](https://shimo.im/docs/C9xJT8Hj66cg8Chc)

> Qï¼šistio ç›¸å…³çš„ ymal é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚æµé‡ç™¾åˆ†æ¯”ï¼Œåœ¨å“ªé‡Œé…ç½®ï¼Œç›´æŽ¥æ“ä½œæ–‡ä»¶å—ï¼Ÿ

Aï¼šä½ æ˜¯æŒ‡å•çº¯ä½¿ç”¨ Envoy çš„æ—¶å€™å¦‚ä½•å¦‚ä½•å®žçŽ° Istio é‡Œæµé‡ç™¾åˆ†æ¯”çš„åŠŸèƒ½å—ï¼Ÿè¿™ä¸ªå¯ä»¥é€šè¿‡ç»™ endpoints é…ç½®ä¸åŒçš„æƒé‡æ¥åšåˆ°

> Qï¼šè¿™ä¸ªçŽ°åœ¨æ˜¯åœ¨å“ªé‡Œæ“ä½œçš„æ˜¯è¿ç»´æ‰‹å·¥ä¿®æ”¹ ymal æ–‡ä»¶ï¼Ÿ

Aï¼šä¸æ˜¯çš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥åœ¨ xds æœåŠ¡ç«¯å®žçŽ°æ ¹æ®ä¸åŒ deployment pod æ•°é‡æ¥ä¸‹å‘æ–°çš„é…ç½®

> Qï¼šservice mesh  æœ‰å¯¹ mq ç›¸å…³ç ”ç©¶å—

Aï¼šæˆ‘ä»¬çš„ mq æ²¡æœ‰éƒ¨ç½²åœ¨é›†ç¾¤é‡Œï¼ŒEnvoy å¯¹è¿™å—åè®®ä¹Ÿæ²¡æœ‰ç›¸åº”çš„æ”¯æŒ
Aï¼š istio åº”è¯¥æš‚æ—¶è¿˜ä¸æ”¯æŒ kafka å’Œ amqpï¼ŒgRPC/websocket ç­‰å¯ä»¥å®žçŽ°å¼‚æ­¥è°ƒç”¨ã€‚

> Qï¼šä¸ºå•¥è‡ªå·±å®žçŽ° xds æœåŠ¡å™¨ï¼Ÿæœ‰çŽ°æˆçš„ä¸ºå•¥ä¸ç”¨ï¼Ÿä¾‹å¦‚ istio-pilot/rotor? istio-pilot å¯ä»¥å•ç‹¬ä½¿ç”¨çš„ã€‚

Aï¼šå…¶å®žæ˜¯æ—©æœŸé—ç•™é—®é¢˜ï¼Œä¸€å¼€å§‹æˆ‘ä»¬ç”¨çš„ Istio ä¸ç¨³å®šï¼ŒåŽç»­çš„é€‰æ‹©å°±è¶‹äºŽä¿å®ˆäº†ã€‚å½“æ—¶ rotor åº”è¯¥è¿˜æ²¡æœ‰ release ç‰ˆæœ¬

Aï¼šå¥½å§ï¼ŒRotor ä¸€å¹´å‰ä¹Ÿæ²¡æœ‰æ›´æ–°äº†ï¼Œä»–ä»¬å›¢é˜Ÿå¥½åƒè¢« twitter æ‹›å®‰äº†

> Qï¼šä½ ä»¬åªç”¨ envoy åš front-proxy å—ï¼Ÿå¦‚æžœæ˜¯è¿™æ ·ï¼Œè¿™å°±ä¸å« service mesh äº†

Aï¼šåˆ†äº«é‡Œè¯´äº†å“ˆï¼Œæ—¢æœ‰ front-proxyï¼Œä¹Ÿæœ‰æœåŠ¡é—´çš„

> Qï¼šå¦‚ä½•ä¿è¯ envoy å¯¹ä¸šåŠ¡æ€§èƒ½å½±å“æœ€å°ï¼Ÿ

Aï¼šenvoy æœ¬èº«æ€§èƒ½æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œè¦æ³¨æ„çš„æ˜¯é…ç½®çš„ filter è¿™äº›è·Ÿå¤–éƒ¨æœåŠ¡äº¤äº’çš„åœ°æ–¹ï¼Œæ¯”å¦‚ ratelimit ä¹‹ç±»çš„ï¼Œè¦é…ç½®å¥½è¶…æ—¶æ—¶é—´ä»¥åŠå¤±è´¥åŽçš„ç­–ç•¥

> Qï¼šè¢« sidecar inject è¿‡çš„ prometheus å¦‚ä½•åŽ» scrap æ¯ä¸ª pod çš„ metrics?æœåŠ¡æ˜¯åŸºäºŽ springboot çš„ã€‚è¿™ä¸ªç ”ç©¶è¿‡å—ï¼Ÿ

Aï¼šæŠ±æ­‰ï¼Œè¿™ä¸ªæ²¡æœ‰ç ”ç©¶è¿‡ã€‚ä½ æ˜¯è¦æŠ“å– sidecar çš„æ•°æ®ï¼Ÿ
Aï¼š è°¢è°¢ï¼Œæ²¡å…³ç³»ã€‚æˆ‘ç›®å‰åªèƒ½è®© prometheus ç›´æŽ¥åŽ»æŠ“ pod çš„ metricsã€‚sidecar çš„æ•°æ®ä¸ç”¨æŠ“:)

> Qï¼šæŠŠ istio mixer é‡Œçš„ jaeger æš´éœ²å‡ºæ¥ï¼Œç»™ k8s å¤–éƒ¨çš„æœåŠ¡ä½¿ç”¨ï¼Œè¿™ä¸ªéœ€è¦è€ƒè™‘äº›ä»€ä¹ˆï¼Ÿ

Aï¼šæˆ‘ä»¬å•çº¯çš„ä½¿ç”¨çš„ Envoy å“ˆ

> Qï¼šistio çš„é…å¥—ç›‘æŽ§ä½“ç³»å¦‚ä½•ï¼Œæ˜¯ç›´æŽ¥ç”¨å¼€æºæ­å»ºè¿˜æ˜¯è‡ªå»ºï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ç›‘æŽ§æ˜¯ Prometheus é‚£ä¸€å¥—æŠ€æœ¯æ ˆ

> Qï¼šä½ ä»¬çš„æœåŠ¡æ˜¯åŸºäºŽ gRPC è¿˜æ˜¯ REST/http1.1 çš„ï¼ŸgRPC è¦æ±‚è‡³å°‘ http2ï¼Œå¦‚æžœéœ€è¦æŠŠ gRPC æœåŠ¡æš´éœ²ç»™å¤–éƒ¨ï¼Œå¯¹äºŽingress controller ä½ æœ‰ä»€ä¹ˆæŽ¨èï¼Ÿä½ ä»¬æœåŠ¡éƒ¨ç½²çš„æ˜¯é˜¿é‡Œäº‘å—ï¼ŸEdge Proxy ç”¨çš„é˜¿é‡Œçš„æœåŠ¡?

Aï¼šæˆ‘ä»¬å¯¹å¤–çš„ restï¼Œå†…éƒ¨æœåŠ¡æ˜¯ gRPCã€‚Envoy ä¹Ÿæ˜¯æœ‰åšingress controller çš„äº§å“çš„ï¼Œæ¯”å¦‚ Contourï¼Œä¸è¿‡æˆ‘ä»¬æ²¡æœ‰å®žè·µè¿‡ï¼Œè°ˆä¸ä¸ŠæŽ¨èã€‚æ˜¯çš„ï¼Œé˜¿é‡Œäº‘ã€‚æœ€å¤–é¢æœ‰ä¸€å±‚é˜¿é‡Œäº‘çš„ slb
Aï¼š cool

> Qï¼š ä½ ä»¬ç›®å‰ç½‘å…³æ€Žä¹ˆåšå¥åº·æ£€æŸ¥çš„ï¼Ÿlstioï¼Œç¬¬äºŒä¸ªé—®é¢˜ï¼Œsidecar å¦‚ä½•å®žçŽ°é“¾è·¯ç›‘æŽ§ï¼Œè‡ªå·±æ—¥å¿—æ–‡ä»¶æ€Žä¹ˆå¤„ç†çš„ï¼Ÿéº»çƒ¦åˆ†äº«ä¸€ä¸‹ä½ ä»¬çš„ç›‘æŽ§æŒ‡æ ‡å’Œç»´åº¦é’ˆå¯¹ service meâ€†sh

Aï¼šæ—¢å¯ä»¥è®© Envoy å¯¹ cluster åšä¸»åŠ¨å¥åº·æ£€æŸ¥ï¼Œä¹Ÿå¯ä»¥åœ¨ xDS æœåŠ¡ç«¯é‚£è¾¹ä¸»åŠ¨æ›´æ–° envoy çš„ endpointsï¼Œæ¯”å¦‚ä¾èµ– pod é…ç½®çš„æŽ¢æ´»æŒ‡é’ˆã€‚æˆ‘ä»¬æ—¥å¿—éƒ½æ˜¯åˆ° pod çš„æ ‡å‡†è¾“å‡ºï¼Œç„¶åŽ ELK é‚£ä¸€å¥—åšæ”¶é›†å¤„ç†
Aï¼šæ—¥å¿—æ˜¯æ€Žä¹ˆæ”¶é›†çš„å‘¢ï¼Ÿé“¾è·¯ç›‘æŽ§ç›®å‰æ€Žä¹ˆç”¨çš„å‘¢ï¼Ÿé‚£ä¸ªæŠ€æœ¯æ ˆ

> Qï¼šnginx+consul+consul-template è¿™ä¸ªç”¨ nginx åš edge proxy?nginx è¿™ä¸€å±‚å¦‚ä½•åš cluster?

Aï¼šnginx æˆ‘ä»¬æ˜¯éƒ¨ç½²å¤šå°ï¼Œå‰é¢è¿˜æœ‰ä¸€å±‚é˜¿é‡Œäº‘çš„ slb å¯¹ nginx åšä¸»åŠ¨å¥åº·æ£€æŸ¥

> Qï¼šdaemonset æ¨¡å¼ä¸‹ï¼Œå¦‚æžœä¸€ä¸ªæœåŠ¡æŒ‚æŽ‰äº†ä¾‹å¦‚ timeoutï¼Œå¦‚æžœå®žçŽ° circuit-breaker? æœåŠ¡æŒ‚äº†ã€‚

Aï¼šæœåŠ¡ç†”æ–­æˆ‘ä»¬æœ€è¿‘åˆšå¼€å§‹è°ƒç ”ï¼ŒçŽ°åœ¨ç»™ä¸å‡ºå®žè·µç»éªŒ
Aï¼šå“¦ï¼Œé‚£åªå¥½è¿˜æ˜¯ç¼–ç åœ¨ä»£ç é‡Œé¢

> Qï¼šç½‘å…³æ€Žä¹ˆå¤„ç†å¥åº·æ£€æŸ¥çš„ï¼Œpod æ—¥å¿—æ€Žä¹ˆå¤„ç†ï¼Œç»Ÿä¸€æ”¶é›†å—ï¼Ÿé“¾è·¯ç›‘æŽ§åˆæ˜¯å¦‚ä½•æŽ¥å…¥çš„ï¼Ÿ

ä¸å¥½æ„æ€ï¼Œé—®é¢˜é‡å¤äº†

> Qï¼šistio ä¸å¥½ç”¨ï¼Œä¸ºä»€ä¹ˆä¸è€ƒè™‘ sofa mesh æ¥ä»£æ›¿ï¼Ÿ

Aï¼šæ—©æœŸ 0 ç‚¹å‡ ç‰ˆæœ¬çš„æ—¶å€™ä¸ç¨³å®šå“ˆã€‚çŽ°åœ¨ä¸æ˜¯ç‰¹åˆ«åœ¨æ„å¤§é›†ç¾¤æ€§èƒ½é—®é¢˜çš„è¯ï¼Œistio æ˜¯å¯ç”¨çš„
Aï¼šå®žæµ‹è¿‡ä¸€ä¸‹ï¼Œistio sidecar injection å¤§æ¦‚å¹³å‡ä¸€æ¬¡å¢žåŠ  1ms çš„ latencyï¼Œæ„Ÿè§‰ä¸æ˜¯å¾ˆåŽ‰å®³ã€‚ä¸€èˆ¬è¿œç¨‹è°ƒç”¨éƒ½æ˜¯åæ¯«ç§’ä»¥ä¸Šçš„è¿”å›žã€‚

> Qï¼šè¯·é—®å¦‚ä½•å®žçŽ°çš„ç°åº¦å‘å¸ƒå’Œè“ç»¿éƒ¨ç½²

Aï¼šç°åº¦å‘å¸ƒä¹Ÿæ˜¯åŸºäºŽé…ç½®ä¸åŒ endpoints æƒé‡è¿™ä¸ªæ€è·¯æ¥çš„ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²ä¸åŒçš„ deploymentï¼ŒåŸºäºŽ pod æ¯”ä¾‹æ¥åšã€‚è“ç»¿éƒ¨ç½²å®žè·µä¸å¤šå“ˆ

> Qï¼šä½ ä»¬æœåŠ¡ tracing å’Œæµé‡ç›‘æŽ§æ˜¯æ€Žä¹ˆåšçš„å‘¢ï¼Ÿ

Aï¼štraceing ç›®å‰è¿˜æ˜¯åŽŸå§‹çš„æ—¥å¿—æ–¹å¼ï¼Œåœ¨ç ”ç©¶æ›¿ä»£æ–¹æ¡ˆï¼ŒåŽç»­æœ‰è¿›å±•å¯ä»¥å†åˆ†äº«ä¸€ä¸‹ã€‚æµé‡ç›‘æŽ§æˆ‘ä»¬æœ‰åš pod çš„è¿›å‡ºæµé‡ç»Ÿè®¡ï¼Œä¹Ÿæœ‰ä»Ž Envoy metrics èŽ·å–çš„è¯·æ±‚ç»Ÿè®¡

---

### 2019-11-10ï¼šè”šæ¥æ±½è½¦çš„ Kubernetes å®žè·µ

[æé—®é“¾æŽ¥](https://shimo.im/docs/DRgJKGJdvV9cXDKD)

> Qï¼šè¯·é—® Kubernetes æ•°æ®å¤‡ä»½ä¸Žæ¢å¤ï¼Œè¿™ä¸ªæ˜¯åŒ…æ‹¬ kubectl-proxyï¼Œetcdï¼Œç½‘ç»œé…ç½®ç­‰å—ï¼Ÿå¦‚æžœè¿›è¡Œå¤šé›†ç¾¤ä¸‹çš„æ•°æ®å¤‡ä»½ï¼Ÿ

Aï¼šå¤‡ä»½çš„å…¶å®žå°±æ˜¯ etcd ä¸­çš„æ•°æ®ï¼Œæˆ‘ä»¬ç½‘ç»œæ˜¯ç”¨çš„ flannelï¼Œä¸€äº›å…³é”®ç½‘æ®µä¿¡æ¯ä¹Ÿæ˜¯å­˜åœ¨ etcd ä¸­çš„ï¼Œå¯¹äºŽå¤šé›†ç¾¤æ¥çœ‹çš„è¯ï¼Œè¿˜æ˜¯è¦é’ˆå¯¹æ•°æ®å­˜æ”¾å¯¹åº”çš„ etcd é›†ç¾¤æ•°æ®åŽ»è¿›è¡Œå¤‡ä»½

> Qï¼šè¯·é—®ä¸€ä¸‹ä¸šåŠ¡æ—¥å¿—å¤ªå¤šï¼Œä¸€å¤©ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸šåŠ¡æ—¥å¿—æœ‰ 200Gï¼Œæ€Žä¹ˆåšæ—¥å¿—æ”¶é›†åŠç›‘æŽ§å‘Šè­¦ã€‚

Aï¼šä¸€å¤©ä¸€ä¸ªèŠ‚ç‚¹ 200G çš„è¯ï¼Œè¿™ä¸ªè¦çœ‹ä½ ä»¬é›†ç¾¤èŠ‚ç‚¹å¤šä¸å¤šï¼Œæˆ‘ä»¬ä¸Šç™¾ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„é‡å¤§æ¦‚åœ¨ 100G å·¦å³ï¼Œçº¿ä¸Šæ—¥å¿—é‡éƒ½æ˜¯å‡ å T çš„æ•°æ®ï¼Œç”¨æˆ‘åˆ†äº«çš„æ–¹æ¡ˆåŽ»è½åœ°åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„ï¼ŒELK çš„æ•´ä½“æ€§èƒ½è¿˜æ˜¯éžå¸¸ä¸é”™çš„ï¼Œfilebeat çŽ°åœ¨æœ€é«˜çš„æ€§èƒ½åˆ†é…æ˜¯å ç”¨ 500m cpu 1G å†…å­˜ï¼Œæ”¶é›†èµ·æ¥ä¹Ÿæ˜¯èƒ½åº”å¯¹çš„ï¼Œè¿™ä¸ªæ ¹æ®ä½ çš„é‡å†è°ƒæ•´ï¼Œç›‘æŽ§çš„è¯è‚¯å®šå°±ç”¨ prometheus å°±å¥½ï¼Œå®˜æ–¹éƒ½æ˜¯æœ‰è‡ªåŠ¨å‘çŽ°çš„é…ç½®ï¼Œå¾ˆä¾¿åˆ©ï¼Œå½“ç„¶å¦‚æžœä½ è¦å¯¹æ—¥å¿—è¿›è¡Œåˆ†æžï¼Œè¿™å—å°±æ¯”è¾ƒå¤æ‚äº†ï¼Œå¯ä»¥é€šè¿‡ es æŽ¥å£åŽ»èšåˆæ•°æ®ï¼Œå½“ç„¶æ—¥å¿—çš„å­—æ®µä¹Ÿè¦è§„èŒƒå¥½ã€‚

> Qï¼šç”Ÿäº§çŽ¯å¢ƒ k8s é‡‡ç”¨äºŒè¿›åˆ¶æ–¹å¼æ­å»ºè¿˜æ˜¯ kubeadm ï¼Œè¿˜æ˜¯å…¶ä»–æ–¹æ¡ˆï¼Ÿ

Aï¼šçº¿ä¸Šé‡‡ç”¨çš„æ˜¯äºŒè¿›åˆ¶çš„æ–¹æ³•ï¼Œå› ä¸ºæˆ‘ä»¬ä¸Š k8s çš„æ—¶å€™ kubeadm è¿˜æ˜¯æµ‹è¯•ç‰ˆæœ¬ï¼Œå½“ç„¶çŽ°åœ¨é«˜ç‰ˆæœ¬çš„ kubeadm åº”è¯¥å·²ç»æ˜¯æ­£å¼ç‰ˆæœ¬ï¼Œä½†æ˜¯è§‰å¾—è¿˜æ˜¯äºŒè¿›åˆ¶æ›´æ–¹ä¾¿ä¸€äº›ï¼Œä½ æ”¹é…ç½®ï¼Œä»¥åŠè‡ªå®šä¹‰ä¸€äº›å‚æ•°ä¼šæ–¹ä¾¿ä¸€äº›ã€‚

> Qï¼šç”Ÿäº§çŽ¯å¢ƒ k8s éƒ½ç”¨å“ªç§ç½‘ç»œæ¨¡å¼

Aï¼šæˆ‘ä»¬ç”¨çš„æ˜¯ flannelï¼Œä¸è¿‡åŽç»­ä¼šè€ƒè™‘æ‰“ç®—æ¢æˆ calicoï¼ŒçŽ°åœ¨å‘çŽ°çº¿ä¸Šæœ‰ä¸€å®šç½‘ç»œé™åˆ¶çš„éœ€æ±‚ï¼Œcalico çš„æ€§èƒ½ç›¸å¯¹ä¹Ÿä¼šæ›´å¥½ï¼Œä½†æ˜¯ç»´æŠ¤çš„å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œåœ¨é›†ç¾¤èŠ‚ç‚¹å¤šçš„æƒ…å†µä¸‹ï¼Œè¦æ·»åŠ è·¯ç”±åå°„å™¨ï¼Œè¿™ä¸ªæ¯”è¾ƒå…³é”®ï¼Œè€Œä¸”ç½‘ç»œé€‰åž‹å‰ä¸€å®šå¯¹æœªæ¥çš„è§„æ¨¡æœ‰ä¸ªè§„åˆ’ï¼Œè§„åˆ’å¥½ä½¿ç”¨çš„ç½‘æ®µã€‚

> Qï¼šè¯·é—®ç”Ÿäº§çŽ¯å¢ƒä¸­ etcd çš„æ•°æ®éœ€è¦å¤‡ä»½å—ï¼Ÿæ€Žä¹ˆå¤‡ä»½ï¼Ÿè¿˜æœ‰äºŒè¿›åˆ¶å®‰è£… etcd é›†ç¾¤ç”± 3 ä¸ªèŠ‚ç‚¹å¢žåŠ åˆ° 5 ä¸ªèŠ‚ç‚¹ï¼Œéœ€è¦é‡æ–°ç”Ÿ e æˆè¯ä¹¦åŽå†é‡å¯ etcd æœåŠ¡å—ï¼Ÿå¢žåŠ èŠ‚ç‚¹é‡å¯ç­–ç•¥æ˜¯ä¸€ä¸ªä¸€ä¸ªèŠ‚ç‚¹ä¾æ¬¡é‡å¯å—

Aï¼šå»ºè®®å¤‡ä»½ï¼Œå…¶å®žä¸»è¦ç”¨åˆ°çš„å°±æ˜¯ etcd çš„ snapshot åŠŸèƒ½ï¼Œä¸å¤æ‚ï¼Œçœ‹ä¸‹æˆ‘åˆ†äº«çš„è„šæœ¬å³å¯ï¼Œæ‰©å®¹çš„è¯éœ€è¦ä¿®æ”¹ server ç«¯è¯ä¹¦å¯¹åº”çš„ hostï¼Œé€å°é‡å¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå®˜æ–¹çš„æ–¹æ³•ä¹Ÿæ˜¯è¦ä¸€å°ä¸€å°æ‰§è¡Œçš„ï¼Œçº¿ä¸Š etcd èŠ‚ç‚¹æˆ‘åšè¿‡æµ‹è¯•ï¼Œå³ä½¿æ“ä½œå¤±è¯¯éƒ½ down æŽ‰çš„è¯ä¹Ÿä¸ä¼šå½±å“ä½ çŽ°æœ‰æœåŠ¡çš„è¿è¡Œï¼Œè€Œä¸”ä¿è¯æ³•å®šèŠ‚ç‚¹çš„å­˜åœ¨å°±æ›´å¥½ã€‚

> Qï¼šä½ åˆ†äº«çš„ prometheus æ˜¯ operator æ–¹å¼å—ï¼Ÿä½ çš„ç›‘æŽ§æ•°æ®æ˜¯æœ‰ç»è¿‡äºŒæ¬¡å¼€å‘åŽä½œä¸ºæ ‡å‡†æ ¼å¼è¾“å‡ºå—ï¼Ÿå¯¹äºŽ nginx å’Œ java ç›‘æŽ§å¦‚ä½•å®žçŽ°å‘€ï¼Ÿ

Aï¼šprometheus æ²¡æœ‰ç”¨ operator çš„æ–¹å¼ï¼Œæ˜¯ç”¨çš„å®˜æ–¹çš„ yaml æ–‡ä»¶åˆ›å»ºçš„ï¼Œæˆ‘ä»¬çº¿ä¸Š java æœåŠ¡å±…å¤šï¼Œéƒ½æ˜¯é€šè¿‡ spring å®˜æ–¹çš„ prometheus æ’ä»¶å°±å¯ä»¥è‡ªå®šä¹‰ç›‘æŽ§æ•°æ®ï¼Œnginx çš„è¯æˆ‘ä»¬è¿˜çœŸçš„ä¸å¤šï¼Œè¿™ä¸ªä¼°è®¡ä½ è¦ç”¨ç›¸åº”çš„ exporter å°±å¥½ï¼Œç›‘æŽ§æ•°æ®æ˜¯å¼€å‘è‡ªå®šä¹‰ä¸Šä¼ çš„ï¼Œæˆ‘ä»¬æ²¡æœ‰åšé™åˆ¶ã€‚

> Qï¼špod æŒ‚æŽ‰ä¹‹åŽå¦‚ä½•ä¿ç•™çŽ°åœºï¼Œæ¯”å¦‚åšå†…å­˜ dump æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆæ²¡ï¼Ÿ

Aï¼šæˆ‘ä»¬è¿™è¾¹æ˜¯è¿™æ ·ï¼Œå¯¹äºŽå¥åº·æ£€æŸ¥æ²¡æœ‰æ·»åŠ  liveness çš„æ£€æŸ¥ï¼Œä¹Ÿæ˜¯é˜²æ­¢å®¹å™¨çš„é‡å¯ï¼Œå°¤å…¶æ˜¯åœ¨ç¬¬ä¸€æ¬¡é¡¹ç›®ä¸Šçº¿ï¼Œéš¾å…æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œå¦‚æžœåŠ äº† liveness å°±ä¼šä¸€ç›´ï¼Œé‡å¯ï¼Œä¸å¤ªæ–¹ä¾¿æŸ¥é—®é¢˜ï¼Œæ‰€ä»¥åªåŠ äº† readiness,åªæ˜¯ä¿è¯ä¸å½±å“çº¿ä¸Šè®¿é—®ï¼Œå¯¹äºŽç”Ÿäº§ä¸­ï¼Œjava é¡¹ç›®é‡åˆ°æœ€å¤šçš„å°±æ˜¯ OOM é—®é¢˜ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹Ÿå¯¹ POD é‡å¯çš„åŽŸå› åŠ äº†æŠ¥è­¦ï¼Œè‡³äºŽ dump æˆ‘ä»¬è¿˜æ²¡è¿™æ–¹é¢çš„æ“ä½œï¼Œéœ€è¦å¼€å‘è‡ªè¡Œæ£€æŸ¥äº†ã€‚

> Qï¼šä¼ ç»Ÿç³»ç»Ÿæž¶æž„å¦‚ä½•æ”¹é€ æˆ k8s æž¶æž„ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜æœ‰ç‚¹å®½æ³›å‘¢ï¼Œè¿˜æ˜¯å¾—çœ‹æ‚¨è¿™è¾¹å®žé™…çš„åœºæ™¯ï¼Œæˆ‘è§‰å¾—æ›´å¤šçš„ä¹Ÿæ˜¯å¾—éœ€è¦å¼€å‘ä¸€èµ·çš„é…åˆï¼Œå°½é‡ä¿è¯æœåŠ¡æ¨¡å—éƒ½èƒ½å¤Ÿåšåˆ°å¾®æœåŠ¡è¯ï¼Œä¸è¦è€¦åˆçš„å¤ªç´§ï¼Œæ‚¨å¯ä»¥å…ˆæ­å»ºä¸€ä¸ªæµ‹è¯•é›†ç¾¤ï¼Œç„¶åŽä»Žå¼€å‘é‚£è¾¹æ‰¾ä¸€ä¸ªæ¨¡å—è¿›è¡Œ docker åŒ–çš„è½¬æ¢ï¼Œç„¶åŽä¸€ç‚¹ä¸€ç‚¹å†åŽ»è¯•å§ã€‚

> Qï¼šæ˜¯å¦æœ‰ingress tcp/udp åº”ç”¨çš„ç”Ÿäº§çº§ç½‘ç»œæ–¹æ¡ˆï¼Ÿ

Aï¼šæˆ‘ä»¬æ²¡æœ‰ç”¨ingressï¼Œæˆ‘ä»¬çš„ç”¨æ³•ä¹Ÿç®—æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„ç”¨æ³•ï¼Œæˆ‘ä»¬æ˜¯æŠŠç½‘å…³ç›´æŽ¥åŠ å…¥åˆ° k8s é›†ç¾¤ä¸­ï¼Œè¿™æ ·ç½‘å…³å°±å¯ä»¥è°ƒç”¨åˆ° k8s çš„ serviceï¼Œå› ä¸ºæˆ‘ä»¬ä»¥ç½‘å…³ä¸ºä¸­å¿ƒï¼Œåšäº†ä¸€äº›å®‰å…¨åŠè®¤è¯åŠŸèƒ½ï¼Œæ‰€ä»¥ä¹‹å‰çš„ç½‘å…³å¿…é¡»è¦ç”¨åˆ°ï¼Œè€Œä¸”åŠ äº†ingress ç›¸å½“äºŽå¤šåŠ äº†ä¸€å±‚æ€§èƒ½æ¶ˆè€—ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰ç”¨ï¼Œæœ€åŽæˆ‘ä»¬æŠŠä¹‹å‰éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸Šçš„ç½‘å…³ä¹Ÿå˜æˆ docker åŒ–åŽ»éƒ¨ç½²åˆ°é›†ç¾¤å†…éƒ¨ã€‚

> Qï¼šä¼ ç»Ÿæ•°æ®åº“è´Ÿè½½è¿‡é«˜æ—¶æŸ¥è¯¢ç¼“æ…¢ï¼Œä½†æ˜¯ä¼šæœ‰ç»“æžœï¼Œk8s æž¶æž„æ•°æ®åº“è´Ÿè½½è¿‡é«˜ç›´æŽ¥ pod é‡å¯ï¼Œå¯¼è‡´æ²¡æœ‰ç»“æžœè¿”å›žï¼Œè¯·é—®åº”è¯¥å¦‚ä½•å¤„ç†çš„ã€‚

Aï¼šæˆ‘ä»¬é›†ç¾¤è¿˜æ²¡æœ‰è·‘æ•°æ®åº“è¿™ç§æœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œä½†æ˜¯å¬æ‚¨æè¿°ï¼Œè¿˜æ˜¯å¾—çœ‹çœ‹ pod é‡å¯çš„å…·ä½“åŽŸå› ï¼Œå¦‚æžœ pod éƒ½é‡å¯äº†ï¼Œç†è®ºä¸Šè·‘åœ¨æœºå™¨ä¸Šä¸€å®šä¹Ÿä¼šæœ‰é—®é¢˜ï¼Œè¿˜æ˜¯åœ¨ä¸Šäº‘ä¹‹å‰åšå¥½å……åˆ†çš„æ€§èƒ½åŽ‹æµ‹ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥è€ƒè™‘å–æ¶ˆ liveness çš„å¥åº·æ£€æŸ¥ï¼Œåªä¿ç•™ readness è®¿é—®çš„æ£€æŸ¥ã€‚

> Qï¼šé‡‡é›†æ—¥å¿—è¿‡ç¨‹ä¸­ï¼Œfluentd æˆ– fluent bit é€šè¿‡è¯»å– node èŠ‚ç‚¹ docker log ç›®å½•é‡‡é›†æ—¥å¿—ï¼Œè¯¥ç›®å½•åŒ…å«äº†æ‰€æœ‰æœåŠ¡çš„æ—¥å¿—ã€‚è¯·é—®å¦‚ä½•åœ¨ output é˜¶æ®µä¸­æ ¹æ® namespace å’Œ container_name åˆ›å»º elasticsearch çš„ indexï¼Œå¹¶ä½œä¸º index çš„å‘½åå‰ç¼€ï¼Ÿ

Aï¼šé¦–å…ˆä¸å»ºè®®é€šè¿‡ docker ç›®å½•çš„æ–¹å¼é‡‡é›†ï¼Œæ—¥å¿—è¿˜æ˜¯è½ç›˜åˆ°å…·ä½“è·¯å¾„ä¸ºå¥½ï¼Œå› ä¸ºæˆ‘ä¹Ÿç¢°åˆ°è¿‡æ‚¨è¿™ä¸ªå›°æƒ‘ï¼Œå› ä¸º docker çš„ç›®å½•éƒ½æ˜¯è½¯é“¾æŽ¥ï¼Œè€Œä¸”å½“ docker é‡å¯åŽè·¯å¾„ä¼šæ”¹å˜ï¼Œå½“ç„¶æˆ‘ä»¬çº¿ä¸Šç”¨çš„æ˜¯ filebeat é‡‡é›†ï¼Œä¸çŸ¥é“ fluentd èƒ½ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”±äºŽæ˜¯è½¯é“¾æŽ¥ï¼Œå¾ˆéš¾ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå¿…é¡»ç”¨ç»å¯¹è·¯å¾„é‡‡é›†åˆ°çœŸæ­£å­˜æ”¾çš„é‚£ä¸ªç›®å½•æ—¥å¿—ï¼Œæˆ‘ä»¬å¯¹äºŽ es index åç§°çš„åˆ›å»ºæ˜¯é€šè¿‡æ—¥å¿—æä¾›çš„ä¸€ä¸ª index åç§°å­—æ®µåŽ»åŒ¹é…çš„ï¼Œç´¢å¼•åç§°ä¼šå¼•ç”¨è¿™ä¸ªå˜é‡è¿›è¡ŒåŒºåˆ†ä¸åŒçš„ indexã€‚

> Qï¼šfileneat node æ¨¡å¼é‡‡é›†ï¼Œå¤šä¸ªç›¸åŒ pod åœ¨åŒä¸€èŠ‚ç‚¹æƒ…å†µä¸‹ï¼Œå¦‚ä½•æ˜ å°„æ—¥å¿—ç›®å½•è€³ä¸äº’ç›¸å¹²æ‰°ï¼Œå¦å¤–å¦‚ä½•é…ç½® filebeat åšåˆ° pod å˜åŠ¨æ—¶çš„é‡‡é›†

Aï¼šæ‚¨è¿™ä¸ªæƒ…å†µæˆ‘ä»¬ä¹Ÿé‡åˆ°è¿‡ï¼Œå¤šä¸ª pod è·‘åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ç¡®å®žå­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºä½ çš„ deploy yaml æ˜¯å®šæ­»çš„ï¼Œå¾ˆéš¾å¤„ç†è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬çš„è§£å†³æ–¹æ³•æ˜¯æ·»åŠ  pod çš„äº²å’Œæ€§ï¼Œä¿è¯æ¯ä¸ªèŠ‚ç‚¹éƒ½å°½é‡åªè·‘ä¸€ä¸ª podï¼Œå½“ç„¶å¦‚æžœèŠ‚ç‚¹éžå¸¸å°çš„æƒ…å†µä¸‹ï¼Œè¿™ç§åšæ³•æœ‰ä¸€å®šé—®é¢˜ï¼Œä»¥ç”Ÿäº§ä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œæˆ‘ä»¬æœ€åˆå¤šä¸ª pod è·‘åœ¨ä¸€ä¸ªèŠ‚ç‚¹åŒæ—¶å†™ä¸€ä¸ªæ–‡ä»¶çš„è¯ä¹Ÿæ˜¯è¿˜å¯æŽ¥å—ã€‚

> Qï¼šæŒç»­é›†æˆç³»ç»Ÿå…·ä½“çš„ç»†èŠ‚å¯ä»¥é€éœ²ä¸‹å—ï¼ŸåŸºäºŽ gitlab ciï¼Œjekinsï¼Ÿæˆ–è€…å°å…¬å¸å¯ä»¥ç›´æŽ¥ç”¨ Spinnaker è¿™äº›å—ï¼Ÿ

Aï¼šci cd çš„è¯å› ä¸ºæˆ‘ä»¬æœ‰è‡ªå·±çŽ°æœ‰çš„å‘å¸ƒå¹³å°ï¼ŒèƒŒåŽçš„åŽŸç†å®žé™…ä¸Šè¿˜æ˜¯è°ƒç”¨ jenkins åŽ»å¤„ç†

> Qï¼šæ—¥å¿—æ”¶é›†çš„ sidectar æ¨¡å¼å…·ä½“æ˜¯å’‹éƒ¨ç½²çš„ã€‚filebeat å’Œåº”ç”¨éƒ¨ç½²åœ¨ä¸€ä¸ª pod é‡Œå—

Aï¼šå¯¹çš„ï¼Œéƒ¨ç½²åœ¨ä¸€ä¸ª pod é‡Œï¼Œç›¸å½“äºŽä½ çš„ deploy yaml é‡Œä¼šæœ‰ä¸¤ä¸ª image é…ç½®ï¼Œä¸€ä¸ªæ˜¯ä½ çš„æœåŠ¡ï¼Œå¦ä¸€ä¸ªæ˜¯ filebeatï¼Œå…·ä½“çš„é…ç½®çœ‹ä¸‹æˆ‘çš„æˆªå›¾ï¼ŒæŠŠè¿™éƒ¨åˆ†é…ç½®æ”¾åˆ°ä½ çš„æœåŠ¡é…ç½®åŽé¢å³å¯ï¼Œä½†æ˜¯å°±åƒæˆ‘åˆ†äº«è¯´çš„ï¼Œè¿™ç§æ–¹å¼å¯èƒ½ä¼šæ¯”è¾ƒæ¶ˆè€—èµ„æºï¼Œä½†æ˜¯ç¡®å®žè‡ªå®šä¹‰æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†ä¹Ÿå¢žåŠ äº† yaml é…ç½®

> Qï¼šæˆ‘å¸æµ‹è¯•çŽ¯å¢ƒæ­å»ºçš„ Harbor ç‰ˆæœ¬æ˜¯ 1.5ï¼Œä½¿ç”¨ docker-compose æ¥æŒ‰ç…§ Harbor å„ä¸ªç»„ä»¶çš„ä¾èµ–é¡ºåºæ¥å¯åŠ¨çš„ï¼Œä½†æ˜¯å½“ç³»ç»Ÿæˆ–è€… docker é‡å¯åŽï¼ŒHarbor çš„å®¹å™¨å°±æ— æ³•æŒ‰ç…§ä¾èµ–é¡ºåºæ¥å¯åŠ¨ï¼Œç»å¸¸ä¼šæœ‰å®¹å™¨å¯åŠ¨å¤±è´¥ã€‚è¯·é—®ä¸‹è¿™ä¸ªè¯¥å¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ

Aï¼šå…¶å®žä½ éœ€è¦åœ¨ docker ä¸­æ³¨æ„ä¸€ä¸ªå‚æ•°ï¼Œlive-restore : trueï¼Œè¿™ä¸ªå‚æ•°å¾ˆæœ‰ç”¨ï¼Œä½ å¯èƒ½æ²¡æœ‰æ·»åŠ ï¼Œè¿™ä¸ªå‚æ•°èƒ½ä¿è¯åœ¨ä½ ç»´æŠ¤é‡å¯ docker çš„æ—¶å€™ï¼Œè¿˜èƒ½ä¿è¯ä¸å½±å“æ­£åœ¨è¿è¡Œçš„ docker å®¹å™¨ï¼Œå¦å¤–ä½ å¯ä»¥å¯¹ harbor è¿›è¡Œç›‘æŽ§ï¼Œå¦‚æžœ down äº†çš„è¯å¤§ä¸äº†åšä¸ªè‡ªåŠ¨é‡å¯çš„æ“ä½œä¹Ÿä¸å¦¨å¤§ç¢ã€‚

> Qï¼šï¼ˆ1)k8s å¹³å°ä¸Šçº¿å‰æœ‰ä»€ä¹ˆæµ‹è¯•ï¼Ÿå¦‚ä½•æµ‹è¯•ï¼Ÿå¯ä»¥ä¸Šçº¿çš„ä¾æ®ï¼Ÿï¼ˆ2)å¸¸è§äº’è”ç½‘æž¶æž„çš„ä¸šåŠ¡ï¼Œéœ€è¦æ”¹é€ æ‰å¯ä»¥åœ¨ k8s è·‘å—ï¼Ÿéœ€è¦å¦‚ä½•æ”¹é€ ï¼Ÿæœ‰ä»€ä¹ˆå‘ï¼Ÿï¼ˆ3)ä½ ä»¬å¤šä¸ªä¸šåŠ¡çº¿éƒ½å…±ç”¨åŒä¸€å¥— k8sï¼Ÿå¦‚ä½•å®žçŽ°ä¸ä¼šå› ä¸ºä¸€ä¸ªä¸šåŠ¡çš„é«˜å³°å½±å“å…¶ä»–ä¸šåŠ¡ï¼Ÿï¼ˆ4)æœ‰ä»€ä¹ˆæ–¹æ¡ˆå¯ä»¥å®žçŽ°æœ€å¤§é™åº¦çš„ä¸ä¸¢æ—¥å¿—ï¼Ÿ

Aï¼š1.å› ä¸ºæˆ‘ä¸æ˜¯æµ‹è¯•ï¼Œå¯¹äºŽæµ‹è¯•è¿™å—å¯èƒ½å¹²æ¶‰çš„ä¸æ˜¯å¾ˆå¤šï¼Œå¯¹äºŽè¿ç»´æ¥è®²å¯èƒ½æ›´å¤šçš„æ˜¯æ¯”è¾ƒå…³æ³¨ä¸Šçº¿ä¹‹å‰çš„åŽ‹åŠ›æµ‹è¯•ï¼Œè¿™å—ä¼šè·ŸåŽç»­çš„ç¨³å®šæ€§æœ‰å¾ˆå¤§å…³ç³» 2. å¸¸è§çš„æž¶æž„ä¸šåŠ¡ç†è®ºä¸Šæ”¹é€ åº”è¯¥ä¸éœ€è¦å¾ˆå¤§ï¼Œæœ€ä¸»è¦çš„æ˜¯è§£å†³ docker é•œåƒåŒ–ï¼Œé‡åˆ°çš„å‘å¯èƒ½æ›´å¤šçš„æ˜¯å¯¹äºŽ dockerfile æ‰“é•œåƒç†è§£çš„ä¸å¥½ï¼Œå¯¼è‡´ä¸€äº›å¯åŠ¨é—®é¢˜ä»¥åŠé…ç½®çš„ä¸¢å¤±ç­‰ç­‰ï¼Œ3. æˆ‘ä»¬æ˜¯é€šè¿‡ namespace åŒºåˆ†ä¸šåŠ¡çº¿ï¼Œéœ€è¦æå‰è§„åˆ’å¥½ä¸šåŠ¡ï¼ŒæŒ‡å®šçš„ä¸šåŠ¡çº¿åªè·‘åœ¨å¯¹åº”çš„æœºå™¨ä¸Šæ¯”è¾ƒå…³é”®ã€‚ 4. æˆ‘ä½¿ç”¨çš„ ELK è¿‡ç¨‹ä¸­è¿˜çœŸçš„å¾ˆå°‘é‡åˆ°è¿‡ä¸¢æ—¥å¿—ï¼Œåªè¦ä½ æž¶æž„è¶³å¤Ÿå¥å£®åº”è¯¥æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œå¦å¤– ELK ä¸­ä¸€å®šè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé™ä½Žä½ æ¶ˆæ¯ä¼ é€’çš„åŽ‹åŠ›ï¼Œä¿è¯æ¯ä¸ªç»„ä»¶éƒ½ä¸è¦å‡ºçŽ°æ€§èƒ½ç“¶é¢ˆï¼Œå¦‚æžœå®žåœ¨æ€•ä¸¢æ—¥å¿—ï¼Œå¯ä»¥è®© logstash åœ¨æ¶ˆè´¹çš„æ—¶å€™æŠŠæ¶ˆæ¯è½ç›˜ï¼Œes ä¹Ÿè¦åˆç†é…ç½®å¥½åˆ·æ–°çš„é¢‘çŽ‡ä»¥åŠå†…å­˜å¤šå¤§è½ç›˜ç­‰å‚æ•°ï¼Œæå‰åšå¥½å„ä¸ªç»„ä»¶çš„åŽ‹æµ‹æ˜¯ä¿éšœã€‚

> Qï¼š ä½ å¥½ï¼Œæˆ‘æ˜¯è”šæ¥ es8 è½¦ä¸»ï¼Œå¾ˆé«˜å…´çœ‹åˆ°è”šæ¥çš„åˆ†äº«ã€‚æˆ‘æƒ³äº†è§£ä¸‹ä½ ä»¬å­˜å‚¨çš„æ–¹æ¡ˆï¼Œä¹‹å‰å¬è¯´æ˜¯ç”¨çš„ portworxï¼Œå…·ä½“æ–¹æ¡ˆé€éœ²ä¸€ä¸‹ã€‚ä½ ä»¬è¿™ä¸ª team åœ¨åŒ—äº¬è¿˜æ˜¯ä¸Šæµ·ï¼Ÿ ç”¨ aws çš„è¯æœ‰æ²¡æœ‰è€ƒè™‘ç›´æŽ¥ä½¿ç”¨ aws çš„ k8s æœåŠ¡ï¼Ÿes ä¹Ÿè¿è¡Œåœ¨ k8s é‡Œå—ï¼Ÿ

Aï¼š æ‚¨å¥½ï¼Œæˆ‘ä»¬ team åœ¨åŒ—äº¬ï¼Œå› ä¸ºæˆ‘ä»¬çš„é›†ç¾¤è¿˜æœªä¸Šæœ‰çŠ¶æ€æœåŠ¡ï¼Œæ‰€ä»¥æš‚æ—¶è¿˜æœªè€ƒè™‘åˆ†å¸ƒå¼å­˜å‚¨çš„é—®é¢˜ï¼Œè¿™å—ç¡®å®žæ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªçŽ¯èŠ‚ï¼Œæˆ‘ä»¬çº¿ä¸Šçš„æœåŠ¡åŸºæœ¬ä¹Ÿæ˜¯é€šè¿‡ S3 åŽ»å­˜å‚¨ä¸€äº›æ•°æ®ä½¿ç”¨ï¼Œportworx è¿™ä¸ªå¥½åƒä¹Ÿå‡ºäº†å¾ˆä¹…äº†ï¼Œå½“æ—¶åœ¨è¿˜æ²¡æœ‰ k8s çš„æ—¶å€™è°ƒç ”è¿‡ï¼Œä¸è¿‡æƒ³å¤§é¢ç§¯ä½¿ç”¨è²Œä¼¼æ˜¯è¦èŠ±é’±ç”¨å•†ä¸šç‰ˆï¼Œå»ºè®®è¿˜æ˜¯ç”¨çŽ°åœ¨æ¯”è¾ƒæµè¡Œçš„ ceph å¯èƒ½ä¼šæ›´å¥½ä¸€äº›å§ï¼Œæˆ‘ä»¬è¿˜æœªç”¨åˆ° aws è‡ªå·±çš„ k8s æœåŠ¡ï¼Œes æœ‰è¿è¡Œåœ¨ k8s é‡Œçš„ä¸šåŠ¡ï¼Œä½†æ˜¯ä¸æ˜¯é€šè¿‡ operator éƒ¨ç½²ï¼ŒåŽç«¯æ•°æ®ä¹Ÿæ²¡ç”¨åˆ°åˆ†å¸ƒå¼å­˜å‚¨ï¼Œç”±äºŽé‡ä¸å¤§ï¼Œåªæ˜¯è½åœ¨æœ¬åœ°äº†ï¼ŒåŽæœŸä¼šè¿›ä¸€æ­¥è°ƒç ” ceph ä»¥æ”¯æŒåŽæœŸçš„æœ‰çŠ¶æ€æœåŠ¡çš„è¿ç§»ã€‚

> Qï¼š è¯·é—®æ˜¯å¦è€ƒè™‘è¿‡ fluent-bit ï¼Œç›®å‰ filebeat æœ‰æ²¡æœ‰æ€§èƒ½ä¸Šçš„é—®é¢˜å‘¢ï¼Ÿ

Aï¼š å› ä¸ºåœ¨è™šæ‹Ÿæœºçš„æ—¶å€™æˆ‘ä»¬å°±ç”¨çš„ filebeatï¼Œå°±æ²¿ç”¨ä¸‹åŽ»äº†ï¼Œfilebeat æš‚æ—¶è¿˜æœªå‘çŽ°æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨ï¼Œæ€»æ—¥å¿—é‡æˆ‘ä»¬åº”è¯¥æœ‰å‡ å T çš„æ ·å­ï¼Œåœ¨ç”Ÿäº§ä½¿ç”¨çš„è¿‡ç¨‹ä¸­æ„Ÿè§‰ filebeat è¿˜æ˜¯æ¯”è¾ƒé è°±çš„ã€‚

> Qï¼šk8s ä¸€å¹´çš„è¯ä¹¦é—®é¢˜ï¼Œä½ ä»¬æ€Žä¹ˆè§£å†³çš„å‘¢ï¼Ÿ

Aï¼š k8s çš„è¯ä¹¦æˆ‘ä»¬çš„æ—¶é—´éƒ½è®¾ç½®çš„æ˜¯åå¹´ï¼Œkubelet å¯èƒ½æ˜¯ä¸€å¹´ï¼Œè¿™ä¸ªæˆ‘ä»¬æœ€åˆç–å¿½äº†ï¼Œç¢°åˆ°è¿‡ä¸€æ¬¡ï¼Œæœ€ç»ˆé€šè¿‡åˆ é™¤çŽ°æœ‰çš„é…ç½®ï¼Œè®© kubelet é‡å¯è‡ªåŠ¨ç”Ÿæˆï¼Œå½“ç„¶å¦‚æžœæ‚¨æ˜¯æœ€åˆè§„åˆ’çš„è¯ï¼Œå¯ä»¥åŠ ä¸Šè¯ä¹¦è‡ªåŠ¨åˆ°æœŸè®¤è¯çš„åŠŸèƒ½ï¼Œæ®äº†è§£å¥½åƒçŽ°åœ¨é«˜ç‰ˆæœ¬çš„ k8s å·²ç»ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è¿˜æ²¡äº†è§£çš„é‚£ä¹ˆå¤šï¼Œæ‚¨å¯ä»¥å†æŸ¥æŸ¥

> Qï¼šk8s ç”Ÿäº§çŽ¯å¢ƒä¸Šçš„å®‰å…¨ç›¸å…³çš„é…ç½®æœ‰å“ªäº›å‘¢ï¼Ÿ

Aï¼š å®‰å…¨çš„è¯è¿™ä¸ªæ¯”è¾ƒå®½æ³›å•Šï¼Œè¿™ä¸ªè¿˜æ˜¯è¦ä»Žå„ä¸ªæ–¹é¢å®Œå–„ï¼Œé¦–å…ˆèµ·ç è¦ä¿è¯æµé‡æµå…¥æ–¹å‘çš„å„ä¸ªçŽ¯èŠ‚çš„å®‰å…¨é™åˆ¶ï¼Œä»¥åŠæœåŠ¡æŽ¥å£è°ƒç”¨ä¸Šçš„å®‰å…¨è®¤è¯ï¼Œä»¥åŠå¼€å‘äººå‘˜ä½¿ç”¨æ—¶å€™çš„æƒé™æŽ§åˆ¶ç­‰ç­‰ã€‚

> Qï¼šprometheus è‡ªå®šä¹‰ç›‘æŽ§å…·ä½“æ€Žä¹ˆæžå¾—ï¼Œæ¯”å¦‚æƒ³è¦ç›‘æŽ§å®¹å™¨çš„ç«¯å£è¿žæŽ¥æ•°?

Aï¼šå®¹å™¨ç«¯å£çš„è¿žæŽ¥æ•°ç›‘æŽ§ç¡®å®žè¿˜æœªæ·»åŠ ï¼Œåœ¨åŽŸæ¥å®¿ä¸»æœºçš„æ—¶å€™æ˜¯æœ‰çš„ï¼Œè¿™å—æœ‰äº›å¿½ç•¥äº†ï¼ŒåŠ çš„è¯ä¹Ÿä¸æ˜¯å¾ˆè´¹åŠ²ï¼Œå¯ä»¥é€šè¿‡ä½ ä»¬è‡ªå·±è‡ªå®šä¹‰çš„ exporter åŽ»ç›‘æŽ§ã€‚

> Qï¼šè½ç›˜çš„æ—¥å¿—æ€Žä¹ˆå®šæœŸæ¸…ç†

Aï¼š è½ç›˜çš„æ—¥å¿—é€šè¿‡å†™å¥½çš„æ¸…ç†ä»»åŠ¡è¿›è¡Œæ¸…ç†ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ—¥å¿—éƒ½æ˜¯è§„èŒƒçš„è½åˆ°ç»Ÿä¸€çš„ç›®å½•ï¼Œå¹¶ä¸”ç›®å½•åç§°ä¹Ÿæ˜¯å¾ˆè§„èŒƒçš„ï¼Œæ‰€ä»¥æ¸…ç†èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œå†™ä¸ªç®€å•çš„è„šæœ¬å°±å¯ä»¥å•¦ï¼Œå®šæ—¶æ¸…ç†å°± OK

> Qï¼šk8s é‡Œ java æœåŠ¡ï¼Œä½ ä»¬æ˜¯æ€Žä¹ˆåšèµ„æºé™åˆ¶çš„ï¼Ÿ

Aï¼š æˆ‘ä»¬æ˜¯åœ¨ yaml æ³¨å…¥äº†èƒ½èŽ·å–è®¾ç½®èµ„æºçš„ env å‚æ•°ï¼Œç„¶åŽåœ¨ ci æ‰“é•œåƒçš„æ—¶å€™ç»Ÿä¸€è§„èŒƒäº†æœåŠ¡å¯åŠ¨çš„ start è„šæœ¬ï¼Œjvm é‡Œé…ç½®çš„æ˜¯ k8s é…ç½®çš„èµ„æºï¼Œæ‰€ä»¥ java æœåŠ¡çš„ä½¿ç”¨ä¹Ÿä¸ä¼šè¶…è¿‡æˆ‘ä»¬åˆ†é…èµ„æºçš„ä½¿ç”¨ã€‚

> Qï¼šæƒ³äº†è§£ä¸‹ä½ ä»¬æ—¥å¿—æ”¶é›† ä½ ä»¬çš„æœåŠ¡æ•°ä¹Ÿå°±æ˜¯æ—¥å¿—æ•°å¤§æ¦‚å¤šå°‘ï¼Ÿæ¯ä¸ª k8s èŠ‚ç‚¹åˆ†é…åˆ°çš„ pod å¤§æ¦‚å¤šå°‘ å› ä¸ºæ˜¯ daemonset éƒ¨ç½²æƒ³äº†è§£ä¸€ä¸‹ filebeat çš„é…ç½®æ–‡ä»¶æ˜¯æ€Žä¹ˆç®¡ç†çš„ï¼Ÿ  åŽç«¯æ—¥å¿—åˆ†æžå®Œå…¨é  es ä¹ˆï¼Ÿæ—¥å¿—æœ‰æ²¡æœ‰å…¥ hadoop çš„éœ€æ±‚ï¼Ÿæœ‰ MR æˆ– spark

Aï¼š æˆ‘ä»¬ä¸€å¤©çš„æ—¥å¿—é‡æœ€å¤šèƒ½è¾¾åˆ°è¿‘ 10T çš„æ•°æ®ï¼Œå½“ç„¶è¿™ä¸å…¨æ˜¯ k8s è¿™è¾¹çš„æ—¥å¿—ï¼Œ1 ä¸ªèŠ‚ç‚¹æœ€å¤šçš„è¯å¤§æ¦‚èƒ½è·‘åˆ° 30 å¤šä¸ª podï¼Œfilebeat æˆ‘ä»¬æ˜¯èµ°çš„ç»Ÿä¸€çš„ä¸€ä»½é…ç½®ï¼Œå› ä¸ºæ—¥å¿—éƒ½æ˜¯ json è§„èŒƒå¥½å­—æ®µä¼ è¾“ï¼Œä¹Ÿæ— éœ€åšè¿‡å¤šå¤„ç†ï¼Œå› ä¸ºæ—¥å¿—åˆ†æžä¸»è¦ä¸åœ¨è¿™ä¸ªåœºæ™¯åšï¼Œæˆ‘ä»¬è¿™ä¸ªåœºæ™¯åªæ˜¯æä¾›å¼€å‘çœ‹æ—¥å¿—ï¼Œå½“ç„¶å…¶ä¸­ä¸€äº›ç½‘å…³æ•°æ®æˆ‘ä»¬ä¼šåšæŠ¥è­¦å’Œå…·ä½“çš„å›¾ç¤ºï¼Œéœ€è¦åˆ†æžçš„å¤§æ•°æ®ä¸“é—¨èµ°æˆ‘ä»¬çš„ hadoop é›†ç¾¤ï¼Œæˆ‘ä»¬è¿™è¾¹æœ‰ç”¨åˆ° MR å’Œ sparkï¼Œä½†æ˜¯å¤§æ•°æ®ç›¸å…³çš„ä¸œè¥¿éƒ½æ²¡æœ‰åœ¨ K8S ä¸Šé¢ã€‚

---

### 2019-10-10ï¼šè¶…å¤§è§„æ¨¡å•†ç”¨ K8s åœºæ™¯ä¸‹ï¼Œé˜¿é‡Œå·´å·´å¦‚ä½•åŠ¨æ€è§£å†³å®¹å™¨èµ„æºçš„æŒ‰éœ€åˆ†é…é—®é¢˜ï¼Ÿ

[æé—®é“¾æŽ¥](https://shimo.im/docs/Jc6yppJhcDYdPXRH)

> Qï¼šè¯·é—® heapster ä¸­é‡‡é›†åˆ°çš„ MetricMemoryWorkingSet æŒ‡æ ‡ä¸Ž ps å‘½ä»¤èŽ·å–åˆ°çš„ RSS æœ‰ä½•åŒºåˆ«ï¼Ÿheapster çš„æºç ä¸­å¯¹è¯¥æŒ‡æ ‡çš„æè¿°æ˜¯â€œTotal working set usage. Working set is the memory being used and not easily dropped by the kernelâ€ï¼ŒåŒæ—¶ heapster ä¹Ÿé‡‡é›†äº† MetricMemoryRSSï¼Œkubectl top ä¸ºä½•é‡‡ç”¨ MetricMemoryWorkingSet è€Œä¸é‡‡ç”¨ MetricMemoryRSSï¼Ÿåœ¨ Kubernets 1.10 ç‰ˆæœ¬ä¸‹ï¼Œéƒ¨åˆ†è¿è¡Œ Java åº”ç”¨çš„ pod å‡ºçŽ° kubectl top å€¼è¶…è¿‡ ps RSS å€¼çš„æƒ…å†µã€‚

A1ï¼šé˜¿é‡Œå·´å·´å†…éƒ¨å¹¶ä¸ä½¿ç”¨ heapsterï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ç›´æŽ¥åŽ»è¯»å–å®¹å™¨ cgroup å€¼ï¼ŒèŽ·å–å®¹å™¨å®žæ—¶èµ„æºä½¿ç”¨æƒ…å†µã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œç¤¾åŒºå¯¹äºŽ heapster å®Œå…¨åºŸå¼ƒã€‚å»ºè®®é€šè¿‡ä¸»æµå·¥å…·é‡‡é›†ï¼Œæ±‡èšï¼Œèšåˆæ•°æ®ã€‚è¯•è¯• [custom-metrics-apiserver](https://github.com/kubernetes-incubator/custom-metrics-apiserver) å’Œ [kube-state-metrics](https://github.com/kubernetes/kube-state-metrics/tree/master/docs) ã€‚åœ¨å¤§è§„æ¨¡åœºæ™¯ä¸‹ç¤¾åŒºçš„å¾ˆå¤šå¼€æºå·¥å…·éƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œä¸€èˆ¬è¿™ç±»å·¥å…·æˆ‘ä»¬å€¾å‘äºŽè‡ªç ”ã€‚

> Qï¼šå¦‚ä½•çœ‹å¾… suse æ”¾å¼ƒ openstack?

A2ï¼šOpenstack æ˜¯æ¬¾ä¼Ÿå¤§çš„è½¯ä»¶ï¼Œå®ƒç»™ IaaS çš„ç ”å‘å’Œå‘¨è¾¹ç”Ÿæ€å¸¦äº†å¾ˆå¤šæ„æƒ³ä¸åˆ°çš„æˆæžœï¼Œä¾‹å¦‚ ceph ç­‰ã€‚SUSE æ”¾å¼ƒ OpenStack å¯èƒ½å‡ºäºŽå¤šç§åŽŸå› ã€‚æˆ–è®¸æ˜¯æŠ€æœ¯é€‰åž‹ï¼Œæˆ–è®¸æ˜¯è´¢æ”¿æ”¶ç›Šç­‰ç­‰ã€‚é¡ºä¾¿è¯´è¯´ï¼ŒSUSE ç›®å‰åœ¨ Kubernetes ç›¸å…³é¢†åŸŸçš„æŠ•å…¥è¿˜æ˜¯æŒºå¤šçš„ã€‚æœ€è¿‘çš„ Kubecon ä¸Šï¼ŒSUSE å‡å±•ç¤ºäº†ç›¸å…³æŠ€æœ¯æˆæžœã€‚

> Qï¼šç›´æŽ¥ä¿®æ”¹ cgroup å®¹å™¨ä¸€å®šä¼šèŽ·å¾—èµ„æºå—ï¼Ÿ

A3ï¼šå®¹å™¨æŠ€æœ¯éš”ç¦»çš„æŠ€æœ¯åŸºç¡€å°±æ˜¯ cgroup å±‚é¢ã€‚åœ¨å®¿ä¸»æœºè…¾å‡ºè¶³å¤Ÿèµ„æºçš„æƒ…å†µä¸‹ï¼Œç»™ cgroup è®¾ç½®æ›´å¤§çš„å€¼å¯ä»¥èŽ·å–æ›´å¤šçš„èµ„æºã€‚åŒç†ï¼Œå¯¹äºŽä¸€èˆ¬ä¼˜å…ˆçº§ä¸é«˜çš„åº”ç”¨ï¼Œè®¾ç½®è¾ƒä½Žçš„ cgroup èµ„æºå€¼å°±ä¼šè¾¾åˆ°æŠ‘åˆ¶å®¹å™¨è¿è¡Œçš„æ•ˆæžœã€‚

> Qï¼šåº•å±‚æ˜¯å¦‚ä½•åŒºåˆ†åœ¨çº¿å’Œç¦»çº¿ä¼˜å…ˆçº§çš„ï¼Ÿ

A4ï¼šåº•å±‚æ˜¯æ— æ³•è‡ªåŠ¨èŽ·å–è°æ˜¯åœ¨çº¿ï¼Œè°æ˜¯ç¦»çº¿ï¼Œæˆ–è€…è°çš„ä¼˜å…ˆçº§é«˜ï¼Œè°çš„ä¼˜å…ˆçº§ä½Žçš„ã€‚è¿™ä¸ªæˆ‘ä»¬å¯ä»¥é€šè¿‡å„ç§ Kubernetes æä¾›çš„æ‰©å±•å®žçŽ°ã€‚æœ€ç®€å•çš„æ˜¯é€šè¿‡ labelï¼ŒAnnotation æ ‡è¯†ã€‚å½“ç„¶é€šè¿‡æ‰©å±• QoS class ä¹Ÿæ˜¯ä¸€ç§æ€è·¯ã€‚ç¤¾åŒºç‰ˆæœ¬çš„ QoS class è®¾ç½®å¤ªè¿‡äºŽä¿å®ˆï¼Œç»™äºˆç”¨æˆ·å‘æŒ¥çš„ç©ºé—´ä¸å¤§ã€‚æˆ‘ä»¬é€šè¿‡è¿™äº›æ–¹é¢ä¹Ÿè¿›è¡Œäº†å¢žå¼ºã€‚åœ¨åˆé€‚çš„æ—¶å€™æˆ–è®¸ä¼šæŽ¨å‘ç¤¾åŒºã€‚è‡ªæ¥æ¥æ¥åŠ¨æ„ŸçŸ¥æ˜¯ä¸ªæ–¹å‘ï¼Œæ„ŸçŸ¥è°æ˜¯å¹²æ‰°æºï¼Œæ„ŸçŸ¥è°æ˜¯æŸç§èµ„æºåž‹åº”ç”¨ï¼Œè¿™å—æˆ‘ä»¬è¿˜åœ¨ç ”å‘ä¸­ã€‚åšåˆ°çœŸæ­£çš„åŠ¨æ€ï¼Œè‚¯å®šæ˜¯å…·å¤‡è‡ªåŠ¨æ„ŸçŸ¥çš„æ™ºèƒ½ç³»ç»Ÿã€‚

> Qï¼š â€œä¸Žç¤¾åŒºç‰ˆ  Vertical-Pod-Autoscaler ä¸åŒï¼ŒPolicy engine ä¸ä¸»åŠ¨é©±é€è…¾æŒªå®¹å™¨ï¼Œè€Œæ˜¯ç›´æŽ¥ä¿®æ”¹å®¹å™¨çš„ cgroup æ–‡ä»¶ï¼›â€œï¼Œæƒ³é—®ä¸€ä¸‹ï¼Œä¸ä¸»åŠ¨é©±é€çš„è¯ï¼Œå¦‚æžœ Node çš„èµ„æºè¾¾åˆ°ä¸Šçº¿äº†ä¼šæ€Žä¹ˆå¤„ç†ï¼Ÿ

A5ï¼šè¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ã€‚é¦–å…ˆè¿™é‡Œè¦å…ˆåŒºåˆ†æ˜¯å“ªç§èµ„æºï¼Œå¦‚æžœæ˜¯ CPU åž‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´ä½Žä¼˜å…ˆçº§å®¹å™¨çš„ cgroup ä¸‹ cpu quota çš„å€¼ï¼Œé¦–å…ˆæŠ‘åˆ¶ä½Žä¼˜å…ˆçº§çš„å®¹å™¨å¯¹äºŽ CPU çš„äº‰æŠ¢ã€‚ç„¶åŽå†é€‚å½“ä¸Šè°ƒé«˜ä¼˜å…ˆçº§å®¹å™¨çš„ç›¸å…³èµ„æºå€¼ã€‚å¦‚æžœæ˜¯å†…å­˜åž‹èµ„æºï¼Œè¿™ä¸ªä¸èƒ½ç›´æŽ¥åŽ»ç¼©å°ä½Žä¼˜å…ˆçº§å®¹å™¨çš„ cgroup å€¼ï¼Œå¦åˆ™ä¼šé€ æˆ OOMï¼Œå¯¹äºŽå­¦ä¹ å­¦ä¹ å†…å­˜åž‹èµ„æºçš„è°ƒæ•´ï¼Œæˆ‘ä»¬ä¼šåœ¨å…¶ä»–åˆ†äº«ä¸­ç»§ç»­è®¨è®ºã€‚è¿™ä¸ªæŠ€æœ¯æ¯”è¾ƒç‰¹æ®Šã€‚

> Qï¼š åªä¿®æ”¹ cgroupï¼Œæ€Žä¹ˆä¿è¯ k8s å¯¹å•ä¸ªç‰©ç†æœºèƒ½å¤Ÿåˆ†é…æ›´å¤šçš„å®¹å™¨

A6ï¼šæ–‡å­—ç›´æ’­æœ‰äº†ä¸€å®šè¯´æ˜Žï¼Œå®¹å™¨çš„èµ„æºæ¶ˆè€—å¹¶éžæ˜¯ä¸€æˆä¸å˜çš„ï¼Œå¾ˆå¤šæ—¶å€™å®ƒä»¬çš„èµ„æºæ¶ˆè€—å‘ˆçŽ°æ½®æ±çŽ°è±¡ï¼Œç›¸åŒçš„èµ„æºæ¡ä»¶ä¸‹éƒ¨ç½²æ›´å¤šåº”ç”¨ï¼Œå®Œæˆæ›´å¤šä½œä¸šå°±æ˜¯è¾¾åˆ°èµ„æºåˆ©ç”¨çš„æœ€å¤§åŒ–çš„æ•ˆæžœã€‚èµ„æºå‡ºçŽ°è¶…å–æ‰æ˜¯æˆ‘ä»¬è¿™ä¸ªä¸»é¢˜è®¨è®ºçš„æœ€å¤§ä»·å€¼ã€‚

> Qï¼šä¹Ÿå°±æ˜¯è¯´ ä½Žä¼˜å…ˆçº§çš„å®¹å™¨ï¼Œrequest è®¾ç½®çš„æ¯” limit å°å¾ˆå¤šï¼Œç„¶åŽä½ ä»¬å†åŠ¨æ€çš„è°ƒæ•´ cgroupï¼Ÿ

A7ï¼šåœ¨çŽ°æœ‰ QoS åœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥ç†è§£è¢«è°ƒæ•´çš„ Pod éƒ½æ˜¯ burstable çš„ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸æ˜¯ç›´æŽ¥è°ƒæ•´ Pod å…ƒæ•°æ®çš„ limit çš„å€¼ï¼Œè€Œæ˜¯è°ƒæ•´ limit åœ¨ cgroup åæ˜ çš„å€¼ï¼Œè¿™ä¸ªå€¼åœ¨èµ„æºç«žäº‰ç¼“å’Œçš„æ—¶å€™è¿˜ä¼šè¢«è°ƒæ•´å›žåŽ»çš„ã€‚æˆ‘ä»¬å¹¶ä¸å»ºè®®å•æœºçš„ cgroup æ•°æ®å’Œ etcd çš„ä¸­å¿ƒæ•°æ®å‰²è£‚å¤ªä¹…ã€‚å¦‚æžœé•¿æœŸåç¦»ï¼Œæˆ‘ä»¬ä¼šåƒ VPA å‘å‡ºè­¦æŠ¥ï¼Œè”åŠ¨ VPA åšè°ƒæ•´ã€‚å½“ç„¶åœ¨å®¹å™¨è¿è¡Œçš„é«˜å³°æœŸï¼Œä»»ä½•é‡å»ºå®¹å™¨çš„æ“ä½œéƒ½æ˜¯ä¸æ˜Žæ™ºçš„ã€‚

> Qï¼šä½ ä»¬çŽ°åœ¨ cpu è¶…å–çš„æ¯”ä¾‹æ˜¯å¤šå°‘ï¼Ÿ

A8ï¼šè¿™ä¸ªä¸æ–¹ä¾¿å›žç­”ï¼Œå“ˆå“ˆã€‚ç­‰æˆ‘ç¡®è®¤å¯ä»¥å›žç­”çš„æ—¶å€™å†ä¿®æ”¹è¿™é‡Œã€‚

> Qï¼šè°¢è°¢äº†ï¼Œæ•´ä½“çš„ç†è§£å°±æ˜¯ä½ ä»¬å¼€å§‹å°±è®©ç‰©ç†æœºè¶…é…äº†ä¸€å®šæ¯”ä¾‹çš„ podï¼Œç„¶åŽé€šè¿‡ç­–ç•¥åŠ¨æ€è°ƒæ•´å®¹å™¨çš„ cgroup å€¼

A9ï¼šå¦‚æžœèµ„æºå®Œå…¨æ˜¯å¯Œè¶³å†—ä½™çš„ï¼Œè¿™ä¸ªåŠ¨æ€è°ƒæ•´ä¹Ÿæœ‰ä¸€å®šæ„ä¹‰ã€‚å°±æ˜¯å¹¶éžèµ„æºç”¨æ»¡åœºæ™¯ä¸‹ï¼Œé«˜ä¼˜å…ˆçº§åº”ç”¨ä¼šè¢«å¹²æ‰°ï¼Œå®žé™…ä¸Šï¼Œå½“ä¸»æœºçš„ CPU è¾¾åˆ°ä¸€å®šæ¯”ä¾‹ï¼Œæ‰“ä¸ªæ¯”æ–¹ä¾‹å¦‚ 50%ï¼Œåº”ç”¨çš„æ—¶å»¶å°±å˜å¤§ã€‚ä¸ºäº†å®Œå…¨ç¡®ä¿é«˜ä¼˜å…ˆçº§åº”ç”¨çš„ SLOï¼Œç‰ºç‰²ä½Žä¼˜å…ˆçº§çš„ CPU æ­£å¸¸è¿è¡Œä¹Ÿæ˜¯æœ‰ä»·å€¼çš„ã€‚

> Qï¼šå¦‚ä½•ç¡®ä¿ä¸€å®šæ˜¯ä½Žä¼˜å…ˆçº§çš„å®¹å™¨å’Œé«˜ä¼˜å…ˆçº§çš„æœåŠ¡éƒ¨ç½²åœ¨ä¸€èµ·çš„ï¼Œè€Œä¸éƒ½æ˜¯é«˜ä¼˜å…ˆçº§æˆ–è€…ä¸éƒ½æ˜¯ä½Žä¼˜å…ˆçº§ï¼Œåªç”¨ packing ç®—æ³•å°±å¯ä»¥ï¼Ÿ

A10ï¼šè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒå¤šï¼Œå¯ä»¥é…ç½®äº²å’Œæ€§å’Œéžäº²å’Œæ€§ã€‚å¯ä»¥é€šè¿‡é¢„ç¼–æŽ’ç­‰æ‰‹æ®µã€‚é¢„ç¼–æŽ’å°±æ˜¯åœ¨åº”ç”¨éƒ¨ç½²å‰ï¼Œé¦–å…ˆè§„åˆ’å¥½å„ä¸ªåº”ç”¨éƒ¨ç½²åœ¨å“ªäº› node ä¸Šã€‚

> Qï¼šPolicy engine æœ‰æ²¡æœ‰è€ƒè™‘å¼€æºï¼Ÿ

A12ï¼šæœ‰è®¡åˆ’è¿›è¡Œå¼€æºï¼ŒPolicy engine æ›´å¤šçš„æ˜¯å’Œè‡ªèº«çš„åº”ç”¨å±žæ€§ç›¸å…³ï¼Œç”µå•†åº”ç”¨æˆ–è€…å¤§æ•°æ®å¤„ç†åº”ç”¨çš„ç­–ç•¥éƒ½æ˜¯ä¸ç›¸åŒçš„ï¼Œæˆ‘ä»¬å¼€æºä¼šé¦–å…ˆå¼€æºæ¡†æž¶å’Œé™„å¸¦ä¸€äº›ç®€å•çš„ç­–ç•¥ï¼Œæ›´å¤šçš„ç­–ç•¥å¯ä»¥ç”¨æˆ·è‡ªå®šä¹‰ã€‚

> Qï¼šåªæ˜¯è°ƒæ•´ Cgroup çš„é…ç½®ï¼Œå¯¹äºŽåº”ç”¨ä¸­çš„é…ç½®å¦‚ä½•æ”¹å˜ï¼Ÿæ¯”å¦‚ JVM æ ¹æ®ä¸­çš„ä¸€äº›å‚æ•°ï¼Ÿå¦‚æžœä¸é‡å¯ jvm å¦‚ä½•è®© Cgroup çš„é™åˆ¶ç”Ÿæ•ˆï¼Ÿ

A8: Java è¿›ç¨‹è¿˜æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ã€‚å¾ˆå¤šæ—¶å€™å®¹å™¨é‡å¯æ‰èƒ½é€‚é…çš„å‚æ•°æ‰èƒ½ç”Ÿæ•ˆã€‚æˆ‘ä»¬è¿™é‡Œé’ˆå¯¹çš„æ˜¯ä¸€ç§é€šç”¨çš„æ–¹å¼ã€‚å¯¹äºŽä½ æåˆ°çš„è¿™ç±»åº”ç”¨ï¼ŒåŽ‹åˆ¶ä½Žä¼˜å…ˆçº§çš„å®¹å™¨æœ‰æ•ˆï¼Œä½†æ˜¯ç»™é«˜ä¼˜å…ˆçº§åº”ç”¨å†åˆ†é…èµ„æºåº”è¯¥æ— æ•ˆã€‚

> Qï¼šæˆ‘ä¹‹å‰é‡åˆ°çš„å¤§éƒ¨åˆ†åº”ç”¨éƒ½æ— æ³•æ­£ç¡®æ„ŸçŸ¥ cgroup çš„é…ç½®ï¼Œå› æ­¤å¾ˆå¤šæƒ…å†µéƒ½éœ€è¦åœ¨å¯åŠ¨å‚æ•°é‡Œé¢æ ¹æ® cpu æˆ–è€… mem è®¾ç½®å‚æ•°ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´å³ä½¿æ”¹å˜äº† cgroup å¯¹äºŽä»–ä»¬æ¥è¯´éƒ½æ— æ•ˆï¼Œé‚£ä¹ˆä½¿ç”¨åœºæ™¯ä¹Ÿå°±æœ‰é™äº†

A14ï¼šé™åˆ¶å®¹å™¨çš„èµ„æºä½¿ç”¨è¿™ä¸ªè¿˜æ˜¯æœ‰ä»·å€¼çš„ã€‚é™åˆ¶ä½Žä¼˜å…ˆçº§åº”ç”¨æœ¬èº«ä¹Ÿå¯ä»¥æå‡é«˜ä¼˜å…ˆçº§åº”ç”¨çš„ SLOï¼Œè™½ç„¶æ•ˆæžœæ²¡æœ‰é‚£ä¹ˆæ˜Žæ˜¾ã€‚ç¨³å®šæ€§çš„è€ƒé‡åŒæ ·ä¹Ÿå¾ˆé‡è¦ã€‚

> Qï¼šPolicy engine ç›®å‰åœ¨é˜¿é‡Œçš„ä½¿ç”¨å¦‚ä½•ï¼Ÿåœ¨ç”Ÿäº§ä¸Šæœ‰å¤šä¸Šçš„è§„æ¨¡ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡ŒåŠ¨æ€è°ƒæ•´ï¼Ÿæ˜¯å¦å’Œç¤¾åŒºçš„ HPA VPA é…åˆä½¿ç”¨ï¼Ÿ

A15: Policy engine åœ¨é˜¿é‡ŒæŸäº›é›†ç¾¤å·²ç»ä½¿ç”¨ã€‚è‡³äºŽè§„æ¨¡æš‚æ—¶æ— æ³•é€æ¼ã€‚æ¶‰åŠåˆ°å¾ˆå¤šç»„ä»¶ä¹‹é—´çš„è”åŠ¨ï¼Œç¤¾åŒºçš„ HPA å’Œ VPA ç›®å‰éƒ½ä¸å¤ªèƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚å› æ­¤é˜¿é‡Œçš„ HPA å’Œ VPA éƒ½æ˜¯æˆ‘ä»¬è‡ªè¡Œå¼€å‘çš„ï¼Œä½†æ˜¯å’Œç¤¾åŒºçš„åŽŸç†æ˜¯ä¸€è‡´çš„ã€‚é˜¿é‡Œ HPA çš„å¼€æºå¯ä»¥å…³æ³¨ openkruise ç¤¾åŒºã€‚VPA å¼€æºè®¡åˆ’æˆ‘è¿™é‡Œè¿˜æ²¡æœ‰ç¡®åˆ‡æ¶ˆæ¯ã€‚

> Qï¼šdata aggregator é€šè¿‡ä»€ä¹ˆæ–¹å¼é‡‡é›†æ•°æ®?

A16ï¼šç±»ä¼¼ cadvisor æ–¹å¼ç›´æŽ¥ä»Ž node çš„ cgroup èŽ·å–å®žæ—¶èµ„æºæ¶ˆè€—æ•°æ®ã€‚ç„¶åŽæ ¹æ®å®¹å™¨ï¼Œnode ä¸ºå•ä½å†è¿›è¡Œèšåˆã€‚

> Qï¼šå½“å•æœºèŠ‚ç‚¹èµ„æºä¸è¶³ä»¥æä¾›å®¹å™¨æ‰©å®¹æ—¶ï¼Œç›®å‰æ˜¯å¦å¯ä»¥è¿›è¡Œ HPA æˆ– VPA æ‰©å®¹å‘¢

A17ï¼šå•æœºèŠ‚ç‚¹ä¸è¶³çš„æ—¶å€™ï¼Œåº”ç”¨å¯ä»¥é€šè¿‡ HPA è¿›è¡Œå¢žåŠ å‰¯æœ¬åº”å¯¹ã€‚ä½†æ˜¯ VPA å¦‚æžœé€‰æ‹©åŽŸèŠ‚ç‚¹è¿›è¡Œæ›´æ–°çš„è¯ï¼Œæ˜¯å¤±è´¥çš„ã€‚åªèƒ½è°ƒåº¦åˆ°å…¶ä»–èµ„æºä¸°å¯Œçš„èŠ‚ç‚¹ã€‚åœ¨æµé‡é™¡å‡çš„åœºæ™¯ä¸‹ï¼Œé‡å»ºå®¹å™¨æœª hâ€†h å¿…èƒ½æ»¡è¶³éœ€æ±‚ï¼Œå¾ˆå¯èƒ½å¯¼è‡´é›ªå´©ï¼Œå³é‡å»ºè¿‡ç¨‹ä¸­ï¼Œæ•´ä¸ªåº”ç”¨å…¶ä»–æœªå‡çº§çš„å‰¯æœ¬æŽ¥å—æ›´å¤šæµé‡ï¼ŒOOM æŽ‰ï¼Œæ–°å¯åŠ¨çš„å®¹å™¨å†çž¬é—´è¢« OOMï¼Œæ‰€ä»¥é‡å¯å®¹å™¨éœ€è¦æ…Žé‡ã€‚å¿«é€Ÿæ‰©å®¹ï¼ˆHPA)æˆ–è€…å¿«é€Ÿæå‡é«˜ä¼˜å…ˆçº§èµ„æºï¼ŒæŠ‘åˆ¶ä½Žä¼˜å…ˆçº§å®¹å™¨èµ„æºçš„æ–¹å¼æ•ˆæžœæ›´æ˜Žæ˜¾ã€‚

---

### 2019-11-07ï¼šå¦‚ä½•å®žçŽ° K8s ä¸€é”®éƒ¨ç½²ï¼Ÿå¼€å‘éƒ¨ç½²æé€Ÿ 8 å€ï¼Ÿå¸¦ä½ ä¸Šæ‰‹ä¸€æ¬¾ä¸‹è½½è¶… 10 ä¸‡æ¬¡çš„ IDEA æ’ä»¶

[æé—®é“¾æŽ¥](https://shimo.im/docs/6HDpcqJ3yQx8yHh3)

> Qï¼š k8s å„ç»„ä»¶ï¼Œæ¯”å¦‚ etcdï¼Œå»ºè®®éƒ¨ç½²åœ¨å®¹å™¨å†…è¿˜æ˜¯ç‰©ç†æœºï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…ä¼˜åŠ£å—ï¼Ÿ

A1ï¼šetcd å¯ä»¥éƒ¨ç½²åœ¨å®¹å™¨é‡Œï¼Œç‰©ç†æœºçš„è¯å°±æ˜¯æ€§èƒ½æ›´å¥½ä¸€ç‚¹ã€‚

> Qï¼šå¦‚æžœç™»å½•æ˜¯å ¡åž’æœºï¼Œå¹¶ä¸”æ˜¯åŠ¨æ€å¯†ç ï¼Œé‚£ä¸ªé…ç½®ä¿å­˜å¿…é¡»è¦å¯†ç ï¼Œæ‰€ä»¥ä¸æ–¹ä¾¿å§ï¼èƒ½åŠ¨æ€å¯†ç ç™»é™†å±€åŸŸç½‘æœåŠ¡å™¨å—ï¼Ÿ

A2ï¼šè¿™æ˜¯ä¸ªéžå¸¸å¥½çš„å»ºè®®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åŽç»­çš„ç‰ˆæœ¬ä¸­å¼€å‘è¿™äº›èƒ½åŠ›ã€‚

> Qï¼šå¦‚ä½•åœ¨æœ¬åœ°ç”µè„‘(å¦‚ mac)éƒ¨ç½² k8s çŽ©çŽ©ï¼Œä»¥åŠå†™ Go ä»£ç å¢žåˆ æ”¹æŸ¥ k8s èµ„æºï¼Œè¿™å—æœ‰å•¥çŽ©ä¸€çŽ©çš„ä¼˜è‰¯ç»éªŒå˜›ï¼Ÿç›®çš„æ˜¯æƒ³æœ¬åœ°å¼€å‘æµ‹è¯• k8sï¼Œæ›´åŠ åŽ»ç†Ÿæ‚‰ k8s å†…éƒ¨æœºåˆ¶ã€‚

A3ï¼šæœ¬åœ° mac è¦çŽ© k8s å¯ä»¥åŽ»æœä¸€ä¸‹ minikubeã€‚

> Qï¼šk8s ä¸€é”®éƒ¨ç½²æ˜¯ç”¨ kubeadm éƒ¨ç½²ä¹ˆï¼Œæœ¬åœ°è™šæ‹Ÿæœºéƒ¨ç½²å¤šèŠ‚ç‚¹ k8s é›†ç¾¤ï¼Œè™šæ‹Ÿæœºç½‘ç»œåº”è¯¥æ€Žä¹ˆå¤„ç†ã€‚ç”±äºŽæ˜¯è‡ªå·±éƒ¨ç½²ç€çŽ©çŽ©ï¼Œåœ¨å…¬å¸é‡Œè™šæ‹Ÿæœºç½‘ç»œä¸èƒ½ä½¿ç”¨æ¡¥æŽ¥çš„æ–¹å¼ã€‚è€Œä½¿ç”¨ç½‘ç»œåœ°å€è½¬æ¢ NET+hostonly åœ¨èµ· calico ç½‘ç»œçš„æ—¶å€™ worker èŠ‚ç‚¹ calico èµ·ä¸æ¥ï¼Œæç¤ºç½‘ç»œå†²çªã€‚è°¢è°¢

A4ï¼šnat æ¨¡å¼ä¸¤ä¸ªæœºå™¨ä¼šç”¨åŒä¸€ä¸ª IPï¼Œæ‰€ä»¥ä¼šå†²çªï¼Œå¯ä»¥ç»™è™šæ‹Ÿæœºé…ä¸¤ä¸ªç½‘å¡ï¼Œ1 ä¸ªç½‘å¡ç”¨ NET+hostonly ç”¨æ¥è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œ1 ä¸ªç½‘å¡ç”¨ private network ç”¨æ¥èŠ‚ç‚¹é—´ Pod çš„ç½‘ç»œ

> Qï¼šå¯¹äºŽåŽç«¯å¼€å‘è€…æ¥è¯´(å†™ Go)ï¼Œæœ‰å¿…è¦åŽ»æ›´åŠ ç†Ÿæ‚‰ k8s ä¹ˆï¼Ÿæ¯•ç«Ÿ k8s å°±æ˜¯ä¸ªè¿ç»´å·¥å…·ï¼Œä¸ºäº†æ›´çˆ½çš„åŽ»éƒ¨ç½²è½¯ä»¶ä»¥åŠæ‰©å®¹ç­‰ç­‰ï¼Œæœ‰å¿…è¦åŽ»æ·±å…¥äº†è§£ k8s å†…éƒ¨æœºåˆ¶ä¹ˆï¼Œè¿™å—æœ‰æ²¡æœ‰ä»€ä¹ˆå»ºè®®å’Œè§è§£ï¼Ÿ

A5ï¼šé¦–å…ˆï¼ŒKubernetes æœ¬èº«æ˜¯ç”¨ Go è¯­è¨€å†™çš„ï¼Œå°±æ˜¯ä¸€ä¸ªæœ€å¥½çš„ Go è¯­è¨€å¼€å‘å’Œæž¶æž„çš„æœ€ä½³å­¦ä¹ ç‰©ã€‚

> Qï¼šk8s ç½‘ç»œç»„ä»¶ calico å’Œè‡ªå¸¦çš„ flannelï¼Œè¯·é—®å»ºè®®é‡‡ç”¨å“ªä¸€ä¸ªï¼Ÿ

A6ï¼šç®€å•ä¸Šæ‰‹é€‰ flannelï¼Œçœ‹é‡åŠŸèƒ½é€‰ calico

> Qï¼šæœ‰å“ªäº›å¼€æºçš„ç®¡ç† k8s Web UI è½¯ä»¶ï¼Œè¿™æ ·å¯ä»¥éƒ¨ç½²åœ¨å…¬å¸å†…ï¼Œæ‰€æœ‰å›¢é˜Ÿç›´æŽ¥åœ¨è¯¥è½¯ä»¶å†…å‚»ç“œå¼æ“ä½œ k8s èµ„æºï¼Œè‡ªå·±éƒ¨ç½²ä¸Šçº¿ä»£ç ï¼Ÿ

A8ï¼šK8s è‡ªå¸¦çš„ dashboard å¯ä»¥è¯•è¯•

> Qï¼šæˆ‘æƒ³æ·±å…¥å­¦ k8sï¼Œä½†æ˜¯ k8s å†…éƒ¨ä½¿ç”¨äº† etcd/corednsï¼Œä»¥åŠç›‘æŽ§è¿™å—ä½¿ç”¨ prometheusï¼Œè¿™äº›æŠ€æœ¯æ˜¯ä¸æ˜¯å…ˆæ·±å…¥å­¦ä¹ ä¸‹ï¼Œå†åŽ»æ·±å…¥å­¦ä¹  k8s å‘¢ï¼Œæ¯•ç«Ÿ k8s å¤ªå¤§äº†ï¼Œä¸€ä¸Šæ¥å°±æ·±å…¥ä¼šå®¹æ˜“æ‰¾ä¸åˆ°é—¨è·¯ï¼Œè¿™å—å¤§å¤§æœ‰å•¥ç»éªŒæ²¡ï¼Ÿ

A9ï¼šå»ºè®®ä»Ž K8s æ ¸å¿ƒå¼€å§‹å­¦ä¹ ï¼Œå†å­¦ä¹ å‘¨è¾¹ç»„ä»¶ã€‚ä»Žä¸­å¿ƒåˆ°å¤–å›´çš„é¡ºåºã€‚æŽ¨èå­¦ä¹ ä¸‹ CNCF å’Œé˜¿é‡Œäº‘è”åˆåšçš„è¿™ä¸ªå…è´¹å…¬å¼€è¯¾ï¼š[roadmap/cloudnative](https://edu.aliyun.com/roadmap/cloudnative)

> Qï¼šè‹¥ k8s é›†ç¾¤æœåŠ¡å™¨å®•æœºï¼Œè¯·é—®å¦‚ä½•å¿«é€Ÿæ¢å¤é›†ç¾¤èƒ½åŠ›ï¼ˆé™¤æ‹‰èµ· kubelet ç­‰å¾…å…¶ä»–ç»„ä»¶è‡ªåŠ¨æ‹‰èµ·ï¼Œæ˜¯å¦è¿˜æœ‰å…¶ä»–æ–¹å¼)ï¼Ÿ

A10ï¼šé…ç½® 3master é«˜å¯ç”¨å¯é™ä½Žå®•æœºå¸¦æ¥çš„æŸå¤±ï¼Œå¦å¤–å¤‡ä»½ç»„ä»¶çš„é…ç½®æ–‡ä»¶ã€‚

> Qï¼šMaster èŠ‚ç‚¹å¦‚æžœåŒæ—¶ä½œä¸º node èŠ‚ç‚¹ï¼Œè¯·é—®å­˜åœ¨å“ªäº›é£Žé™©ï¼Ÿ

A11ï¼šmaster èŠ‚ç‚¹ä¸å®œä½œä¸º node èŠ‚ç‚¹éƒ¨ç½²åº”ç”¨ï¼Œä¼šå¯¼è‡´é›†ç¾¤ä¸ç¨³å®šã€‚

> Qï¼š æ‚¨å¥½ï¼çŽ°åœ¨ä½¿ç”¨äº† jenkins pipeline åšä¸º ci å·¥å…·ï¼Œcd1: helm chart å¯¹æ¯ä¸ªåº”ç”¨ç¼–å†™å¯¹åº”çš„ chartï¼Œé€šè¿‡ questions.yaml åœ¨ rancher å®šåˆ¶åŒ–æŽ¥å£. cd2: é€šè¿‡ argocd å’Œ helm chart å½¢æˆçš„ git ops  ,è¯·é—®æœ‰æ²¡æœ‰æ›´å¥½çš„å·¥å…·æŽ¨èï¼Ÿ æƒ³è§£å†³æ‰¹é‡å‡çº§ï¼ŒçŽ°åœ¨æ¯æ¬¡å‡çº§éƒ½éœ€è¦äººå·¥å¹²é¢„.

A12:

---

### 2019-11-07ï¼šk3s åœ¨è¾¹ç¼˜è®¡ç®—ä¸­çš„åº”ç”¨å®žè·µ

[æé—®é“¾æŽ¥](https://shimo.im/docs/x3WjRWHhdJVPkdQG)

> Qï¼šä¸€å°é˜¿é‡Œäº‘æ­å·žæœåŠ¡å™¨ï¼Œä¸€å°é˜¿é‡Œäº‘ç¾Žå›½æœåŠ¡å™¨ï¼Œéƒ½æœ‰å…¬ç½‘ IPï¼Œå¦‚ä½•æ–¹ä¾¿ï¼Œå¿«æ·çš„ï¼ˆå¹¶ä¸”ä¸è´­ä¹°ç½‘ç»œå¸¦å®½è´¹ç”¨)çš„æ­å»ºä¸€ä¸ª 2 å°æœåŠ¡å™¨çš„ K3S é›†ç¾¤ï¼Ÿ

Aï¼šä½ è¿™ä¸ªé—®é¢˜çš„è¯ä¸»è¦å°±æ˜¯ä½ çš„è¿™ä¸ªè·¯ç”±çš„é—®é¢˜ï¼Œpod ç½‘ç»œå’Œ service ç½‘ç»œçš„ä¸€ä¸ªæ‹‰å¹³çš„é—®é¢˜ï¼Œæ¶‰åŠåˆ°è¿™ä¸ªè·¯ç”±çš„è·³è½¬éœ€è¦ä½ è‡ªå·±åŽ»åŽ»é…ç½®çš„ã€‚

> Qï¼šè¾¹ç¼˜èŠ‚ç‚¹çš„ K3S é›†ç¾¤å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¢«ä¸­å¿ƒèŠ‚ç‚¹çš„ K8S é›†ç¾¤æ¥ç®¡ç†å—ï¼Ÿå¦‚ä½• ç®¡ç†ï¼Ÿæ•°æ®å¦‚ä½•åŒæ­¥ï¼Ÿä¸­å¿ƒèŠ‚ç‚¹éœ€è¦å­˜æ”¾è¾¹ç¼˜èŠ‚ç‚¹çš„æ•°æ®å—ï¼Ÿè¾¹ç¼˜èŠ‚ç‚¹æŒ‚äº†ä¹‹åŽä¸­å¿ƒèŠ‚ç‚¹èƒ½æ‹‰èµ·æˆ–ç®¡ç†å—ï¼ŸçŽ°åœ¨æˆ‘ä»¬ä¹Ÿè®¡åˆ’åšè¿™æ”¾é¢çš„å·¥ä½œã€‚æˆ‘ä»¬æœ‰å¤šä¸ªåˆ†å…¬å¸ï¼Ÿæƒ³åœ¨åˆ†å…¬å¸éƒ¨ç½²é›†ç¾¤ï¼Œä½†æ²¡æœ‰ç»´æŠ¤äººå‘˜ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼ŒçŽ°åœ¨é›†ç¾¤ è”é‚¦ä¸æˆç†Ÿï¼Œä¹Ÿä¸èƒ½å¾ˆå¥½çº³ç®¡å¤šä¸ªé›†ç¾¤åšèµ„æºè°ƒåº¦ï¼Ÿ

Aï¼šè¿™ä¸ª k3s é›†ç¾¤å’Œ k8s é›†ç¾¤ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¹³çº§çš„å…³ç³»ã€‚ä»–å±žäºŽå¤šä¸ªé›†ç¾¤å¦‚æžœè¦ç®¡ç†å¤šä¸ªé›†ç¾¤æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å‘ rancher è¿™æ ·çš„é›†ç¾¤ç®¡ç†å¹³å°åŽ»ç®¡ç†å®ƒï¼Œæˆ‘ä»¬çŽ°åœ¨å°±æ˜¯è¿™ä¹ˆåšçš„åœ¨é˜¿é‡Œäº‘ä¸Šæœ‰ä¸€ä¸ª rancher çš„å¹³å°ï¼Œç„¶åŽç®¡ç€æˆ‘ä»¬åœ¨é˜¿é‡Œäº‘å¹³å°çš„ä¸šåŠ¡é›†ç¾¤å’Œæˆ‘ä»¬çš„å¤šä¸ªè¾¹ç¼˜é›†ç¾¤ã€‚ç„¶åŽä½ çš„ç¬¬äºŒä¸ªé—®é¢˜å°±æ˜¯ä¸­å¿ƒèŠ‚ç‚¹ä¼šå­˜å‚¨æˆ‘æ•´ä¸ªé›†ç¾¤çš„æ‰€æœ‰çš„æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥å‘¨æœŸæ€§çš„å¯¹è¿™ä¸ªä¸­å¿ƒèŠ‚ç‚¹çš„è¿™ä¸ªæ•°æ®è¿›è¡Œä¸€ä¸ªå¤‡ä»½ï¼Œè€Œä¸”åœ¨æœªæ¥çš„ç‰ˆæœ¬å½“ä¸­ï¼Œk3s ä¼šæ”¯æŒ HAï¼Œå®ƒæ˜¯ï¼Œå®ƒæ˜¯é€šè¿‡å®žçŽ°åŽç«¯å­˜å‚¨ï¼Œå¦‚ postgresqlã€MySQL çš„ä¸€ä¸ªé«˜å¯ç”¨æ€§ä¿è¯æˆ‘ä»¬çš„é›†ç¾¤çš„å¯é æ€§çš„ï¼Œè¿™ä¸ªçŽ°åœ¨å·²ç»æ˜¯å®žéªŒçš„ç‰¹æ€§äº†ï¼Œä¼°è®¡åœ¨æœªæ¥å¾ˆå¿«å°±ä¼šå‘å¸ƒäº†ã€‚å·¥ä½œèŠ‚ç‚¹æŒ‚äº†çš„è¯åˆ†ä¸¤ç§æƒ…å†µå§ä¸€ç§æ˜¯ä½ è¿™ä¸ªèŠ‚ç‚¹ç›´æŽ¥å°±ä¸èƒ½å·¥ä½œäº†ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µç‚¹è·Ÿæˆ‘çš„æŒ‡ç”²æƒ³ä¸é€šå•Šï¼Œé‚£ä¹ˆå‰ä¸€ç§æƒ…å†µçš„è¯è‚¯å®šæ˜¯æˆ‘çš„ä¸šåŠ¡ä¹Ÿä¸èƒ½æ­£å¸¸å·¥ä½œäº†ï¼ŒåŽä¸€ç§æƒ…å†µçš„è¯ï¼Œå…¶å®žæˆ‘çš„ä¸šåŠ¡è¿˜æ˜¯åœ¨æ­£å¸¸è¿è¡Œçš„ï¼Œåªä¸è¿‡æ˜¯ä¸èƒ½é€šè¿‡æˆ‘çš„ä¸»èŠ‚ç‚¹åŽ»è°ƒåº¦äº†ï¼Œä½†æ˜¯ä¸€æ—¦å®ƒæ¢å¤è¿™ä¸ªé€šä¿¡çš„è¯ï¼Œæ‰€æœ‰çš„éƒ½ä¼šè‡ªåŠ¨æ¢å¤ï¼Œå› ä¸ºè¿™ä¸ªè¾¹ç¼˜çš„è¿™ä¸ªè®¾å¤‡çš„ä»–æœ‰ä¸ªç‰¹ç‚¹å°±æ˜¯ç½‘ç»œä¸ç¨³å®šï¼Œè¿˜æœ‰ï¼Œè¿˜æœ‰å°±æ˜¯ç»å¸¸ä¼šæŽ‰ä»¶è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬è¿™ä¸ªé›†ç¾¤å·²ç»åœ¨è·‘äº†æœ‰ä¸¤ä¸‰ä¸ªæœˆäº†ï¼Œè¡¨çŽ°ä¸€ç›´æ˜¯å¾ˆå¥½çš„ã€‚

> Qï¼šk3s åŽ»å“ªèŽ·å– èµ„æ–™äº†ï¼Ÿ

Aï¼šk3s ç›¸å…³çš„æ–‡æ¡£æˆ‘ä»¬å¯ä»¥åœ¨ rancher çš„å®˜æ–¹ç½‘ç«™ä¸ŠèŽ·å–çš„ã€‚ä¹Ÿå¯ä»¥åˆ°å®ƒçš„ github ä¸»é¡µä¸Šé¢åŽ»èŽ·å–ç›¸å…³çš„ææ–™ã€‚
è¡¥å……ï¼šè¿™é¢˜æˆ‘ä¼šï¼k3s çš„å®˜ç½‘æ˜¯ï¼š[k3s.io](https://k3s.io)ï¼ŒGitHub çš„ä¸»é¡µæ˜¯ï¼š[k3s](https://github.com/rancher/k3s)ï¼Œæœ€æ–°å¼€å§‹è¿è¥çš„å®˜æ–¹å¾®ä¿¡å…¬ä¼—å· ID æ˜¯ï¼šDockerlab

> Qï¼šK3s çš„ list-watch è¯·æ±‚æ²¡æœ‰èµ° tunel-proxy å—ï¼Ÿ

Aï¼šk3s çš„ä¸»èŠ‚ç‚¹å’Œ agent èŠ‚ç‚¹ä¹‹é—´é€šä¿¡éƒ½æ˜¯èµ°çš„ tunnel é€šé“çš„ã€‚

> Qï¼šè¾¹ç¼˜ç½‘ç»œä¸ç¨³å®šçš„åœºæ™¯ï¼Œlist-watch è¯·æ±‚ä¼šæœ‰é—®é¢˜å—ï¼ŸK3s æœ‰é’ˆå¯¹è¾¹ç¼˜ç½‘ç»œä¸ç¨³å®šåœºæ™¯åšä¼˜åŒ–ä¸ï¼Ÿ

Aï¼šè¿™ä¸ªåœºæ™¯å…¶å®žå°±æ˜¯ kubelet è·Ÿæˆ‘çš„ä¸»èŠ‚ç‚¹å¤±è”ï¼Œä¸€æ—¦è¿™ä¸ªé€šä¿¡æ¢å¤çš„è¯ï¼Œä¸»èŠ‚ç‚¹ä»–ä¼šç›´æŽ¥æŠŠçŠ¶æ€é‡æ–°ä¼ åˆ°è¿™ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸ŠåŽ»ã€‚

> Qï¼šk3s åœ¨ä½¿ç”¨ä¸Šå’Œ k8s ç›¸æ¯”æœ‰ä»€ä¹ˆé™åˆ¶å’Œä¼˜åŠ¿ï¼Ÿç›®å‰æˆ‘ç†è§£æ¥çœ‹ä¸»è¦å°±æ˜¯å ç”¨è¾ƒå°‘èµ„æºã€‚

Aï¼šå¯¹ï¼Œå› ä¸ºè¾¹ç¼˜è®¾å¤‡çš„è¯éƒ½æ˜¯å¾ˆå°çš„å·¥ï¼Œä¸€èˆ¬éƒ½æ˜¯å…¬ç”¨çš„ï¼Œå·¥ä¸šç”¨çš„å·¥æŽ§æœºï¼Œå·¥æŽ§æœºä¸€èˆ¬éƒ½æ˜¯ä¸€ä¸ªä½ŽåŽ‹çš„ CPU å•Šï¼Œç„¶åŽè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯å†…å­˜æ¯”è¾ƒå°ã€‚å®žé™…ä¸Šæ¥è®²çš„è¯æˆ‘ç›®å‰æ²¡æœ‰å‘çŽ°æ ¹ k8s æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼ŒåŸºæœ¬ä¸Šåœ¨æˆ‘ k8s ä¸Šéƒ¨ç½²çš„åº”ç”¨å…¨éƒ¨å¯ä»¥éƒ¨ç½²åœ¨æˆ‘çš„è¾¹ç¼˜ç«¯ã€‚

> Qï¼šk3s çš„ä¸»èŠ‚ç‚¹å’Œ agent èŠ‚ç‚¹ä¹‹é—´é€šä¿¡éƒ½æ˜¯èµ°çš„ tunnel é€šé“çš„ã€‚ List-watch è¯·æ±‚ä¹Ÿèµ° tunnel é€šé“çš„å—ï¼Œæ®æˆ‘çœ‹æºç ï¼Œå¹¶æ²¡æœ‰èµ° tunnelï¼Œåªæœ‰ logs å’Œ exec æŽ¥å£èµ°äº† tunnelã€‚

Aï¼šè¿™é‡Œç›¸å…³çš„æºä»£ç æˆ‘æ²¡æœ‰æ·±å…¥åŽ»ç ”ç©¶è¿‡ï¼Œä¸‹æ¥æˆ‘è¯¦ç»†åŽ»äº†è§£ä¸‹ k3s è¿™é‡Œçš„æœºåˆ¶ã€‚
è¡¥å……ï¼šlist-watch å°±æ˜¯ç›´æŽ¥è®¿é—® kube-apiserver çš„ç«¯å£ã€‚

> Qï¼šk3s é›†ç¾¤ç›´æŽ¥æ›´æ”¹è®¾å¤‡ IP æ˜¯å¦å¯ç”¨ï¼Œå¦‚æžœä¸æ”¯æŒæ›´æ”¹ IPï¼Œå¯¹äºŽæ›´æ”¹ IP çš„éœ€æ±‚æœ‰ä»€ä¹ˆåº”å¯¹æ–¹æ¡ˆï¼Ÿ

Aï¼šè¿™é‡Œåˆ†ä¸¤ç§æƒ…å†µï¼Œåœ¨é›†ç¾¤éƒ¨ç½²å®ŒæˆåŽï¼Œå¦‚æžœè¦æ›´æ”¹ server èŠ‚ç‚¹çš„ IPï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦é‡æ–°åŽ»å°†æ‰€æœ‰çš„ agent èŠ‚ç‚¹é‡æ–°åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œå¦‚æžœæ›´æ”¹ agent çš„èŠ‚ç‚¹ IPï¼Œé‚£ä¹ˆå¯èƒ½å¯¼è‡´ agent èŠ‚ç‚¹å¯¹åº”å­˜å‚¨åœ¨ server èŠ‚ç‚¹ä¸­çš„èº«ä»½å‡­è¯å¤±æ•ˆï¼Œä¹Ÿå°±æ˜¯éœ€è¦ç§»é™¤å¤±æ•ˆçš„èŠ‚ç‚¹ï¼Œå°†ä¿®æ”¹åŽçš„èŠ‚ç‚¹é‡æ–°åŠ å…¥ï¼Œå½“ç„¶è¿™ç§æƒ…å†µæ˜¯åœ¨åŒä¸€ä¸ªå­ç½‘å†…çš„æƒ…å†µï¼Œå¦‚æžœè·¨ç½‘æ®µçš„è¯ï¼Œé‚£å°±ä¼šæ›´å¤æ‚ä¸€äº›äº†ã€‚

> Qï¼šRancher ç®¡ç† k3s é›†ç¾¤ï¼Œk3s çš„ master è¦æš´éœ²å…¬ç½‘ IP å—ï¼Ÿä¸»è®²äººçš„å¤šä¸ªè¾¹ç¼˜

Aï¼šserver èŠ‚ç‚¹ä¸éœ€è¦æš´éœ²å…¬ç½‘ IPï¼Œåªéœ€è¦èƒ½ä»Ž server èŠ‚ç‚¹å†…éƒ¨è®¿é—® rancher å³å¯ã€‚é€šè¿‡ import çš„å½¢å¼å°† k3s é›†ç¾¤å¯¼å…¥åˆ° Rancher ä¸­å³å¯ç®¡ç†èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ç®¡ç†åº”ç”¨å’Œé…ç½®ã€‚

> Qï¼šk3s server ä¹Ÿæ”¯æŒ docker å§

Aï¼šæ˜¯çš„ï¼Œagent èŠ‚ç‚¹æä¾›äº†--docker å‚æ•°ï¼Œå¯ä»¥æŒ‡å®šå®ƒçš„å®¹å™¨è¿è¡Œæ—¶ä¸º docker

> Qï¼šrancher å¯ä»¥è‡ªå·±éƒ¨ç½²ï¼Œç®¡ç†è‡ªå·±çš„ k3s?

Aï¼šæ˜¯çš„ï¼Œæˆ‘ä»¬çš„ rancher æ˜¯éƒ¨ç½²åœ¨é˜¿é‡Œäº‘ç«¯ï¼ŒåŒæ—¶ç®¡ç†äº†æˆ‘ä»¬çš„ä¸­æž¢ä¸šåŠ¡ k8s é›†ç¾¤å’Œå¤šä¸ªå®¢æˆ·çš„ k3s è¾¹ç¼˜é›†ç¾¤ã€‚

> Qï¼šæœ‰åœ¨ Android ä¸ŠæˆåŠŸè¿è¡Œçš„ç»éªŒæˆ–è€…æ¡ˆä¾‹ä¹ˆ

Aï¼šæˆ‘ä»¬æš‚æ—¶è¿˜æ²¡æœ‰æ¶‰åŠåˆ° arm çš„è®¾å¤‡ï¼Œä¹Ÿæ²¡æœ‰å¯ä¾›æµ‹è¯•çš„ arm è®¾å¤‡ï¼Œå› æ­¤æš‚æ—¶æ²¡æœ‰è¿™æ–¹é¢çš„å®žè·µã€‚

> Qï¼šè¿è¡Œå•ä¸ª Docker å®¹å™¨æ¥å®‰è£… Rancheï¼Ÿå¯ä»¥æ»¡è¶³ç®¡ç†å—ï¼Ÿ

Aï¼šå¯ä»¥ï¼Œä½†æ˜¯è¿™æ ·å¯é æ€§ä¼šä¸å¥½ï¼ŒæŽ¨èè¿˜æ˜¯å¤šå®žä¾‹é€šè¿‡è´Ÿè½½å‡è¡¡çš„å½¢å¼æ¥éƒ¨ç½²ã€‚

> Qï¼š k3s æ”¯æŒ master é«˜å¯ç”¨å—ï¼Ÿ

Aï¼šæš‚æ—¶è¿˜ä¸æ”¯æŒï¼Œä½†æ˜¯å·²ç»å‘å¸ƒäº†å®žéªŒç‰¹æ€§çš„ç‰ˆæœ¬ï¼Œé€šè¿‡å¯¹ k3s é›†ç¾¤æ•°æ®å­˜å‚¨çš„é«˜å¯ç”¨æ¥å®žçŽ°çš„ï¼Œæˆ‘ä»¬å¯ä»¥éƒ¨ç½²é«˜å¯ç”¨çš„ postgresql ä½œä¸º k3s é›†ç¾¤çš„ç®¡ç†èŠ‚ç‚¹çš„æ•°æ®å­˜å‚¨ã€‚è¿™ä¸ªç‰¹æ€§åº”è¯¥ä¸ä¹…å°±ä¼š GA äº†ã€‚

> Qï¼šè¾¹ç¼˜èµ„æºå……è¶³ï¼Œæ˜¯å¦å¯ä»¥ç›´æŽ¥ç”¨ k8s?

Aï¼šå¦‚æžœè¾¹ç¼˜è®¾å¤‡èµ„æºå……è¶³çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ k8s æ¥ç»´æŠ¤ï¼Œä½†æ˜¯éœ€è¦è€ƒè™‘çš„æ˜¯è¾¹ç¼˜è®¾å¤‡ç½‘ç»œçš„å¤æ‚æ€§å’Œä¸ç¨³å®šæ€§ã€‚

> Qï¼š K3s é’ˆå¯¹è¾¹ç¼˜è®¾å¤‡ç½‘ç»œçš„å¤æ‚æ€§å’Œä¸ç¨³å®šæ€§åšäº†å“ªäº›æ”¹è¿›

Aï¼šè­¬å¦‚åˆšåˆšæœ‰åŒå­¦æåˆ°çš„ list-watch é—®é¢˜ï¼Œk3s çš„æˆ‘æ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡ï¼Œä½†æ˜¯ä¹‹å‰åœ¨è°ƒç ” kubeedge çš„æ—¶å€™ï¼Œäº†è§£åˆ°å…¶å®žå°±æ˜¯åœ¨æ–­ç½‘çš„æƒ…å†µä¸‹ä»æ—§èƒ½å¤Ÿå®žçŽ°åŒºåŸŸå†…è‡ªæ²»ï¼Œä¿è¯ä¸šåŠ¡çš„ç¨³å®šå’ŒæŒç»­æ€§ã€‚

> Qï¼šé’ˆå¯¹ kubeedge å®žçŽ°çš„åŒºåŸŸå†…è‡ªæ²»ï¼ŒK3s å½“å‰æ²¡æœ‰å®žçŽ°çš„è¯ï¼Œå•†ç”¨æ˜¯å¦æœ‰é£Žé™©å‘¢ï¼Œåœ¨è¾¹ç¼˜ç½‘ç»œä¸ç¨³å®š

Aï¼šè¿™ä¸ªè¿˜æ˜¯è¿˜æ˜¯å¾—ä»Žé‚£ä¸ªè¾¹ç¼˜ç«¯çš„å¾—ä»Žé‚£ä¸ªè¾¹ç¼˜ç«¯çš„è¿™ä¸ªç‰¹ç‚¹æ¥è¯´ã€‚è¾¹ç¼˜ç«¯è®¾å¤‡æ¯”è¾ƒåˆ†æ•£ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„è´£ä»»å…¶å®žå¾ˆæœ‰é™ï¼Œå½“ç„¶è‚¯å®šæœ‰ä¸€äº›éžå¸¸é‡è¦çš„èŠ‚ç‚¹ï¼Œé‚£è¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥é‡‡å–ä¸€äº›é¢å¤–çš„æŽªæ–½æ¥ä¿è¯å¯é æ€§ï¼Œè­¬å¦‚ç›´æŽ¥ä»Žç¡¬ä»¶ä¸Šå†—ä½™æ¥ä¿è¯è¿™ä¸€ä¸ªåŒºåŸŸçš„ä¸šåŠ¡ä¸ä¸­æ–­ã€‚ä¸æ˜¯è¯´ k3s ä¸èƒ½å®žçŽ°åŒºåŸŸè‡ªæ²»ï¼Œè­¬å¦‚ worker èŠ‚ç‚¹åœ¨äºŽä¸»èŠ‚ç‚¹å¤±è”ä¸å—æŽ§äº†ä¹‹åŽï¼Œæˆ‘æ€Žä¹ˆç®¡ç†è¿™å°èŠ‚ç‚¹çš„åº”ç”¨ï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬å‘ç”Ÿæœ‰ä¸¤ç§æƒ…å½¢ï¼Œä¸€ç§æ˜¯æ–­ç½‘ï¼Œä¸€ç§æ˜¯æ–­ç”µï¼Œå½“ç„¶ï¼Œæ–­ç”µçš„æƒ…å½¢å°±ä¸è¯´äº†ï¼Œæ–­ç½‘çš„æƒ…å†µä¸‹ã€‚

> Qï¼šè¯·é—® k3s,k8s,kube,openflow,çŽ°åœ¨åè¯è¶Šæ¥è¶Šå¤šäº†,æœ‰æ²¡æœ‰åŠžæ³•åœ¨åŽ»åŒºåˆ«è¿™äº›åè¯æ˜¯å¤„åœ¨å“ªäº›çš„é˜¶æ®µï¼Œç”¨äºŽä»€ä¹ˆåŠŸèƒ½ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜çš„è¯ï¼Œé¦–å…ˆè¿˜æ˜¯æ ¹æ®é¡¹ç›®éœ€æ±‚æ¥åšå¯¹æ¯”è°ƒç ”å·¥ä½œï¼Œæ–°æŠ€æœ¯å±‚å‡ºä¸ç©·ï¼Œä¸éœ€è¦è¿½æ±‚æœ€æ–°çš„ï¼Œå½“ä¸‹æ¯”è¾ƒæµè¡Œçš„ä¸€å®šæ˜¯é€‚åº”æ€§æœ€å¥½çš„ï¼Œä¸€èˆ¬ç»è¿‡äº†ä¼—å¤šçš„éªŒè¯ã€‚

> Qï¼šk3s å¯åŠ¨ä¸ª helm çš„æ—¶å€™ï¼Œç”±äºŽä¼—æ‰€å‘¨çŸ¥çš„åŽŸå› ï¼Œç»å¸¸ä¸‹è½½ä¸åˆ°é•œåƒï¼Œæ€Žä¹ˆè§£å†³å‘¢ï¼Ÿ

Aï¼šå®˜æ–¹æä¾›äº†ç¦»çº¿é•œåƒåŒ…ï¼Œå¤§çº¦ 200MB ä¸åˆ°ï¼Œè¿™ä¸ªé•œåƒåŒ…åŒ…å«äº†æˆ‘ä»¬å¯åŠ¨ server å’Œ agent èŠ‚ç‚¹æ‰€éœ€çš„æ‰€æœ‰é•œåƒï¼Œèƒ½å¤Ÿä¿è¯é›†ç¾¤è‡ªèº«åŠŸèƒ½æ­£å¸¸ã€‚helm æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å›½å†…çš„ charts æºæ¥ä»£æ›¿ï¼Œä¾‹å¦‚ azure çš„æºã€‚

> Qï¼šcontainerd å¯ä»¥é…ç½® morror ä¹ˆï¼Ÿ

Aï¼šå¯ä»¥é…ç½®ï¼Œä½†æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œdocker æä¾›äº†æ¯”è¾ƒå¥½çš„äººé™…æŽ¥å£ï¼Œæ‰€ä»¥æŽ¨èä½¿ç”¨ dockerã€‚

> Qï¼šk3s å’Œ k8s æ­å»ºçš„å®¹å™¨ç³»ç»Ÿæ˜¯å¦å¯ä»¥æ— ç¼çš„ç›¸äº’åˆ‡æ¢ï¼Œå¦‚æžœä¸æ˜¯ï¼Œåº”è¯¥æ€Žä¹ˆåšé€‚é…æ‰èƒ½ç›¸äº’è½¬åŒ–ï¼Ÿ

Aï¼šæˆ‘ä¸å¤ªæ¸…æ¥šä½ è¿™ä¸ªæ— ç¼åˆ‡æ¢æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ˜¯ä¸šåŠ¡è¿ç§»è¿˜æ˜¯ï¼Ÿé¦–å…ˆè¿™ä¸ªéœ€æ±‚å¯èƒ½å¹¶ä¸å¸¸è§ï¼Œè€Œä¸”ä¸¤è€…é¢å‘çš„åœºæ™¯ä¸åŒã€‚

> Qï¼šå¤‡ä»½ k3s çš„é›†ç¾¤æ•°æ®ä¸ºä»€ä¹ˆæ˜¯å¤‡ä»½é‚£å‡ ä¸ªç›®å½•è€Œä¸æ˜¯å¤‡ä»½ sqlite çš„ db æ–‡ä»¶ï¼Ÿk3s çš„ server æ”¯æŒç±»ä¼¼ rke å¯¹ etcd å®šæœŸè‡ªåŠ¨å¤‡ä»½é…ç½®å—ï¼Ÿ

Aï¼šå› ä¸ºè¿˜æ¶‰åŠåˆ°ä¸€äº›è®¤è¯æ–‡ä»¶ï¼Œè­¬å¦‚ agent èŠ‚ç‚¹åœ¨ server ç«¯å­˜å‚¨æœ‰ä¸€ä¸ªèº«ä»½æ ‡è®°ï¼Œagent èŠ‚ç‚¹çš„æ¢å¤æ˜¯ä¼šåˆ¤æ–­è¿™äº›èº«ä»½çš„ã€‚ä¸€æ—¦ä¸¢å¤±ï¼Œé‡æ–°æ³¨å†Œç›¸å½“äºŽæ˜¯ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹äº†ã€‚

> Qï¼šè¯·æ•™è€å¸ˆï¼Œä¸ç®¡æ˜¯åŸºäºŽ containerd è¿˜æ˜¯ dockerï¼Œå®ƒä»¬éƒ½æ˜¯å…±äº«å†…æ ¸çš„ï¼Œé‚£ä¹ˆå¦‚ä½•åšåˆ°å®‰å…¨éš”ç¦»å‘¢ï¼Ÿ

Aï¼šåœ¨åº•å±‚çš„èµ„æºéš”ç¦»ä¸Šï¼Œè¿˜æ˜¯ä¾èµ–äºŽç³»ç»Ÿçš„å„ç§å‘½åç©ºé—´ï¼Œè¿™å—å»ºè®®å¯ä»¥è¯¦ç»†ç ”ç©¶ä¸€ä¸‹ pod çš„å®‰å…¨ç­–ç•¥ã€‚

> Qï¼šç¦»çº¿é•œåƒæ–‡ä»¶æ˜¯å¦åªè¦æ”¾åœ¨ images ç›®å½•å³å¯ï¼Œæ–‡ä»¶åå¹¶ä¸é‡è¦ï¼Œéƒ½å¯ä»¥è¢«è¯†åˆ«å‡ºæ¥ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œä½¿ç”¨ containerd ä½œä¸º runtime æ—¶ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¯¼å…¥ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ä»Žè¿™é‡ŒèŽ·å–é•œåƒï¼Œå¦‚æžœä½¿ç”¨ docker ä½œä¸ºè¿è¡Œæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨ load é•œåƒï¼Œå› ä¸ºå›½å†…ç›´æŽ¥è®¿é—®ä¸äº† gcr.io ä¸‹é¢çš„é•œåƒã€‚

> Qï¼šè¯·é—®ä¸€ä¸ªé—®é¢˜ï¼Œå•æœºç‰ˆ K3Sï¼Œå®¹å™¨å†…è®¿é—®æœ¬æœºçš„ä¸€ä¸ªæœåŠ¡ç«¯å£ï¼Œæ— æ³•è®¿é—®ï¼Œè¿™ä¸ªé—®é¢˜å®˜æ–¹æµ‹è¯•è¿‡å—ï¼Ÿ

Aï¼šè¿™ä¸ªå¯èƒ½æœ‰å¾ˆå¤šç§æƒ…å½¢äº†ï¼Œçœ‹æ˜¯å¦æ˜¯ä¸»æœºå®‰å…¨ç­–ç•¥é™åˆ¶ã€‚ä¾‹å¦‚ selinux æˆ–è€… iptables è§„åˆ™é™åˆ¶äº†ã€‚

> Qï¼šcentos åœ¨è¾¹ç¼˜è®¾å¤‡å°å†…å­˜è®¾å¤‡ä¸Šèƒ½è£…å—ï¼Ÿä¹Ÿæ˜¯æœ‰å†…å­˜é™åˆ¶çš„å§ï¼Œæœ€å°æ”¯æŒå¤šå°‘ï¼Ÿ

Aï¼šk3s server å®˜æ–¹ç»™çš„éœ€æ±‚æ˜¯ 512MB å°±èƒ½æ»¡è¶³ï¼Œä½†æ˜¯å®žé™…çš„è§‚å¯Ÿä¸­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç”¨åˆ° 200 å¤š MBï¼Œå‰©ä¸‹çš„å°±çœ‹ä½ éƒ¨ç½²çš„åº”ç”¨çš„èµ„æºéœ€æ±‚äº†ã€‚å¦å¤–æˆ‘ä»¬éœ€è¦ä¿è¯åº”ç”¨ä¸èƒ½æŠŠç³»ç»Ÿèµ„æºå…¨éƒ¨æŠ¢å äº†ã€‚

> Qï¼šk8 ä¸Ž k3 åœ¨ api ä¸Šä½¿ç”¨ä¸Šæœ‰å•¥å…·ä½“å·®åˆ«æ¯”å¦‚æ˜¯å¦æ”¯æŒ crd?å¦å¤– k8 çš„ç½‘ç»œç»„ç½‘æ–¹æ¡ˆæœ‰ flannel å’Œ calicoï¼Œk3 æ˜¯æ€Žä¹ˆç»„ç½‘çš„?

Aï¼šK3s é»˜è®¤ä½¿ç”¨çš„æ˜¯ flannel ç½‘ç»œã€‚
è¡¥å……ï¼šk3s ä¹Ÿæ”¯æŒæ‰‹åŠ¨æŒ‡å®šå…¶ä»–çš„ CNIï¼Œéƒ½æ˜¯æ¯”è¾ƒçµæ´»çš„é…ç½®ã€‚

> Qï¼šk3s å¯ä»¥ç”¨æ¥éƒ¨ç½²å®‰å…¨ç½‘å…³ä¹ˆï¼Ÿ

Aï¼šæš‚æ—¶æ²¡æœ‰è¿›è¡Œè¿‡ç›¸å…³çš„å®žè·µã€‚

> Qï¼šiot client è®¾å¤‡æ²¡æœ‰å›ºå®šå…¬ç½‘ ip ä¸‹å¦‚ä½•è¿›è¡Œéƒ¨ç½²ï¼Ÿéœ€è¦è‡ªè¡Œç»„ç½‘å—ï¼Ÿ

Aï¼šè¿™é‡Œæ˜¯ä¸€ä¸ªå¤§å®¶éƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒIOT è®¾å¤‡éƒ½æ˜¯å®¢æˆ·å†…ç½‘çš„ï¼Œä¸å¯èƒ½ç»™ä½ åœ¨é˜²ç«å¢™ä¸Šæ‰“æ´žï¼Œæˆ‘ä»¬çŽ°åœ¨æ˜¯è‡ªå·±å¼€å‘äº†ä¸€å¥—ç³»ç»Ÿï¼Œåªç”¨æ¥å¶å°”ç»´æŠ¤è¾¹ç¼˜è®¾å¤‡çš„åŽå°ï¼Œç±»ä¼¼ ssh åå‘ä»£ç†å°±å¯ä»¥å®žçŽ°ã€‚

> Qï¼šå®¹å™¨è¿è¡Œæ—¶çš„æŸ¥çœ‹çš„èµ„æºæ€Žä¹ˆè·Ÿå®¿ä¸»æŠ€åšåŒºåˆ†ï¼Œæ¯”å¦‚æˆ‘åœ¨è¿è¡Œçš„å®¹å™¨é‡Œé¢ï¼Œfree -h çœ‹åˆ°çš„æ˜¯å®¿ä¸»æŠ€çš„ï¼Œæ€Žä¹ˆåšé¥­åªèƒ½çœ‹åˆ°å®¹å™¨æœ¬èº«çš„å‘¢ï¼Ÿ

Aï¼šæ˜¯å¦å¯¹å®¹å™¨åšäº†èµ„æºé™åˆ¶ã€‚

> Qï¼šè¾¹ç¼˜è®¾å¤‡æ˜¯æ€Žä¹ˆè¢«ç›‘æŽ§çš„ï¼Œæœ‰çš„ä»€ä¹ˆæ–¹æ¡ˆå‘¢ï¼Ÿæ˜¯å¦ä¹Ÿæœ‰ç›‘æŽ§çš„å®žæ—¶ç•Œé¢ï¼Ÿï¼Ÿ

Aï¼šæˆ‘ä»¬å¯ä»¥è€ƒè™‘é‡‡å– prometheus pushgateway çš„å½¢å¼æ¥åœ¨è¾¹ç¼˜å†…ç½‘éƒ¨ç½²ç›‘æŽ§ä»£ç†ï¼Œç„¶åŽå†ä»‹å…¥åˆ°ç»Ÿä¸€çš„ç›‘æŽ§å¹³å°ã€‚

> Qï¼šå†…ç½‘çŽ¯å¢ƒ(å¯é€šè¿‡ä»£ç†ä¸Šç½‘)ï¼Œéœ€è¦ä¸º containerd é…åˆ¶ä»£ç†å—ï¼Ÿè¿˜æ˜¯ containerd å¯ä»¥è¯†åˆ«ä¸»æœºçš„ä»£ç†é…åˆ¶ï¼Ÿå¦‚æžœéœ€è¦é…åˆ¶çš„è¯åº”è¯¥å¦‚ä½•é…åˆ¶ï¼Ÿ

Aï¼šå¦‚æžœæ˜¯å…¨å±€ä»£ç†çš„è¯ï¼Œåº”è¯¥æ˜¯æ”¯æŒçš„ã€‚

> Qï¼šk3s è·Ÿ k8s çš„è¿­ä»£å…³ç³»æ˜¯ä»€ä¹ˆï¼Œæ¯å‘å¸ƒæ–°ç‰ˆ k8sï¼Œk3s éƒ½è¦ä¿®å‰ªå‡ºç›¸åº”çš„ç‰ˆæœ¬ï¼Œè¿˜æ˜¯å¢žé‡å¼€å‘ï¼Ÿç”¨ k3s éœ€ä¸éœ€è¦å®šæœŸå‡çº§ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¸€ç›´åœ¨æŒç»­å…³æ³¨ç›¸å…³ release notesï¼Œå½“æœ‰é‡å¤§æ–°ç‰¹æ€§å’Œå®‰å…¨é—®é¢˜ã€åŠŸèƒ½ Bug ä¿®å¤æ—¶æˆ‘ä»¬ä¼šè€ƒè™‘å‡çº§ç‰ˆæœ¬ã€‚

> Qï¼šKubeedge æä¾›çš„è®¾å¤‡ç®¡ç†èƒ½åŠ›ï¼ŒK3s æ˜¯å¦æœ‰ç›¸åº”çš„è®¡åˆ’ï¼Ÿ

Aï¼šå·²ç»æœ‰äº†ç›¸åº”çš„è®¡åˆ’ï¼Œæ˜Žå¹´ä¼šåœ¨ k3s çš„è¾…åŠ©äº§å“ä¸­ä½“çŽ°ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä¼šæ›´ä¸“æ³¨æ ¸å¿ƒå¼•æ“Ž k3s çš„è¿­ä»£ã€‚

> Qï¼šDind ä¸­åˆ›å»ºå‡ºæ¥çš„å®¹å™¨ MTU ä¸æ­£å¸¸ï¼Œä»€ä¹ˆåŽŸå› å¯¼è‡´çš„ï¼Ÿ

Aï¼šDind ä¸æ˜¯æœ¬æ¬¡åˆ†äº«çš„è®¨è®ºèŒƒç•´ã€‚dind å†…éƒ¨çš„ docker ä¹Ÿæ˜¯å¯ä»¥æŒ‡å®š mtu çš„ï¼Œéƒ½æ˜¯çµæ´»çš„é…ç½®ã€‚

> Qï¼šè¯·é—®ä¸€ä¸ªé—®é¢˜ï¼Œå•æœºç‰ˆ K3Sï¼Œå®¹å™¨å†…è®¿é—®æœ¬æœºçš„ä¸€ä¸ªæœåŠ¡ç«¯å£ï¼Œæ— æ³•è®¿é—®ã€‚è¿™ä¸ªç«¯å£æ˜¯æˆ‘æœåŠ¡å™¨ä¸Šä¸€ä¸ªåŠ å¯†ç‹—ç«¯å£ï¼Œç¨‹åºéœ€è¦ä»Žå®¹å™¨ä¸­è°ƒç”¨è¿™ä¸ªåŠ å¯†ç‹—ã€‚è¡¥å……ä¸€ä¸‹ï¼Œæˆ‘åŠ å¯†ç‹—è°ƒç”¨åŒ…å« tcp å’Œ UDP

Aï¼šæ²¡æœ‰åœ¨ç¤¾åŒºä¸­æ”¶åˆ°è¿‡ç±»ä¼¼åé¦ˆï¼Œè¿™é‡Œä¸é€‚åˆè®¨è®ºè¿™ç§å¾ˆç»†èŠ‚æŠ€æœ¯çš„é—®é¢˜ï¼Œå»ºè®®æ‚¨æä¸€ä¸ª issue åˆ° [k3s](https://github.com/rancher/k3s)ï¼Œæˆ‘ä»¬åœ¨ comment ä¸­è®¨è®ºã€‚

> Qï¼šæˆ‘å°è¯•ç»™ containerd é…äº†ä»£ç†ï¼Œå•ç‹¬å®‰è£…çš„ containerd å¯ä»¥æ‹‰é•œåƒï¼Œä½†æ˜¯ k3s å†…åµŒçš„ containerd ç¡®ä¸€ç›´æ²¡æ³•æ‹‰é•œåƒã€‚è¿™ä¸ªéœ€è¦æ€Žä¹ˆè§£å†³

Aï¼šä¸ç¡®å®šä½ åœ¨ k3s çš„ containerd ä¸­å¦‚ä½•é…ç½®çš„ï¼Œk3s çš„ containerd ä¸­çš„é…ç½®æ–‡ä»¶ä¼šè¢«é‡ç½®ï¼Œä½ éœ€è¦ä»¥æ¨¡ç‰ˆæ–¹å¼é…ç½® [containerd-and-docker](https://rancher.com/docs/k3s/latest/en/configuration/#containerd-and-docker)ã€‚è¯¦ç»†é—®é¢˜å¯ä»¥æ issue åˆ° k3s æ¥è®¨è®ºã€‚

> Qï¼šcentos åœ¨è¾¹ç¼˜è®¾å¤‡å°å†…å­˜è®¾å¤‡ä¸Šèƒ½è£…å—ï¼Ÿä¹Ÿæ˜¯æœ‰å†…å­˜é™åˆ¶çš„å§ï¼Œæœ€å°æ”¯æŒå¤šå°‘ï¼Ÿ

Aï¼šå®˜æ–¹ç»™å‡ºçš„å†…å­˜éœ€æ±‚æ˜¯ 512MBï¼Œæ®æˆ‘è§‚å¯Ÿï¼Œåœ¨æ²¡æœ‰éƒ¨ç½²å¾ˆå¤šåº”ç”¨çš„æƒ…å†µä¸‹ï¼Œå†…å­˜å ç”¨ä¸€èˆ¬åœ¨ 200 å¤š MBï¼Œå ç”¨çš„å†…å­˜ä¼šéšç€éƒ¨ç½²çš„åº”ç”¨å¢žåŠ è€Œå¢žåŠ ï¼Œä½†æ˜¯ä¸€èˆ¬è¾¹ç¼˜ç”¨çš„å·¥æŽ§æœºå†…å­˜æœ€å¤§ä¸€èˆ¬ 8GBï¼Œè€Œä¸”è¾¹ç¼˜ä¸å®œè¿‡é‡ã€‚

> Qï¼š è¾¹ç¼˜è®¾å¤‡ä¸Šåš k3s ï¼Œå²‚ä¸æ˜¯å¢žåŠ è¿ç»´äººå‘˜å·¥ä½œé‡å—ï¼Ÿæœ¬æ¥æ˜¯ä¸ªç®€å•åº”ç”¨ï¼Œå˜æˆç³»ç»Ÿäº†ï¼

Aï¼šå› ä¸ºè¾¹ç¼˜è®¾å¤‡åˆ†æ•£ã€ç½‘ç»œæƒ…å†µä¸å¥½ï¼Œè¦ç»Ÿä¸€ç®¡ç†å’Œè¿ç»´çš„è¯ï¼Œæ˜¯æœ‰éš¾åº¦çš„ï¼ŒåŽæœŸçš„åº”ç”¨ç»´æŠ¤æ›´æ–°ã€é…ç½®å˜æ›´ã€å‡çº§ç­‰ç­‰éƒ½æ˜¯éœ€è¦è€ƒè™‘çš„ã€‚å¦‚æžœé‡‡ç”¨ä¼ ç»Ÿçš„éƒ¨ç½²å½¢å¼ï¼Œè™½ç„¶å¯ä»¥é‡‡ç”¨ç±»ä¼¼ Ansible è¿™æ ·çš„è‡ªåŠ¨åŒ–å·¥å…·æ¥åšï¼Œä½†æ˜¯è¦è€ƒè™‘åˆ°ç½‘ç»œä¸ç¨³å®šï¼Œéƒ¨åˆ†è®¾å¤‡ç¦»çº¿æƒ…å½¢çš„è¿ç»´å·¥ä½œã€‚æ‰€ä»¥é‡‡ç”¨ç±»ä¼¼ k3s è¿™æ ·çš„ç»Ÿä¸€ç®¡ç†å¹³å°æ˜¯æ¯”è¾ƒå¥½çš„æ–¹æ¡ˆï¼Œåœ¨å®žè·µè¿‡ç¨‹ä¸­å‘çŽ°ï¼Œå·¥ä½œé‡ä¸‹é™äº†å¾ˆå¤šã€‚å¦‚æžœä¸ä½¿ç”¨ï¼Œä½ éœ€è¦è‡ªå·±åŽ» watch ä½ çš„åº”ç”¨çš„è¿è¡Œæƒ…å†µã€‚è‡ªå·±åŽ»åšç±»ä¼¼ supervisord è¿™æ ·çš„å®ˆæŠ¤ç­‰ç­‰ã€‚

> Qï¼š è¾¹ç¼˜è®¾å¤‡åŠåº”ç”¨ï¼Œç›‘æŽ§ç”¨çš„æ˜¯ä»€ä¹ˆæ–¹æ¡ˆ

Aï¼šé‡‡ç”¨åœ¨èŠ‚ç‚¹ä¸Šéƒ¨ç½² prometheus exporter, ç„¶åŽå†éƒ¨ç½²ä¸€ä¸ª pushgateway æ¥åšã€‚

> Qï¼š æœ€å¤§æ”¯æŒå¤šå°‘ä¸ª agentï¼Œä¸€ä¸ª server å¸¦å¤šå°‘ agent

Aï¼šè¿™ä¸ªæ²¡æœ‰çœŸæ­£çš„åŽ»éªŒè¯è¿‡ï¼Œä¸è¿‡æˆ‘ä»¬ç›®å‰çš„é›†ç¾¤çŠ¶æ€å·²ç»è¾¾åˆ° 100+ï¼ˆ1 server,å‰©ä½™çš„å…¨æ˜¯ agent)ï¼Œ

> Qï¼š k3s å’Œ k8s å…·ä½“æœ‰å¤šå¤§çš„å·®åˆ«ï¼Œæœ‰å®žä¾‹å— ï¼Ÿæˆ–è€…æ•°æ®å¯¹æ¯”ã€‚

Aï¼šåœ¨å®žé™…çš„åº”ç”¨éƒ¨ç½²ä¸­ï¼Œå‡ ä¹Žæ²¡æœ‰ä»»ä½•å·®å¼‚ï¼Œè‡³å°‘åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘æ‰€é‡åˆ°çš„åœºæ™¯,k8s èƒ½æ»¡è¶³çš„ï¼Œk3s ä¹Ÿèƒ½æ»¡è¶³ï¼Œç›¸ä¿¡ï¼Œé€šè¿‡ä¸æ–­çš„è¿­ä»£ï¼Œk3s åœ¨æœªæ¥ä¼šæ›´å®Œå–„è¾¹ç¼˜åœºæ™¯ã€‚

`æ¥è‡ª 18ç¾¤ çš„æ— ç—• 2019-11-07 22:38:44ï¼Œç¡è§‰äº†æ‹œæ‹œï¼`

---

### 2019-10-31ï¼šJenkins Xï¼šåŸºäºŽ Kubernetes çš„ Serverless Jenkins

[æé—®é“¾æŽ¥](https://shimo.im/docs/rXvrqchvXx63QtVy)

> Qï¼šè¿™æ˜¯å¹²å˜›çš„

Aï¼šåœ¨åˆ†äº«æœ‰å…³ Kubernetes ä¹‹ä¸Šçš„ DevOps äº§å“ Jenkins Xï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥äº†è§£ä¸€ä¸‹ã€‚å¯ä»¥åŠ é€Ÿè½¯ä»¶çš„äº¤ä»˜é€Ÿåº¦ä¸Žå¯é æ€§ã€‚

> Qï¼šæœ‰å®žé™…åº”ç”¨æ¡ˆä¾‹å—ï¼Ÿè‡ªå·±æ€Žä¹ˆå¿«é€Ÿä½“éªŒ JenkinsX çš„ç‰¹æ€§ï¼Ÿ

Aï¼šçŽ°åœ¨å›½å†…çš„åº”ç”¨æ¡ˆä¾‹ç›¸å¯¹è¾ƒå°‘ï¼Œæ˜¯å±žäºŽä¸‹ä¸€ä»£çš„ CI/CD äº§å“ï¼Œåœ¨å›½å¤–çš„ç”¨æˆ·ä¼šæ›´å¤šä¸€äº›ã€‚jenkins x æ”¯æŒä¸€é”®åœ¨å¤§åž‹äº‘åŽ‚å•†/çŽ°æœ‰ kubernetes é›†ç¾¤ä¸Šè¿›è¡Œéƒ¨ç½²ï¼Œå¯ä»¥å‚è€ƒå®˜ç½‘æ–‡æ¡£å®‰è£…ä¸€ä¸‹ã€‚

> Qï¼šå’Œ gitlab ci ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿

Aï¼š å’Œ gitlab ci ç›¸æ¯”çš„ä¼˜åŠ¿å¯ä»¥å‚è€ƒä¸‹ jenkins ä¸Ž jenkins x çš„å¯¹æ¯”ã€‚åœ¨ç”¨æˆ·è§’åº¦æ¥è¯´ï¼Œä»¥åº”ç”¨ä¸ºè§†è§’ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ï¼Œä¹Ÿæ–¹ä¾¿åˆ©ç”¨ç¤¾åŒºèµ„æºã€‚ä»Žæž¶æž„å’Œå¯ç»´æŠ¤æ€§æ¥è¯´ï¼ŒJenkins X çš„æž¶æž„ä¼šç›¸å¯¹æ›´åŠ å…ˆè¿›ï¼ˆä¸Žè¯žç”Ÿå¹´ä»£æœ‰ç›´æŽ¥å…³ç³»)ã€‚

> Qï¼šprow çŽ°åœ¨æ”¯æŒ gitlab äº†å—ï¼ŸçŽ°åœ¨å¤§å¤šæ•°ä¼ä¸šçš„ä»£ç ä»“åº“å…¶å®žæ›´å¤šä½¿ç”¨ gitlabã€‚

Aï¼šprow ç›®å‰è¿˜æ²¡æœ‰æ”¯æŒ gitlabï¼Œè¿™ä¹Ÿæ˜¯ jenkins x ç›®å‰æœ€å¤§çš„ä¸€ä¸ªé—®é¢˜ï¼Œæ®æˆ‘æ‰€çŸ¥ç›®å‰ jenkins x é¡¹ç›®ç»„åœ¨ä¸»è¦è§£å†³è¿™éƒ¨åˆ†é—®é¢˜ï¼ŒçŽ°åœ¨åœ¨ jenkins x å½“ä¸­å¼€å‘æœ€æ´»è·ƒçš„æ¨¡å— lighthouse æ˜¯åšè¿™éƒ¨åˆ†å·¥ä½œçš„ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥äº†è§£ä¸€ä¸‹ã€‚

> Qï¼šä»Ž Jenkins è¿ç§»åˆ° X ä¼¼ä¹Žéœ€è¦å¤§é‡åŠŸå¤«ï¼Ÿ

Aï¼šçŽ°åœ¨ Jenkins X æ˜¯æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„ï¼Œå…¶ä¸­ä¸€ç§æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„ Jenkins æž¶æž„ï¼Œè¿™ä¸ªè¿ç§»è¿‡åŽ»ç›¸å¯¹å¹³æ»‘ä¸€äº›ï¼Œä½†å…·ä½“ä¹Ÿå’Œç»„ç»‡æƒ…å†µç›¸å…³ã€‚ä¸è¿‡ç¤¾åŒºä¸»æŽ¨çš„æ˜¯åŸºäºŽ tekton çš„æ–¹æ¡ˆï¼Œä¹Ÿè¢«ç§°ä¸ºä¸‹ä¸€ä»£ CI/CD äº§å“ï¼Œå¦‚æžœæ˜¯è¿ç§»åˆ°è¿™ç§æ–¹æ¡ˆçš„è¯å¯ä»¥å¿˜æŽ‰åŽŸæ¥ Jenkins æ‰€å¸¦æ¥çš„ç»éªŒï¼Œé‡æ–°å¼€å§‹ã€‚

> Qï¼šKubeSphere è®¡åˆ’æŠŠ Jenkins X ç”¨è¿›åŽ»å—ï¼Ÿ

Aï¼šåœ¨ç›®å‰ç‰ˆæœ¬å½“ä¸­è¿˜æ²¡æœ‰è®¡åˆ’æŠŠ jenkins x ç”¨è¿›åŽ»ï¼Œå¾ˆå¤§çš„åŽŸå› æ˜¯å› ä¸º Q4ï¼ŒçŽ°åœ¨ prow æ”¯æŒçš„ scm ç±»åž‹å¤ªè¿‡äºŽå•ä¸€äº†ï¼Œä¸å¤ªé€‚åˆä¼ä¸šå®¢æˆ·ã€‚

> Qï¼šJenkins X å¯ä»¥ç›´æŽ¥ç”¨äºŽç”Ÿäº§çŽ¯å¢ƒçš„ CD å—ï¼Ÿå¯ä»¥ç»“åˆå…¬å¸çš„å®¡æ‰¹æµå—ï¼Ÿä¸Ž kubnetes å¦‚ä½•åä½œï¼Ÿ

Aï¼šJenkins X æ˜¯å¯ä»¥ç”¨äºŽç”Ÿäº§çŽ¯å¢ƒ CD çš„ï¼Œç»“åˆå®¡æ‰¹æµåº”è¯¥æœ‰ä¸€å®šçš„å¼€å‘é‡ã€‚å¯ä»¥çœ‹ä¸‹åˆ†äº«æœ‰å…³ Jenkins X çš„çŽ¯å¢ƒç®¡ç†éƒ¨åˆ†ï¼ŒJenkins X æœ¬èº«å°±æ˜¯å’Œ k8s æ·±åº¦èžåˆçš„ã€‚

> Qï¼šKubeSphere DevOps å¯¹æ¯”åŽŸç”Ÿçš„ Jenkins æœ‰å“ªäº›ä¼˜åŠ¿å‘¢ï¼Ÿ

Aï¼šKubeSphere DevOps æ²¡æœ‰å¯¹åŽŸç”Ÿ Jenkins è¿›è¡Œå¾ˆå¤§çš„æ”¹é€ ã€‚ä½†æ˜¯ç”¨æˆ·å¦‚æžœè‡ªå·±æ­å»º Jenkins éœ€è¦è‡ªå·±åŽ»äº†è§£ Jenkins çš„åŽŸç†ä»¥åŠå„ç§å’Œ k8s ç»“åˆçš„æ–¹æ¡ˆã€å¦‚ä½•è¿è¡Œçš„æ›´ç¨³å®šã€‚å¦‚æžœä½¿ç”¨ KubeSphere çš„è¯ç”¨æˆ·å¯ä»¥ç›´æŽ¥ä½¿ç”¨æµæ°´çº¿ï¼Œé¿å…æŽ‰äº†è‡ªå·±æ­ç§¯æœ¨çš„è¿‡ç¨‹ã€‚å¹¶ä¸”å¯¹äºŽä¸€äº›æ™®éçš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¼šå‘ Jenkins æäº¤ PR æ¥æ”¹è¿› Jenkins çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ä¸‹é¢é“¾æŽ¥æ‰€å¯¹åº”çš„ PR è®© kubernetes çš„ agent è°ƒåº¦ä»Ž 10s å·¦å³ä¼˜åŒ–åˆ°äº† 10ms å·¦å³ [pull/598](https://github.com/jenkinsci/kubernetes-plugin/pull/598)

> Qï¼šè°¢è°¢

Aï¼šæ‰€æœ‰äººéƒ½åœ¨è¿™é‡Œæé—®ã€‚

> Qï¼šå…¶å®ž gitops å®Œå…¨è½åœ°åœ¨ä¸€èˆ¬ä¼ä¸šæ˜¯æœ‰éš¾åº¦çš„ï¼Œè€ƒè™‘åˆ°æœ‰ä¸€äº›ä¸Šçº¿å®¡æ‰¹ç­‰æµç¨‹ã€‚gitops è½åœ°æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®å’Œæ€è€ƒï¼Ÿ

Aï¼šä¸ªäººè®¤ä¸ºç†æƒ³çŠ¶å†µä¸‹æœ€å¥½çš„æ–¹æ¡ˆè¿˜æ˜¯åˆ©ç”¨ PR/MR çš„æ–¹å¼è¿›è¡Œå¼€å‘ï¼Œåœ¨ PR/MR é‡Œé¢è¿›è¡Œå®¡æ ¸ï¼Œè¿™å¯èƒ½å’Œå¾ˆå¤šä¼ä¸šçš„çŽ°çŠ¶ä¸å¤ªç¬¦åˆï¼Œä½†å…¶å®žè¿™ç§æ–¹æ¡ˆåœ¨æŸç§ç¨‹åº¦ä¸Šä¹Ÿæ˜¯å¯ä»¥è½åœ°ä¸Šçº¿å®¡æ‰¹æµç¨‹çš„ã€‚å¯ä»¥å…ˆæŽ¨è¡Œå¼€å‘è¿‡ç¨‹åˆ©ç”¨ PR/MRï¼Œç”¨æ•°æ®è¯æ˜Žè¿™ç§æ–¹å¼æ˜¯å¯è¡Œçš„ï¼Œå†åŽ»æŽ¨åŠ¨ç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²åˆ‡æ¢å·¥ä½œæ–¹å¼ã€‚

> Qï¼šjenkins å¦‚ä½•åšå¤‡ä»½æ¢å¤

Aï¼š Jenkins çš„å¤‡ä»½æœ‰å¾ˆå¤šç§æ–¹æ¡ˆã€‚å…¶ä¸­ä¸€ç§æœ€å¸¸è§ä¹Ÿæ˜¯æ¯”è¾ƒæš´åŠ›çš„æ–¹æ¡ˆå°±æ˜¯å¤‡ä»½ä¸‹æ•´ä¸ª Jenkins Home ç›®å½•ï¼Œæ¢å¤çš„æ—¶å€™ç›´æŽ¥æ¢å¤æ•´ä¸ªç›®å½•å°±å¯ä»¥äº†ã€‚å¦å¤–ä¸€ç§å¸¸è§æ–¹æ¡ˆæ˜¯ jenkins kubernetes operator æ‰€é‡‡ç”¨çš„æ–¹æ¡ˆï¼Œåœ¨è¿™ä¸ªæ–¹æ¡ˆé‡Œé¢æŠŠ jenkins çš„é…ç½®å’Œæ“ä½œåŽ†å²è®°å½•è¿›è¡Œäº†åˆ†ç¦»ï¼Œé…ç½®ï¼ˆåŒ…æ‹¬æµæ°´çº¿çš„åˆ›å»º)éƒ½å­˜å‚¨åœ¨ git ä»“åº“ä¸­ï¼Œè€Œæž„å»ºè®°å½•ã€æ—¥å¿—ç­‰ä¿¡æ¯å•ç‹¬è¿›è¡Œå¤‡ä»½ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥åœ¨ github ä¸Šæ‰¾åˆ°è¿™ä¸ªé¡¹ç›®äº†è§£ä¸€ä¸‹ã€‚

> Qï¼š jenkins X èƒ½æ”¯æŒ jenkins çŽ°æœ‰çš„æ’ä»¶å˜›ï¼Ÿ

---

### 2019-10-29ï¼šåŸºäºŽ Ceph çš„ Kubernetes æ•°æ®æŒä¹…åŒ–

[æé—®é“¾æŽ¥](https://shimo.im/docs/Px6xTrqGdDCJp8hW)

> Qï¼šk8s é‡Œé¢ä½¿ç”¨ cephï¼Œå‡è®¾ ceph å‡ºé—®é¢˜ã€‚è¿™æ ·ä¼šå¯¼è‡´èŠ‚ç‚¹ hang ä½å—ï¼Ÿå¯¼è‡´é›†ç¾¤ä¸å¯ç”¨æƒ…å†µã€‚å¦‚æžœä¼šï¼Œé‚£è¯¥å¦‚ä½•é¿å…ã€‚è°¢è°¢ã€‚

Aï¼š å¹¶ä¸ä¼šï¼Œå› ä¸º Ceph æœ¬èº«æ˜¯åˆ†å¸ƒå¼é«˜å¯ç”¨çš„ï¼Œè€Œä¸”å³ä½¿ Ceph èŠ‚ç‚¹å…¨æŒ‚ï¼Œ ä¹Ÿä»…ä»…ä¼šå½±å“ä½¿ç”¨ Ceph çš„ Podï¼Œè€Œä¸æ˜¯èŠ‚ç‚¹ã€‚

> Qï¼šceph æ˜¯é€šè¿‡ k8s éƒ¨ç½²è¿˜æ˜¯åŽŸç”Ÿéƒ¨ç½²ã€‚ceph å’Œ k8s èŠ‚ç‚¹è¶…èžåˆå—ï¼Œè¿˜æ˜¯åˆ†å¼€ã€‚

Aï¼šä¸€èˆ¬ç”Ÿäº§çŽ¯å¢ƒä¸­éƒ½æ˜¯ç‹¬ç«‹éƒ¨ç½²çš„ï¼Œ3 æˆ– 5 Monitorï¼Œ 3 ï½ž 60+ OSD ç­‰è§„æ¨¡ã€‚

> Qï¼šK8S ä¸­å¦‚æžœä½¿ç”¨ RBD ä½œä¸ºæ•°æ®åº“çš„å­˜å‚¨ï¼Œå¦‚æžœåº“æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå¯¹äºŽæ•°æ®æ—¥å¸¸çš„å¤‡ä»½å’Œç»´æŠ¤æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šå¯ä»¥åˆ©ç”¨å¿«ç…§ï¼Œå¿«é€Ÿå¤‡ä»½å’Œæ¢å¤ã€‚åœ¨åŽ»å¹´çš„ KubeCon ä¸Šï¼ŒåŽä¸ºå’Œè°·æ­Œçš„å°å§å§ä»¬æ¼”ç¤ºè¿‡ ceph ä¸Ž glusterfs çš„ä¼˜ç¼ºç‚¹

> Qï¼šåœ¨ K8S ä¸­å¯¹äºŽéœ€è¦å…±äº«çš„å­˜å‚¨ï¼Œä½¿ç”¨ CephFS éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Œä¼šä¸ä¼šå­˜åœ¨ä¸€äº›å‘ï¼Ÿ

Aï¼šç›®å‰å­˜åœ¨ä¸€ç§è¯´æ³•ï¼Œå°±æ˜¯ CephFS ä¸ç¨³å®šï¼Œä¸æŽ¨èä½¿ç”¨ã€‚å…·ä½“å¦‚ä½•ä¸ç¨³å®šã€å¦‚ä½•è§¦å‘ã€æ€Žä¹ˆé¿å…å°±å¾ˆå°‘æœ‰äººçŸ¥é“äº†ï¼Œå¦å¤–è¿˜æœ‰ï¼Œå¦‚æžœ CephFS ä¸ç¨³å®šï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜æœ‰å…¶å®ƒå“ªäº›æ›¿ä»£å“å‘¢ï¼Ÿ

> Qï¼šå­¦ä¹  ceph æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„æ–¹å¼ï¼Ÿä»¥åŠå¦‚ä½•æ¯”è¾ƒæœ‰æ•ˆçŽ‡çš„å®žè·µï¼Ÿ

Aï¼šå¿«é€Ÿé˜…è¯»ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œç„¶åŽè‡ªå·±å®‰è£…ä¸€å¥—ï¼Œå†ç»“åˆæ–‡æ¡£æ·±å…¥ç ”ç©¶ã€‚æ¨¡ä»¿éœ€æ±‚åœºæ™¯æµ‹è¯•ä½¿ç”¨ã€‚å¤šå®žè·µã€‚

> Qï¼šK8S å¯¹å¤–æš´éœ²æœåŠ¡ç”¨çš„æ˜¯é‚£ç§æ–¹å¼å‘¢ï¼Ÿ å¦‚æžœåœ¨ä¸€ä¸ªé›†ç¾¤é‡Œé¢è·‘ä¸åŒçš„ä¸šåŠ¡ï¼Œåœ¨å¯¹ä»–ä»¬åšå¯¹å¤–çš„åŸŸåè§£æžï¼Œè®¿é—®æŽ§åˆ¶æ˜¯æ€Žæ ·å®žçŽ°çš„ï¼Œä¼šä¸ä¼šå­˜åœ¨ä¸€äº›æ€§èƒ½é—®é¢˜æˆ–ç«¯å£çš„å†²çªï¼Ÿ

Aï¼š ä¸€èˆ¬æ¯”è¾ƒå¸¸è§çš„å°±æ˜¯å•èŠ‚ç‚¹è®¿é—®çš„ NodePort, é…ç½®é«˜å¯ç”¨æ¨¡å¼çš„ Ingress ç­‰ç­‰ã€‚
ç”±äºŽæ¯ä¸ª Pod/Service ç«¯å£éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥å¹¶ä¸ç”¨æ‹…å¿ƒä¼šè·Ÿå…¶å®ƒå†²çªã€‚é™¤éžä½¿ç”¨äº† NodePort ä¸”æŒ‡å®šäº†ç«¯å£ã€‚

> Qï¼šrook å’Œ åŽŸç”Ÿçš„ Ceph éƒ¨ç½²æ–¹å¼åœ¨æ€§èƒ½å’Œç»´æŠ¤ä¸Šæ˜¯å¦æœ‰åŒºåˆ«ï¼Œè¿™ä¸¤ç§æ–¹å¼å¦‚ä½•é€‰æ‹©ï¼Ÿ

Aï¼šæŠ±æ­‰ï¼Œ rook è¿˜æ²¡æœ‰ä½¿ç”¨è¿‡ï¼Œä¸è¿‡ç›¸å¯¹æ¥è¯´ï¼ŒCeph é›†ç¾¤ç»´æŠ¤çš„é‡ç‚¹ä¸€èˆ¬éƒ½åœ¨ OSDã€‚åœ¨ç”Ÿäº§çŽ¯å¢ƒï¼Œä¸€èˆ¬ä¹Ÿä¼šç‹¬ç«‹éƒ¨ç½² Ceph, æ¯•ç«Ÿå³ä½¿å¿«é€Ÿçš„é‡æ–°è°ƒåº¦ Monitorï¼Œä¹Ÿå¯èƒ½ä¼šå¯¹é›†ç¾¤äº§ç”Ÿè½»å¾®å½±å“ã€‚

> Qï¼šå¯¹äºŽå°ä¸­åž‹å…¬å¸æ¥è¯´ ceph æ˜¯ä¸ªå¥½é€‰æ‹©ä¹ˆï¼Ÿè‡ªè¡Œç»´æŠ¤ï¼Œå¯ä»¥ä»Žå¤šä¸ªæ–¹é¢è¯´è¯´ k8s ä¸‹å¦‚ä½•è¿›è¡Œå­˜å‚¨é€‰åž‹ä¹ˆï¼Ÿè°¢è°¢ï¼

Aï¼šç›¸å¯¹å¯ä»¥æŽ¥å—ï¼Œè¿ç»´å¹¶ä¸å¤æ‚ã€‚ç›®å‰ k8s ä¸Šå­˜å‚¨è¿˜æ˜¯ä»¥ rbd æ¯”è¾ƒå¤šä¸€äº›ã€‚å½“ç„¶ä¹Ÿæœ‰ä¸€äº› NFSï¼Œä¸è¿‡å› ä¸ºå…¶æ€§èƒ½ä¸Žç¨³å®šæ€§ï¼Œæ‰€ä»¥ä¸æŽ¨èä½¿ç”¨ã€‚

> Qï¼šå¦‚æžœä½¿ç”¨ BlueStore çš„æ–¹å¼ï¼Œosd ç£ç›˜æ–‡ä»¶çš„åˆ’åˆ†æ˜¯æ€Žæ ·çš„ï¼Œæ¯”å¦‚ WAL, DB è¿™ç§æ–‡ä»¶æ˜¯å•ç‹¬å­˜æ”¾åœ¨ SSD ç›˜ä¸­å—ï¼Œè¿˜æ˜¯éƒ½å­˜å‚¨åœ¨ SAS ç›˜ä¸­?

Aï¼šæœ‰æ¡ä»¶çš„è¯ï¼Œä¸”å­˜å‚¨éœ€æ±‚æ€§èƒ½é«˜çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ›´é«˜æ€§èƒ½çš„ SSD é€šå¸¸éƒ½ä¼šæœ‰æ›´å¥½çš„æ•ˆæžœã€‚

> Qï¼šCeph ä¸­ pool æ•°é‡æ˜¯å¦‚ä½•è®¾å®šçš„ï¼Œå¦‚æžœå¯¹é›†ç¾¤è¿›è¡Œæ‰©å®¹ï¼ŒPG çš„æ•°é‡æ˜¯å¦éœ€è¦è°ƒæ•´ï¼Œè°ƒæ•´çš„æ—¶å€™éœ€æ³¨æ„ä»€ä¹ˆï¼Ÿ ç½‘ç»œæ–¹é¢æ€Žä¹ˆåŽ»è§„åˆ’æ¯”è¾ƒåˆç†ï¼Œè°¢è°¢

Aï¼šç›®å‰ PG çš„é™åˆ¶å¤šä¸€äº›ï¼Œå› ä¸º Pool é‡Œé¢ PG æ˜¯å­˜åœ¨ä¸€å®šæ•°é‡çš„ï¼Œè€Œ PG æ•°é‡åˆè·Ÿç¡¬ç›˜æ•°é‡æŒ‚é’©ï¼Œæ‰€ä»¥è°ƒæ•´æ—¶éœ€è¦è®¡ç®— Pool çš„æ•°é‡ä¸Ž OSD æ•°é‡ã€‚ç½‘ç»œæ–¹é¢çš„è¯ï¼Œåœ¨ç”Ÿäº§çŽ¯å¢ƒï¼ŒæŽ¨èä½¿ç”¨è‡³å°‘ 10Gbps ç½‘ç»œï¼ŒåŒç½‘å¡ä»¥ä¾¿åˆ†ç¦»ä¸šåŠ¡å’Œé›†ç¾¤ç½‘ç»œï¼Œæå‡æ€§èƒ½ã€‚

> Qï¼š1.osd æ˜¯å¦éœ€è¦åšé˜µåˆ—ï¼Ÿ20 å°ç‰©ç†æœºï¼Œå•å°ç‰©ç†æœº 1 ä¸ª OSD é˜µåˆ—è¿˜æ˜¯å•å°ç‰©ç†æœº 8 ä¸ª OSD è£¸ç›˜ï¼Ÿ2.å½“å¤§é‡ osd å‡ºçŽ° slow ops å¦‚ä½•å¤„ç†ï¼Ÿ3.çº åˆ ç å’Œä¸‰å‰¯æœ¬ï¼Œåº”è¯¥å¦‚ä½•é€‰æ‹©

Aï¼šç£ç›˜æ•°é‡è¾ƒå°‘æ—¶ï¼Œä¸æŽ¨è RAIDï¼Œå»ºè®®ç”± Ceph ç›´æŽ¥ç®¡ç†ç£ç›˜ï¼Œé€šè¿‡å¹¶è¡ŒèŽ·å–æ›´å¥½æ€§èƒ½ã€‚å¦å¤– PG çš„æ•°é‡è®¡ç®—æ–¹å¼ä¹Ÿè·Ÿ OSD æ•°é‡æœ‰å…³ï¼Œæ‰€ä»¥éœ€è¦ç»¼åˆè€ƒè™‘ã€‚è¿™ä¸ªå¯èƒ½éœ€è¦ç»“åˆç›‘æŽ§ç³»ç»Ÿï¼ŒåŠæ—¶å‘çŽ°å¼‚å¸¸æƒ…å†µï¼Œæ˜¯è®¾å¤‡è¿˜æ˜¯æœåŠ¡æˆ–è€…èŠ‚ç‚¹å‘€ç½‘ç»œåŽŸå› ç­‰ç­‰åˆ¤æ–­å¤„ç†ã€‚å¯ä»¥ç»“åˆä¸šåŠ¡åœºæ™¯éœ€æ±‚ä¸Žé›†ç¾¤è§„æ¨¡å’Œç¡¬ä»¶é…ç½®ç­‰æƒ…å†µæ¥ç»¼åˆè€ƒè™‘å†³å®šé‡‡ç”¨å“ªç§æ–¹å¼ã€‚

> Qï¼šrbd åˆ†é…ç»™å…·ä½“åº”ç”¨æ¯”å¦‚æŒ‚è½½åˆ° mysql åŽï¼Œå¦‚æžœç©ºé—´ä¸è¶³ï¼Œè¯¥å¦‚ä½•æ‰©å®¹ï¼Ÿè°¢è°¢

Aï¼šç›®å‰æ”¯æŒåœ¨çº¿åŠ¨æ€æ‰©å®¹ã€‚

> Qï¼šåˆ†å¸ƒå¼å­˜å‚¨åº”ç”¨äºŽ hdfs æ˜¯å¦å¯è¡Œï¼Œç›¸å¯¹äºŽæœ¬åœ°å­˜å‚¨ï¼Œåˆ†å¸ƒå¼å­˜å‚¨çš„è¯»å†™æ€§èƒ½å¦‚ä½•æé«˜ï¼Œå¦å¤– ceph çš„ bluestore æ•ˆæžœæ€Žä¹ˆæ ·å‘¢ï¼Ÿ

Aï¼šè¿™ä¸ªä¸å¤ªåˆé€‚ï¼Œå› ä¸º HDFS æœ¬èº«è‡ªå·±å°±æ˜¯åšåˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¸”ä¸šåŠ¡åœºæ™¯ä¹Ÿä¸ç›¸åŒã€‚Ceph çš„æ€§èƒ½æå‡æ— å¤–ä¹Žä¸¤ä¸ªæ–¹é¢ï¼šæ›´å¿«çš„ç£ç›˜/SSD å’Œ æ›´å¤§å¸¦å®½çš„ç½‘ç»œã€‚ç”±äºŽç›´æŽ¥ç®¡ç†äº†ç¡¬ç›˜ï¼Œæ‰€ä»¥å…¶æ€§èƒ½è¿˜æ˜¯å¾ˆå¥½çš„ã€‚

> Qï¼šå—å­˜å‚¨æ¨¡å¼ä¸‹ï¼Œç£ç›˜åœ¨å®¿ä¸»æœºä¸Šçš„æ•°æ®æ˜¯åŠ å¯†çš„ï¼Œå¦‚æžœè¦åœ¨å®¹å™¨å¤–éƒ¨æ“ä½œè¿™éƒ¨åˆ†æŒä¹…åŒ–çš„æ•°æ®ï¼Œéœ€è¦æ€Žä¹ˆæ“ä½œå‘¢ï¼Ÿ

Aï¼šå¯ä»¥æŒ‚è½½æ“ä½œã€‚

> Qï¼šceph å›¾å½¢ç®¡ç†ç•Œé¢éœ€å®‰è£…ä»€ä¹ˆè½¯ä»¶ï¼Ÿ

Aï¼šçŽ°åœ¨ä¸éœ€è¦é¢å¤–å®‰è£…è½¯ä»¶äº†ï¼Œå·²ç»å†…ç½®ã€‚

> Qï¼šè¯·é—®æ€Žæ ·åœ¨ k8s ä¸­ï¼Œå®žçŽ°å¤šä¸ªå®¹å™¨å…±äº«ä¸€ä¸ª ceph æ–‡ä»¶ç³»ç»Ÿï¼Œå…±äº«æ–‡ä»¶å­˜å‚¨å»ºè®®ç”¨å“ªç§æ–¹å¼ï¼Ÿ

Aï¼š è¿™ç§éœ€æ±‚å°±éœ€è¦ç”¨ cephfs äº†ã€‚å…±äº«æ–‡ä»¶å­˜å‚¨çš„è¯ï¼Œçœ‹æœ€ç»ˆå®¢æˆ·åœºæ™¯ï¼Œå¦‚æžœæ˜¯ç»™ Windows ç­‰å®¢æˆ·ç«¯ä½¿ç”¨çš„å…±äº«ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ ISCSI æ¥æŒ‚è½½ RBD åˆ° Windows å…±äº«æœåŠ¡å™¨ã€‚

> Qï¼š Cephfs ä¹‹å‰åœ¨æµ·é‡å°æ–‡ä»¶è¯»å†™æµ‹è¯•æ—¶æ€§èƒ½éžå¸¸å·®ï¼Œæ€§èƒ½é—®é¢˜ç›®å‰æœ‰æ²¡æœ‰è§£å†³ï¼Ÿ

Aï¼šæ€§èƒ½éœ€è¦é ç¡¬ä»¶åŽ»å †ã€‚

> Qï¼š Ceph æœ€å¤§æ”¯æŒå¤šå¤§çš„å­˜å‚¨å®¹é‡ä¸å½±å“æ€§èƒ½ï¼Œä¸Žåˆ†å¸ƒå¼å­˜å‚¨ HDFS çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿpgp å’Œ pg ä»€ä¹ˆå…³ç³»

Aï¼šå®˜æ–¹å·ç§°æ˜¯ PB çº§çš„ã€‚HDFS é€‚åˆå¤§æ–‡ä»¶ï¼Œä¸Šç™½ G çš„é‚£ç§å•ä¸ªæ–‡ä»¶ã€‚PG æ˜¯æŒ‡å®šå­˜å‚¨æ± å­˜å‚¨å¯¹è±¡çš„ç›®å½•æœ‰å¤šå°‘ä¸ªï¼ŒPGP æ˜¯å­˜å‚¨æ±  PG çš„ OSD åˆ†å¸ƒç»„åˆä¸ªæ•°ã€‚

> Qï¼š kubernes ä¸­çŽ°åœ¨çš„å—å­˜å‚¨æ˜¯ä¸€ä¸ªéƒ¨ç½²ç»‘å®šä¸€ä¸ªå—ï¼Œèƒ½å¦åšæˆä¸€ä¸ª pod ç»‘å®šä¸€ä¸ªå—ï¼Œæœ‰è¿‡è¿™æ–¹ä¾¿çš„å®žè·µå—ï¼Ÿå¯å¦åˆ†äº«ä¸€ä¸‹ã€‚

Aï¼šä½¿ç”¨ StatefulSet å³å¯ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºå’Œç»‘å®š PVCã€‚

> Qï¼š ç›®å‰ä¸šç•Œ ceph é›†ç¾¤çš„æœ€å¤§è§„æ¨¡èƒ½è¾¾åˆ°å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼ˆå¤§è‡´çš„æ•°é‡çº§)ï¼Ÿæ˜¯æ€Žæ ·çš„ä¸€ç§åº”ç”¨åœºæ™¯ï¼Ÿ

---

### 2019-10-15ï¼šKubernetes åœ¨ SHAREit çš„è½åœ°å®žæˆ˜

[æé—®é“¾æŽ¥](https://shimo.im/docs/KDWHyyPCtYCPcVdy)

> Qï¼šç›´æŽ¥é‡‡ç”¨ç‰©ç†æœºè¿˜æ˜¯æœ‰å…ˆåš IaaS å±‚è™šæ‹ŸåŒ–ï¼Ÿ

Aï¼šæˆ‘ä»¬åšçš„æ˜¯å‡ºæµ·ä¸šåŠ¡ï¼ŒåŸºæœ¬ä¸Šè€ƒè™‘åˆ°åˆè§„ç­‰é—®é¢˜ï¼Œæˆ‘ä»¬ä¸»è¦é¡¹ç›®å…¨éƒ¨è¿è¡Œåœ¨å…¬æœ‰äº‘ä¸Šã€‚

> Qï¼šæœ‰æ²¡æœ‰ç¢°åˆ°è°ƒåº¦çš„é—®é¢˜ï¼ŒæŸå°æœåŠ¡å™¨ CPU æˆ–å†…å­˜é«˜äº†ä»è°ƒåº¦åˆ°è¿™å°ä¸Šï¼Ÿ

Aï¼šé‡åˆ°è¿‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéœ€è¦è€ƒè™‘ä½ çš„åº”ç”¨æ˜¯å¦åŠ äº†å¾ˆå¤šäº²å’Œæ€§æˆ–æ˜¯ nodeselectorã€‚æ­£å¸¸çš„è°ƒåº¦å™¨ï¼Œæ˜¯ä¼šä¼˜å…ˆè€ƒè™‘èµ„æºå¹³è¡¡çš„ã€‚

> Qï¼šè¯·é—®ä¸€ä¸‹ coredns å¦‚ä½•åè§£æž pod çš„ IP åœ°å€ï¼Ÿä¸ç”¨ svc çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦å¯ä»¥è§£æž pod çš„åå­—ï¼Ÿæ˜¯å¦æœ‰ç”¨ coredns çš„ rewrite æ’ä»¶ã€‚

Aï¼šè¿™ä¸ªä¸æ¸…æ¥šï¼Œæˆ‘ä»¬æ²¡æœ‰è¿™æ ·çš„åœºæ™¯ã€‚ä½†æ˜¯ corednsï¼Œæ”¯æŒç¼–å†™è‡ªå·±çš„æ’ä»¶ã€‚

> Qï¼šè¯·é—®ä¸‹ï¼Œä¸åŒäº‘ä¹‹é—´çš„å»¶æ—¶æ€Žä¹ˆè§£å†³?ä½ ä»¬æ˜¯ä¸€æœµäº‘å°±éƒ¨ç½²ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡ä¹ˆï¼Ÿ

Aï¼šæˆ‘ä»¬ä¼šåœ¨ä¸åŒäº‘ä¹‹é—´é€šè¿‡ä¸“çº¿æ‰“é€šã€‚åŸºæœ¬ä¸Šç›¸å…³è”çš„ä¸šåŠ¡ä¼šéƒ¨ç½²åœ¨ä¸€å®¶äº‘ä¸Šã€‚ä½†æ˜¯æˆ‘ä»¬ä¼šå°½é‡ä¿è¯åŒä¸€ä¸ªä¸šåŠ¡éƒ¨ç½²åœ¨ä¸åŒçš„ AZã€‚

> Qï¼šå‘Šè­¦ç­–ç•¥ä¸Šæœ‰æ²¡æœ‰æœ€ä½³å®žè·µåˆ†äº«ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ç»Ÿä¸€æŠ¥è­¦å¹³å°åŸºäºŽ alertmanager å®žçŽ°ï¼ŒåŸºæœ¬ä¸Šç”¨åˆ°äº†å®ƒæä¾›çš„é™é»˜ï¼Œåˆ†ç»„ï¼ŒæŠ‘åˆ¶ç­‰ç‰¹æ€§ã€‚åªä¸è¿‡æˆ‘ä»¬å¯¹æŽ¥äº†å®ƒçš„ apiï¼Œä¹Ÿé›†æˆåˆ° scmp å½“ä¸­ã€‚

> Qï¼šé…ç½®ç®¡ç†æ˜¯æ€Žä¹ˆåšåˆ°ä¸åŒçŽ¯å¢ƒï¼Œä¸åŒé…ç½®ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„é…ç½®æ˜¯åœ¨ configmap ç»“åˆæ•°æ®åº“æ¥å®žçŽ°ç‰ˆæœ¬ç®¡ç†ï¼Œæœ¬è´¨ä¸Šæ¯ä¸ªé›†ç¾¤éƒ½éœ€è¦å•ç‹¬è®¾ç½®ã€‚æ‰€ä»¥ä¸åŒçš„çŽ¯å¢ƒï¼Œè®¾ç½®ä¸åŒçš„ configmap å³å¯ã€‚

> Qï¼šä¸šåŠ¡çš„æ•°æ®åº“æ˜¯åœ¨ k8s é‡Œé¢è¿è¡Œï¼Œè¿˜æ˜¯å•ç‹¬æ­é›†ç¾¤ï¼Ÿ

Aï¼šæˆ‘ä»¬é™¤äº† prometheus å’Œä¸€äº› mqï¼Œæˆ‘ä»¬ç›®å‰è¿˜æ²¡æœ‰å°è¯•æœ‰çŠ¶æ€åº”ç”¨ã€‚

> Qï¼šlinux å†…æ ¸å‚æ•°ä¼˜åŒ–å…·ä½“ä½ ä»¬ç¢°åˆ°è¿‡å“ªäº›å‘å‘¢ï¼Œæ€Žä¹ˆä¼˜åŒ–çš„å‘¢ï¼Ÿçº¿ä¸Šä½¿ç”¨çš„ centos ç‰ˆæœ¬å’Œå†…æ ¸å¦‚ä½•é€‰æ‹©çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å…¬æœ‰äº‘ï¼Œå†…æ ¸ç‰ˆæœ¬ä¸€èˆ¬å…¬æœ‰äº‘æä¾›ç‰ˆæœ¬ä¸­æœ€æ–°çš„ã€‚å…¶å®žä¸åŒçš„ä¸»æœºç±»åž‹ï¼Œç›¸åº”çš„å‚æ•°ä¸ä¸€æ ·ï¼Œéœ€è¦åœ¨é€‰åž‹ä¸»æœºçš„æ—¶å€™ï¼Œåšå¤§è§„æ¨¡æµ‹è¯•ã€‚æ¯”å¦‚ net.netfiletr ä¸‹çš„å‚æ•°ã€‚æˆ‘ä»¬ä¼šåŸºäºŽå…¬æœ‰äº‘é•œåƒï¼Œåšä¼˜åŒ–ï¼Œç„¶åŽåˆ©ç”¨ pakcer æ‰“æˆæ–°çš„é•œåƒä½¿ç”¨ã€‚

> Qï¼šè‡ªç ”ç»„ä»¶ï¼Œå¯ä»¥å¼€æºå—ï¼Ÿæ¯”å¦‚æ—¥å¿—çš„é‚£ä¸ª

Aï¼šSHAREit æ˜¯ä¸€ä¸ªæŠ€æœ¯éžå¸¸ open çš„å•ä½ã€‚æˆ‘ä»¬ä»Žä¸Šåˆ°ä¸‹ï¼Œé¼“åŠ±æŠ€æœ¯äººå‘˜åŽ»åˆ†äº«ã€‚æ‰€ä»¥å¦‚æžœå¤§å®¶æœ‰éœ€è¦ï¼Œæˆ‘ä»¬ä¼šåšä¸€ä¸‹å†…éƒ¨çš„æ•´ç†ï¼Œå¼€æºå‡ºåŽ»ã€‚åŒæ—¶ï¼Œæˆ‘ä¹Ÿä¼šå†™ä¸€äº›å…·ä½“çš„æ–‡ç« ï¼Œæ¥è®²å…·ä½“çš„ç»†èŠ‚ã€‚

> Qï¼šalertmanager æŠ¥è­¦ï¼Œæˆ‘ä½¿ç”¨çš„ prometheus operator å®‰è£…çš„ï¼Œä½¿ç”¨é»˜è®¤çš„å¾®ä¿¡æŠ¥è­¦ï¼Œè¿™ä¸ªæŠ¥è­¦æ—¶åŒºé—®é¢˜ï¼Œæ˜¯ä¿®æ”¹æºç è§£å†³ï¼Œè¿˜æ˜¯ä½¿ç”¨ä¸€ä¸ª webhookï¼ŸæŠ¥è­¦çš„æ¨¡æ¿æ–‡ä»¶æ˜¯å¦‚ä½•ç®¡ç†çš„ï¼Ÿ

Aï¼šæˆ‘è§‰å¾—ä½ åº”è¯¥éœ€è¦é‡æ–°å®šåˆ¶ alertmanager çš„é•œåƒï¼Œåœ¨ dockerfile ä¸­ä¿®æ”¹æ—¶åŒºã€‚å…¶å®žæˆ‘ä»¬è¿™è¾¹ä¹Ÿ fork äº† alertmanagerï¼Œåšäº†ä¸€äº›ä¼˜åŒ–å’ŒåŠŸèƒ½å¢žå¼ºï¼Œæ¯”å¦‚ç›´æŽ¥å°† dingtalk é›†æˆè¿›æ¥ï¼Œé¿å…å¼•å…¥ webhook ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿæ˜¯è‡ªå·±æ‰“çš„é•œåƒã€‚è‡³äºŽæŠ¥è­¦æ¨¡æ¿ï¼Œæˆ‘ä»¬è¿™è¾¹å…ˆæŠŠæŠ¥è­¦æ¨¡æ¿æ•°æ®å­˜æ”¾åˆ°æ•°æ®åº“å½“ä¸­ï¼Œç„¶åŽç»“åˆ confd æ¥å®žçŽ° altermanager é…ç½®æ–‡ä»¶åˆ·æ–°çš„ã€‚

> Qï¼šhpa éƒ¨åˆ†ä½ ä»¬æ€Žä¹ˆåšåˆ°æ ¹æ®ä¸åŒä¸šåŠ¡é€‰æ‹©ä¸åŒçš„ç­–ç•¥?

ç›®å‰æœ€å¤§çš„ä¸å¤ªæ¸…æ¥šï¼Œä¸å°‘å¤§å…¬å¸å¯èƒ½ä¸ä¼šå…¬å¸ƒã€‚å­˜å‚¨æ—¥å¿—ã€å¤‡ä»½æ•°æ®ç­‰ç­‰ã€‚

---

### 2019-09-17ï¼šPrometheus æž¶æž„ä¸Žå®žè·µåˆ†äº«

[æé—®é“¾æŽ¥](https://shimo.im/docs/HPdrhHpP3DVk9wDk)

> Qï¼šæ‚¨å¥½ï¼Œæˆ‘ä»¬ prometheus ç›‘æŽ§ç³»ç»Ÿéœ€è¦æŒä¹…åŒ–ç›‘æŽ§æ•°æ®ï¼Œç›®å‰çº¦å­˜å‚¨äº† 1.8T æ•°æ®ï¼Œä¸¥é‡å½±å“äº†æŸ¥è¯¢é€Ÿåº¦ï¼Œgafana åŸºæœ¬æ— æ³•åˆ·æ–°æ•°æ®äº†ï¼Œè¯·é—®æœ‰ä¼˜é›…çš„è§£å†³åŠžæ³•å—ï¼Ÿ

Aï¼š1.8T éƒ½æ˜¯ä¿å­˜åœ¨æœ¬åœ°å—ï¼ŸSSD æœ‰ä¸€å®šçš„åŠ é€Ÿä½œç”¨ã€‚å¦‚æžœæ•°æ®é‡æ¯”è¾ƒå¤§å»ºè®®ä½¿ç”¨ m3dbã€clickhouseã€opentsdb ç­‰ã€‚

> Qï¼šå¦‚ä½•ç™»å½• prometheus æ•°æ®åº“?

Aï¼šprometheus æœ¬åœ° tsdb æ²¡æœ‰ç™»å½•å…¥å£ï¼Œåªæœ‰ go çš„ apiã€‚

> Qï¼šä¼ä¸šçº§çš„ promtheus ç›‘æŽ§çš„æ•°æ®å­˜å‚¨æ˜¯åŸºäºŽä»€ä¹ˆå‘¢ï¼ŸES å—ï¼Œè¿˜æ˜¯å…¶ä»–çš„å­˜å‚¨ï¼Ÿ

Aï¼šæˆ‘ä»¬ä½¿ç”¨ m3dbï¼Œé›†ç¾¤ç‰ˆæœ¬çš„ influxdbã€opentsdb ç­‰éƒ½æ”¯æŒ

> Qï¼šçŽ°åœ¨æœ‰é«˜å¯ç”¨æ–¹æ¡ˆå—ï¼Ÿ

Aï¼šprometheus çš„è”é‚¦æˆ–è€… Improbable å¼€æºçš„ Thanos éƒ½æ˜¯é«˜å¯ç”¨æ–¹æ¡ˆ

> Qï¼špromethues å ç”¨å†…å­˜å¾ˆå¥½ï¼Œæˆ‘ä»¬çš„çŽ¯å¢ƒä¸‹ 45w æŒ‡æ ‡å¤§æ¦‚è¦å ç”¨ 8G å·¦å³çš„å†…å­˜ï¼Œç»å¸¸å‡ºçŽ° prometheus å®¹å™¨ OOMï¼Œè¯·æ³¨æ„æœ‰ä»€ä¹ˆåŠžæ³•å¯ä»¥ä¼˜åŒ–å†…å­˜å ç”¨å—ï¼Ÿ

Aï¼šæ•°æ®æŒ‡æ ‡å¦‚æžœç¡®å®žæ¯”è¾ƒå¤§å¯ä»¥è€ƒè™‘ prometheus çš„ hash é‡‡é›†ï¼Œåˆ†æ‘ŠåŽ‹åŠ›ã€‚åœ¨ç”Ÿäº§è¿‡ç¨‹ä¸­å¾ˆå¤šæŒ‡æ ‡éƒ½æ˜¯å¯ä»¥çœåŽ»çš„ï¼Œè­¬å¦‚ kubernetes ä¸­çš„ sandbox å®¹å™¨çš„æŒ‡æ ‡ã€‚

> Qï¼šé¢å¯¹æµ·é‡å¾®æœåŠ¡ï¼Œå¥½ä¸Šåƒä¸ª k8s èŠ‚ç‚¹ï¼Œæ—¥é’§ä¸Šåƒä¸Šä¸‡äº¿çš„æ—¶åºç‚¹æ•°æ®ï¼Œå¦‚ä½•è§£å†³ prometheus é«˜å¯ç”¨ï¼Œå¦‚ä½•é€‰æ‹©å’Œè§£å†³è¿œç¨‹å­˜å‚¨é—®é¢˜ï¼Ÿå®œä¿¡ç›®å‰æœ‰å¤šå¤§è§„æ¨¡ï¼Ÿæœ‰å¤šå°‘æŒ‡æ ‡ï¼Œä¸€å¤©å¤§æ¦‚æœ‰å¤šå°‘é‡æ•°æ®

Aï¼šç›®å‰å®œä¿¡çš„å®¹å™¨å¤§çº¦ 4000 å·¦å³ï¼Œè§„æ¨¡è¿˜å¹¶ä¸å¤§ï¼Œå¾ˆå¤šæœåŠ¡éƒ½è¿˜éƒ¨ç½²åœ¨è™šæ‹Ÿæœºé‡Œé¢ã€‚æ¯å¤©çš„ç›‘æŽ§æ•°æ®é‡ä¸åˆ° 100Gã€‚åŽ†å²æ•°æ®é€šè¿‡ M3db å­˜å‚¨ã€‚

> Qï¼šé€‰æ‹©æ™®é€šè¿œç¨‹å­˜å‚¨ï¼Œé¢å¯¹æŒä¹…åŒ–æ•°æ®ç›¸å¯¹ prometheus æœ¬åœ°æ•°æ®å‡ åå€æ”¾å¤§çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Œå¦‚ä½•å¤„ç†æ—¥ TB çº§æµ·é‡å­˜å‚¨ï¼ŒåŽæœŸå¦‚ä½•å–å‡ºæ•°æ®è¿›è¡Œåˆ†æžï¼Ÿ

Aï¼šprometheus è®¾è®¡çš„åˆè¡·å¹¶éžè§£å†³å¤§å®¹é‡å­˜å‚¨ã€‚å¦‚æžœæ˜¯ TB æ•°æ®å»ºè®®ä¿å­˜åˆ°è¿œç«¯çš„ opentsdb ä¸­ã€‚

> Qï¼šç›®å‰ prometheus èƒ½å¦æ”¯æŒå¯¹ç½‘ç»œè®¾å¤‡çš„ç›‘æŽ§ï¼Œå¦‚ä½•æ”¯æŒé‡‡ç”¨ snmp  ssh ç­‰åè®®æ–¹å¼çš„ç›‘æŽ§ï¼›èƒ½å¦å®žçŽ°ä¸Ž Zibbix çš„å¯¹æŽ¥ï¼Ÿ

Aï¼šprometheus æœ‰ snmp çš„ exporter å¯ä»¥å®žçŽ°ç½‘ç»œç›‘æŽ§ã€‚ç›®å‰è¿˜æ²¡å¬è¯´å¯ä»¥å¯¹æŽ¥ zabbixã€‚

> Qï¼šç›®å‰ prometheus çš„æŠ¥è­¦ rules è§„åˆ™æ˜¯æ€Žä¹ˆç®¡ç†çš„ï¼ŸæŠ¥è­¦é˜€å€¼æ˜¯å¦å¯åŠ¨æ€è°ƒæ•´ï¼Ÿ

Aï¼šrules ä¹Ÿæ˜¯é€šè¿‡ yaml æ–‡ä»¶é…ç½®ï¼Œå¯ä»¥åŠ¨æ€è°ƒæ•´ï¼Œä½†éœ€è¦ reload é…ç½®ã€‚

> Qï¼šPrometheus çš„ push æ–¹å¼ï¼ˆpush æŽ¨é€ç»™ pushgateway)å’Œ pull æ­£å¸¸çš„æ–¹å¼æ–¹å¼çš„æ€§èƒ½æ¯”è¾ƒï¼Œè°æ›´å¥½å‘¢ï¼Ÿ

Aï¼špushgateway æœ¬èº«ä½œä¸ºæ•°æ®è½¬å‘çš„ä»£ç†ï¼Œæœ¬èº«æ€§èƒ½æŸè€—å¾ˆå°‘ã€‚å»ºè®®ç›´æŽ¥æä¾› prometheus çš„ pull æ”¯æŒ

> Qï¼šè”é‚¦é…ç½®æ—¶ï¼Œå®žæµ‹æŠ“å–å¤šä¸ª job çš„ metrics å­˜åœ¨å»¶è¿ŸçŽ°åƒæžå…¶ä¸¥é‡ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰å¥½çš„è§£å†³åŠžæ³•ï¼Ÿç›®å‰æˆ‘æ˜¯é€šè¿‡ grafana ç›´æŽ¥èŽ·å–ä¸¤ä¸ª prometheus é›†ç¾¤ä½œä¸ºåŽç«¯æ•°æ®åº“

Aï¼šè¿™ä¸ªä¸»è¦çœ‹å»¶è¿Ÿçš„åŽŸå› ï¼Œæ˜¯ä¸‹é¢çš„ prometheus é‡‡é›†æ…¢è¿˜æ˜¯è”é‚¦èŠ‚ç‚¹äºŒæ¬¡æ±‡èšçš„æ…¢ã€‚å…·ä½“æƒ…å†µåŽç»­å¯ä»¥ä¸€èµ·åŠ å¾®ä¿¡æŽ’æŸ¥ä¸€ä¸‹ã€‚2 æ¬¡æ±‡èšï¼Œæœ¬åœ° prometheus ä¸Žçº¿ä¸Š prometheus,æœ¬åœ°é…ç½®è”é‚¦ï¼Œæœ¬åœ°æ±‡èšçº¿ä¸Š job çš„ metricsï¼Œå½“ job æ•°é‡å¤šäº†å°±ä¼šå‡ºçŽ°"federation failed" err="write tcp 192.168.243.145:9090->10.0.0.12:33508: write: broken pipe"

> Qï¼šé’ˆå¯¹äºŽä¸€äº›å…¬å¸è‡ªæœ‰ä¸šåŠ¡çš„è¿›ç¨‹æ•°æ®ç›‘æŽ§æ˜¯ä¾èµ–äºŽè‡ªç ” çš„ go-clent ä¸ŠæŠ¥å—ï¼Ÿè¿˜æ˜¯è¯´ä¸€äº›ä¸‰æ–¹çš„ clientï¼Ÿ

Aï¼šå¦‚æžœå¯ä»¥äºŒæ¬¡å¼€å‘å»ºè®®ç›´æŽ¥åœ¨ä»£ç é‡Œé¢åŠ å…¥ prometheus é‡‡é›†çš„æ”¯æŒï¼Œå¤„ç† go ä»¥å¤–è¿˜æœ‰ javaï¼ŒPython çš„ sdk æ”¯æŒã€‚å¦‚æžœä¸èƒ½äºŒæ¬¡å¼€å‘ä¹Ÿå¯ä»¥åœ¨å¤–éƒ¨é€šè¿‡ exporter æ–¹å¼ã€‚

> Qï¼šå¦‚æžœæœ‰å¤šä¸ªå‰¯æœ¬ CPU åˆ©ç”¨çŽ‡ è¿˜æ˜¯ç”¨ container_name æ¥ç®—å°±æœ‰é—®é¢˜äº†å§ï¼Ÿå¦å¤–é—®ä¸€ä¸‹  ä¸åŒç‰ˆæœ¬çš„ podï¼ˆæ¯”å¦‚å‘ç‰ˆä¹‹åŽ)æ€Žä¹ˆæ¯”è¾ƒå…¶ CPU åˆ©ç”¨çŽ‡ï¼Ÿå¦å¤– histogram çš„ metrics æœ‰åˆ†æžè¿‡å—ï¼Ÿå¦å¤– æŸ¥è¯¢ä¸€ä¸ªæœˆçš„æ•°æ®åº”è¯¥è›®æœ‰åŽ‹åŠ›çš„å§è¿˜æ˜¯åšäº†ä¼˜åŒ–æ˜¯å¦æœ‰å¿…è¦ï¼Ÿ

Aï¼šå—¯ï¼Œå¤šå‰¯æœ¬éœ€è¦ groupã€‚ä¸åŒç‰ˆæœ¬æ•°æ®éƒ½åœ¨ prometheus å­˜å‚¨ï¼Œå¯ä»¥é€šè¿‡å®¹å™¨åç§°æ±‡èšæŸ¥è¯¢å‡ºæ¥ï¼Œä¸€ä¸ªæœˆæ•°æ® step å¯ä»¥è°ƒæ•´çš„å¤§ä¸€äº›ã€‚ç›®å‰çœ‹ä¸€ä¸ªæœˆå†…çš„æŸ¥è¯¢åŸºæœ¬æŽ§åˆ¶åœ¨ 2s ä»¥å†…ã€‚å‘ç‰ˆä¹‹åŽ pod name åå­—æ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ä¿æŒ container nameï¼Œå¦å¤–ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡å‰ç¼€ï¼Œæ­£åˆ™åŒ¹é…ã€‚æˆ‘ç”¨å¾—åŽè€… ä¸è¿‡ä¼šå‡ºçŽ°å¾ˆå¤šç©ºçº¿æ¡ å› ä¸ºå‰é¢ç‰ˆæœ¬ä¸å­˜åœ¨è¿™ä¸ª pod name æ ‡ç­¾çš„ metricsï¼Œè¿™ä¸ªå’Œå¤šå‰¯æœ¬çš„ container_name ä¹Ÿç®—æ˜¯æœ‰ç‚¹å†²çªï¼Œæš‚æ—¶ç”¨æ­£åˆ™çš„æ–¹å¼ å¤šè°¢ã€‚metric åç§°åº”è¯¥æ˜¯å›ºå®šçš„å•Šï¼Œä½ ç”¨æ­£åˆ™åŒ¹é…ï¼Œä¸ä¼šæœ‰é—®é¢˜çš„ï¼ŒåŽ†å²éƒ½ä¼šæŸ¥å‡ºæ¥ã€‚å¦å¤–æˆ‘å‘çŽ° histogram çš„ metrics è¶…è¿‡ 7 å¤©ä¹‹åŽå°±æ²¡æœ‰ä»€ä¹ˆå‚è€ƒä»·å€¼äº† æ‰€ä»¥å¯¹äºŽæŸ¥è¯¢ä¸€ä¸ªæœˆæ„Ÿè§‰æ„ä¹‰ä¸å¤§ï¼Œæ¯”å¦‚ prometheus_http_request_duration_secondsï¼Œ metrics è¿˜æ˜¯é‡åœ¨å®žæ—¶æ€§ã€‚

> Qï¼šPrometheus çš„æ•°æ®ä¸çŸ¥é“å®œä¿¡æ˜¯å¦æœ‰å­˜å‚¨ï¼Œæ˜¯å­˜åˆ° opentsdb è¿˜æ˜¯ influxdb å‘¢ï¼Ÿ

Aï¼šæœ¬åœ° +m3db

> Qï¼šprometheus å‘Šè­¦å»¶æ—¶æ¯”è¾ƒé«˜ï¼Œå¦‚æžœè¦åšåˆ°ç§’çº§å‘Šè­¦æœ‰ä»€ä¹ˆæ–¹æ¡ˆï¼è°ƒæ•´æŠ“å–é¢‘çŽ‡ä¸å¤ªé è°±

Aï¼šç›®å‰å‘Šè­¦éƒ½æ˜¯åœ¨å‡ ç§’ï¼Œä½ è¯´çš„å»¶è¿Ÿæ˜¯å¤šé•¿æ—¶é—´ï¼Ÿ

> Qï¼š è¯·é—®é’ˆå¯¹ Prometheus ä¸èƒ½ç›‘æŽ§æ—¥å¿—çš„ç‘•ç–µï¼Œæœ‰ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆå¯ä»¥å’Œ Prometheus å½¢æˆäº’è¡¥å‘¢ï¼Ÿ

Aï¼šå…¬å¸è‡ªç ”äº† watchdog æ—¥å¿—é‡‡é›†ã€‚ç¤¾åŒºå¸¸ç”¨ filebeat + es+kibana æ–¹æ¡ˆ

> Qï¼šå®œä¿¡ç›®å‰ç”¨ Prometheus ç›‘æŽ§äº†å¤šå°‘ä¸ªæœåŠ¡ target äº†ï¼ŸPrometheus ä½¿ç”¨çš„èµ„æºå¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿ

Aï¼šå®œä¿¡æ­£åœ¨ä»Ž zabbix è¿ç§»åˆ° prometheusï¼Œç›®å‰æ˜¯ä¸‰å°ç‰©ç†æœºã€‚

> Qï¼šm3db æ•°æ®å­˜å‚¨æœ‰æ²¡æœ‰æ”¾å¤§ï¼Ÿç›¸å¯¹ prometheus çš„ tsdbï¼Œæœ‰ å¤§æ¦‚æœ‰å¤šå°‘å€ï¼Ÿ

Aï¼šæ”¾å¤§æ˜¯å•¥æ„æ€ï¼Ÿæ¯”å¦‚ä¸€å¤©çš„æ•°æ® pro çš„ tsdb å­˜å‚¨æ˜¯å¤šå°‘ gï¼Œé€šè¿‡è¿œç¨‹å­˜å‚¨ï¼Œå°±ä¼šæ”¾å¤§å‡ åå€ï¼Œæ¯”å¦‚ 100 ä¸ªå˜æˆ 1t

> Qï¼šè¯·é—®åº”ç”¨è¿›ç¨‹ http æŽ¥å£çš„æ€§èƒ½ç›‘æŽ§æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šæœ‰ java å’Œ goã€Python çš„ sdk

> Qï¼šæ€Žä¹ˆè¿‡æ»¤æŽ‰ä¸éœ€è¦çš„ metrics?é€šè¿‡ prom

Aï¼šè¿™ä¸ªå¯ä»¥åœ¨ pro é…ç½®é‡Œé¢ drop

> Qï¼šæœ¬åœ°å­˜å‚¨ç”¨æ¥åšæŸ¥è¯¢å—ï¼Ÿå¤šä¸ª prometheus æ˜¯å¦‚ä½•ç»Ÿä¸€æŸ¥è¯¢çš„ï¼Ÿæ•°æ®éƒ½å­˜åœ¨æ±‡èšçš„ prometheus ä¸Šå—

Aï¼š

> Qï¼šæ€Žä¹ˆå®žçŽ° tsdb åŽ†å²æ•°æ®ä¿å­˜åˆ°åˆ«çš„åœ°æ–¹çš„ï¼Ÿé€šè¿‡ä»€ä¹ˆæŠ€æœ¯æ–¹å¼åˆ†å¼€çš„ï¼Ÿ

Aï¼šremote write read

> Qï¼šæ—¶åºæ•°æ®åº“è·Ÿä¼ ç»Ÿæ•°æ®åº“çš„ä¼˜åŠ¿åœ¨å“ªï¼Ÿåº”è¯¥å¦‚ä½•è¿›è¡Œé€‰åž‹ï¼Ÿ

Aï¼šæ—¶åºæ•°æ®æ˜¯ä¿å­˜éšæ—¶é—´å˜åŒ–çš„é‡ï¼ŒæŸ¥è¯¢ä¹Ÿæ˜¯æ—¶é—´ç»´åº¦ï¼Œä»Žè€Œå®žçŽ°é«˜åŽ‹ç¼©æ¯”ã€‚å…³ç³»åž‹æ•°æ®æœ‰äº‹åœ¨äºŽæ•°æ®ç®¡ç†ã€‚

> Qï¼šè¯·é—® m3db èƒ½ä¸èƒ½æ»¡è¶³ ha prometheus çš„æ•°æ®åŽ»é‡ï¼Ÿè¿˜æ˜¯å­˜ä¸¤ä»½ï¼Ÿ

Aï¼šm3db ä¸éœ€è¦å­˜ä¸¤ä»½

> Qï¼šæ¯”å¦‚è¦åšæ¯æ—¥ç”¨æˆ·ç™»å½•æ•°ç»Ÿè®¡ï¼Œå…·ä½“åº”è¯¥æ€Žä¹ˆåšï¼Ÿéœ€è¦å“ªäº›æµç¨‹å’Œæ­¥éª¤ï¼Ÿ

Aï¼šéœ€è¦ç¨‹åºé‡Œé¢é›†æˆ sdkï¼Œå¹¶æä¾›æŸ¥è¯¢ç´¯è®¡ç™»å½•ç”¨æˆ·çš„ http æŽ¥å£ï¼Œå¹¶åœ¨ prometheus é…ç½®è¿™ä¸ª targetã€‚

> Qï¼š é€‰åž‹çš„æ—¶å€™ä¸ºä»€ä¹ˆé€‰æ‹© m3ï¼Ÿæ²¡è€ƒè™‘å…¶ä»–è¿œç¨‹å­˜å‚¨å—ï¼Œæ˜¯æœ‰ä»€ä¹ˆè€ƒè™‘ã€‚è¿œç¨‹å­˜å‚¨ä½ ä»¬åªæ˜¯ç”¨æ¥å¤‡ä»½ä¸€ä»½å—è¿˜æ˜¯ä¹Ÿä¼šä¸€èµ·ä»Žè¿œç¨‹è¯»æ•°æ®ï¼Ÿä¹‹å‰è¿œç¨‹è¯»çš„æ€§èƒ½æ¯”è¾ƒçƒ‚ï¼Œç›®å‰ prom æ–°ç‰ˆæœ¬çš„ stream è¿œç¨‹è¯»ä½ ä»¬æœ‰è¯•éªŒå—

---

### 2019-09-19ï¼šäº‘åŽŸç”Ÿå¯è§‚å¯Ÿæ€§ä¹‹æ—¥å¿—ç®¡ç†

[æé—®é“¾æŽ¥](https://shimo.im/docs/KWJqTyw9Q3pqPDcv)

> Qï¼šfluentd bit åœ¨æ”¶é›†çš„å®¹å™¨ pod ä¸­ å¯ç”¨ fluentd.io/parser é€‰é¡¹ é‡‡ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œå‘çŽ°ä¸€ä¸ªæ­£åˆ™å¾ˆéš¾è¯•ç”¨å…¨éƒ¨åœºæ™¯ï¼Œè€Œä¸”å‘çŽ°åŒ¹é…ä¸åˆ°æ—¥å¿—å†…å®¹çš„æ—¶å€™ èŠ‚ç‚¹ä¼š hung ä½ å†é‡å¯ä¼šæ— æ³•å¯åŠ¨ ä¸€ç›´æŠ¥ 404 å¯åŠ¨ä¸äº† è¯·é—®è¿™ä¸ªå¦‚ä½•è§£å†³çš„

Aï¼š è¿™ä¸ªé—®é¢˜å¯ä»¥ç»™ fluentbit æ issueã€‚KubeSphere ç›®å‰åªç”¨åˆ° Parser æ’ä»¶çš„ Decordersï¼Œä¸»è¦æ˜¯ç”¨ fluentbit æ·»åŠ /åˆ é™¤/ä¿®æ”¹æ—¥å¿—æŽ¥æ”¶è€…ï¼Œä¹Ÿä¼šè¿›è¡Œä¸€äº›æ—¥å¿—çš„è¿‡æ»¤

> Qï¼šå¦‚ä½• debug Prometheus

Aï¼šå¦‚æžœæ‚¨æ˜¯è¦å‚ä¸Ž Prometheus çš„å¼€å‘ï¼Œå¯ä»¥å‚è€ƒ Prometheus Github çš„å¼€å‘æŒ‡å—ã€‚å¦‚æžœæ˜¯ä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜å¯ä»¥ç»“åˆæ—¥å¿—ï¼Œæˆ–è€…æŸ¥çœ‹ Prometheus Console UI æœ‰ä¸€äº›ç›´è§‚çš„å¼‚å¸¸æç¤ºï¼Œåˆ° Prometheus ç¤¾åŒº slack æˆ– Google group è¯·æ•™ã€‚

> Qï¼šLoki ä½ ä»¬åœ¨ç”Ÿäº§ä¸Šæœ‰ç”¨åˆ°å—ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆæœ€ä½³å®žè·µï¼Ÿ

Aï¼š æˆ‘ä»¬æ­£åœ¨è°ƒç ” Lokiï¼ŒGrafana Labs å·²ç»ç”¨ loki æä¾›æ—¥å¿—æœåŠ¡äº†ã€‚ä»–ä»¬çš„éƒ¨ç½²æ–¹å¼å‚è€ƒ [ksonnet](https://github.com/grafana/loki/tree/master/production/ksonnet) ã€‚å»ºè®®å°±æ˜¯å‡ ä¸ªç»„ä»¶è¦åˆ†å¼€éƒ¨ç½²ï¼Œæ¯ä¸ªç»„ä»¶å¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ä»¥å®žçŽ°é«˜å¯ç”¨ï¼›å¦å¤–å°±æ˜¯æ ¹æ®æƒ…å†µé€‰æ‹© index å’Œ chunk åˆ†åˆ«ä½¿ç”¨é€‚åˆçš„å­˜å‚¨ã€‚

> Qï¼šè¯·é—®ä¸€ä¸‹ï¼Œç”¨æˆ·æƒ³è‡ªå®šä¹‰æ—¥å¿—è§£æžï¼Œå¦‚ä½•å®žçŽ°ï¼Ÿç›®å‰æˆ‘ä»¬å®žçŽ°æ–¹å¼æ˜¯ fluentd parser ä½œä¸º agent ä»¥ deamonset çš„æ–¹å¼éƒ¨ç½²åˆ° k8s çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä¸€è¾¹æ”¶é›†ä¸€è¾¹è§£æžï¼Œç¼ºç‚¹æ˜¯å ç”¨èŠ‚ç‚¹èµ„æºå¤ªå¤šï¼Œè¯·é—®å’‹ä»¬è¿™è¾¹å¦‚ä½•å®žçŽ°çš„å‘¢ï¼Ÿ

Aï¼šæ”¶é›†æ—¥å¿—çš„ agent æœ€å¥½ç”¨æ¯”è¾ƒè½»é‡ä¸€ç‚¹çš„æ¯”å¦‚ fluentbitï¼Œå¯ä»¥æŠŠ fluentd ä½œä¸º fluentbit çš„æŽ¥æ”¶è€…ï¼Œç”¨ fluentd å®žçŽ°é›†ä¸­çš„è§£æžåŽå†å‘åˆ°æœ€ç»ˆçš„å­˜å‚¨ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯ä¸ªèŠ‚ç‚¹åŽ»éƒ¨ç½² fluentd äº†ã€‚ç±»ä¼¼è¿™æ ·çš„æž¶æž„

![](https://p.k8s.li/1575857978783.png)

> Qï¼šè¯·é—®ä¸€ä¸‹ï¼Œå•å°æ—¥å¿—é‡å¤šå°‘ï¼Ÿ

Aï¼šè¿™ä¸ªä¸å¤ªå¥½è¯´ï¼Œçœ‹å·¥ä½œè´Ÿè½½è¾“å‡ºæ—¥å¿—çš„æƒ…å†µã€‚

> Qï¼šæ—¥å¿—å±•ç¤ºï¼Ÿ æ˜¯ kibana è¿˜æ˜¯è‡ªå·±å•ç‹¬

Aï¼šæ—¥å¿—å±•ç¤º KubeSphere æ²¡ç”¨ kibanaï¼Œæ˜¯æˆ‘ä»¬è‡ªå·±å¼€å‘çš„æ—¥å¿— console

> Qï¼šæŽ¥ Q4ï¼Œè°¢è°¢æ‚¨çš„ç­”ç–‘ï¼Œç›®å‰æˆ‘ä»¬æƒ³çš„æ˜¯ç”¨æˆ·è‡ªå®šä¹‰è§£æžç­–ç•¥ä¸ç”¨é€šçŸ¥ä»»ä½•äººï¼Œæ—¥å¿—å°±å¯ä»¥ä»¥æµçš„æ–¹å¼è¾“å‡ºåˆ° es æˆ–è€…å…¶å®ƒç»ˆç«¯ï¼Œç›®å‰çš„é—®é¢˜å°±æ˜¯å¦‚æžœç”¨ fluentd è§£æž å¦‚æžœæ·»åŠ ä¸€ä¸ªè§£æžè§„åˆ™å°±è¦ä¿®æ”¹ fluentd çš„é…ç½® å°±è¦é‡å¯ä¸‹ è¿™äº›æ„Ÿè§‰å¾ˆä¸å¥½ï¼Œè¯·é—®è¿™è¾¹æœ‰ä»€ä¹ˆå»ºè®®å—ï¼Ÿä¹‹æ‰€ä»¥ç”¨ fluentd bit è§£æžå°±æ˜¯å› ä¸ºå¯ä»¥åœ¨ pod ä¸Šç”¨ annotation è‡ªå®šä¹‰ fluentd.io parser è§£æžç­–ç•¥

Aï¼šå¦‚æžœæƒ³æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰è‡ªå·±çš„è§£æžæ–¹å¼ï¼Œè€Œä¸”ä¸æƒ³é¢‘ç¹é‡å¯çš„è¯ï¼Œ å¹¶ä¸”æƒ³ç”¨ä¸€ä¸ªæ¯”è¾ƒè½»é‡çš„ agent çš„è¯ å¯ä»¥è¯•è¯• filebeatï¼Œfilebeat æœ‰è‡ªåŠ¨åŠ è½½é…ç½®çš„åŠŸèƒ½ï¼Œè§£æžæ—¥å¿—ä¹Ÿæ¯”è¾ƒå¼ºå¤§ã€‚

> Qï¼šKubeSphere çš„æ—¥å¿—ç³»ç»Ÿçœ‹èµ·æ¥å¾ˆæ¼‚äº®å•Šï¼Œä¹Ÿæ˜¯å¼€æºçš„å§

Aï¼šç›®å‰åŽç«¯æ˜¯å¼€æºçš„ï¼Œå‰ç«¯ä¹Ÿå³å°†å¼€æºã€‚ç›®å‰çš„æ‰€æœ‰ç‰ˆæœ¬éƒ½æ˜¯å…è´¹å®‰è£…å¯ç”¨çš„ã€‚å®‰è£…ä¸‹è½½é“¾æŽ¥ï¼š[kubesphere.io/zh-CN/install](https://kubesphere.io/zh-CN/install/)

> Qï¼šKubeSphere çš„æ—¥å¿—åœ¨å¤šé›†ç¾¤è®¾è®¡ä¸Šæ˜¯ä¼šç”¨ Thanos åŽ»å®žçŽ°å—ï¼Ÿä¼˜ç‚¹æ˜¯ä»€ä¹ˆ

Aï¼šThanos é€‚ç”¨äºŽç›‘æŽ§çš„å¤šé›†ç¾¤å®žçŽ°ï¼Œå¯ç”¨å®žçŽ°å¤šä¸ª Prometheus çš„å…¨å±€æŸ¥è¯¢ã€‚æ—¥å¿—å¤šé›†ç¾¤çš„è¯ç”¨ es å®žçŽ°çš„è¯ Elasticsearch è¾ƒæ–°ç‰ˆæœ¬æ”¯æŒçš„ã€‚[modules-cross-cluster-search](https://www.elastic.co/guide/en/elasticsearch/reference/6.8/modules-cross-cluster-search.html)

> Qï¼šfluent å’Œ filebeat æœ‰åšè¿‡åŽ‹æµ‹å—ï¼Ÿè¿˜æ˜¯å› ä¸º fluentd æ˜¯ cncf çš„é¡¹ç›®æ‰é€‰æ‹©è¿™ä¸ªçš„ï¼Ÿ

Aï¼šruby ä¹Ÿæœ‰ GIL é”ï¼Œåªèƒ½åŽ‹æ¦¨å•æ ¸æ€§èƒ½ã€‚é€‰æ‹© fluentbit ä¸»è¦æ˜¯å› ä¸ºå†…å­˜å ç”¨å°‘ã€‚filebeat ä¹Ÿå¾ˆæµè¡Œï¼Œgo å†™çš„ï¼Œå†…å­˜å ç”¨æ®æˆ‘è¯´çŸ¥ä¼šæ¯” fluentbit å¤šä¸€äº›ã€‚fluentbit æ˜¯å®Œå…¨ç”¨ C å†™çš„ï¼Œä¸æ˜¯ç”¨ rubyã€‚Fluentd æ ¸å¿ƒç”¨çš„ cï¼Œæ’ä»¶ç”¨çš„ ruby

> Qï¼šä¸åŒæœåŠ¡çš„æ—¥å¿—éƒ½æ˜¯æ··åœ¨ä¸€èµ·çš„ï¼Ÿè€Œä¸æ˜¯ä¸åŒçš„ indexï¼Ÿå®¹å™¨å†…çš„æ—¥å¿—æ€Žä¹ˆé‡‡é›†å‘¢ï¼Ÿ

Aï¼šç›®å‰æ˜¯ä¸åŒæœåŠ¡çš„æ—¥å¿—æ¯å¤©ä¸€ä¸ª indexï¼Œå¦‚æžœæƒ³ä¸åŒ index çš„è¯åº”è¯¥è¦ç”¨ filter åŠ  tag å®žçŽ°ã€‚å®¹å™¨å†…æ²¡æœ‰è¾“å‡ºåˆ° stdout è½ç›˜çš„æ—¥å¿—å¯ä»¥ç”¨åœ¨å®¹å™¨å†…æ·»åŠ  sidecar çš„æ–¹å¼å°†è½ç›˜æ—¥å¿—è½¬å‘åˆ° stdoutã€‚kubesphere 2.1 å³å°†å‘å¸ƒï¼Œè‡ªå¸¦äº†æ”¶é›†è½ç›˜æ—¥å¿— sidecar è‡ªåŠ¨æ³¨å…¥çš„åŠŸèƒ½

> Qï¼šæ ‡å‡†è¾“å‡ºï¼Œæ•°æ®å›žè½ç›˜å—ï¼Ÿæ€Žä¹ˆæ¸…ç†ï¼Ÿ

Aï¼šæ ‡å‡†è¾“å‡ºï¼Œæ—¥å¿—ä¸ä¼šè½åˆ°å®¹å™¨å†…æŒ‚è½½çš„ç›˜ï¼Œä½†æ˜¯ä¼šè½åˆ°å®¹å™¨æ‰€åœ¨çš„èŠ‚ç‚¹çš„ç›˜ä¸Šï¼Œé€šå¸¸è¿™ä¸ªèŠ‚ç‚¹çš„å®¹å™¨æ—¥å¿—ä¼šæœ‰ rotation è®¾ç½®ï¼Œå®šæœŸæ¸…ç†

---

### 2019-09-19ï¼šå½“ K8s é›†ç¾¤è¾¾åˆ°ä¸‡çº§è§„æ¨¡ï¼Œé˜¿é‡Œå·´å·´å¦‚ä½•è§£å†³ç³»ç»Ÿå„ç»„ä»¶æ€§èƒ½é—®é¢˜ï¼Ÿ

[æé—®é“¾æŽ¥](https://shimo.im/docs/6KwX3CR3yRHWdtYV)

> Qï¼šcalico ç½‘ç»œä¸­ï¼Œå¦‚æžœèŠ‚ç‚¹è·¨ä¸‰å±‚ï¼Œè·¯ç”±å™¨ä¸æ”¯æŒ BGPï¼ŒRR åŒæ­¥å¦‚ä½•å®žçŽ°ï¼Ÿ

Aï¼šè¿™ä¸ªä¸æ¸…æ¥šã€‚

> Qï¼šç”±äºŽèŠ‚ç‚¹ IOï¼Œç½‘ç»œï¼Œè´Ÿè½½è¿‡é«˜ç­‰é—®é¢˜ï¼Œetcd é¢‘ç¹é€‰ä¸»ï¼Œå¯¼è‡´ kube-apiserver æ–¹å‘è¶…æ—¶ã€‚å¦‚ä½•åº”å¯¹è¿™ç§é—®é¢˜ï¼Ÿ

Aï¼šæœ€é‡è¦çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸º etcd é…ç½®ç›¸å¯¹ç¨³å®šçš„èµ„æºï¼ŒCPU/Mem è§†é›†ç¾¤è§„æ¨¡è€Œå®šï¼ŒDisk æœ€å¥½æ˜¯ SSDï¼Œå› ä¸º disk io æ€§èƒ½å¯¹ etcd å†™æ€§èƒ½å½±å“å·¨å¤§ã€‚æˆ‘ä»¬éœ€è¦æ£€æŸ¥ etcd heartbeat timeout å’Œ election timeoutï¼Œæ˜¯å¦é€‚åˆå½“å‰é›†ç¾¤çš„çŽ¯å¢ƒã€‚å¦‚æžœæœ‰æ¡ä»¶ï¼Œå»ºè®®å¤§å®¶èƒ½åŽ»å®žè·µ etcd 3.4ï¼Œpre-vote çš„å¼•å…¥èƒ½æœ‰æ•ˆå‡å°å¼‚å¸¸æƒ…å½¢ä¸‹çš„æŠ–åŠ¨ã€‚æ­¤å¤–ï¼Œä»Šå¤©ä¹Ÿç»™å¤§å®¶æåˆ°äº† kube-apiserver å±‚é¢çš„ä¼˜åŒ–ï¼Œé€šè¿‡åœ¨ kube-apiserver cache ä¸Šå®žçŽ° linearizable readï¼Œé¿å…å¤§é‡çš„è¯»è¯·æ±‚æ‰“åˆ° etcdï¼Œä»Žè€Œå¯ä»¥å¤§å¹…é™ä½Ž kubernetes é›†ç¾¤ä¸­ etcd çš„åŽ‹åŠ›ã€‚

> Qï¼šå½“é›†ç¾¤éœ€è¦è¿›è¡Œç‰ˆæœ¬å‡çº§æ—¶ï¼Œk8s å„ç»„ä»¶åº”è¯¥æ€Žä¹ˆæ“ä½œã€‚éœ€è¦éµå¾ªé¡ºåºå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ

Aï¼šä¸€èˆ¬éµå¾ªå…ˆå‡çº§ Serverï¼Œå†å‡çº§ Client çš„åšæ³•ã€‚å¯¹ kubernetes æ¥è¯´ï¼Œå…ˆå‡çº§ kube-apiserverï¼Œå†å‡çº§ controllersï¼Œæœ€åŽç°åº¦å‡çº§ kubeletã€‚å…ˆå‡çº§ kube-apiserver çš„åŽŸå› æ˜¯ server æ˜¯å¯¹å¤–æä¾›æœåŠ¡ï¼ˆæŽ¥å£)çš„ï¼Œkubernetes éµå¾ªå‘å‰å…¼å®¹ä¸¤ä¸ªç‰ˆæœ¬çš„æœºåˆ¶ï¼Œç¡®ä¿é›†ç¾¤çš„å…¼å®¹æ€§ï¼Œæœ€åŽå‡çº§ kubelet æ˜¯å› ä¸ºåœ¨èŠ‚ç‚¹æ•°éžå¸¸å¤šçš„æƒ…å†µä¸‹ï¼Œkubelet çš„å‡çº§éœ€è¦ä¸€ä¸ªè¾ƒé•¿çš„è§‚å¯Ÿå‘¨æœŸåŽ»ç°åº¦ã€‚åŒæ—¶æé†’å¤§å®¶ï¼Œä¸€å®šè¦æ³¨æ„ kubelet å‡çº§å¯¹èŠ‚ç‚¹ä¸Šè¿è¡Œå®¹å™¨çš„å½±å“ã€‚

> Qï¼šåœ¨ etcd é‡Œé¢æœ‰ä¸‰ä¸ª Instanceï¼Œæ¯”å¦‚å‘ç”Ÿäº†ä»¥ä¸‹åœºæ™¯:A ä½œä¸º leaderï¼ŒB å’Œ C ä½œä¸º followerï¼Œè¿™æ—¶å€™ç”¨æˆ·é€šè¿‡ curl æŒ‡ä»¤å‘é€äº†ä¸€ä¸ª Put æ“ä½œï¼ŒA æ”¶åˆ°åŽé€šçŸ¥äº† B å’Œ Cï¼Œç„¶åŽ Bï¼ŒC å›žäº† response,è¿™ä¸ªæ—¶å€™ A æäº¤æ—¥å¿—åˆ°çŠ¶æ€æœºï¼Œç„¶åŽå›žå¤ç»™ç”¨æˆ·ï¼Œä½†åœ¨å›žå¤ç”¨æˆ·çš„è¿‡ç¨‹ä¸­æŒ‚æŽ‰äº†ã€‚è¿™æ—¶å€™å‡è®¾ç”¨æˆ·ä¸å†å‘èµ·è¯·æ±‚ï¼Œä½† B å’Œ C é€‰å‡ºä¸»æœºåŽä¼šæäº¤è¯¥æ—¥å¿—ï¼Œä¹Ÿå°±è¯´ç”¨æˆ·è®¤ä¸ºå¤±è´¥äº†ï¼Œä½† etcd å†…éƒ¨å·²ç»æäº¤äº†è¯¥æ“ä½œã€‚è¿™ç§æƒ…å†µä¸‹ etcd æ˜¯æ€Žä¹ˆå¤„ç†çš„ï¼Ÿ

Aï¼šè¿™ç§æƒ…å†µåªæ˜¯å‘Šè¯‰ç”¨æˆ·è¶…æ—¶äº†ï¼ˆç»“æžœæœªçŸ¥)ï¼Œå¹¶æœªå‘Šè¯‰ç”¨æˆ·ä½ çš„è¯·æ±‚æˆåŠŸæˆ–è€…å¤±è´¥äº†ï¼ˆç»“æžœå·²çŸ¥)ã€‚ç†è§£äº†åˆ†å¸ƒå¼ç³»ç»Ÿè°ƒç”¨çš„ä¸‰æ€ï¼Œç”¨æˆ·ç³»ç»Ÿä¸ºäº†ç¡®ä¿æ­£ç¡®æ€§ï¼Œå¯ä»¥é€‰æ‹©é‡è¯•æˆ–è€…å…¶ä»–çš„æ–¹å¼ç¡®è®¤è‡ªèº«çŠ¶æ€çš„æŽ¨è¿›ã€‚

> Qï¼šèƒ½å¦è®²è§£ä»¥ä¸‹ etcd çš„å¹‚ç­‰æ€§çš„å®žçŽ°ï¼Ÿ

Aï¼šå¹‚ç­‰ç®€å•ç†è§£å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªæ“ä½œä¸ä¼šç ´åç³»ç»Ÿçš„æ­£ç¡®æ€§ï¼Œå…¸åž‹çš„ put key value æ“ä½œæ˜¯å¹‚ç­‰çš„ï¼Œdelete key ä¹Ÿæ˜¯å¹‚ç­‰çš„ï¼Œå› ä¸ºè¿™ä¸ä¼šç ´åç³»ç»Ÿçš„æ•°æ®çŠ¶æ€ã€‚è¯•æƒ³ä¸€ä¸‹å¦‚æžœæä¾›ä¸€ä¸ªæ“ä½œå«åš inc key å¯¹ key åš +1 æ“ä½œï¼ˆæ¯”å¦‚ redis æä¾›äº†ç±»ä¼¼çš„æ“ä½œ)ï¼Œç”¨æˆ·å¾ˆéš¾â€œæ­£ç¡®â€çš„ä½¿ç”¨è¯¥ API æž„å»ºæ­£ç¡®ã€ä¸€è‡´çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å½“ç„¶å¹¶ä¸æ˜¯è¯´ redis inc ä¸å¥½ï¼Œå®ƒå¯ä»¥å¾ˆå¥½çš„åº”ç”¨äºŽæŸä¸€äº›å¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼Œä¸€ä¸ªå…¸åž‹çš„ä¾‹å­æ˜¯ç»Ÿè®¡å¾®åšçš„ç‚¹èµžæ¬¡æ•°ã€‚

> Qï¼šetcdctl åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­ get ä¸€ä¸ªä¸å­˜åœ¨çš„ key çš„æ—¶å€™ä¸ºä»€ä¹ˆä¸è¿”å›ž key not found äº†ï¼ˆæ ‡å‡†è¾“å‡ºä¸­)ï¼Œæ²¡æœ‰ä»»ä½•çš„æç¤ºå’Œè¿”å›žï¼Œç‰ˆæœ¬ 3.5ã€‚

Aï¼šå› ä¸ºçœŸå®žè¯­æ„å®žé™…ä¸Šæ˜¯ä¸€ä¸ª range æ“ä½œï¼Œæ—¢ç„¶æ˜¯ rangeï¼Œå½“ç„¶ä¸å­˜åœ¨ key not found çš„é”™è¯¯äº†ï¼Œå¦‚æžœéœ€è¦å¯ä»¥æ ¹æ®è¿”å›žçš„æ¡ç›®ç¡®å®šç»“æžœã€‚

> Qï¼šåœ¨ 3.3etcd ä¸­æœ‰ä¸€ä¸ª etcd å¤„äºŽæ•…éšœçŠ¶æ€ï¼Œé›†ç¾¤ api æš‚æ—¶ä¸å¯ç”¨è¿™ä¸ªé—®é¢˜é™¤äº†å‡çº§ etcd è¿˜æœ‰å…¶ä½™è§£å†³æ–¹æ¡ˆå˜›

Aï¼šç”Ÿäº§çŽ¯å¢ƒä¸€å®šè¦é…ç½®å®šæœŸçš„æ•°æ®å¤‡ä»½ç­–ç•¥ï¼Œç”¨äºŽæžç«¯æƒ…å†µä¸‹çš„é›†ç¾¤æ¢å¤ã€‚å½“ç„¶å¯¹äºŽè¶…è¿‡ quorum èŠ‚ç‚¹ï¼Œç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥æ‰©å±•æ”¯æŒ â€œä¸å®‰å…¨â€ çš„ member è°ƒæ•´æ–¹æ¡ˆï¼Œç”¨äºŽæœ€å¤§å¯èƒ½çš„æ¢å¤æœ€è¿‘çš„æ•°æ®ï¼Œæ¬¢è¿Žåˆ°ç¤¾åŒºå‘èµ·ç±»ä¼¼ issue çš„è®¨è®ºï¼Œæˆ–è®¸å®ƒå°±ä¼šæˆä¸ºæˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªå¢žå¼ºã€‚

> Qï¼šObjects æ˜¯ä»€ä¹ˆå‘¢

Aï¼šæŒ‡ kubernetes ä¸­çš„ pod/node/configmap ç­‰èµ„æºå¯¹è±¡

> Qï¼šèƒ½ä¸èƒ½æ•´ç†å‡ºä¸‰ä¸ªä¸œè¥¿ï¼šåè¯åˆ—è¡¨ã€é—®é¢˜åœºæ™¯ã€è§£å†³åŠžæ³•å›¾è§£ç‰ˆ ðŸ˜ƒðŸ‘

Aï¼šæ•¬è¯·æœŸå¾…

> Qï¼škubelet å‡çº§å¯¹èŠ‚ç‚¹ä¸Šè¿è¡Œå®¹å™¨çš„å½±å“å¤§è‡´æœ‰å“ªäº›å‘¢ï¼Ÿ

Aï¼šæ¯”å¦‚å›  spechash çš„å…¼å®¹æ€§é—®é¢˜å¯¼è‡´å®¹å™¨è¢«æ„å¤–é‡å¯

> Qï¼šä¸ºä»€ä¹ˆ acs ä¸Š node èŠ‚ç‚¹çš„æœ€å¤§ pod æ•°é‡æ˜¯ 110ï¼Œå’Œæ€§èƒ½æœ‰å…³ç³»å—ï¼Ÿé˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ä¸æ˜¯ acs å—ï¼Ÿ

Aï¼šacsï¼Ÿè¿˜æ˜¯ ackï¼Œå¤§è§„æ¨¡çš„ ack é›†ç¾¤ä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œéžå¸¸æ¬¢è¿Žæå·¥å•éªšæ‰°

> Qï¼šetcd é›†ç¾¤çš„ dbsize çš„å­˜å‚¨ç©ºé—´å’Œ pod ç­‰æ•°é‡æ˜¯æ­£æ¯”å¢žé•¿å—ï¼Ÿæˆ‘ä»¬ä¸€ä¸ªé›†ç¾¤ 400 ä¸ª pod db ç«Ÿç„¶è¾¾åˆ° 2Gï¼Œæ„Ÿè§‰ä¸æ­£å¸¸ï¼Œå¦å¤–ä¸€ä¸ªé›†ç¾¤æ‰å‡ å Mï¼Ÿ

Aï¼šä¹Ÿå’Œå•ä¸ª pod çš„æ•°æ®é‡å¤§å°ï¼Œetcd compaction ç­–ç•¥æœ‰å…³ç³»ï¼Œetcd ä¼šå‚¨å­˜æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ã€‚ä¸€èˆ¬ä»Žç»éªŒä¸Šï¼Œ400 pod 2G æ˜¯ä¸å¤ªæ­£å¸¸çš„ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨å…¶ä»–ç”¨æˆ·æ•°æ®ï¼ˆæ¯”å¦‚è¶…å¤§çš„ configmap)ï¼Œç¡®è®¤ compaction æ­£å¸¸å·¥ä½œã€‚

> Qï¼šk8s çš„è°ƒåº¦æ—¶å»¶éƒ½å’Œä»€ä¹ˆæœ‰å…³ç³»ï¼Ÿ

Aï¼šå’Œé›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°é‡ï¼ŒèŠ‚ç‚¹çš„ label æ•°é‡å’Œ affinity/anti-affinity å¤æ‚æ€§ï¼Œä»¥åŠé›†ç¾¤çš„èµ„æºç©ºé—²å±‚åº¦æœ‰å…³ç³»ã€‚å‰ä¸¤è€…æ¯”è¾ƒå¥½ç†è§£ï¼Œæœ€åŽä¸€ä¸ªæ˜¯å› ä¸ºå¯¹äºŽä¸€ä¸ªèµ„æºåˆ†é…è¾ƒæ»¡çš„é›†ç¾¤ï¼Œä»Žä¸­æ‰¾åˆ°å¯ä»¥å®¹çº³å¾…è°ƒåº¦çš„èŠ‚ç‚¹éœ€è¦æ›´å¤šçš„å°è¯•æ¬¡æ•°ã€‚

> Qï¼šç›®å‰æ‚¨è®²åˆ°çš„ç‰¹æ€§ä¸­æœ‰æ˜¯å¦æœ‰è´¡çŒ®ç»™ç¤¾åŒºçš„? å¦‚æžœæœ‰çš„è¯,èƒ½ç®€å•è¯´è¯´å—?

Aï¼šetcd å¢žå¼ºå·²ç»å›žé¦ˆç¤¾åŒºå¹¶ä¸”åœ¨ etcd 3.4 ä¸­å‘å¸ƒï¼Œkubernetes bookmark å·²ç»å‘å¸ƒåˆ° 1.15,åŽç»­ç‰ˆæœ¬è¯·ä¿æŒå…³æ³¨ã€‚æˆ‘ä»¬çš„ç­–ç•¥æ˜¯å°½æœ€å¤§çš„åŠªåŠ›å›žé¦ˆåˆ°ç¤¾åŒºä¸­ï¼Œè¯·å¤§å®¶æ”¾å¿ƒã€‚

> Qï¼šè¯·é—®åœ¨ k8s ä¸­ï¼Œé‡åˆ°åŒä¸€ä¸ªæŽ¥å£å¯¹æ•°æ®åº“æŸ¥è¯¢æ—¶å¿«æ—¶æ…¢ï¼Œç„¶åŽæ•´ä¸ªç³»ç»Ÿä¸­æœ‰å¾ˆå¤šåº”ç”¨éƒ½å‡ºçŽ°æ—¶å¿«æ—¶æ…¢çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µä¸‹æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ³•åŽ»å®šä½é—®é¢˜å—ï¼Ÿæ„Ÿè§‰é—®é¢˜ä¸»è¦åœ¨ statefulset çš„æ€§èƒ½ï¼Œå’Œ k8s å†…éƒ¨ç½‘ç»œä¸Šï¼Œä½†æ˜¯å´æ²¡æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ³•åŽ»å®šä½.

Aï¼šä¸æ˜¯ç‰¹åˆ«æ˜Žç™½ä½ çš„é—®é¢˜ã€‚

> Qï¼šå¯¹äºŽä¸€ä¸ª JAVA åº”ç”¨çš„ pod çš„èµ„æºé™åˆ¶æœ‰ä»€ä¹ˆå¥½çš„ç»éªŒï¼Ÿä¸çŸ¥é“åˆ°åº•åº”è¯¥é™åˆ¶å¤šå°‘åˆé€‚ï¼Ÿ

Aï¼šè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¯é¢˜ï¼ˆVPA)ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¾å®½ resource limit æ¥è§‚å¯Ÿåº”ç”¨å®žé™…çš„è¿è¡Œæƒ…å†µï¼Œå¹¶é€šè¿‡å®žé™…ç»éªŒæ¥åˆ¤æ–­åº”è¯¥é‡‡ç”¨å¤šå°‘çš„ request å€¼ã€‚

> Qï¼šå¦‚æžœ kube-apiserver/kube-controller-manager/kube-scheduler æ˜¯ static pod å½¢å¼éƒ¨ç½²çš„ï¼Œé‚£å¯¹è¿™äº› pod åšèµ„æºé¢„ç•™çš„æ–¹å¼ï¼Œé™¤äº† request/limit è¿˜æœ‰å…¶ä»–æ–¹æ³•å—ï¼Ÿ

Aï¼šä¸€èˆ¬å»ºè®®éš”ç¦» control planes èŠ‚ç‚¹ä¸Žå…¶ä»– worker èŠ‚ç‚¹ï¼Œé¿å…è¿ç»´ä¸Šçš„é£Žé™©ã€‚å¦‚æžœä¸€å®šè¦è¿™ä¹ˆåšï¼Œç›®å‰æ²¡æœ‰å¥½çš„æ–¹æ³•æ¥ç¡®ä¿ä»–ä»¬ã€‚

> Qï¼šé’ˆå¯¹ etcd é›†ç¾¤ï¼Œå¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ç›‘æŽ§ï¼Œé˜¿é‡Œäº‘é‡‡ç”¨ä»€ä¹ˆçš„æ–¹æ¡ˆç›‘æŽ§é›†ç¾¤çš„ cpu å’Œç½‘ç»œæµé‡ç­‰ï¼Œå¦‚æžœå•èŠ‚ç‚¹å†²é«˜ï¼Œæœ‰ä»€ä¹ˆé¢„è­¦å’ŒæŽ’æŸ¥æ€è·¯å—ï¼Ÿ

Aï¼šé˜¿é‡Œäº‘ä¸€èˆ¬é‡‡ç”¨ kubernetes on kubernetes çš„æ–¹æ¡ˆï¼Œç”¨æˆ·çš„ kubernetes é›†ç¾¤éƒ¨ç½²åœ¨ä¸€ä¸ªå«åšç®¡æŽ§çš„ kubernetes é›†ç¾¤ä¹‹ä¸Šï¼Œå› æ­¤ç”¨æˆ·é›†ç¾¤ä¸Šåº”ç”¨çš„ç›‘æŽ§é‡‡ç”¨å…¸åž‹çš„ Prometheus çš„æ–¹æ¡ˆå³å¯ã€‚kubernetes åˆ° etcd æµé‡ä¸å‡è¡¡é—®é¢˜ï¼Œå¯¼è‡´å•ä¸ª etcd æµé‡åé«˜ï¼Œå®žé™…ä¸Šæˆ‘ä»¬å·²ç»åšäº†ä¿®å¤æ–¹æ¡ˆï¼Œè¿™ä¸€å—å¤§å®¶ä¹Ÿå¯ä»¥å…³æ³¨ etcd 3.4 ä¸­çš„ load balancer æœºåˆ¶ã€‚

> Qï¼šèƒ½å¦å†å¤šä»‹ç»ä¸€äº› apiserver ä¸Šå®žçŽ°

linearizable read ä»¥åŠé€šè¿‡ cache å®žçŽ°çš„å¯¹å®¢æˆ·ç«¯æŸ¥è¯¢çš„ä¼˜åŒ–é‚£éƒ¨åˆ†ã€‚2.etcdã€API serverã€Controller åŠè°ƒåº¦å™¨ä¼˜åŒ–å®žä¾‹

---

### 2019-09-03ï¼šåŸºäºŽ Kubernetes çš„ DevOps å¹³å°å®žæˆ˜

[æé—®é“¾æŽ¥](https://shimo.im/docs/vjw3P6rD8pyGJXqQ)

> Qï¼šè¯·é—®è€å¸ˆæ˜¯é€šè¿‡ Jenkinsfile æ¥æŽ§åˆ¶ç‰ˆæœ¬ç®¡ç†å—ï¼Œæ˜¯å¦ä½¿ç”¨äº† jenkins libraryï¼Œå¤šä¸ªçŽ¯å¢ƒçš„æƒ…å†µä¸‹ï¼Œæ˜¯éƒ¨ç½²ä¸€ä¸ª Jenkins masterï¼Œè¿˜æ˜¯æ¯ä¸ª K8s é›†ç¾¤éƒ½å¸¦æœ‰ä¸€ä¸ª jenkins masterï¼Ÿ

Aï¼šjenkinsfile å®žçŽ°æ•´ä¸ª CICD æµç¨‹ï¼Œä½¿ç”¨ git å¯¹ jenkinsfile ä»£ç è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼›ç›®å‰æ²¡æœ‰ä½¿ç”¨ jenkins libraryï¼Œä½†æ˜¯ jenkins library çš„æ–¹å¼æ­£åœ¨é‡å†™è¿‡ç¨‹ä¸­ï¼Œè¿˜æ²¡æœ‰å®Œæˆï¼›å¤šçŽ¯å¢ƒçš„å®žçŽ°æ˜¯åªåœ¨ä¸€ä¸ªé›†ç¾¤éƒ¨ç½²ä¸€å¥— jenkins master+jenkins agentï¼Œä¸åŒçš„çŽ¯å¢ƒé€šè¿‡ä¸åŒ agent å®žçŽ°

> Qï¼šæˆ‘æƒ³çŸ¥é“è¿™ä¸ªåˆ†äº«æœ‰ä»€ä¹ˆç”¨ï¼Ÿæ–‡å­—ç›´æ’­ï¼Ÿ

Aï¼šè¿™ä¸ªæˆ‘æ¥ç­”ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ²¡ç”¨å¯ä»¥ä¸çœ‹ï¼Œæ²¡æœ‰å¼ºåˆ¶è¦æ±‚ã€‚

> Qï¼šæ¯ä¸ª jenkins çš„ job é‡Œå†™ä¸€ä¸ª jenkinsfile çš„ repoï¼Ÿè¿™æ ·æ˜¯ä¸æ˜¯å¤ªæµªè´¹äº†ã€‚æ¯ä¸ª repo å°±ä¸€ä¸ª jenkinsfile æ–‡ä»¶ï¼ˆå¤šçŽ¯å¢ƒå¯èƒ½æœ‰å¤šä¸ªåˆ†æ”¯)ã€‚æˆ‘ä»¬æ˜¯ç›´æŽ¥å†™æˆäº† jenkinsfile æ¨¡æ¿ï¼Œç„¶åŽ jenkins æž„å»ºå‚æ•°ä¼ å…¥çš„ã€‚ä¸çŸ¥é“è€å¸ˆæ˜¯å¦‚ä½•æƒè¡¡çš„

Aï¼šä¸æ˜¯çš„ï¼Œæ‰€æœ‰ job ä½¿ç”¨ä¸€ä¸ª jenkiJenkinsnsfileã€‚æ¯ä¸ª job å°±æ˜¯ä¼ é€’ä¸€äº›åŸºç¡€å‚æ•°ï¼Œå¤§å¤šæ•°é…å¦‚ç¼–è¯‘å‘½ä»¤ï¼Œéƒ¨ç½²é…ç½®ç­‰ï¼Œéƒ½æ˜¯åœ¨ devops å¹³å°å…ˆè¡Œé…ç½®å¥½ä¹‹åŽï¼Œè§¦å‘ job æž„å»ºä¹‹åŽä»Ž devops æ‹‰å–å‚æ•°é…ç½®)

> Qï¼šä¸ºä»€ä¹ˆæ‹‰å–ä»£ç åŽå°±è¦è¿›è¡Œ Sonar ä»£ç æ‰«æå‘¢ï¼Ÿç ”å‘çš„ä»£ç éƒ½æ²¡æœ‰é›†æˆç¼–è¯‘éªŒè¯ï¼Œæ‰«æä»£ç æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ

Aï¼šä¸æ˜¯æ‹‰å–ä»£ç å‰è¿›è¡Œçš„æ‰«æï¼Œæ˜¯æ‹‰å–ä»£ç å®ŒæˆåŽè¿›è¡Œçš„æ‰«æã€‚æ–¹ä¾¿å¯¹æŽ¥å¤šè¯­è¨€ã€‚è¿™ä¸ªçœ‹å–èˆçš„ï¼Œæˆ‘ä»¬å› ä¸ºæ¶‰åŠè¯­è¨€ç§ç±»æ¯”è¾ƒå¤šï¼Œä¸å¤ªå®¹æ˜“é¡¾å…¨æ‰€æœ‰çš„è¯­è¨€ï¼Œè€Œä¸”å‰æœŸæˆ‘ä»¬ php è¯­è¨€çš„ä¸šåŠ¡è¾ƒå¤šã€‚

> Qï¼šä½ ä»¬ç”Ÿäº§çŽ¯å¢ƒä¹Ÿå…³é—­é˜²ç«å¢™äº†å—ï¼Ÿä¸ç”¨é˜²ç«å¢™å—ï¼Ÿè¿˜æ˜¯ä½ ä»¬ç”¨çš„å…¶ä»–çš„å®‰å…¨æŽªæ–½

Aï¼šæˆ‘ä»¬ç”Ÿäº§çŽ¯å¢ƒé˜²ç«å¢™æ˜¯å…³é—­çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å…¬æœ‰äº‘çŽ¯å¢ƒï¼Œç­–ç•¥éƒ½æ˜¯é€šè¿‡å…¬æœ‰äº‘å®‰å…¨ç»„å®žçŽ°çš„ã€‚

> Qï¼šåŒ ansible é›†æˆé‚£éƒ¨åˆ†æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿä¸­é—´æ¶‰åŠåˆ°ä¼ å‚æ•°ï¼Œä¾‹å¦‚ IP åœ°å€ï¼Œç«¯å£å·ï¼ŒæœåŠ¡åç§°ï¼Œæ˜¯é€šè¿‡ä»€ä¹ˆæŽ§åˆ¶çš„ï¼Ÿ

Aï¼šåŸºç¡€çŽ¯å¢ƒä¿¡æ¯ï¼Œéƒ½åœ¨ inventory é‡Œç»´æŠ¤ã€‚å…¶ä»–çš„ä¸€äº›å‚æ•°æ”¾åœ¨ä¸€ä¸ª group_vars ä¸­

> Qï¼šnode èŠ‚ç‚¹ä½¿ç”¨çš„æ˜¯åŠ¨æ€ token è¿˜æ˜¯ apiserver å†…ç½®çš„é™æ€çš„ token è¿›è¡Œ bootstrap çš„ï¼Ÿ

Aï¼šåŠ¨æ€ tokenï¼Œä¸åœ¨ apiserver çš„é…ç½®é‡ŒæŒ‡å®š token.csv

> Qï¼šä½ ä»¬ master èŠ‚ç‚¹å’Œ node èŠ‚ç‚¹éƒ½éƒ¨ç½²äº†å¤šå°‘å°

Aï¼šmaster èŠ‚ç‚¹ 3 å°ï¼Œ16c64G çš„ã€‚node æœ‰ 600 å°ï¼Œé…ç½®ç§ç±»æ¯”è¾ƒå¤š

> Qï¼šèƒ½å¦æä¾›ä¸€ä¸‹ä½ ä»¬åŸºäºŽ pipeline çš„ jenkinsfile ç¤ºä¾‹ï¼Ÿ

Aï¼šè¿™ä¸ªå› ä¸ºæ¶‰åŠå…¬å¸éšç§ï¼Œä¸æ–¹ä¾¿æä¾›ã€‚ä½†æ˜¯åŽæœŸåŸºäºŽ jenkins library çš„ä»£ç å®ŒæˆåŽï¼Œä¼šè¿›è¡Œå¼€æºï¼Œè¯·åŽç»­å…³æ³¨ã€‚

> Qï¼šknative å’Œ istio çŽ°åœ¨æœªæ¥å‰æ™¯å’‹æ ·ï¼Œå›½å†…æœ‰ç”¨åˆ°ç”Ÿäº§ä¸ŠåŽ»çš„å—ï¼Ÿ

Aï¼šæˆ‘ä»¬æš‚æ—¶è¿˜æ²¡æœ‰ä½¿ç”¨åˆ°ç”Ÿäº§ä¸ŠåŽ»ï¼Œåªæ˜¯è°ƒç ”é˜¶æ®µ

> Qï¼š600 ä¸ª node calico ç”¨çš„åå°„æ¨¡å¼è¿˜æ˜¯ node mesh?æœ‰åš pod å¸¦å®½é™åˆ¶ä¹ˆï¼Œè°¢è°¢ï¼

Aï¼šnode-meshï¼Œç›®å‰æ²¡æœ‰å¯¹å¸¦å®½åšä»»ä½•é™åˆ¶ï¼Œcalico ä¹Ÿé‡åˆ°äº†ä¸å°‘å‘ï¼Œæš‚æ—¶ä¹Ÿæ²¡ç²¾åŠ›è¿›ä¸€æ­¥çš„ä½¿ç”¨åŠŸèƒ½

> Qï¼šæ„Ÿè°¢è€å¸ˆåˆ†äº«ã€‚æƒ³è¯·é—®ä¸‹æ‚¨ä»¬çš„è¿ç»´å›¢é˜Ÿæ˜¯æ€Žä¹ˆé…ç½®çš„ï¼Œè°¢è°¢ï¼Ÿï¼

Aï¼šæˆ‘ä»¬åˆ†ä¸šåŠ¡è¿ç»´ã€ç³»ç»Ÿè¿ç»´ã€dba

> Qï¼šJenkinsfile ä½¿ç”¨æ–‡æ¡£è¾ƒå°‘ï¼Œå¯ä»¥æä¾›åœ¨æ­¤é‡åˆ°çš„å‘åˆ—ä¸¾å‡ ä¸ªå…¸åž‹å—ï¼Ÿè°¢è°¢ï¼

Aï¼šä½¿ç”¨çš„è¯ï¼Œå¯ä»¥åŽ»å‚è€ƒæœ‰ä¸€æœ¬ groovy çš„ä¹¦ã€‚é‡åˆ°çš„å‘çš„è¯ï¼Œå¤§å¤šæ•°æ˜¯ CI/CD é€»è¾‘çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªå®¹å™¨è¿è¡Œç”¨æˆ·çš„é…ç½®ï¼Œå®žé™…ä¸šåŠ¡åœºæ™¯ä¸­æœ‰ä½¿ç”¨ root çš„ï¼Œæœ‰ä½¿ç”¨æ™®é€šç”¨æˆ·çš„ï¼Œè¿˜ä¼šé’ˆå¯¹ä¸åŒçš„çŽ¯å¢ƒé€‚é…ä¸åŒçš„ç”¨æˆ·é…ç½®ï¼Œé€»è¾‘å¤„ç†å‡ºé”™å°±ä¼šå¯¼è‡´å®žé™…éƒ¨ç½²åŽï¼Œpod è¿è¡Œå¼‚å¸¸ã€‚

> Qï¼šè¯·é—® ä¸»æœºç³»ç»Ÿåˆå§‹åŒ– è¿™ä¸€å—å¯¹ç³»ç»Ÿçš„å‘è¡Œç‰ˆå’Œå†…æ ¸ç‰ˆæœ¬æœ‰ä»€ä¹ˆè¦æ±‚å’Œå»ºè®®ï¼Ÿçœ‹åˆ°ä¸€äº› docker çš„é—®é¢˜æ˜¯å› ä¸ºç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬å¤ªä½Ž ï¼ˆ3.10 å†…æ ¸ kmem account æ³„æ¼ bugs å¯¼è‡´èŠ‚ç‚¹ NotReady)ï¼Œè¯·é—®ä½ ä»¬æ˜¯å¦‚ä½•é€‰æ‹©çš„ï¼Ÿ

Aï¼šç›®å‰ä»…æ”¯æŒ Redhatã€CentOSï¼Œå†…æ ¸ç‰ˆæœ¬æ˜¯ 3.10,æ²¡æœ‰è¿›è¡Œå‡çº§ã€‚ä»¥æˆ‘ä»¬é›†ç¾¤è¿è¡Œè¿™ä¹ˆé•¿æ—¶é—´çœ‹ï¼Œè™½ç„¶æœ‰ NotReady çŽ°è±¡ï¼Œä½†æ˜¯æ¦‚çŽ‡æ¯”è¾ƒå°ï¼Œå›ºæ²¡å¯¹è€ƒè™‘å¯¹å†…æ ¸å‡çº§

> Qï¼š è¯·é—®ä¸‹é›†ç¾¤è§„æ¨¡æ˜¯æ€Žä¹ˆæ ·çš„ï¼Œnode èŠ‚ç‚¹æ˜¯æ€Žä¹ˆåšèµ„æºä¿æŠ¤çš„ï¼Ÿ

Aï¼šç›®å‰ 600 ä¸ª node èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç›®å‰æ˜¯ç›‘æŽ§æ•´ä½“é›†ç¾¤æ°´ä½ï¼Œåœ¨è¾¾åˆ° 60% å·¦å³å°±ä¼šå¯¹é›†ç¾¤è¿›è¡Œæ‰©å®¹

> Qï¼šå¦‚ä½•å®žçŽ°ç°åº¦å‘å¸ƒä»¥åŠè“ç»¿éƒ¨ç½²

Aï¼šåŸºäºŽingress å®žçŽ°çš„ï¼Œéƒ¨åˆ†æ˜¯ä½¿ç”¨å…¬æœ‰äº‘çš„è´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡ api å®žçŽ°åˆ‡æ¢

> Qï¼š ç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„ gitlab-ci-runner éƒ¨ç½²äºŽ k8s ä¹‹å¤–å®žçŽ° ci/cdã€‚å‘çŽ° gitlab-ci åœ¨å®žé™…ä½¿ç”¨ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°å¡æ­»æŠ¥é”™ã€‚è¯·é—®ä¸‹ï¼Œç›¸æ¯” jenkins åš ci/cd æ˜¯ä¼šæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œä¹‹å‰å¹¶æ²¡æœ‰ä½¿ç”¨è¿‡ jenkins.

Aï¼šgitlab-ci ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰ä½¿ç”¨ï¼Œæˆ‘ä»¬è°ƒç ”çš„ç»“æžœæ˜¯ 1ã€æœ‰ä¾µå…¥æ€§ 2ã€pipeline åŠŸèƒ½è¾ƒå¼±ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯é‡åˆ°é”™è¯¯å¥½åƒè¿˜å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚jenkins é‡åˆ°é”™è¯¯ä¼šä¸­æ–­æµç¨‹ã€‚

> Qï¼šåŸºäºŽ kubeadm+calicoï¼Œç©ºé—²æ—¶ CPU å ç”¨è¾¾åˆ° 30-40% æ˜¯å¦æ­£å¸¸ï¼Ÿ

Aï¼šå®žé™…ä½¿ç”¨ä¸­æ²¡æœ‰ä½¿ç”¨è¿‡ kubeadm éƒ¨ç½²ï¼Œå› ä¸ºå°è£…ä¸œè¥¿å¤ªå¤šï¼Œä¸æ˜“äºŽæŽ’æŸ¥é—®é¢˜ã€‚ç©ºé—²æ—¶ cpu åˆ° 30-40ï¼Œéœ€è¦å…·ä½“æƒ…å†µåˆ†æžã€‚

> Qï¼š600 ä¸ª node èŠ‚ç‚¹éƒ½é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Œ æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„ï¼Ÿ

Aï¼šå‰æœŸç½‘ç»œä¸Šé‡åˆ°çš„é—®é¢˜æ¯”è¾ƒå¤šï¼Œè¿˜åŒ…å« calico bugã€‚åŽé¢å¤šæ•°æ˜¯ä¸€äº›ä¸šåŠ¡ä½¿ç”¨ä¸Šå¯¼è‡´çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸šåŠ¡å¢žé‡ä¹‹åŽå¼•å‘çš„å„ç§é—®é¢˜ã€‚

> Qï¼šè¯·é—®æ˜¯æ€Žä¹ˆé…ç½®çš„å¤šä¸ªä¸åŒåŠŸèƒ½çš„ jenkins-slave pod çš„è¿˜æœ‰ jenkins-slave é•œåƒæ€Žä¹ˆåšçš„ï¼Œè¿˜æœ‰ä¸€ä¸ªä»»åŠ¡ä¸­æœ‰å‘å¸ƒå’Œå›žæ»šæ€Žä¹ˆåšå‘¢ï¼Œè€å¸ˆçš„ cicd äººå·¥å¹²é¢„çš„åœ°æ–¹åœ¨å“ªé‡Œ?

Aï¼šjenkins-slave é•œåƒå®žé™…å°±æ˜¯æŠŠ jenkins çš„ agent.jar è¿è¡Œåœ¨å®¹å™¨ä¸­ã€‚å‘å¸ƒå°±å¦‚åŒå‰é¢æ‰€è®²ã€‚å›žæ»šæœ€ç»ˆæ˜¯è°ƒç”¨ helm rollbackã€‚cicd äººå·¥å¹²é¢„çš„è¯éƒ½æ˜¯é€šè¿‡é…ç½®é¡¹æ¥æŽ§åˆ¶çš„ã€‚

> Qï¼šå®¹å™¨ web åº”ç”¨ï¼Œæœ‰æ²¡æœ‰åšå®‰å…¨é˜²æŠ¤å‘¢ æœ‰é‡åˆ°ç”¨æˆ·æ¶æ„æ¨¡æ‹Ÿ XFFï¼Œé¢‘ç¹è®¿é—®æŽ¥å£ä¹ˆ?

Aï¼šè¿™ä¸ªæˆ‘ä»¬æ˜¯åœ¨å…¥å£åŽ»åšçš„ï¼Œå› ä¸ºä½¿ç”¨çš„å…¬æœ‰äº‘ï¼Œç›´æŽ¥å°±ä¸Šäº† wafã€å„ç§å®‰å…¨äº§å“ã€‚

> Qï¼š k8s çš„ç¼–æŽ’èµ„æºæ˜¯æ€Žä¹ˆå¼„åˆ° cmdb ä¸Šçš„--anonymous-auth=false è®¾ç½®åŽï¼Œliveness è®¿é—®æŠ¥ 401 é”™è¯¯ï¼Œæˆ‘ Kube-apiserver åœ¨ä¸åœé‡å¯ï¼Œè¿™ä¸ªéœ€è¦æ€Žä¹ˆé…ç½®ï¼Ÿç”¨ insecure ip å’Œ port,æœ‰ä¸ç¬¦åˆå®‰å…¨è¦æ±‚ã€‚

Aï¼šè¿™ä¸ªæ˜¯æ²¡æœ‰é€šè¿‡éªŒè¯ï¼Œè¦ç¡®è®¤è¯ä¹¦æˆ–è€…ç›¸å…³é…ç½®ï¼Œå…·ä½“çš„é…ç½®å¯ä»¥å‚è€ƒæˆ‘çš„æ–‡æ¡£ [kubernetes é«˜å¯ç”¨é›†ç¾¤ä¹‹äºŒè¿›åˆ¶éƒ¨ç½²](https://github.com/k8sre/docs/blob/master/kubernetes/kubernetes%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E4%B9%8B%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2.md)

---

### 2019-08-29ï¼šPorterï¼šé¢å‘è£¸é‡‘å±žçŽ¯å¢ƒçš„ Kubernetes çš„å¼€æºè´Ÿè½½å‡è¡¡å™¨

[æé—®é“¾æŽ¥](https://shimo.im/docs/wG6tjHJyQDGgDTQK)

> Q1ï¼šPorter å’Œ calico æœ‰å•¥åŒºåˆ«ï¼Œç®€å•äº†çœ‹äº†ä¸‹éƒ½æ˜¯ç”¨çš„ BGP

Aï¼šPorter æ˜¯ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œè€Œ calico æ˜¯ CNI æ’ä»¶ï¼Œç”¨é€”ä¸ä¸€æ ·ã€‚

> Q2ï¼športer æœ‰æ²¡æœ‰ç«žå“ï¼Ÿ

Aï¼šæœ‰ä¸€ä¸ª metallbï¼Œä»¥åŠåŸºäºŽ F5 çš„è´Ÿè½½å‡è¡¡å™¨æ’ä»¶

> Q3ï¼šleaf èŠ‚ç‚¹æ˜¯ä¸æ˜¯ä¹Ÿéœ€è¦éƒ¨ç½²æœåŠ¡?

Aï¼šä¸éœ€è¦ï¼Œåªéœ€è¦å¼€å¯ BGP å°±å¯ä»¥äº†

> Q5ï¼šå…¬å¸æœåŠ¡å™¨å°±åå°å·¦å³ï¼Œéƒ¨ç½²çš„ Node èŠ‚ç‚¹ä¹Ÿæ¯”è¾ƒå°‘ï¼Œç½‘ç»œæ–¹æ¡ˆä½¿ç”¨é™æ€è·¯ç”±æ˜¯ä¸æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Ÿå°±æ˜¯ç›´æŽ¥åœ¨ä¸Šçº§è·¯ç”±å™¨ä¸Šæ·»åŠ  pod çš„è·¯ç”±è§„åˆ™ã€‚æ€§èƒ½æ–¹é¢æ˜¯ä¸æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Ÿ

Aï¼špod ä¼šæœ‰æ¼‚ç§»æƒ…å†µçš„å‘ç”Ÿï¼Œæ‰‹åŠ¨æ›´æ–°ä¸€æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼ŒäºŒæ˜¯å»¶è¿Ÿè¾ƒå¤§ã€‚é™æ€é…ç½®è·¯ç”±ç›¸æ¯”äºŽå¼€å¯ BGP çš„è·¯ç”±å™¨æ€§èƒ½ä¸Šä¼šæœ‰ä¸€ç‚¹ä¼˜åŠ¿ï¼Œä½†æ˜¯åœ¨ pod æ¼‚ç§»åˆ°æ‰‹åŠ¨æ›´æ–°è·¯ç”±ä¸­é—´ï¼Œå¯èƒ½ä¼šå‡ºçŽ°æœåŠ¡ä¸­æ–­ï¼Œå¦‚æžœèƒ½æ‰¿å—åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„

---

### 2019-08-27ï¼šeBay Kubernetes é›†ç¾¤çš„å­˜å‚¨å®žè·µ

[æé—®é“¾æŽ¥](https://shimo.im/docs/dJ6Gccp3JrdrCtrP)

> Qï¼šåˆ†å¸ƒå¼æ•°æ®åº“ä¾‹å¦‚ MongoDB åœ¨ k8s ä¸Šæœ‰å®žçŽ°æ–¹æ¡ˆå—?

Aï¼šæœ‰çš„ï¼Œæˆ‘ä»¬å†…éƒ¨ NoSQL å°±æ˜¯å®Œå…¨è¿è¡Œåœ¨å®¹å™¨äº‘ä¸Šçš„ï¼Œpod éƒ¨ç½²ç”±åº”ç”¨è‡ªå·±ç®¡ç†ï¼Œé€šè¿‡ svc æš´éœ²æœåŠ¡ï¼Œå­˜å‚¨ä¸Šä½¿ç”¨ local PVï¼Œå¹¶å®žçŽ°äº† backup restoreã€‚ç¤¾åŒºåº”è¯¥ä¹Ÿæœ‰æ¯”è¾ƒå¤šçš„å®žçŽ°å‚è€ƒã€‚

> Qï¼šç”±äºŽçŽ¯å¢ƒï¼Œå¦‚ç½‘ç»œå› ç´ ï¼Œå‡ºçŽ°çŸ­æ—¶é—´æš‚æ—¶å¤§è§„æ¨¡æŽ‰ node çš„æƒ…å†µæ€Žä¹ˆå¤„ç†ï¼Ÿ

Aï¼šå¦‚ç½‘ç»œé—®é¢˜å¯¼è‡´ node è¿žä¸é€šï¼Œå¯¹äºŽç½‘ç»œå­˜å‚¨æ¥è¯´ï¼Œéœ€è¦åœ¨ç½‘ç»œæ¢å¤ä¹‹åŽé‡è¿žï¼Œæ¯”å¦‚ cephfs kernel client å’Œ fuse éƒ½å®žçŽ°äº† reconnect

> Qï¼šetcd é›†ç¾¤ä¸­ï¼Œv2 å’Œæ•°æ®å’Œ v3 çš„æ•°æ®å¤‡ä»½æ–¹å¼ä¸ä¸€æ ·ï¼Œå¦‚ä½•å¤‡ä»½æ•´ä¸ª etcd æ•°æ®å‘¢ï¼Ÿ

Aï¼šetcd server åªèƒ½æœ‰ä¸€ç§ç‰ˆæœ¬ï¼Œä¸ä¼šå¹¶å­˜ï¼Œæ‰€ä»¥æŒ‰ç…§å„è‡ªç‰ˆæœ¬çš„æ–¹å¼å¤‡ä»½å³å¯

> Qï¼šPVC çš„ anti affinity è°ƒåº¦ç‰¹æ€§æ˜¯ k8s åŽŸç”Ÿæ”¯æŒçš„å—ï¼Ÿè‡ªç ”æ–¹æ¡ˆæœ‰è®¡åˆ’è´¡çŒ®åˆ° k8s ä»“åº“å—ï¼Ÿ

Aï¼šä¸æ˜¯ï¼Œæˆ‘ä»¬æ˜¯åœ¨ä½¿ç”¨ MongoDB çš„è¿‡ç¨‹ä¸­ï¼Œå‘çŽ° master pod çš„ io load å¾ˆé«˜ï¼Œæ‰€ä»¥åŸºäºŽæ­¤è‡ªå·±å¼€å‘äº†è¿™ä¸ªåŠŸèƒ½ã€‚

> Qï¼šæ•°æ®å¦‚ä½•åšå®¹ç¾ï¼Ÿ

Aï¼šç½‘ç»œå­˜å‚¨è‡ªå·±æœ‰å¤š replica å’Œ rack awareness çš„åˆ†å¸ƒï¼Œæœ¬åœ°å­˜å‚¨éœ€è¦åº”ç”¨è‡ªå·±å®žçŽ°å¤šæ‹·è´ï¼Œå¯¹äºŽå¯é æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„æ•°æ®ï¼Œéœ€è¦åšå¤‡ä»½è¿˜åŽŸã€‚

> Qï¼šæœ¬åœ°å­˜å‚¨èƒ½è¯´çš„æ›´æ¸…æ¥šç‚¹ä¹ˆï¼Ÿæ¯”å¦‚ registar æ˜¯æ€Žä¹ˆæŠŠä¿¡æ¯åŒæ­¥åˆ° kubernetesnode ä¸­çš„ã€‚pv çš„åˆ é™¤æ˜¯ csi é‚£ä¸ªç»„ä»¶æ¥åšçš„ï¼Ÿä¿¡æ¯æœ‰å“ªäº›ä¿¡æ¯ã€‚è°¢è°¢ã€‚

Aï¼šregistar åœ¨æ³¨å†ŒèŠ‚ç‚¹çš„æ—¶å€™ä¼šå°† vg çš„ç›¸å…³ä¿¡æ¯ä»¥ annotation çš„æ–¹å¼å†™åˆ° node å¯¹è±¡ä¸­ï¼Œpv çš„åˆ é™¤ç”± csi-provisioner sidecar å®Œæˆï¼Œå¤§ä½“æ€è·¯å¯å‚è€ƒç¤¾åŒºçš„ design docã€‚

> Qï¼šå®¹å™¨é•œåƒå¦‚ä½•å­˜å‚¨å’Œç®¡ç†ï¼Ÿ

Aï¼šæˆ‘ä»¬ç›®å‰ç”¨çš„æ˜¯ quayï¼Œç”¨ swift å­˜å‚¨é•œåƒå±‚

> Qï¼šredis é›†ç¾¤ï¼Œ3 ä¸» 3 ä»Žè¿™ç§ï¼Œå¦‚ä½•è·‘åœ¨ k8s ä¸Š

Aï¼šå¯ä»¥ç”¨ statefulset çš„æ–¹å¼ï¼Œå…·ä½“å¯ä»¥å‚è€ƒç¤¾åŒºçš„åšæ³•

> Qï¼šä½¿ç”¨ ceph rbd ä¼šå‡ºçŽ° multiattach errorï¼Œå¯¼è‡´æ–° pod ä¸€ç›´å¤„äºŽ creating çŠ¶æ€ï¼Œéœ€è¦äººå·¥ä»‹å…¥ï¼Œæœ‰æ— è‡ªåŠ¨å¤„ç†æ–¹æ¡ˆï¼Ÿæ¯”å¦‚ï¼Œkubelet æŒ‚æŽ‰

Aï¼šå¦‚å‡ºçŽ° kubelet æŒ‚æŽ‰æˆ–è€… node hung å¯¼è‡´ kubelet ä¸å·¥ä½œï¼Œæœ‰å¯èƒ½å‡ºçŽ°è¿™ç§æƒ…å†µï¼Œéœ€è¦å®žçŽ°èŠ‚ç‚¹çš„ remediationï¼Œç›‘æŽ§è¿™äº›æƒ…å†µï¼Œé‡å¯æˆ–è€…ä¸‹æž¶èŠ‚ç‚¹ï¼Œä¿è¯åŽŸæ¥çš„è¿žæŽ¥æ–­æŽ‰ã€‚

> Qï¼šè¯·é—®æ—¥å¿—å­˜å‚¨æ˜¯åœ¨ä¸“æœ‰çš„èŠ‚ç‚¹å—ï¼Ÿå¦‚æžœä¸æ˜¯ä¼šå’Œä¸šåŠ¡æ•°æ®å­˜å‚¨äº§ç”Ÿå½±å“å—ï¼Ÿç©ºé—´å ç”¨,cpuï¼Œå†…å­˜æ–¹é¢çš„å½±å“ã€‚

Aï¼šæ¯ä¸ªèŠ‚ç‚¹ç»„ä»¶æœ¬èº«çš„æ—¥å¿—å’Œå®¹å™¨çš„æ—¥å¿—éƒ½æ˜¯é€šè¿‡ beats æ¥æ”¶é›†å¹¶ä¸ŠæŠ¥åˆ°ç›‘æŽ§ç³»ç»Ÿï¼Œä¸ä¼šå’Œä¸šåŠ¡æ•°æ®å†²çªæˆ–å¹²æ‰°ã€‚

> Qï¼šå­˜å‚¨é™åˆ¶æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šå¯¹äºŽ emptydirï¼Œæˆ‘ä»¬ä½¿ç”¨ xfs quota é™åˆ¶ã€‚å¯¹äºŽ PV/PVCï¼Œæˆ‘ä»¬åœ¨ controller å±‚é¢åšäº†æ¯ä¸ª namespace çš„ quota limitã€‚

> Qï¼šceph rbd å’Œæœ¬åœ°ç£ç›˜æœ‰åšè¿‡ benchmark ä¹ˆï¼Ÿcg v2 åº”è¯¥åªèƒ½é™åˆ¶æœ¬åœ°ç›˜å§ï¼Ÿ

Aï¼š![](https://p.k8s.li/1575857922468.png)

> Qï¼škernel network storage æœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„å­¦ä¹ ææ–™ï¼Ÿ

Aï¼šå…·ä½“æ˜¯å“ªç±»å­˜å‚¨ç±»åž‹ï¼Œå¯ä»¥å‚è§ [linux-device-drivers](https://www.oreilly.com/library/view/linux-device-drivers)

> Qï¼šæœ‰æ²¡æœ‰å¯èƒ½é€šè¿‡ StatfulSet å®žçŽ°åˆ†å¸ƒå¼å­˜å‚¨ï¼Ÿæ¥åšå¼‚åœ°å®¹ç¾

Aï¼šå¼‚åœ°å®¹ç¾æ˜¯ federation å±‚é¢çš„éƒ¨ç½²ï¼Œæ„Ÿè§‰å’Œç”¨å“ªç±» workload api æ²¡å¤ªå¤§å…³ç³»

> Qï¼šæœ¬åœ°å­˜å‚¨ä¸éœ€è¦å¦å¤–çš„ scheduler-extender ä¹ˆï¼Ÿç”¨åŽŸæœ‰çš„ scheduler å°±å¯ä»¥äº†ï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯ç›´æŽ¥åœ¨åŽŸæœ‰çš„ scheduler åŸºç¡€ä¸Šåšäº†ä¿®æ”¹ï¼Œå½“æ—¶è¿˜æ²¡æœ‰ extender æœºåˆ¶ï¼ŒåŽç»­ä¼šè€ƒè™‘ä»¥ extend æ–¹å¼æ”¾åˆ°å¤–éƒ¨

---

### 2019-08-20ï¼šå°å…¬å¸å¦‚ä½•ä¼˜é›…åœ°æŽ¨è¿›åº”ç”¨ä¸Š Kubernetes å®¹å™¨äº‘

[æé—®é“¾æŽ¥](https://shimo.im/docs/wrhTKPcqcp3htR6h)

> Qï¼šæœ‰çŠ¶æ€ springcloud å¾®æœåŠ¡å¦‚ä½•è¿›è¡Œç®¡ç†å’Œç‰ˆæœ¬æŽ§åˆ¶çš„ï¼Ÿ

Aï¼šå¾®æœåŠ¡å°½é‡åšåˆ°æ— çŠ¶æ€å¥½ã€‚

> Qï¼šå¦‚ä½•å¼€å‘å¾®æœåŠ¡åº”ç”¨ operator?

Aï¼šè¿™ä¸ªæˆ‘çœ‹äº†ä¸‰æ¬¡ï¼Œä¸å¤ªæ‡‚æƒ³é—®çš„é—®é¢˜æ˜¯å•¥ï¼Œæˆ‘ç†è§£å¾®æœåŠ¡åº”ç”¨ä¸Ž operatorr è²Œä¼¼æ²¡æœ‰ä»€ä¹ˆå¿…ç„¶çš„è”ç³»ã€‚

> Qï¼šGrafana ç›¸æ¯” Zabbix æœ‰å“ªäº›ä¼˜åŠ¿å’Œä¸è¶³å‘¢ï¼Ÿ

Aï¼šè¿™ä¸¤è€…æ˜¯äº’è¡¥çš„ï¼Œåº”è¯¥æ˜¯é—®æ™®ç½—ç±³ä¿®æ–¯å§ã€‚

> Qï¼šhelm å¦‚ä½•è½åœ°ï¼Ÿæ˜¯å¦æœ‰æ–¹æ¡ˆå¼€å‘æ›¿ä»£çš„ç³»ç»Ÿå®Œæˆç‰ˆæœ¬ç®¡ç†åŠŸèƒ½ï¼Ÿ

Aï¼šæš‚æ—¶æ²¡æœ‰ä½¿ç”¨ helmï¼Œå…¬å¸ä½¿ç”¨ç‰ˆæœ¬ç®¡ç†æ˜¯é€šè¿‡è°ƒç”¨å®˜æ–¹ API æŽ¥å£æ¥å®žçŽ°æ›´æ–°ã€å›žæ»šã€é‡å¯ç­‰æ“ä½œã€‚

> Q5ï¼šä½ ä»¬éƒ¨ç½² k8s åº”ç”¨  æ˜¯æœ‰ç”¨åˆ°é€šç”¨çš„ yaml æ¨¡æ¿ç»“åˆ helm ä½¿ç”¨å˜› ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œä½¿ç”¨é€šç”¨çš„ yaml æ¨¡æ¿ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä½¿ç”¨ helmã€‚é¦–å…ˆå†è¿ç»´å¹³å°ç½‘é¡µä¸Šé…ç½®ç›¸å…³å‚æ•°ï¼Œå‘å¸ƒæ—¶å€™ä¼ å…¥å˜é‡å€¼ï¼Œä¾‹å¦‚å¯åŠ¨å‚æ•°ã€é•œåƒåœ°å€ã€ç­‰ç”Ÿæˆ yaml é…ç½®ï¼Œç„¶åŽé€šè¿‡ API æ–¹å¼è°ƒç”¨æ¥å®žçŽ°éƒ¨ç½²åº”ç”¨ã€‚

> Qï¼špromethues server åŽç«¯å­˜å‚¨ tsdb é«˜å¯ç”¨æœ‰åšä¹ˆ promethues server èµ·äº†å¤šä¸ªä¹ˆ ï¼Ÿæœ‰é‡åˆ°è¿‡ server ä¼šå¶å°”æŒ‚æŽ‰ä¹ˆ

Aï¼šæ²¡æœ‰åšé«˜å¯ç”¨ï¼Œserver ç«¯ä¸»åŠ¨æŒ‚æƒ…å†µå¹¶æ²¡æœ‰å‡ºçŽ°ï¼Œæ£€æŸ¥ä¸‹æ—¥å¿—çœ‹çœ‹æ˜¯å¦æœ‰æŠ¥é”™ã€‚

> Qï¼šè¯·é—®ä»Žè™šæ‹Ÿæœºæ­£å¼çŽ¯å¢ƒè¿ç§»åˆ° k8s æ­£å¼çŽ¯å¢ƒï¼Œéœ€è¦åšäº›ä»€ä¹ˆå‡†å¤‡ï¼Œè¿ç§»è¿‡ç¨‹ä¼šä¸ä¼šä¸­æ–­ä¸šåŠ¡ï¼Œæ•°æ®åº“å¦‚ä½•åˆ‡æ¢

Aï¼šä¸éœ€è¦ä¸­æ–­ä»»åŠ¡ï¼Œåº”ç”¨éƒ¨ç½²åŽéªŒè¯æ²¡æœ‰é—®é¢˜æ‰åˆ‡æ¢è´Ÿè½½ï¼Œæ•°æ®åº“å…¶å®žä¸éœ€è¦åšå•¥æ“ä½œï¼Œé™¤éžä½ æ˜¯é—®æ•°æ®åº“ä¸Šå®¹å™¨çš„è¯ï¼Œæ•°æ®åº“è¿™å—æš‚æ—¶è¿˜æ²¡æœ‰è¿ç§»ä¸ŠåŽ»ã€‚

> Qï¼šå‰ç«¯å’ŒåŽç«¯æ˜¯ä¸æ˜¯æ”¹é€ å®Œå…¨åˆ†ç¦»çš„ï¼Œæœ‰æ²¡æœ‰è€¦åˆåœ¨ä¸€èµ·çš„é¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®èƒ½ç”¨ingress å—

Aï¼šå¤§éƒ¨åˆ†é¡¹ç›®å‰åŽç«¯åˆ†ç¦»ï¼Œè€¦åˆä¸€èµ·çš„ä¹Ÿèƒ½ç”¨ï¼Œå…³é”®å¦‚ä½•åšå¥½è½¬å‘ï¼ŒçŽ°åœ¨é€»è¾‘ä¸Šæ˜¯ SLB--> è´Ÿè½½å±‚-->ingress->-service-->pod

> Qï¼šå¼€å‘çŽ¯å¢ƒä¸­éœ€è¦æä¾›ç»™å¼€å‘ä½¿ç”¨çš„ä¸€äº›æœ‰çŠ¶æ€çš„å…¬å…±æœåŠ¡ï¼Œåœ¨ k8sï¼Œç½‘ç»œéƒ¨åˆ†å¦‚ä½•å¤„ç†ï¼Œå¦‚æ³¨å†Œåœ¨ zookeeper çš„æœåŠ¡ç­‰ç­‰ï¼Ÿ

Aï¼šå®¹å™¨å¤–è®¿é—®å®¹å™¨å†…é‡‡å–è·¯ç”±è·³è½¬ï¼Œæš‚æ—¶é€šè¿‡ node èŠ‚ç‚¹ç½‘ç»œè½¬å‘ï¼Œè¿™å—åŽç»§éœ€è¦ä¼˜åŒ–ã€‚å®¹å™¨å†…è®¿é—®å®¹å™¨å¤–çš„ï¼Œå¯ä»¥åŸºäºŽå†…ç½‘ DNS é…ç½®å…¬å…±æœåŠ¡åœ°å€å³å¯ã€‚

> Qï¼šç”Ÿäº§éƒ¨ç½²äºŒè¿›åˆ¶è¿˜æ˜¯ kubeadmï¼Ÿ

Aï¼šå¼€å‘ã€æµ‹è¯•ã€é¢„å‘å¸ƒã€ç”Ÿäº§çŽ¯å¢ƒéƒ½æ˜¯ä½¿ç”¨äºŒè¿›åˆ¶å®‰è£…ï¼Œä¸»è¦åŸºäºŽ ansible å‰§æœ¬å®‰è£…ï¼Œåªéœ€è¦ä¿®æ”¹éƒ¨åˆ†åœ°å€å˜é‡ï¼ˆä¾‹å¦‚ vipã€etcd åœ°å€ç­‰)å³å¯

> Qï¼šè‡ªå»ºçš„ k8s é›†ç¾¤ï¼Œå½“ node èŠ‚ç‚¹èµ„æºä¸è¶³æ—¶ï¼Œä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•åšè‡ªåŠ¨æ‰©å±• node èŠ‚ç‚¹çš„ï¼Ÿ

Aï¼šè¿˜æ²¡æœ‰å®žçŽ°è‡ªåŠ¨æ‰©å®¹ï¼Œæš‚æ—¶æä¾›ç½‘é¡µç‰ˆæ‰©å®¹æ–¹æ¡ˆï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸‹ä¸€æ­¥éœ€è¦å®žçŽ°çš„åŠŸèƒ½ä¹‹ä¸€ã€‚

> Qï¼šè€å¸ˆä½ ä»¬å…¬å¸æœ‰åšè“ç»¿å‘å¸ƒæˆ–é‡‘ä¸é›€éƒ¨ç½²å—ï¼Ÿåœ¨å®¹å™¨äº‘å¹³å°ä¸Šæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼åŽ»å®žçŽ°çš„ï¼Ÿ

Aï¼šé‡‘ä¸é›€éƒ¨ç½²åŠŸèƒ½å·²æä¾›ï¼Œå®¹å™¨è¿™å—æš‚æ—¶è¿˜æ²¡æœ‰å¼€æ”¾å‡ºåŽ»ï¼Œè·‘åœ¨åŽŸæ¥æœåŠ¡å™¨çš„å·²å¼€å‘ï¼Œä¸è¿‡å…¬å¸æœ‰ç‚¹ç‰¹æ®Šï¼Œé‡‘ä¸é›€æš‚æ—¶åªå¼€æ”¾ç»™æµ‹è¯•äººå‘˜æµ‹è¯•ä½¿ç”¨ã€‚ã€æ–¹å¼ä»¥ä¸‹ä¸¤ç§ï¼šaã€ä¸åŒçš„å…¥å£ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥é€šè¿‡åˆ‡æ¢ hostsã€‚bã€æµè§ˆå™¨è®¾ç½® header å‚æ•°å³å¯ï¼Œè´Ÿè½½å±‚ä¼šåˆ¤æ–­æ¥æºå®žçŽ°ä¸åŒè½¬å‘ã€‚

> Qï¼šå¹³æ—¶è¿™ä¹ˆå¤šå¾®æœåŠ¡çš„ yml æ–‡ä»¶æ˜¯å¦‚ä½•ç®¡ç†çš„ï¼Ÿé€šè¿‡ä»€ä¹ˆæ–¹å¼ç¼–è¾‘å’Œä¿®æ”¹

Aï¼šæ–‡ä»¶å…¶å®žæ˜¯ä¸å­˜åœ¨çš„ï¼Œæ˜¯ç›´æŽ¥è„šæœ¬ç”Ÿæˆ yaml æ•°æ®ï¼Œé€šè¿‡ api è°ƒç”¨ï¼Œpython è„šæœ¬ä¼šå†™å¥½åŸºæœ¬å˜é‡ï¼Œåªéœ€è¦ä¼ å€¼å³å¯ï¼Œè„šæœ¬æˆªå–éƒ¨åˆ†ä½ åº”è¯¥èƒ½çœ‹æ˜Žç™½ã€‚

![](https://p.k8s.li/1575858093193.png)

> Qï¼šå¬è¯´ä½ ä»¬æ±‡æ¡”ç½‘å¤§è£å‘˜å•Šï¼è¿˜æœ‰å‡ ä¸ªè¿ç»´ï¼Ÿï¼Ÿ

Aï¼š çŽ°åœ¨è¿ç»´ 1 ä¸ª

> Qï¼šä¸€ä¸ªå¾®æœåŠ¡ yml æ–‡ä»¶æ˜¯ deployment å’Œ svc é…ç½®ä¸€èµ·ï¼Œè¿˜æ˜¯åˆ†å¼€çš„ 2 ä¸ªæ–‡ä»¶ï¼Ÿ

Aï¼šæ–‡ä»¶å…¶å®žæ˜¯ä¸å­˜åœ¨çš„ï¼Œæ˜¯ç›´æŽ¥è„šæœ¬ç”Ÿæˆ yaml æ•°æ®ï¼Œé€šè¿‡ api è°ƒç”¨ã€‚

> Qï¼šetcd çœ‹åˆ° v2 çš„æ•°æ®å’Œ v3 çš„æ•°æ®å¤‡ä»½æ–¹å¼ä¸ä¸€æ ·ã€‚å¦‚ä½•ä¸€èµ·å¤‡ä»½ï¼Ÿæ˜¯ç›´æŽ¥æ‹·è´ä»»æ„èŠ‚ç‚¹çš„æ•°æ®æ–‡ä»¶å¤‡ä»½å°±è¡Œäº†ä¹ˆï¼Ÿ

Aï¼šå¤‡ä»½éœ€è¦äº†è§£ç½‘ç»œå’Œ pod æ•°æ®å­˜æ”¾åœ¨ v2 è¿˜æ˜¯ v3ï¼Œæ˜Žç™½äº†å°±å¯ä»¥ç¡®å®šé‚£äº›éœ€è¦å¤‡ä»½äº†ï¼Œå®¹å™¨çš„ IP å¯¹ä¸šåŠ¡åº”è¯¥æ¥è¯´æ˜¯ä¸å½±å“çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç½‘ç»œåœ°å€å˜æ›´åŽï¼Œä¸šåŠ¡è¿˜æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œã€‚

> Qï¼šç½‘ç»œç”¨çš„ canal è¿˜æ˜¯ flannelï¼Ÿæœ‰æµ‹è¯•è¿‡æ€§èƒ½ä¹ˆã€‚èƒ½å¦æ»¡è¶³éœ€æ±‚ï¼Ÿ

Aï¼šç½‘ç»œä½¿ç”¨ flannelï¼Œæµ‹è¯•è¿‡æš‚æ—¶æ»¡è¶³æ€§èƒ½éœ€è¦ï¼ŒåŽç»§è¿™å—æœ‰è€ƒè™‘æ›¿æ¢å…¶ä»–ï¼Œä½†çŸ­æ—¶é—´å…ˆä¸åŠ¨ä¸ºä¸»ã€‚

> Qï¼šæœ‰è®©å¼€å‘äººå‘˜çœ‹ç›‘æŽ§ä¹ˆï¼Ÿæ¯”å¦‚è¯´èµ„æºä½¿ç”¨æƒ…å†µï¼Ÿ

Aï¼š ç›‘æŽ§å¹³å°æ˜¯ä¼šå¼€æ”¾å‡ºåŽ»çš„ï¼Œå¼€å‘äººå‘˜èƒ½çœ‹åˆ°å¯¹åº”çš„ pod ä½¿ç”¨æƒ…å†µã€‚

> Qï¼šè¯·é—®ï¼Œæˆ‘ä»¬æ˜¯ java é¡¹ç›®ï¼Œåœ¨ä¸šåŠ¡ä»£ç æ‰“æˆ war åŒ…åŽï¼Œwar åŒ…å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œåœ¨å‘å¸ƒæµç¨‹ä¸­ï¼Œå¦‚ä½•å®Œæˆ pod ä¸­çš„å®¹å™¨çš„ä»£ç æ›´æ–°ï¼Œæ˜¯é‡‡ç”¨æŒ‚è½½ä»£ç åŽé‡å¯å®¹å™¨æ–¹å¼ï¼Œè¿˜æ˜¯é‡‡ç”¨æ¯æ¬¡é‡æ–°æž„å»ºä»£ç é•œåƒï¼Œç›´æŽ¥æ›´æ–°å®¹å™¨ï¼Œæˆ–è€…æœ‰ä»€ä¹ˆæ›´å¥½çš„å»ºè®®å—

Aï¼šé…ç½®åˆ†ç¦»ï¼ˆä¸Šé…ç½®ä¸­å¿ƒ)ï¼Œå‚æ•°é€šè¿‡å¯åŠ¨é‰´æƒä¸‹è½½é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œè¿™æ ·å­çŽ¯å¢ƒçš„æ›´æ–°åªéœ€è¦åŸºäºŽé€šè¿‡ä¸€ä¸ªåŒ…å³å¯ã€‚

> Qï¼šè¯·é—®ï¼Œé‚£ä¸ªç®¡ç†å‘Šè­¦å¹¶å‘é€å‘Šè­¦ç›‘æŽ§å¹³å°æ˜¯æ€Žä¹ˆè®¾è®¡å’Œå®žçŽ°çš„ï¼Ÿ

Aï¼šå‘Šè­¦å‘é€åˆ°ç›‘æŽ§å¹³å°ä¸éš¾ï¼Œç›‘æŽ§å¹³å°æä¾›æŽ¥å£ï¼Œæ•°æ®è¿‡æ¥åšè¿‡æ»¤å­˜åº“å¤„ç†ï¼Œç›‘æŽ§å¹³å°é€šè¿‡è°ƒç”¨å¾®ä¿¡ä¼ä¸šé€šè®¯å½•ï¼Œç»‘å®šå·¥å·ï¼Œå‘é€ä¹Ÿæ˜¯è°ƒç”¨ api æŽ¥å£ï¼Œå¹¶æ²¡æœ‰å…¶ä»–ï¼Œåªæ˜¯ç®€å•åšäº†åˆå¹¶æ”¶æ•›ï¼Œ5 åˆ†é’Ÿå†…éžçº§åˆ«ä¸ºé«˜çš„ï¼Œç»Ÿä¸€åˆå¹¶å‘é€ã€‚

> Qï¼šæœ‰æ²¡æœ‰ä½¿ç”¨ volumeï¼Œé›†æˆåˆ†å¸ƒå¼å­˜å‚¨åœºæ™¯ï¼Ÿ

Aï¼švolume è¿™å—åŽé¢ä¼šä¸Šåˆ†å¸ƒå¼ï¼Œæš‚æ—¶æ–‡ä»¶ä¸Šä¼ æš‚æ—¶ä¸Šä¼ åˆ° oss ä¸Šã€‚

> - Qï¼šæŒç»­åŒ–å­˜å‚¨æŽ¨èç”¨çš„æ˜¯ä»€ä¹ˆï¼Œceph å¯ä»¥å—ï¼Œè¿™ä¸ªæ•°æ®åšè¿‡æŒä¹…åŒ–åŽï¼Œæ€Žä¹ˆåšé«˜å¯ç”¨
> - Qï¼šredis æœ‰è·‘åœ¨ k8s ä¸Šä¹ˆï¼Ÿä¸»ä»Žæˆ–è€…é›†ç¾¤æœ‰åœ¨ k8s æœ‰è·‘ä¹ˆï¼Ÿä¼ ç»Ÿçš„ä¸»ä»Žè·‘åˆ° k8s ä¸Šéœ€è¦åš redis ä¸»ä»Žä¹ˆï¼Ÿ
> - Qï¼š  K8S PYTHON client  çš„å¯¹è±¡å¦‚ä½•è½¬ json çš„ï¼Ÿè‡ªå·±å®žçŽ° decoderï¼Ÿ

---

### 2019-10-24ï¼šçŽ©è½¬ Kubernetes å¼€å‘æµ‹è¯•çŽ¯å¢ƒ

> Qï¼šç›®å‰é‡åˆ°çš„ä¸€ä¸ªå®žé™…é—®é¢˜ï¼Œå°±æ˜¯å¼€å‘æµ‹è¯•çŽ¯å¢ƒå¦‚ä½•è¿›è¡Œæ•°æ®å†·å¯åŠ¨ï¼Ÿä¸€èˆ¬éœ€æ±‚å¼€å‘éƒ½ä¾èµ–å„ç±»æ•°æ®ï¼Œå¼€å‘äººå‘˜éœ€è¦åœ¨å¼€å‘é˜¶æ®µå¾€å¼€å‘æµ‹è¯•çŽ¯å¢ƒä¸­çŒå…¥æ•°æ®ï¼Œè¿˜æ˜¯ä»Žçº¿ä¸ŠåŒæ­¥éƒ¨åˆ†æ•°æ®ï¼Ÿè¯·æ•™ä¸‹é˜¿é‡Œå†…éƒ¨æ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚

Aï¼šåœ¨é˜¿é‡Œå†…éƒ¨å¼€å‘æµ‹è¯•çŽ¯å¢ƒæ˜¯å…±ç”¨çš„ä¸€ä¸ªæ—¥å¸¸æµ‹è¯•æ•°æ®åº“ï¼Œä¸éœ€è¦å†·å¯åŠ¨ã€‚åœ¨åˆšæ‰ä»‹ç»çš„æ¨¡å¼é‡Œé¢æˆ‘ä»¬å¸Œæœ›æ—¥å¸¸æµ‹è¯•çŽ¯å¢ƒè¶³å¤Ÿç¨³å®šï¼Œåªåœ¨éœ€è¦å‘å¸ƒçš„æ—¶å€™åšéƒ¨ç½²å’Œæ›´æ–°ï¼Œå…¶å®ƒçš„å¼€å‘å’Œè”è°ƒæµ‹è¯•è¡Œä¸ºéƒ½å‘ç”Ÿåœ¨æœ¬åœ°ï¼Œç›´æŽ¥å¼€å‘å’Œæµ‹è¯•

> Qï¼šæ•°æ®åº“è¡¨çš„ Schemaã€nginx confã€RabbitMQ çš„ Queue ç­‰ç»“æž„ï¼Œå¼€å‘æµ‹è¯•çŽ¯å¢ƒæ˜¯æ€Žä¹ˆå’Œçº¿ä¸Šå®žæ—¶åŒæ­¥çš„å‘¢ï¼Ÿ

Aï¼šä¼šæœ‰ä¸“é—¨å¹³å°åšæ•°æ®ç»“æž„å˜æ›´æµç¨‹ï¼Œä»Žæ—¥å¸¸å¼€å§‹æ‰§è¡Œï¼Œæµ‹è¯•å®ŒæˆåŽåŒæ­¥åˆ°é¢„å‘ã€ç”Ÿäº§ã€‚å¼€å‘ä¸­çš„ Schema æœ¬èº«ä¸å¤Ÿç¨³å®šï¼Œä¸€å®šæ˜¯æ—¥å¸¸éªŒè¯é€šè¿‡ä¹‹åŽæ‰ä¼šå¾€é¢„å‘åŒæ­¥å˜æ›´ã€‚

> Qï¼šæˆ‘ä»¬å…¬å¸æœ‰ä¸Šåƒä¸ªåº”ç”¨ï¼Œå¦‚ä½•åˆ©ç”¨ Kubernetes è¿›è¡Œå¤šç‰ˆæœ¬å¹¶è¡Œå¼€å‘ï¼ŸåŒæ—¶éƒ¨ç½²å¼€å‘éƒ½éžå¸¸å›°éš¾ï¼Œç›®å‰é‡‡ç”¨å„ä¸ªäº§å“çº¿æä¾›å¤šå¥—æœåŠ¡çš„ IPï¼Œåˆ©ç”¨ hosts é…ç½®è¿›è¡Œè”è°ƒï¼Œèƒ½å¦ç”¨ Kubernetes æ”¹è¿›ï¼Ÿ

Aï¼šé¦–å…ˆåº”ç”¨çš„æ•°é‡å¤§ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€æ‰€æœ‰çš„åº”ç”¨éƒ½ä¼šæœ‰ç›¸äº’é—´ä¾èµ–ã€‚å¯èƒ½æ˜¯ä¸€ç»„åº”ç”¨å…±åŒå¯¹å¤–æä¾›äº†ä¸€ä¸ªä¸šåŠ¡èƒ½åŠ›ã€‚Kubernetes æœ¬èº«æ˜¯å¯ä»¥ç®€åŒ–åº”ç”¨çš„éƒ¨ç½²é—®é¢˜ã€‚åœ¨ä¸Šé¢çš„åˆ†äº«é‡Œé¢ï¼Œé˜¿é‡Œæ¯ä¸ªåº”ç”¨åœ¨å‘å¸ƒä¹‹åŽéƒ½ä¼šéƒ¨ç½²ä¸€ä¸ªä¸»å¹²çŽ¯å¢ƒï¼Œè¿™ä¸ªä¸»å¹²çŽ¯å¢ƒçš„ç›®æ ‡å°±æ˜¯ä¸ºäº†æ–¹ä¾¿å…¶ä»–åº”ç”¨å¦‚æžœæœ‰è”è°ƒéœ€æ±‚çš„æ—¶å€™æœ‰ä¸€ä¸ªç›¸å¯¹æ–‡æ¡£çš„æµ‹è¯•çŽ¯å¢ƒå¯ä»¥ä½¿ç”¨ã€‚å¦å¤–æåˆ°çš„åˆ©ç”¨ hosts é…ç½®ï¼Œåœ¨ Kubernetes ä¸­è‡ªå¸¦çš„æœåŠ¡å‘çŽ°èƒ½åŠ›å¯ä»¥å¸®å¿™è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¸è¿‡å…·ä½“çš„åœºæ™¯ä¼šå¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸å±•å¼€ã€‚å¯ä»¥æ˜¯æŒ‰ç…§ç»„ç»‡æž¶æž„çš„æ¨¡å¼æ¥åˆ’åˆ†ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§åº”ç”¨æ‰€å±žçš„ä¸šåŠ¡é¢†åŸŸæ¥åˆ’åˆ†ã€‚å‰©ä¸‹çš„å°±æ˜¯æ€Žä¹ˆæŠŠè¿™äº›æ˜ å°„åˆ° Kubernetes çš„æ¨¡åž‹ä¸Šã€‚

> Qï¼šé—®ä¸€ä¸‹ï¼ŒService èµ°çš„ IPVS æ¨¡å¼ï¼Œé»˜è®¤ä¸æ˜¯è½®è¯¢çš„å˜›ï¼Œé‚£ä¹ˆå‘å¸ƒåŽç«¯ Pod çš„æ—¶å€™ï¼Œå“ªæ€•æ˜¯æ»šåŠ¨æ›´æ–°ï¼Œåœ¨æ—§çš„ Pod æ¶ˆå¤±å‰ï¼Œä¸ä¹Ÿä¼šæœ‰æµé‡èµ°è¿‡æ¥å—ï¼Œæ€Žä¹ˆèƒ½è®© Service å…ˆæŠŠæ—§çš„ Pod æ‘˜æŽ‰ï¼Œåœ¨åœæœåŠ¡å‘¢ï¼Ÿ

Aï¼šKT Connect çš„åº”ç”¨åœºæ™¯ä¸»è¦è¿˜æ˜¯åœ¨å¼€å‘æµ‹è¯•çŽ¯å¢ƒï¼Œè¿™å—å¯¹æœ¬èº«çš„ç¨³å®šæ€§è¦æ±‚å’Œçº¿ä¸ŠçŽ¯å¢ƒä¸å¤ªä¸€æ ·ã€‚å¦å¤–å¦‚æžœæƒ³ç¡®ä¿æœåŠ¡å§‹ç»ˆå¯ç”¨çš„è¯ Mesh æ¨¡å¼åˆšå¥½ä½¿ç”¨ä¸Žè¿™ä¸ªåœºæ™¯ã€‚åŽŸç”Ÿ Kubernetes ä¹Ÿæä¾›äº†æŽ¢é’ˆçš„èƒ½åŠ›æ¥ç¡®ä¿å½“æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œæµé‡ä¸ä¼šè½¬å‘åˆ° Pod å®žä¾‹ã€‚

> Qï¼šå®¹å™¨åŒ–æ”¹é€ ï¼Œä¸šåŠ¡è½¬åŒ–æˆå®¹å™¨ä¸ªæ•°åº”è¯¥æ€Žä¹ˆè¯„ä¼°ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå…·ä½“çš„é—®é¢˜ï¼Œå®¹å™¨åŒ–æ”¹é€ å’Œä½ ç›®å‰çš„åº”ç”¨éƒ¨ç½²é€»è¾‘ä¼šæœ‰å¾ˆå¤§çš„å…³ç³»ã€‚å®¹å™¨çš„ä¸ªæ•°å¹¶ä¸æ˜¯å…³é”®çš„è¡¡é‡æŒ‡æ ‡ã€‚æ¯”å¦‚åœ¨ Kubernetes ä¸‹ä¸€ä¸ª Pod å¯ä»¥åŒ…å« 1 åˆ°å¤šä¸ªå®¹å™¨ï¼Œè¿™å‡ ä¸ªå®¹å™¨å…±åŒæä¾›ä¸€ä¸ªæœåŠ¡ã€‚æ‰€ä»¥è¿˜æ˜¯çœ‹å…·ä½“åœºæ™¯å“ˆã€‚

> Qï¼šå¯¹äºŽå¼€å‘äººå‘˜æ¥è¯´ï¼Œä½¿ç”¨ Kubernetes é™¤äº†å¯ä»¥å¿«é€Ÿçš„ç”Ÿæˆä»£ç è¿è¡ŒçŽ¯å¢ƒä¹‹å¤–ï¼Œå’Œä¼ ç»Ÿçš„ä»£ç æäº¤ã€æ‹‰å–åˆ°æŒ‡å®šè¿è¡ŒçŽ¯å¢ƒçš„æ–¹å¼æ¯”è¾ƒè€Œè¨€ï¼Œè¿˜æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ

Aï¼šåœ¨ç®€å•åœºæ™¯ä¸‹ç›´æŽ¥å¯¹æ¯”è¿™ä¸¤ç§æ¨¡å¼ï¼Œä¸ä¼šæœ‰å¤ªå¤§å·®å¼‚ã€‚ä¸è¿‡å°±åƒä»Šå¤©çš„åˆ†äº«å†…å®¹ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹äºŽå¼€å‘äººå‘˜è€Œè¨€ï¼Œå†™å®Œä»£ç å°±ä¸è¦åŽ»æäº¤-éƒ¨ç½²ç„¶åŽåœ¨è”è°ƒã€‚ç›´æŽ¥åœ¨æœ¬åœ°ç¼–ç ï¼Œæœ¬åœ°è¿è¡Œç„¶åŽå’Œè¿œç«¯çš„æœåŠ¡è¿›è¡Œé›†æˆã€‚è¿™æ ·æ•ˆçŽ‡ä¼šæ˜Žæ˜¾æå‡å¾ˆå¤š

> Qï¼šKT å’Œ kubectl exec çš„åŒºåˆ«æ˜¯ï¼Ÿ

Aï¼šKT Connect ä¸»è¦æ˜¯è§£å†³æœ¬åœ°ä¸Žé›†ç¾¤å†…æœåŠ¡é›†æˆè”è°ƒçš„é—®é¢˜ï¼Œkubectl exec æ˜¯åœ¨å·²æœ‰çš„ Pod ä¸Šè¿è¡Œå‘½ä»¤ï¼Œä¸æ˜¯ä¸€ä¸ªç»´åº¦çš„é—®é¢˜ã€‚

---

### 2019-09-25ï¼šHC Bridge å®¹å™¨ç½‘ç»œæ¨¡å¼åˆ†äº«

> Qï¼šHC Bridge æ”¯æŒ Kubernetes çš„ Service å—ï¼Ÿ

Aï¼šHC Bridge åŽŸç”Ÿå°±æ˜¯æ”¯æŒ ClusterIP å’Œ Service çš„ã€‚å®‰è£… Kubernetes æ˜¯å°±ä¼šå¼€å¯ br_netfilter çš„ç‰¹æ€§ï¼ŒåŸºäºŽ Netfilter çš„ ClusterIP ä»ç„¶èƒ½å¤Ÿä½¿ç”¨ï¼Œæ‰€ä»¥ ServiceName ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚

> Qï¼šèƒ½è®²è®² HC Bridge è´Ÿè½½å‡è¡¡æ˜¯æ€Žä¹ˆåšçš„å—ï¼Ÿ

Aï¼šHC Bridge é‡‡ç”¨ Linux Bridgeï¼Œä¸åŒäºŽ MacVLAN/SRIOVï¼Œæœ¬èº«å…·å¤‡ Kubernetes åŽŸç”Ÿçš„ ClusterIP çš„æœºåˆ¶ã€‚

> Qï¼šHC Bridge å¯¹äºŽ MacVLAN æœ‰ä»€ä¹ˆä¼˜åŠ£åŠ¿ï¼Ÿ

Aï¼šMacVLAN æ€§èƒ½ç•¥é«˜äºŽ Bridgeï¼ŒPod å’Œ Node äºŒå±‚éš”ç¦»ï¼Œéœ€è¦å€ŸåŠ©ä¸‰å±‚æ‰èƒ½é€šä¿¡ï¼›HC Bridge èƒ½å¤Ÿä½¿ç”¨ VLAN ä½¿ Pod å’Œ Node åœ¨äºŒå±‚éš”ç¦»ï¼Œä½¿ç”¨ HC Bridge çš„ Pod ç½‘ç»œæµé‡èƒ½å¤Ÿç»è¿‡ Node çš„åè®®æ ˆï¼ŒPod æµé‡èƒ½åœ¨ Node å±‚é¢ç»Ÿä¸€ç®¡ç†å’ŒæŽ§åˆ¶ï¼Œå¹¶ä¸”å…·å¤‡ ClusterIPã€‚

> Qï¼šå¤šç§Ÿæˆ·/VPC æ¨¡å¼ä¸‹æ˜¯å¦å¯ä»¥äº’ç›¸ä¹‹é—´ç½‘æ®µå†²çªï¼Ÿ

Aï¼šHC Bridge ç½‘æ®µæ˜¯å¦å¯ä»¥å†²çªå–å†³äºŽåº•å±‚åŸºç¡€è®¾æ–½ã€‚

> Qï¼šHC Bridge çš„ç›‘æŽ§æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šå¯¹äºŽå¹³å°å±‚é¢çš„ç½‘ç»œè´¨é‡ç›‘æŽ§ã€TCP å±‚çš„ç›‘æŽ§ï¼Œkubelet è‡ªå¸¦çš„ cAdvisor å°±èƒ½å¤Ÿç›‘æŽ§çš„è¦æ±‚ï¼›å¯¹äºŽæ›´åŠ ç»†ç²’åº¦çš„ä¸šåŠ¡å±‚é¢çš„ç›‘æŽ§ï¼Œæˆ‘ä»¬è‡ªç ”çš„åŸºäºŽä¸šåŠ¡é“¾è·¯çš„ç›‘æŽ§æ¥æ»¡è¶³è¦æ±‚ã€‚

> Qï¼šHC Bridge å¯¹äºŽç¡¬ä»¶äº¤æ¢æœºæœ‰è¦æ±‚ä¹ˆï¼Ÿ

Aï¼šå‡ ä¹Žæ²¡æœ‰è¦æ±‚ï¼Œåªè¦äº¤æ¢æœºå…è®¸ä¸€ä¸ªç«¯å£èƒ½å¤Ÿè½¬å‘å¤šä¸ª Mac åœ°å€çš„æµé‡å³å¯ï¼Œå¤§éƒ¨åˆ†äº¤æ¢æœºéƒ½èƒ½å¤Ÿæ»¡è¶³è¦æ±‚ã€‚

> Qï¼šé€šå¸¸åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šé€‰æ‹©ä½¿ç”¨ HC Bridgeï¼Œè€Œä¸æ˜¯ Calicoï¼Ÿ

Aï¼šå¸Œæœ›å®¹å™¨èƒ½å¤Ÿè¢«é›†ç¾¤å¤–åº”ç”¨ç›´æŽ¥è®¿é—®ï¼Œä¸šåŠ¡èƒ½å¤Ÿæ„ŸçŸ¥ PodIPï¼Œè€Œä¸æ˜¯é€šè¿‡ Ingress å’Œ NodePortã€‚ä¾‹å¦‚ä¸­é—´ä»¶é›†ç¾¤ã€Dubbo é›†ç¾¤ã€Spring Cloud é›†ç¾¤ã€‚åœ¨ä¼ ç»Ÿè¡Œä¸šï¼Œç½‘ç»œç®¡ç†å‘˜å¸Œæœ›å®¹å™¨ç½‘ç»œå’Œç‰©ç†ç½‘ç»œä¸€æ ·ï¼Œèƒ½å¤Ÿè¢«ä¼ ç»Ÿçš„ç¡¬ä»¶è®¾å¤‡ç®¡æŽ§ã€‚

> Qï¼šHC Bridge åœ¨ OpenStack çŽ¯å¢ƒä¸‹çš„å…¼å®¹æ€§æ€Žä¹ˆæ ·ï¼Ÿ

Aï¼šå¦‚æžœä½¿ç”¨ Neutron ç½‘ç»œï¼Œåº•å±‚æ˜¯ä½¿ç”¨çš„æ˜¯ Linux ridge å½“åšç½‘ç»œé©±åŠ¨ï¼Œåˆ™æ˜¯å¯ä»¥å…¼å®¹çš„ï¼›å¦‚æžœåº•å±‚æ˜¯ OVS ä½œä¸ºç½‘ç»œé©±åŠ¨ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å…¼å®¹çš„ã€‚

> Qï¼šHC Bridge åœ¨ VMWare çŽ¯å¢ƒä¸‹çš„å…¼å®¹æ€§æ€Žä¹ˆæ ·ï¼Ÿ

Aï¼šåœ¨ VMWare çš„ç»‘å®šçŽ¯å¢ƒä¸‹çš„åˆ†å¸ƒå¼äº¤æ¢æœºï¼Œè¦æ±‚ç½‘ç»œæ˜¯æ··æ‚ç½‘ç»œï¼Œå¹¶ä¸”è¦æ±‚åœ¨å®¿ä¸»æœºä¸Šå¼€å¯é˜»æ­¢æ··æ‚æ¨¡å¼çš„é‡å¤æ•°æ®åŒ…ã€‚

> Qï¼šä¸ºä»€ä¹ˆè¦è‡ªå·±åœ¨å¼„ä¸€ä¸ª etcdï¼Ÿ

Aï¼šç»“æž„å›¾åªæ˜¯ç¤ºæ„ï¼Œetcd ä»ç„¶å¯ä»¥å¤ç”¨ Kubernetes æœ¬èº«çš„ etcdï¼Œå¯¹äºŽå¤§è§„æ¨¡åœºæ™¯ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ç‹¬ç«‹çš„ etcdã€‚

> Qï¼šHC Bridge æ”¯æŒå’Œ OpenStack èµ„æºæ± äº’é€šå—ï¼Ÿ

Aï¼šå¯ä»¥çš„äº’é€šçš„ï¼Œå®¹å™¨ç½‘ç»œå¯ä»¥å’Œç‰©ç†ç½‘ç»œã€è™šæ‹Ÿæœºç½‘ç»œåœ¨åŒä¸€ä¸ªå±‚ã€‚

> Qï¼šæ˜¯ä¸æ˜¯ä½ ä»¬ Pod ç›´æŽ¥æŒ‚åœ¨è™šæ‹Ÿæœºç½‘å¡ä¸Šï¼ŒNode ä¹‹é—´æ˜¯ VLAN é€šä¿¡æ˜¯ä¸æ˜¯äºŒå±‚äº’é€šï¼Ÿ

Aï¼šè¿™ç§è®¾è®¡åº”è¯¥ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯åŠ¨æ€æ‰©å±•å’Œå®¹å™¨ç½‘ç»œç®¡ç†å®Œå…¨ä¾èµ–äºŽè™šæ‹Ÿæœºç½‘ç»œã€‚æˆ‘ä»¬æ²¡æœ‰ç›´æŽ¥ä½¿ç”¨è™šæ‹Ÿæœºç½‘å¡ï¼Œåªæ˜¯é€šè¿‡ Bridge æŠŠå®¹å™¨ç½‘å¡å’Œè™šæ‹Ÿæœºç½‘å¡è¿žæŽ¥èµ·æ¥ï¼Œéœ€è¦å€ŸåŠ©è™šæ‹Ÿæœºç½‘å¡é€šä¿¡ã€‚

> Qï¼šHC Bridge å’Œ SDN ç»“åˆç´§å¯†å—ï¼Ÿ

Aï¼šè°ˆä¸ä¸Šç´§å¯†ç»“åˆï¼ŒHC Bridge å¯ä»¥åˆ©ç”¨ SDN çš„ç®¡ç†èƒ½åŠ›ï¼Œè¿™æ · HC Bridge æœ¬èº«ä¸ç”¨åšå¤ªå¤šçš„ç½‘ç»œç®¡ç†ã€‚ç›®å‰æ›´å¤šçš„æ˜¯ç›´æŽ¥ä¸Žä¼ ç»Ÿç½‘ç»œå¯¹æŽ¥ã€‚

> Qï¼šé»˜è®¤ Bridge å¦‚æžœæ‹‰å¹³ç½‘ç»œï¼Œå®¹å™¨ç½‘å…³å°±æ˜¯è·¯ç”±å™¨çš„åœ°å€ï¼ŒService å°±ç”¨ä¸äº†ã€‚HC Bridge æ˜¯å¦‚ä½•æ”¯æŒ Sercice çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬ Pod çš„ç½‘å…³ä¹Ÿæ˜¯è·¯ç”±å™¨åœ°å€ï¼Œç›®å‰æˆ‘ä»¬é‡åˆ° Service ä¸èƒ½ä½¿ç”¨çš„åœºæ™¯ï¼Œä¸»è¦æ˜¯å› ä¸ºæ²¡æœ‰å¼€å¯ br\_netfilterã€‚

> Qï¼šContiv çš„ VLAN æ¨¡å¼æ”¯æŒ Service å—ï¼Œè¿˜åœ¨å­¦ä¹ ä¸­ï¼Ÿ

Aï¼šContiv Service åº”è¯¥æ˜¯å¯ä»¥æ”¯æŒ Service çš„ï¼Œä½†æ˜¯ä¸èƒ½ä¾èµ–äºŽ Netfilter æ¥å®žçŽ°ã€‚

> Qï¼šæ—¢ç„¶åŒä¸€ä¸ªäºŒå±‚ï¼Œä¸ºä½•ä¸ç”¨ flannel hostgateway æ¨¡å¼ï¼Ÿé›†ç¾¤è§„æ¨¡å¯æ‰©å±•æ€§ä¹Ÿè¾ƒå·®å§ï¼Ÿ

Aï¼šflannel host-gw æ¨¡å¼ï¼Œè·¨ Node çš„ Pod é€šä¿¡æ—¶åŸºäºŽè·¯ç”±çš„ï¼Œæ˜¯ä¸‰å±‚ï¼›Flannel æ˜¯åŸºäºŽè·¯ç”±çš„æ–¹æ¡ˆï¼Œéœ€è¦å€ŸåŠ© BGP æ‰èƒ½å®žçŽ°ä¸Žå…¶ä»–ç½‘ç»œçš„äº’é€šï¼Œå¯¹äº¤æ¢æœºæœ‰ä¸€å®šçš„è¦æ±‚ï¼›å¯¹äºŽè§„æ¨¡è€Œè¨€ï¼ŒHCBridge çš„è§„æ¨¡ä¸»è¦å—é™äºŽ VLAN æ•°é‡å’Œ IP åœ°å€ä½™é‡ï¼›å¯¹äºŽæ‰©å±•æ€§è€Œè¨€ï¼ŒHC Bridge èƒ½å¤Ÿç»™ Pod ç½‘ç»œåŠ¨æ€å¢žåŠ  VLAN å’Œ IPPoolï¼Œèƒ½å¤Ÿä¿è¯æ‰©å±•æ€§ã€‚

> Qï¼šHC Bridge æ–¹å¼æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿä¸‹ä¸€æ­¥å‘å±•æ–¹å‘æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šäºŒå±‚ç½‘ç»œåœ¨è™šæ‹Ÿæœºå¹³å°ï¼Œéƒ½éœ€è¦åœ¨è™šæ‹Ÿæœºå¹³å°çš„ç½‘ç»œå¼€å¯æ··æ‚æ¨¡å¼ï¼Œè¿™ä¸€ç‚¹æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½çš„ï¼›ç›®å‰ä¸»è¦æ˜¯ç»§ç»­å…³æ³¨åŒæ ˆçš„æ”¯æŒã€å®¹å™¨ç½‘ç»œæµé‡ç›‘æŽ§å’Œæµé‡ç®¡ç†æ–¹é¢çš„äº‹æƒ…ã€‚

> Qï¼šIP æ˜¯å¦‚ä½•åˆ†é…çš„ï¼Ÿè¿½é—®ï¼šIPAM éƒ¨ç½²åœ¨å“ªé‡Œå‘¢ï¼ŸIP åœ°å€æ®µé…ç½®æ•°æ®å­˜åœ¨ etcd é‡Œé¢æ˜¯å—ã€‚

Aï¼šHC Bridge æä¾› IPAM ç®¡ç†çš„åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ® IP åœ°å€ CIDRã€VLAN ç­‰åˆ›å»º IPPoolï¼›ç„¶åŽå¯ä»¥æ ¹æ®ä¸šåŠ¡ã€æ ¹æ®åˆ†åŒºåˆ’åˆ† IP åœ°å€ã€‚HC Bridge çš„ CNI å’Œ IPAM éƒ½ä¼šä»¥ DaemonSet å½¢å¼åˆ†å‘åˆ°æ¯ä¸ª Node ä¸­ã€‚IP åœ°å€çš„ç›¸å…³ä¿¡æ¯è‚¯å®šæ˜¯å­˜åœ¨ etcd çš„ã€‚

---

### 2019-08-16ï¼šåˆæŽ¢äº‘åŽŸç”Ÿåº”ç”¨ç®¡ç†ä¹‹ï¼šèŠèŠ Tekton é¡¹ç›®

> Qï¼šè¯·æ¯”è¾ƒä¸€ä¸‹ Drone å’Œ Tektonï¼Œthxï¼

Aï¼šDrone æ˜¯ä¸€ä¸ª CI/CD å·¥å…·ï¼ŒTekton æ˜¯ç”¨æ¥åš CI/CD çš„æ¡†æž¶ã€‚Tekton åœ¨æ›´åº•å±‚ï¼Œä¹Ÿæ›´ä¸ºçµæ´»ã€‚

> Qï¼šTekton ä½œä¸ºä¸€ä¸ªæ‰§è¡Œå¼•æ“Žï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šæ‰§è¡ŒèŠ‚ç‚¹ä¸²è”è¿è¡Œï¼Œä¸åŒèŠ‚ç‚¹ä¸­è¿è¡ŒçŠ¶æ€å’Œæ—¥å¿—æ˜¯å¦‚ä½•åé¦ˆçš„ï¼Ÿ

Aï¼šTekton Pipeline æœ¬èº«å°±æ˜¯ Kubernetes API objectï¼Œæˆ‘ä»¬é€šè¿‡æ±‡æ€» Status æ¥é€å‡ºè¿è¡ŒçŠ¶æ€ã€‚ç”±äºŽ Tekton Pipeline å¯åŠ¨çš„éƒ½æ˜¯ Kubernetes Podï¼Œæˆ‘ä»¬å¯ä»¥å¤ç”¨åŽŸæœ‰çš„åŸºç¡€è®¾æ–½åŽ»æ”¶é›†ï¼Œç„¶åŽåšä¸€éæ±‡æ€»ã€‚

> Qï¼šTekton å¦‚ä½•ä¸Ž GitOps ç»“åˆï¼Ÿ

Aï¼šæˆ‘ä»¬åšäº†ä¸€ä¸ªç±»ä¼¼äºŽ flux[fluxcd/flux](https://github.com/fluxcd/flux) çš„ Operatorï¼Œé€šè¿‡ç›‘å¬ webhook äº‹ä»¶ç­‰æ¥è§¦å‘æ“ä½œã€‚

> Qï¼šTekton é›†æˆæ–¹é¢æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ

Aï¼šçµæ´»ä»¥åŠéžå¸¸äº‘åŽŸç”Ÿã€‚æ¯”ä¼ ç»Ÿå·¥å…·æ›´å¥½åœ¨ Kubernetes è·Ÿå…¶ä»–ç»„ä»¶åšé›†æˆã€‚æ¯”æ–¹è¯´ï¼Œè·Ÿ Flagger ç­‰åœ¨ Kubernetes æä¾›é‡‘ä¸é›€å‘å¸ƒç­–ç•¥çš„ç»„ä»¶ç»“åˆï¼Œåšäº‘åŽŸç”Ÿåº”ç”¨å‘å¸ƒã€‚

> Qï¼š Tekton æ—¢ç„¶ä½œä¸º Knative é¡¹ç›®é‡Œé¢ä¸€ä¸ªå«åš build-pipeline çš„å­é¡¹ç›®ï¼Œé‚£è¯·é—®ä¸‹ Tekton å’Œ Knative æœ‰ä»€ä¹ˆä¸åŒæˆ–è€…å¯¹æ¯”ä¼˜ç¼ºç‚¹å—ï¼Œæˆ‘æœ€è¿‘æœ‰å‡†å¤‡åš Knativeï¼Œä»Šå¤©æœ‰å¹¸çœ‹åˆ°è¿™ä¸ªåˆ†äº«ï¼Œæ­£å¥½è¯·æ•™ä¸€ä¸‹ï¼Ÿ

Aï¼šKnative æ˜¯ Serverless Frameworkï¼Œè·Ÿ Tekton è§£å†³çš„ä¸æ˜¯ä¸€ä¸ªå±‚é¢çš„äº‹æƒ…ï¼Œæ²¡æœ‰æ¯”è¾ƒæ€§ã€‚ç›¸åï¼Œä»–ä»¬å¯ä»¥ inter-operateï¼ŒKnative é‡Œå°±ä½¿ç”¨äº† Tektonã€‚

> Qï¼šæˆ‘çš„çœ‹æ³•æ˜¯ CD å’Œ CI éƒ½åªæ˜¯ Tekton çš„ Taskï¼Œèƒ½å¦è®²ä¸‹ä½ ä»¬çš„ CIï¼Ÿ

Aï¼šä½ å¥½ï¼Œæˆ‘ä»¬åšçš„æ˜¯ CDã€‚ä¸åªæ˜¯ Tekton Taskï¼Œä¹Ÿç”¨äº†å…¶ä»–çš„ Tekton åŽŸç”ŸåŠŸèƒ½ï¼Œæ¯”å¦‚ Pipelineã€PipelineResource ç­‰ã€‚æˆ‘ä»¬åšçš„æ˜¯é¢å‘å¤šäº‘/å¤šé›†ç¾¤äº¤ä»˜çš„ã€é¢å‘å¤æ‚æœ‰çŠ¶æ€çš„é˜¿é‡Œå·´å·´ä¸­é—´ä»¶åº”ç”¨çš„å‘å¸ƒå¹³å°ã€‚

> Qï¼šä½ ä»¬åšçš„è¿™ä¸ªå’Œ Jenkins X Pipeline Operator and Tekton çš„åŒºåˆ«å’Œä¸¤è€…çš„ä¼˜ç¼ºç‚¹ï¼Ÿ

Aï¼šJenkins X æ˜¯ CloudBees å›¢é˜ŸåŸºäºŽåŽŸæ¥ Jenkins çš„éœ€æ±‚ï¼Œå†ä½¿ç”¨ Tektonã€Prow ç­‰æ­å»ºçš„ CI/CD å¹³å°ã€‚è¿™ä¹Ÿä¾§é¢è¯´æ˜Žäº† Tekton ç­‰äº‘åŽŸç”Ÿå·¥å…·çš„ä¼˜åŠ¿ã€‚ä½† Jenkins X åšçš„æ¯”è¾ƒé‡ã€‚è€Œä¸”ä»¥ CI ç«¯ä¸ºä¸»ï¼Œä¸æ”¯æŒå¤æ‚çš„å‘å¸ƒç­–ç•¥ã€‚

> Qï¼šè¯·é—®æœ‰ä»€ä¹ˆå¥½çš„ GitOpstriggerï¼Ÿæˆ‘ä»¬ä½¿ç”¨çš„çš„æ˜¯ Phabricatorï¼Œ ä¸€ç›´æ²¡æœ‰æ‰¾åˆ°é€‚åˆçš„ triggerã€‚

Aï¼šè¿™ä¸ªä¸»è¦çœ‹å·¥å…·æœ¬èº«ï¼ˆæ¯”å¦‚ Phabricatorï¼‰æä¾›ä»€ä¹ˆæ ·çš„ Git triggerï¼Œç„¶åŽæ‰èƒ½é›†æˆåˆ°å¦‚ flux è¿™æ ·çš„ GitOps å·¥å…·ä¸­ã€‚

> Qï¼šè¯·æ¯”è¾ƒä¸€ä¸‹ Prow å’Œ Tektonï¼Œå‘çŽ° Kubernetesï¼ŒPrometheus ä»¥åŠ Tenkton æœ¬èº«éƒ½æ˜¯ä½¿ç”¨äº† Prowã€‚

Aï¼šProw æ˜¯ä¸€æ¬¾åŸºäºŽ GitHub åšçš„ Chatbot å·¥å…·ã€‚Tekton åˆ™æ˜¯ç”¨æ¥å®žçŽ°åŽé¢å¯¹æŽ¥çš„ CI/CD çš„åº•å±‚æ¡†æž¶ã€‚æœ¬äººæ°å¥½ä¹Ÿæ˜¯æ—©æœŸå‚ä¸Ž Prow é¡¹ç›®ï¼Œæ‰€ä»¥å¤šè¯´ä¸€ç‚¹è¿™ä¸ªå·¥å…·çš„åŽ†å²ã€‚ä¸€å¼€å§‹ GitHub åŠŸèƒ½ä¸å¤Ÿå¼ºå¤§ï¼Œè¿™ä¸ªå·¥å…·åªæ˜¯ä¸ºäº†å¼¥è¡¥ GitHub çš„ä¸è¶³ä¹‹å¤„ï¼Œä¸»è¦æ˜¯è¦ç»è¿‡ review ä¸èƒ½è®©äººæ‰‹åŠ¨åˆå¹¶ä»£ç ã€‚åŽæ¥åŠŸèƒ½åšç€åšç€å˜å¤šäº†ï¼Œæœ‰äº›è¢« GitHub é‡å¤äº†ã€‚ä½†æ˜¯åŠŸèƒ½é›†åˆè¿˜æ˜¯æ¯” GitHub å¤šï¼Œè€Œä¸” CNCF é‡Œçš„ infra é»˜è®¤ä½¿ç”¨ã€‚

---

### 2019-08-14ï¼šPPmoney åŸºäºŽ Kubernetes çš„ DevOps å®žè·µ

> Qï¼šæ€Žä¹ˆæ”¯æŒå¤šç§Ÿæˆ·ä¸åŒæµç¨‹å®šåˆ¶ä½¿ç”¨åŠæ•°æ®éš”ç¦»éœ€è¦ï¼Ÿ

Aï¼šè¿™é‡Œæˆ‘ç†è§£çš„æ˜¯ CI æµç¨‹çš„å®šåˆ¶ï¼Ÿå½“å‰æˆ‘ä»¬éƒ½æ˜¯æŒ‰ç…§æ ‡å‡†é»˜è®¤çš„ Jenkinsfile/Dockerfile æ¥æŽ¥å…¥ï¼Œç”¨æˆ·å¯è‡ªå®šä¹‰è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚

> Qï¼šé›†ç¾¤å¤–éƒ¨ç½‘ç»œè®¿é—®æµé‡èµ°å‘æ˜¯ï¼šClient -> LVS -> nginx-ingress-controller -> Endpointsï¼Œä¸æ˜¯ Ingress -> SVC -> å¾®æœåŠ¡ï¼Ÿ

Aï¼šingress-controller å…¶å®žæ˜¯é€šè¿‡ SVC æ¥èŽ·å–åˆ°æä¾›æœåŠ¡çš„å¾®æœåŠ¡å³ Endpointsã€‚

> Qï¼šæŸä¸ªå¾®æœåŠ¡èŠ‚ç‚¹æ¯”è¾ƒï¼Œæ¯æ¬¡å‡çº§è€—æ—¶ç‰¹åˆ«é•¿ã€‚æœ‰ä»€ä¹ˆå¥½çš„æ–¹å¼ï¼Ÿ

Aï¼šæœåŠ¡å‡çº§ä¸»è¦å…³ç³»åˆ°çš„æ˜¯ Kubernetes çš„ rollingUpdate ç­–ç•¥ï¼Œå‡çº§æ…¢å¤§éƒ¨åˆ†æ—¶å€™å…¶å®žæ˜¯å¯åŠ¨æ…¢ï¼ŒæœåŠ¡æ²¡æœ‰å¾ˆå¿«è¾¾åˆ° ready çŠ¶æ€ã€‚è¿™ä¸ªè·Ÿ resource çš„ limit ä»¥åŠ request ä¹Ÿæœ‰å…³ç³»ã€‚

> Qï¼šç›®å‰ç”Ÿäº§çŽ¯å¢ƒ Kubernetes æ˜¯éƒ¨ç½²åœ¨å…¬æœ‰äº‘ä¸»æœºï¼Œè¿˜æ˜¯ç‰©ç†æœºå™¨ä¸Šï¼Ÿæœ‰æ— åšä¸ªæ€§èƒ½æµ‹è¯•å¯¹æ¯”ï¼Ÿ

Aï¼šç”Ÿäº§çŽ¯å¢ƒæˆ‘ä»¬ç›®å‰è¿˜æ˜¯å°éƒ¨åˆ†è¯•ç‚¹åœ¨ IDC æœºæˆ¿ï¼Œä¹‹å‰ä¹Ÿæœ‰åœ¨ Azure ä¸Šéƒ¨ç½²è¿‡ AKS é›†ç¾¤ï¼ŒAKS çš„è¯ä¼šæœ‰ä¸€äº›ç½‘ç»œçš„é—®é¢˜ï¼Œä¾‹å¦‚ SVC çš„æ¨¡å¼åªèƒ½æ˜¯ä½¿ç”¨ iptables è€Œä¸èƒ½ä½¿ç”¨ ipvsã€‚æ€§èƒ½æµ‹è¯•å¯¹æ¯”çš„è¯ï¼Œå¯¹æ¯”è¿‡ AKS ä¸Šçš„å®žä¾‹è·Ÿå†…éƒ¨äº‘å¹³å°ä¸Šçš„å®žä¾‹ QPSï¼Œå¤§æ¦‚æ˜¯ 1/3 è¿™æ ·å­ã€‚

> Qï¼šè¯·é—®ä½ ä»¬æ—¥å¿—æ”¶é›†æ˜¯æ€Žä¹ˆåšçš„å‘¢ï¼Ÿ

Aï¼šåˆ†äº«å†…å®¹é‡Œè¾¹æœ‰å†™åˆ°ï¼ŒFilebeat æ”¶é›†ä¹‹åŽå‘é€åˆ° Kafkaï¼Œå†ç”±æ¶ˆè´¹è€…å–å‡ºåšå¤„ç†å†å…¥åˆ° ES é›†ç¾¤ã€‚

> Qï¼šä½ ä»¬ç”¨è¿‡ Istio å—ï¼Œå¯¹å®¹å™¨æ€§èƒ½æœ‰å½±å“å—ï¼Ÿ

Aï¼šIstio è¿˜åœ¨è°ƒç ”é˜¶æ®µï¼Œå½“ç„¶æµ‹è¯•é›†ç¾¤ä¹Ÿæœ‰éƒ¨ç½²ï¼Œå¯¹äºŽç”¨æˆ·å¯è§çš„å‘½åç©ºé—´æ˜¯ disable çš„ã€‚å¯¹å®¹å™¨æ€§èƒ½ï¼Œåº”è¯¥è¯´æ˜¯å¯¹æœåŠ¡çš„æ€§èƒ½å½±å“ï¼Œå› ä¸ºå¤šäº†å‡ æ¬¡ iptables çš„è½¬å‘ï¼Œå¼€å¯ mixer å½±å“ä¼šæ›´å¤§äº›ã€‚æ€§èƒ½ä¸ŽæœåŠ¡æ²»ç†ä¹‹é—´ä¼šæœ‰å–èˆã€‚

> Qï¼šå¦‚ä½•é€šè¿‡æ›´æ”¹æºç çš„æ–¹å¼æ¥ä¿®æ”¹ kubeadm è¯ä¹¦æœŸé™é—®é¢˜ï¼Ÿ

Aï¼š1 å¹´æœŸçš„é»˜è®¤å€¼æ˜¯ hardcode åˆ° kubeadm çš„æºç ä¸­ï¼ˆåœ¨ `k8s.io/kubernetes/cmd/kubeadm/app/util/pkiutil/pki_helpers.go`{.prettyprint}æ–‡ä»¶ä¸­çš„ `duration365d`{.prettyprint}å˜é‡ï¼‰çš„ï¼Œæ”¹è¿™ä¸ªé‡æ–°æ‰“åŒ… kubeadm çš„ binary å³å¯ï¼ˆéžå¸¸ä¸å»ºè®®è¿™ç§æ“ä½œï¼‰ã€‚

> Qï¼šIstio éƒ¨ç½²åœ¨ Kubernetes é«˜å¯ç”¨é›†ç¾¤ä¸Šï¼Œæ˜¯æ¯ä¸ª Master éƒ½è¦å®‰è£…å—ï¼Ÿ

Aï¼šä¸éœ€è¦å–”ï¼Œå¦‚æžœæ˜¯ä½¿ç”¨å®˜æ–¹ Helm éƒ¨ç½²å®‰è£…çš„è¯ ControlPlane é»˜è®¤ä¼šæœ‰ HPA çš„ã€‚

> Qï¼šIstio å­˜åœ¨é«˜å¯ç”¨å—ï¼Ÿ

Aï¼šä¸Šé¢æŒ‡çš„æˆ‘ç†è§£æ˜¯æŽ§åˆ¶å±‚é¢çš„é«˜å¯ç”¨ã€‚

> Qï¼šæ··æ²Œæµ‹è¯•æ€Žä¹ˆåšï¼Œæœ‰ä»‹ç»å—ï¼Ÿ

Aï¼šæ··æ²Œæµ‹è¯•å€Ÿé‰´äº† Chaoskube é¡¹ç›®ï¼Œæˆ‘è®°å¾—æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦çš„æ··æ²Œæµ‹è¯•åŠŸèƒ½ç›¸å¯¹æ¯”è¾ƒç®€å•ã€‚é˜¿é‡Œå¼€æºçš„ ChaosBlade ä¹Ÿéžå¸¸ä¸é”™ã€‚å¦‚æžœè¯´æœ‰ä½¿ç”¨åˆ° Istio çš„åŒå­¦è¯•è¯• fault injectionã€‚

> Qï¼šç›‘æŽ§æ–¹é¢æœ‰å¹³å°åŒ–å—ï¼Œæ²¡æœ‰çš„è¯æŠ¥è­¦è§„åˆ™å¢žåŠ æ˜¯è°æ¥åšçš„ï¼Ÿ

Aï¼šçŽ°åœ¨å‘Šè­¦è§„åˆ™è¿˜æ˜¯ç®¡ç†å‘˜æ¥å¤„ç†ï¼Œå…¶å®žå¹³å°åŒ–å®žçŽ°ï¼Œprometheus-operator ä¸­ï¼ŒPrometheus çš„è§„åˆ™æ˜¯ä»Ž CRD å³ PrometheusRule ç”Ÿæˆå†ç”Ÿæˆåˆ° ConfigMap ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å®žçŽ°åˆ›å»ºè¿™ä¸ª PrometheusRule çš„æŽ¥å£å³å¯ï¼ˆè¿˜éœ€è¦å¯¹åº”åˆ° ruleSelectorï¼‰ã€‚

> Qï¼šåŒä¸€ä¸ªå®¿ä¸»æœºä¸Šå¤šä¸ªç›¸åŒ Podï¼Œæ—¥å¿—æ–‡ä»¶æ€Žä¹ˆæ”¶é›†ï¼Ÿ

Aï¼šPod æ˜¯ä¸ä¼šæœ‰ç›¸åŒçš„ ID çš„ï¼Œé€šè¿‡ filebeat/fluent-bit è¿™ç±»æ—¥å¿— Agent æ”¶é›†éƒ½ä¼šæœ‰å†…ç½®åŠŸèƒ½æ¥æ”¯æŒå°† Pod çš„ metadata ä¿¡æ¯ä¹ŸåŒ…å«åœ¨æ¯ä¸€æ¡æ—¥å¿—è®°å½•ä¸­ã€‚

> Qï¼šè¯·é—®ä»Žå¼€å‘åˆ°æµ‹è¯•åˆ°ç”Ÿäº§çš„å‘å¸ƒç”¨åˆ°äº†å“ªäº›å·¥å…·æ ˆï¼Ÿåˆ†åˆ«èµ·ä»€ä¹ˆä½œç”¨ï¼Ÿ

Aï¼šå¼€å‘å…¶å®žå°±åªéœ€è¦æäº¤ä»£ç åˆ° SCMï¼Œä¹‹åŽçš„å·¥ä½œç”±äº‘å¹³å°æ¥è§¦å‘ï¼Œåœ¨åˆ†äº«ä¸­çš„ CI/CD å›¾é‡Œè¾¹æœ‰ç”»å‡ºæ¥ã€‚æ¶‰åŠçš„å·¥å…·ä¸»è¦è¿˜æ˜¯ Jenkinsï¼Œæµ‹è¯•çš„åŒå­¦ä¼šåœ¨ Jenkins ä¸­åšç›¸åº”çš„ä»»åŠ¡ã€‚è¿™ç§åšæ³•çš„ç¼ºç‚¹ä¸Šé¢ä¹Ÿæœ‰è¯´åˆ°"ä¼¼ä¹Žè·Ÿäº‘åŽŸç”ŸèƒŒé“è€Œé©°"ã€‚

---

### 2019-08-05ï¼šåŸºäºŽ OVS è‡ªç ”å®¹å™¨ç½‘ç»œæ’ä»¶åœ¨é‡‘èžç±»ä¼ä¸šçš„è½åœ°å®žè·µ

> Qï¼šIPAM çš„å›ºå®š IP æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼ŸIP ä¸Ž Pod UID å…³è”å—ï¼Ÿ

Aï¼šç®¡ç†å‘˜å½•å…¥ç½‘ç»œä¿¡æ¯åŽï¼ŒFabric ä¼šå°†æ‰€æœ‰ IP åœ°å€å­˜å‚¨åˆ° etcd ä¸­ç»Ÿä¸€ç®¡ç†ã€‚ç›®å‰å›ºå®š IP æ˜¯é€šè¿‡ç»™ deployment ç­‰ workload å¯¹è±¡å¢žåŠ  Annotation å®žçŽ°çš„ã€‚IP ä¸ä¸Ž Pod UID å…³è”ã€‚

> Qï¼šè¿™é‡Œé¢æåˆ°çš„ä¸‰å±‚ç½‘ç»œå’ŒäºŒå±‚ç½‘ç»œæ˜¯æŒ‡ä¸ƒå±‚åè®®çš„ä¸‰å±‚äºŒå±‚å—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œæ¯”å¦‚äº¤æ¢æœºå·¥ä½œåœ¨ 2 å±‚ï¼Œè·¯ç”±å™¨å·¥ä½œåœ¨ä¸‰å±‚ã€‚

> Qï¼šæœåŠ¡è´Ÿè½½å‡è¡¡æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿ

Aï¼šå¤–éƒ¨æµé‡å¯¼å…¥é›†ç¾¤çš„è´Ÿè½½å‡è¡¡æ˜¯é€šè¿‡å¦å¤–ä¸€ä¸ªç»„ä»¶ï¼Œingresscontroller å®žçŽ°çš„ï¼Œæ²¡æœ‰å®žçŽ°åœ¨ CNI é‡Œé¢ã€‚ Kubernetes svc çš„è´Ÿè½½å‡è¡¡æ˜¯é€šè¿‡ iptables å®žçŽ°çš„ï¼ŒFabric é¡¹ç›®ä¹Ÿä¼šå¾€ iptables é‡Œé¢åŠ å…¥ä¸€äº›è§„åˆ™ï¼Œä¸»è¦æ˜¯è·¨èŠ‚ç‚¹ SNATã€‚

> Qï¼šæ”¯æŒæµé‡é™æµä¹ˆï¼Ÿ

Aï¼šæ”¯æŒ Ingress/Egress é™é€Ÿï¼Œé€šè¿‡ç»™å®¹å™¨åŠ  Annotation å³å¯ä»¥å®žçŽ°å®¹å™¨çš„é™é€Ÿã€‚

> Qï¼šæœ‰å’Œ Contiv åšè¿‡å¯¹æ¯”å—ï¼Ÿ

Aï¼šé€‰åž‹é˜¶æ®µåšè¿‡ï¼Œæ¯”è¾ƒæ—©äº†ï¼Œé‚£æ—¶å€™è²Œä¼¼ Contiv è¿˜ä¸å¤ªæˆç†Ÿï¼Œæ‰€ä»¥æ²¡æ·±å…¥ç ”ç©¶ã€‚

> Qï¼šè¿™äº›ç½‘ç»œæ–¹æ¡ˆæœ‰ä»€ä¹ˆå¥½çš„å­¦ä¹ æ–¹å¼å—ï¼Ÿ

Aï¼šç½‘ç»œè™½ç„¶å¾ˆå¤æ‚ï¼Œä½†ä¸‡å˜ä¸ç¦»å…¶å®—ã€‚å®¹å™¨ç½‘ç»œè¿™ä¸ªè¯æœ€è¿‘å‡ å¹´æ¯”è¾ƒæµè¡Œï¼Œæ˜¯å› ä¸ºç½‘ç»œå†å®¹å™¨çŽ¯å¢ƒä¸‹é‡åˆ°äº†ä¸€äº›æŒ‘æˆ˜ï¼Œä½†ç½‘ç»œæœ¬è´¨çš„æ¦‚å¿µè¿˜æ˜¯è¿‡åŽ»éžå¸¸æˆç†Ÿçš„é‚£ä¸€å¥—ã€‚æ‰€ä»¥é¦–å…ˆå¾—å­¦ä¹ åŸºæœ¬çš„ç½‘ç»œçŸ¥è¯†ï¼Œç„¶åŽåŽ»çœ‹ä¸‹å®¹å™¨çŽ¯å¢ƒå¿«é€Ÿå¼¹æ€§ç­‰å¸¦æ¥çš„ç—›ç‚¹ã€‚

> Qï¼šTC æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šè¿™ä¸ªå®žçŽ°çš„æ¯”è¾ƒä¹…äº†ï¼Œæ—©åœ¨è¿‡åŽ»é‡ç‚¹æ”¯æŒ Calico çš„æ—¶å€™å°±å·²ç»åšäº†ã€‚æœ‰äº›ç»†èŠ‚æ¨¡ç³Šäº†ï¼Œä½†åŸºæœ¬æ˜¯é€šè¿‡ Linux tc å®žçŽ°çš„ï¼Œå› ä¸ºæœ¬è´¨æ˜¯ veth pairï¼Œæ‰€ä»¥é™é€Ÿå¯ä»¥åœ¨ä¸»æœºä¾§ veth ç«¯å®žçŽ°ã€‚åŸºæœ¬çš„é™é€Ÿå‘½ä»¤å¯ä»¥æŸ¥æ‰¾ tc æœºåˆ¶å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬ç¢°åˆ°é™é€Ÿä¸å¤ªå‡†ç¡®ï¼Œæœ€åŽä¹Ÿé€šè¿‡è°ƒæ•´å‚æ•°è§£å†³äº†ï¼Œè¯¯å·®æŽ§åˆ¶åœ¨ç™¾åˆ†ä¹‹å‡ å§ã€‚

> Qï¼šä¸Ž Kube-OVN åšè¿‡å¯¹æ¯”å—ï¼Ÿ

Aï¼šKube-OVN æ˜¯å‹å•†å¼€æºçš„äº§å“ï¼Œæˆ‘äº†è§£è¿‡ã€‚é¦–å…ˆ Kube-OVN å’Œ Fabric é¡¹ç›®éƒ½æ˜¯åŸºäºŽ OVS è¿›è¡Œç ”å‘çš„ï¼Œéƒ½æ”¯æŒ Overylay/underlay æ¨¡å¼ï¼Œéƒ½å¯ä»¥å®žçŽ° CNI åè®®ã€‚ä½†å…¶å®žå·®åˆ«è¿˜æ˜¯æ¯”è¾ƒå¤§ã€‚OVN é¡¹ç›®æºäºŽ OpenStackï¼ŒOpenStack é‡Œçš„ç½‘ç»œæ¨¡åž‹æ˜¯éžå¸¸é‡çš„ï¼Œæ¦‚å¿µã€ç»„ä»¶éƒ½æ¯”è¾ƒå¤šï¼ŒOVN ä¹Ÿåœ¨è¯•å›¾ç»Ÿä¸€ Kubernetes/OpenStack çš„ç½‘ç»œæ¨¡åž‹ï¼Œæ‰€ä»¥ Kube-OVN é‡Œæœ‰ä¸€äº›èƒ½åŠ›å…¶å®žå·²ç»ä¸åœ¨ CNI spec çš„èŒƒå›´å†…äº†ï¼Œæ¯”å¦‚è´Ÿè½½å‡è¡¡ï¼ŒDNS ç­‰ï¼Œå…¶å®žåœ¨ç¤¾åŒºéƒ½æœ‰å¯¹åº”çš„å®žçŽ°ã€‚è€Œ Fabric ä¼šç®€å•å¾ˆå¤šï¼Œæ˜¯ä¸€ä¸ªæ ‡å‡†çš„ CNI å®žçŽ°ï¼Œç½‘ç»œæ¨¡åž‹ä¹Ÿéžå¸¸æ¸…æ™°ï¼Œèƒ½å¤ŸæŠŠå®¹å™¨ç›´æŽ¥èžå…¥çŽ°ç½‘çŽ¯å¢ƒï¼Œä¼ä¸šçš„ç½‘ç®¡ä¸€èˆ¬éƒ½èƒ½æŽŒæŽ§ï¼Œå¯¹å®‰å…¨ç›‘ç®¡ç­‰å·²æœ‰ä½“ç³»å…¼å®¹æ€§æ¯”è¾ƒå¥½ã€‚

---

### 2019-07-24ï¼šTiDB Operator çš„è®¾è®¡ä¸Žå®žçŽ°

> Qï¼šå‡çº§å¼€å§‹æ—¶ï¼Œpartition = èŠ‚ç‚¹æ•° - 1ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„ Pod éƒ½ä¸å‡çº§ï¼Œä¸ºå•¥æ˜¯ partition = èŠ‚ç‚¹æ•° - 1ï¼Ÿ

Aï¼šè¿™é‡Œè¦çº é”™ä¸€ä¸‹ï¼Œæ˜¯ pod ordinal ä»Ž 0 å¼€å§‹è®¡æ•°ï¼Œå¤§äºŽæˆ–ç­‰äºŽ partition åºå·çš„ Pod ä¼šè¢«å‡çº§ï¼Œæ‰€ä»¥æœ€å¤§çš„åºå·æ˜¯èŠ‚ç‚¹æ•° - 1ï¼Œæœ€å¼€å§‹çš„ partition æ˜¯ç­‰äºŽèŠ‚ç‚¹æ•°ï¼Œåˆ†äº«æ—¶è¡¨è¾¾é”™äº†ï¼ˆæˆ‘è‡ªå·±ä¹Ÿè®°é”™äº†ï¼‰ï¼ŒæŠ±æ­‰ã€‚

> Qï¼šè¿˜æœ‰å°±æ˜¯é©±é€ leader æˆåŠŸäº†æ€Žä¹ˆé˜²æ­¢è¦å‡çº§çš„ Pod é‡æ–°è¢«é€‰ä¸º leaderï¼Ÿ

Aï¼šæˆ‘ä»¬å®žé™…ä¸Šæ˜¯åœ¨ PD ä¸­æäº¤äº†ä¸€ä¸ªé©±é€ leader çš„ä»»åŠ¡ï¼ŒPD ä¼šæŒç»­ä¿è¯é©±é€å®Œæ¯•åŽæ²¡æœ‰æ–° leader è¿›æ¥ï¼Œç›´åˆ°å‡çº§å®Œæ¯•åŽï¼Œç”±æŽ§åˆ¶å™¨ç§»é™¤è¿™ä¸ªä»»åŠ¡ã€‚

> Qï¼šé›†ç¾¤è§„æ¨¡å¤šå¤§ï¼Ÿå¤šå°‘ Pod Nodeï¼Ÿ

Aï¼šæˆ‘ä»¬åœ¨ Kubernetes ä¸Šå†…éƒ¨æµ‹è¯•çš„è§„æ¨¡è¾ƒå¤§çš„é›†ç¾¤æœ‰ 100 + TiKV èŠ‚ç‚¹ 50+ TiDB èŠ‚ç‚¹ï¼Œè€Œæ¯ä½ç ”å‘éƒ½ä¼šéƒ¨ç½²è‡ªå·±çš„é›†ç¾¤è¿›è¡Œæ€§èƒ½æµ‹è¯•æˆ–åŠŸèƒ½æµ‹è¯•ã€‚

> Qï¼šæƒ³äº†è§£ä¸‹æ•°æ®åº“å®¹å™¨åŒ–ï¼ŒæŽ¨èä½¿ç”¨ Local PV å—ï¼Œæœ‰æ²¡æœ‰å“ªäº›å‘æˆ–æœ€ä½³å®žè·µæŽ¨èï¼Ÿæˆ‘ä»¬åœ¨è€ƒè™‘ MySQL æ•°æ®åº“å®¹å™¨åŒ–ä»¥åŠä¸­é—´ä»¶å®¹å™¨åŒ–ï¼Œæ˜¯é€‰æ‹© Local PV è¿˜æ˜¯çº¿ä¸‹è‡ªå»º Ceph é›†ç¾¤ï¼Ÿ

Aï¼šLocal PV å…¶å®žä¸æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œè€Œæ˜¯ä¸€ä¸ªå¼ºåˆ¶å› ç´ ï¼Œå› ä¸ºç½‘ç»œç›˜çš„ IOPS æ˜¯è¾¾ä¸åˆ°åœ¨çº¿å­˜å‚¨åº”ç”¨çš„ç”Ÿäº§çŽ¯å¢ƒéœ€æ±‚çš„ï¼Œæˆ–è€…è¯´ä¸æ˜¯è¯´çº¿ä¸Šå®Œå…¨ä¸èƒ½ç”¨ï¼Œè€Œæ˜¯æ²¡æ³•æ”¯æ’‘å¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ã€‚MySQL çš„è¿ç»´æˆ‘ç›¸å¯¹ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œå‡å¦‚ MM èƒ½å¤Ÿåšåˆ°åŒå‰¯æœ¬å†—ä½™å¼ºä¸€è‡´çš„è¯ï¼Œé‚£ç†è®ºä¸Šå°±èƒ½ç”¨ã€‚å¤§å¤šæ•°ä¸­é—´ä»¶æ¯”å¦‚ Kafkaã€Cassandra éƒ½æœ‰æ•°æ®å†—ä½™ï¼Œè¿™äº›ä½¿ç”¨ Local PV åœ¨ç†è®ºä¸Šéƒ½æ˜¯æ²¡é—®é¢˜çš„ã€‚

> Qï¼šçœ‹ä½ çš„æ–¹æ¡ˆæ„Ÿè§‰ Kubernetes å’Œ PD çš„é€»è¾‘ç»“åˆåœ¨ä¸€èµ·äº†ï¼ŒäºŒè€…ä¹‹é—´å¦‚ä½•äº’é€šï¼Ÿä¼šæœ‰ä»£ç äº’ç›¸ä¾µå…¥å—ï¼Ÿæ˜Žç™½äº†ï¼Œå°±å¥½åƒé—®é¢˜ 2 é©±é€é—®é¢˜ï¼Œpd æ”¶åˆ°é©±é€ä»»åŠ¡ï¼ŒKubernetes æŽ§åˆ¶å™¨ä¸æ–­çš„æ£€æŸ¥æ˜¯å¦é©±é€æˆåŠŸï¼Œå¦‚æžœæˆåŠŸå°±å¼€å§‹å‡çº§ï¼Œå¯¹å§ï¼Ÿ

Aï¼šè¿™å°±æ˜¯è‡ªå®šä¹‰æŽ§åˆ¶å™¨çš„ç»ä½³åœºæ™¯äº†ï¼ŒKubernetes å’Œ PD æœ¬èº«å®Œå…¨æ²¡æœ‰äº¤äº’ï¼Œæ˜¯æŽ§åˆ¶å¾ªçŽ¯åœ¨åŒæ­¥ä¸¤è¾¹çš„çŠ¶æ€ï¼Œä¸€æ–¹é¢æŽ§åˆ¶å¾ªçŽ¯ä¼šæŠŠ PD è®°å½•çš„é›†ç¾¤çŠ¶æ€å¡žåˆ° TidbCluster å¯¹è±¡çš„ status é‡Œé¢ï¼Œå¦ä¸€æ–¹é¢æŽ§åˆ¶å¾ªçŽ¯åœ¨å°†å®žé™…çŠ¶æ€å‘æœŸæœ›çŠ¶æ€è½¬ç§»æ—¶ï¼Œä¹Ÿä¼šç”Ÿæˆä¸€äº› PD çš„ä»»åŠ¡å’Œæ“ä½œå­ï¼ˆOpeartorï¼‰æäº¤åˆ° PD ä¸­æ¥è°ƒè°é›†ç¾¤çŠ¶æ€ã€‚

---

### 2019-07-17ï¼šåŸºäºŽ Istio çš„ç°åº¦å¹³å°å®žè·µ

> Qï¼šå¦‚ä½•åˆ¤æ–­ checkã€quota ä¸‹æ”¾ istio-proxy å¼•å…¥çš„é—®é¢˜ï¼Ÿ

Aï¼šå¾—é€šè¿‡åŽ‹æµ‹äº†ï¼Œçœ‹æ€§èƒ½æŸè€—äº†ã€‚æˆ‘ä»¬åŽç»­ä¼šåŠ å…¥ Mixer çš„åŠŸèƒ½å†åŽ‹æµ‹ä¸€è½®ã€‚çŽ°åœ¨åšçš„åŽ‹æµ‹è¿˜æ˜¯ä¸å¼€ Mixer åŠŸèƒ½çš„åœºæ™¯ä¸‹åŽ‹çš„ã€‚å› ä¸ºæˆ‘ä»¬çº¿ä¸Šç›®å‰è¿˜ä¸æ‰“ç®—å¼€ Mixerã€‚

> Qï¼šèƒ½å¦ç»™ä¸ª demoï¼Ÿ

Aï¼šç›®å‰è¿˜æ²¡æœ‰å¼€æ”¾åœ¨å¤–é¢çš„ demoã€‚å¯ä»¥ç»™äº›æ€è·¯ï¼Œè¯·é—®ä½ æƒ³è¦ä»€ä¹ˆè¦çš„åŠŸèƒ½çš„ demoï¼Ÿæ²¡å®žè·µè¿‡ï¼Œå¬ç†è®ºæ€»æ˜¯æœ‰ç‚¹è™šï¼å¯ä»¥å®žè·µä¸€ä¸‹ã€‚æˆ‘ä»¬ä¸»è¦æ˜¯ç”¨çš„ Istioï¼ˆEnvoyï¼‰çš„æµé‡ç®¡ç†çš„åŠŸèƒ½ã€‚ä¸»è¦æ˜¯è¦é…ç½® Istio çš„æµé‡ç®¡ç†ç­–ç•¥ã€‚ç»™ä¸šåŠ¡äººå‘˜å†ç»™ä»–ä»¬é…ç½® yaml æ–‡ä»¶ï¼Œå­¦ä¹ æˆæœ¬å¤ªå¤§ï¼Œæ‰€ä»¥åšäº†å¯è§†åŒ–ï¼Œæœ‰æŒ‰æµé‡ï¼ŒæŒ‰ç”¨æˆ·ï¼Œè‡ªå®šä¹‰ä¸‰ç§æ–¹å¼ã€‚ä¸»è¦æ˜¯æŠŠé¡µé¢é…ç½®ç¼–è¯‘æˆ yaml æµé‡é…ç½®ã€‚

> Qï¼šIstio æ¯ä¸ªæœåŠ¡ä¸­å¾—åˆ°çš„è®¿é—® IP éƒ½æ˜¯ 127.0.0.1ï¼Œè¿™ä¸ªè¯¥æ€Žä¹ˆæžï¼Ÿèƒ½æ‹¿åˆ° realclient ipï¼Ÿ

Aï¼škubectl getsvc åº”è¯¥å¯ä»¥æŸ¥åˆ° clusteripï¼ŒæŽ¥ç€ Q3ï¼Œapp æ‹¿åˆ°å¤–é¢è®¿é—®çš„ address éƒ½æ˜¯ 127.0.0.1 çš„ã€‚

> Qï¼šæœåŠ¡çš„åº”ç”¨è¿è¡Œæ—¥å¿—åœ¨ Istio ä¸­å¦‚ä½•èŽ·å–æˆ–è€…æŸ¥çœ‹ï¼Œä¾‹å¦‚ log4j æŽ§åˆ¶å°çš„è¾“å‡ºï¼Ÿ

Aï¼šåº”ç”¨è¿è¡Œæ—¥å¿—å°±åœ¨åº”ç”¨å®¹å™¨ä¸Šçœ‹å•Šã€‚æˆ‘ä»¬æ˜¯é€šè¿‡æ ‡å‡†è¾“å‡ºæ”¶é›†åˆ°äº† InfluxDB ä¸­ã€‚

> Qï¼šEnvoy çš„ CPUã€å†…å­˜çš„ requestã€limit ä¸€èˆ¬é…ç½®å¤šå°‘ï¼Ÿ

Aï¼šæˆ‘ä»¬åŽ‹æµ‹çš„æ˜¯é»˜è®¤çš„ Envoy çš„èµ„æºé™åˆ¶ã€‚æ²¡æœ‰ä¿®æ”¹é»˜è®¤çš„èµ„æºé™åˆ¶ã€‚

> Qï¼šé‡Œé¢åœ¨é…åˆ Spring Clund æœ‰å¿…è¦å—ï¼Ÿ

Aï¼šæ„Ÿè§‰æ²¡å¿…è¦ï¼Œé‡å¤äº†ï¼ŒIstio è®©ç¨‹åºå‘˜æ›´å…³æ³¨ä¸šåŠ¡ï¼Œå°†ç»´æŠ¤ç®¡ç†åˆ†ç¦»

> Qï¼šæœ‰é…åˆ Alibaba Nacos è¯•è¯•å—å®žéªŒè½åœ°çš„æœ€å¥½ï¼Œconsul.etcd é€‰å“ªä¸ªå¥½ç‚¹ï¼Ÿ

Aï¼šæ²¡æœ‰ä½¿ç”¨è¿‡ AlibabaNacosï¼Œæˆ‘ä»¬æœªæ¥ä¼šèµ° Kubernetes çš„æœåŠ¡å‘çŽ°ï¼Œæ‰€ä»¥ä¼šé€‰æ‹© etcd å§ã€‚

> Qï¼šSpringCloud å‘ Istio è¿ç§»å¥½è¿ç§»å—ï¼Ÿ

Aï¼šæ¯”è¾ƒå¥½è¿ç§»ã€‚æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜ä¸»è¦å°±æ˜¯é€šè®¯çš„é—®é¢˜ã€‚æ¶‰åŠåˆ° Feign å’Œ gRPC ä¸¤ç§ã€‚éœ€è¦å‡çº§ä¸€ä¸‹ starterï¼Œä¼ é€’ä¸€ä¸‹ headerã€‚å› ä¸ºæˆ‘ä»¬çš„æµé‡æ ‡ç­¾æ˜¯åœ¨ header ä¸­ä¼ é€’ã€‚è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å°±æ˜¯åˆ†äº«é‡Œæåˆ°çš„ï¼ŒæœåŠ¡å‘çŽ°é—®é¢˜ã€‚å› ä¸ºè¦åšæ¸è¿›å¼å‡çº§ï¼Œä¸èƒ½ä¸€ä¸‹å°±ç»™æ‰€æœ‰çš„æœåŠ¡ä¸Š Istioï¼Œè¾¹ç¼˜æœåŠ¡å…ˆä¸Šï¼Œçƒ­é—¨æœåŠ¡åŽä¸Šï¼Œæ‰€ä»¥è¦å…¼å®¹ä¹‹å‰çš„æœåŠ¡å‘çŽ°ï¼ˆConsulï¼‰ï¼ŒåŒæ—¶æœ‰ä¸¤ä¸ªæœåŠ¡å‘çŽ°æœºåˆ¶çš„æ—¶å€™ä¼šæœ‰äº›é—®é¢˜ã€‚

---

### 2019-07-10ï¼šKube-OVN çš„è®¾è®¡æ€è·¯å’Œå®žçŽ°åŽŸç†

> Qï¼šèƒ½è¯´è¯´ç»„ä»¶ kube-ovn-cni å…·ä½“æ˜¯åšä»€ä¹ˆçš„ï¼ŸOVN æœ¬èº«ä¸æ˜¯å·²ç»æ˜¯ OVS çš„æŽ§åˆ¶é¢äº†ä¹ˆï¼Ÿ

Aï¼šå…¶å®žåšçš„æ˜¯å®¹å™¨ç½‘å¡å’Œ OVS çš„å¯¹æŽ¥ï¼ŒOVN é‚£è¾¹ç”Ÿæˆäº† port çš„ä¿¡æ¯ï¼Œéœ€è¦ kube-ovn-cni æŠŠè¿™ä¸ªä¿¡æ¯åŒæ­¥åˆ° OVS å’Œå®¹å™¨ç½‘å¡ã€‚

> Qï¼šèƒ½è®²è®² Kube-OVN è´Ÿè½½å‡è¡¡å’Œä¼šè¯ä¿æŒæ˜¯æ€Žä¹ˆåšçš„å—ï¼Ÿå·²ç»æ”¯æŒå“ªäº›ç­–ç•¥ï¼Ÿ

Aï¼šç›®å‰çš„è´Ÿè½½å‡è¡¡ç”¨çš„æ˜¯ OVN çš„ L2Loadbalancerï¼Œè¿™ä¸€å—çš„è´Ÿè½½å‡è¡¡è¿˜æ¯”è¾ƒç®€å•åªæ”¯æŒ IP Hashã€‚

> Qï¼šå¤šç§Ÿæˆ·/vpc æ¨¡å¼ä¸‹æ˜¯å¦å¯ä»¥äº’ç›¸ä¹‹é—´ç½‘æ®µå†²çªï¼Œå¦‚ä½•å®žçŽ° livenessProbeï¼Ÿ

Aï¼šè¿™å—æš‚æ—¶è¿˜ä¸æ”¯æŒï¼Œä¸»è¦æ˜¯ kubelet æ˜¯åœ¨ä¸»æœºçš„ network namespace è¿›è¡Œ probeï¼Œå…¶å®žå¯ä»¥æ”¹ kubelete ä»£ç è¿›å…¥åˆ°å¯¹åº”å®¹å™¨çš„ ns å† probe å°±å¯ä»¥äº†ï¼Œä½†æ˜¯è¿™å—éœ€è¦ upstream æ¥è¿›è¡Œæ”¯æŒï¼Œè‡ªå·±é­”æ”¹çŽ°åœ¨å€’ä¹Ÿæ˜¯ä¸ªæ–¹æ¡ˆã€‚

> Qï¼šKubernetes çš„ä¸šåŠ¡ä½¿ç”¨æœ¬èº«å°±æ˜¯æœ‰å±€é™çš„ï¼Œè¿™ç§æ— é™åˆ¶æ‰©å¤§è™šæ‹Ÿç½‘ç»œçš„åšæ³•ï¼ŒåŸºäºŽä¸šåŠ¡é£Žé™©å’Œæˆæœ¬æ¥è®²ï¼ŒçœŸçš„å¾ˆå‹‡æ•¢ï¼Œå¦‚æžœåŽŸæœ‰çš„ Kubernetes ç”Ÿæ€è¢«æ”¹æŽ‰äº†ï¼Œæ€Žä¹ˆä¿è¯å¼€æºçš„ä¸œè¥¿å¯ä»¥ä¸šåŠ¡å»¶ç»­ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜æœ‰ç‚¹å¤§ï¼Œæˆ‘ä»¬çŽ°åœ¨çœ‹åˆ°çš„è¶‹åŠ¿è¿˜æ˜¯ Kubernetes ä¸æ–­çš„å‘å±•ï¼Œå„ä¸ªä¸šåŠ¡éƒ½åœ¨å¾€ Kubernetes èµ°ï¼Œæˆ‘ä»¬åšè¿™ä¸ªå…¶å®žä¹Ÿå¸Œæœ›èƒ½å°½é‡å’Œ Upstream åŒæ­¥ï¼Œå¹¶ä¸”ä¹‹åŽå¯ä»¥åŽ»å½±å“ Upstreamã€‚è¿˜æœ‰å¾ˆå¤šå¤æ‚çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ IPv4/IPv6 çš„åŒæ ˆï¼Œå¤šç§Ÿæˆ·æˆ‘ä»¬æš‚æ—¶ä¹Ÿè¿˜æ²¡å¼€å§‹ï¼Œä¹Ÿæ˜¯å› ä¸º Upstream çŽ°åœ¨å¯¹è¿™å—çš„æ”¯æŒè¿˜ä¸å¥½

> Qï¼šå’Œ [ovn-kubernetes](https://github.com/ovn-org/ovn-kubernetes) çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šovn-kubernetes æˆ‘ä»¬ä¹‹å‰è°ƒç ”ä¸»è¦é—®é¢˜åœ¨äºŽä»–ä»¬æ˜¯å’Œ Flannel ç±»ä¼¼çš„ä¸€ä¸ªèŠ‚ç‚¹ä¸€ä¸ªå­ç½‘çš„æ¨¡åž‹ï¼Œå†å°±æ˜¯çœ‹ä»–ä»¬çš„ä»£ç è¿‡ç¨‹ä¸­å‘çŽ°æŽ§åˆ¶å¹³é¢å­˜åœ¨ç€ä¸¢æ¶ˆæ¯çš„éšæ‚£ã€‚æœ€åŽçœ‹åˆ°ç½‘ç»œæ¨¡åž‹å’ŒæŽ§åˆ¶å¹³é¢éƒ½è¦æ”¹ï¼Œå·¥ä½œé‡å¤ªå¤§äº†æˆ‘ä»¬å°±è‡ªå·±ä»Žå¤´æ¥äº†ã€‚

> Qï¼šå®¹å™¨å†…æµé‡é‡‡é›†ç›‘æŽ§æœ‰æ²¡æœ‰ä»€ä¹ˆå®žæˆ˜å’Œæƒ³æ³•ï¼Ÿ

Aï¼šç›®å‰è¿˜æ˜¯ç”¨çš„æ ‡å‡†çš„é‡‡é›†ç½‘å¡ä¸Š TXã€RX çš„ä¸€äº›æŒ‡æ ‡çš„åšæ³•ã€‚ä¸è¿‡ Kube-OVN ä¸ŠçŽ°åœ¨æœ‰æµé‡é•œåƒçš„èƒ½åŠ›ï¼Œæœªæ¥å…¶å®žå¯ä»¥åšæ›´è¯¦ç»†çš„åº”ç”¨å±‚æ•°æ®åŒ…åˆ†æžã€‚

> Qï¼šä½¿ç”¨ Flow è´Ÿè½½å‡è¡¡å™¨çš„æ€§èƒ½æ€Žä¹ˆæ ·ï¼Œæ˜¯å¦é€‚åˆä¸Šç”Ÿäº§çŽ¯å¢ƒï¼Ÿ

Aï¼šå¤§éƒ¨åˆ†çš„ Flow æ€§èƒ½é—®é¢˜éƒ½å¯ä»¥ç”¨ DPDK æ¥è§£å†³ï¼Œæˆ‘ä»¬ä¹‹å‰é—®è¿‡ä¸€äº›å…¬æœ‰äº‘çš„åŽ‚å•†æ€§èƒ½æ–¹é¢æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¯èƒ½åŠŸèƒ½æ–¹é¢æœ‰äº›ç®€å•ã€‚

> Qï¼šè¯·é—®ç½‘ç»œç›¸å…³çš„åŠŸèƒ½æ”¯æŒï¼Œç›®å‰æ˜¯åªé’ˆå¯¹ä»¥å¤ªç½‘ç»œå—ï¼Œä½ ä»¬æœ‰å¯¹å…¶å®ƒé«˜é€Ÿç½‘ç»œæœ‰æ”¯æŒä¸ï¼Ÿ

Aï¼šç›®å‰æ˜¯åªæœ‰ä»¥å¤ªç½‘ï¼Œä½†æ˜¯å…¶ä»–å½¢å¼çš„ç†è®ºä¸Šåªè¦ OVS æ”¯æŒï¼Œé€‚é…èµ·æ¥åº”è¯¥éƒ½æ¯”è¾ƒæ–¹ä¾¿ã€‚

> Qï¼šä½¿ç”¨ OVS å¯¹ Host æœºå™¨çš„æ€§èƒ½åŽ‹è¿«æœ‰å¤šå¤§ï¼Ÿ

Aï¼šæˆ‘ä»¬ç›®å‰çœ‹æ¥è¿˜å¥½ï¼ŒOVS æœ¬èº«å¸¦ cache çš„æœºåˆ¶ï¼Œä¸»è¦è¿˜æ˜¯ä¸šåŠ¡å¯¹æ€§èƒ½ç”¨çš„æ¯”è¾ƒå¤šä¸€äº›ã€‚

> Qï¼šTracing æ–¹é¢è·Ÿè¸ªæµè¡¨æœ‰æ²¡æœ‰æƒ³è¿‡åšè‡ªåŠ¨åŒ–ï¼Ÿ

Aï¼šæœ‰è¿‡è¿™ä¸ªè®¡åˆ’ï¼Œæ‰“ç®—ç»“åˆ ovn-tracingï¼Œovs-tracing å†åŠ ä¸Šå®¿ä¸»æœºçš„æŽ¢é’ˆåšä¸€ä¸ªç«¯åˆ°ç«¯çš„æ•°æ®åŒ…è·Ÿè¸ªï¼Œæ¥è§£å†³ç½‘ç»œä¸é€šæŽ’æŸ¥æ–¹é¢çš„é—®é¢˜ã€‚

> Qï¼škube-ovn-controller å¦‚æžœæ¥ä¸åŠå†™å…¥ podIP è¿™äº›ä¿¡æ¯ï¼ŒCNI æ’ä»¶èŽ·å–ä¸åˆ°åˆ†é…çš„ IP ä¿¡æ¯ï¼Œä¼šä¸ä¼šå¯¼è‡´ Pod åˆ›å»ºå¤±è´¥ï¼Œè¿˜æœ‰ ovn-cni æ˜¯èƒ½è¿‡ä»€ä¹ˆåè®®å’Œ ovn-cni-server è¿›è¡Œåä½œçš„ï¼Ÿ

Aï¼šæ¥ä¸åŠå†™å…¥çš„æƒ…å†µä¸‹ CNIServer ä¼šé‡è¯•ç­‰å¾… annotation readyï¼Œå¦‚æžœè¶…æ—¶çš„è¯ä¼šå¤±è´¥ç­‰ kubelet ä¸‹æ¬¡è°ƒç”¨ CNI çš„æ—¶å€™é‡æ–°èŽ·å–ä¿¡æ¯ã€‚CNI å’Œ CNIServer çŽ°åœ¨æ˜¯é€šè¿‡ä¸€ä¸ªæœ¬æœºçš„ socket èµ° http åè®®è¿›è¡Œé€šä¿¡ã€‚

> Qï¼šDPDK æ€Žä¹ˆæ»¡è¶³éœ€æ±‚ï¼Ÿä½¿ç”¨å®¹å™¨ï¼Œå¯ä»¥ç”¨ DPDK åŠ é€Ÿä¹ˆï¼Ÿ

Aï¼šDPDK ä¸»è¦åš OVS çš„æµè¡¨åŠ é€Ÿï¼Œç¤¾åŒºç”± ovs-dpdk çš„ bindingï¼Œå®¹å™¨ç›¸å½“äºŽç”¨çš„æ˜¯ OVS çš„ç½‘å¡ï¼Œè¿™æ · DPDK å°±å¯ä»¥åŠ é€Ÿå®¹å™¨çš„ç½‘ç»œã€‚

> Qï¼šè¯·é—®ä½ ä»¬åœ¨ä½¿ç”¨ç½‘ç»œç›¸å…³çš„åŠŸèƒ½æ—¶ï¼Œä¼šåœ¨æŸäº›åœºæ™¯å¯¹ç‰¹æƒæ¨¡å¼æœ‰å¼ºéœ€æ±‚å—ï¼Ÿ

Aï¼šéœ€è¦ä½¿ç”¨ç‰¹æƒæ¨¡å¼ï¼Œå› ä¸ºè¦å¯¹å®¿ä¸»æœºçš„ç½‘ç»œè¿›è¡Œä¸€äº›æ“ä½œã€‚

> Qï¼šåœ¨æ²¡æœ‰ç¡¬ä»¶äº¤æ¢æœºçš„æƒ…å†µï¼Œè¿™ä¸ªç½‘ç»œæ’ä»¶æ€Žä¹ˆåˆ©ç”¨è™šæ‹Ÿæœºæ¨¡æ‹Ÿäº¤æ¢æœºå‘¢ï¼Ÿ

Aï¼šè¿˜æ˜¯è¦æœ‰ç¡¬ä»¶äº¤æ¢æœºåšç‰©ç†ä¸Šçš„ç½‘ç»œè¿žé€šçš„ï¼Œè™šæ‹Ÿäº¤æ¢æœºæ˜¯åœ¨æœºå™¨ä¸­ç”¨è½¯ä»¶çš„æ–¹å¼æ¥æ¨¡æ‹Ÿäº¤æ¢æœºçš„è¡Œä¸ºï¼Œè¿™æ ·ä¸€å°æœºå™¨ä¸Šçš„å¤šä¸ªå®¹å™¨æˆ–è€…è™šæ‹Ÿæœºå°±å¥½åƒæŽ¥åœ¨äº†ä¸€ä¸ªç‰©ç†äº¤æ¢æœºä¸Šã€‚

---

### 2019-07-03ï¼šéœ‡å¤è¡Œçš„å®¹å™¨äº‘å®žè·µ

> Qï¼šKubernetes äº‘å¹³å°å’Œç‰©ç†æœºå¹³å°ï¼Œåœ¨æ€§èƒ½å¯¹æ¯”ä¸Šï¼ŒKubernetes å·®å¤šå°‘ï¼Ÿ

Aï¼š Kubernetes çš„æœ€å°å•å…ƒæ˜¯ Podï¼ŒPod æ˜¯è·‘åœ¨äº‘ä¸»æœºä¸Šçš„ã€‚æ•´ä¸ª Kubernetes éƒ½æ˜¯åŸºäºŽäº‘ä¸»æœº/ç‰©ç†æœºæ¥å®Œæˆçš„ã€‚

> Qï¼šæ•°æ®åº“é›†ç¾¤æ˜¯å¦é€‚åˆä¸¢åœ¨ Kubernetes ä¸Šï¼Œå¦‚æžœåƒä¸‡çº§çš„æ—¥æ´»æ˜¯å¦æœ‰å¥½çš„è§£å†³æž¶æž„ï¼Ÿ

Aï¼š é¦–å…ˆæ•°æ®åº“æ˜¯å¯ä»¥è·‘åœ¨ Kubernetes ä¸Šçš„ï¼Œæ•°æ®åº“é›†ç¾¤ç›´æŽ¥äº’è¿žçš„ IP æ˜¯å¯ä»¥é€šè¿‡ Kubernetes çš„å†…éƒ¨.svc.cluster.local æ¥ä»£æ›¿ã€‚å¦‚æžœè·‘æ•°æ®åº“é›†ç¾¤ï¼Œåˆ™éœ€è¦å°† Pod ä½¿ç”¨ç¡¬ç›˜ volume mount å°†æ•°æ®æ˜ å°„åˆ°ç¡¬ç›˜ä¸Šã€‚ç›®å‰æˆ‘ä»¬ DEVï¼ŒUAT çŽ¯å¢ƒçš„æ•°æ®åº“åœ¨é›†ç¾¤ä¸­ã€‚é’ˆå¯¹åƒä¸‡çº§çš„æ—¥æ´»ï¼Œä¸»è¦æ˜¯çœ‹ç“¶é¢ˆå¡åœ¨é‚£ä¸€å—ã€‚

> Qï¼šæ ¹æ®ä½ çš„æè¿°ï¼šä½ ä»¬æ˜¯ä»Ž 18 å¹´ 8 æœˆä»½å¼€å§‹ä½¿ç”¨å®¹å™¨çš„ï¼Œåˆ°çŽ°åœ¨ä¸€å…±æ˜¯ 11 ä¸ªæœˆï¼ŒæŠŠ Kubernetes è¿™å¥—ç”Ÿæ€è½åœ°åˆ°ç”Ÿäº§ï¼Œä½ ä»¬çš„ç­¹å¤‡æ˜¯å‡ ä¸ªé˜¶æ®µï¼Œç„¶åŽéš¾ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦å‘ç”Ÿé‡å¤§çš„ç”Ÿäº§äº‹æ•…ï¼Œæ€Žä¹ˆå¤„ç†çš„ï¼Ÿä½ ä»¬çš„åŽç«¯å­˜å‚¨ä½¿ç”¨çš„æ˜¯å•†ä¸šå­˜å‚¨æ•°æ®åº“è¿˜æ˜¯è‡ªå·±æ­å»ºçš„ Ceph ç­‰å¼€æºæ•°æ®åº“ï¼Ÿç”µå•†æ´»åŠ¨ä¸´æ—¶è´­ä¹°é˜¿é‡Œæˆ–è€…è…¾è®¯äº‘æœºå™¨ï¼Œæ–°å¢žä¸åŒæœºæˆ¿ Node èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå»¶è¿Ÿå¦‚ä½•è§£å†³çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯åˆ†ä¸ºäº†ä¸‰ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯æµ‹è¯• Kubernetesï¼Œä¸€ä¸ªæ˜¯æµ‹è¯•ä¸šåŠ¡æŽ¥å…¥ï¼Œä¸€ä¸ªæ˜¯æµ‹è¯•æŽ¥å…¥ä¸šåŠ¡çš„ç¨³å®šæ€§ã€‚éš¾ç‚¹å°±åœ¨äºŽä»¥å‰çš„æž¶æž„æ•´æ”¹ï¼ŒåŒ…æ‹¬ Kubernetes ç»“åˆå¾®æœåŠ¡ã€‚é‡å¤§çš„ç”Ÿäº§äº‹æ•…æœªå‘ç”Ÿè¿‡ï¼Œå› ä¸ºæ¶‰åŠåˆ° Ingressã€ç½‘å…³ç­‰å…¥å£æœåŠ¡ï¼Œä¸€èˆ¬éƒ½æ˜¯å¤šå¤‡ä»½ã€‚æˆ‘ä»¬åŽç«¯çš„æ•°æ®åº“ï¼Œæ˜¯åœ¨é˜¿é‡Œäº‘è´­ä¹°çš„ï¼ŒDEVï¼ŒUAT æ•°æ®åº“æ˜¯å¼€æºè‡ªå»ºçš„ã€‚ç”µå•†æ´»åŠ¨å‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯ä¼šè´­ä¹°æŒ‰é‡ä»˜è´¹çš„æœºå™¨ï¼Œæˆ‘ä»¬è´­ä¹°çš„éƒ½æ˜¯é˜¿é‡Œäº‘ã€‚

> Qï¼šç”Ÿäº§çŽ¯å¢ƒä¼šè·Ÿç€ç¤¾åŒºç‰ˆæœ¬ç§¯æžæ›´æ–° Kubernetes ç‰ˆæœ¬ä¸ï¼Ÿæˆ–è€…ä»€ä¹ˆé¢‘çŽ‡ï¼Ÿ

Aï¼šè¿™ä¸ªä¸€èˆ¬ä¸ä¼šè·Ÿç€ç¤¾åŒºç§¯æžæ›´æ–°ï¼Œé™¤éžæ˜¯å½“å‰ç‰ˆæœ¬å‡ºçŽ°é‡å¤§ bugï¼Œæˆ–è€…æ–°åŠŸèƒ½æ¯”è¾ƒé€‚ç”¨äºŽæˆ‘ä»¬ï¼Œæ‰ä¼šè€ƒè™‘æ›´æ–°ã€‚

> Qï¼šIstio æœ‰æ²¡æœ‰è¿›è¡Œä¼˜åŒ–ï¼ŒQPS å¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿå¦‚æœ‰ä¼˜åŒ–éƒ½æ˜¯ä»Žé‚£äº›æ–¹é¢è¿›è¡Œä¼˜åŒ–çš„ï¼Ÿ

Aï¼šIstio ç›®å‰æ˜¯è¿›è¡Œè¿‡ä¼˜åŒ–çš„ï¼Œä¼˜åŒ–çš„ç»†èŠ‚æš‚æ—¶è¿˜æœªç»Ÿè®¡ã€‚å½“å‰çš„ QPS æˆ‘ä»¬å¤§çº¦æ˜¯æ¯ç§’ 5000 ä¸ªå·¦å³å§ã€‚æ›´å…·ä½“çš„è¦çœ‹ä¸šåŠ¡ã€‚

> Qï¼šæœ‰åœ¨ç”¨ç»Ÿä¸€çš„æ–‡ä»¶å­˜å‚¨å—ï¼Ÿä¸åŒç”¨æˆ·é—´ä¼šè€ƒè™‘åšéš”ç¦»ä¸ï¼Ÿ

Aï¼šç»Ÿä¸€çš„æ–‡ä»¶å­˜å‚¨æœ‰ï¼Œä½†æ˜¯ç›®å‰ä¸»è¦æ˜¯æ‹¿æ¥æ”¾æ—¥å¿—ï¼Œå…±äº«ç­‰ã€‚ä¸é€šç”¨æˆ·é—´çš„éš”ç¦»ä¸å¤ªæ¸…æ¥šæ˜¯å•¥æ„æ€ï¼Œä½†æ˜¯æ¯ä¸ª Pod ä¹‹é—´æ˜¯éš”ç¦»çš„ã€‚æˆ‘ä»¬åœ¨ DevOps å¹³å°æ˜¯æœ‰æƒé™ç®¡ç†æ¨¡å—çš„ã€‚

> Qï¼šé—®ä¸‹ä½ ä»¬çš„æ—¥å¿—é‡‡é›†æ–¹æ¡ˆæ˜¯æ€Žä¹ˆåšçš„ï¼Ÿæ—¥å¿—æ˜¯å¦å†™åœ¨å®¹å™¨é‡Œï¼Ÿå¦å¤–å†é—®ä¸‹ Kubernetes çš„ CRI æ˜¯ç”¨çš„ Docker å—ï¼Ÿè¿˜æ˜¯ç”¨å…¶ä»–çš„ï¼Œè°¢è°¢ã€‚

Aï¼šæ—¥å¿—æ”¶é›†æ˜¯é€šè¿‡ ELK + äºŒæ¬¡å¼€å‘æ¥å®Œæˆçš„ã€‚æ—¥å¿—ä¹Ÿä¼šä¹Ÿåœ¨å®¹å™¨é‡Œï¼Œå†™å®¹å™¨é‡Œè¾¹éšç€ä¸‹ä¸€æ¬¡å‘å¸ƒæ—¥å¿—å°±ä¼šæ¶ˆå¤±ã€‚æ˜¯ Dockerã€‚

> Qï¼šEureka å’Œ Istio ä¸æ˜¯åŒä¸€ç±»ä¸œè¥¿å§ï¼Œä½œç”¨éƒ½ä¸ä¸€æ ·ï¼Œæ€Žä¹ˆç†è§£æ›¿æ¢ä¸æ›¿æ¢ï¼Ÿ

Aï¼šçœ‹æž¶æž„ç±»åž‹ç”¨åˆ°é‚£ä¸ªç»„ä»¶å§ï¼ŒIstio æœ¬èº«å…·å¤‡æœåŠ¡å‘çŽ°åŠŸèƒ½ï¼Œæˆ‘ä»¬åˆšå¥½æ˜¯æœåŠ¡å‘çŽ°è¿™ä¸€å—æœ‰é—®é¢˜ã€‚

> Qï¼šä½ ä»¬çš„ Kubernetes é›†ç¾¤èŠ‚ç‚¹è§„æ¨¡æœ‰å¤šå¤§ï¼Ÿæ—¥æ´»ï¼ŸKubernetes è¿ç»´å›¢é˜Ÿå¤šå°‘äººï¼Ÿ

Aï¼š Kubernetes é›†ç¾¤èŠ‚ç‚¹æœ‰ï¼Œdev 24 å° 4C 32Gï¼ŒUAT 30 å° 4C32Gï¼Œç”Ÿäº§ 67 å° 8C 64Gï¼ŒKubernetes è¿ç»´å›¢é˜Ÿ 2 ä¸ªäººã€‚

> Qï¼šæ›´æ¢æˆ Istio ä¹‹åŽï¼Œå°±ä¸éœ€è¦å•ç‹¬éƒ¨ç½² Ingress äº†å§ï¼Ÿ

Aï¼šéœ€ä¸éœ€è¦ä¸ç”¨ Ingressï¼Œå…·ä½“è¿˜æ˜¯å¾—çœ‹ä¸‹ä¸šåŠ¡ç±»åž‹ã€‚æˆ‘ä»¬æ˜¯å¾®æœåŠ¡ API ç±»çš„ï¼Œèµ°çš„ Istioï¼Œé™æ€é¡µé¢ç±»ï¼ŒCDN --> Ingress ã€‚æˆ–è€…æ˜¯ CDN --> SLB --> Podã€‚

> Qï¼šè¯·é—® Kubernetes å¦‚ä½•å’Œäº‘æœåŠ¡çš„å¼¹æ€§ä¼¸ç¼©é…åˆä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œå› ä¸ºä¸šåŠ¡éœ€è¦ï¼ŒçŸ­æ—¶é—´å†…ä»Ž 2 å°èŠ‚ç‚¹æ‰©å±•åˆ°åå¤šå°èŠ‚ç‚¹ã€‚å¯ä»¥åšåˆ°åƒäº‘æœåŠ¡çš„å¼¹æ€§ä¼¸ç¼©é‚£æ ·å—ï¼Ÿä¸æå‰é…ç½®èŠ‚ç‚¹ï¼Œæˆ–è€…å¦‚ä½•è®© Kubernetes è‡ªå·±è§¦å‘äº‘æœåŠ¡çš„å¼¹æ€§ï¼Œè‡ªåŠ¨æ·»åŠ äº‘æœåŠ¡çš„å¼¹æ€§èŠ‚ç‚¹ã€‚

Aï¼šæˆ‘ä»¬ä¸€èˆ¬ä¼šå¯¹å®¹å™¨äº‘çš„ ECS èµ„æºä¿ç•™ 20%-25%ã€‚å¦‚æžœå‘çŽ°èµ„æºä¸å¤Ÿäº†ï¼Œå°±ä¼šæå‰è´­ä¹° ECS åŠ è¿›åŽ»ã€‚çŸ­æ—¶é—´æ‰©å®¹ Node å‡ ç‚¹çš„è¯ï¼Œå°±å¤šè´­ä¹°å‡ å° ECS åŒæ—¶åŠ è¿›åŽ»å°±å¯ä»¥äº†ã€‚Pod æ˜¯å¯ä»¥åšå¼¹æ€§ä¼¸ç¼©ï¼ŒECS äº‘ä¸»æœºä¹Ÿå¯ä»¥åšå¼¹æ€§ä¼¸ç¼©å¢žåŠ åˆ° Kubernetes é›†ç¾¤é‡Œè¾¹ï¼Œè¿™ä¸ªé˜¿é‡Œäº‘æä¾›æœåŠ¡çš„ã€‚

> Qï¼šEureka æ˜¯ç±»ä¼¼ Dubbo çš„æ³¨å†Œä¸­å¿ƒå—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼ŒEureka ä¹Ÿæä¾›é¡µé¢ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°æœ‰å¤šå°‘ä¸ªæœåŠ¡æ³¨å†Œè¿›æ¥ã€‚

> Qï¼šè¯·é—®ä¸€ä¸‹æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒçš„ IP æ˜¯å®¹å™¨å†… IP çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯å°†æ³¨å†Œä¸­å¿ƒéƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­çš„ã€‚æ³¨å†Œä¸­å¿ƒçš„å†…ç½‘ IP å’Œ Kubernetes çš„å†…ç½‘æ˜¯äº’ç›¸å¯ä»¥é€šä¿¡çš„ã€‚

---

### 2019-06-26ï¼šæ™ºèƒ½å·¥åŽ‚çš„å®¹å™¨äº‘å®žè·µ

> Qï¼šæ‚¨è®¤ä¸ºæœªæ¥å·¥ä¸š PaaS äº‘å¹³å°çš„å‘å±•å‰æ™¯å’Œå‘å±•æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ

Aï¼šå·¥ä¸šåœºæ™¯æœ¬èº«æ˜¯åƒå·®ä¸‡åˆ«çš„ï¼ŒçŸ³æ²¹ã€é‡‘å±žã€åˆ¶é€ ä¸šç­‰ç­‰ï¼Œéƒ½æœ‰è‡ªå·±å„è‡ªçš„éœ€æ±‚ï¼Œç›®å‰æ¥çœ‹çš„è¯ï¼Œä¸»è¦è¿˜æ˜¯è¦å…ˆå®Œæˆä¿¡æ¯åŒ–æ”¹é€ ï¼Œç„¶åŽæ‰èƒ½ä»¥æ­¤ä¸ºåŸºç¡€åŽ»åšåŽç»­çš„æ¯”å¦‚å·¥è‰ºä¼˜åŒ–ç­‰ç­‰ã€‚åŽç»­åº”è¯¥ä¼šå…¬æœ‰äº‘ã€ç§æœ‰äº‘å¹¶å­˜ï¼Œå¤§é›†å›¢åž‹å…¬å¸èµ°ç§æœ‰äº‘æ¨¡å¼ï¼Œä¸­å°åž‹å…¬å¸èµ°å…¬æœ‰äº‘æ¨¡å¼ã€‚

> Qï¼šç”Ÿäº§å¾ˆåœ¨ä¹Žé«˜å¯ç”¨å’Œæ•°æ®çš„å®‰å…¨æ€§ï¼ŒKubernetes å¦‚ä½•ä¿è¯æŒç»­å­˜å‚¨å’Œç¨³å®šæ€§ï¼Œå•é å‰¯æœ¬é›†å’Œé›†ç¾¤åœ¨ç½‘ç»œäº‹æ•…å‘ç”ŸåŽï¼Œå¦‚ä½•å¿«é€Ÿè¿ç§»æ¢å¤ï¼Ÿè…¾è®¯çš„çŽ‹è€…è£è€€é‡‡ç”¨äº†æ¯”è¾ƒè€çš„ Kubernetes ç‰ˆæœ¬å¹¶è¿›è¡Œäº†å¼€å‘ï¼Œæ‰ä½¿ç”¨åœ¨äº†ç”Ÿäº§ï¼Œä¸­å°åž‹ä¼ä¸šå¦‚ä½•ä¾é è‡ªå·±çš„ç ”å‘å®žåŠ›åŽ»å¤„ç†ç”Ÿäº§äº‹æ•…ã€‚

Aï¼šç›®å‰æˆ‘ä»¬é‡åˆ°çš„ç”Ÿäº§äº‹æ•…ä¸»è¦åœ¨äºŽæœºæˆ¿çš„å¶å‘æ€§æ–­ç”µå¯¼è‡´å­˜å‚¨èŠ‚ç‚¹ä¸Šçš„æ•°æ®å‡ºçŽ°æ•…éšœï¼ŒçŽ°åœ¨çš„è¯æ˜¯é‡‡ç”¨ 3 ä¸ªå­˜å‚¨èŠ‚ç‚¹çš„ 3 å‰¯æœ¬æ–¹å¼ï¼Œæ¥ä¿éšœæ•°æ®çš„å¯é æ€§ã€‚é«˜å¯ç”¨ç›®å‰è¿˜æ˜¯ä¾èµ–å‰¯æœ¬é›†çš„å½¢å¼æ¥ä¿éšœã€‚å¯¹äºŽå·¥åŽ‚æ¥è¯´ï¼Œå¾ˆå°‘ä¼šå‡ºçŽ°äº’è”ç½‘è¿™æ ·çš„æµé‡å³°å€¼ï¼ŒåŸºæœ¬éƒ½æ˜¯å¹³ç¨³çš„ã€‚

> Qï¼šKubernetes çš„åœ¨çº¿çƒ­å‡çº§å®¹æ˜“åšå—ï¼Œè¯·é—®æ˜¯ä¸æ˜¯è¸©è¿‡å¾ˆå¤šå‘å‘¢ï¼Ÿ

Aï¼šç›®å‰å¯¹äºŽ Kubernetes çš„çƒ­å‡çº§ï¼Œä¸»è¦æ˜¯å¤§ç‰ˆæœ¬å˜åŠ¨ä¼šå¸¦æ¥ä¸€äº›é…ç½®ä¸Šçš„æ”¹åŠ¨ï¼Œå› ä¸ºå…¨éƒ¨å®¹å™¨åŒ–ï¼Œæ‰€ä»¥å‡çº§æœ¬èº«ä¸å¤æ‚ã€‚

> Qï¼šçŽ°åœ¨ç”Ÿäº§æœåŠ¡çš„è§„æ¨¡å¤šå¤§ï¼ŒæœåŠ¡æ•°é‡ï¼Œæµæ°´çº¿æ˜¯æ¯ä¸ªé¡¹ç›®ç±»åž‹ä¸€ä¸ªå…¬å…±æž„å»ºé¡¹ç›®å—ï¼Ÿé’ˆå¯¹å¤šåˆ†æ”¯æž„å»ºå¦‚ä½•å¿«é€ŸæŒç»­é›†æˆï¼Ÿé’ˆå¯¹æœåŠ¡çš„ç‰¹æ®ŠåŒ–éœ€æ±‚æ¯”å¦‚ Pipeline çš„æŸä¸ª stage è¦è·³è¿‡æ€Žä¹ˆåŠžï¼Œæ¯ä¸ªé¡¹ç›®ä¸€ä¸ªæ ‡å‡†çš„ Jenkinsfile å—ï¼Ÿ

Aï¼šæœåŠ¡æ•°é‡æ ¹æ®ä¸åŒçš„é¡¹ç›®è§„æ¨¡ï¼Œå„æœ‰ä¸åŒï¼Œæ™ºèƒ½å·¥åŽ‚é¡¹ç›®æœ¬èº«æ˜¯ä¸€ä¸ªå¾ˆåºžå¤§çš„é¡¹ç›®ï¼Œä¸‹é¢ä¼šåˆ†å¾ˆå¤šçš„å­é¡¹ç›®ï¼Œç›®å‰æ¥çœ‹ï¼Œä¸€èˆ¬çš„å­é¡¹ç›®æœåŠ¡æ•°é‡æ˜¯åœ¨ 50 ä¸ªä»¥å†…ã€‚ç›®å‰æˆ‘ä»¬è¿˜æ²¡è€ƒè™‘å¤šåˆ†æ”¯æƒ…å†µï¼Œå› ä¸ºé¡¹ç›®ä¸åƒè‡ªå·±è¿ç»´çš„äº§å“ï¼Œä¸ä¼šå­˜åœ¨é¢‘ç¹çš„æ›´æ–°ï¼Œæˆ‘ä»¬æ˜¯æŒ‰ç‰ˆæœ¬å½¢å¼åŽ»èµ°ï¼Œæ‰€æœ‰çš„æäº¤æœ€åŽéƒ½è¦æ±‡æ€»åˆ°ä¸»å¹²åˆ†æ”¯åŽï¼Œå†æ‰“åŒ…å‘åˆ°çŽ°åœºã€‚ç›®å‰è¿˜æ²¡æœ‰è·³è¿‡ stage çš„éœ€æ±‚ã€‚

> Qï¼šJenkins å¯¹å¼€å‘å’Œæµ‹è¯•äººå‘˜å¯è§å—ï¼Ÿå¦‚æžœå¯è§ï¼Œæœ‰æ²¡æœ‰è€ƒè™‘å°è£… Jenkinsï¼Œå¦‚æžœä¸å¯è§ï¼ŒJenkins æ—¥å¿—æ€Žä¹ˆæš´éœ²çš„ï¼Ÿæ¯æ¬¡æž„å»ºéƒ½è¦å¡«é‚£ä¹ˆå¤šä¿¡æ¯æ„Ÿè§‰å¾ˆå¤æ‚ï¼Ÿæœ‰æ²¡æœ‰æ”¹å»ºæŽªæ–½ï¼Ÿ

Aï¼šç›®å‰æ˜¯å¯è§çš„ï¼Œä½†æ˜¯æ²¡æœ‰ä¿®æ”¹æƒé™ï¼Œå¯ä»¥ç›´æŽ¥åŽ»çœ‹æž„å»ºæ—¥å¿—ã€‚

> Qï¼šWindows èŠ‚ç‚¹æ”¯æŒæƒ…å†µï¼Ÿ

Aï¼šæˆ‘ä»¬ä¼šæœ‰ä¸€äº›åœºæ™¯éœ€è¦ç”¨åˆ° Windows æœåŠ¡å™¨ï¼Œå¹¶ä¸”å®ƒéœ€è¦è·Ÿå®¹å™¨äº‘å†…éƒ¨çš„æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚

> Qï¼šè¯·é—® Jenkinswebhook é‚£äº›æž„å»ºå‚æ•°å¦‚ä½•ä¼ å…¥ GitLab è§¦å‘ï¼Ÿ

Aï¼šwebhook çš„è§¦å‘å’Œç•Œé¢å‚æ•°ä¼šæœ‰ä¸€äº›åŒºåˆ«ï¼Œæˆ‘ä»¬åœ¨è„šæœ¬é‡Œé¢åšäº†å¤„ç†ã€‚

> Qï¼šç¦»çº¿éƒ¨ç½²ï¼Œæ˜¯ä¸æ˜¯é€šè¿‡æ‰“å‡ºé•œåƒåŽ‹ç¼©åŒ…ï¼Œç„¶åŽå¸¦ç€é•œåƒåŒ…åˆ°çŽ°åœºéƒ¨ç½²çš„å®¹å™¨äº‘å¹³å°ä¸Šï¼Œä¸Šä¼ éƒ¨ç½²çš„æ–¹å¼ï¼Ÿ

Aï¼šæ˜¯åœ¨å®¶é‡Œæ‰“å‡ºé•œåƒåŽ‹ç¼©åŒ…ï¼Œç„¶åŽåˆ°çŽ°åœºè§£åŽ‹å‡ºæ¥ï¼Œæ ¹æ®é•œåƒç±»åž‹è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚ä¸€äº›åŸºç¡€é•œåƒï¼Œä¼šç›´æŽ¥ä¸Šä¼ åˆ°èŠ‚ç‚¹ï¼Œä¸šåŠ¡çš„é•œåƒä¼šåœ¨éƒ¨ç½²å®ŒæˆåŽä¸Šä¼ åˆ° Harborï¼Œç„¶åŽèŠ‚ç‚¹ä»Ž Harbor åŽ»æ‹‰å–ã€‚

---

### 2019-06-05ï¼šåŸºäºŽ Actor æ¨¡åž‹çš„ CQRS/ES è§£å†³æ–¹æ¡ˆåˆ†äº«

> Qï¼šå•ç‚¹æ•…éšœåŽï¼Œæ­£åœ¨å¤„ç†çš„ Cache æ•°æ®å¦‚ä½•å¤„ç†çš„ï¼Œä¾‹å¦‚ï¼Œhttpã€tcp è¯·æ±‚......æ¯•ç«Ÿæ¶‰åŠåˆ°é’±ï¼Ÿ

Aï¼šactor æœ‰æ¿€æ´»å’Œå¤±æ´»çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¿€æ´»çš„æ—¶å€™ä½¿ç”¨å¿«ç…§å’Œ Events æ¥æ¢å¤æœ€æ–°å†…å­˜çŠ¶æ€ï¼Œå¤±æ´»çš„æ—¶å€™ä¿å­˜å¿«ç…§ã€‚actor æ¡†æž¶ä¿è¯ç³»ç»Ÿä¸­åŒä¸€ä¸ª key åªä¼šå­˜åœ¨åŒä¸€ä¸ª actorï¼Œå½“å•ç‚¹æ•…éšœåŽï¼Œactor ä¼šåœ¨å…¶å®ƒèŠ‚ç‚¹é‡å»ºå¹¶æ¢å¤æœ€æ–°çŠ¶æ€ã€‚

> Qï¼ševentID ç”Ÿæˆçš„é€Ÿåº¦å¦‚ä½•ä¿è¯æœ‰æ•ˆçš„ scaleï¼Ÿæœ‰æ²¡æœ‰é‡åˆ°éœ€è¦åŽæœŸæ’å…¥ä¸€äº› eventï¼Œä¿®æ­£å‰æœŸç³»ç»Ÿè¿è¡Œçš„ bugï¼Ÿæœ‰æ²¡æœ‰é‡åˆ°éœ€è¦æŠŠå‰æœŸå·²ç»å®šå¥½çš„ event å†æ‹†ç»†çš„æƒ…å†µï¼Ÿæœ‰é‡åˆ°ç³»ç»Ÿé”™è¯¯ï¼Œéœ€è¦ replayevent çš„æƒ…å†µï¼Ÿ

Aï¼šå½“æ—¶é¡¹ç›®ä¸­ eventID é‡‡ç”¨äº† MongoDB çš„ ObjectId ç”Ÿæˆç®—æ³•ï¼Œæ²¡æœ‰é‡åˆ°é—®é¢˜ï¼›æœ‰é‡åˆ°åŽæœŸæ’å…¥ event ä¿®æ­£ä¹‹å‰ bug çš„æƒ…å†µï¼›æœ‰é‡åˆ°å°†å·²å®šå¥½çš„ event ä¿®æ”¹çš„æƒ…å†µï¼Œé‡‡ç”¨çš„æ–¹å¼æ˜¯åŠ ç‰ˆæœ¬å·ï¼›æ²¡æœ‰ï¼Œé‡åˆ°è¿‡ç³»ç»Ÿé‡æ–°è¿ç§»åˆ é™¤å¿«ç…§é‡æ–° replayevent çš„æƒ…å†µã€‚

> Qï¼šæ•°æ®è½åœ°å¾—ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿè¿˜æ˜¯è¯´å°±æ˜¯ç›´æŽ¥è½åœ°ï¼Ÿ

Aï¼ševent æ•°æ®ç›´æŽ¥è½åœ°ï¼›ç”¨äºŽæ”¯æŒæŸ¥è¯¢çš„æ•°æ®ï¼Œæ˜¯ Handler æ¶ˆè´¹ event åŽå¼‚æ­¥è½åº“ã€‚

> Qï¼šactor è·¨ç‰©ç†æœºå™¨é›†ç¾¤äº‹åŠ¡æ€Žä¹ˆå¤„ç†ï¼Ÿ

Aï¼šç»“åˆäº‹ä»¶æº¯æºï¼Œé‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§ã€‚

> Qï¼šGrain Persistence ä½¿ç”¨ RelationalStorage å®¹é‡å’Œé€Ÿåº¦ä¼šä¸ä¼šæ˜¯ç“¶é¢ˆï¼Ÿ

Aï¼šGrainPersistence å­˜çš„æ˜¯ Grain çš„å¿«ç…§å’Œ eventï¼Œevent æ˜¯åªå¢žçš„ï¼Œé€Ÿåº¦æ²¡æœ‰å‡ºçŽ°ç“¶é¢ˆï¼Œè€Œä¸”å¼€æºç‰ˆæœ¬æµ‹è¯•ä¸­ PostgreSQL æ€§èƒ½ä¼˜äºŽ MongoDBï¼Œåœ¨å­˜å‚¨ä¸­é’ˆå¯¹è¿™ä¸¤ä¸ªæ–¹é¢åšäº†ä¼˜åŒ–ï¼šæ¯”å¦‚åˆ†è¡¨ã€å½’æ¡£å¤„ç†ã€å¿«ç…§å¤„ç†ã€æ‰¹é‡å¤„ç†ã€‚

Aï¼šå¼€å‘è¯­è¨€æ˜¯ C\#ã€‚Golang æˆ‘äº†è§£çš„ä¸å¤šï¼Œproto.actor å¯ä»¥äº†è§£ä¸€ä¸‹ï¼š[AsynkronIT/protoactor-go](https://github.com/AsynkronIT/protoactor-go)ã€‚

> Qï¼šæ¯ä¸ª Pod çš„ actor éƒ½ä¸ä¸€æ ·ï¼Œå¦‚ä½•ç”¨ Kubernetes éƒ¨ç½² actorï¼Œå¤±è´¥çš„èŠ‚ç‚¹å¦‚ä½•ç›‘æŽ§ï¼Œå¹¶å€ŸåŠ© Kubernetes è‡ªåŠ¨æ¢å¤ï¼Ÿ

Aï¼šactor æ˜¯æ— çŠ¶æ€çš„ï¼Œå¤±è´¥æ¢å¤ä¾é é‡æ–°æ¿€æ´»æ—¶äº‹ä»¶æº¯æºæœºåˆ¶ã€‚Kubernetes éƒ¨ç½² actor å®˜æ–¹æœ‰æ”¯æŒï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹ç¤ºä¾‹ã€‚åœ¨å®žé™…é¡¹ç›®ä¸­ä½¿ç”¨ Kubernetes éƒ¨ç½² Orleansï¼Œæˆ‘æ²¡æœ‰å®žè·µè¿‡ï¼ŒåŽæ¥æœ‰åŒäº‹éªŒè¯è¿‡å¯ä»¥ï¼Œå…·ä½“å¦‚ä½•ç›‘æŽ§ä¸æ¸…æ¥šã€‚

> Qï¼šOrleans ä¸­ï¼ŒæŒä¹…åŒ–äº‹ä»¶æ—¶ï¼Œæ˜¯å¦æœ‰æ”¯æŒå¹¶å‘å†²çªçš„æ£€æµ‹ï¼Œæ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šOrleans ä¸æ”¯æŒï¼›å·¥ä½œä¸­ï¼Œåœ¨äº‹ä»¶æŒä¹…åŒ–æ—¶åšäº†è¿™æ–¹é¢çš„å·¥ä½œï¼Œæ–¹å¼æ˜¯æ ¹æ®ç‰ˆæœ¬å·ã€‚

> Qï¼šOrleans ä¸­ï¼Œå¦‚ä½•åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦é‡å¤å¤„ç†çš„ï¼Ÿå› ä¸ºåˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹ï¼ŒåŒä¸€ä¸ªæ¶ˆæ¯å¯èƒ½ä¼šè¢«é‡å¤å‘é€åˆ° actormailbox ä¸­çš„ï¼Œè€Œ actor æœ¬èº«æ— æ³•æ£€æµ‹æ¶ˆæ¯æ˜¯å¦é‡å¤è¿‡æ¥ã€‚

Aï¼šæ˜¯çš„ï¼Œåœ¨å…·ä½“é¡¹ç›®ä¸­ï¼Œé€šè¿‡æ¡†æž¶å°è£…å®žçŽ°äº†å¹‚ç­‰æ€§æŽ§åˆ¶ï¼Œå…·ä½“ç»†èŠ‚æ˜¯é€šè¿‡æ’å…¥äº‹ä»¶çš„å”¯ä¸€ç´¢å¼•ã€‚

> Qï¼šåŒä¸€ä¸ª actor æ˜¯å¦ä¼šå­˜åœ¨äºŽé›†ç¾¤ä¸­çš„å¤šå°æœºå™¨ï¼Ÿå¦‚æžœå¯èƒ½ï¼Œæ€Žæ ·çš„åœºæ™¯ä¸‹å¯èƒ½ä¼šå‡ºçŽ°è¿™ç§æƒ…å†µï¼Ÿ

Aï¼šä¸€ä¸ª Id å¯¹åº”çš„ Actor åªä¼šåœ¨é›†ç¾¤ç§å­˜åœ¨ä¸€ä¸ªã€‚

---

### 2019-05-29ï¼šå¹³å®‰è¯åˆ¸ Kubernetes å®¹å™¨é›†ç¾¤çš„ DevOps å®žè·µ

> Qï¼šé•œåƒæœ‰è¿›è¡Œå®‰å…¨æ‰«æå—ï¼š

Aï¼šå¤–éƒ¨åŸºæœ¬é•œåƒè¿›å…¥å…¬å¸å†…éƒ¨ï¼Œæˆ‘ä»¬åŸºäºŽ Harbor å†…ç½®çš„å®‰å…¨åŠŸèƒ½è¿›è¡Œæ‰«æã€‚

> Qï¼šHarbor æœ‰æ²¡æœ‰åšç›¸å…³ç›‘æŽ§ï¼Œæ¯”å¦‚å‘å¸ƒäº†å¤šå°‘é•œåƒï¼Œä»¥åŠé•œåƒåŒæ­¥æ—¶é•¿ä¹‹ç±»çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬æ²¡æœ‰åœ¨ Harbor ä¸Šä½œæ‰©å±•ï¼Œåªæ˜¯åœ¨æˆ‘ä»¬è‡ªå·±çš„ Prism4k ä¸Šï¼Œä¼šç»Ÿè®¡å„ä¸ªé¡¹ç›®çš„ä¸€äº›é•œåƒå‘å¸ƒæ•°æ®ã€‚

> Qï¼šæœ‰æ²¡æœ‰ç”¨ Helm æ¥ç®¡ç†é•œåƒåŒ…ï¼ŸåŽç«¯å­˜å‚¨æ˜¯ç”¨çš„ä»€ä¹ˆï¼ŒåŽŸå› æ˜¯ï¼Ÿ

Aï¼šæ²¡æœ‰ä½¿ç”¨ Helmã€‚ç›®å‰é›†ç¾¤æœ‰å­˜å‚¨éœ€æ±‚æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ NFSã€‚æ­£åœ¨è€ƒè™‘å»ºåŸºäºŽ Ceph çš„å­˜å‚¨ï¼Œå› ä¸ºçŽ°åœ¨æŽ¥å…¥é¡¹ç›®è¶Šæ¥è¶Šå¤šï¼Œä¸åŒçš„éœ€æ±‚ä¼šå¯¼è‡´ä¸åŒçš„å­˜å‚¨ã€‚

> Qï¼šæƒ³äº†è§£ä¸‹ç›®å‰è´µå…¬å¸ç›‘æŽ§çš„çº¬åº¦å’Œç›‘æŽ§çš„æŒ‡æ ‡å’Œå‘Šè­¦è¿™å—ã€‚

Aï¼šç›‘æŽ§æ–¹é¢ï¼Œæˆ‘å…¬å¸ä¹Ÿæ˜¯å¤§è‡´å¤§è‡´åˆ’åˆ†ä¸ºåŸºç¡€èµ„æºï¼Œä¸­é—´ä»¶ï¼Œä¸šåŠ¡æŒ‡æ ‡ä¸‰å¤§å—ç›‘æŽ§ã€‚æ–¹æ³•è®ºä¸Šä¹Ÿæ˜¯åŠªåŠ›åœ¨å‘ä¸šç•Œæå€¡çš„ RED åŽŸåˆ™é æ‹¢ã€‚

> Qï¼šæƒ³äº†è§£ä¸‹ï¼ŒYaml æ–‡ä»¶æ€Žä¹ˆç®¡ç†çš„ï¼Œå¯ä»¥è‡ªå®šä¹‰ç”Ÿæˆå—ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ Yaml æ–‡ä»¶ï¼Œéƒ½ç»Ÿä¸€çº³åˆ° Prism4k å¹³å°ç®¡ç†ï¼Œæœ‰ä¸€äº›èµ„æºæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œä¸”é’ˆå¯¹ä¸åŒçš„é¡¹ç›®ï¼Œæœ‰ä¸åŒçš„ Yaml æ¨¡æ¿ï¼Œç„¶åŽï¼Œé€è¿‡ django çš„æ¨¡å—åŠŸèƒ½ç»Ÿä¸€ä½œè§£æžã€‚ç†Ÿæ‚‰ Yaml ä¹¦å†™çš„ç ”å‘åŒäº‹å¯ä»¥è‡ªå·±å®šä¹‰è‡ªå·±é¡¹ç›®çš„ Yaml æ¨¡æ¿ã€‚

> Qï¼šPipeline ä¼šä½¿ç”¨ Jenkinfile æ¥çµæ´» code åŒ– Pipelineï¼ŒæŠŠ Pipeline çš„çµæ´»æ€§å’Œåˆ›æ–°æ€§è¿˜ç»™å¼€å‘å›¢é˜Ÿï¼Œè¿™æ¯”ä¸€ä¸ªæ¨¡æ¿åŒ–çš„ç»Ÿä¸€ Pipeline æœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ

Aï¼šPipeline çš„è¿è¡Œæ¨¡å¼ï¼Œé‡‡ç”¨å•ä¸€ Job å’Œæ¯ä¸ªé¡¹ç›®è‡ªå®šä¹‰ Jobï¼Œå„æœ‰ä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚å› ä¸ºæˆ‘ä»¬çš„ Jenkins æ˜¯éšäºŽå¹•åŽçš„ç»„ä»¶ï¼Œç ”å‘ä¸»è¦åŸºäºŽ Prism4k æ“ä½œï¼Œå¯ä»¥ç›¸å¯¹å‡å°‘ç ”å‘çš„å­¦ä¹ æˆæœ¬ã€‚ç›¸å¯¹æ¥è¯´ï¼ŒJenkins çš„ç»´æŠ¤äººåŠ›ä¹Ÿä¼šå‡å°‘ã€‚å¯¹äºŽç ”å‘å„ç§æƒé™æ¯”è¾ƒé«˜çš„å…¬å¸ï¼Œé‚£ç»Ÿä¸€çš„ Job å¯èƒ½å¹¶ä¸åˆé€‚ã€‚

> Qï¼šæƒ³äº†è§£ä¸‹è´µå…¬å¸ä½¿ç”¨ä»€ä¹ˆç½‘ç»œæ–¹æ¡ˆï¼ŸPod çš„ç½‘ç»œè®¿é—®æƒé™æŽ§åˆ¶æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šå…¬å¸çŽ°åœ¨ç”¨çš„æ˜¯ Flannel ç½‘ç»œ CNI æ–¹æ¡ˆã€‚åŒæ—¶ï¼Œåœ¨ä¸åŒçš„é›†ç¾¤ï¼Œä¹Ÿæœ‰ä½œ Calico ç½‘ç»œæ–¹æ¡ˆçš„å¯¹æ¯”æµ‹è¯•ã€‚Pod çš„ç½‘ç»œæƒé™ï¼Œè¿™å—æš‚æ—¶æ²¡æœ‰ï¼Œåªæ˜¯å°è¯• Istio çš„å¯è¡Œæ€§ç ”ç©¶ã€‚

> Qï¼šä¸€ä¸ª Job ç”Ÿæˆæ‰€æœ‰çš„ Docker é•œåƒï¼Œå¦‚æžœæž„å»ºé‡åˆ°é—®é¢˜ï¼Œæ€Žä¹ˆåŽ»è¿½è¸ªè¿™äº›è®°å½•ï¼Ÿ

Aï¼šåœ¨é¡¹ç›®å‰æœŸæŽ¥å…¥æ—¶ï¼Œç”Ÿæˆé•œåƒçš„æµç¨‹éƒ½ä½œäº†å®£ä¼ å’ŒæŽ¨å¹¿ã€‚æ ‡å‡†åŒ–çš„æµç¨‹ï¼Œä¼šå‡å°‘äº§ç”Ÿé—®é¢˜çš„æœºçŽ‡ã€‚å¦‚æžœåœ¨æž„å»ºä¸­é‡åˆ°é—®é¢˜ï¼ŒPrism4k çš„ç•Œé¢ä¸­ï¼Œä¼šç›´æŽ¥æœ‰é“¾æŽ¥åˆ°æœ¬æ¬¡å»ºçš„æ¬¡åºå·ã€‚ç‚¹å‡»é“¾æŽ¥ï¼Œå¯ç›´æŽ¥å®šä½åˆ° Console è¾“å‡ºã€‚

> Qï¼šé‡åˆ°èŠ‚ç‚¹ Node ä¸Šå‡ºçŽ° 100+Podï¼ŒNode ä¼šå¡ä½ï¼Œè´µå…¬å¸ Pod èµ„æºæ€Žä¹ˆåšé™åˆ¶çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ä¸šåŠ¡ Pod èµ„æºï¼Œéƒ½ä½œäº† limit å’Œ request é™åˆ¶ã€‚å¦‚æžœå‡ºçŽ°æœ‰å¡ä½çš„æƒ…å†µï¼ŒçŽ°è¡Œçš„æ–¹æ¡ˆæ˜¯åŸºäºŽé¡¹ç›®ä½œæ‹†åˆ†ã€‚Prism4k æœ¬èº«å¯¹å¤šçŽ¯å¢ƒå’Œå¤šé›†ç¾¤éƒ½æ˜¯æ”¯æŒçš„ã€‚

> Qï¼šå¤šçŽ¯å¢ƒä¸‹ï¼Œé›†ä¸­åŒ–çš„é…ç½®ç®¡ç†æ–¹æ¡ˆï¼Œä½ ä»¬é€‰ç”¨çš„æ˜¯å“ªä¸ªï¼Œæˆ–æ˜¯è‡ªç ”çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬çŽ°åœ¨æ­£åœ¨ç ”å‘çš„ Prism4kï¼Œå‰æå°±æ˜¯è¦æ”¯æŒå¤šçŽ¯å¢ƒå¤šé›†ç¾¤çš„éƒ¨ç½²ï¼Œæœ¬èº«çš„åŠŸèƒ½é‡Œï¼Œyaml æ–‡ä»¶çš„é…ç½®ç®¡ç†ï¼Œéƒ½æ˜¯å…¶å†…ç½®åŠŸèƒ½ã€‚

> Qï¼šetcd çš„ --initial-cluster-state é€‰é¡¹è®¾ç½®ä¸º newï¼Œé‡å¯ etcd åŽä¼šä¸ä¼šåˆ›å»ºæ–°çš„ etcd é›†ç¾¤ï¼Ÿè¿˜æ˜¯åŠ å…¥åŽŸæœ‰çš„ etcd é›†ç¾¤ï¼Ÿ

Aï¼šæˆ‘ä»¬æµ‹è¯•è¿‡è½®æµå°†æœåŠ¡å™¨ï¼ˆ3Masterï¼‰å®Œå…¨é‡å¯ï¼Œectd é›†ç¾¤çš„åŠŸèƒ½å‡æœªå—å½±å“ã€‚ä½†å…¨éƒ¨å…³æœºé‡å¯ï¼Œè¿˜æœªæµ‹è¯•è¿‡ã€‚æ‰€ä»¥ä¸å¥½æ„æ€ï¼Œè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æš‚æ—¶æ²¡æœ‰è€ƒè™‘è¿‡ã€‚

> Qï¼šç½‘ç»œæ–¹æ¡ˆç”¨çš„ä»€ä¹ˆï¼Ÿåœ¨é€‰åž‹çš„æ—¶å€™æœ‰æ²¡æœ‰å¯¹æ¯”ï¼Ÿ

Aï¼šç›®å‰ä¸»è¦åº”ç”¨çš„è¿˜æ˜¯ Flannel æ–¹æ¡ˆï¼Œä»Šå¹´æ˜¥èŠ‚ä»¥æ¥ï¼Œè¿˜æµ‹è¯•è¿‡ Flannelã€Caclicoã€kube-router æ–¹æ¡ˆã€‚å› ä¸ºæˆ‘ä»¬çš„é›†ç¾¤æœ‰å¯èƒ½è¶Šæœºæˆ¿ï¼Œè€Œæ¶‰åŠåˆ° BGP åè®®æ—¶ï¼ŒèŠ‚ç‚¹æ— æ³•åŠ å…¥ï¼Œæ‰€ä»¥ä¸€ç›´é€‰ç”¨äº† Flannelã€‚

> Qï¼šéƒ¨ç½²çš„åŠ¨æ€è¿‡ç¨‹æ˜¯åœ¨ Jenkins çš„ Web ç•Œé¢ä¸Šçœ‹è¿˜æ˜¯åœ¨è‡ªç ”çš„ Prism4k ä¸Šèƒ½çœ‹åˆ°ï¼Œå¦‚æžœæ˜¯ Prism4k çš„è¯ï¼Œæ•´ä¸ªå¯è§†åŒ–è¿‡ç¨‹çš„å±•ç¤ºè¿™äº›ç­‰ç­‰ä¹Ÿæ˜¯è‡ªå·±å¼€å‘çš„å—ï¼ŸPrism4k æ˜¯ç”¨ä»€ä¹ˆè¯­è¨€å¼€å‘çš„ï¼ŒPython å—ï¼Ÿ

Aï¼šéƒ¨ç½²çš„åŠ¨æ€è¿‡ç¨‹ï¼Œæ˜¯åœ¨ Prism4k ä¸Šæ˜¾ç¤ºã€‚å¯è§†åŒ–æ–¹æ¡ˆï¼Œä¹Ÿåªæ˜¯ç®€å•çš„ä½¿ç”¨ ajax åŠ websocketã€‚Prism4k åŽç«¯æ˜¯åŸºäºŽ Django2.0 ä»¥ä¸Šå¼€å‘ï¼Œå…¶ä¸­ä½¿ç”¨äº† RESTfulframeworkã€channels ç­‰åº“ï¼Œå‰ç«¯ä½¿ç”¨äº†ä¸€äº› js æ’ä»¶ã€‚

---

### 2019-04-30ï¼šè”æžè¿ç»´å¹³å°å®¹å™¨åŒ–å®žè·µ

> Qï¼šå®¹å™¨çš„ Pod ç½‘ç»œå’Œå¤–éƒ¨ç½‘ç»œå…¨éƒ¨æ‰“é€šå—ï¼Œå¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šå› ä¸º kube-router æ˜¯åŸºäºŽä¸‰å±‚è·¯ç”±ï¼Œæ‰€ä»¥åªè¦åœ¨é¡¶å±‚äº¤æ¢ä¸ŠæŒ‡å®š PodIP çš„é™æ€è·¯ç”±å³å¯ï¼Œæ¯”å¦‚å®¿ä¸»æœºæ˜¯ 192.168.0.1ï¼Œè¯¥å®¿ä¸»æœºä¸Šçš„ pod iprange æ˜¯ 10.0.0.1/24ï¼Œé‚£åªè¦åœ¨äº¤æ¢æœºæˆ–éœ€è¦è®¿é—® Pod çš„å¤–éƒ¨ä¸»æœºä¸Šæ·»åŠ è·¯ç”± 10.0.0.1/24 via 192.168.0.1 ...å³å¯ã€‚

> Qï¼šä½ ä»¬å¦‚ä½•åŽ»ä¿è¯ io çš„éš”ç¦»ï¼Ÿ

Aï¼šç›®å‰ç½‘ç»œå’Œç¡¬ç›˜çš„ io æ²¡æœ‰åšéš”ç¦»ï¼Œæš‚æ—¶è¿˜æ²¡æœ‰è¿™æ–¹é¢çš„åˆšéœ€ã€‚kube-router å¯¹ç½‘ç»œ IO è¿™æ–¹é¢æŽ§åˆ¶æ¯”è¾ƒå¼±ã€‚ç¡¬ç›˜ IO æ–¹é¢ Docker æ”¯æŒ IOPS æŽ§åˆ¶ï¼Œä½† Kubernetes æˆ‘è¿˜ä¸å¤ªæ¸…æ¥šæ˜¯å¦æ”¯æŒã€‚

> Qï¼šJob å’Œ dind å¦‚ä½•é…åˆåŽ»å®žçŽ°æ‰“åŒ…é•œåƒçš„å‘¢ï¼Ÿ

Aï¼šé¦–å…ˆæ˜¯ dind æŠ€æœ¯ï¼Œé€šè¿‡æŒ‚è½½å®¿ä¸»æœºçš„ docker client å’Œ dockersockï¼Œå¯ä»¥å®žçŽ°åœ¨å®¹å™¨å†…è°ƒç”¨å®¿ä¸»æœºçš„ Docker æ¥åšä¸€äº›äº‹æƒ…ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦å°±ç”¨äºŽ buildã€‚Kubernetes çš„ Job åˆ™æ˜¯ç”¨äºŽæ‰§è¡Œè¿™ä¸ªæž„å»º worker çš„æ–¹å¼ï¼Œåˆ©ç”¨ Kubernetes çš„ Job æ¥è°ƒåº¦æž„å»ºä»»åŠ¡ï¼Œå……åˆ†åˆ©ç”¨æµ‹è¯•é›†ç¾¤çš„ç©ºé—²èµ„æºã€‚

> Qï¼šä»Žå®¿ä¸»æœºéƒ¨ç½²ç›´æŽ¥è·¨æ­¥åˆ° Kubernetes éƒ¨ç½²ï¼Œä¸ä»…éœ€è¦å¼ºåŠ›çš„ power æ¥æŽ¨åŠ¨ï¼Œåœ¨è½åœ°å®žæ–½çš„è¿‡ç¨‹ä¸­ï¼Œåº”è¯¥ä¹Ÿä¼šç»åŽ†åº”ç”¨æž¶æž„ä¸Šçš„è°ƒæ•´ï¼Œèƒ½é˜è¿°ä½ ä»¬åœ¨è¿™æ–¹é¢é‡åˆ°çš„å›°éš¾å’Œè§£å†³æ–¹å¼å—ï¼Ÿ

Aï¼šPod ç½‘ç»œæ˜¯æœ€å¤§çš„ç—›ç‚¹ï¼Œè§£å†³æ–¹å¼å¦‚æ–‡ä¸­æ‰€è¯´ã€‚æž¶æž„æ–¹é¢æˆ‘ä»¬å¾ˆæ—©å°±æ˜¯å¾®æœåŠ¡åŽ»ä¸­å¿ƒåŒ–çš„éƒ¨ç½²ï¼ŒAPI ç½‘å…³ï¼ŒæœåŠ¡æ³¨å†Œå‘çŽ°ç­‰ä¹Ÿæ˜¯åœ¨å®¹å™¨åŒ–ä¹‹å‰å°±å·²ç»å®Œæˆæ”¹é€ çš„ï¼Œæ‰€ä»¥åº”ç”¨æž¶æž„åå€’æ˜¯æ²¡é‡åˆ°å¤šå¤§çš„éš¾é¢˜ã€‚

> Qï¼šä½ ä»¬ Kubernetes é‡Œé¢ç»Ÿä¸€é…ç½®æ˜¯ç”¨çš„ ConfigMap è¿˜æ˜¯é›†æˆäº†ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œä¾‹å¦‚ Disconfã€‚ä½ ä»¬åœ¨ Kubernetes ä¸­ï¼ŒAPM ç”¨çš„æ˜¯ä»€ä¹ˆå‘¢ï¼ŸPinpoint è¿˜æ˜¯ Sky è¿˜æ˜¯ Jeagerï¼Ÿè¿˜æ˜¯å…¶ä»–ï¼Ÿ

Aï¼šè¿‡åŽ»çš„é¡¹ç›®é…ç½®æ–‡ä»¶æ˜¯æ”¾è¿ç»´å¹³å°ä¸Šçš„ï¼Œæ‰€ä»¥åªè¦ ConfigMap æŒ‚è¿›åŽ»å°±å¯ä»¥äº†ã€‚åŽæ¥æ–°çš„é¡¹ç›®å¼€å§‹é‡‡ç”¨æºç¨‹çš„ Apolloï¼ŒKubernetes ä¸Šå°±åªè¦é€šè¿‡ ENV æŠŠ Apollo çš„ä¸€äº›ç›¸å…³æ•æ„Ÿä¿¡æ¯ä¼ ç»™ Pod å³å¯ã€‚APM æ–¹é¢å› ä¸ºæˆ‘ä»¬æ˜¯ Java æ ˆæ‰€ä»¥ä½¿ç”¨çš„ skywalkingï¼Œä¹Ÿæ˜¯å¼€ç¯‡æåˆ°çš„ Javaagent æŠ€æœ¯ã€‚

> Qï¼šé•œåƒä»“åº“ä¸ºä»€ä¹ˆé€‰ç”¨ Harborï¼Œé€‰åž‹ä¸Šæœ‰ä»€ä¹ˆè€ƒè™‘ï¼Ÿ

Aï¼šHarbor ä¸»è¦æœ‰ UI æ–¹ä¾¿ç®¡ç†ï¼Œç›¸å¯¹æ¥è¯´ä¹Ÿå®¹æ˜“éƒ¨ç½²å’Œä½¿ç”¨ï¼Œå°¤å…¶æ˜¯æƒé™ç®¡ç†è¿™æ–¹é¢ã€‚

> Qï¼šMacvlan å’Œ IPvlan æ€§èƒ½éžå¸¸å¥½ï¼Œå‡ ä¹Žæ²¡æœ‰æŸè€—ï¼Œä½†é»˜è®¤éƒ½æ˜¯å®¹å™¨å’Œå®¿ä¸»æœºç½‘ç»œéš”ç¦»çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰è§£å†³æ–¹æ¡ˆï¼Œä½ ä»¬è¿™è¾¹æ˜¯æ²¡æœ‰è€ƒè™‘è¿˜æ˜¯ä½¿ç”¨äº†ä¸€äº›è§£å†³æ–¹æ¡ˆå‘çŽ°æœ‰é—®é¢˜åˆæ”¾å¼ƒçš„ï¼Ÿå¦‚æžœæ˜¯åŽè€…ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜è®©ä½ ä»¬é€‰æ‹©æ”¾å¼ƒï¼Ÿ

Aï¼šMacvlan ä¹‹ç±»çš„æ–¹å¼éœ€è¦äº¤æ¢æœºå±‚é¢ä¸Šåšä¸€äº›é…ç½®æ‰“é€š VLANï¼Œå¹¶ä¸”æ€§èƒ½ä¸Šå¹¶ä¸ä¼šæ¯”åŸºäºŽä¸‰å±‚çš„è§£å†³æ–¹æ¡ˆè¦é«˜éžå¸¸å¤šï¼Œæƒè¡¡ä¹‹ä¸‹æˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©æ¯”è¾ƒæ˜“ç”¨çš„åŸºäºŽä¸‰å±‚çš„æ–¹æ¡ˆï¼Œç”šè‡³ä¸ºäº†æ˜“ç”¨è€Œé€‰æ‹©äº†æ›´ä¸ºæ¿€è¿›çš„ kube-routerã€‚

> Qï¼šå®¹å™¨çš„å¤šè¡Œæ—¥å¿—æ”¶é›†å¦‚ä½•è§£å†³ï¼Ÿæˆ–è€…æ˜¯ï¼Œå¾ˆå¤šä¸šåŠ¡æ—¥å¿—éœ€è¦ä¸Šä¸‹æ–‡å…³ç³»ï¼Œä½†æ˜¯ ELK åªèƒ½æŸ¥è¯¢åˆ°å•æ¡ï¼Œè¿™ç§æƒ…å†µæ€Žä¹ˆå¤„ç†å‘¢ï¼Ÿ

Aï¼šå®¹å™¨å¤šè¡Œæ—¥å¿—çš„é—®é¢˜åªå­˜åœ¨äºŽæ ‡å‡†è¾“å‡ºé‡Œï¼Œæˆ‘ä»¬åº”ç”¨çš„æ—¥å¿—æ˜¯è¾“å‡ºåˆ°æŒ‡å®šç›®å½•ä¸‹çš„ï¼ŒFilebeat æœ‰ä¸€äº›é€šç”¨çš„å¤šè¡Œæ—¥å¿—è§£å†³æ–¹æ¡ˆã€‚å› ä¸ºæ—¥å¿—æ˜¯å­˜æ”¾åœ¨ ES é‡Œçš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è°ƒ ES æŽ¥å£æ‹¿åˆ°æŸä¸ª Pod ä¸€ä¸ªæ—¶é—´æ®µé‡Œçš„æ—¥å¿—ï¼Œåœ¨ UI ä¸ŠæŠŠå®ƒå±•ç¤ºå‡ºæ¥å³å¯ã€‚

> Qï¼šè¯·é—®ç”¨çš„å­˜å‚¨æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é›†æˆçš„ï¼Ÿå­˜å‚¨æž¶æž„æ˜¯æ€Žæ ·çš„ï¼Ÿæœ‰è€ƒè™‘è¿‡ Ceph å—ï¼Ÿ

Aï¼šåªæœ‰æžå°‘éƒ¨åˆ†é¡¹ç›®éœ€è¦æŽ¥åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå¹¶ä¸”å¯¹å­˜å‚¨çš„ç®¡ç†ï¼ŒIOPS é™åˆ¶ç­‰æ²¡æœ‰ç¡¬æ€§è¦æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå·²æœ‰çš„ MFS é›†ç¾¤æŒ‚è½½åˆ°å®¿ä¸»æœºï¼Œå†æŒ‚åˆ°å®¹å™¨é‡Œæ¥å®žçŽ°ã€‚

> Qï¼šJenkins çš„ Slave æ˜¯ç”¨ PodTemplate åˆ›å»ºçš„å—ï¼ŸSlave æ˜¯ Job å…±äº«è¿˜æ˜¯éœ€è¦æ—¶è‡ªåŠ¨åˆ›å»ºï¼Ÿ

Aï¼šJenkins è¿˜æ˜¯ä¼ ç»Ÿçš„ master-slave å•æœºéƒ¨ç½²æ¨¡å¼ï¼Œå› ä¸ºç‰ˆæœ¬æ¯”è¾ƒæ—§è¿ž KubernetesSlave éƒ½ä¸æ”¯æŒï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ˜¯è°ƒç”¨äº† Jenkins çš„ API æ¥å®Œæˆè¿™ä¸ªéƒ¨ç½²çš„è¿‡ç¨‹ã€‚

> Qï¼šKubernetes åœ¨åšå­˜å‚¨æŒ‚è½½çš„æ—¶å€™ï¼Œæ€Žä¹ˆä¿è¯å®¹å™¨æ¼‚ç§»ä¾ç„¶å¯ä»¥è¯»å–åˆ°å…±äº«å­˜å‚¨ï¼Ÿ

Aï¼šMFS æŒ‚è½½çš„è¯ï¼Œæ–‡ä»¶æ˜¯å†™å…¥åˆ° MFS é›†ç¾¤ä¸­çš„ï¼Œé‚£ä¹ˆæŒ‚è½½åŒæ ·çš„ MFS å³å¯è¯»åˆ°åŒä¸€ä¸ªæ–‡ä»¶ã€‚

> Qï¼šå…³äºŽå‘½åç©ºé—´ï¼Œè¿™è¾¹æœ‰å“ªäº›åº”ç”¨åœºæ™¯å‘¢ï¼Ÿ

Aï¼šæŒ‰éƒ¨é—¨å’Œåœºæ™¯åŒºåˆ† nsï¼ŒæŒ‰ ns åˆ†é…èŠ‚ç‚¹å’Œèµ„æºã€‚æœªæ¥æ‰“ç®—åŸºäºŽ ns åšç½‘ç»œä¸Šçš„éš”ç¦»å’ŒæŽ§åˆ¶ã€‚

> Qï¼šè¯·é—®é•œåƒå¤§å°æ˜¯å¦æœ‰åšä¼˜åŒ–ï¼Ÿç”Ÿäº§ä¸­æœ‰ç”¨ alpine ä¹‹ç±»çš„ base é•œåƒå—ï¼Ÿ

Aï¼šæš‚æ—¶æ²¡æœ‰ï¼Œæˆ‘ä»¬é•œåƒçš„å¤§å°å¤§çº¦åœ¨ 100-300M ä¹‹é—´ã€‚è€Œä¸”æ¯”èµ·é•œåƒå¤§å°çš„ä¼˜åŒ–ï¼Œè¿è¡ŒçŽ¯å¢ƒçš„ç¨³å®šå’Œè°ƒè¯•çš„ä¾¿åˆ©æ›´ä¸ºé‡è¦ã€‚é•œåƒæœ‰åˆ†å±‚çš„ç­–ç•¥ï¼Œå³ä½¿æ˜¯å¾ˆå¤§çš„é•œåƒï¼Œåªè¦æ¯æ¬¡ç‰ˆæœ¬éƒ¨ç½²æ—¶æ›´æ–°çš„æ˜¯æœ€åº•å±‚çš„é•œåƒå°±ä¸ä¼šå¯¼è‡´æ¯æ¬¡éƒ½è¦æ‹‰å–å®Œæ•´é•œåƒã€‚

---

### 2019-04-24ï¼šåŽå°”è¡—è§é—» Istio ç”Ÿäº§å®žè·µ

> Qï¼šå­¦ Service Mesh ä»€ä¹ˆç”¨ï¼Ÿ

Aï¼šServiceMesh æ˜¯æœ€è¿‘æ¯”è¾ƒç«çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå’Œå¾®æœåŠ¡ã€Kubernetes æœ‰å¯†åˆ‡å…³ç³»ã€‚å‡ºäºŽä»¥åŽä¸šåŠ¡å‘å±•éœ€è¦ï¼Œå¯ä»¥å­¦ä¹ ä¸‹ï¼Œå¢žåŠ çŸ¥è¯†å‚¨å¤‡ã€‚è§é—»ä¸Š Istio çš„ä¸»è¦ç›®çš„åœ¨æ–‡ç« å·²è¯´æ˜Žï¼Œä¸»è¦æ˜¯åŸºç¡€æœåŠ¡çš„ä¸‹æ²‰ï¼Œè§£å†³äº†è¯­è¨€å…¼å®¹æ€§é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ç°åº¦å‘å¸ƒã€‚

> Qï¼šé“¾è·¯è¿½è¸ªçš„é‡‡é›†æ–¹å¼æ˜¯æ€Žæ ·çš„ï¼Œæ¯”å¦‚ Nodejsï¼ŒC++ ç­‰å¤šè¯­è¨€å¦‚ä½•æ”¯æŒçš„ï¼Ÿ

Aï¼šEnvoy æœ¬èº«æ”¯æŒé“¾è·¯è¿½è¸ªï¼Œä¹Ÿå°±æ˜¯å°† Envoy ä¼šåœ¨è¯·æ±‚ head ä¸­å¢žåŠ é“¾è·¯è¿½è¸ªç›¸å…³çš„æ•°æ®å¤´ï¼Œæ¯”å¦‚ x-b3-traceidï¼Œx-b3-spanid ç­‰ç­‰ã€‚ä¸šåŠ¡è¦åšçš„å°±æ˜¯å°†è¿™äº› head æ²¿ç€è°ƒç”¨é“¾è·¯ä¼ é€’ä¸‹åŽ»å³å¯ã€‚æ‰€ä»¥å¤šè¯­è¨€çš„è¯éœ€è¦åœ¨è‡ªå·±çš„ä¸šåŠ¡ä¾§å®žçŽ°è¯¥é€»è¾‘ã€‚æ‰€ä»¥ Istio çš„é“¾è·¯è¿½è¸ªå¯¹ä¸šåŠ¡ä»£ç è¿˜æ˜¯æœ‰å¾ˆå°çš„ä¾µå…¥æ€§çš„ï¼ˆè¿™ä¸ªåˆ†äº«ä¸­æœ‰è¯´æ˜Žï¼‰ã€‚

> Qï¼šIstio ä¸Ž Spring Cloud ä¸¤è€…çš„ä¼˜ç¼ºç‚¹ä¸Žä»ŠåŽçš„å‘å±•è¶‹åŠ¿ä¼šæ˜¯æ€Žä¹ˆæ ·ï¼Ÿ

Aï¼šè§é—»æŠ€æœ¯æ ˆæ˜¯ Golangï¼Œæ‰€ä»¥æ²¡å¤ªè®¤çœŸå¯¹æ¯”è¿‡ä¸¤è€…ã€‚ä»Žç¤¾åŒºæ´»è·ƒåº¦ä¸Šå°†ï¼ŒIstio ï¼ŒSpring Cloudï¼Œç¨³å®šæ€§æ–¹é¢ï¼ŒSpring Cloud æ˜¯æ›´æœ‰ä¼˜åŠ¿ï¼Œæ›´é€‚åˆ Java æ²‰æ·€è¾ƒæ·±çš„ä¼ä¸šã€‚ä½†ä¸ªäººæ„Ÿè§‰å¯¹äºŽæ›´å¤šä¼ä¸šæ¥è®²ï¼Œè·¨è¶Šäº†è¯­è¨€å…¼å®¹æ€§çš„ Istio æœªæ¥å‘å±•å¾ˆå€¼å¾—æœŸå¾…ã€‚

> Qï¼šDocker é•œåƒéƒ¨ç½²å¯ä»¥åšåˆ°ä»£ç ä¿æŠ¤å—ï¼Œæ¯”å¦‚åƒ Nodejs è¿™ç§éžäºŒè¿›åˆ¶æ‰§è¡Œç¨‹åºçš„é¡¹ç›®ï¼Ÿ

Aï¼šä»£ç ä¿æŠ¤å¯ä»¥é€šè¿‡å°†é•œåƒä¸Šä¼ è‡³æŒ‡å®šäº‘æœåŠ¡å•†ä¸Šçš„é•œåƒä»“åº“ä¸­ï¼Œè§é—»æ˜¯å°†è‡ªå·±çš„ä¸šåŠ¡é•œåƒæäº¤ä¿å­˜åœ¨äº†è…¾è®¯äº‘ã€‚å¦‚æžœé•œåƒæ³„éœ²ï¼Œé‚£ä¹ˆéžäºŒè¿›åˆ¶æ‰§è¡Œç¨‹åºçš„ä»£ç è¿˜æ˜¯æœ‰æ³„éœ²é£Žé™©çš„ã€‚

> Qï¼šé€‰åž‹æ—¶ä¸ºä»€ä¹ˆæ²¡è€ƒè™‘ Linkerdï¼Ÿ

Aï¼šé€‰åž‹ä¹‹åˆä¹Ÿè°ƒç ”äº† Linkerdï¼Œå¯¹æ¯”ä¸‹æ¥ï¼ŒIstio æ‹¥æœ‰æ›´å¤šæ´»è·ƒçš„å¼€æºè´¡çŒ®è€…ï¼Œè¿­ä»£é€Ÿåº¦å¿«ï¼Œä»¥åŠ Istio æž¶æž„ç›¸è¾ƒäºŽè§é—»æœ‰è¾ƒå¤§å¯è¡Œæ€§ï¼Œæ‰€ä»¥é€‰æ‹©äº† Istio ä½œä¸ºå®žè·µæ–¹æ¡ˆã€‚

> Qï¼šIstio åœ¨åšè¿ç»´éƒ¨ç½²æ—¶æ²¡æœ‰ UI å·¥å…·ï¼Œä½ ä»¬å¦‚ä½•å®žçŽ°è¿ç»´äººå‘˜æ›´åŠ ä¾¿æ·åœ°ä½¿ç”¨ï¼Ÿ

Aï¼šè§é—»åŸºäºŽ Kubernetes å®˜æ–¹çš„ Dashboardï¼Œå¯¹å†…å®¹è¿›è¡Œäº†æ‰©å……ï¼Œå¢žåŠ äº†å¯¹ Gatewayï¼ŒVirtualService ç­‰ Istio crd èµ„æºçš„æ”¯æŒï¼ŒåŒæ—¶å¢žåŠ äº†ç°åº¦éƒ¨ç½²ç­‰å’Œè§é—»è¿ç»´ä¸šåŠ¡ç›¸å…³çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è¿ç»´éƒ¨ç½²çš„é—®é¢˜ã€‚

> Qï¼šæµé‡ä»Ž Sidecar ä»£ç†åŠ¿å¿…ä¼šå¯¹è¯·æ±‚å“åº”æ—¶é—´æœ‰å½±å“ï¼Œè¿™ä¸ªæœ‰æ²¡æœ‰æ›´è¯¦ç»†æ¡ˆä¾‹çš„è¯´æ˜Žæ€§èƒ½ä¸Šçš„æŸè€—æƒ…å†µï¼Ÿ

Aï¼šSidecar çš„è½¬å‘å…¶å®žå¸¦æ¥äº†æ€§èƒ½ä¸€å®šçš„æ€§èƒ½æŸè€—ã€‚4 æ ¸ 8G æœåŠ¡å™¨ï¼Œä¸Šé¢è¿è¡Œ Proxy æœåŠ¡å’Œ API æœåŠ¡ï¼ŒAPI æœåŠ¡åªè¿”å›ž ok å­—æ ·ã€‚ï¼ˆæ­¤æµ‹è¯•åªæµ‹è¯•æžé™ QPSï¼‰å•ç‹¬æµ‹è¯• API æœåŠ¡çš„ QPS åœ¨ 59k+ï¼Œå¹³å‡å»¶æ—¶åœ¨ 1.68msï¼ŒCPU å ç”¨ 4 æ ¸ã€‚é€šè¿‡ä»£ç†è®¿é—®çš„ QPS6.8k+ï¼Œå¹³å‡å»¶æ—¶ 14.97msï¼Œä»£ç† CPU å ç”¨ 2 æ ¸ï¼ŒAPI æœåŠ¡ CPU å ç”¨ 2 æ ¸ã€‚CPU æ¶ˆè€—ä»¥åŠè½¬å‘æ¶ˆè€—é™ä½Žäº† QPSï¼Œå¢žåŠ äº†å»¶æ—¶ï¼Œé€šè¿‡å¢žåŠ æœºå™¨æ ¸æ•°å¹¶å¢žåŠ æœåŠ¡éƒ¨ç½²æ•°é‡ç¼“è§£è¯¥é—®é¢˜ï¼Œç»è¿‡æµ‹è¯•çŽ¯å¢ƒæµ‹è¯•ï¼Œå»¶æ—¶å¯ä»¥æŽ¥å—ã€‚

> Qï¼šSidecar åœ¨ç”Ÿäº§ä¸­èµ„æºå ç”¨ä¸ºå¤šå°‘ï¼Ÿæ˜¯å¦ä¼šå¯¹é›†ç¾¤èµ„æºå ç”¨å¾ˆå¤šï¼Ÿ

Aï¼šä»¥å•ä¸ª Pod ä¸ºä¾‹ï¼Œè§é—»ä¸šåŠ¡å•ä¸ª Pod ä¸­ Sidecar æ‰€å èµ„æºçº¦å æ•´ä¸ª Pod æ‰€è€—èµ„æºçš„ 1/10ã€‚

> Qï¼šJeager ä½ ä»¬æ˜¯è¿›è¡Œäº†ä»£ç åŸ‹ç‚¹å—ï¼Ÿæ›´ä¸ºåº•å±‚ä»£ç çº§åˆ«çš„è¿½è¸ªï¼Œæœ‰ç”¨å…¶ä»–æ–¹æ¡ˆå—ï¼Ÿ

Aï¼šEnvoy æœ¬èº«å¯¹ tracing æœ‰è‰¯å¥½çš„æ”¯æŒï¼Œæ‰€ä»¥ä¸šåŠ¡ç«¯æ‰€åšçš„æ”¹åŠ¨åªéœ€å°†å…¶æ‰€äº§ç”Ÿçš„è¿½è¸ªæ•°æ®å»¶ç»­ä¸‹åŽ»å³å¯ã€‚ä¸Š Istio ä¹‹å‰ï¼Œè§é—»åœ¨ç›¸å…³å¾®æœåŠ¡ä¸­é€šè¿‡åœ¨åŸºç¡€åº“ä¸­å¢žåŠ é“¾è·¯è¿½è¸ªé€»è¾‘ï¼ˆZipkinï¼‰å®žçŽ°äº†é“¾è·¯è¿½è¸ªï¼Œä¸è¿‡åªåšäº† Golang ç‰ˆï¼Œå¤šè¯­è¨€å…¼å®¹å¼€å‘è¿ç»´éš¾åº¦è¾ƒå¤§ã€‚

> Qï¼šç›¸ä¿¡å’±ä»¬çš„ mixer åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œä¹Ÿå‡ºçŽ°è¿‡ç“¶é¢ˆï¼Œå’±ä»¬ä»Žå“ªå‡ ä¸ªå¤§æ–¹å‘ä¼˜åŒ–çš„ï¼Ÿå¦‚ä½•ä¼˜åŒ–çš„ï¼Ÿæ–¹é¢è®²è§£ä¸€ä¸‹å—ï¼Ÿ

Aï¼šmixer è§é—»åœ¨ç”Ÿäº§è¿‡ç¨‹ä¸­æ‰€é‡çš„å‘åœ¨äºŽ Policy ç»„ä»¶ï¼Œ ä¼šç–¯ç‹‚çš„ listpodï¼Œå¯¼è‡´ API server è´Ÿè½½éª¤å¢žï¼Œä¹‹åŽè§é—»åŸºäºŽè‡ªèº«ä¸šåŠ¡å…³é—­äº† Policyã€‚

> Qï¼šIstio ç»„ä»¶å®žçŽ°äº†é«˜å¯ç”¨ä¹ˆï¼Ÿ

Aï¼šIstio æœ¬èº«ä¹Ÿæ˜¯åŸºäºŽ Kubernetesï¼Œæ‰€ä»¥å¯ç”¨æ€§è¿˜æ˜¯æœ‰è¾ƒå¥½ä¿è¯çš„ã€‚

---

### 2019-04-17ï¼šç“œå­äº‘å¹³å°çš„å®žè·µç»éªŒ

> Qï¼šè¯·é—®ç“œå­ç§æœ‰äº‘æ˜¯ä¸€æœµç‹¬ç«‹çš„äº‘è¿˜æ˜¯å¤šäº‘éƒ¨ç½²ï¼Ÿå¦‚æžœæ˜¯å¤šäº‘éƒ¨ç½²ï¼Œäº‘é—´ç½‘ç»œæ˜¯é‡‡ç”¨çš„ä»€ä¹ˆæŠ€æœ¯ï¼Ÿå¦‚ä½•æ‰“é€šå¤šäº‘ä¹‹é—´çš„ç½‘ç»œçš„ï¼Ÿè°¢è°¢

Aï¼šæˆ‘ä»¬åœ¨è®¾è®¡ä¹‹åˆå°±è€ƒè™‘å¤šé›†ç¾¤ / å¤š IDC éƒ¨ç½²çš„ï¼Œè¿™ä¹Ÿæ˜¯é€‰æ‹© Calico çš„ä¸€ä¸ªåŽŸå› ã€‚é€šè¿‡ BGP åè®®å°†å®¹å™¨ IP å¹¿æ’­å‡ºåŽ»åŽï¼Œäº‘é—´äº’è”å’Œæ™®é€šè™šæ‹Ÿæœºäº’è”æ²¡æœ‰åŒºåˆ«ï¼Œå½“ç„¶è¿™éœ€è¦ç½‘ç»œè®¾å¤‡æ”¯æŒã€‚

> Qï¼šäº‘å¹³å°åœ¨ PaaS å±‚ï¼Œé‡‡ç”¨çš„ç¼–æŽ’å·¥å…·æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•æ‰“é€šå®¹å™¨ä¹‹é—´çš„éƒ¨ç½²ï¼Œåœ¨å®¹å™¨çš„æž¶æž„ä¸Šæ˜¯æ€Žä¹ˆå®žçŽ°è´Ÿè½½å‡è¡¡çš„ï¼Ÿ

Aï¼šé‡‡ç”¨çš„æ˜¯ Kubernetesï¼Œæ‰“é€šä½¿ç”¨çš„æ˜¯ Calicoï¼Œè´Ÿè½½å‡è¡¡ä½¿ç”¨çš„æ˜¯ IstioIngressã€‚

> Qï¼šæ–°ç‰ˆæœ¬å®žä¾‹å‘å¸ƒçš„æ—¶å€™æ€Žä¹ˆåˆ‡ Istio æ‰èƒ½ä¿éšœç°åº¦çš„æµé‡ä¸ä¸¢å¤±å‘¢ï¼Ÿ

Aï¼šåœ¨æµç¨‹å‘å¸ƒé‡Œé¢ï¼Œæˆ‘ä»¬ç›¸å½“äºŽå…ˆæ–°å»ºä¸€ç»„æ–°çš„å®žä¾‹ï¼Œåœ¨å®ƒä»¬çš„ Readiness æ£€æŸ¥é€šè¿‡åŽï¼Œåˆ‡æ¢ Istio è§„åˆ™æŒ‡å‘æ–°å®žä¾‹åšåˆ°çš„ã€‚

> Qï¼šç¨³å®šæ€§æ–¹é¢æœ‰æ²¡æœ‰å‡ºçŽ°è¿‡æ¯”è¾ƒå¤§çš„é—®é¢˜ï¼Œæ€Žä¹ˆè§£å†³çš„ï¼Ÿ

Aï¼šæœ‰ä¸¤ä¸ªæ—¶æœŸç¨³å®šæ€§æ•…éšœè¾ƒå¤šï¼Œä¸€ä¸ªæ˜¯ Istio ç‰ˆæœ¬æ¯”è¾ƒä½Žçš„æ—¶å€™ï¼Œè¿™ä¸ªåªèƒ½è¯´ä¸€è·¯è¶Ÿå‘è¶Ÿè¿‡æ¥ï¼Œæˆ‘ä»¬ç”šè‡³è‡ªå·±æ”¹è¿‡ Istio ä»£ç ï¼ŒçŽ°åœ¨çš„ç‰ˆæœ¬å·²ç»æ²¡å‡ºè¿‡é—®é¢˜äº†ï¼›ä¸€ä¸ªæ˜¯é›†ç¾¤ç”¨çš„å¤ªç‹ ï¼Œå½“é›†ç¾¤æŽ¥è¿‘æ»¡è½½æ—¶ï¼ŒKubernetes ä¼šå‡ºçŽ°å¾ˆå¤šè¿žé”é—®é¢˜ï¼Œè¿™ä¸ªä¸»è¦æ˜¯é ç›‘æŽ§æ¥åšåŠæ—¶æ‰©å®¹ã€‚

> Qï¼šè‡ªå»ºæœºæˆ¿çš„è¯ä¸ºä»€ä¹ˆä¸æŽ¥ç€ä½¿ç”¨ Macvlan + IPAM æ–¹æ¡ˆå‘¢ï¼Ÿæ˜¯ä¸ºäº†ä¹‹åŽä¸Šå…¬æœ‰äº‘åšå‡†å¤‡å—ï¼Ÿ

Aï¼šå½“æ—¶é¢ä¸´ä¸€ä¸ªæœ¬æœº Macvlan å®¹å™¨äº’ç›¸ä¸é€šçš„é—®é¢˜ï¼Œå†åŠ ä¸Šæœ‰ç†Ÿæ‚‰çš„å›¢é˜Ÿå·²ç»åœ¨ç”Ÿäº§è·‘äº†å¾ˆä¹… Calico äº†ï¼Œæ‰€ä»¥å°±ç›´æŽ¥æ¢åˆ°äº† Calicoã€‚

> Qï¼šå¦‚æžœæœåŠ¡å‘çŽ°æ˜¯åŸºäºŽ Dubbo +ZooKeeperï¼Œé‚£ Kubernetes è‡ªèº«çš„ Service è¿˜æœ‰åœ¨ä½¿ç”¨å—ï¼Ÿ

Aï¼šKubernetes è‡ªå·±çš„ Service æˆ‘ä»¬çŽ°åœ¨å†…éƒ¨ç®¡ç†å·¥å…·åœ¨ä½¿ç”¨ï¼Œåœ¨ 2.x ç‰ˆæœ¬ä¹Ÿå¼€å§‹å¼€æ”¾ç»™ä¸šåŠ¡ä½¿ç”¨äº†ï¼ˆæ–‡ä¸­æˆªå›¾èƒ½çœ‹åˆ°å†…éƒ¨åŸŸåï¼‰ã€‚

> Qï¼šè¯·é—®å‡ ç§’çš„æ—¶å»¶å¯¹ä¸€äº›é«˜æ•ˆçš„æœåŠ¡æ¥è®²ä¹Ÿæ˜¯ä¸å¯æŽ¥å—çš„ã€‚å’±ä»¬æœ‰æƒ³è¿‡é€šè¿‡ä½•ç§æ–¹å¼åŽ»é¿å…ç°åº¦çš„æµé‡æŸå¤±é—®é¢˜ä¹ˆï¼Ÿ

Aï¼šè¿˜çœŸæ²¡é‡åˆ°è¿‡è¿™ä¸ªéœ€æ±‚ã€‚æˆ‘ç†è§£å¦‚æžœæœ‰ä¸€ä¸ªæœåŠ¡å¦‚æ­¤å…³é”®ï¼Œé‚£ä¹ˆåœ¨æ•´ä¸ªæµé‡å˜æ›´çŽ¯èŠ‚ï¼ˆä»Žæœºæˆ¿å…¥å£å¼€å§‹ï¼‰åˆ°ç°åº¦ç­–ç•¥ä¸Šéƒ½å¾—ä»”ç»†è€ƒè™‘ã€‚å¦‚æžœæŽ¥å—ä¸äº† Istio è¿™ä¸ªå»¶æ—¶ï¼Œä¸€ä¸ªæ€è·¯æ˜¯å®Œå…¨æŠ›å¼ƒ IstioIngressï¼Œç›´æŽ¥ä½¿ç”¨ä¸€ä¸ªåˆ‡æ¢è¿…é€Ÿçš„è´Ÿè½½å‡è¡¡å™¨ã€‚å› ä¸ºå®¹å™¨ IP æ˜¯ç›´é€šçš„ï¼Œå®Œå…¨å¯ä»¥ä»Žé›†ç¾¤å¤–ç›´æŽ¥è¿žè¿›æ¥ï¼Œåªè¦è§£å†³æœåŠ¡å‘çŽ°çš„é—®é¢˜å°±è¡Œã€‚

> Qï¼šåº”ç”¨æœåŠ¡è¿½è¸ªæ€Žä¹ˆå¤„ç†çš„ï¼Ÿå¯¹æŽ¥ Istioï¼Ÿ

Aï¼šè¯­è¨€æ ˆæ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹è¿™æ˜¯ä¸ªç—›ç‚¹ï¼Œç›®å‰æˆ‘ä»¬ä¹Ÿæ˜¯åœ¨å°è¯•ï¼Œå³ä½¿æ˜¯ Sidecar ä¹Ÿä¸èƒ½å®Œå…¨å¯¹ä¸šåŠ¡æ²¡ä¾µå…¥ã€‚å…¬å¸å†…éƒ¨ Java æŠ€æœ¯æ ˆæ›´å–œæ¬¢ Skywalking è¿™ç§å®Œå…¨æ— ä¾µå…¥çš„æ–¹å¼ã€‚

> Qï¼šä½¿ç”¨ Istio æ—¶ï¼Œæ€Žä¹ˆè§£å†³æ€§èƒ½æŸåé—®é¢˜çš„ï¼Ÿ

Aï¼šç›®å‰è¿˜æ²¡æœ‰å¯ç”¨ Mixer è¿™äº›å¯¹æ€§èƒ½å½±å“æ¯”è¾ƒå¤§çš„ç»„ä»¶ï¼Œæ‰€ä»¥ç›®å‰æ€§èƒ½æŸè€—è¿˜æ˜¯æ¯”è¾ƒå°çš„ã€‚å¦‚æžœå¯¹æ€§èƒ½æœ‰ä¸¥æ ¼çš„è¦æ±‚ï¼Œæˆ‘ä»¬ä¼šå»ºè®®ä»–ä½¿ç”¨ service name åšç›´è¿žã€‚

> Qï¼šPrometheus çš„å‘Šè­¦æ˜¯é ç¼–è¾‘å¤§é‡çš„ rule.ymlï¼Œè¯·é—®ç”Ÿäº§ä¸­æ˜¯æ€Žä¹ˆç®¡ç†çš„ï¼Ÿè§„åˆ™ç¼–è¾‘æ¯”è¾ƒéº»çƒ¦ï¼Œæ€Žä¹ˆè§£å†³ï¼ŸPrometheus æ˜¯å•ç‚¹ï¼Œæœ‰æ²¡æœ‰æ‰©å®¹æ–¹æ¡ˆï¼Ÿ

Aï¼šå°±æ˜¯é  Nier è¿™ä¸ªç»„ä»¶ï¼Œå°†è§„åˆ™æŠ½è±¡æˆæ¨¡æ¿ï¼Œç”šè‡³åœ¨äº‘å¹³å°ä¸Šé¢å¯¹äºŽç®€å•çš„è§„åˆ™ç›´æŽ¥å˜æˆäº†é€‰é¡¹ã€‚ç„¶åŽæ¨¡æ¿æ¸²æŸ“æˆè§„åˆ™ã€‚æˆ‘ä»¬çš„ Prometheus ç”¨çš„å®˜æ–¹çš„è”é‚¦é›†ç¾¤æ¨¡å¼ï¼Œå­˜å‚¨æ”¾åœ¨äº† Ceph ä¸Šé¢ã€‚

> Qï¼šä¸ºä»€ä¹ˆ Kubernetes é»˜è®¤çš„æ»šåŠ¨æ›´æ–°ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Ÿå“ªé‡Œæœ‰é—®é¢˜ï¼Ÿ

Aï¼šæ²¡åŠžæ³•ç²¾ç»†æŽ§åˆ¶ç°åº¦ç²’åº¦ï¼Œæ¯”å¦‚éƒ¨ç½²äº† 4 ä¸ªå®žä¾‹ï¼Œæˆ‘è¦æ±‚åˆ‡ 10% çš„æµé‡ç°åº¦ï¼Œè¿™å°±åšä¸åˆ°äº†ã€‚å¦å¤–ï¼Œæ»šåŠ¨æ›´æ–°å›žæ»šä¹Ÿæ¯”è¾ƒæ…¢ã€‚

> Qï¼šæ³¨å†Œåˆ° ZooKeeper çš„ IP æ˜¯ Pod IPï¼ŸZooKeeper ä»Žå¤–éƒ¨ç›´æŽ¥è®¿é—® Pod IP å—ï¼Ÿ

Aï¼šå¯¹çš„ï¼ŒPod å’Œ VM èƒ½ç›´é€šï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª Dubbo æœåŠ¡èƒ½åŒæ—¶éƒ¨ç½²åœ¨ VM å’Œå®¹å™¨é‡Œé¢ã€‚

> Qï¼šç›®å‰æ”¯æ’‘çš„ç”Ÿäº§åº”ç”¨æœåŠ¡è§„æ¨¡å’Œäº‘å¹³å°çš„è§„æ¨¡èƒ½ä»‹ç»ä¸‹ï¼ŸåŒ…æ‹¬ä¸€äº›æŒ‡æ ‡ï¼Œæ¯”å¦‚å¤šå°‘åº”ç”¨è¿›è¡Œç°åº¦æ›´æ–°è€—æ—¶ï¼Ÿ

Aï¼šåº”ç”¨è§„æ¨¡çš„è¯ç›®å‰è¶…è¿‡ 1000 äº†ï¼Œæ¯ä¸ªæœˆå‘å¸ƒæ¬¡æ•°è¶…è¿‡ 10000ã€‚ç°åº¦æ›´æ–°æ˜¯ç”¨æˆ·è‡ªè¡ŒæŽ§åˆ¶æ•´ä¸ªå‘å¸ƒè¿›åº¦çš„ï¼Œæ‰€ä»¥è€—æ—¶ä¸å¤ªæœ‰å‚è€ƒæ„ä¹‰ã€‚

---

### 2019-04-03ï¼šå®¹å™¨çŽ¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®žè·µ

> Qï¼šKubernetes ä¸Šä¸»æµçš„ CI/CD æ–¹æ¡ˆæ˜¯å•¥ï¼Ÿ

Aï¼šå…¶å®žè¿™æ— å…³ Kubernetesï¼Œä»Žå¸‚åœºå æœ‰çŽ‡æ¥çœ‹ï¼Œå‰ä¸‰ååˆ†åˆ«æ˜¯ Jenkinsã€JetBrains TeamCityã€CircleCIã€‚[æ¥æºï¼š](https://www.datanyze.com/market-share/ci)

> Qï¼šGitLab è‡ªå¸¦çš„ CI ä¸Ž Jenkins å’Œ GitLab ç»“åˆçš„ CIï¼Œè¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿæƒ³çŸ¥é“æ›´æ·±å±‚æ¬¡çš„ç†è§£ã€‚

Aï¼šè¿˜æ˜¯è¦ç»“åˆè‡ªå·±å›¢é˜Ÿçš„å®žé™…æƒ…å†µåšé€‰æ‹©ã€‚ä»Žæˆç†Ÿåº¦æ¥è¯´ï¼Œè‚¯å®šæ˜¯ Jenkins ç”¨æˆ·æœ€å¤šï¼Œæˆç†Ÿåº¦æœ€é«˜ï¼Œç¼ºç‚¹æ˜¯ä¾§é‡ Javaï¼Œé…ç½®ç›¸å¯¹ç¹çã€‚GitLab è‡ªå¸¦çš„ CI ç›¸å¯¹ç®€å•ï¼Œå¯ä»¥ç”¨ yamlï¼Œå’Œ GitLab ç»“åˆçš„æœ€å¥½ï¼Œä½†åŠŸèƒ½è‚¯å®šæ²¡æœ‰ Jenkins å…¨é¢ã€‚å¦‚æžœæ˜¯å°å›¢é˜Ÿæ–°é¡¹ç›®ï¼ŒGitLab CI åˆå·²ç»å¯ä»¥æ»¡è¶³éœ€æ±‚çš„è¯ï¼Œå¹¶ä¸éœ€è¦ä¸Š Jenkinsï¼Œå¦‚æžœæ˜¯è¾ƒå¤§çš„å›¢é˜Ÿï¼Œåˆæ˜¯å Java çš„ï¼Œä¸ªäººæ›´åå‘ Jenkinsã€‚

> Qï¼šJenkins å¦‚æžœä¸æƒ³è¿è¡Œåœ¨ Kubernetes é‡Œé¢ï¼Œè¯¥æ€Žä¹ˆå’Œ Kubernetes é›†æˆï¼Ÿ

Aï¼šä»Ž CI çš„æµç¨‹æ¥è¯´ï¼ŒCI åº”ç”¨æ˜¯ä¸æ˜¯è·‘åœ¨ Kubernetes çš„å¹¶ä¸é‡è¦ï¼ŒCI åªè¦èƒ½è®¿é—®ä»£ç åº“ï¼Œæœ‰æƒé™åœ¨ç”Ÿäº§çŽ¯å¢ƒå‘å¸ƒï¼Œæ˜¯ä¸æ˜¯è·‘åœ¨å®¹å™¨é‡Œä»Žæ•ˆæžœæ¥è¯´å…¶å®žæ²¡æœ‰åŒºåˆ«ï¼Œåªæ˜¯ç”¨ Kubernetes éƒ¨ç½² Jenkins çš„è¯ï¼Œè¿ç»´çš„ä¸€è‡´æ€§æ¯”è¾ƒå¥½ï¼Œè¿ç»´å›¢é˜Ÿä¸ç”¨é¢å¤–èŠ±æ—¶é—´ç»´æŠ¤ä¸€å¥—ç‰©ç†æœºçš„éƒ¨ç½²æ–¹æ¡ˆã€‚

> Qï¼šKubernetes çš„å›žæ»šæ–¹æ¡ˆæ˜¯å›žæ»šä»£ç ï¼Œé‡åšé•œåƒï¼Œè¿˜æ˜¯å…ˆåˆ‡æµé‡ï¼ŒåŽåšä¿®æ”¹ï¼Ÿ

Aï¼šä»£ç ä¸€å®šæ˜¯æ‰“åŒ…åˆ°é•œåƒé‡Œçš„ï¼Œé•œåƒçš„ç‰ˆæœ¬å°±æ˜¯ä»£ç çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸€å®šæ˜¯åˆ‡é•œåƒã€‚è‡³äºŽå›žæ»šæ“ä½œæœ¬èº«ï¼ŒKubernetes å·²ç»å†…ç½®äº†å¾ˆå¤šæ»šåŠ¨å‘å¸ƒï¼ˆRollingupdateï¼‰çš„ç­–ç•¥ï¼Œæ— è®ºæ˜¯å‘æ–°ç‰ˆæœ¬è¿˜æ˜¯å›žæ»šç‰ˆæœ¬ï¼Œéƒ½å¯ä»¥åšåˆ°ç”¨æˆ·æ— æ„ŸçŸ¥ã€‚

> Qï¼šé•œåƒå¤§åˆ°å‡  G çš„è¯å¦‚ä½•æ›´æ–°éƒ¨ç½²ï¼Œæœ‰ä»€ä¹ˆå¥½çš„å®žè·µå‘¢ï¼Œä»¥åŠå¦‚ä½•å›žæ»šï¼Ÿ

Aï¼šå‡ ä¸ªè¦ç‚¹ï¼š> Qï¼šDrone å¼€æ”¾ API æœåŠ¡å—ï¼Ÿè¿™æ ·æ–¹ä¾¿å…¶ä»–ç³»ç»Ÿé›†æˆã€‚

Aï¼šå¯ä»¥è°ƒæ•´ä¸€ä¸‹æ€è·¯ï¼Œç›´æŽ¥æŠŠéœ€è¦çš„åŠŸèƒ½åšæˆé•œåƒåœ¨ Drone é‡Œè°ƒç”¨å°±å¥½äº†ã€‚

> Qï¼šå¦‚æžœæœ‰ Drone çš„ Server æ€Žä¹ˆåšé«˜å¯ç”¨ï¼Ÿ

Aï¼šDrone serve r ç”¨ Kubernetes éƒ¨ç½²çš„è¯æœ¬èº«åªèµ·åˆ°äº†ä¸€ä¸ªä»»åŠ¡è°ƒåº¦çš„ä½œç”¨ï¼Œå¾ˆéš¾ä¼šé‡åˆ°æ€§èƒ½ç“¶é¢ˆã€‚çœŸçš„æœ‰æ€§èƒ½é—®é¢˜å¯ä»¥å°è¯•æ°´å¹³æ‰©å±• Drone serverï¼Œå…±äº«åŒä¸€æ•°æ®åº“ã€‚

---

### 2019-03-28ï¼šåŸºäºŽ OVN çš„ Kubernetes ç½‘ç»œæž¶æž„è§£æž

> Qï¼šOVS æ–¹æ¡ˆä¸ŽåŸºäºŽä¸‰å±‚äº¤æ¢æœºæ–¹æ¡ˆå¯¹æ¯”ï¼Œå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ

Aï¼šOVS æœ€å¤§çš„ä¼˜ç‚¹åœ¨äºŽå¯ç¼–ç¨‹ï¼Œçµæ´»æ€§æ¯”è¾ƒå¥½ã€‚è™šæ‹Ÿç½‘ç»œä¸ç”¨æ‰‹åŠ¨æ’ç½‘çº¿ï¼Œè€Œä¸”æœ‰ OpenFlow åŠ æŒï¼Œå¯ä»¥å®žçŽ°ä¸€äº›æ™®é€šäº¤æ¢æœºæ— æ³•å®žçŽ°çš„æµé‡æŽ§åˆ¶ã€‚ç‰©ç†äº¤æ¢æœºçš„ä¸»è¦æœ‰ç‚¹å°±æ˜¯æ€§èƒ½å¥½ï¼Œè€Œä¸”æ¯”è¾ƒç¨³å®šï¼Œä¸å®¹æ˜“å‡ºé—®é¢˜ã€‚

> Qï¼šOVN ä¸æ”¯æŒ ECMPï¼Œè²Œä¼¼çŽ°åœ¨è¿˜æ˜¯ active-standby æœºåˆ¶ï¼Œä½ ä»¬æ€Žä¹ˆè§£å†³ Gateway ç“¶é¢ˆé—®é¢˜ï¼Ÿ

Aï¼šæœ‰å‡ ç§æ–¹å¼ï¼š1. Gateway ç”¨ DPDK è¿™æ ·çš„é«˜é€Ÿ DataPathï¼›2. å¤š Gatewayï¼Œç”¨ç­–ç•¥è·¯ä¸åŒçš„ IP æ®µèµ°ä¸åŒ Gatewayï¼Œå¯ä»¥åˆ†æ‹…æµé‡ï¼›3. ä¸ä½¿ç”¨ OVN æ¦‚å¿µçš„ Gatewayï¼Œè‡ªå·±åšä¸€äº›æ‰‹è„šä»Žæ¯å°å®¿ä¸»æœºç›´æŽ¥å‡ºåŽ»ï¼Œä¹Ÿæ˜¯åˆ†æ‹…æµé‡é™ä½Žå•ç‚¹çš„é£Žé™©ã€‚

> Qï¼šOVN-Kubernetes å¥½åƒåªæ”¯æŒæ¯ä¸ªéƒ¨ç½²èŠ‚ç‚¹ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œç½‘æ®µã€‚å¦‚ä½•é¿å… IP æ± æµªè´¹å’Œä¸å‡è¡¡ï¼Ÿ

Aï¼šè¿™ä¸ªå…¶å®žæ˜¯è¿™ä¸ªé¡¹ç›®å®žçŽ°çš„ç½‘ç»œæ¨¡åž‹çš„ä¸€ä¸ªå±€é™æ€§ã€‚åœ¨æˆ‘ä»¬çš„å®žçŽ°é‡Œæ˜¯ä»¥ namespace ä¸ºç²’åº¦åˆ’åˆ†å­ç½‘ï¼Œå¯ä»¥å¯¹æ¯ä¸ª namespace è¿›è¡ŒæŽ§åˆ¶ï¼Œæƒ…å†µä¼šå¥½å¾ˆå¤šã€‚

> Qï¼šOVN å¦‚æžœæœ‰ä¸åŒçš„ Chassisï¼Œä½†æ˜¯ç›¸åŒ IP å°±ä¼šé€ æˆç½‘ç»œå¼‚å¸¸ï¼ˆæ¯”å¦‚ç‰©ç†æœºï¼ŒVM è£…ä¸Š OVNï¼Œæ³¨å†Œåˆ°è¿œç«¯åŽï¼Œè¢«é‡å»ºï¼ŒåŽé¢åˆæ³¨å†Œåˆ°è¿œç«¯ï¼Œä½†æ˜¯ Chassis å·²ç»æ”¹å˜ï¼‰ï¼Œä¼šå¯¼è‡´å¤§é‡èŠ‚ç‚¹ Geneve ç½‘ç»œå¼‚å¸¸ã€‚ä½ ä»¬æ€Žä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ

Aï¼šæš‚æ—¶æ²¡ç¢°åˆ°è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å®žçŽ°çš„ä¸€ä¸ªåŽŸåˆ™å°±æ˜¯å°½å¯èƒ½ä¿è¯æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯å¹‚ç­‰çš„ã€‚å‘è¿™ç§å¯èƒ½éœ€è¦åœ¨é‡è¿žå‰åšä¸€ä¸ªæ£€æŸ¥ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è¿‡æœŸçš„æ•°æ®éœ€è¦æ¸…ç†ï¼Œå†è¿žæŽ¥ï¼Œæˆ–è€…å¤ç”¨æ—§çš„è¿žæŽ¥ä¿¡æ¯åŽ»è¿žæŽ¥ã€‚

> Qï¼šå¦‚ä½• debug OVN é€»è¾‘æ‹“æ‰‘æ˜¯å¦é…ç½®æœ‰é—®é¢˜ï¼Ÿ

Aï¼šç›®å‰ debug ç¡®å®žå¾ˆå¤šæƒ…å†µåªèƒ½é çœ¼çœ‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ ovn-trace è¿™ä¸ªå·¥å…·å¯ä»¥æ‰“å°æ•°æ®åŒ…åœ¨é€»è¾‘æµé‡Œçš„é“¾è·¯æ¥æŽ’æŸ¥ã€‚

> Qï¼šOVS è·Ÿ Calico ç­‰æœ‰å•¥åŒºåˆ«ï¼Ÿ

Aï¼šCalico ä¸»è¦ä¾èµ– Linux çš„è·¯ç”±åŠŸèƒ½åšç½‘ç»œæ‰“é€šï¼ŒOVS æ˜¯åœ¨è½¯ä»¶äº¤æ¢æœºå±‚é¢å®žçŽ°ç½‘ç»œæ‰“é€šï¼Œå¹¶æä¾›äº†æ›´ä¸°å¯Œçš„ç½‘ç»œåŠŸèƒ½ã€‚

> Qï¼šOVS çš„å°åŒ…æ”¯æŒæœ‰ STT å’Œ Geneveï¼Œä½ ä»¬é€‰ç”¨å“ªç§ï¼Œä¸ºä»€ä¹ˆï¼Ÿ

Aï¼šå…¶å®žè¿˜æ”¯æŒ VXLANï¼Œæˆ‘ä»¬é€‰çš„ Geneveã€‚åŽŸå› æ¯”è¾ƒç®€å•ï¼ŒGeneve æ˜¯ç¬¬ä¸€ä¸ª OVN æ”¯æŒçš„å°åŒ…åè®®ï¼Œè€Œä¸”çœ‹äº†ä¸€äº›è¯„æµ‹ï¼Œæ®è¯´åœ¨æžå†…æ ¸å¼€å¯ UDP Checksum çš„æƒ…å†µä¸‹æ€§èƒ½ä¼šæ¯” VXLAN è¦å¥½ä¸€äº›ã€‚

> Qï¼šOVS å¦‚ä½•å®žçŽ°å›ºå®šå®¹å™¨ IPï¼Ÿ

Aï¼šè¿™ä¸ªå…¶å®ž OVS æœ‰å¯¹åº”çš„è®¾ç½®å¯ä»¥ç»™æ¯ä¸ªç«¯å£è®¾å®š IP å’Œ MACEï¼Œè¿™æ ·ç½‘å¡å¯åŠ¨æ—¶é…ç½®ç›¸åŒçš„ä¿¡æ¯å°±å¯ä»¥äº†ï¼Œéš¾ç‚¹å…¶å®žæ˜¯å¦‚ä½•æŽ§åˆ¶ OVN æ¥åˆ†é… IPï¼Œæ„Ÿè§‰è¿™ä¸ªè¯é¢˜å¯ä»¥å†å¼€ä¸€åœºåˆ†äº«æ¥è®¨è®ºäº†ã€‚

> Qï¼šå¯ä»¥ç®€å•ä»‹ç»ä¸‹ä½ ä»¬å‡†å¤‡å¼€æºçš„ç½‘ç»œåŠŸèƒ½å—ï¼Ÿ

Aï¼šæ¯ä¸ª namespace å’Œä¸€ä¸ª logical_switch ç»‘å®šï¼Œæ”¯æŒå­ç½‘åˆ†é…ï¼Œæ”¯æŒå›ºå®š IPï¼Œæ”¯æŒ QoSï¼Œæ”¯æŒ NetworkPolicyï¼Œå†…ç½®çš„ LBï¼Œå†…ç½®çš„ DNSï¼Œå¤§è‡´å°±æ˜¯æŠŠ OVN çš„æ¦‚å¿µæ˜ å°„åˆ° Kubernetesã€‚

> Qï¼šæƒ³äº†è§£ä¸€ä¸‹ï¼Œå¦‚æžœé‡‡ç”¨ OVNï¼Œæ˜¯ä¸æ˜¯æ„å‘³ç€ä½¿ç”¨ OpenStack å¹³å°å’Œ Kubernetes ç½‘ç»œå¯ä»¥ç›´æŽ¥äº’é€šï¼Ÿå®Œæˆä¸šåŠ¡åœ¨è™šæ‹Ÿæœºå’Œ Pod ä¹‹é—´çš„å…¨æ–°è´Ÿè½½æ–¹å¼ï¼Ÿ

Aï¼šæ˜¯è¿™æ ·çš„ï¼Œå¦‚æžœæ¶‰åŠçš„åˆç†å¯ä»¥åšåˆ°å®¹å™¨å’Œ VM ä½¿ç”¨åŒä¸€ä¸ªåº•å±‚ç½‘ç»œåŸºç¡€è®¾æ–½ï¼ŒVM å’Œå®¹å™¨ä¹‹é—´å¯ä»¥ IP ç›´è¾¾ï¼Œæ‰€æœ‰çš„ ACLã€LB éƒ½æ˜¯æ‰“é€šçš„ã€‚

> Qï¼šç›´æŽ¥æŠŠ OpenShift OVS æŠ½å‡ºæ¥åš Kubernetes çš„ç½‘ç»œæ’ä»¶å’Œçµé›€äº‘åšçš„è¿™ä¸ªåŒºåˆ«åœ¨å“ªï¼Ÿ

Aï¼šåŠŸèƒ½ä¸Šæœ‰å¾ˆå¤šæ˜¯ç›¸åŒçš„ï¼Œå› ä¸ºåº•å±‚éƒ½æ˜¯ OVSã€‚å¦‚æžœå…³æ³¨ Roadmap ä¼šå‘çŽ° OpenShift ä¹‹åŽä¹Ÿä¼šé‡‡ç”¨ OVS çš„æ¨¡å¼ã€‚ä»Žæž¶æž„çš„è§’åº¦æ¥çœ‹ï¼ŒçŽ°åœ¨ openshift-multitenant çš„å®žçŽ°å¾ˆç±»ä¼¼ Neutron ä¹‹å‰é‚£ä¸€å¥—ï¼Œå„ç§ Agentï¼Œä¹‹åŽä¼šç»Ÿä¸€åˆ° OVNã€‚å¦ä¸€æ–¹é¢ OpenShift çš„ç½‘ç»œæ’ä»¶ç»‘å®šçš„å¤ªæ­»äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šè¿˜æ˜¯è‡ªå·±æŠ½å‡ºæ¥ï¼Œé¡ºä¾¿èƒ½å®žçŽ°æˆ‘ä»¬çš„ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½ï¼Œæ¯”å¦‚å›ºå®š IPï¼Œå­ç½‘å…±äº«ï¼Œä»¥åŠä¸€äº›ç½‘å…³æŽ§åˆ¶å±‚é¢çš„åŠŸèƒ½ã€‚

> Qï¼šè¯·é—® Geneve å’Œ VXLAN çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ

Aï¼šGeneve å¯ä»¥ç†è§£ä¸ºä¸‹ä¸€ä»£ VXLANï¼ŒVXLAN ç›¸å¯¹ VLAN æ¥è¯´å¤´éƒ¨æ›´é•¿å¯ä»¥æ”¯æŒæ›´å¤šçš„ VLANï¼Œä½†æ˜¯ç”±äºŽæ˜¯å›ºå®šé•¿åº¦çš„å°è£…å¤´ï¼Œä¸èƒ½ä»»æ„åŠ æŽ§åˆ¶ä¿¡æ¯ã€‚Geneve é‡‡ç”¨å˜é•¿çš„å°è£…å¤´ï¼Œå¯ä»¥åŠ å¾ˆå¤šè‡ªå®šä¹‰çš„æŽ§åˆ¶ä¿¡æ¯ï¼Œæ–¹ä¾¿ä¹‹åŽåšæ›´å¤æ‚çš„ç½‘ç»œç®¡æŽ§ã€‚

> Qï¼šDocker CNM ä¹Ÿæ”¯æŒå›ºå®š IPï¼Œå’Œä½ è¯´çš„å›ºå®š IP æ˜¯ä¸€å›žäº‹å—ï¼Ÿå¦å¤–ï¼ŒåŸºäºŽ OVS å»ºç«‹çš„ç½‘ç»œæ˜¯ CNI è¿˜æ˜¯ CNM çš„å‘¢ï¼Ÿ

Aï¼šåŸºäºŽ CNIï¼Œå› ä¸ºæˆ‘ä»¬ä¾èµ– Kubernetes çš„æ¨¡åž‹ã€‚ä¸è¿‡è¯è¯´å›žæ¥æˆ‘å¾ˆå–œæ¬¢ Docker CNM é‚£å¥—æ¨¡åž‹ï¼Œæ¯” CNI è¦å®žç”¨å¾ˆå¤šã€‚å›ºå®š IP å…¶å®žåªæ˜¯ä¸ªåŠŸèƒ½ï¼Œå„ç§æ¨¡åž‹ä¸‹éƒ½å¯ä»¥å®žçŽ°ï¼Œæ•ˆæžœå°±æ˜¯å¯ä»¥ç»™ Pod æŒ‡å®š IP å¯åŠ¨ï¼ŒWorkload ä¸‹çš„å¤šä¸ª Pod å®žç”¨çš„æ˜¯ä¸€ç»„å›ºå®šçš„åœ°å€ã€‚

> Qï¼šç›®å‰ä½ ä»¬å¯¹ä¼ä¸šçš„è§£å†³æ–¹æ¡ˆé‡Œä¼šé»˜è®¤é‡‡ç”¨è¿™ç§ç½‘ç»œæ¨¡å¼ä¹ˆï¼Ÿ

Aï¼šè¿™ä¸ªæ–¹æ¡ˆæ˜¯æˆ‘ä»¬è¿™å‡ å¹´éœ€æ±‚å’Œç¢°åˆ°å‘çš„ä¸€ä¸ªç§¯ç´¯å§ï¼ŒçŽ°åœ¨è¿˜ä¸ä¼šç›´æŽ¥ç»™ä¼ä¸šç”¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›åŠŸèƒ½çš„å¼€å‘å’Œæµ‹è¯•ï¼Œä½†æ˜¯ä¹‹åŽ Overlay çš„åœºæ™¯è¿™ä¸ªè‚¯å®šæ˜¯ä¸»æŽ¨äº†ï¼Œä¸»è¦æ˜¯å–ä»£åŽŸæ¥çš„ Flannel VXLAN ç½‘ç»œã€‚

> Qï¼šä½ äº†è§£ Contiv ç½‘ç»œæ–¹æ¡ˆå—ï¼Œå’Œè´µå…¬å¸çš„å®žçŽ°æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ

Aï¼šContiv æ˜¯æ€ç§‘åšçš„ï¼Œä¹Ÿæ˜¯ OVS å®žçŽ°çš„ï¼Œä¸è¿‡å®ƒçš„å®žçŽ°æ¯”è¾ƒæ—©ï¼Œè‡ªå·±æ‰‹åŠ¨å®žçŽ°äº†æ•´ä¸ªæŽ§åˆ¶å¹³é¢ï¼Œå¯ä»¥è®¤ä¸ºè‡ªå·±å†™äº†ä¸ªè·Ÿ OVN ç±»ä¼¼çš„ä¸œè¥¿æ¥æŽ§åˆ¶ OVSã€‚ä¸è¿‡çœ‹å®ƒæœ€è¿‘å·²ç»å¾ˆå°‘æ›´æ–°äº†ã€‚ç”¨ OVN èƒ½ç”¨å¾ˆå°‘çš„ä»£ç å°±å®žçŽ°åŸºæœ¬ç›¸åŒçš„åŠŸèƒ½ã€‚Contiv æœ‰ä¸ªæ¯”è¾ƒç‹¬ç‰¹çš„åŠŸèƒ½å°±æ˜¯æ”¯æŒ BGP çš„ç½‘ç»œé—´é€šä¿¡ï¼Œè¿™ä¸ªæ˜¯ OVN æš‚æ—¶ä¸æ”¯æŒçš„ã€‚

---

### 2019-03-21ï¼šå°å›¢é˜Ÿå¾®æœåŠ¡è½åœ°å®žè·µ

> Qï¼šæœåŠ¡æ²»ç†é—®é¢˜ï¼ŒæœåŠ¡å¤šäº†ï¼Œè°ƒç”¨æ–¹è¯·æ±‚æœåŠ¡æ–¹ï¼Œè¶…æ—¶æˆ–è€…ç½‘ç»œæŠ–åŠ¨ç­‰éœ€è¦å¯èƒ½éœ€è¦é‡è¯•ï¼Œå®¢æˆ·ç«¯ç­‰ä¸åŠäº†æ€Žä¹ˆåŠžï¼Ÿæ¯”å¦‚ A-> B-> Cï¼Œç­‰å¾…è¶…æ—¶æ—¶é—´éƒ½æ˜¯ 6sï¼Œå› ä¸º C æœåŠ¡ä¸ç¨³å®šï¼ŒB åšäº†é‡è¯•ï¼Œé‚£ä¹ˆå¢žåŠ äº† A è®¿é—® B çš„æ—¶é•¿ï¼Œå¯¼è‡´è¿žé”ååº”ï¼Ÿ

Aï¼šæœåŠ¡å‘çŽ°æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å®¢æˆ·ç«¯å‘çŽ°ï¼Œä¸€ç§æ˜¯æœåŠ¡ç«¯å‘çŽ°ã€‚å¦‚æžœæ˜¯å®¢æˆ·ç«¯å‘çŽ°çš„è¯ï¼Œå®¢æˆ·ç«¯éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¦‚æžœè¶…æ—¶å®¢æˆ·ç«¯éœ€è¦è‡ªå·±é‡è¯•ï¼Œæ­¤æ—¶å¦‚æžœæ˜¯è½®è¯¢åº”è¯¥å¯ä»¥è°ƒç”¨åˆ°æ­£å¸¸çš„æœåŠ¡æä¾›æ–¹ã€‚Spring Coud çš„ Ribbon å°±æ˜¯å¯¹è¿™ä¸€æµç¨‹åšäº†å°è£…ã€‚è‡³äºŽè¿žé”ååº”çš„é—®é¢˜ï¼Œéœ€è¦æœ‰é™çº§ç†”æ–­ï¼Œé…ç½® Hystrix ç›¸å…³å‚æ•°å¹¶å®žçŽ° fallback æ–¹æ³•ã€‚çœ‹æºç èƒ½å¤Ÿå‘çŽ° hystrixTimeout è¦å¤§äºŽ ribbonTimeoutï¼Œå³ Hystrix ç†”æ–­äº†ä»¥åŽå°±ä¸ä¼šé‡è¯•äº†ï¼Œé˜²æ­¢é›ªå´©ã€‚

> Qï¼šJVM å¦‚ä½• exportï¼Œæ˜¯å¤š container å—ï¼Œç›‘æŽ§æ•°æ®ï¼Œæœåˆ®åˆ° Prometheusï¼Ÿ

Aï¼šJVM çš„ç”¨çš„æ˜¯ Prometheus åŸ‹ç‚¹ï¼ŒJava é‡Œé¢çš„è·¯å¾„æ˜¯/actuator/prometheusï¼Œåœ¨ yaml é‡Œé¢å®šä¹‰ prometheus.io/path:/actuator/prometheu prometheus.io/port:'8090' prometheus.io/scrape:\'true\'ï¼Œå†åœ¨ Prometheus é‡Œé¢è¿›è¡Œç›¸åº”çš„é…ç½®ï¼Œå°±å¯ä»¥åŽ»æœåˆ®åˆ°è¿™äº›æš´éœ²çš„æŒ‡æ ‡ã€‚

> Qï¼šKubernetes å’Œ OpenShift å“ªä¸ªæ›´é€‚åˆå¾®æœåŠ¡çš„ä½¿ç”¨ï¼Ÿ

Aï¼šOpenShift æ˜¯ Kubernetes çš„ä¸‹æ¸¸äº§å“ï¼Œæ˜¯ Kubernetes ä¼ä¸šçº§çš„å°è£…ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ã€‚OpenShift å°è£…æœ‰åŠŸèƒ½æ›´å¼ºå¤§çš„ç›‘æŽ§ç®¡ç†å·¥å…·ï¼Œå¹¶ä¸”æ‹¥æœ‰ Kubernetes ä¸å¤ªå¥½åšçš„æƒé™ç®¡ç†ç³»ç»Ÿã€‚

> Qï¼šå¯ä»¥ä»‹ç»ä¸€ä¸‹ä½ ä»¬åœ¨ä¼˜åŒ–é•œåƒä½“ç§¯ä¸Šé¢åšäº†å“ªäº›å·¥ä½œå—ï¼Ÿ

Aï¼šRUN å‘½ä»¤å†™åœ¨ä¸€è¡Œä¸Šï¼Œäº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶å†åˆ æŽ‰ã€‚åªå®‰è£…å¿…é¡»è¦çš„åŒ…ã€‚JDK å’Œ Node.Js éƒ½æœ‰ slim é•œåƒï¼Œä¸€èˆ¬éƒ½æ˜¯ä»¥é‚£ä¸ªä¸ºåŸºç¡€é•œåƒåŽ»åšã€‚

> Qï¼šæ•°æ®åº“æ˜¯å¦çœŸçš„é€‚åˆæœ€å®¹å™¨åŒ–ï¼Ÿ

Aï¼šæˆ‘ä»¬ç”Ÿäº§æ•°æ®åº“ç”¨çš„æ˜¯ RDSï¼Œå¼€å‘æµ‹è¯•çŽ¯å¢ƒç”¨çš„æ˜¯ Docker Compose èµ·çš„ã€‚ä»Žç†è®ºä¸Šï¼Œæ•°æ®åº“æœ€å¥½åšå®¹å™¨åŒ–ï¼Œæ¨¡å—çš„ç‹¬ç«‹æ€§é«˜ï¼Œéœ€è¦è€ƒè™‘å¥½çš„æ˜¯æ•°æ®åº“å®¹å™¨çš„æ•°æ®æ°¸ä¹…åŒ–å­˜å‚¨ã€‚

> Qï¼šä¸ºä»€ä¹ˆé€‰æ‹©äº† OpenShiftï¼Ÿ

Aï¼šå› ä¸º OpenShift æœ‰ä¸ªå¾ˆæ–¹ä¾¿çš„ UIï¼Œå¤§å¤šæ•°éƒ½å¯ä»¥åœ¨ UI é‡Œé¢æ“ä½œï¼ŒåŒ…æ‹¬ yaml æ–‡ä»¶çš„ä¿®æ”¹ï¼Œé‡æ–°éƒ¨ç½²å›žé€€ç­‰æ“ä½œã€‚å¯¹äºŽå¼€å‘æµ‹è¯•æ¥è®²ï¼Œå­¦ä¹ çš„æˆæœ¬æ¯”è¾ƒä½Žï¼Œä¸éœ€è¦èŠ±æ—¶é—´ç†Ÿæ‚‰ CLI æ“ä½œã€‚

> Qï¼šPython åŸºç¡€é•œåƒæ€Žä¹ˆåˆ¶ä½œæœ€å¥½ï¼Œå¦‚æžœåŠ å…¥ GCCï¼ŒC++ ç­‰ç¼–è¯‘éœ€è¦çš„å·¥å…·ï¼Œé•œåƒä¼šç‰¹åˆ«å¤§ï¼Ÿ

Aï¼šPython åŸºç¡€é•œåƒç›´æŽ¥ä»Ž Python å®˜æ–¹ Docker é•œåƒä¸Šåšå°±è¡Œäº†ã€‚GCCï¼ŒC++ é‚£ä¸ªåšå‡ºæ¥çš„é•œåƒå¤§ä¹Ÿæ²¡åŠžæ³•ã€‚å¦‚æžœæ²¡è¿™ä¸ªéœ€æ±‚çš„è¯ï¼Œå¯ä»¥ç”¨ Python slim é•œåƒåŽ»åšã€‚

> Qï¼šåœ¨ Gateway ä¸­ Ribbon å¦‚ä½•æ ¹æ®å®¢æˆ·ç«¯çš„ IP è´Ÿè½½åˆ°å¯¹åº”çš„ IP æ³¨å†Œçš„æœåŠ¡ï¼Ÿ

Aï¼šå¦‚æžœä½¿ç”¨äº† Eureka çš„è¯ï¼ŒæœåŠ¡æä¾›æ–¹å¯åŠ¨æ—¶ä¼šè‡ªæ³¨å†Œåˆ° Eurekaã€‚æœåŠ¡è°ƒç”¨æ–¹å‘èµ·è¯·æ±‚å‰ä¼šä»Ž Eureka ä¸Šè¯»å–æä¾›æ–¹çš„åˆ—è¡¨ï¼Œå†è¿›è¡Œè´Ÿè½½å‡è¡¡å®šä½åˆ°å…·ä½“çš„ IP å’Œ Portã€‚å¦‚æžœè·Ÿæˆ‘ä»¬ä¸€æ ·ç›´æŽ¥ä½¿ç”¨ Kubernetes çš„ Serviceï¼Œå…¶å®žå°±æ˜¯ç”± Kubernetes æŽ§åˆ¶äº†ï¼ŒæœåŠ¡è°ƒç”¨æ–¹è®¿é—® Kubernetes æš´éœ²çš„ Serviceï¼Œç„¶åŽç”± Kubernetes è´Ÿè½½å‡è¡¡åˆ°è¿™ä¸ª Service èƒŒåŽçš„å…·ä½“çš„ Podã€‚

> Qï¼šå¦‚ä½•å®žçŽ°è¿œç¨‹å‘å¸ƒã€æ‰“åŒ…ï¼Ÿ

Aï¼šJenkins æ‰“åŒ…é•œåƒå‘å¸ƒåˆ° Harbor ä¸Šï¼ŒJenkins å†è°ƒç”¨ OpenShift åŽ»ä»Ž Harbor ä¸Šæ‹‰å–é•œåƒï¼Œé‡æ–° tag ä¸€ä¸‹å°±å¯ä»¥å®žçŽ°å‘å¸ƒã€‚

> Qï¼šè­¬å¦‚å®¢æˆ·ç«¯ IP æ˜¯ 10ï¼Œå¸Œæœ› Gateway è´Ÿè½½åˆ° 10 æ³¨å†Œçš„ order æœåŠ¡ï¼Œè€Œä¸æ˜¯å…¶ä»– IP æ³¨å†Œçš„ order æœåŠ¡ï¼Œå¸Œæœ›å¼€å‘ä½¿ç”¨é›†ä¸­çš„ Eureka å’Œ Gatewayï¼Ÿ

Aï¼šæ˜¯è¯´ä¸éœ€è¦è´Ÿè½½å‡è¡¡ï¼Ÿæœ€ç®€å•çš„å¯ä»¥çœ‹ä¸‹ Ribbon çš„å®žçŽ°ï¼Œè´Ÿè½½å‡è¡¡ç®—æ³•å¯ä»¥è‡ªå·±å®šä¹‰ï¼Œå¦‚æžœåªæ˜¯è¦å›ºå®š IP çš„è¯ï¼Œé‚£ä¹ˆéåŽ†æœåŠ¡åˆ—è¡¨å†åˆ¤æ–­å°±å¯ä»¥äº†ã€‚ä¸¤æ¬¡åˆ¤æ–­ï¼Œif serviceId=orderï¼Œif ip = 10ã€‚

> Qï¼šDocker ç®¡ç†å·¥å…·ä¸€èˆ¬ç”¨ä»€ä¹ˆï¼Ÿ

Aï¼šKubernetesï¼Œç®€ç§° k8s æ˜¯ç›®å‰è¾ƒçƒ­é—¨çš„ Docker ç®¡ç†å·¥å…·ã€‚ç¦»çº¿å®‰è£… Kubernetes æ¯”è¾ƒç¹çï¼Œæœ‰ä¸¤æ¬¾æ¯”è¾ƒå¥½çš„è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ï¼ŒUbuntu ç³»ç»Ÿçš„ Juju å’Œ Red Hat ç³»ç»Ÿçš„ OpenShiftï¼ŒOpenShift åˆç§°ä¸ºä¼ä¸šç‰ˆçš„ Kubernetesï¼Œæœ‰æ”¶è´¹çš„ä¼ä¸šç‰ˆå’Œå…è´¹ç‰ˆã€‚

> Qï¼šPrometheus æ˜¯æ¯ä¸ªé›†ç¾¤éƒ¨ç½²ä¸€å¥—å—ï¼Ÿå­˜å‚¨æ˜¯æ€Žä¹ˆå¤„ç†ï¼Ÿå­˜æœ¬åœ°è¿˜æ˜¯ï¼Ÿ

Aï¼šæ¯ä¸ªé›†ç¾¤éƒ¨ç½²ä¸€å¥—ï¼Œå­˜å‚¨æš‚æ—¶å­˜åœ¨æœ¬åœ°ï¼Œæ²¡æœ‰ç”¨æŒä¹…åŒ–å­˜å‚¨ã€‚å› ä¸ºçŽ°åœ¨çŽ¯å¢ƒéƒ½æ˜¯åœ¨äº‘ä¸Šé¢ï¼Œæœ¬èº«äº‘åŽ‚å•†å°±æœ‰å„ç§çš„ç›‘æŽ§æ•°æ®ï¼Œæ‰€ä»¥ Prometheus çš„ç›‘æŽ§æ•°æ®ä¹Ÿåªæ˜¯åšä¸ªè¾…åŠ©ä½œç”¨ã€‚

---

### 2019-02-28ï¼šéªžäº‘ç§‘æŠ€ DevOps å®žè·µ

> Qï¼šCMP å’Œå„ä¸ªäº‘å¹³å°æ‰“é€šéƒ½ä½¿ç”¨äº†å¹³å°çš„ jarï¼Œå¹¶ä¸”éœ€è¦å„ç§èµ„æºç”Ÿæˆï¼Œè¿™ä¸ªå·¥ä½œé‡ä¹Ÿä¸å°å§ï¼Ÿå¹¶ä¸”å¦‚æžœ api æ›´æ–°ä»£ç é‡ä¹Ÿå¤§å§ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„æ ¸å¿ƒä¸šåŠ¡å°±æ˜¯åšäº‘ç®¡ç†å¹³å°ï¼Œæˆ‘ä»¬äº§å“å·²ç»å®Œæˆäº†å¯¹å„ä¸ªäº‘å¹³å°çš„å¯¹æŽ¥ï¼Œä¸»è¦è°ƒç”¨å„ä¸ªäº‘å¹³å°çš„ APIã€‚å…¬æœ‰äº‘çš„ API æ›´æ–°é¢‘çŽ‡å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œæ¯å½“ API æœ‰æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬ä¹ŸåŠæ—¶åŽ»é€‚é…ã€‚

> Qï¼šJenkins åˆæ¬¡æäº¤ä¹Ÿèƒ½è§¦å‘æž„å»ºå—ï¼Ÿæ¯æ¬¡è‡ªåŠ¨åŒ–æž„å»ºç‰ˆæœ¬å·æ˜¯å¦‚ä½•æ›´æ–°çš„å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„é¡¹ç›®ä»£ç å…·å¤‡æž„å»ºæ¡ä»¶åŽï¼Œæ‰åœ¨ Jenkins ä¸Šåˆ›å»ºäº†é¡¹ç›®æž„å»º Jobï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰åœ¨åˆæ¬¡æäº¤æ—¶è§¦å‘æž„å»ºã€‚æ¯æ¬¡æž„å»ºçš„ç‰ˆæœ¬å·ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€éƒ¨åˆ†æ˜¯äº§å“çš„ Release å¤§ç‰ˆæœ¬å·ï¼Œå¦ä¸€éƒ¨åˆ†ç›´æŽ¥ä½¿ç”¨çš„ Jenkins build number è¿™ä¸ªçŽ¯å¢ƒå˜é‡ã€‚

> Qï¼šæœ‰äº† Gerritï¼Œä¸ºä»€ä¹ˆè¿˜è¦ GitLabï¼ŒGerrit ä¹Ÿå¯ä»¥æ‰˜ç®¡ä»£ç å•Šï¼Ÿ

Aï¼šè¿™ä¸ªæ˜¯æœ‰åŽ†å²èƒŒæ™¯çš„ï¼Œæˆ‘ä»¬æ˜¯å…ˆé€‰æ‹©ä½¿ç”¨ GitLab åšä»£ç æ‰˜ç®¡ï¼ŒåŽæœŸæ‰åŠ å…¥ Gerrit åš code reviewã€‚Gerrit åœ¨ä»£ç  review æ–¹é¢æ¯” GitLab çš„ merge request è¦æ–¹ä¾¿è®¸å¤šï¼Œæ›´é€‚åˆä¼ä¸šå†…éƒ¨ä½¿ç”¨ã€‚å…³äºŽè¿™ä¸ªï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ï¼Œè¦ä¹ˆå°† GitLab è¿ç§»åˆ° Gerritï¼Œè¦ä¹ˆä¸ç”¨ Gerritï¼Œå¯ä»¥ä½¿ç”¨ GitLab çš„ merge request æ¥è¿›è¡Œ reviewï¼Œé‚£ GitLab å…¶å®žæ˜¯å¯ä»¥ä¸è¦çš„ã€‚

---

### 2019-02-22ï¼šæˆ¿å¤šå¤š Service Mesh å®žè·µ

> Qï¼šå®¹å™¨å’Œå¾®æœåŠ¡çš„åŒºåˆ«ä»¥åŠå®ƒä»¬çš„å…³è”æ€§ã€åº”ç”¨åœºæ™¯ã€å®¢æˆ·ç¾¤ä½“ã€å¸¦æ¥çš„ä»·å€¼ï¼Ÿ

Aï¼šå¾®æœåŠ¡çš„åº”ç”¨åœºæ™¯ä¸»è¦æ˜¯è§£å†³é™ä½Žå•ä¸ªæœåŠ¡ä½“ç§¯ï¼Œæ»¡è¶³ä¸šåŠ¡çš„å¿«é€Ÿå¼€å‘éœ€æ±‚ã€‚å®¹å™¨å¯ä»¥è¯´æ˜¯å¾®æœåŠ¡çš„è½½ä½“ï¼Œå®¹å™¨æ–¹é¢è¿˜æ˜¯è¿ç»´å…³æ³¨çš„æ¯”è¾ƒå¤šï¼Œå¸¦æ¥çš„æ ‡å‡†åŒ–æµç¨‹å’ŒçŽ¯å¢ƒçš„æå‡å¯¹æ•´ä¸ªç ”å‘å›¢é˜Ÿéƒ½æœ‰å¾ˆå¤§çš„ä½œç”¨ã€‚

> Qï¼šè½¯ä»¶å®žçŽ° Service Meshï¼ŒIstioï¼Ÿ

Aï¼šæˆ‘ä»¬ç›®å‰åªä½¿ç”¨äº† Envoyï¼ŒIstio ä¹Ÿåšè¿‡ä¸€äº›é€‰åž‹çš„è°ƒç ”ï¼Œä¸æ˜¯å¾ˆç¬¦åˆæˆ‘ä»¬çŽ°åœ¨çš„ä¸šåŠ¡åœºæ™¯å’Œä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬åœ¨ä¹‹åŽçš„å®žè·µä¸­ä¼šè€ƒè™‘ä½¿ç”¨ä¸€éƒ¨åˆ† Istio çš„åŠŸèƒ½ã€‚

> Qï¼šå®žæ–½è¿‡ç¨‹å½“ä¸­æœ‰ä½¿ç”¨åˆ° Istio å—ï¼Ÿæœ‰å®šåˆ¶ä¸€äº› Mixer é€‚é…å™¨å—ï¼Ÿ

Aï¼šç›®å‰è¿˜æ²¡æœ‰ç”¨ï¼Œä¹‹åŽä¼šè€ƒè™‘æ˜¯ç”¨ Istio ä¸­çš„ pilotï¼Œæˆ‘ä»¬ç›®å‰åœ¨æµé‡çš„æŽ§åˆ¶çš„ç²¾ç»†ç¨‹åº¦ä¸Šé¢è¿˜æ¬ ç¼ºï¼Œç²’åº¦è¿˜å¾ˆç²—ã€‚

> Qï¼šè¯·é—®ï¼Œå®žçŽ°å¾®æœåŠ¡è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰è€ƒè™‘åˆ†å¸ƒå¼è·Ÿè¸ªå’Œåˆ†å¸ƒå¼ï¼Ÿ

Aï¼šService Mesh å±‚å¯ä»¥åšåˆ°ç®€å•çš„åˆ†å¸ƒå¼è¿½è¸ªï¼Œæ¯”å¦‚å¯ä»¥åšåˆ°åŸºäºŽè¯·æ±‚çš„è¿½è¸ªï¼ŒEnvoy å¯ä»¥æŠŠ trace æ•°æ®æŽ¥å…¥ Zipkin è¿™æ ·çš„ trace ç³»ç»Ÿï¼Œä½†æ˜¯æ›´ç»†ç²’åº¦çš„ trace ç›®å‰è¿˜åšä¸åˆ°ã€‚

> Qï¼šä¸è®ºæ˜¯ä½¿ç”¨éƒ½ä¼šäº§ç”Ÿå¤§é‡çš„é…ç½®ï¼ˆyamlï¼‰ï¼Œå°¤å…¶æ˜¯ Envoy/Istioï¼Œç³»ç»Ÿä¸­ä¼šæœ‰å¤§é‡é›¶æ•£çš„é…ç½®æ–‡ä»¶ï¼Œç»´æŠ¤å›°éš¾ï¼Œè¿˜æœ‰ç‰ˆæœ¬ç®¡ç†ï¼Œæœ‰ä»€ä¹ˆå¾ˆå¥½çš„ç»´æŠ¤å®žè·µç»éªŒå—ï¼Ÿè°¢è°¢ã€‚

Aï¼šæ˜¯çš„ï¼Œæ®æˆ‘æ‰€çŸ¥æœ‰äº›å›¢é˜Ÿä¼šä½¿ç”¨ ConfigMap æ¥ç®¡ç†é…ç½®ï¼Œæˆ‘ä»¬åšäº†ä¸€ä¸ªé…ç½®çš„é›†ä¸­ç®¡ç†æœåŠ¡ï¼Œä»Ž CMDB å’Œ DNS å®šæ—¶çš„æŠ“å–æ•°æ®ï¼Œæ•°æ®ä¼šå­˜åœ¨æ•°æ®åº“é‡Œé¢ï¼Œä¹Ÿä¼šå­˜ä¸€å®šé‡çš„å‰¯æœ¬ç”¨äºŽé…ç½®å›žé€€ï¼Œè¿™ä¸ªåœ°æ–¹è¿˜æ˜¯è¦ç»“åˆä½ ä»¬çŽ°åœ¨å…¶ä»–é…å¥—ç³»ç»Ÿçš„å»ºè®¾æ¥çœ‹çœ‹æ€Žä¹ˆåšæ¯”è¾ƒå¥½çš„ã€‚

> Qï¼šæœ‰æ²¡æœ‰é‡åˆ°è¿‡ Envoy è¢« oom kill çš„æƒ…å†µï¼Œä½ ä»¬æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ

Aï¼šè¿™ä¸ªæˆ‘æœ‰ç¢°åˆ°è¿‡ä¸€æ¬¡ï¼Œä¹‹å‰æˆ‘ä»¬åœ¨å¯¹ Envoy åšæµ‹è¯•çš„æ—¶å€™ï¼Œå‘çŽ° Envoy æ€»ä¼šå°½å¯èƒ½çš„å æ»¡ CGroup çš„å†…å­˜å¤§å°ï¼Œè¿™ä¸ªä¹‹å‰åœ¨ä½¿ç”¨ TLS çš„æƒ…å†µä¸‹ç¢°åˆ°çš„æ¯”è¾ƒå¤šã€‚ä½†æ˜¯ç›®å‰æˆ‘ä»¬å†…éƒ¨æœåŠ¡é—´ä½¿ç”¨ TLS çš„æƒ…å†µå¹¶ä¸å¤šï¼Œæ‰€ä»¥åŽç»­è¿™ä¸ªé—®é¢˜å°±æ²¡æœ‰ç»§ç»­è·Ÿè¿›äº†ã€‚

> Qï¼šæ€§åŒ–æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ

Aï¼šä¹‹å‰æ–‡ç« ä¸­æœ‰æåˆ°è¿‡ï¼Œå¯¹äºŽ http æœåŠ¡å¯ä»¥å…¨é‡æŽ¥å…¥ http2ï¼Œhttp2 çš„é•¿è¿žæŽ¥å’Œå¤šè·¯å¤ç”¨å¯¹äºŽä¸€èˆ¬çš„ä¸šåŠ¡æ¥è¯´å‡æ˜¯å¾ˆæ˜Žæ˜¾çš„ï¼Œæˆ‘ä»¬åœ¨å…¨é‡æŽ¥å…¥ http2 ä¹‹åŽï¼Œç½‘ç«™çš„å“åº”æ—¶é—´å‡ ä¹Žä¸‹é™äº† 50%ã€‚å¦å¤–è¿˜å¯ä»¥åœ¨åº•å±‚çš„ä¾èµ–ä¸Šé¢åšä¸€äº›ä¼˜åŒ–ï¼Œæ¯”å¦‚åº•å±‚çš„ libc åº“ï¼Œä»¥åŠå°½å¯èƒ½çš„å‡å°‘åŸºç¡€é•œåƒçš„å¤§å°ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šæ‰€æœ‰ä¸šåŠ¡éƒ½ä½¿ç”¨äº† alpineï¼Œè¿™æ ·å¯ä»¥ä¿è¯å‘å¸ƒæ€§èƒ½å’Œé€Ÿåº¦åœ¨ä¸€ä¸ªå¾ˆå¥½çš„æ°´å¹³ä¸Šã€‚

> Qï¼šè¿˜æ˜¯æœ‰ä¸€ä¸ªæœåŠ¡æ²»ç†/é…ç½®ç®¡ç†çš„é—®é¢˜è¯·æ•™ï¼Œæ¯”å¦‚ CPUï¼Œå†…å­˜ï¼Œè¿™ç§èµ„æº requestï¼Œåœ¨ devï¼Œtestï¼Œstagingï¼Œprod çŽ¯å¢ƒå‡ä¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ç¼–å†™ Kubernetes é…ç½®çš„æ—¶å€™ä¸åŒçŽ¯å¢ƒä¼šä¸åŒï¼Œæ¯”å¦‚æµ‹è¯•çŽ¯å¢ƒçš„ replics æ•°è·Ÿ CPU éœ€æ±‚å°±å¾ˆä½Žï¼Œç”Ÿäº§å°±å¾ˆé«˜ï¼Œå¦å¤–è¿™ä¸ªé…ç½®åœ¨ä¸åŒçŽ¯å¢ƒæ˜¯å¤šä¸ªè¿˜æ˜¯ä¸€ä¸ªå‘¢ï¼Ÿè°¢è°¢ã€‚

Aï¼šæˆ‘ä»¬çŽ°åœ¨ä¼šåœ¨ CMDB é‡Œé¢ç»´æŠ¤è¿™äº›é…ç½®æ•°æ®ï¼Œä¸€èˆ¬æ¥è¯´åœ¨æ–°å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šè¦æ±‚ä¸šåŠ¡çº¿è¯„ä¼°ä¸€ä¸‹è¿™ä¸ªä¸šåŠ¡éœ€è¦çš„èµ„æºï¼Œæ¯”å¦‚ä½ è¯´åˆ°çš„ test å’Œ staging çŽ¯å¢ƒè¿™ç§ï¼Œæˆ‘ä»¬é»˜è®¤ä¼šç»™ä¸€ä¸ªå¾ˆä½Žçš„éœ€æ±‚ï¼Œæ¯”å¦‚ 1c1g è¿™æ ·çš„ï¼Œè€Œä¸” replication ä¹Ÿä¼šé»˜è®¤è®¾ç½®ä¸º 1ï¼Œé™¤éžä¸šåŠ¡æœ‰ç‰¹æ®Šçš„éœ€æ±‚ï¼Œç„¶åŽæˆ‘ä»¬åŽ»æ ¹æ®é…ç½®çš„æ•°æ®åŽ»ç”Ÿæˆ yaml æ ¼å¼ä¸ºé…ç½®ã€‚

> Qï¼šä½ ä»¬ç›®å‰çš„é¡¹ç›®ä¸­ï¼Œå¤§é‡çš„å¾®æœåŠ¡ï¼Œä»¥åŠè°ƒåº¦å±‚ï¼Œç“¶é¢ˆå’Œå®¹ç¾æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ

Aï¼šç”±äºŽæˆ‘ä»¬çš„ä¸šåŠ¡ç±»åž‹è¿˜æ˜¯ B ç«¯ä¸šåŠ¡ä¸ºä¸»ï¼Œæµé‡çš„å³°å€¼æ˜¯å¯ä»¥é¢„ä¼°çš„ï¼Œå¾ˆå°‘ä¼šå‡ºçŽ°çªå‘çš„å¤§æµé‡çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½é¢„ç•™äº† 1 å€çš„å®¹é‡ç”¨äºŽä¸´æ—¶çš„æ‰©å®¹ã€‚å®¹ç¾å’Œè°ƒåº¦çš„è¯æˆ‘ä»¬ä¸»è¦è¿˜æ˜¯å°½å¯èƒ½çš„éš”ç¦»å·¥ä½œèŠ‚ç‚¹å’Œè°ƒåº¦èŠ‚ç‚¹ï¼Œä»¥åŠå¤§é‡ä½¿ç”¨ç‰©ç†æœºé›†ç¾¤ï¼Œä»Žæˆ‘ä»¬çš„ä½¿ç”¨ä½“éªŒä¸Šæ¥çœ‹ï¼Œç‰©ç†æœºçš„ç¨³å®šæ€§è¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚

> Qï¼šå¦‚ä½•ç”¨ Jenkins è‡ªåŠ¨å®Œæˆ Kubernetes éƒ¨ç½²ï¼Ÿ

Aï¼šè‡ªåŠ¨éƒ¨ç½²è¿™å—æˆ‘ä»¬æœ‰å®Œå–„çš„å‘å¸ƒç³»ç»Ÿï¼Œå¦‚æžœå•çº¯åªè¦å®žçŽ° Jenkins è‡ªåŠ¨å®Œæˆ Kubernetes çš„è¯ï¼ŒJenkins å¯ä»¥ç›´æŽ¥è°ƒç”¨ Kubernetes çš„ APIï¼Œè¿™ä¸ªç½‘ä¸Šæœ‰æŒºå¤šèµ„æ–™çš„ï¼Œä½ å¯ä»¥æ‰¾æ‰¾çœ‹ã€‚

> Qï¼šService Mesh æ¯”ä¼ ç»Ÿçš„å¾®æœåŠ¡æ²»ç†å¥½åœ¨å“ªé‡Œï¼Ÿ

Aï¼šé™ä½Žæ¡†æž¶å¼€å‘æˆæœ¬ã€ä»£ç†è§„åˆ™çµæ´»ï¼Œæ–¹ä¾¿ä¿®æ”¹ç­–ç•¥ã€æ¡†æž¶åŠŸèƒ½çš„å‡çº§æ— éœ€ä¾èµ–ä¸šåŠ¡ï¼Œæœ€å¤§çš„å¥½å¤„æˆ‘è§‰å¾—å°±æ˜¯å¯ä»¥é™ä½Žæ¡†æž¶å¼€å‘æˆæœ¬ã€‚

> Qï¼šæˆ‘ç†è§£æˆ¿å¤šå¤šç›®å‰çš„ Mesh æ–¹æ¡ˆæ²¡æœ‰ç»™æ¯ä¸ªå¾®æœåŠ¡é…ä¸€ä¸ª Envoy ä½œä¸º Sidecarï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ç»„ Enovy å¹¶è‡ªç ”äº† xDS çš„é…ç½®å‘å¸ƒç®¡ç†ç³»ç»Ÿï¼Œå¯¹å—ï¼Ÿæˆ‘æƒ³è¯·é—® backend å¾®æœåŠ¡ä¹‹é—´çš„è¯·æ±‚çŽ°åœ¨æ˜¯æ€Žä¹ˆèµ°çš„å‘¢ï¼Ÿè°¢è°¢ã€‚

Aï¼šæ˜¯çš„ï¼Œåˆšåˆšæ–‡ç« ä¸­è¯´äº†ï¼Œæˆ‘ä»¬åŽç«¯ SOA æœåŠ¡è¿˜æ˜¯åŸºäºŽ Dubbo çš„ï¼Œè¿™å—ç›®å‰æˆ‘ä»¬è¿˜æ²¡æœ‰åšæ”¹åŠ¨ï¼Œä¹‹åŽçš„è¯æˆ‘ä»¬çš„åˆæ­¥æž„æƒ³ä¼šé€šè¿‡ Sidecar çš„æ–¹å¼æŠŠè¿™äº› Dubbo æœåŠ¡éƒ½æŽ¥å…¥åˆ° Mesh é‡Œé¢æ¥ã€‚æˆ‘ä»¬ç›®å‰çš„ Envoy ä¹Ÿæ˜¯ä¼šå……å½“ç½‘å…³çš„è§’è‰²ã€‚

---

### 2019-01-25ï¼šå¾—åˆ° App çš„å®¹å™¨åŠ Kubernetes å®žè·µ

> Qï¼šä¸šåŠ¡çŽ¯å¢ƒæœ‰è·¨æœºæˆ¿ä¹ˆï¼Œè¿˜æ˜¯äº‘çŽ¯å¢ƒï¼Œæ˜¯å…±ç”¨ä¸€ä¸ªé›†ç¾¤è¿˜æ˜¯ä¸åŒé›†ç¾¤å‘¢ï¼Ÿ

Aï¼šä¸ªäººå€¾å‘å¤šé›†ç¾¤ï¼Œä¸Šå±‚ Federation Cluster ç®¡ç†ã€‚

> Qï¼šä»£ç ä½¿ç”¨å‘å¸ƒæ˜¯ä»€ä¹ˆçš„å‘¢ æœ‰ä½¿ç”¨ Helm ä¹ˆï¼Ÿ

Aï¼šé€šè¿‡ Kubernetes API Server æ›´æ–° Deployment ä¸­ template çš„ spc é‡Œçš„ container imageã€‚

> Qï¼šå•ä¸ªåº”ç”¨å‘å¸ƒä¸€æ¬¡è€—æ—¶å¤šé•¿æ—¶é—´ï¼Ÿä¸»è¦è€—æ—¶æ˜¯åœ¨å“ªä¸ªé˜¶æ®µå‘¢ï¼Ÿ

Aï¼š1 åˆ†é’Ÿå†…ï¼Œä¸»è¦è€—æ—¶åœ¨ Kubernetes Replication Controller æ»šåŠ¨å‘å¸ƒè¿‡ç¨‹ä¸­çš„ Pod çŠ¶æ€åŒæ­¥ã€‚

> Qï¼šå¼€å‘æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæ˜¯å¼€å‘åˆ›å»ºé•œåƒè¿˜æ˜¯è¿ç»´è‡ªå·±åˆ›å»ºï¼Ÿè°è´Ÿè´£å‘å¸ƒåˆ°çº¿ä¸ŠçŽ¯å¢ƒï¼Ÿ

Aï¼šåˆ›å»ºé•œåƒæœ‰ä¸¤ç§æ–¹å¼ï¼šCI å’Œå¼€å‘äººå‘˜æ‰‹å·¥æ“ä½œï¼Œçº¿ä¸ŠçŽ¯å¢ƒå¼€å‘æäº¤ä¸Šçº¿å•ï¼ŒQA å®¡æ ¸ã€‚

> Qï¼šKubernetes ç›®å‰æ˜¯éƒ½åœ¨é˜¿é‡Œäº‘ä¸Šé¢å—ï¼Ÿæœ‰æ²¡æœ‰è·¨äº‘åŽ»å®žçŽ°å¹³å°çš„æ­å»ºï¼Œå¦‚æžœä½¿ç”¨æ··åˆäº‘å¯¹ä½ ä»¬æœ€å¤§çš„æŒ‘æˆ˜ï¼Ÿ

Aï¼šç›®å‰è¿˜æ˜¯ä¸»è¦ç”¨é˜¿é‡Œäº‘ï¼Œæœªæ¥ä¼šå»ºè®¾æ··åˆäº‘ï¼Œæ··åˆäº‘æ–¹æ¡ˆè¿˜æœªç¡®å®šï¼Œä¸ªäººå€¾å‘å¤šé›†ç¾¤ï¼Œä¸Šå±‚ Federation Cluster ç®¡ç†ï¼Œä¹Ÿä¸æŽ’é™¤è‡ªç ” Controllerï¼Œæ··ä¸ªäººè®¤ä¸ºæ··åˆäº‘æœ€å¤§çš„æŒ‘æˆ˜åœ¨äºŽæ•°æ®çš„åŒæ­¥ï¼Œä¸Šå±‚çš„æœåŠ¡å®¹å™¨ä¸­è¿è¡Œå¹¶ä¸”æœ‰ Kubernetes æ¥è°ƒåº¦å¤§å¤§å‡è½»äº†ç®¡ç†è´Ÿæ‹…ï¼Œæˆ‘ä»¬æ­£åœ¨è®¾è®¡å¤šå±‚æ¬¡çš„è°ƒåº¦ï¼šä¾‹å¦‚æµé‡å±‚è°ƒåº¦ã€æœåŠ¡å±‚è°ƒåº¦ã€æ•°æ®å±‚è°ƒåº¦ã€‚

> Qï¼šChon å’Œ Dozer æ˜¯è‡ªç ”çš„å¹³å°å—ï¼Ÿç½‘ä¸Šæ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„ä»‹ç»ã€‚

Aï¼šæ˜¯è‡ªç ”çš„ï¼Œå¯ä»¥è®¤ä¸º Dozer æ˜¯å®¹å™¨å‘ç‰ˆç³»ç»Ÿï¼ŒChons æ˜¯ç§æœ‰ PaaSã€‚

> Qï¼šOverlay ä¸ºä½•ä¸èƒ½ç”¨åœ¨ç”Ÿäº§çŽ¯å¢ƒï¼Ÿä½ ä»¬çŽ°åœ¨ä¸ç®—ç”Ÿäº§çŽ¯å¢ƒå—ï¼ŸFlannel ä¸å°±æ˜¯ Overlay å—ï¼Ÿ

Aï¼šFlannel æœ‰é«˜æ€§èƒ½çš„ HOSTGWï¼Œåœ¨äº‘ä¸Šçš„è¯ï¼Œè¿˜æœ‰å„ç§å…¬æœ‰äº‘çš„ backendï¼Œå€ŸåŠ©äº‘çš„ VPC ç½‘ç»œ API å®žçŽ°ã€‚

> Qï¼šä¸ºä»€ä¹ˆå¤§é‡çŸ­é“¾æŽ¥éœ€è¦ä¼˜åŒ– DNSï¼Ÿå¤§é‡çŸ­é“¾æŽ¥ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ

Aï¼šGolang é»˜è®¤ç¼–è¯‘ä¼šå…³é—­ Glibc ä¸­çš„ dns æŸ¥è¯¢å®žçŽ°ï¼Œä½¿ç”¨ golang çš„å®žçŽ°ï¼Œå¯¹äºŽ DNS æœåŠ¡æœ‰è¾ƒå¤šæŸ¥è¯¢ï¼Œä¼šæœ‰ dns æŸ¥è¯¢å¤±è´¥æƒ…å†µã€‚å¤§é‡çŸ­è¿žæŽ¥ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šæœ‰é—®é¢˜ï¼Œä¼šå¢žåŠ å°‘é‡å»¶è¿Ÿä»¥åŠæœåŠ¡å™¨ä¸Š TCP TIME\_WAIT çŠ¶æ€è¿žæŽ¥æ•°é‡å¤§ã€‚

> Qï¼šæ—¥å¿—è¿™å—ä½¿ç”¨ emptydir çš„è¯ä¼šä¸ä¼šæœ‰æ—¥å¿—ä¸¢å¼ƒçš„æƒ…å†µï¼Ÿ

Aï¼šæ²¡æœ‰ï¼Œlogtail å’Œ filebeat ä½¿ç”¨çš„æ˜¯ Watch å’Œ tail ç±»ä¼¼çš„æ¨¡å¼ï¼Œæˆ‘ä»¬ç»Ÿè®¡è¿‡ï¼Œå»¶è¿Ÿæœ€å¤§åœ¨ 5 ç§’ã€‚

---

### 2019-01-16ï¼šé¾™è…¾å‡ºè¡ŒåŸºäºŽ Kubernetes çš„ DevOps æµæ°´çº¿å®žæˆ˜

> Qï¼šKubernetes æœ¬èº«æŠ€æœ¯æ¡†æž¶å¸¦æ¥çš„é—®é¢˜åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­æœ‰ç¢°åˆ°æ²¡ï¼Œè¯·ä¸¾å‡ ä¸ªä¾‹å­ã€‚

Aï¼šKubernetes å¦‚æžœå‡ºé—®é¢˜å¸¦æ¥çš„éƒ½æ˜¯é›ªå´©æ•ˆåº”ï¼Œä¾‹å¦‚ç½‘ç»œ Calicoã€å­˜å‚¨ etcd å‡ºçŽ°æ•…éšœæ˜¯ç¾éš¾æ€§çš„ï¼Œæˆ‘ä»¬ä¹Ÿè¸©è¿‡ä¸å°‘è¿™æ–¹é¢çš„å‘ï¼Œæ‰€ä»¥è¦åšåˆ°é«˜å¯ç”¨æ‰èƒ½ç¨³å®šç”Ÿäº§ã€‚

> Qï¼šä¸€ä¸ªå¼€å‘äººå‘˜æƒ³åœ¨å¼€å‘çŽ¯å¢ƒéƒ¨ç½²ä¸€ä¸ªæœåŠ¡ï¼Œä»–å¿…é¡»è¦æ‡‚ Kubernetesï¼ŒåŽ»å†™é‚£äº› yaml å—ï¼Œæœ‰ä»€ä¹ˆæ˜“ç”¨çš„å¯è§†åŒ–å¹³å°ï¼Ÿ

> Qï¼šå…¬å¸çŽ¯å¢ƒè¾ƒå¤æ‚ï¼šåŒ…å« Java é¡¹ç›®ã€PHP é¡¹ç›®ï¼ŒJava é¡¹ç›®ç›®å‰å¤§å¤šæ˜¯ SpringBoot æ¡†æž¶ï¼ŒPHP æ˜¯ ThinkPHP æ¡†æž¶ï¼Œé¡¹ç›®æž¶æž„å¹¶ä¸å¤æ‚ï¼Œæœ‰å°‘è®¸ Java é¡¹ç›®éœ€è¦ç”¨ Redis åˆ° Memcachedã€ç¼“å­˜æœºåˆ¶ã€‚æœ€å¤§é—®é¢˜çš„æ˜¯å¤šï¼Œé¡¹ç›®åº”è¯¥å¦‚ä½•è¾ƒå¥½çš„ä¾æ‰˜ Kubernetes é¡ºåˆ©æž¶æž„ï¼Œå°†é¡¹ç›®å¯æŒç»­é›†æˆï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ Redis è¿™ä¸€ç±»ä¸­é—´ä»¶è¿˜æ”¾åœ¨ VM ä¸Šï¼Œç›®å‰å°šæœªæ‰“ç®—æ¬ç§»åˆ° Kubernetes ä¸Šï¼ŒKubernetes+Docker å¤©ç„¶æ˜¯è·¨å¹³å°çš„ï¼ŒPHP ä¹Ÿå¯ä»¥æ”¯æŒï¼Œå¹¶ä¸”å¯¹å®¹å™¨é›†ç¾¤ï¼ˆæ—¢åº”ç”¨é›†ç¾¤ï¼‰ç®¡ç†éžå¸¸å‡ºè‰²ï¼ŒåŒ…å«éƒ¨åˆ†è‡ªåŠ¨åŒ–è¿ç»´ï¼Œå¹¶ä¸ä¼šå› å¤šç§å¼€å‘è¯­è¨€è€Œå¢žåŠ è´Ÿæ‹…ï¼ŒæŒç»­é›†æˆæ˜¯å¦å¤–ä¸€å—ï¼Œç›®å‰å„å¤§ CI å·¥å…·åŽ‚å•†ä¹Ÿéƒ½æ”¯æŒ Kubernetesï¼Œæ¯”è¾ƒå‹å¥½ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯ GitLab-CIã€‚

> Qï¼šCalico ç½‘ç»œä½ ä»¬å¦‚ä½•è§£å†³è·¨ä¸­å¿ƒçš„ç½‘ç»œé€šä¿¡ï¼ŒBGP åªèƒ½åœ¨åŒä¸€ä¸ªäº¤æ¢æœºæ‰è¡Œã€‚

Aï¼šæˆ‘ä»¬ç›®å‰è¿˜æ²¡è·¨æœºæˆ¿é€šè®¯ï¼Œä¸è¿‡ etcd éœ€è¦é«˜é€Ÿç½‘ç»œæ‰èƒ½æ•°æ®åŒæ­¥ï¼Œè·¨æœºæˆ¿æ‹‰ä¸“çº¿æ¯”è¾ƒåˆé€‚ï¼ŒBGP åè®®è¿˜æ²¡ç”¨åˆ°ï¼Œå°è§„æ¨¡éƒ¨ç½²å¯ä»¥è€ƒè™‘æ·»åŠ é™æ€è·¯ç”±çš„æ–¹å¼æ‰“é€š Kubernetes é›†ç¾¤å†…å¤–çš„ç½‘ç»œã€‚

> Qï¼šåº”ç”¨æœ‰æ˜¯å¦æœ‰çŠ¶è™‘ä½¿ç”¨ï¼Œç”¨çš„ä»€ä¹ˆå­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Ÿ

Aï¼šæˆ‘ä»¬æå€¡æ— çŠ¶æ€éƒ¨ç½²ï¼Œç›®å‰æ‰€æœ‰åº”ç”¨æœåŠ¡éƒ½æ˜¯æ— çŠ¶æ€ï¼Œæœ‰çŠ¶æ€æœåŠ¡å­˜å‚¨å¯ä»¥è€ƒè™‘ NFSã€‚

> Qï¼šç”¨äºŒè¿›åˆ¶å®‰è£…å¯ä»¥ä¸ï¼ŒKubeadm ä¼šæœ‰å‡çº§äº›é—®é¢˜ï¼Œé»˜è®¤çš„ Iptables ä¸å¤ªå¥½å§ã€‚çŽ°åœ¨æ˜¯ IPVSã€‚

Aï¼šäºŒè¿›åˆ¶ä¹Ÿå¯ä»¥ï¼Œæ¯”è¾ƒç¨³å®šï¼ŒKubeadm æ»šåŠ¨å‡çº§æˆ‘ä»¬è¿˜åœ¨è¸©å‘ä¸­ï¼Œå‡çº§ç­–ç•¥ç›®å‰æˆ‘ä»¬æ˜¯å¦å¤–æ­é›†ç¾¤ï¼Œä¸€é”®éƒ¨ç½²æ‰€æœ‰åº”ç”¨ï¼ˆæ¯æ¬¡éƒ¨ç½²éƒ½ä¼šç»Ÿä¸€å­˜å‚¨æœ€æ–°éƒ¨ç½² ymlï¼‰ï¼Œå¯¹å¤–ç½‘å…³å¯é€‰æ‹©æ€§åˆ‡æ¢åº”ç”¨ï¼ŒIptables è¢« Kubernetes æ¡èµ·æ¥åˆæ”¾å¼ƒäº†ï¼Œæœªæ¥çš„è¶‹åŠ¿æ˜¯ IPVSï¼Œç›®å‰æˆ‘ä»¬ä¹Ÿåœ¨æµ‹è¯•çŽ¯å¢ƒä¸­è¯•éªŒã€‚

> Qï¼šæœåŠ¡ç›‘æŽ§å’ŒæœåŠ¡å™¨ç›‘æŽ§è¿™å—çš„å–èˆï¼ŒçŽ°åœ¨ç›‘æŽ§éƒ½æ˜¯ç”¨ Prometheusï¼Ÿ

Aï¼šPrometheus æ˜¯ CNCF æ——ä¸‹ä»…æ¬¡äºŽ Kubernetes çš„é¡¹ç›®ï¼Œå¯¹åº”ç”¨ç¨‹åºæ¯”è¾ƒå‹å¥½ï¼ŒåšæœåŠ¡ç›‘æŽ§éžå¸¸æ£’ï¼Œé…åˆ Grafana å›¾å½¢å±•ç¤ºä½“éªŒéžå¸¸å¥½ï¼Œè·Ÿ Zabbix ç›¸æ¯”å„æœ‰ç‰¹è‰²ã€‚

> Qï¼šè¯·é—®ä½ ä»¬æ˜¯åˆ›ä¸šé—®å›¢é˜Ÿè¿˜æ˜¯å¤§è§„æ¨¡å›¢é˜Ÿï¼Ÿè€ƒè™‘ Kubernetes æœºç¼˜æ˜¯ï¼Ÿå¯¹äºŽ Kubernetes æ¥è¯´ç”Ÿæ€æ‰€å­˜åœ¨çš„ä¸è¶³ï¼Œå¦‚å®‰å…¨é—®é¢˜æ˜¯æ€Žä¹ˆè€ƒè™‘çš„ï¼Ÿ

Aï¼šä¸ç®¡åˆ›ä¸šè¿˜æ˜¯å¤§è§„æ¨¡å›¢é˜Ÿï¼Œé€‚åˆè‡ªå·±ä¸šåŠ¡ï¼ŒæŠ€æœ¯å¯æŒç»­æ¼”è¿›ã€å®Œå–„å¹¶æå‡æ•ˆçŽ‡å°±æ˜¯å¥½çš„æ–¹å‘ï¼Œè€ƒè™‘ Kubernetes æ˜¯å› ä¸ºå®ƒçš„ä¼˜ç§€åŠŸèƒ½ï¼Œè®©æŠ€æœ¯å›¢é˜Ÿå¯ä»¥ç«™åœ¨æ›´é«˜çš„èµ·ç‚¹ï¼Œçœ‹å¾—æ›´è¿œï¼›Kubernetes ç”Ÿæ€å·²ç»éžå¸¸å¼ºå¤§ï¼Œåœ¨å†…ç½‘è¿è¡Œï¼Œç›¸å¯¹è¾ƒä¸ºå®‰å…¨ï¼Œå¦å¤–ä¹Ÿæœ‰å¯ç”¨ RBAC æƒé™è®¿é—®æŽ§åˆ¶ï¼Œé…åˆå…¶ä»–æŒç»­é›†æˆå·¥å…·ï¼Œå®‰å…¨æŽ§åˆ¶éƒ½å¯ä»¥ä¸ªæ€§åŒ–å®šåˆ¶ã€‚

> Qï¼šKubernetes é›†ç¾¤ä½ ä»¬ä¸ºä»€ä¹ˆæ²¡æœ‰éƒ¨å®žä½“æœºåœ¨ç½²ä¸Šï¼Ÿ

Aï¼šè™šæ‹Ÿæœºå’Œå®žä½“æœºéƒ½è¡Œï¼Œæˆ‘ä»¬å®žä½“æœºæ•°é‡æœ‰é™ï¼ŒåŒ…æ‹¬ä¸­é—´ä»¶é‚£äº›ï¼Œåšé«˜å¯ç”¨ä¼šç”¨å ç”¨æ¯”è¾ƒå¤šçš„ Node æœºã€‚

---

### 2019-01-11ï¼šå¦‚ä½•è¯„ä¼° Kubernetes æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆ

> Qï¼šä½ å¥½ï¼Œæˆ‘ä»¬å…¬å¸é‡‡ç”¨ GlusterFS å­˜å‚¨ï¼ŒæŒ‚è½½ä¸‰å—ç›˜ï¼ŒçŽ°åœ¨é‡åˆ°é«˜å¹¶å‘å†™å°æ–‡ä»¶ï¼ˆ4KBï¼‰åžåé‡ä¸Šä¸åŽ»ï¼ˆ5MB/Sï¼‰ï¼Œè¯·é—®æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„ç›‘æŽ§å·¥å…·æˆ–æ–¹æ³•ä¹ˆï¼Ÿè°¢è°¢ï¼

Aï¼šGlusterFS æœ¬èº«å¯¹å°æ–‡ä»¶å°±å¾ˆä¸å‹å¥½ï¼ŒGlusterFS æ˜¯é’ˆå¯¹å¤‡ä»½åœºæ™¯è®¾è®¡çš„ï¼Œä¸å»ºè®®ç”¨åœ¨å°æ–‡ä»¶åœºæ™¯ï¼Œå¦‚æžœå¯ä»¥çš„è¯ï¼Œè¦ä¹ˆç¨‹åºåšä¼˜åŒ–è¿›è¡Œå°æ–‡ä»¶åˆå¹¶ï¼Œè¦ä¹ˆé€‰ç”¨é«˜æ€§èƒ½çš„åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ï¼Œå»ºè®®çœ‹çœ‹ Lustre æˆ–è€… YRCloudFileã€‚

> Qï¼šæˆ‘ä»¬ç”¨çš„æ˜¯ Ceph åˆ†å¸ƒå¼å­˜å‚¨ï¼Œç›®å‰æœ‰ä¸€ä¸ªåœºæ™¯æ˜¯å®¢æˆ·è§†é¢‘å­˜å‚¨ï¼Œè€Œå¯¹äºŽæŒç»­çš„å†™å…¥å°æ–‡ä»¶å­˜åœ¨ä¸¢å¸§çš„çŽ°è±¡ï¼Œç»è¿‡æˆ‘ä»¬ç³»ç»Ÿçº§åˆ«å’Œåº•å±‚æ–‡ä»¶ç³»ç»Ÿè°ƒä¼˜ï¼ŒåŠ ä¸Š Ceph å‚æ•°çš„è®¾ç½®ï¼Œå‹‰å¼ºæ€§èƒ½å¾—æ”¹å–„ï¼Œä½†æ˜¯æ•°æ®é‡ä¸Šæ¥æ€§èƒ½ä¼šå¦‚ä½•ä¹Ÿä¸å¾—è€ŒçŸ¥é“äº†ï¼ˆç»è¿‡å®¢æˆ·è£¸ç›˜æµ‹è¯•ï¼Œå‰é¢ç”¨è½¯ RAID æ–¹å¼æ€§èƒ½è¿˜æ˜¯å¯ä»¥ï¼‰è¯·é—®åœ¨è¿™æ–¹é¢ä½ æœ‰ä»€ä¹ˆå»ºè®®ä¹ˆï¼Ÿè°¢è°¢ï¼æˆ‘ä»¬å®¢æˆ·æ˜¯åœ¨ç‰¹æ®Šçš„åœºæ™¯ä¸‹ï¼Œå±žäºŽç‰¹å®šæœºåž‹ï¼Œè€Œä¸”æ˜¯ 5400 çš„ sata ç›˜ï¼rbd å—å­˜å‚¨ï¼è¿˜æœ‰ä¸€ä¸ªçŽ°è±¡å°±æ˜¯ç£ç›˜åˆ©ç”¨çŽ‡ä¸å‡ï¼Œè¿™ä¹Ÿæ˜¯å½±å“æ€§èƒ½çš„ä¸€ä¸ªäººåŽŸå› ï¼Œå³ä¾¿æˆ‘ä»¬åœ¨è°ƒ pg æ•°ï¼Œä¹Ÿä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚åœ¨é¢å¤–è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œbcache å¯ä»¥ç”¨å†…å­˜åšç¼“å­˜ä¹ˆï¼ŸFlushCache ç›¸æ¯”ï¼Œè¿™ä¸¤ä¸ªå“ªä¸ªä¼šæ›´å¥½ä¸€ç‚¹ï¼Ÿ

Aï¼šæ‚¨ç”¨çš„æ˜¯ CephFS è¿˜æ˜¯ rbdc å› ä¸º Ceph åœ¨æ€§èƒ½ä¸Šç¼ºå¤±åšçš„è¿˜ä¸å¤Ÿï¼Œæœ‰å¾ˆå¤šé˜Ÿåˆ—ï¼Œå¯¼è‡´å»¶è¿Ÿå¾ˆä¸ç¨³å®šï¼Œè¿™ä¸ªæ—¶å€™ï¼Œåªèƒ½å¿äº†ï¼Œä¸è¿‡è¿˜æ˜¯å»ºè®®ç”¨ Bcache åšä¸€å±‚ç¼“å­˜ï¼Œå¯ä»¥æœ‰æ•ˆç¼“è§£æ€§èƒ½é—®é¢˜ã€‚Crush ç®—æ³•è™½ç„¶æ¯”ä¸€è‡´æ€§ hash è¦å¥½å¾ˆå¤šï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰å…ƒæ•°æ®ï¼Œè¿˜æ˜¯å¾ˆéš¾æŽ§åˆ¶ç£ç›˜çƒ­ç‚¹é—®é¢˜ã€‚FlushCache å·²ç»æ²¡æœ‰äººç»´æŠ¤äº†ï¼ŒBcache è¿˜æœ‰å›¢é˜Ÿåœ¨ç»´æŠ¤ï¼Œæ‰€ä»¥å¦‚æžœè‡ªå·±æ²¡æœ‰èƒ½åŠ›ï¼Œå°±é€‰ç”¨ Bcacheã€‚

> Qï¼šä½ å¥½ï¼Œç›®å‰å¼€æºåœ¨ç”¨ Rook éƒ¨ç½² Cephï¼ŒCeph å¯¹äºŽå—è®¾å¤‡å­˜å‚¨æ€§èƒ½å¦‚ä½•ï¼Ÿå¯ä»¥æå‡å—ï¼Ÿæœªæ¥ï¼Ÿ

Aï¼šæˆ‘ä»¬æœ€è¿‘ä¹Ÿåœ¨å…³æ³¨ Rook é¡¹ç›®ï¼ŒRook çš„ç†å¿µæ˜¯å¾ˆå¥½çš„ï¼Œä½†æ˜¯çŽ°åœ¨ Rook å°±æ˜¯ Ceph çš„å°è£…ï¼ŒæŠŠ Ceph è·‘åˆ°å®¹å™¨ä¸­ï¼Œå¤ç”¨ Kubernetes çš„ç›‘æŽ§å¹³å°ã€‚è€Œ Ceph çš„è¿ç»´å¤æ‚åº¦å¾ˆé«˜ï¼Œä»¥ç›®å‰çš„åšæ³•ï¼Œé¡¹ç›®æƒ³è¦åšå¥½ï¼Œéš¾åº¦ä¼šéžå¸¸å¤§ã€‚

> Qï¼šæˆ‘çœ‹æ‚¨æŽ¨èåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ï¼Œæ–‡ä»¶ç³»ç»Ÿèƒ½æ»¡è¶³æ•°æ®åº“åº”ç”¨çš„éœ€æ±‚å—ï¼Ÿå—å­˜å‚¨ä¼šä¸ä¼šå¥½ä¸€äº›ï¼Ÿ

Aï¼šé¦–å…ˆï¼Œæˆ‘æŽ¨èçš„æ˜¯é«˜æ€§èƒ½åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚æ•°æ®åº“ä¸€èˆ¬å¯¹å»¶è¿Ÿéƒ½æ¯”è¾ƒæ•æ„Ÿï¼Œæ™®é€šçš„ä¸‡å…†ç½‘ç»œ +HDD è‚¯å®šä¸è¡Œï¼Œéœ€è¦é‡‡ç”¨ SSDï¼Œä¸€èˆ¬èƒ½å°†å»¶è¿Ÿç¨³å®šåœ¨æ¯«ç§’ä»¥å†…ï¼Œé€šå¸¸èƒ½å¤Ÿæ»¡è¶³è¦æ±‚ã€‚å¦‚æžœå¯¹å»¶è¿Ÿæœ‰ç‰¹åˆ«è¦æ±‚ï¼Œå¯ä»¥é‡‡ç”¨ NVMe+ RoCE çš„æ–¹æ¡ˆï¼Œå³ä½¿åœ¨å¤§åŽ‹åŠ›ä¸‹ï¼Œå»¶è¿Ÿä¹Ÿèƒ½ç¨³å®šåœ¨ 300 å¾®ç§’ä»¥å†…ã€‚

> Qï¼šæ‚¨ç”¨çš„åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ï¼Œä¸åŒç”¨æˆ·é—´å¦‚ä½•éš”ç¦»ï¼Ÿ

Aï¼šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæœ‰ ACL æƒé™æŽ§åˆ¶ï¼Œä¹Ÿå¯ä»¥åŠ  AD/LDAP

> Qï¼šè¯·é—®ä¸ºä»€ä¹ˆè¯´å—å­˜å‚¨ä¸æ”¯æŒ RWXï¼ŸRWX å°±æ˜¯æŒ‡å¤šä¸ªèŠ‚ç‚¹åŒæ—¶æŒ‚è½½åŒä¸€å—å—è®¾å¤‡å¹¶åŒæ—¶è¯»å†™å—ï¼Ÿå¾ˆå¤š FC å­˜å‚¨éƒ½å¯ä»¥åšåˆ°ã€‚

Aï¼šä¼ ç»Ÿçš„ SAN è¦æ”¯æŒ RWXï¼Œéœ€è¦ ALUA æœºåˆ¶ï¼Œè€Œä¸”è¿™æ˜¯å—çº§åˆ«çš„å¤šè¯»å†™ï¼Œå¦‚æžœè¦å†åŠ ä¸Šæ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¯æ²¡åŠžæ³•åšåˆ°çš„ï¼Œè¿™éœ€è¦åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæ¥åšæ–‡ä»¶å…ƒæ•°æ®ä¿¡æ¯åŒæ­¥ã€‚

> Qï¼šä¼ ç»Ÿ SAN æ”¯æŒå¯¹åŒä¸€æ•°æ®å—çš„å¹¶è¡Œè¯»å†™ï¼Œå¾ˆå¤š AA é˜µåˆ—éƒ½ä¸æ˜¯ç”¨ ALUA çš„ï¼Œè€Œæ˜¯å¤šæ¡è·¯å¾„åŒæ—¶æœ‰ IOï¼Œå½“ç„¶è¦ç”¨åˆ°å¤šè·¯å¾„è½¯ä»¶ã€‚ç›¸åç”¨ ALUA çš„ä¸æ˜¯ AA é˜µåˆ—ã€‚

Aï¼šAA é˜µåˆ—è§£å†³çš„æ˜¯é«˜å¯ç”¨é—®é¢˜ï¼Œå¯¹åŒä¸€ä¸ª lun çš„å¹¶å‘è¯»å†™ï¼Œéœ€è¦ trunk çº§çš„é”åŽ»ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œæ€§èƒ½ä¸å¥½ã€‚

> Qï¼šçš„å¾ˆå¤šä¼ ç»Ÿå•†ä¸šå­˜å‚¨ï¼ŒåŒ…æ‹¬å—å­˜å‚¨ï¼Œä¹Ÿéƒ½åšäº† CSI ç›¸å…³çš„æ’ä»¶ï¼Œæ˜¯ä¸æ˜¯å¦‚æžœåœ¨å®¹å™¨é‡Œè·‘ä¸€äº›æ€§èƒ½è¦æ±‚é«˜çš„ä¸šåŠ¡ï¼Œè¿™äº›å•†ä¸šçš„å—å­˜å‚¨æ¯”æ–‡ä»¶å­˜å‚¨åˆé€‚ï¼Ÿ

Aï¼šç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œæˆ‘å¼ºçƒˆå»ºè®®é€‰ç”¨å•†ä¸šå­˜å‚¨ã€‚è‡³äºŽå—å­˜å‚¨è¿˜æ˜¯æ–‡ä»¶å­˜å‚¨ï¼Œè¦çœ‹æ‚¨çš„ä¸šåŠ¡åœºæ™¯ã€‚é¦–é€‰æ˜¯å•†ä¸šçš„æ–‡ä»¶å­˜å‚¨ã€‚

> Qï¼šè¯·é—®çŽ°åœ¨çš„ Kubernetes çŽ¯å¢ƒä¸‹ï¼Œæµ·é‡å°æ–‡ä»¶ RWX åœºæ™¯ï¼Œæœ‰ä»€ä¹ˆç›¸å¯¹æ¯”è¾ƒå¥½çš„å¼€æºåˆ†å¸ƒå¼å­˜å‚¨è§£å†³æ–¹æ¡ˆä¹ˆï¼Ÿ

Aï¼šå¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨é¡¹ç›®ä¸­ï¼Œæ²¡æœ‰èƒ½è§£å†³æµ·é‡å°æ–‡ä»¶çš„ï¼Œæˆ‘åœ¨æ–‡ä¸­å·²ç»å°†ä¸»æµå¼€æºæ–‡ä»¶ç³»ç»Ÿéƒ½åˆ†æžäº†ä¸€éï¼Œåœ¨è®¾è®¡ä¹‹åˆï¼Œéƒ½æ˜¯é’ˆå¯¹å¤‡ä»½åœºæ™¯æˆ–è€… HPC é¢†åŸŸã€‚

> Qï¼šè¯·é—®ï¼Œä¸ºä»€ä¹ˆè¯´ Ceph æ€§èƒ½ä¸å¥½ï¼Œæœ‰ä¾æ®å—ï¼Ÿ

Aï¼šç›´æŽ¥ç”¨æ•°æ®è¯´è¯ï¼Œæˆ‘ä»¬ç”¨ NVMe + Ceph +Bluestore æµ‹è¯•å‡ºæ¥çš„ï¼Œå»¶è¿Ÿåœ¨æ¯«ç§’çº§ä»¥ä¸Šï¼Œè€Œä¸”å¾ˆä¸ç¨³å®šï¼Œæˆ‘ä»¬ç”¨ YRCloudFile + NVMe + RoCEï¼Œå»¶è¿Ÿèƒ½ 50 å¾®ç§’å·¦å³ï¼Œå·®äº†å‡ åå€ã€‚

> Qï¼šLustre æ²¡æŽ¥è§¦è¿‡ï¼Œæ€§èƒ½å¥½å—ï¼Œå’Œ Ceph æœ‰å¯¹æ¯”è¿‡å—ï¼Ÿ

Aï¼šç½‘ä¸Šæœ‰å¾ˆå¤š Lustre çš„æ€§èƒ½æŒ‡æ ‡ï¼Œåœ¨åŒæ ·çš„é…ç½®ä¸‹ï¼Œæ€§èƒ½ç»å¯¹è¦æ¯” Ceph å¥½ï¼Œä¸è¿‡ Lustre å…¨éƒ¨éƒ½æ˜¯å†…æ ¸æ€çš„ï¼Œå®¹å™¨åœºæ™¯æ²¡åŠžæ³•ç”¨ï¼Œè€Œä¸”æŒ‰ç…§éƒ¨ç½²ä»¥åŠè¿ç»´éš¾åº¦éžå¸¸å¤§ã€‚Lustre åœ¨è¶…ç®—ç”¨çš„æ¯”è¾ƒå¹¿æ³›ã€‚

> Qï¼šLustre åªèƒ½é æœ¬åœ°ç£ç›˜é˜µåˆ—æ¥ä¿è¯æ•°æ®å†—ä½™ä¹ˆï¼Ÿ

Aï¼šLustre æœ¬èº«ä¸æä¾›å†—ä½™æœºåˆ¶ï¼Œéƒ½æ˜¯é æœ¬åœ°é˜µåˆ—çš„ï¼Œä¸è¿‡ EC å¥½åƒå·²ç»åœ¨å¼€å‘è®¡åˆ’ä¸­äº†ã€‚

> Qï¼šï¼ˆå¯¹äºŽå°å…¬å¸ï¼‰å¦‚æžœä¸é€‰ç”¨å•†ä¸šå­˜å‚¨ï¼Œé‚£ä¹ˆæŽ¨èå“ªæ¬¾å¼€æºå®žçŽ°ä½œä¸ºç”Ÿäº§å­˜å‚¨ï¼ˆå¯é ï¼Œé«˜æ€§èƒ½ï¼‰ã€‚æˆ‘ä»¬ä¹‹å‰è¯•äº† NFS å‘çŽ°é€Ÿåº¦ä¸ç¨³å®šï¼Ÿ

Aï¼šå›½å†…è¿˜æ˜¯æœ‰å¾ˆå¤šåˆ›ä¸šå…¬å¸ï¼Œä¹Ÿä¸è´µçš„ã€‚å­˜å‚¨ä¸åƒå…¶ä»–é¡¹ç›®ï¼Œå­˜å‚¨ç»ä¸èµ·æŠ˜è…¾ï¼Œä¸€å®šè¦ç”¨ç¨³å®šå¯é çš„ï¼ŒCeph/GlusterFS åšäº†è¿™ä¹ˆä¹…ï¼Œå¤§å®¶åœ¨é‡‡è´­çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä¼šä¾æ‰˜äºŽæŸå®¶å•†ä¸šå…¬å¸æ¥åšï¼Œè‡ªå·±ç”Ÿäº§çŽ¯å¢ƒç”¨å¼€æºé¡¹ç›®ï¼Œé£Žé™©å¤ªå¤§äº†ã€‚

> Qï¼šGPFS ç”¨æ¥åš Kubernetes çš„ PVï¼Œæ€§èƒ½æ€Žä¹ˆæ ·ï¼Ÿ

Aï¼šç”¨ GPFS çš„è¯ï¼Œæ€§èƒ½è¿˜æ˜¯æœ‰ä¸€å®šä¿éšœçš„ï¼Œä¸è¿‡ GPFS è·Ÿ Lustre ä¸€æ ·ï¼Œéƒ½æ˜¯å¸¦ç€é˜µåˆ—ä¸€èµ·å–çš„ï¼Œå¾ˆè´µã€‚

---

### 2019-01-04ï¼šetcd é›†ç¾¤è¿ç»´å®žè·µ

> Qï¼šè¯·é—® etcd ç›‘æŽ§å’Œå‘Šè­¦å¦‚ä½•åšçš„ï¼Ÿå‘Šè­¦é¡¹éƒ½æœ‰å“ªäº›ï¼Ÿ

Aï¼šå‘Šè­¦è¦çœ‹ç”¨çš„ä»€ä¹ˆç›‘æŽ§å§ï¼Œå’Œ Kubernetes é…å¥—æ¯”è¾ƒå¸¸è§çš„æ˜¯æ™®ç½—ç±³ä¿®æ€å’Œ Grafana äº†ã€‚å‘Šè­¦é¡¹æˆ‘æ²¡æœ‰å…·ä½“é…è¿‡ï¼Œå¯ä»¥å…³æ³¨çš„ç‚¹æ˜¯ï¼šendpoint status -w table é‡Œå¯ä»¥çœ‹åˆ°æ•°æ®é‡ï¼Œendpoints health çœ‹åˆ°å¥åº·çŠ¶æ€ï¼Œè¿˜æœ‰å†…å­˜ä½¿ç”¨è¿™äº›ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæ™®ç½—ç±³ä¿®æ€çš„ exporter æ˜¯æ€Žä¹ˆåšçš„ã€‚

> Qï¼šä½¿ç”¨ Kubeadm éƒ¨ç½²é«˜å¯ç”¨é›†ç¾¤æ˜¯ä¸æ˜¯ç›¸å½“äºŽå…ˆéƒ¨ç½²ä¸‰ä¸ªç‹¬ç«‹çš„å•ç‚¹ Masterï¼Œæœ€åŽé  etcd æ·»åŠ èŠ‚ç‚¹æ“ä½œæŠŠæ•°æ®æ‰“é€šï¼Ÿ

Aï¼šä¸æ˜¯ï¼ŒKubeadm éƒ¨ç½²ä¼šåœ¨æœ€å¼€å§‹å°±å…ˆå»ºä¸€ä¸ª etcd é›†ç¾¤ï¼Œapiserver å¯åŠ¨ä¹‹å‰å°±éœ€è¦å‡†å¤‡å¥½ etcdï¼Œå¦åˆ™ apiserver èµ·ä¸äº†ï¼Œé›†ç¾¤ä¹‹é—´å°±æ²¡æ³•é€šä¿¡ã€‚å¯ä»¥å°è¯•æ‰‹åŠ¨æ­ä¸€ä¸‹é›†ç¾¤ï¼Œä¸ç”¨ Kubeadmï¼Œä¸€ä¸ªä¸ªæŠŠç»„ä»¶å¼€èµ·æ¥ï¼Œä¹‹åŽå¯¹ Kubernetes çš„ç»„ä»¶å…³ç³»ä¼šç†è§£æ›´å¥½çš„ã€‚

> Qï¼šetcd è·¨æœºæˆ¿é«˜å¯ç”¨å¦‚ä½•ä¿è¯å‘¢ï¼Ÿç®¡ç† etcd æœ‰å¥½çš„ UI å·¥å…·æŽ¨èä¹ˆï¼Ÿ

Aï¼šetcd å¯¹æ—¶é—´å’Œç½‘ç»œè¦æ±‚å¾ˆé«˜ï¼Œæ‰€ä»¥è·¨æœºæˆ¿çš„ç½‘ç»œä¸å¥½çš„è¯æ€§èƒ½å¾ˆå·®ï¼Œå…‰åœ¨é‚£è¾¹é€‰è¯·è¾“å…¥é“¾æŽ¥æè¿°ä¸¾åŽ»äº†ã€‚æˆ‘åˆ†äº«å¿˜äº†æä¸€ä¸ª etcd çš„ mirrorï¼Œå¯ä»¥åŽ»å‚è€ƒä¸‹åšæ³•ã€‚è·¨æœºæˆ¿çš„è¯ï¼Œæˆ‘è§‰å¾—é«˜é€Ÿç½‘ç»œæ˜¯ä¸ªå‰æå§ï¼Œä¸è¿‡è¿˜æ²¡åšè¿‡ã€‚UI å·¥å…·æ²¡æ‰¾è¿‡ï¼Œéƒ½æ˜¯å‘½ä»¤è¡Œæ“ä½œæ¥ç€ã€‚

> Qï¼šKubeadm å¯åŠ¨çš„é›†ç¾¤å†… etcd èŠ‚ ç‚¹ï¼Œkubectl æ“ä½œ etcd çš„å¤‡ä»½æ¢å¤æœ‰å°è¯•è¿‡å—ï¼Ÿ

Aï¼šæ²¡æœ‰ç”¨ kubectl åŽ»å¤„ç†è¿‡ etcd çš„å¤‡ä»½æ¢å¤ã€‚etcd çš„æ¢å¤ä¾èµ–ç”¨ SnapDb ç”Ÿæˆæ•°æ®ç›®å½•ï¼ŒæŠŠ etcd è¿›ç¨‹ä¸¢è¿›å®¹å™¨é‡Œï¼Œç±»ä¼¼çš„æ“ä½œé¿å…ä¸äº†ï¼Œè¿˜æœ‰å¯åŠ¨çš„çŠ¶æ€éœ€è¦ä¿®æ”¹ã€‚kubeadm å¯åŠ¨çš„ etcd å¯ä»¥é€šè¿‡ kubectl æŸ¥è¯¢å’Œ execï¼Œä½†æ˜¯æ•°æ®æ“ä½œåº”è¯¥ä¸å¯ä»¥ï¼Œæ¯”å¦‚æ¢å¤ etcd ing æ—¶ï¼Œæ— æ³•è¿žæŽ¥ etcdï¼Œkubectl è¿˜æ€Žä¹ˆå·¥ä½œï¼Ÿ

> Qï¼škubeadm-ha å¯åŠ¨ 3 ä¸ª Masterï¼Œæœ‰ 3 ä¸ª etcd èŠ‚ç‚¹ï¼Œæ€Žä¹ˆè·Ÿé›†ç¾¤å¤–çš„ 3 ä¸ª etcd åšé›†ç¾¤ï¼Œåšæˆ 3 Master 6 etcdï¼Ÿ

Aï¼šå¯ä»¥å‚è€ƒæ–‡æ¡£é‡Œçš„æ‰©å®¹éƒ¨åˆ†ï¼Œåªè¦ä¿è¯ etcd çš„å‚æ•°æ­£ç¡®ï¼Œå³ä½¿ä¸€ä¸ªé›†ç¾¤ä¸€éƒ¨åˆ†å®¹å™¨åŒ–ï¼Œä¸€éƒ¨åˆ†å®¿ä¸»æœºï¼Œéƒ½æ˜¯å¯ä»¥çš„ï¼ˆå½“ç„¶ä¸å»ºè®®è¿™ä¹ˆåšï¼‰ã€‚å¯ä»¥å…ˆç”¨ kubeadm æ­ä¸€ä¸ªé›†ç¾¤ï¼Œç„¶åŽç”¨æ‰©å®¹çš„æ–¹å¼æŠŠå…¶ä»–ä¸‰ä¸ªèŠ‚ç‚¹åŠ è¿›æ¥ï¼Œæˆ–è€…åœ¨ kubeadm æ“ä½œä¹‹å‰ï¼Œå…ˆæ­ä¸€ä¸ª etcd é›†ç¾¤ã€‚ç„¶åŽ kubeadm è°ƒç”¨å®ƒå°±å¯ä»¥ã€‚

> Qï¼šæœ‰æ²¡æœ‰è¯•è¿‡ Kubeadm çš„æ»šåŠ¨å‡çº§ï¼Œetcd ç‰ˆæœ¬å˜æ›´ï¼Œå„ Master æœºåˆ†åˆ«é‡å¯ï¼Œæ•°æ®åŒæ­¥æ˜¯å¦æœ‰å¼‚å¸¸ç­‰ç­‰ï¼Ÿ

Aï¼šåšè¿‡ã€‚Kubeadm çš„æ»šåŠ¨å‡çº§å…¬å¸å†…éƒ¨æœ‰ä»Ž 1.7 ä¸€æ­¥æ­¥å‡çº§åˆ° 1.11ã€1.12 çš„æ–‡æ¡£ï¼Œæˆ–å¤šæˆ–å°‘æœ‰ä¸€ç‚¹å°å‘ï¼Œä¸è¿‡ä»Šå¤©ä¸»é¢˜æ˜¯ etcd æ‰€ä»¥æ²¡æè¿™éƒ¨åˆ†ã€‚å„ä¸ª Master åˆ†åˆ«é‡å¯åŽæ•°æ®çš„ä¸€è‡´æˆ‘ä»¬æµ‹è¯•æ—¶æ²¡é—®é¢˜ï¼Œè¿˜æœ‰æ¯”è¾ƒæžç«¯çš„æ˜¯ç›´æŽ¥æŠŠä¸‰ Master åœæœºä¸€å¤©ï¼Œå†å¯åŠ¨åŽä¹Ÿèƒ½æ¢å¤ã€‚

---

### 2018-12-21ï¼šèšç¾Žä¼˜å“äº‘å¹³å°å®žè·µ

> Qï¼šä¸ºå•¥é‡‡ç”¨ Consul ä½œä¸ºå®¹å™¨çš„æœåŠ¡å‘çŽ°ä¸Žé…ç½®ç®¡ç†ï¼Œè€Œä¸é‡‡ç”¨é»˜è®¤çš„ etcdï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯èšç¾Žå¯¹äºŽ Web ç±»æœåŠ¡å·²ç»å­˜åœ¨äº†åŸºäºŽ Consul çš„å‘çŽ°æœºåˆ¶ï¼Œæ‰€ä»¥äº‘å¹³å°åœ¨æŽ¨å¹¿æ—¶å°±åˆ©ç”¨äº†çŽ°æœ‰çš„æž¶æž„ã€‚

> Qï¼šè¯·é—® IPVLAN ç½‘ç»œä¼šä¸ä¼šå¯¼è‡´å®¹å™¨å†…æ— æ³•è®¿é—®æœ¬åœ°ç‰©ç†ç½‘å¡ï¼Ÿæˆ–è€…è¯´å®¿ä¸»æœºæ— æ³•è®¿é—®æœ¬åœ°çš„å®¹å™¨ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜å¾ˆå¥½ï¼Œæœ€åˆæˆ‘ä»¬é‡‡ç”¨ IPVLAN æ—¶ä¹Ÿé‡åˆ°äº† kubelet åœ¨é€šè¿‡ Liveness æŽ¢é’ˆæ—¶ä¸Žå®¹å™¨ç½‘ç»œä¸é€šã€‚åŽæ¥æˆ‘ä»¬é€šè¿‡å°†ä¸»æœºç½‘ç»œå’Œå®¹å™¨ç½‘ç»œåˆ†å¼€ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

> Qï¼šæœåŠ¡é—´çš„ Socket é€šè®¯åŽŸç†æ˜¯é€šè¿‡æŒ‚è½½ Volume æ–¹å¼è¿›è¡Œè®¿é—®ï¼Œè¿™ä¸ª/var/run/service å†…å®¹èƒ½é€éœ²ä¸€ä¸‹å—ï¼Ÿæ˜¯èšç¾Žä¼˜å“çš„ RPC æ¡†æž¶é€šä¿¡åè®®æ–‡ä»¶å—ï¼Ÿ

Aï¼š/var/run/service å…¶å®žå°±æ˜¯ä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œé‡Œé¢å°±ä¿å­˜äº† Pod çš„å„ä¸ª Container ä¸­è¿è¡Œè¿›ç¨‹çš„ Sockets æ–‡ä»¶ã€‚è‡³äºŽæœåŠ¡é—´ï¼ˆä¸åŒ Pod é—´ï¼‰é€šè®¯æ˜¯èšç¾Žè¿™è¾¹è‡ªå·±å®žçŽ°çš„ä¸€ä¸ªç§æœ‰çš„ RPC æ¡†æž¶é€šä¿¡åè®®ã€‚

> Qï¼šé—®ä¸€ä¸‹ï¼Œä½ é‚£è¾¹çš„ä¸åŒä¸šåŠ¡åˆ†é…èµ„æºçš„æ—¶å€™æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½æ‰“ä¸Š labels å—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œæˆ‘ä»¬ä¸»è¦è¿˜æ˜¯é€šè¿‡ label çš„çš„å½¢å¼æ¥åšå®¹å™¨çš„è°ƒåº¦ã€‚å¦å¤–æ¯ä¸ª deployment éƒ½ä¼šé€šè¿‡ resourcelimit æ¥åšèµ„æºé™åˆ¶ã€‚ç›®å‰å¯¹äºŽé«˜èµ„æºåˆ©ç”¨çš„å®¹å™¨è¿˜æ˜¯é€šè¿‡å¹³å° kill å®¹å™¨çš„æ–¹å¼ï¼Œé‡æ–°æ‹‰èµ·æ–°çš„å®¹å™¨ã€‚

> Qï¼šPrometheus æ˜¯ä»€ä¹ˆè¿è¡Œæ–¹å¼ï¼Œæ‹‰å–æ•°æ®ä¼šæœ‰ä»€ä¹ˆé—®é¢˜æ³¨æ„å—ï¼Œå•èŠ‚ç‚¹å¤Ÿç”¨å—ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬ Prometheus æ˜¯éƒ¨ç½²åœ¨ Kubernetes å½“ä¸­ï¼Œæ ¹æ®ä¸é€šè¿‡çš„æœåŠ¡å‘çŽ°æ¨¡å¼åšäº†é€»è¾‘åˆ‡åˆ†ã€‚ä¸Šå±‚é€šè¿‡ Prometheus Federation æ¥ç»Ÿä¸€æ±‡èšæ•°æ®ã€‚

> Qï¼šé‚£ä¸åŒçš„ä¸šåŠ¡ä¹‹é—´è®¿é—®æœ‰çŠ¶æ€åº”ç”¨æ˜¯é€šè¿‡å®šä¹‰ ExternalName å—ï¼Ÿæ¯”å¦‚è®¿é—® MySQL æˆ– Redis ç­‰ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬å¤§éƒ¨åˆ†è·‘åœ¨äº‘å¹³å°ä¸Šçš„å®¹å™¨éƒ½æ˜¯æ— çŠ¶æ€çš„æœåŠ¡ï¼Œå¯¹äºŽæœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œè¿˜æ˜¯å»ºè®®é€šè¿‡ä¼ ç»Ÿçš„æ–¹å¼è¿è¡Œã€‚

> Qï¼šè¯·é—®ä½ é‚£è¾¹ Pod æ˜¯ç›´æŽ¥è·‘åœ¨è™šæ‹Ÿæœºä¸Šå—ï¼Œè¿˜æ˜¯åšäº†ä¸€å±‚è™šæ‹ŸåŒ–åˆ†é…ä½¿ç”¨è™šæ‹Ÿæœºå‘¢ï¼Ÿ

Aï¼šPod çš„è¿è¡Œä¸»è¦åˆ†ä¸¤å—ç±»åž‹ã€‚å¯¹äºŽ DaemonSet æ–¹å¼è¿è¡Œçš„å®¹å™¨ï¼Œæˆ‘ä»¬å¤§éƒ½é€šè¿‡è™šæ‹Ÿæœºæˆ–è€…äº‘ä¸»æœºæ¥æ”¯æ’‘ï¼Œåˆ†äº«é‡Œé¢ä¹Ÿæåˆ°æˆ‘ä»¬é€šè¿‡ DaemonSet æ–¹å¼æ¥è§£å†³æˆ‘ä»¬å¤§ä¿ƒæœŸé—´å¿«é€Ÿæ‰©å®¹çš„éœ€æ±‚

> Qï¼šPod è·¨èŠ‚ç‚¹çš„è®¿é—®æ˜¯æ€Žä¹ˆåšåˆ°çš„ï¼Œå¦‚æžœä¸¤ä¸ªèŠ‚ç‚¹ä¸åœ¨åŒä¸€ä¸ª swtich ä¸‹ï¼Œéœ€è¦è·¨è·¯ç”±å™¨çš„æƒ…å†µä¸‹ï¼Ÿ

Aï¼šIPVLAN çš„ç½‘ç»œæ˜¯æå‰è§„åˆ’å¥½çš„ï¼Œå¹¶ä¿å­˜åœ¨ç½‘ç»œé…ç½®ç®¡ç†å¹³å°ä¸Šã€‚å¯¹äºŽ IPVLAN ä¸åŒç½‘æ®µçš„ä¹‹é—´çš„é€šä¿¡ï¼Œè¿˜æ˜¯åœ¨ä¸‰å±‚äº¤æ¢æœºä¸Šåšè·¯ç”±æ¥å®žçŽ°çš„ã€‚

---

### 2018-12-07ï¼šæ™ºèžé›†å›¢åŸºäºŽ OpenShift çš„å®¹å™¨åŒ– PaaS å¹³å°å®žè·µ

> Qï¼šè¯·é—®é€šè¿‡ OpenShift æ€Žä¹ˆåšé«˜å¯ç”¨ï¼Ÿ

Aï¼šOpenShift çš„é«˜å¯ç”¨æ˜¯è·Ÿ Kubernetes çš„é«˜å¯ç”¨ä¸€è‡´çš„ï¼Œå°±æ˜¯å»¶ç”¨äº† Kubernetes çš„ Service IP æ¥åšæœåŠ¡å‘çŽ°å’Œè´Ÿè½½å‡è¡¡ï¼›å¦å¤–ï¼Œå‰é¢è¿˜æœ‰ DNS æœåŠ¡ï¼Œï¼ˆä¾‹å¦‚ï¼šHostname: service.abc-platform.svcï¼ŒåŽç«¯å°±æ˜¯æŒ‡å‘çš„ Cluster IPï¼‰ã€‚

> Qï¼šimage çš„ç‰ˆæœ¬ç®¡ç†æ€Žä¹ˆåšï¼Ÿé…ç½®çš„ç‰ˆæœ¬ç®¡ç†æ€Žä¹ˆåšï¼Ÿ

Aï¼šOpenShift æœ¬èº«ä¼šåˆ›å»ºä¸€ä¸ªå†…éƒ¨çš„ Registryï¼ŒS2I ä¼šæ ¹æ® Build æ¥æ›´æ–° imageï¼Œimage çš„ç‰ˆæœ¬æ˜¯é€šè¿‡ sha256 çš„å€¼å¯¹åº” Build çš„ç‰ˆæœ¬å·ï¼ˆä¾‹å¦‚ï¼šBuild ç‰ˆæœ¬\#24 å¯¹åº” registry.intra.XXXXX.com/abc/abc-platform\@sha256:b41c8XXXXXï¼‰ã€‚

> Qï¼šOpenShift çš„ç½‘ç»œæ–¹æ¡ˆæ€§èƒ½æ–¹é¢æœ‰å¤šå°‘æŸè€—ï¼Ÿä¸Ž Kubernetes çš„å…¶ä»–ç½‘ç»œæ–¹æ¡ˆå¦‚ Calico ç›¸æ¯”å¦‚ä½•ï¼Ÿ

Aï¼šOpenShift çš„ç½‘ç»œæ–¹æ¡ˆæ˜¯é€‰æ‹©çš„ OVSï¼Œæ€§èƒ½ä¸Šè‚¯å®šæ˜¯ä¸å¦‚ Calicoï¼Œä½†å¯¹äºŽæˆ‘ä»¬çš„æœåŠ¡è¶³å¤Ÿäº†ã€‚ç›®å‰è·‘äº†æœ‰ 1000+ ä¸ªå¸¸é©» Podï¼Œæ²¡æœ‰å‡ºçŽ°ç½‘ç»œç“¶é¢ˆã€‚

> Qï¼šå¦‚æžœè¦åšå¤šæœºæˆ¿éƒ¨ç½²ï¼ŒOpenShift èƒ½æžå—ï¼Ÿ

Aï¼šå¤šæœºæˆ¿ï¼Œåªè¦ç½‘ç»œèƒ½é€šå¹¶æ¯”è¾ƒç¨³å®šï¼Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚æˆ‘ä»¬çš„éƒ¨ç½²æ–¹æ¡ˆå°±æ˜¯åœ¨é˜¿é‡Œäº‘ä¸Šçš„å¤šä¸ªå¯ç”¨åŒºéƒ¨ç½²çš„ã€‚è€Œä¸”ï¼Œå®žé™…éƒ¨ç½²ä¸­ä¹Ÿæ˜¯é¼“åŠ±å¤šæœºæˆ¿éƒ¨ç½²çš„ï¼ŒæœåŠ¡å®¹ç¾è¦æ±‚ä¸€ä¸ªæœåŠ¡è¦åˆ†å¸ƒåœ¨å¤šä¸ªå¯ç”¨åŒºï¼ˆæˆ–è€…æœºæˆ¿ï¼‰ã€‚

> Qï¼šä½ ä»¬å¹³å°æ€§èƒ½æ€Žä¹ˆæµ‹è¯•çš„ï¼Œå¦‚ä½•é›†æˆï¼Ÿ

Aï¼šå¹³å°æ€§èƒ½æµ‹è¯•åˆ†ä¸¤éƒ¨åˆ†ã€‚ä¸€ä¸ªæ˜¯åœ¨é›†ç¾¤å†…éƒ¨ä¸ç»è¿‡ Nginx ç›´æŽ¥åŽ‹æµ‹ SVCï¼Œå¦å¤–ä¸€ä¸ªæ˜¯åœ¨é›†ç¾¤å¤–éƒ¨åŽ‹æµ‹å†…ç½‘åŸŸåæˆ–è€…å…¬ç½‘åŸŸåã€‚

> Qï¼šæˆ‘ä»¬ä¹‹å‰ç”¨è‡ªå·±çš„é•œåƒä»“åº“ï¼Œä¼šæŠ¥ tls è®¤è¯é”™è¯¯ï¼Œä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰é‡åˆ°è¿‡ï¼Ÿ

Aï¼šæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„é•œåƒä»“åº“æ˜¯ç”¨ Harbor æ¥å»ºçš„ï¼Œåªæ˜¯å­˜å‚¨äº†å†…éƒ¨æœåŠ¡çš„åŸºç¡€é•œåƒã€‚OpenShift é›†ç¾¤å†…çš„é•œåƒä»“åº“æœ‰è‡ªå·±çš„è®¤è¯ï¼Œæ˜¯é€šè¿‡ Secrets ç®¡ç†å¯¹åº”æƒé™çš„ tokenï¼ˆç”¨æˆ·çº§åˆ«çš„æƒé™æ˜¯é€šè¿‡ LDAP ç»Ÿä¸€è®¤è¯çš„ï¼‰ã€‚S2I åˆ›å»ºæœåŠ¡é•œåƒçš„æ—¶å€™å°±æ˜¯é€šè¿‡è¿™ä¸ªæ¥èŽ·å–æƒé™çš„ã€‚è¿˜æ˜¯æ¯”è¾ƒç¨³å®šçš„ï¼Œæ²¡æœ‰å‡ºçŽ°è¿‡ tls çš„é—®é¢˜ã€‚

> Qï¼šç”Ÿäº§çŽ¯å¢ƒçš„èŠ‚ç‚¹ç£ç›˜æ˜¯æ€Žä¹ˆåˆ†åŒºåˆ†é…çš„ï¼Ÿ

Aï¼šç”Ÿäº§çŽ¯å¢ƒçš„èŠ‚ç‚¹ç£ç›˜åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿç›˜ï¼ˆ40Gï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯æ•°æ®ç›˜ï¼ˆ100Gï¼‰ï¼›Docker çš„æ‰€æœ‰é•œåƒã€å®žä¾‹ç­‰å­˜å‚¨éƒ½æ˜¯æ”¾åœ¨æ•°æ®ç›˜ï¼ŒæœåŠ¡çš„æ—¥å¿—æ˜¯æŒ‚è½½çš„ PVï¼ŒPV æ˜¯ä½¿ç”¨çš„é˜¿é‡Œäº‘çš„ NAS å­˜å‚¨ã€‚

> Qï¼šæˆ‘çœ‹ä½ ä»¬åœ¨é›†ç¾¤è®¿é—®å‰åŠ äº†ä¸ª API Gatewayï¼Œç”¨äº† OpenRestyï¼Œè¿™ä¸ªèƒ½è¯¦ç»†ä»‹ç»ä¸‹ä¸ï¼Ÿ

Aï¼šå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªè‡ªå»ºçš„ Ingressï¼Œåº•å±‚æ˜¯ Nginx+Lua å®žçŽ°çš„ï¼›æˆ‘ä»¬å·²ç»åœ¨é€æ¸ä½¿ç”¨ Kong æ¥ä»£æ›¿ OpenResty äº†ã€‚Kong åº•å±‚æ˜¯ Nginx+Lua+PostgreSQLï¼Œç•Œé¢ç®¡ç†æ˜¯ä½¿ç”¨çš„ Kongaã€‚é€‰æ‹© Kong å’Œ Konga çš„ç†ç”±æ˜¯ï¼š1ã€Kong çš„ç®¡ç†å’Œæ’ä»¶æ¯”è¾ƒæ–¹ä¾¿ï¼Œè¿˜æ”¯æŒè‡ªå®šä¹‰æ’ä»¶ï¼›2ã€Konga çš„ç•Œé¢æ›´å‹å¥½ï¼Œç®¡ç†ã€æ›´æ–°éƒ½æ¯”è¾ƒæ–¹é¢ã€‚

> Qï¼šçœ‹åˆ°ä½ ä»¬æ˜¯ 3Master é«˜å¯ç”¨ï¼Œè¯·é—® Kubernetes--Master æŒ‚äº†ä¸€å°ï¼ŒOpenShift å¦‚ä½•æ¢å¤ï¼Œetcd æ˜¯å¦æœ‰åšå¤‡ä»½ï¼Ÿ

Aï¼šæˆ‘ä»¬åšè¿‡æ¼”ç»ƒï¼ŒMaster æŒ‚ä¸€å°æˆ–è€…ä¸¤å°ï¼Œç”šè‡³ä¸‰å°å…¨æŒ‚ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»è¿è¡Œçš„æœåŠ¡ã€‚åªè¦ etcd æ²¡æœ‰é—®é¢˜ï¼Œé‡å¯ Master æˆ–è€…æ–°å¢žä¸€å° Master éƒ½å¯ä»¥å¿«é€Ÿæ¢å¤é›†ç¾¤ã€‚etcd çš„å¤‡ä»½æ˜¯åšçš„å…¨é‡å¤‡ä»½ï¼Œä¸Šä¼ åˆ°æˆ‘ä»¬çš„å¤‡ä»½å­˜å‚¨ä¸­ã€‚

> Qï¼šå†…ç½‘åŸŸåæ˜¯æ€Žä¹ˆè·¨ VPC å’Œç»å…¸ç½‘ç»œçš„ï¼Ÿ

Aï¼šå†…ç½‘åŸŸåçš„ DNSPod è§£æžæ˜¯è§£æžåˆ° VPC ç½‘ç»œçš„ä¸€å° ECS æœºå™¨ä¸Šï¼Œé€šè¿‡ Nginx æ¥ç®¡ç†ã€‚ç»å…¸ç½‘ç»œçš„ ECS æœåŠ¡é›†ç¾¤å¯ä»¥åœ¨å‰é¢æŒ‚è½½ä¸€ä¸ª VPC ç½‘ç»œçš„ SLBï¼ŒNginx çš„å¯¹åº” Server Name çš„ Upstream è®¾ä¸ºè¿™ä¸ª VPC çš„ SLB å³å¯ã€‚

> Qï¼šç›‘æŽ§å’Œå‘Šè­¦å¥½åƒæ²¡æœ‰æåˆ°ï¼Œæ„Ÿè§‰ OC è¿™å—ä¼¼ä¹Žç¼ºå¤±ï¼Ÿ

Aï¼šOpenShift æœ¬èº«æœ‰å¾ˆå¤šæœåŠ¡çŠ¶æ€ï¼Œimage çš„ Buildã€pullã€push ç­‰çŠ¶æ€ï¼Œä»¥åŠ Pod çš„å„ç§çŠ¶æ€ï¼›å¦å¤–è¿˜æœ‰å¼ºå¤§ eventsã€‚æˆ‘ä»¬æ˜¯é€šè¿‡ OpenShift çš„ API æ¥èŽ·å–è¿™äº›ä¿¡æ¯ï¼ŒåŒæ­¥åˆ° Open-Falcon ä¸Šæ¥å¤„ç†æŠ¥è­¦ä¿¡æ¯çš„ã€‚

> Qï¼šæ—¥å¿—ç»Ÿä¸€ç”Ÿäº§ã€é‡‡é›†ç”¨äº†ä»€ä¹ˆæ–¹å¼èƒ½ä»‹ç»ä¸€ä¸‹å—ï¼Ÿ

Aï¼šæ—¥å¿—æ˜¯ä¸€ä¸ªæ¯”è¾ƒç–‘éš¾çš„é—®é¢˜ï¼›æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œæ‰€æœ‰çš„æ—¥å¿—éƒ½æ‰“åˆ°åŒä¸€ä¸ª NaS ç›˜ä¸Šï¼ŒæœåŠ¡åæ¥åšè¯¥æœåŠ¡çš„æ—¥å¿—è·¯å¾„ã€‚å¤šä¸ª Pod æ‰“åŒä¸€ä¸ªæ—¥å¿—çš„æ—¶å€™ï¼Œä¼šå‡ºçŽ°ä¹±ç ã€‚æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨æ—¥å¿—ä¸­é—´åŠ  hostnameï¼Œä¾‹å¦‚ haadeers.melon-crm-b-9-nb9d5.logï¼Œmelon-crm-b-9-nb9d5 ä¸º Pod çš„ hostnameã€‚æ—¥å¿—æ”¶é›†ï¼Œæ˜¯å‡ å° ECS æœºå™¨æŒ‚è½½æ”¹ NAS ç›˜ï¼Œå¯åŠ¨ flume æ¥æ”¶é›†ã€‚

> Qï¼šä¸šåŠ¡åº”ç”¨çš„è‡ªåŠ¨åŒ–å‘å¸ƒä½ ä»¬æ˜¯æ€Žä¹ˆè®¾è®¡çš„ï¼Œèƒ½å¦è¯¦ç»†è¯´è¯´æ€è·¯ï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯è‡ªå·±å®šä¹‰äº† S2I çš„æµç¨‹ã€‚Build é•œåƒç»Ÿä¸€åœ¨ä»£ç ä»“åº“é‡ŒåŠ ä¸€ä¸ª Makefileï¼Œå®šä¹‰ä¸€ä¸ª assemble çš„ roleï¼Œæ¥åšåˆå§‹åŒ–ï¼ˆä¾èµ–åŒ…çš„å®‰è£…ã€nodejs çš„ Build ç­‰ç­‰ï¼Œè¿™é‡Œè¿˜æ˜¯æ¯”è¾ƒçµæ´»çš„ï¼‰ã€‚è‡ªåŠ¨å‘å¸ƒï¼šæˆ‘ä»¬æ˜¯è‡ªå®šä¹‰äº†éƒ¨ç½²æ¨¡æ¿ï¼Œåˆ†äº«çš„å†…å®¹é‡Œæœ‰ï¼ˆåªéœ€è¦ç®€å•çš„å‡ æ­¥å°±å¯ä»¥éƒ¨ç½²ä¸€å¥—æœåŠ¡ï¼‰ã€‚

---

### 2018-11-29ï¼šçŒªå…«æˆ’ç½‘ DevOps å®¹å™¨äº‘ä¸Žæµæ°´çº¿

> Qï¼šIngress æ˜¯ç”¨çš„é‚£ä¸ªç»„å»ºï¼Ÿ

Aï¼šè¿™é‡Œæˆ‘å†è¯¦ç»†è¡¥å……ä¸‹ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åˆ° Ingress Service è¿™äº›å¯¹è±¡ï¼Œä¸ºäº†ç»´æŠ¤ä¸Žè™šæ‹Ÿæœºé¡¹ç›®çš„ç»Ÿä¸€ç®¡ç†ï¼Œæ–¹ä¾¿è¿ç»´ä½¿ç”¨ï¼Œæˆ‘ä»¬çš„ Nginx æ˜¯éƒ¨ç½²åœ¨é›†ç¾¤å¤–éƒ¨çš„ï¼Œä¸Ž nginx-ingress-controller ä¸€æ ·ï¼Œä½¿ç”¨ Lua æ‰©å±•è‡ªå·±åšæœåŠ¡å‘çŽ°ï¼ŒNginx ç›´æŽ¥å‘ Pod è½¬å‘æµé‡ã€‚

> Qï¼šNginx å’Œ PHP-FPM é‡‡ç”¨ä»€ä¹ˆæ–¹æ³•éƒ¨ç½²å’Œæ›´æ–°ï¼ŒNginx å’Œ FPM æœ‰åˆ†å¼€éƒ¨ç½²å—ï¼Ÿ

Aï¼šNginx éƒ¨ç½²åœ¨é›†ç¾¤å¤–éƒ¨è™šæ‹Ÿæœºé‡Œï¼Œè™šæ‹Ÿæœºç½‘ç»œä¸Žå®¹å™¨å†…éƒ¨ç½‘ç»œæ˜¯æ‰“é€šçš„ï¼Œç›´æŽ¥è½¬å‘æµé‡ç»™ Podï¼›PHP æ˜¯è€é¡¹ç›®ï¼Œæœ‰ä¸€å°éƒ¨åˆ†åšäº†å®¹å™¨åŒ–ï¼ŒåŸºäºŽ PHP åŸºç¡€é•œåƒä½¿ç”¨ deployment éƒ¨ç½²ï¼ŒPHP é¡¹ç›®æ˜¯æ— çŠ¶æ€çš„ï¼Œè·Ÿå…¶ä»–é¡¹ç›®ä¸€æ ·è¿›è¡Œæ»šåŠ¨æ›´æ–°ï¼›Nginx ä¸Ž FPM æ˜¯åˆ†å¼€éƒ¨ç½²çš„ã€‚

> Qï¼šè¯·é—®ä¸‹ä½ ä»¬æœ‰æ²¡æœ‰ä½¿ç”¨ API ç½‘å…³ï¼Œè‡ªå·±å¼€å‘çš„è¿˜æ˜¯ä½¿ç”¨ Kubernetes è‡ªå¸¦çš„ï¼Œç”¨æˆ·æƒé™æ˜¯åšåœ¨ API ç½‘å…³å—ï¼Ÿ

Aï¼šç›®å‰æ²¡æœ‰ç”¨åˆ° API ç½‘å…³é¡¹ç›®ï¼Œè‡ªå·±ä½¿ç”¨ Nginx åšçš„ç®€å• API ç½‘å…³ï¼Œsahaba api æ˜¯æˆ‘ä»¬è‡ªå·±å¼€å‘çš„ Kubernetes ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨ client-go ç»„ä»¶å‘ Kubernetes API å‘èµ·è¯·æ±‚è°ƒç”¨ï¼›ç”¨æˆ·æƒé™æˆ‘ä»¬å¯¹æŽ¥äº† DevOps æƒé™ç®¡ç†ç³»ç»Ÿï¼ŒåŒºåˆ†è¶…çº§ç®¡ç†å‘˜ï¼Œè¿ç»´äººå‘˜ï¼Œé¡¹ç›®è´Ÿè´£äººï¼Œæ™®é€šç”¨æˆ·ç­‰ï¼Œç¡®å®šæŸä¸ªç”¨æˆ·å¯¹æŸä¸ªé¡¹ç›®å®¹å™¨ guest æˆ– admin æƒé™ã€‚

> Qï¼šä½ ä»¬çš„ Kubernetes ç®¡ç†å¹³å°ï¼Œè€ƒè™‘ç”¨ 360 å¼€æºçš„ wayne å—ï¼Ÿ[Qihoo360/wayne](https://github.com/Qihoo360/wayne) å¯ä»¥æ»¡è¶³ç”¨æˆ·ä¸Šçº¿éœ€æ±‚ï¼Œä¹Ÿé›†æˆäº† webshell ä¹‹ç±»çš„ï¼Œçœ‹èµ·æ¥æŒºä¸é”™çš„ã€‚

Aï¼š360 çš„ wayne é¡¹ç›®ï¼Œæˆ‘ä»¬ä¹Ÿå…³æ³¨äº†ï¼ŒæŠŠæºç ä¸‹ä¸‹æ¥çœ‹äº†ä¸€ä¸‹ã€‚æˆ‘ä»¬ DevOps å¹³å°ä¸Ž wayne çš„ä¸€å¤§ä¸åŒä¹‹å¤„åœ¨äºŽï¼šwayne ç»™ç”¨æˆ·çš„å‘å¸ƒæ˜¯æŠŠ Kubernetes çš„ deployment æ¨¡æ¿æ”¾ä¸ŠåŽ»äº†ï¼Œè®©ç”¨æˆ·åŽ»å¡«å†™ï¼›æˆ‘ä»¬æ˜¯ç”¨ sahaba-metadata é¡¹ç›®å°† deployment æ¨¡æ¿æŠ½è±¡å‡ºæ¥ï¼Œåªç»™ç”¨æˆ·å¡«å†™ Git é¡¹ç›®åˆ†æ”¯ï¼Œä»¥åŠéœ€è¦å‘å¸ƒçš„ CPU/å†…å­˜/èŠ‚ç‚¹ç­‰ï¼Œé•œåƒ urlï¼Œè¶…å¼€ç­–ç•¥ç­‰æ•°æ®ä¸éœ€è¦ç”¨æˆ·å¡«å†™ï¼Œå¼€å‘äººå‘˜ä¸éœ€è¦å…³å¿ƒè¿™äº›ã€‚æˆ‘ä»¬ä¹Ÿå‚è€ƒäº† wayne çš„ webshell å®žçŽ°ï¼Œè·Ÿ kube dashboard é¡¹ç›®ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿæ­£åœ¨åŸºäºŽä»–ä»¬çš„ä»£ç ä¼˜åŒ–æˆ‘ä»¬è‡ªå·±çš„ webshellã€‚

> Qï¼šPrometheus ç›‘æŽ§æ•°æ®æ˜¯ç”¨ä»€ä¹ˆå­˜å‚¨çš„äº†ï¼Ÿé‡‡ç”¨äº†ä»€ä¹ˆé›†ç¾¤æ–¹æ¡ˆï¼Ÿå­˜å‚¨æ²¡æœ‰é›†ç¾¤åŒ–å—ï¼Ÿ

Aï¼šHelm install CoreOS/kube-prometheusï¼Œç›®å‰æ˜¯å®Œå…¨å®¹å™¨åŒ–éƒ¨ç½²çš„ï¼Œä½¿ç”¨ hostpath æŒ‚è½½ï¼Œéƒ¨ç½²åœ¨ä¸€ä¸ªä¸“ç”¨èŠ‚ç‚¹ä¸Šï¼Œå…¬æœ‰äº‘ä¸Šä½¿ç”¨ PVCã€‚ç›®å‰ç»™äº† 30G çš„å†…å­˜èµ„æºå¤Ÿç”¨ï¼Œæ²¡æœ‰é›†ç¾¤åŒ–éƒ¨ç½²ã€‚

> Qï¼šetcd ç”¨å“ªä¸ªç‰ˆæœ¬çš„ï¼Œ3 èŠ‚ç‚¹ä»¥ä¸Šçš„ etcd é›†ç¾¤å´©æºƒåŽå¦‚ä½•ç”¨é•œåƒå¿«é€Ÿæ¢å¤ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„é›†ç¾¤å„ä¸ªç‰ˆæœ¬éƒ½æœ‰ï¼Œä»Ž 1.4 åˆ° 1.11ï¼Œéƒ½æ˜¯ä½¿ç”¨å½“æ—¶æœ€æ–°çš„ç¨³å®šç‰ˆéƒ¨ç½²ï¼Œå…·ä½“å¯ä»¥çœ‹ Kubernetes release note é‡Œçš„ dependenciesï¼›etcd é›†ç¾¤æ¢å¤ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹ etcd çš„æ•°æ®åœ¨ï¼Œå°±å¯ä»¥æ¢å¤ï¼Œå…ˆå°†è¿™ä¸ªèŠ‚ç‚¹ force-newï¼Œå…¶ä»–èŠ‚ç‚¹ join è¿›æ¥ï¼Œæ•°æ®ä¼šè‡ªåŠ¨ä»Ž leader åŒæ­¥åˆ° slaveã€‚ä½ æåˆ°çš„ä½¿ç”¨è™šæ‹Ÿæœºé•œåƒæ¢å¤ï¼Œè¿™ä¸ªæˆ‘è¿˜æ²¡æœ‰ä½¿ç”¨è¿‡ï¼Œæˆ‘ç†è§£çš„æ•´ä¸ªäº‘ç¡¬ç›˜çš„æ•°æ®éƒ½å¯ä»¥å¤‡ä»½ä¸‹æ¥ï¼Œæ•°æ®æ¢å¤ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ï¼Œå‚ç…§å…¬æœ‰äº‘æ•°æ®å¤‡ä»½æ¢å¤æ–¹æ¡ˆã€‚

> Qï¼šweb terminal æ€Žä¹ˆåšçš„ï¼Œæœ‰å‚è€ƒæ–‡æ¡£å—ï¼Ÿ

Aï¼šweb terminal æ–°ç‰ˆçš„æ˜¯å‚ç…§ kube dashboard æºç ï¼Œä½¿ç”¨ client-go è°ƒç”¨ kubernetes apiï¼Œspdyexecutorï¼Œç„¶åŽè½¬ä¸º ws è¿žæŽ¥å®žçŽ°ï¼Œæœ€è¿‘å¼€æºäº†ä¸€ä¸ª [demoï¼š](https://github.com/lf1029698952/web-terminal-in-go)

> Qï¼šetcd æ•°æ®å¤‡ä»½æ˜¯æ€Žä¹ˆåšçš„ï¼ŒCrontab å—ï¼Œè¿˜æ˜¯ä½¿ç”¨ Kubernetes é‡Œçš„ Jobï¼Œå¦‚ä½•ç¡®ä¿å¤‡ä»½çš„æ•°æ®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Ÿ

Aï¼šå› ä¸º etcd æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶éƒ¨ç½²çš„ï¼Œç›®å‰æˆ‘ä»¬æ˜¯ä½¿ç”¨ Crontab å®šæ—¶ä»»åŠ¡æ¯å¤©å¤‡ä»½ä¸€æ¬¡æ•°æ®ï¼Œå¤‡ä»½çš„å†…å®¹åŒ…æ‹¬ etcd snapshotï¼Œetcd çš„æ•°æ®ç›®å½•ï¼ŒåŒæ—¶å¤‡ä»½åˆ°æœ¬åœ°åŠè¿œç¨‹æœåŠ¡å™¨ï¼Œå…¬æœ‰äº‘ä¸Šè¿˜æœ‰äº‘ç¡¬ç›˜é•œåƒå¤‡ä»½ï¼Œå¤šç§å¤‡ä»½æ–¹æ¡ˆä¿è¯æ•°æ®æ­£å¸¸ã€‚

> Qï¼šæ—¥å¿—æ”¶é›†å·¥å…·æ˜¯å¦ç”¨äº† Fluentdï¼Œæ—¥å¿—æ”¶é›†åˆ° ES é‡Œï¼Œç”¨ Kibana æŸ¥è¯¢æœ‰æ²¡æœ‰é‡åˆ°è¿‡æ—¥å¿—ä¹±åºçš„é—®é¢˜ï¼Ÿ

Aï¼šæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Filebeatï¼Œå°†æ—¥å¿—æ”¶é›†åˆ° Kafkaï¼Œå†è½¬ç»™ Logtashï¼ŒLogtash å¤„ç†åŽæ‰è½¬ç»™ ESï¼Œ Filebeat -\> Kafka -\> Logstash -> ES -> Kibanaï¼Œä¹±åºé—®é¢˜æˆ‘æ²¡é‡åˆ°è¿‡ï¼Œåº”è¯¥å¯ä»¥åœ¨ Logstash å¤„ç†çš„æ—¶å€™ç¡®è®¤ã€‚

> Qï¼šå¯å¦å®žçŽ° Kubernetes ä¸Šå®¹å™¨ä¸Žä¸»æœºé€šè®¯ï¼Ÿ

Aï¼šå®¹å™¨ä¸Žä¸»æœºé€šä¿¡æ˜¯å¯ä»¥çš„ï¼Œå…·ä½“å¯ä»¥å‚è§ Calico çš„ç½‘ç»œæ–¹æ¡ˆï¼Œä½¿ç”¨ calico routereflect è·¯ç”±åå°„åŠŸèƒ½ä¸Žæ ¸å¿ƒäº¤æ¢æœºåš bgp peer è¿›è¡Œè·¯ç”±äº¤æ¢ï¼Œå…¬æœ‰äº‘ä¸Šä½¿ç”¨ VPC ç½‘ç»œæ–¹æ¡ˆã€‚

> Qï¼šPrometheus federation æœ‰ä½¿ç”¨å—ï¼Œå…³äºŽç›‘æŽ§æ€§èƒ½è¿™å—æœ‰æ²¡æœ‰å•¥å¥½çš„ç»éªŒæ•™è®­ï¼Ÿ

Aï¼šPrometheus ç›‘æŽ§è¿™å—ï¼Œæˆ‘ä»¬åªä¼˜åŒ–äº†æ¯ä¸ª Job æŠ“å–çš„æ—¶é—´é—´éš”ï¼Œä¿è¯ Prometheus Server çš„è´Ÿè½½ä¸ä¼šå¤ªé«˜ï¼Œå¹¶ç»™ Prometheus è¶³å¤Ÿçš„ CPU å†…å­˜ä»¥åŠ SSD ç£ç›˜ï¼ŒæŸ¥è¯¢æ—¶ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶ã€‚

> Qï¼šæ—¥å¿—è§£æžå…·ä½“ç”¨çš„ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆå¯¹æœåŠ¡çš„æ—¥å¿—äºŒæ¬¡è§£æžï¼Ÿ**

Aï¼šFilebeat -> Kafka -> Logstash -> ES -Kibanaï¼Œåœ¨ Logstash å¤„ä¼šå¯¹æ—¥å¿—è¿›è¡ŒäºŒæ¬¡è§£æžæ‰“æ ‡ï¼Œä¸è§„èŒƒçš„æ—¥å¿—ä¼šä¸¢å¼ƒæŽ‰ã€‚

> Qï¼šJVM Xmx æ˜¯å †å†…å­˜ï¼Œç¡¬é™åˆ¶æ˜¯ç‰©ç†å†…å­˜ï¼Œä½ ä»¬çš„é…ç½®æ˜¯ç›´æŽ¥è¯»çŽ¯å¢ƒå˜é‡è®¾ç½®ä¸€æ ·äº†å—ï¼Ÿä¼šä¸ä¼šå‡ºçŽ°å†…å­˜ä¸è¶³ï¼Ÿå †å¤–å†…å­˜æ€Žä¹ˆåŠžï¼Ÿ

Aï¼šæˆ‘ä»¬çš„çŽ¯å¢ƒå˜é‡é…ç½®çš„æ˜¯ Pod å®¹å™¨çš„ limit å¤§å°ï¼ŒJVM Xmx æ˜¯ä½¿ç”¨ limit å¤§å°\*0.6 é…ç½®å¯åŠ¨çš„ï¼Œå‡ºçŽ°è¿‡å†…å­˜ä¸è¶³ï¼ŒOOM ç­‰æƒ…å†µï¼Œä¸€èˆ¬æ˜¯è®©å¼€å‘åŽ»è°ƒæ•´ permsize å¤§å°ï¼Œæˆ–ä¸è¦æœ‰å†…å­˜æ³„éœ²ã€‚

> Qï¼šå®¹å™¨ rootfs å¤§å°æ€Žä¹ˆé™åˆ¶çš„ï¼Ÿ

Aï¼šåœ¨å®‰è£… Docker æ—¶ï¼Œä½¿ç”¨ Devicemapper é©±åŠ¨å®‰è£…ï¼Œä¼šé»˜è®¤é™åˆ¶å¤§å° 10Gï¼Œoverlya é©±åŠ¨å¯¹ rootfs å¤§å°çš„é™åˆ¶ä¸æ˜¯å¾ˆå®Œå–„ã€‚

> Qï¼šDaemonSet çš„æ—¥å¿—æ”¶é›†å…·ä½“æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿæ€Žä¹ˆé‡‡é›†æ—¥å¿—ï¼Ÿ

Aï¼šæˆ‘ä»¬å‚è€ƒäº†é˜¿é‡Œäº‘çš„ LogTail æ—¥å¿—é‡‡é›†æ–¹æ¡ˆï¼Œè¿™é‡Œç»™å¤§å®¶æŽ¨èä¸€ä¸ªå¼€æºç‰ˆçš„æ—¥å¿—é‡‡é›†é¡¹ç›®ï¼š[AliyunConta/pilot](https://github.com/AliyunContainerService/log-pilot)ã€‚

> Qï¼šæœåŠ¡ç›‘æŽ§æŽ¥å£ï¼Œç±»ä¼¼äºŽ/zbjcheck è¿™å—æ˜¯æ€Žä¹ˆåšçš„å‘¢ï¼Ÿæ˜¯å¦å¯ä»¥å‘ä¸€ä¸ªè¿”å›žæ ·ä¾‹ã€‚

Aï¼šè¦æ±‚åœ¨æ¯ä¸ªé¡¹ç›®é‡Œå¯¹/zbjcheck è·¯ç”±è¿›è¡ŒåŒ¹é…ï¼Œæ ¹æ® http è¿”å›žç åšç®€å•çš„ check æ£€æµ‹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š[kubernetes.io/docs/robes](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/#define-readiness-probes)ã€‚

> Qï¼šä»€ä¹ˆæ—¶å€™å‡çº§é›†ç¾¤ï¼ŒKubernetes å¤§ç‰ˆæœ¬å‡çº§çš„æ—¶å€™æ€Žä¹ˆåšï¼Ÿ

Aï¼šæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨è¿›è¡Œæœºæˆ¿ä¸šåŠ¡è¿ç§»çš„æ—¶å€™åŽ»å‡çº§é›†ç¾¤ï¼Œå¦‚ä»Žç§æœ‰äº‘è¿åˆ°å…¬æœ‰äº‘ï¼Œç›´æŽ¥æ–°å»ºä¸€å¥—æ–°ç‰ˆæœ¬é›†ç¾¤ï¼ŒæŠŠæ—§é›†ç¾¤çš„ deployment æ–‡ä»¶æ›´æ–°è¿‡åŽ»ã€‚

> Qï¼šç›¸å…³ä¸­é—´ä»¶å’Œ DB éƒ½æ²¡æœ‰ä¸Šå—ï¼Ÿæœ‰çš„è¯è¯·ä»‹ç»ä¸€ä¸‹ã€‚

Aï¼šæ˜¯çš„ï¼Œä¸­é—´ä»¶å’Œ DB æ•°æ®åº“éƒ½æœ‰ä¸“é—¨çš„å›¢é˜Ÿæ¥ç»´æŠ¤ï¼Œåœ¨æ²¡æœ‰å¿…è¦çš„æƒ…å†µä¸‹æ²¡æœ‰åŽ»åšå®¹å™¨åŒ–ï¼Œæˆ‘ä»¬é›†ç¾¤å¯¹æŽ¥äº† Ceph å­˜å‚¨ï¼Œä½† IO æ€§èƒ½ä¸é«˜ï¼Œæ•°æ®åº“å®¹å™¨åŒ–è¿˜æ˜¯åº”è¯¥ä½¿ç”¨ local volumeã€‚

> Qï¼šDevOps çš„èµ„æ–™éƒ½å­˜åœ¨ etcd ä¸­çš„å—ï¼Ÿ è¿™ä¸ªæ˜¯æ€Žä¹ˆåšçš„ èƒ½å¦è®²è®²è®¾è®¡æ€è·¯ï¼Ÿ

Aï¼šæ˜¯æˆ‘ä»¬çš„ Deployment å‘å¸ƒæ¨¡å—åŠå…ƒæ•°æ®éƒ½å­˜åœ¨äº† etcd ä¸­ï¼ŒæŠŠ etcd å½“åšä¸€ä¸ª K-V æ•°æ®åº“æ¥ç”¨ï¼Œå½“æ—¶åœ¨æ•°æ®åº“é€‰åž‹æ—¶ä¹Ÿè€ƒè™‘è¿‡ MySQLï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ•°æ®ç±»åž‹é€‚åˆ KV å­˜å‚¨ï¼Œå¦‚æˆ‘ä»¬çš„æ¯ä¸ªé¡¹ç›® Deployment æ¨¡æ¿éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå­˜æ”¾åœ¨/deployment/region/env/projectname/è¿™æ ·çš„è·¯å¾„ä¸‹ï¼Œå¹¶ä¸” etcd æ›´åŠ ç¨³å®šé«˜å¯ç”¨ã€‚

---

### 2018-11-22ï¼šå®¹å™¨åŒ–è½åœ°å®žè·µçš„ä¸€ä¸ªæ¡ˆä¾‹

> Qï¼šPreStop Hook çš„å‚è€ƒåœ°å€èƒ½ç»™ä¸ªå¤–ç½‘åœ°å€çœ‹å˜›ï¼Ÿ

Aï¼šè¿™ä¸ªçœ‹å®˜æ–¹çš„æ–‡æ¡£å°±è¡Œå§ï¼Œæˆ‘è¿™ä¸ªåœºæ™¯é‡Œåªæ˜¯ç”¨äº†ä¸€ä¸ª curlï¼Œè®©å¼€å‘æä¾›ä¸€ä¸ªæŽ¥å£å°±è¡Œã€‚å…·ä½“ PreStop Hook å®˜æ–¹æ–‡æ¡£ä¸Šæœ‰è¯¦ç»†çš„ä¸¾ä¾‹ã€‚

> Qï¼šApollo é…ç½®ä¸­å¿ƒï¼Œé…ç½®æ€Žä¹ˆè½åˆ°æœåŠ¡é‡Œçš„ï¼Œæˆ–è€…å®¹å™¨é‡Œï¼Ÿ

Aï¼šæˆ‘ä»¬è¿™è¾¹å¤§éƒ¨åˆ†æ˜¯ Java é¡¹ç›®ï¼Œä½¿ç”¨çš„å®˜æ–¹æä¾›çš„ SDKï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹ Apollo çš„ä½¿ç”¨æ–‡æ¡£ã€‚

> Qï¼šæ—¥å¿—æ€Žä¹ˆé‡‡é›†å’Œå±•ç¤ºï¼Ÿç”¨ä»€ä¹ˆæ–¹æ¡ˆï¼Ÿ

Aï¼šELKï¼Œé‡‡é›†æ—¥å¿—ä¸»è¦æ˜¯ç¨‹åºç›´æŽ¥è¾“å‡ºåˆ° Redisï¼Œè¿™ç‚¹æœ‰äº›ä¸ä¸€æ ·ã€‚

> Qï¼šCD çš„é…ç½®æ˜¯æ€Žä¹ˆç®¡ç†çš„ï¼Ÿ

Aï¼šç›¸å…³çš„ä¸Šçº¿é…ç½®éƒ½æ˜¯å­˜åœ¨è¿ç»´å¹³å°ä¸Šï¼ŒæœåŠ¡çš„é…ç½®ä½¿ç”¨çš„ Apollo é…ç½®ä¸­å¿ƒã€‚

> Qï¼šKubernetes çš„ HPA ç»„ä»¶æ˜¯åŽŸç”Ÿçš„å—ï¼Œåªæ ¹æ® CPU å†…å­˜æ¥è¿›è¡Œä¼¸ç¼©ï¼Œæœ‰æ²¡æœ‰å‡ºçŽ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Ÿ

Aï¼šæ˜¯åŽŸç”Ÿçš„ï¼Œå‡ºçŽ°è¿‡çš„é—®é¢˜æ˜¯ï¼Œä¹‹å‰éƒ½åªé‡‡ç”¨äº†ä¸€ä¸ªçº¬åº¦çš„æ‰©å®¹ï¼ˆCPUï¼‰ï¼ŒåŽæ¥å‘çŽ°è¯¥ Pod ç»å¸¸ OOMï¼ŒåŽæ¥åŠ ä¸Šäº†å†…å­˜çš„æ‰©å®¹ï¼ŒJava æœåŠ¡ä¾‹å¤–ã€‚

> Qï¼šPrometheus æ•°æ®æ€Žä¹ˆä¿å­˜çš„ï¼Œæ¯ä¸ªå®žä¾‹éƒ½å­˜åœ¨æœ¬åœ°ç›®å½•å—ï¼Ÿ

Aï¼šæˆ‘ä»¬æœ‰ä¸“é—¨çš„ Node èŠ‚ç‚¹æ¥è·‘ Prometheus Pod é€šè¿‡ Node Label è°ƒåº¦ï¼Œé‡‡ç”¨çš„æœ¬åœ° SSD ç£ç›˜ï¼Œæ¯ä¸ªæœåŠ¡ä¸€ä¸ªç›®å½•ï¼Œå¤§æ¦‚è¿™ä¸ªæ ·å­ã€‚

> Qï¼šè¿˜æœ‰å°±æ˜¯æ—¥å¿—éƒ¨åˆ†çŽ°åœ¨ Redis æ˜¯ç“¶é¢ˆå—ï¼ŒRedis ä¹Ÿæ˜¯é›†ç¾¤ï¼Ÿ

Aï¼šåˆ†äº«çš„æ—¶å€™æåˆ°äº†ï¼ŒRedis æ˜¯ç“¶é¢ˆï¼ŒåŽæ¥å…¬å¸ Golang å·¥ç¨‹å¸ˆæžäº†ä¸€ä¸ª Reids\--Kafka çš„ä»£ç†æœåŠ¡ï¼Œé‡‡ç”¨çš„ Redis åè®®ï¼Œä½†æ˜¯ç›´æŽ¥å†™å…¥åˆ°äº† Kafkaï¼Œè§£å†³äº†æ€§èƒ½é—®é¢˜ã€‚

> Qï¼šPrometeus ä¹Ÿæ˜¯ Kubernetes ç®¡ç†å—ï¼Œé…ç½®æ–‡ä»¶ä»–çš„é…ç½®æ–‡ä»¶æ€Žä¹ˆç®¡ç†çš„ï¼Ÿ

Aï¼šè¿™å—æˆ‘ä»¬å†™äº†ä¸€ä¸ªç®€å•çš„æœåŠ¡éƒ¨ç½²åˆ°äº† Kubernetes çš„ Master èŠ‚ç‚¹ä¸Šï¼Œå½“ä¸€ä¸ªæœåŠ¡æŽ¥å…¥ Kubernetes ä¸Šä»¥åŽï¼Œè¿ç»´å¹³å°ä¼šåŽ»æŽ‰è¿™ä¸ªæœåŠ¡çš„æŽ¥å£ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª Prometheus Server ä¸“é—¨æŠ“å–è¯¥æœåŠ¡çš„ç›‘æŽ§æ•°æ®ï¼Œé€šè¿‡ Prometheus çš„é…ç½®å¯ä»¥åšåˆ°åªåŒ¹é…è¯¥æœåŠ¡ï¼Œæˆ‘ä»¬è¿™è¾¹æ˜¯æ¯ä¸ªæœåŠ¡é…ç½®ä¸€ä¸ªå•ç‹¬çš„ Prometheus Server æŠ“å–ç«¯ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2018 å¹´ 11 æœˆ 20 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**å´é£žç¾¤ï¼Œä¸€ä¸‹ç§‘æŠ€è¿ç»´å·¥ç¨‹å¸ˆ**ã€‚

---

### 2018-11-03ï¼šSpring Cloud Kubernetes å®¹å™¨åŒ–å®žè·µ

> Qï¼šä½¿ç”¨ NFS æœ‰å­˜åœ¨æ€§èƒ½ç“¶é¢ˆæˆ–å•ç‚¹æ•…éšœçš„é—®é¢˜å—ï¼Œå¦‚ä½•è§£å†³ï¼Œå¯¹äºŽæŒä¹…åŒ–è¦æ±‚é«˜çš„ Redis åº”è¯¥é‡‡ç”¨å“ªç§å­˜å‚¨ï¼Ÿ

Aï¼šå…·ä½“çœ‹ä½ çš„è§„æ¨¡æ•°é‡ï¼Œæµ‹è¯•ã€å¼€å‘çŽ¯å¢ƒï¼Œå•èŠ‚ç‚¹ NFS æ¯«æ— åŽ‹åŠ›ï¼Œæ•°æ®æ˜¯å…ˆå†™åˆ°ç¼“å­˜å†…å­˜ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œæˆ‘æ–‡ç« ä¸­çš„è¯´çš„å†…æ ¸æ³¨æ„ bugï¼Œæ²¡å¿…è¦åšé«˜å¯ç”¨ï¼Œå…¬æœ‰äº‘æœ‰ NAS æœåŠ¡ï¼Œä¸å¿…æ‹…å¿ƒï¼Œè‡ªå»ºæœºæˆ¿å¯ä»¥ç”¨ drbd Keepalived vipã€‚

> Qï¼šä¸ºä»€ä¹ˆç½‘ç»œæ²¡æœ‰ä½¿ç”¨ Traefikï¼ŒSpring Cloud çš„ç›¸å…³ç»„ä»¶æ˜¯æ€Žä¹ˆéƒ¨ç½²çš„ï¼Œæ˜¯ç”¨ yaml æ–‡ä»¶è¿˜æ˜¯ä½¿ç”¨ Helm æ–¹å¼ï¼Ÿ

Aï¼šè€ƒè™‘åˆ° Traefik æ€§èƒ½æ²¡æœ‰ nginx å¥½ï¼Œæ‰€ä»¥ç”¨ nginxï¼Œymal æ˜¯è‡ªå·±å†™çš„æ¨¡æ¿ç”Ÿæˆçš„ï¼Œæ²¡æœ‰ç”¨ Helmã€‚æˆ‘ä»¬æ­£åœ¨è°ƒç ”ï¼ŒEureka å¯ä»¥å•ç‹¬å®šåˆ¶å¤šä¸ª yml äº’ç›¸æ³¨å†Œã€‚ä¸Žå¤–éƒ¨æœåŠ¡é€šè¿‡æ‰“é€šç½‘ç»œç›´é€šï¼Œé€šè¿‡ SVC å¯¹æŽ¥ã€‚

> Qï¼šè¯·é—®ä¸‹æ‰€æœ‰çŽ¯å¢ƒéƒ½åœ¨ä¸€ä¸ªé›†ç¾¤ï¼ŒåŽ‹æµ‹æ€Žä¹ˆåŠžï¼Ÿ

Aï¼šåŽ‹æµ‹åªæ˜¯å¯¹åº”ç”¨äº§ç”ŸåŽ‹åŠ›ï¼Œä½ å¯ä»¥æŠŠéœ€è¦åŽ‹æµ‹çš„åº”ç”¨è°ƒåº¦åˆ°ä¸åŒçš„èŠ‚ç‚¹ Node Selecto éš”ç¦»è¿è¡Œã€‚

> Qï¼šå¯¹äºŽå±€åŸŸç½‘å¾®ä¿¡å›žè°ƒæ˜¯å¦‚ä½•åšï¼Œæ²¡æœ‰å…¬ç½‘ IPï¼Ÿ

Aï¼šæ‰“é€šç½‘ç»œä¹‹åŽï¼Œè®¾ç½® WIFI æŒ‡å‘ DNS ä¸º Kubernetes DNSï¼ŒService ç›´æŽ¥äº’é€šã€‚

> Qï¼šEureka æ³¨å†Œæ—¶æœåŠ¡ IP ç”¨çš„ä»€ä¹ˆï¼Ÿ

Aï¼šKubernetes é›†ç¾¤å†…ä¼šç”¨çš„ pod ip åŽ»æ³¨å†Œã€‚

> Qï¼šæœ‰çŠ¶æ€åº”ç”¨çš„åœºæ™¯ï¼Œä½¿ç”¨å®¹å™¨éƒ¨ç½²ä¸Žä¼ ç»Ÿéƒ¨ç½²æœ‰å•¥åŒºåˆ«ï¼Œå®¹å™¨éƒ¨ç½²æ˜¯å¦å­˜åœ¨ä¸€äº›å‘ï¼Ÿ

Aï¼šæœ‰çŠ¶æ€å®¹å™¨åˆ›å»ºåŽï¼Œå°½é‡å°‘åŠ¨ï¼Œå°‘è¿ç§»ï¼Œé‡åˆ°è¿‡å¡ä½ï¼Œå®¹å™¨æ— æ³•è¿ç§»æˆ–åˆ é™¤ï¼Œé‡è¦çš„ MySQL ä¹‹ç±»çš„å»ºè®®æ”¾å¤–éƒ¨è¿è¡Œã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2018 å¹´ 10 æœˆ 30 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æ¶‚å°åˆšï¼Œæ–°æµªçˆ±é—®æ™®æƒ ç§‘æŠ€å®¹å™¨å¹³å°è´Ÿè´£äººï¼Œè´Ÿè´£ Kubernetes å®¹å™¨å¹³å°çš„æŽ¨å¹¿ä¸Žå»ºè®¾**ã€‚

---

### 2018-09-29ï¼šæœ‰èµžå®¹å™¨åŒ–å®žè·µ

> Qï¼šä½ ä»¬çš„ä¸Šçº¿å®¡æ‰¹æµç¨‹æ˜¯æ€Žæ ·çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¸»è¦æ˜¯å®šä¹‰äº†å‘å¸ƒçª—å£ã€å‘å¸ƒæ¬¡æ•°ç­‰é™åˆ¶ï¼Œå¦‚æžœåœ¨é™åˆ¶ä»¥å†…çš„ï¼Œåªéœ€è¦èµ°æ™®é€šçš„å‘å¸ƒå®¡æ‰¹æµç¨‹ï¼Œå¦åˆ™èµ°ç´§æ€¥å‘å¸ƒæµç¨‹ã€‚

> Qï¼šåœ¨å®¹å™¨å†…æ‰“é•œåƒæ€Žä¹ˆé¿å…ç”¨æˆ·æŠŠä»“åº“è´¦å·ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Ÿ

Aï¼šClone ä»£ç æ‰€ä½¿ç”¨çš„ç§é’¥æ˜¯é€šè¿‡ Pod çš„çŽ¯å¢ƒå˜é‡ä¸‹å‘çš„ï¼Œè¿™é‡Œä¸»è¦æ˜¯æŠŠé•œåƒé›†æˆåˆ†æˆå¤šä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬ä¼šåœ¨æœ€å¼€å§‹ Clone å®Œä»£ç åŽå°±å°†æ‰€æœ‰æ•æ„Ÿä¿¡æ¯æ¸…ç†æŽ‰äº†ã€‚

> Qï¼šç½‘ç»œæ–¹é¢å¯ä»¥è¯¦ç»†è®²ä¸€ä¸‹ï¼Œæ²¡æœ‰é‡åˆ°é—®é¢˜å—ï¼Ÿ

Aï¼šç½‘ç»œæ–¹é¢å› ä¸ºæˆ‘ä¸Šé¢è¯´çš„åŽŸå› ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å°±æ˜¯ Macvlan çš„æ–¹æ¡ˆï¼Œipam éƒ½æ˜¯æœ¬åœ°é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·é£Žé™©ç¡®å®žæ˜¯æœ€ä½Žçš„ï¼Œæ€§èƒ½ä¹Ÿå¾ˆä¸é”™ã€‚åŽé¢æˆ‘ä»¬éšç€æœ‰èµžå¤šäº‘æž¶æž„ï¼Œä¹Ÿåœ¨ä½¿ç”¨ QCloud çš„å®¹å™¨æœåŠ¡ï¼Œå½“ç„¶è¿™é‡Œçš„ç½‘ç»œä¸»è¦è¿˜æ˜¯äº‘åŽ‚å•†è§£å†³çš„ã€‚

> Qï¼šè¯·é—®ï¼Œä½ ä»¬æ˜¯å¦‚ä½•è¡¡é‡åº”ç”¨å®¹å™¨å‘å¸ƒä¹‹åŽçš„æ•ˆçŽ‡æ”¹è¿›çš„ï¼Ÿå•çº¯çœ‹ç”¨æˆ·ä½“éªŒï¼Œè¿˜æ˜¯æœ‰ç±»ä¼¼å‘å¸ƒæ•ˆçŽ‡æ”¹è¿›è¿™ç±»çš„æŒ‡æ ‡ï¼Ÿ

Aï¼šå®¹å™¨åŒ–æ•ˆçŽ‡æå‡å…¶å®žæœ€ä¸»è¦çš„è¿˜æ˜¯åœ¨å¼€å‘æµ‹è¯•çŽ¯èŠ‚ï¼Œæ¯”å¦‚å¾ˆå¤šé¡¹ç›®ä¸­éƒ½æ˜¯ push å®Œä»£ç å°±å¼€å§‹è‡ªåŠ¨ CIã€éƒ¨ç½²ã€æµ‹è¯•ç­‰è¿‡ç¨‹çš„ï¼Œæˆ‘ä»¬åœ¨æŒç»­äº¤ä»˜é‡Œä¼šæœ‰å¾ˆå¤šæŒ‡æ ‡çš„äº§å‡ºä½œä¸ºå‚è€ƒã€‚

> Qï¼šåº”ç”¨ç›‘æŽ§æ–¹æ¡ˆå‘¢ï¼ŸDocker å†…åŸºç¡€ç›‘æŽ§çš„é‡‡é›†ã€ä¸ŠæŠ¥ã€å­˜å‚¨å’Œå±•ç¤ºæ–¹æ¡ˆï¼Œèƒ½å¦åˆ†äº«ä¸‹ï¼Ÿ

Aï¼šç›‘æŽ§ä¸»è¦ç”¨çš„è¿˜æ˜¯ Prometheusï¼Œä¸»è¦åŒ…æ‹¬é‡‡é›†å®¹å™¨çš„åŸºç¡€ Metrics æ•°æ®ã€kube-state-metrics æ•°æ®ä»¥åŠåŽç»­ Java æ¡†æž¶/Nodejs æ¡†æž¶ç»Ÿä¸€è¾“å‡ºçš„ Metrics æ•°æ®ã€‚è¿™äº›ç›‘æŽ§æ•°æ®ä¼šå’Œå®¹å™¨ä¹‹å‰çš„æ‰€æœ‰ç›‘æŽ§æ•°æ®ç»Ÿä¸€åˆ°"å¤©ç½‘"ä¸­ï¼Œå±•ç¤ºæ˜¯æˆ‘ä»¬è‡ªå·±å®šåˆ¶çš„ï¼Œå®žçŽ°åœ¨æˆ‘ä»¬çš„åŸºç¡€ä¿éšœå¹³å°é‡Œé¢ã€‚

> Qï¼šä¹‹å‰çœ‹è¿‡æœ‰èµž SC çŽ¯å¢ƒçš„æ–‡ç« ï¼Œé‡Œé¢ Dubbo çš„è·¯ç”±è§„åˆ™æ˜¯å¦é’ˆå¯¹çŽ¯å¢ƒçš„é€»è¾‘éš”ç¦»åšè¿‡æ”¹é€ ï¼Ÿå…³é”®å®žçŽ°çš„ç‚¹æ˜¯å“ªäº›ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œæˆ‘ä»¬ç¡®å®žæ”¹é€ è¿‡æ•´ä¸ªè°ƒç”¨é“¾é‡Œçš„æ¯ä¸ªçŽ¯èŠ‚ï¼Œä¼šå…¨é“¾è·¯é€ä¼ ä¸€ä¸ªçŽ¯å¢ƒæ ‡ç­¾ï¼Œä»¥åŠæˆ‘ä»¬ç°åº¦å®žçŽ°çš„æ–¹æ¡ˆä¹Ÿæ˜¯åŸºäºŽè¿™ä¸ªã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2018 å¹´ 9 æœˆ 25 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**çŽ‹æ³¢ï¼Œåå¹´è¿ç»´è€å…µï¼ŒçŽ°æ‹…ä»»æœ‰èµžè¿ç»´å¹³å°è´Ÿè´£äººï¼Œè´Ÿè´£æœ‰èµžåŸºç¡€ä¿éšœå¹³å°çš„å»ºè®¾ï¼Œé¢å‘æœ‰èµžå¼€å‘ã€æµ‹è¯•å’Œè¿ç»´æä¾›æ¶µç›–åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é¡¹ç›®ç ”å‘ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆæŒç»­äº¤ä»˜ï¼‰ç­‰åŠŸèƒ½çš„ DevOps ä¸€ç«™å¼æœåŠ¡**ã€‚

---

### 2018-09-20ï¼šå”¯å“ä¼š Noah äº‘å¹³å°å®žçŽ°å†…å¹•æŠ«éœ²

> Qï¼šç°åº¦å‘å¸ƒæ—¶ï¼Œä¸¤ä¸ªåº”ç”¨å‰è¦åŠ è´Ÿè½½å‡è¡¡å—ï¼Ÿ

Aï¼šæˆ‘åœ¨æœåŠ¡æ³¨å†Œå‘çŽ°ç« èŠ‚æåˆ°å”¯å“ä¼šæœ‰è‡ªç ”çš„æœåŠ¡åŒ–æ¡†æž¶ï¼Œæ˜¯é€šè¿‡æœåŠ¡åŒ–æ¡†æž¶çš„ Proxy åš LB çš„ï¼ŒLB æ˜¯æœåŠ¡æ²»ç†çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½ã€‚å¯¹äºŽ HTTP æœåŠ¡ï¼Œæœ€åŽè¿˜æ˜¯æ³¨å†Œåˆ° HAProxy çš„ï¼Œå› æ­¤è¿˜æ˜¯é€šè¿‡å®ƒåš LB çš„ã€‚

> Qï¼š æœ‰çŠ¶æ€çš„æœåŠ¡æ¯”å¦‚ IP å›ºå®šï¼Œä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰è¿™ç§æœåŠ¡ï¼Œæ˜¯æ€Žä¹ˆè§£å†³çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯æœ‰å†™æœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œå¦‚ Redis å’Œ MySQLï¼Œæ˜¯é€šè¿‡ CentOS Operator æ¡†æž¶ï¼Œè‡ªå·±ç¼–å†™ Operator è§£å†³çš„ã€‚å›ºå®š IP æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸­ï¼Œå› ä¸ºè¦ç»“åˆå”¯å“ä¼šçš„ç½‘ç»œæ‹“æ‰‘ï¼Œå®žçŽ°èµ·æ¥ç¨å¾®å¤æ‚ç‚¹ã€‚è¿˜æœ‰ï¼Œæˆ‘ä»¬åœ¨åšçš„ rebuild æ–¹æ¡ˆï¼ŒIP ä¹Ÿæ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œå¦‚æžœæ²¡æœ‰è§¦å‘ Kubernetes çš„ scheduler è°ƒåº¦çš„è¯ï¼Œæ¯”å¦‚ node evictã€‚

> Qï¼šè¯·é—®ï¼Œå¤–éƒ¨è¯·æ±‚å¦‚ä½•è·¯ç”±åˆ° Kubernetes é›†ç¾¤å†…ï¼Œæ˜¯ä½¿ç”¨çš„ Ingress å—ï¼Ÿ

Aï¼šå¤–éƒ¨æµé‡çš„æŽ¥å…¥ï¼Œå”¯å“ä¼šæœ‰ VGW çš„ Gatewayï¼Œé€šè¿‡ APP ä¸Šçš„æ™ºèƒ½è·¯ç”±æ‰¾åˆ°æœ€ä¼˜æœºæˆ¿çš„ VGWï¼Œç„¶åŽä¸€å±‚ä¸€å±‚åˆ°å®¹å™¨ã€‚

> Qï¼šè¶…é…çš„æƒ…å†µä¸‹ï¼Œå¦‚æžœå„ä¸ª pod load éƒ½å¢žå¤§ï¼Œé©±é€ç­–ç•¥æ˜¯æ€Žæ ·çš„ï¼Ÿ

Aï¼šè¿™é‡Œæˆ‘æ²¡æœ‰è®²ç»†ï¼Œä½ çš„é—®é¢˜å¾ˆä»”ç»†å•Šï¼Œèµžï¼Œæˆ‘ä»¬å¼€å‘äº†çƒ­ç‚¹è¿ç§»å®¹å™¨çš„ APIï¼Œç›‘æŽ§ç³»ç»Ÿå¦‚æžœæ”¶åˆ°å‘Šè­¦ï¼ˆæ¯”å¦‚ CPU è¿‡é«˜ï¼ŒIO è¿‡é«˜ï¼‰ï¼Œä¼šè°ƒç”¨æˆ‘ä»¬ API ï¼Œæˆ‘ä»¬ API èŽ·å–å®žæ—¶çš„ç›‘æŽ§æ•°æ®ï¼Œæ ¹æ®æŸä¸ªç®—æ³•ï¼Œè¿ç§»èµ°éƒ¨åˆ†çƒ­ç‚¹å®¹å™¨ã€‚

> Qï¼šè‡ªåŠ¨ç¼©å®¹çš„æ—¶å€™æ˜¯å¦‚ä½•é€‰æ‹© Podï¼Œå¦‚ä½•ä¿è¯æ•°æ®ä¸ä¸¢å¤±å‘¢ï¼Ÿ

Aï¼šè‡ªåŠ¨ç¼©å®¹ä¹‹é’ˆå¯¹æ— çŠ¶æ€åº”ç”¨çš„ï¼Œè€Œä¸”æˆ‘ä»¬è¦æ±‚æ‰€æœ‰ä¸Šäº‘å¹³å°çš„åº”ç”¨ï¼Œéƒ½æ”¯æŒ Graceful Shutdownï¼Œç”±ä¸šåŠ¡ä¿è¯ã€‚

> Qï¼šTomcat ç±»åº”ç”¨å®¹å™¨ Xmx å†…å­˜åˆ†é…å¤šå°‘æ¯”ä¾‹åˆé€‚ï¼Œå°±æ˜¯ Xmx ä½¿ç”¨ç™¾åˆ†å¤šå°‘å®¹å™¨å†…å­˜åˆé€‚ï¼Ÿ

Aï¼šJVM å†…å­˜çš„è®¡ç®—åŒ…æ‹¬äº† Heapï¼‹Permgenï¼‹ çº¿ç¨‹æ•°çš„ stackï¼ˆ1Mï¼per çº¿ç¨‹ï¼‰ï¼‹ å †å¤–å†…å­˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›‘æŽ§å®¹å™¨çš„ RSS æ•°æ®ï¼Œè¿™æ˜¯å®¹å™¨çœŸå®žçš„å†…å­˜å ç”¨ã€‚

> Qï¼šé›†ç¾¤ç©ºé—²çŽ‡å¤šå°‘åˆé€‚ï¼Ÿæˆ‘ä»¬çš„é›†ç¾¤è¶…è¿‡ 60% ä¸Šé¢çš„å®¹å™¨å°±ä¸ç¨³å®šäº†ã€‚

Aï¼šæˆ‘ä»¬ä¸ºäº†æé«˜èµ„æºåˆ©ç”¨çŽ‡ï¼Œåšäº†å¾ˆå¤šäº‹æƒ…ï¼Œä¸Šé¢æœ‰è¯´åˆ°ï¼Œä½ è¯´çš„ 60% å°±ä¸ç¨³å®šï¼Œéœ€è¦å…·ä½“åˆ†æžä¸‹ï¼Œå› ä¸ºæˆ‘ä»¬ä¹Ÿè¸©è¿‡ä¸€äº› Kubernetes å’Œ Docker çš„å‘ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦ä¼˜åŒ–å¥½ç³»ç»Ÿå‚æ•°ï¼Œæœ‰æ—¶å€™é—®é¢˜ä¹Ÿè·Ÿå†…æ ¸ç‰ˆæœ¬æœ‰å…³ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2018 å¹´ 9 æœˆ 18 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**çŽ‹å¿—é›„ï¼Œå”¯å“ä¼šäº‘å¹³å°æž¶æž„å¸ˆï¼Œå‚ä¸Žå·¥ä½œ 15+ï¼Œå…¶ä¸­ 10 å¤šå¹´åœ¨äº¿è®¯ï¼ˆä¸­å›½ç”µä¿¡ï¼‰ï¼Œçˆ±ç«‹ä¿¡å‚ä¸Žç”µä¿¡é¢†åŸŸäº§å“å¼€å‘ç ”ç©¶å·¥ä½œï¼Œ4 å¹´å‰åŠ å…¥å”¯å“ä¼šåŸºç¡€æž¶æž„éƒ¨ï¼Œä¸»è¦è´Ÿè´£æœåŠ¡åŒ–å¹³å°ï¼ˆå”¯å“ä¼š OSPï¼‰çš„ç ”å‘å’ŒæŽ¨å¹¿è½åœ°å·¥ä½œï¼ŒOSP çŽ°å·²ç»æ˜¯å”¯å“ä¼šä¸»æµçš„æœåŠ¡åŒ–æ¡†æž¶ã€‚17 å¹´å¼€å§‹äº‘å¹³å°äº§å“ç›¸å…³å·¥ä½œï¼ŒçŽ°æ˜¯å”¯å“ä¼šäº‘å¹³å°æž¶æž„å¸ˆï¼Œä¸»è¦è´Ÿè´£å”¯å“ä¼š Noah äº‘å¹³å°çš„äº§å“ç ”å‘å’ŒæŽ¨å¹¿è½åœ°å·¥ä½œï¼ŒNoah äº‘å¹³å°å·²ç»æŽ¥å…¥äº†å¤§éƒ¨åˆ†æ ¸å¿ƒåŸŸå’Œå…¶ä»–ä¸šåŠ¡åŸŸï¼Œå¹¶é¡ºåˆ©æ‰¿è½½äº†å…¬å¸çš„å¤šæ¬¡å¤§ä¿ƒ**ã€‚

---

### 2018-09-09ï¼šgVisor æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

> Qï¼šgVisor æ˜¯ yet another containerï¼ŒgVisor = Kata Linux çš„éš”ç¦»æ€§ + Docker çš„éš”ç¦»ä½Žæ¶ˆè€—ï¼Œå¯ä»¥è¿™æ ·ç†è§£å—ï¼Ÿ

Aï¼šåŸºæœ¬ä¸Šå¯ä»¥è¿™æ ·ç†è§£ï¼Œçœ‹ä¸šç•Œå¯¹ gVisor çš„è¯„ä»·æ™®éè®¤ä¸ºéš”ç¦»æ€§ä¸Žè™šæ‹Ÿæœºæ–¹æ¡ˆçš„éš”ç¦»æ€§ç›¸å½“ï¼Œä½†ä¹Ÿæœ‰äººé¡¾è™‘æ˜¯å¦çœŸèƒ½æä¾›åˆ°è¿™ä¹ˆé«˜çš„éš”ç¦»æ€§ï¼Œä¸ªäººè§‰å¾—éœ€è¦æ—¶é—´æ¥è¯æ˜Žã€‚å…³äºŽä½ŽæŸè€—æˆ‘è§‰å¾—å¾—çœ‹ä¸šåŠ¡çš„åœºæ™¯ï¼Œç›®å‰æ¥è¯´å¯¹äºŽé«˜æ€§èƒ½çš„åœºæ™¯æˆ‘è§‰å¾—æ˜¯ä¸åˆé€‚çš„ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2018 å¹´ 9 æœˆ 4 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**çŽ‹é‡å±±ï¼Œæ·±åœ³ç±³ç­ç§‘æŠ€æœ‰é™å…¬å¸è¿ç»´æ€»ç›‘ã€‚2014 å¹´åº•åŠ å…¥ç±³ç­ï¼Œå…ˆåŽå‚ä¸Žç±³ç­åœ¨çº¿å¹³å°ä»¥åŠè¿ç»´ç³»ç»Ÿçš„å»ºè®¾ï¼Œåœ¨è¿ç»´ä½“ç³»å»ºè®¾æœŸé—´è°ƒç ”å’Œè½åœ°äº†å®¹å™¨ç›¸å…³æŠ€æœ¯**ã€‚

---

### 2018-08-25ï¼šæœ‰è´§åŸºäºŽ Kubernetes å®¹å™¨çŽ¯å¢ƒçš„æŒç»­äº¤ä»˜å®žè·µ

> Qï¼šä¸ºä»€ä¹ˆæ²¡æœ‰å’Œ CI ç»“åˆåœ¨ä¸€èµ·ï¼Ÿä½¿ç”¨è¿™ä¸ªæ¯”è¾ƒé‡çš„ Spannaker æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ

Aï¼šå¯ä»¥å’Œ CI è¿›è¡Œç»“åˆï¼Œæ¯”å¦‚ Webhook çš„æ–¹å¼ï¼Œæˆ–è€…é‡‡ç”¨ Jenkins è°ƒåº¦çš„æ–¹å¼ã€‚ä¼˜åŠ¿åœ¨äºŽå¯ä»¥å’Œå¾ˆå¤šäº‘å¹³å°è¿›è¡Œç»“åˆï¼Œè€Œä¸”ä»–çš„ Pipeline æ¯”è¾ƒçš„å®Œç¾Žï¼Œå‚æ•°åŒ–ç¨‹åº¦å¾ˆé«˜ã€‚

> Qï¼šç›®å‰ IaaS åªæ”¯æŒ OpenStack å’Œå›½å¤–çš„å…¬æœ‰äº‘åŽ‚å•†ï¼Œå›½å†…çš„äº‘æœåŠ¡å•†å¦‚æžœè¦æ”¯æŒçš„è¯ï¼Œåº•å±‚éœ€è¦æ€Žä¹ˆåšå‘¢ï¼ˆç®¡ç†äº‘ä¸»æœºè€Œä¸æ˜¯å®¹å™¨ï¼‰ï¼Ÿè‡ªå·±å®žçŽ°çš„è¯å®¹æ˜“å—ï¼Ÿæ€Žä¹ˆå…¥æ‰‹ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬ä¸»è¦ä½¿ç”¨ Spinnaker ç”¨æ¥ç®¡ç†å®¹å™¨è¿™éƒ¨åˆ†çš„å†…å®¹ï¼Œå¯¹äºŽå›½å†…çš„äº‘åŽ‚å•† Spinnaker æ”¯æŒéƒ½ä¸æ˜¯éžå¸¸çš„å¥½ï¼Œåƒ LBï¼Œå®‰å…¨ç­–ç•¥è¿™äº›éƒ½ä¸å¯åœ¨ Spinnaker ä¸Šé¢æŽ§åˆ¶ã€‚è‹¥æ˜¯éœ€è¦ç ”ç©¶å¯ä»¥æŸ¥çœ‹ Cloud driver è¿™ä¸ªç»„ä»¶çš„åŠŸèƒ½ã€‚

> Qï¼šSpinnaker èƒ½ä¸èƒ½åœ¨ Pipeline é‡Œé€šè¿‡ http API èŽ·å–ä¸€ä¸ª deployment yaml è¿›è¡Œ deployï¼Œè¿™ä¸ª yaml å¯èƒ½æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Ÿ

Aï¼šéƒ¨ç½²æœåŠ¡æœ‰ä¸¤ç§æ–¹å¼ï¼š1. åœ¨ Spinnaker çš„ UI ä¸­ç›´æŽ¥å¡«å…¥ Manifest Sourceï¼Œå…¶å®žå°±æ˜¯å¯¹åº”çš„ deployment YAMLï¼Œåªä¸è¿‡è¿™é‡Œå¯ä»¥å†™å…¥ Pipeline çš„å‚æ•°ï¼›2. å¯ä»¥ä»Ž GitHub ä¸­æ‹‰å–å¯¹åº”çš„æ–‡ä»¶ï¼Œæ¥éƒ¨ç½²ã€‚

> Qï¼šSpannaker çš„å®‰å…¨æ€§æ–¹é¢æ€Žä¹ˆæŽ§åˆ¶ï¼Ÿ

Aï¼šSpinnaker ä¸­ Fiat æ˜¯é‰´æƒçš„ç»„ä»¶ï¼Œé…ç½®æƒé™ç®¡ç†ï¼ŒAuthã€SAMLã€LDAPã€GitHub teamsã€Azure Groupsã€ Google Groupsï¼Œæˆ‘ä»¬å°±é‡‡ç”¨ LDAPï¼Œç™»é™†åŽä¼šåœ¨ä¸Šé¢æ˜¾ç¤ºå¯¹åº”çš„ç™»é™†äººå‘˜ã€‚

> Qï¼š deploy å’Œ test ä»¥åŠ rollback å¯ä»¥è·Ÿ helm chart é›†æˆå—ï¼Ÿ

Aï¼šæˆ‘è§‰å¾—æ˜¯å¯ä»¥ï¼Œå¾ˆç¬¨çš„æ–¹æ³•æœ€ç»ˆéƒ½æ˜¯å¯ä»¥å€ŸåŠ©äºŽ Jenkins æ¥å®žçŽ°ï¼Œä½†æ˜¯ Spinnaker çš„å›žæ»šä¸Žéƒ¨ç½²æŠ€æœ¯å¾ˆå¼ºå¤§ï¼Œåœ¨é¡µé¢ä¸Šç‚¹å‡»å°±å¯ä»¥è¿›è¡Œå¿«é€Ÿçš„ç‰ˆæœ¬å›žæ»šä¸Žéƒ¨ç½²ã€‚

> Qï¼šSpannaker ä¹‹å‰çš„æˆªå›¾çœ‹åˆ°ä¹Ÿæœ‰å¯¹éƒ¨åˆ†ç”¨æˆ·å¼€å‘çš„åŠŸèƒ½ï¼Œç”¨ Spannaker ä¹‹åŽè¿˜éœ€è¦ Istio å—ï¼Ÿ

Aï¼šè¿™ä¸¤ä¸ªæœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œã€å¯¹éƒ¨åˆ†ç”¨æˆ·å¼€å‘çš„åŠŸèƒ½ã€‘è¿™ä¸ªæ˜¯ä¾é åˆ›å»ºä¸åŒçš„ service ä»¥åŠ Ingress æ¥å®žçŽ°çš„ï¼Œä»–çš„è·¯ç”±èƒ½åŠ›è‚¯å®šæ²¡æœ‰ Istio å¼ºæ‚ï¼Œè€Œä¸”ä¹Ÿä¸å…·å¤‡ç†”æ–­ç­‰ç­‰çš„æŠ€æœ¯ï¼Œæˆ‘ä»¬çº¿ä¸‹è¿™ä¹ˆåˆ›å»ºä¸»è¦ä¸ºäº†æ–¹ä¾¿å¼€å‘äººå‘˜è¿›è¡Œå¿«é€Ÿçš„éƒ¨ç½²ä¸Žè°ƒè¯•ã€‚

---

### 2018-08-13ï¼šåŸºäºŽ Spring Cloud çš„å¾®æœåŠ¡å®¹å™¨åŒ–å®žè·µ

> Qï¼šWSO2 çš„ APIManager ä¼šå°†æ‰€æœ‰æµé‡éƒ½ç»Ÿä¸€åˆ°ä»–è¿™é‡Œè¿›å‡ºï¼Œå¦‚ä½•è§£å†³ç»Ÿä¸€ API ç½‘å…³çš„å¤§æµé‡é—®é¢˜ï¼Ÿ

Aï¼šAPI Manager æ˜¯å¯ä»¥æ‹†å¼€çš„ï¼Œåˆ†å¼€éƒ¨ç½²ï¼Œæ¯”å¦‚è°ƒç”¨ä½ æŽ¥å£èµ°ç½‘å…³æ¨¡å—ï¼Œå¯ä»¥åšé«˜å¯ç”¨ã€‚å½“ç„¶ä¸æ‹†å¼€ä¹Ÿå¯ä»¥åšé«˜å¯ç”¨ï¼Œå‰é¢åŠ è´Ÿè½½å‡è¡¡ã€‚

> Qï¼šEureka åœ¨ç”Ÿäº§ä¸Šçš„ Kubernetes ä¸­æ˜¯å¦‚ä½•åšåˆ°é«˜å¯ç”¨å’ŒåŠ¨æ€æ‰©å®¹çš„ï¼Ÿ

A ï¼šå¥½é—®é¢˜ï¼ŒEureka æˆ‘ä»¬ç›®å‰æ˜¯æŒ‡å®šæ•°é‡ï¼Œå¯ä»¥ç»“åˆè„šæœ¬ï¼ˆæˆ–ä»£ç ï¼‰åšåŠ¨æ€æ‰©å®¹å’Œé«˜å¯ç”¨ã€‚ç›®å‰æˆ‘ä»¬ Hadoop å°±æ˜¯ç»“åˆä»£ç åšåˆ°çš„ã€‚

> Qï¼šæœåŠ¡ä¹‹é—´äºŒé˜¶æ®µäº‹åŠ¡æŽ§åˆ¶ä¸€èˆ¬æ€Žä¹ˆåšï¼Ÿæˆ–è€…è¯´æœ‰æ²¡æœ‰çŽ°æˆå·¥å…·æˆ–ä»£ç ï¼ŸæœåŠ¡é—´ç”¨ http é è°±è¿˜æ˜¯å…¶ä»–åè®®é è°±ï¼Ÿ

Aï¼šè¿™ä¸ªç½‘ä¸Šæœ‰ä¸€äº›æ€è·¯æ¯”å¦‚è¡¥å¿çš„æ–¹å¼ï¼Œè¿˜æœ‰å°±æ˜¯é€šè¿‡æµæ•°æ®åº“ï¼ˆKafkaï¼‰ï¼Œäº‹ä»¶é©±åŠ¨çš„æ–¹å¼ã€‚æˆ‘ä»¬ç›®å‰æ­£åœ¨å°è¯•è¿™ç§æ–¹å¼ã€‚

---

### 2018-08-11ï¼šæ»´æ»´å¼¹æ€§äº‘ Kubernetes å®žè·µ

> Qï¼šåˆ©ç”¨ cgroup v2 çš„ blk-throttle å®žçŽ°å¯¹éž driect io åœºæ™¯ä¸‹çš„ç£ç›˜è¯»å†™é€Ÿåº¦éš”ç¦»ï¼Œè¿™ä¸ªæ€Žä¹ˆåšçš„ï¼ŒKubernetes æ”¯æŒå—ï¼Ÿ

Aï¼šå¦‚æžœæ˜¯ 3 çš„å†…æ ¸ï¼Œé‚£ä¹ˆåªæ”¯æŒ cgroup v1ï¼Œv1 åªæ”¯æŒå¯¹ driect io çš„ç£ç›˜è¯»å†™é™åˆ¶ï¼Œè€Œæˆ‘ä»¬çŸ¥é“å¤§å¤šæ•°æƒ…å†µä¸‹çš„å†™ç£ç›˜éƒ½æ˜¯å…ˆå†™åˆ°å†…å­˜é‡Œå† FLUSH åˆ°ç£ç›˜ä¸Šï¼Œæ‰€ä»¥è¦é™åˆ¶çš„æ˜¯ä»Žå†…å­˜åˆ°ç£ç›˜çš„è¿™ä¸ªçŽ¯èŠ‚ã€‚4 çš„å†…æ ¸æ”¯æŒ cgroup v2ï¼Œè¿™ä¸ªåŠŸèƒ½å·²ç»æ¯”è¾ƒæˆç†Ÿï¼Œä½ å¯ä»¥å°è¯•å‡çº§å†…æ ¸æˆ–è€…å°† v2 çš„åŠŸèƒ½ç§»æ¤åˆ° v1 ä¸Šã€‚

> Qï¼šæ˜¯è¦ä¿®æ”¹ dockerd çš„é…ç½®ï¼Œè¿˜æ˜¯åœ¨ Kubernetes ä¸Šæ‰©å±•ï¼Ÿ

Aï¼šå¦‚æžœæ˜¯æŽ¥ç€ä¸Šé¢çš„é—®é¢˜çš„è¯ï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨äº†ä¸€ä¸ª Agent çš„æ–¹å¼ï¼Œå•ç‹¬çš„åšåŠ å¼ºçš„èµ„æºéš”ç¦»çš„ï¼Œæ²¡æœ‰åœ¨ Kubernetes ä¸Šåšæ‰©å±•ã€‚

> Qï¼šDGW æ˜¯åŸºäºŽä»€ä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šDGW å…¶å®žå°±æ˜¯ LVSï¼Œæˆ‘ä»¬è¿™è¾¹çš„ç³»ç»Ÿç»„å®žçŽ°äº†é€šè¿‡æŽ¥å£çš„æ–¹å¼åŠ¨æ€çš„å˜æ›´ LVS é…ç½®çš„èƒ½åŠ›ã€‚

> Qï¼šå®¹å™¨ç½‘ç»œå’Œç‰©ç†ç½‘ç»œç±»åž‹ä¸€æ ·ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆç½‘ç»œï¼ŸåŽŸæœ‰çš„ ONOS SDN ç½‘ç»œè¿˜æœ‰ç”¨å—ï¼Ÿä¸åŒ name space ä¹‹é—´éš”ç¦»æ€Žä¹ˆåšï¼Ÿ

Aï¼šè€çš„é›†ç¾¤ä½¿ç”¨ SDN ç½‘ç»œï¼Œæ–°é›†ç¾¤ä½¿ç”¨ç‰©ç†ç½‘ç»œã€‚æ‰€è°“ç‰©ç†ç½‘ç»œå°±æ˜¯å’Œç‰©ç†æœºåŒä¸€ä¸ªç½‘ç»œï¼Œåªä¸è¿‡æ¯ä¸ª tor ä¸‹åˆ’åˆ†å‡ºä¸€æ®µä¸“é—¨ç»™å®¹å™¨åˆ†é…ä½¿ç”¨ã€‚

> Qï¼šè¯·é—®ä¸‹"åˆ©ç”¨ tc å®žçŽ°å¯¹å®¹å™¨ç½‘ç»œå¸¦å®½çš„é™åˆ¶"ï¼Œå…·ä½“æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šå‚è€ƒç‰©ç†æœºä½¿ç”¨ tc å¯¹å®¹å™¨åšç½‘ç»œæµé‡é™åˆ¶ï¼Œå¦‚æžœä½ ç”¨äº† SDN ç½‘ç»œ DPDK/OVS ä»€ä¹ˆçš„ï¼Œé™é€Ÿå°±æ›´æ–¹ä¾¿äº†ã€‚

> Qï¼šæ»´æ»´çš„å·ç®¡ç†æ˜¯æ€Žä¹ˆè®¾è®¡çš„ï¼Ÿæœ‰çŠ¶æ€æœåŠ¡æ€Žä¹ˆè®¾è®¡è°ƒåº¦ï¼Œæ¥ä¿è¯æ•°æ®æŒä¹…åŒ–çš„ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬è¿™è¾¹æœ‰çŠ¶æ€æœåŠ¡éžå¸¸å¤šï¼Œæ— çŠ¶æ€éžå¸¸å°‘ï¼Œç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯è¿˜æ˜¯å’Œç‰©ç†æœºè¶‹åŒï¼Œå¯¹äºŽè¿™éƒ¨åˆ†"è€æ´¾"çš„ç”¨æˆ·æˆ‘ä»¬æä¾›äº†ç±»ä¼¼è™šæ‹Ÿæœºè¿™æ ·çš„å®¹å™¨ã€‚ä½¿ç”¨æœ¬åœ°å·ï¼ˆhostpathï¼‰ï¼Œå®¹å™¨åªèƒ½æœ¬åœ°é‡å»ºä¸å¯è·¨å®¿ä¸»æ¼‚ç§»ã€‚è¿™ä¹Ÿæ˜¯å¯¹ä¸šåŠ¡çš„ä¸€ç§å¦¥åã€‚å¦å¤–æˆ‘ä»¬ä¹Ÿä½¿ç”¨è¿‡ cephï¼Œä½†æ˜¯æœ€åŽè¯„ä¼°é£Žé™©æ›´å¤§ï¼Œæ•…æš‚æ—¶æ”¾å¼ƒä½¿ç”¨ï¼Œæˆ–å°èŒƒå›´ä½¿ç”¨ã€‚

> Qï¼šé€šè¿‡è´Ÿè½½å‡è¡¡çš„å¥åº·æ£€æŸ¥æµ‹è¯•æœåŠ¡å¯ç”¨æ€§ï¼Œå¥åº·æ£€æŸ¥çš„å‘¨æœŸå†…ï¼Œå¦‚ä½•ä¿è¯æµé‡ä¸ä¸¢å¤±ï¼Ÿ

Aï¼šæˆ‘ä»¬è¿™è¾¹ LVS é»˜è®¤æœ‰ 7 ç§’çš„æŽ¢æ´»é—´éš”ï¼Œåœ¨ 7 ç§’çš„é—´éš”å†…å¦‚æžœå®¹å™¨æ•…éšœä¸å¯ç”¨é‚£ä¹ˆç¡®å®žä¼šæœ‰æµé‡çš„ä¸¢å¤±ï¼Œç›®å‰ä¸å¯é¿å…ã€‚

> Qï¼šå®¹å™¨çš„ä¼˜é›…ä¸‹çº¿æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¹‹å‰çš„å®¹å™¨å¯åŠ¨éƒ½æ˜¯ç”¨ Supervisor æ‰˜ç®¡çš„ï¼ŒåŽæ¥æˆ‘ä»¬è‡ªå·±å†™äº†ä¸€ä¸ª dockerinitï¼Œç”¨äºŽç”¨æˆ·ä¸šåŠ¡æœåŠ¡çš„å¯åœï¼Œä»–çš„åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§èƒ½æ‰§è¡Œå•ç‹¬çš„ä¸€æ¬¡æ€§ç¨‹åºï¼ˆç±»ä¼¼ç‰©ç†æœºçš„ rc.localï¼‰ï¼Œä¹Ÿèƒ½æ‰˜ç®¡è¿›ç¨‹ã€‚äºŽæ­¤åŒæ—¶ä»–ä¼šä¿è¯å®¹å™¨æ‰€æœ‰çš„ä¸šåŠ¡è¿›ç¨‹é€€å‡ºåŽå†é”€æ¯å®¹å™¨ï¼Œé¿å…ç²—æš´çš„åœæ­¢å®¹å™¨ã€‚

> Qï¼šæœ‰æ²¡æœ‰ä½¿ç”¨ cpu_quota æ¥åšç²¾ç»†çš„é™åˆ¶å‘¢ï¼ŸCPU request ç»‘å®š CPUï¼Œè¶…åˆ†çš„æƒ…å†µæ€Žä¹ˆå¤„ç†å‘¢ï¼Ÿ

Aï¼šä½ æƒ³é—®çš„å…¶å®žæ˜¯è¶…å”®çš„é—®é¢˜ï¼Œå‚è€ƒä¸šå†…ä¸€äº›èµ°åœ¨å‰é¢çš„å¤§åŽ‚ï¼Œæˆ‘ä»¬çš„å®¹å™¨ä¼šæ ¹æ®å®¹å™¨çš„æœåŠ¡ç­‰çº§åšé€‚å½“çš„è¶…å”®ï¼Œè¿™æ ·ä¸€ä¸ª 48 æ ¸çš„å®¿ä¸»å°±èƒ½æ‰¿è½½æ›´å¤šçš„å®¹å™¨ã€‚è¿™é‡Œé¢çš„ç»†èŠ‚æ¯”è¾ƒå¤šï¼Œè¿™é‡Œä¸å¤ªå¥½æè¿°ã€‚

> Qï¼šæˆ‘ä»¬åœ¨è¿ç»´è¿‡ç¨‹ä¸­å‘çŽ°ï¼šæŸäº›é…ç½®äº†æŽ¢é’ˆçš„å®¹å™¨å› ä¸ºæœåŠ¡æ²¡æœ‰æˆåŠŸå¯åŠ¨è€Œä¸æ–­çš„è¢« Kubernetes æ€æŽ‰é‡å»ºï¼Œåœ¨é‡å»ºè¶…è¿‡å‡ ç™¾æˆ–æ•°åƒæ¬¡ä¹‹åŽä¼šå¶å‘æ€§çš„å¯¼è‡´å®¿ä¸»çš„ä¸€äº›å¼‚å¸¸ã€‚è¿™ä¸ªé—®é¢˜çš„åŽŸå› æˆ‘ä»¬å°šæœªæŸ¥æ˜Žï¼Œä½†æ˜¯è¿™ç§å®¹å™¨ä¸æ–­çš„é‡å»ºæœ¬èº«å°±æ˜¾å¾—æ²¡æœ‰æ„ä¹‰ï¼Œå†åŠ ä¸Šæˆ‘ä»¬ä½¿ç”¨äº†è‡ªç ”çš„æœåŠ¡å‘çŽ°ï¼Œæ‰€ä»¥å°±å¯¹æ¯ä¸ªå®¹å™¨çš„é‡å¯æ¬¡æ•°åšäº†é™åˆ¶ï¼Œè®©è´Ÿè½½å‡è¡¡å±‚åŽ»åšå¥åº·æ£€æŸ¥ã€‚

Aï¼šå¯åŠ¨ä¸Šç™¾ä¸ª Pod ä»¥åŽæˆ‘ä¹Ÿé‡è§è¿‡è¿™ä¸ªé—®é¢˜ï¼ŒåŽæ¥æŽ’æŸ¥é—®é¢˜å‘çŽ°æ˜¯ docker docker\_storage çš„ overlay å’Œ overlay2 æ²¡æœ‰ä½¿ç”¨ xfs æ–‡ä»¶ç³»ç»Ÿå¯¼è‡´ï¼Œä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰ç ”ç©¶ io çš„é—®é¢˜ã€‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ overlayfs2ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­éªŒè¯è¿‡ï¼Œè¿˜æ˜¯æ¯”è¾ƒé è°±çš„ã€‚å¦‚æžœä½ æ˜¯ä½Žç‰ˆæœ¬çš„ Docker çš„è¯ï¼Œéœ€è¦åŠ ä¸€ä¸ªå‚æ•°å°±èƒ½ä½¿ç”¨ overlayfs2 äº†ã€‚æœ‰æ²¡æœ‰è°ƒç ”è¿‡ RedHat çš„ OpenShiftï¼Œæ„Ÿè§‰ç½‘ä¸Šæ–‡æ¡£å¾ˆå…¨ä¹Ÿè§£å†³äº†å¾ˆå¤šé—®é¢˜ï¼Œå¬è¯´å°ç±³åœ¨ç”¨ï¼Œä½†æ˜¯ä½ çŸ¥é“åŸºç¡€æž¶æž„æ˜¯ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«çš„ï¼Œä¸èƒ½è½»æ˜“å˜åŒ–ã€‚

---

### 2018-07-29ï¼šåŸºäºŽ GitLab çš„ CI å®žè·µ

> Qï¼šæ‚¨æåˆ°æŠŠå„ç§ä¾èµ–éƒ½ä»¥ Service çš„æä¾›ï¼Œè¯·é—®æ˜¯ä»¥å“ªç§æ–¹å¼å‘¢ï¼Ÿæ¯”å¦‚ Python çš„ä¾èµ–ï¼Œæ€Žä¹ˆåšæˆ Service å‘¢ï¼Ÿ

Aï¼šService åŒ–çš„ä¾èµ–ï¼Œä¸»è¦æ˜¯æŒ‡ç±»ä¼¼ DB / MySQL/ Reids ä¹‹ç±»çš„ã€‚ æˆ–è€…æ˜¯ dind å…¶å®žå®ƒæä¾›çš„æ˜¯ 2375 ç«¯å£çš„ TCP æœåŠ¡ã€‚ Python çš„ä¾èµ–ï¼Œæˆ‘æŽ¨èçš„åšæ³•æ˜¯ï¼Œ æž„å»ºä¸€ä¸ªæ¢äº†æºçš„ Python é•œåƒã€‚ å®‰è£…ä¾èµ–çš„æ—¶å€™ï¼Œè€—æ—¶ä¼šå°‘å¾ˆå¤šã€‚ æˆ–è€…è¯´ï¼Œ å¯ä»¥åœ¨å®šä¹‰ Pipeline çš„æ—¶å€™ï¼Œ å°†è™šæ‹ŸçŽ¯å¢ƒçš„ venv æ–‡ä»¶å¤¹ä½œä¸º cache ï¼Œä¹‹åŽçš„å®‰è£…ä¹Ÿä¼šæ£€æŸ¥è¿™ä¸ªï¼Œé¿å…ä¸å¿…è¦çš„å®‰è£…ã€‚

> Qï¼šè¯·é—®ï¼Œä½ ä»¬ä¸ºä»€ä¹ˆä¸ç”¨ Jenkins Pipelineï¼Œè€Œä½¿ç”¨ GitLab CIï¼Ÿ

Aï¼šä¸»è¦åŽŸå› æ˜¯æˆ‘æåˆ°çš„é‚£å‡ ä¸ªæ–¹é¢ã€‚ é›†æˆè¾ƒå¥½ï¼Œ ç•Œé¢ç¾Žè§‚ä¼˜é›…ï¼Œ ä½¿ç”¨ç®€å•ï¼ˆæ‰€æœ‰æœ‰ä»“åº“å†™æƒé™çš„äºº éƒ½å¯ä»¥ä½¿ç”¨ï¼Œ åªè¦åˆ›å»º .gitlab-ci.yml å¹¶ä¸”é…ç½®äº† Runner å³å¯ä½¿ç”¨ï¼‰ ã€‚æ¢ä¸ªè§’åº¦ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä½¿ç”¨ Jenkins çš„é—®é¢˜ï¼Œ Jenkins å¯¹äºŽé¡¹ç›®çš„é…ç½®å…¶å®žå’Œ GitLab çš„ä»£ç æ˜¯åˆ†ç¦»çš„ï¼Œ ä¸¤éƒ¨åˆ†çš„ï¼Œ ç”¨æˆ·ï¼ˆæˆ–è€…è¯´æˆ‘ä»¬çš„å¼€å‘è€…ï¼‰åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œ éœ€è¦æœ‰ä¸¤ä¸ªå¹³å°ï¼Œ å¹¶ä¸”ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œ Jenkins çš„æƒé™æ˜¯ä¸æ”¾å¼€çš„ã€‚ å¯¹ç”¨æˆ·æ¥è®²ï¼Œ é‚£ç›¸å½“äºŽæ˜¯ä¸ªé»‘ç›’ã€‚ é‚£å¯èƒ½çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ é‡åˆ°æž„å»ºå¤±è´¥äº†ï¼Œ ä½†æ˜¯åªæœ‰è¿ç»´çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½†æ˜¯ç ”å‘æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºæ²¡æœ‰æƒé™ã€‚ ä½¿ç”¨ GItLab çš„å¥½å¤„ï¼Œè¿™ä¸ªæ—¶å€™å°±æ›´åŠ çªå‡ºäº†ï¼Œ é…ç½®å°±åœ¨ä»£ç ä»“åº“é‡Œé¢ï¼Œå¹¶ä¸”ä½¿ç”¨ YAML çš„é…ç½®ï¼Œå¾ˆç®€å•ã€‚ æœ‰å•¥é—®é¢˜ï¼Œç›´æŽ¥æŸ¥ï¼Œç›´æŽ¥æ”¹ã€‚

> Qï¼šå…³äºŽ Runner çš„æ¸…ç†çš„é—®é¢˜ï¼Œåœ¨é•¿æ—¶é—´ä½¿ç”¨åŽï¼ŒRunner æœºå™¨ä¸Šå›žäº§ç”Ÿå¾ˆå¤šçš„ Cache å®¹å™¨ï¼Œå¦‚ä½•æ¸…ç†å‘¢ã€‚èƒ½å¤Ÿåœ¨ä»»åŠ¡ä¸­è‡ªåŠ¨æ¸…é™¤å—ï¼Ÿ

Aï¼šè¿™ä¸ªå°±ç›¸å¯¹ç®€å•äº†ï¼Œé¦–å…ˆï¼Œ å¦‚æžœä½ çš„ Cache å®¹å™¨ç¡®è®¤æ²¡ç”¨äº†ï¼Œ æ¯ä¸ª Cache å®¹å™¨å…¶å®žéƒ½æœ‰åå­—çš„ï¼Œ ç›´æŽ¥æŒ‰ Cache çš„åå­—è¿‡ç•¥ï¼Œ æ‰¹é‡åˆ æŽ‰ã€‚ å¦‚æžœä½ ä¸ç¡®å®šå®ƒæ˜¯å¦æœ‰ç”¨ï¼Œé‚£ä½ ç›´æŽ¥åˆ æŽ‰ä¹Ÿæ˜¯ä¸å½±å“çš„ï¼Œ å› ä¸º Docker Excutor çš„æ‰§è¡Œæœºåˆ¶æ˜¯åˆ›å»ºå®Œ Service å®¹å™¨åŽï¼Œ åˆ›å»º Cache å®¹å™¨ã€‚ è¦æ˜¯åˆ æŽ‰äº†ï¼Œå®ƒåªæ˜¯ä¼šå†åˆ›å»ºä¸€æ¬¡ã€‚ å¦‚æžœä½ æƒ³åœ¨ä»»åŠ¡ä¸­æ¸…é™¤ï¼Œ ç›®å‰è¿˜æ²¡åšç›¸å…³çš„å®žè·µï¼Œå¾…æˆ‘å®žè·µåŽï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¾ˆä¼˜é›…çš„æ–¹å¼ã€‚

> Qï¼šè¯·é—®ä¸‹ Maven çš„ settings.xml æ€Žä¹ˆå¤„ç†ï¼Ÿæœ¬åœ° Maven ä»“åº“å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬æž„å»ºäº†ç§æœ‰çš„ Maven é•œåƒï¼Œ ç§æœ‰é•œåƒä¸­æ˜¯é»˜è®¤ä½¿ç”¨äº†æˆ‘ä»¬çš„ç§æœ‰æºã€‚ å¯¹äºŽé¡¹ç›®ä¸­ç”¨æˆ·æ— éœ€å…³æ³¨ settings.xml ä¸­æ˜¯å¦é…ç½® repoã€‚

> Qï¼šåœ¨ GitLab çš„ CD æ–¹æ¡ˆä¸­ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å˜é‡ä¸­é…ç½®è·³æ¿æœºçš„ç§é’¥ï¼Œå¦‚æžœè¿™ä¸ªé¡¹ç›®æ˜¯å¯¹å…¬å¸æ•´éƒ¨é—¨å¼€å‘ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿æŠ¤è¿™ä¸ªç§é’¥å‘¢ï¼Ÿ

Aï¼šå¯ä»¥ä½¿ç”¨ secret variable å°†ç§é’¥å†™å…¥å…¶ä¸­ï¼Œ ï¼ˆä½†æ˜¯é¡¹ç›®çš„ç®¡ç†å‘˜ï¼Œå…·å¤‡æŸ¥çœ‹è¯¥ variable çš„æƒé™ï¼‰å¼€å‘ä¸€ä¸ª web server ï¼ˆå…¶å®žåªè¦æš´éœ² IP ç«¯å£ä¹‹ç±»çš„å°±å¯ä»¥ï¼‰ åœ¨ CI æ‰§è¡Œçš„è¿‡ç¨‹ä¸­åŽ»è¯·æ±‚ï¼Œ server å¯¹æ¥æºåšåˆ¤æ–­ ï¼ˆæ¯”å¦‚ æ‰§è¡Œ CI çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€äº›ç‰¹å®šçš„å˜é‡ï¼Œä»¥æ­¤æ¥åˆ¤æ–­ï¼Œæ˜¯å¦çœŸçš„æ˜¯ CI åœ¨è¯·æ±‚ï¼‰ç„¶åŽè¿”å›žç§é’¥ã€‚

> Qï¼šGitLab CI é€‚åˆä»€ä¹ˆç±»åž‹çš„é¡¹ç›®å‘¢ï¼Ÿå›½å†…ç›®å‰è¿˜æ¯”è¾ƒå°ä¼—å§ï¼Ÿ

Aï¼šå›½å†…ç›®å‰è¿˜è¾ƒä¸ºå°ä¼—ï¼ˆç›¸æ¯” Jenkins æ¥è¯´ï¼‰å…¶å®žåªè¦éœ€è¦ CI çš„é¡¹ç›®ï¼Œå®ƒéƒ½é€‚åˆã€‚

---

### 2018-07-20ï¼šå°ç±³å¼¹æ€§è°ƒåº¦å¹³å° Ocean

> Qï¼šè¯·æ•™ä¸‹ä½ ä»¬ ELB ç”¨çš„ä»€ä¹ˆä»£ç†è½¯ä»¶ï¼ŒHAProxyã€Nginxï¼Ÿæ˜¯å¦é‡åˆ°è¿‡ç¼©å®¹æ—¶å‡ºçŽ°éƒ¨åˆ†è¯·æ±‚å¤±è´¥çš„é—®é¢˜ï¼Œæœ‰è§£å†³æ–¹æ¡ˆå—ï¼Ÿ

Aï¼šIDC ELB åº•å±‚å°è£…çš„æ˜¯å…¬å¸çš„ LVSï¼ŒLVS ç®¡ç†å¹³å°æä¾›äº†å®Œäº‹çš„ API æ”¯æŒï¼ŒELB è¿™è¾¹è°ƒç”¨ LVS ç®¡ç†å¹³å°çš„ API è¿›è¡Œçš„ç›¸å…³æ“ä½œã€‚ç¼©å®¹ç›®å‰æ²¡æœ‰é‡åˆ°æµé‡ä¸¢å¤±é—®é¢˜ï¼Œè¿™ä¸ªæ˜¯åœ¨ docker init å†…æŽ¥æ”¶ä¿¡å·ï¼Œç„¶åŽåšçš„å›žæ”¶å¤„ç†ã€‚

> Qï¼šhostgw å¦‚ä½•è®¿é—®å¤–ç½‘ï¼Ÿ

Aï¼šæ˜¯é€šè¿‡è·¯ç”±å‡ºç½‘çš„ï¼Œå®¹å™¨çš„ IP æ˜¯è·¯ç”±ä¸ŠçœŸå®žå­˜åœ¨çš„ IP ç½‘æ®µï¼Œç”±ç½‘ç»œç»„æä¾›çš„ API è¿›è¡Œçš„åŠ¨æ€é…ç½®ã€‚

> Qï¼šéƒ½åŠ«æŒäº†ï¼Œä¸ºå•¥ä¸ç”¨ LXCFSï¼Ÿ

Aï¼šLXCFS ç›®å‰ä»…æ”¯æŒæ”¹å˜å®¹å™¨çš„ CPU è§†å›¾ï¼ˆ/proc/cpuinfo æ–‡ä»¶å†…å®¹ï¼‰å¹¶ä¸”åªæœ‰ --cpuset-cpus å‚æ•°å¯ä»¥ç”Ÿæ•ˆï¼Œå¯¹äºŽç³»ç»Ÿè°ƒç”¨ sysconf(_SC_NPROCESSORS_ONLN)è¿”å›žçš„åŒæ ·è¿˜æ˜¯ç‰©ç†æœºçš„ CPU æ ¸æ•°ã€‚å¦ï¼šæˆ‘ä»¬é‡‡ç”¨çš„åŠ«æŒæ–¹æ¡ˆå·²å¼€æºï¼Œæ¬¢è¿Žå›´è§‚ï¼š[agile6v/container_cpu_detection](https://github.com/agile6v/container_cpu_detection)

ä»¥ä¸Šå†…å®¹æ ¹æ® 2018 å¹´ 7 æœˆ 17 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**èµµäº‘ï¼Œå°ç±³äº‘å¹³å°è¿ç»´éƒ¨ SREï¼Œè´Ÿè´£å°ç±³æœ‰å“äº§å“çº¿è¿ç»´å·¥ä½œ**ã€‚

---

### 2018-07-13ï¼šHulu å¤§è§„æ¨¡å®¹å™¨è°ƒåº¦ç³»ç»Ÿ Capos

> Qï¼šCapos å¦‚ä½•å¤„ç†å¥åº·æ£€æŸ¥ï¼Ÿä¹‹å‰äº†è§£åˆ°ï¼ŒMesos å†…ç½®çš„å¥åº·æ£€æŸ¥ä¸æ˜¯ç‰¹åˆ«å®Œå–„ã€‚

Aï¼šç›®å‰ Capos focus çš„ä½œä¸šå¤§éƒ¨åˆ†éƒ½æ˜¯çŸ­ä½œä¸šç±»åž‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›®å‰å°±æ˜¯é€šè¿‡å®¹å™¨çš„é€€å‡ºç æ¥åˆ¤æ–­ success æˆ–è€… failï¼Œå¦‚æžœä½ è¯´çš„å¥åº·æ£€æŸ¥æ˜¯é’ˆå¯¹æœåŠ¡çš„ï¼Œä¸€èˆ¬å®žçŽ°æ˜¯æ”¯æŒå¤šç§å¥åº·æ£€æŸ¥çš„æ–¹å¼ï¼Œbashï¼Œhttp ç­‰ï¼Œç„¶åŽä¸ºäº†å¤§è§„æ¨¡å®¹å™¨è¿è¡Œæƒ…å†µä¸‹çš„å¯ç”¨æ€§ï¼Œå»ºè®®è¿™ç§å¥åº·æ£€æŸ¥çš„å‘èµ· client å’ŒæœåŠ¡ instance æ˜¯åœ¨ä¸€å°æœºå™¨ä¸Šï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª Pod ä¸­ï¼Œå‘çŽ°ä¸å¥åº·é€šè¿‡æŸç§æœºåˆ¶ä¸ŠæŠ¥ï¼Œæˆ–è€…é€€å‡º Containerï¼Œä½†æ˜¯éœ€è¦æŽ§åˆ¶ Threshold ä»¥å…æ•´ä¸ªæœåŠ¡ downtimeã€‚è¿™æ ·å¯ä»¥æŽ¢æµ‹ instance çš„å¥åº·ï¼Œæ•´ä¸ªæœåŠ¡çš„å¥åº·ï¼Œå¯ä»¥åœ¨é€šè¿‡å¤–éƒ¨çš„ä¸€äº›å­ç³»ç»ŸåŽ» checkã€‚

> Qï¼šå…³äºŽè°ƒåº¦æ–¹é¢ï¼Œåˆ†äº«ä¸­åªæåˆ°äº†ä½¿ç”¨äº†ä¸€ç³»åˆ—çš„å¯æ’æ‹”çš„è¿‡æ»¤å‡½æ•°å’Œä¼˜å…ˆçº§å‡½æ•°ï¼Œæˆ‘æƒ³é—®ä¸‹èƒ½å¦å…·ä½“æè¿°ä¸‹å¦‚ä½•è¢«è°ƒåº¦çš„ï¼Ÿå’Œ yarn é‡Œä½¿ç”¨çš„ Fair Schedule æˆ–è€… DRF ç®—æ³•çš„å¼‚åŒæœ‰å“ªäº›ï¼Ÿå› ä¸ºå¯¹äºŽå¤šç§èµ„æºç»´åº¦çš„è°ƒåº¦æ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„é—®é¢˜ï¼Œå¸Œæœ›çŸ¥é“ Hulu è¿™æ–¹é¢æœ‰ä»€ä¹ˆå¿ƒå¾—å’Œæ€è€ƒï¼Ÿ

Aï¼šç›®å‰å®žçŽ°æ˜¯ï¼Œä¼šé’ˆå¯¹ä¸€ä¸ªè¯·æ±‚ï¼Œé¦–å…ˆæ ¹æ®è¿‡æ»¤å‡½æ•°æ¯”å¦‚ä¸€äº› constraints è¿›è¡Œ offer è¿‡æ»¤ï¼Œç„¶åŽå‰©ä¸‹çš„ offer apply æ‰€æœ‰çš„ä¼˜å…ˆçº§æ‰“åˆ†å‡½æ•°ï¼Œè¿›è¡Œæ‰“åˆ†ï¼Œæ‰“åˆ†çš„æ—¶å€™ï¼Œä¼šæ ¹æ®ä¸€ä¸ªè¯·æ±‚å’Œ offer çš„èµ„æºï¼Œç®— CPU å’Œ mem çš„æ¯”ä¾‹ï¼Œé€‰å–å‡º dominate çš„ resource è¿›è¡Œä¸»è¦è¯„åˆ†ï¼Œç„¶åŽé€‰å–æœ€ä¼˜çš„ offer è¿›è¡Œ bindï¼Œbind ä¹‹åŽä¸ä¼šé©¬ä¸Šè°ƒåº¦ï¼Œè€Œæ˜¯ä¼š delay schedulerï¼Œè¿™æ ·ä¸€èˆ¬åœ¨æ¯”è¾ƒç¹å¿™çš„æƒ…å†µä¸‹ï¼Œä¸€æ¬¡ offer launch å¯ä»¥å¯åŠ¨å¤šä¸ª tasksï¼Œè¿™æ˜¯å¯¹äºŽå¤§è§„æ¨¡åžåçš„è€ƒè™‘ã€‚ ä»¥ä¸Šè¿™äº›å®žçŽ°è¿˜æ˜¯ queue-base çš„è°ƒåº¦ï¼Œå€Ÿé‰´äº†ä¸€äº› Fair Schedule å’Œ drf çš„æ€è·¯ï¼Œå…·ä½“å·®åˆ«ä½ äº†è§£äº† Capos scheduler ç­–ç•¥åŽï¼Œåº”è¯¥å°±ä¼šæœ‰è‡ªå·±çš„æƒ³æ³•äº†ã€‚å¤šç§èµ„æºç»´åº¦ï¼Œç›®å‰æˆ‘ä»¬æ˜¯æ ¹æ® dominate resource ä½œä¸ºä¸»è¦è¯„åˆ†æ ‡å‡†çš„ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥çœ‹ä¸‹æˆ‘æœ€åŽåˆ†äº«æåˆ°çš„ä¸€äº› flow-base çš„ scheduler ç®—æ³•ï¼Œæ¯”å¦‚ firmamentã€‚å¸Œæœ›å¯ä»¥å›žç­”ä½ çš„é—®é¢˜ã€‚

> Qï¼šCapos æ˜¯å¦æ”¯æŒï¼Œæ•°æ®ä¸­å¿ƒä¹‹é—´çš„å¤‡ä»½/åˆ‡æ¢ã€‚æ¯”å¦‚ Zone-A çš„æ•°æ®ä¸­å¿ƒå‡ºçŽ°ç½‘ç»œæ•…éšœï¼ŒæŠŠæœåŠ¡è¿ç§»åˆ°å¦ä¸€ä¸ªæŒ‡å®šçš„åŒºåŸŸ Zone-Bï¼ˆä»ç„¶è€ƒè™‘æ¢å¤ä»¥åŽä¼˜å…ˆéƒ¨ç½²åˆ° Zone -Aï¼‰ã€‚ä¹‹å‰è€ƒè™‘æ˜¯ç±»ä¼¼ä¸€ä¸ª Mask çš„æœºåˆ¶ï¼Œå¦‚æžœæ•…éšœå°±åŠ ä¸€å®šçš„ Mask å€¼ï¼ˆæ¯”å¦‚ Opcacityï¼‰åœ¨æŸä¸ªé›†ç¾¤ä¸Šï¼Œç„¶åŽè°ƒåº¦çš„æ—¶å€™åŽ»å‚è€ƒè¿™ä¸ª Mask å€¼ï¼Œä¸çŸ¥é“ Hulu æœ‰æ²¡æœ‰ç±»ä¼¼çš„éœ€æ±‚æˆ–è€…è€ƒè™‘è¿‡è¿™æ ·çš„æœºåˆ¶ï¼Ÿ

Aï¼šCapos æ˜¯ on Mesosï¼ŒMesos æ˜¯æ ¹æ® zk åšé€‰ä¸»ï¼Œè€Œä¸” Capos scheduler ä¸­è¿˜æœ‰ä¸€ä¸ª raft base key value storeï¼Œæ‰€ä»¥è¿™äº›æ¡ä»¶ï¼Œä½¿å¾— Capos æ˜¯ä¸€ä¸ª datacenter çš„è§£å†³æ–¹æ¡ˆã€‚ç›®å‰ Hulu æ˜¯æœ‰å¤šä¸ª DataCenter çš„ï¼Œæ‰€ä»¥çœ‹æž¶æž„ç»„ä»¶å›¾ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª Capos portalï¼Œåœ¨è¿™ä¸ªç»„ä»¶ä¸‹ï¼Œæ˜¯å¯ä»¥é€‰æ‹©ä¸åŒ DataCenter åŽ» run workloadã€‚æ‰€ä»¥æˆ‘ä»¬ç›®å‰å¯¹äºŽæ•°æ®ä¸­å¿ƒçš„å¤‡ä»½å’Œåˆ‡æ¢ï¼Œä¸»è¦æ˜¯ä¾èµ– Capos portal è¿™ä¸ªç»„ä»¶ï¼Œåœ¨ Gateway çš„ä½ç½®åšçš„æŽ§åˆ¶ã€‚

> Qï¼šæƒ³è¯·é—®ä¸‹ Capos çš„é‰´æƒæ˜¯æ€Žä¹ˆåšçš„ï¼Œæœ‰æ²¡æœ‰ç”¨æˆ·æƒé™è®¤è¯ç³»ç»Ÿï¼Ÿæ­¤å¤–ï¼Œé’ˆå¯¹æ¯ä¸ªç”¨æˆ·æœ‰æ²¡æœ‰å®¹å™¨èµ„æºä½¿ç”¨é‡çš„é™åˆ¶ï¼Ÿ

Aï¼šå¯ä»¥ç¿»åˆ°ä¹‹å‰ share çš„æž¶æž„ç»„ä»¶å›¾ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª Capos portal ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶æ˜¯æä¾› Restful API å’Œ Portalï¼Œæˆ‘ä»¬åœ¨è¿™è¾¹é›†æˆ Hulu SSOï¼Œç„¶åŽå…³è” Hulu yellowpagesï¼ˆHulu çš„æœåŠ¡æƒé™æŽ§åˆ¶ç³»ç»Ÿï¼‰ï¼Œåšçš„ç”¨æˆ·çš„è®¤è¯ï¼Œæˆ‘ä»¬åˆ†æˆè‡ªå·±çš„ Capos APPï¼Œ team çš„ APPï¼Œåˆ«çš„ç»„æ— æ³•æ“ä½œä¸å±žäºŽè‡ªå·±çš„ Capos APPã€‚å¯¹äºŽ Quota çš„ç®¡ç†ï¼Œæˆ‘ä»¬åšäº† Queue/Label æœºåˆ¶ï¼Œæ¯ä¸ªæœåŠ¡ä¼šå»ºä¸€ä¸ªæ ‡è¯†ï¼Œç„¶åŽåœ¨æ ‡è¯†åº•ä¸‹é…ç½®æ€»çš„èµ„æºä½¿ç”¨é‡ï¼Œä»¥åŠå¯ä»¥ç”¨çš„æœºå™¨åˆ—è¡¨ï¼ˆé€šé…ç¬¦ï¼‰ï¼Œç”¨è¿™æ ·çš„æœºåˆ¶æŽ§åˆ¶ Capos çš„ç”¨æˆ·èµ„æºä½¿ç”¨ã€‚

---

### 2018-06-28ï¼šåŸºäºŽ Pipeline çš„ CI/CD åœ¨è¶£å¤´æ¡çš„åº”ç”¨å®žè·µ

> Qï¼šç”Ÿæˆæ–°çš„é•œåƒæ€Žä¹ˆè‡ªåŠ¨æ‰“æ–°çš„ tagï¼Ÿ

Aï¼šæˆ‘ä»¬é•œåƒ Tag ä½¿ç”¨æœ¬æ¬¡æž„å»ºé€‰å®šçš„ Git ç‰ˆæœ¬ï¼Œå¦‚åˆ†æ”¯åç§°æˆ–è€… Tagã€‚

> Qï¼šä½ ä»¬çš„ Jenkins å®žä¾‹æœ‰å¤šå°‘ï¼ŒJenkins å®žä¾‹æ˜¯æ€Žä¹ˆè§„åˆ’çš„ï¼Ÿ

Aï¼š1 ä¸ª Master èŠ‚ç‚¹æä¾› UI ç•Œé¢ï¼Œå‡ ä¸ª Agent åˆ†åˆ«å¯¹åº”ä¸åŒè¯­è¨€ç‰ˆæœ¬å’Œä¸åŒçŽ¯å¢ƒ Kubernetes é›†ç¾¤ï¼Œè¿è¡Œåœ¨å®¹å™¨ä¸­ã€‚è§„åˆ’å°±æ˜¯æŒ‰è¯­è¨€æˆ–ç‰ˆæœ¬åˆ†èŠ‚ç‚¹ï¼ŒæŒ‰é›†ç¾¤åˆ†èŠ‚ç‚¹ï¼ˆAgentï¼‰ã€‚

> Qï¼šSonarQube è·Ÿ Jenkins çš„é›†æˆï¼Œèƒ½å¦è¯¦ç»†ä»‹ç»ä¸€ä¸‹ï¼Œèƒ½å¦ show ä¸€ä¸‹ Groovy ä»£ç ã€‚

Aï¼šè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œæž„å»ºæ—¶å°†é¡¹ç›®ä¿¡æ¯è¾“å…¥åˆ° sonar-project.properties æ–‡ä»¶ä¸­ï¼Œå†è°ƒç”¨ sonar-scanner å‘½ä»¤å³å¯ã€‚

> Q: è¿™ä¸ª Pipeline Jenkinsfile æ˜¯å¤šä¸ªåœ¨ä¸€èµ·å—ï¼Ÿ è¿˜æ˜¯ç›´æŽ¥å†™çš„ Groovy æ–‡ä»¶ï¼Ÿ

Aï¼šå¤šä¸ª Groovy æ–‡ä»¶ï¼ŒæŒ‰ç±»åž‹åˆ†å‡½æ•°ï¼Œä¸€ä¸ªåŠŸèƒ½å°½é‡åªå†™ä¸€æ¬¡ã€‚

> Qï¼šJenkins çš„æƒé™æŽ§åˆ¶èƒ½å¦å†ç»†åŒ–ä¸€ä¸‹ï¼Ÿ

Aï¼šæˆ‘ä»¬è¿™è¾¹æƒé™å®žé™…ä¸Šæ˜¯åœ¨ CMDB ä¸­å®Œæˆçš„ã€‚æž„å»ºæ—¶å‘ CMDB å‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œä¼ é€’å½“å‰é¡¹ç›®åç§°ã€é€‰æ‹©çš„çŽ¯å¢ƒã€ç”¨æˆ·åè¿‡åŽ»ï¼ŒCMDB åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æž„å»ºé€‰å®šçš„çŽ¯å¢ƒï¼Œå…è®¸åˆ™è¿”å›žé¡¹ç›®é…ç½®ä¿¡æ¯ï¼Œå¦åˆ™è¿”å›žé”™è¯¯ä»£ç ï¼Œè¿™è¾¹æ”¶åˆ°åŽæŠ¥é”™ç»ˆæ­¢ã€‚

> Qï¼šSonarQube çš„æƒé™æŽ§åˆ¶åŠæ€§èƒ½å½“é¢ï¼Ÿ

Aï¼šæƒé™æŽ§åˆ¶ä½¿ç”¨ SonarQube æä¾›çš„ APIï¼Œå°†é¡¹ç›®è·Ÿ GitLab ä¸­ç›¸åº”é¡¹ç›®æƒé™åŒ¹é…èµ·æ¥ï¼ŒGitLab ä¸­å¯ä»¥æŸ¥çœ‹è¿™ä¸ªé¡¹ç›®ä»£ç ï¼Œé‚£ä¹ˆ SonarQube ä¸­å°±èƒ½çœ‹åˆ°è¿™ä¸ªé¡¹ç›®ç»“æžœå’Œ Codeã€‚

> Q: ä½ ä»¬æ˜¯ç›´æŽ¥å°† SonarQubeã€GitLab/Jenkins çš„æƒé™æŽ§åˆ¶åˆ°ä¸€èµ·äº†ï¼Ÿæ€Žæ ·åšçš„ç»Ÿä¸€ï¼Ÿ

Aï¼šä½¿ç”¨ LDAP è®¤è¯ã€‚

> Qï¼šSonar ä½¿ç”¨çš„ sonar-scanner è¿˜æ˜¯ mvn sonarï¼šsonarï¼Ÿ

Aï¼šä½¿ç”¨ SonarScannerã€‚

> Qï¼šKubernetes çš„ services.yaml æ–‡ä»¶åœ¨å“ªé‡Œç®¡ç†ï¼Ÿ

Aï¼šdeployment & service & configmap ä¹‹ç±»æ–‡ä»¶éƒ½æ˜¯æä¾› Git è¿›è¡Œç‰ˆæœ¬æŽ§åˆ¶ï¼Œé’ˆå¯¹è¯­è¨€æœ‰æ¨¡ç‰ˆï¼Œæž„å»ºæ—¶è¿›è¡Œæ›¿æ¢ã€‚

> Qï¼šPipeline æœ‰å›žæ»šæœºåˆ¶å—ï¼Œä½ ä»¬é›†æˆè¦†ç›–çŽ‡æµ‹è¯•äº†å—ï¼Ÿ

Aï¼šå›žæ»šæœºåˆ¶æš‚æ—¶ä¸æ‰“ç®—é€šè¿‡ Pipeline è¿›è¡Œï¼ŒåŽç»­åœ¨å¦å¤–çš„å¹³å°å®žçŽ°ã€‚
Aï¼šäººå·¥è§¦å‘ï¼Œå› ä¸ºæœ‰å¿…é¡»è¦äººå·¥é€‰æ‹©çš„ Git ç‰ˆæœ¬ã€‚ä¸ºé˜²æ­¢è¯¯å‘å¸ƒï¼Œé»˜è®¤æ²¡æœ‰é€‰å®šç‰ˆæœ¬ï¼Œä¸é€‰åˆ™åœ¨é¢„å¤„ç†æ—¶æŠ¥é”™ç»ˆæ­¢ã€‚

> Qï¼šPipeline è¿™å¥—æœºåˆ¶çš„è„šæœ¬å¦‚æžœå‡ºé”™äº†å¦‚ä½•è°ƒè¯•ï¼Ÿ

Aï¼šecho è¾“å‡ºè°ƒè¯•ï¼ˆæ‰‹åŠ¨æ»‘ç¨½ï¼‰ã€‚

> Qï¼šPipeline è¯­æ³•å’Œä½¿ç”¨ä¸Šæœ‰ä»€ä¹ˆå‚è€ƒé“¾æŽ¥å—ï¼Ÿ

Aï¼š[www.groovy-lang.org](http://www.groovy-lang.org/)ã€[www.w3cschool.cn/groovy](https://www.w3cschool.cn/groovy)ã€[jenkins.io/doc/book/pipeline/syntax](https://jenkins.io/doc/book/pipeline/syntax)

> Qï¼šGit Checkout çš„æ—¶å€™ï¼Œä½ ä»¬çš„ Git SCM æ²¡æœ‰è€ƒè™‘éšç§å®‰å…¨çš„äº‹æƒ…å—ï¼Œæ¯”å¦‚ä»£ç æƒé™å—é™ï¼Ÿ

Aï¼šJenkins ä½¿ç”¨äº†ä¸€ä¸ªæœ€å°æƒé™ç”¨æˆ·åŽ» GitLab ä¸Šæ‹‰ä»£ç ã€‚å®‰å…¨æ–¹é¢ï¼ŒJenkins æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯å¯æŽ§çš„ã€‚

> Q: ä½ ä»¬çš„å„å·¥å…·é—´ï¼Œæœ‰æ²¡æœ‰åšé›†æˆï¼Ÿæ¯”å¦‚ä½¿ç”¨ Pipeline æ¥æ“ä½œ Jira ç›¸å…³ issue ç­‰ï¼Ÿæˆ–å…¶ä»–é—®é¢˜ç®¡ç†å·¥å…·ã€‚

Aï¼šæˆ‘ä»¬è¿™è¾¹ç›®å‰è¿˜æ²¡é›†æˆ Jiraã€‚å¦‚æžœæœ‰è¿™éœ€æ±‚è‚¯å®šä¼šå¯¹æŽ¥èµ·æ¥ã€‚ > è‡³äºŽå…¶å®ƒçš„åˆ™æ ¹æ®éœ€è¦åœ¨ä¸åŒé˜¶æ®µè¿›è¡Œä¸ŠæŠ¥ã€‚

> Qï¼šæž„å»ºåŠéƒ¨ç½²éƒ½åœ¨å®¹å™¨ä¸­ï¼Ÿè¦æž„å»ºçš„æ–‡ä»¶æˆ–åˆ¶å“æ–‡ä»¶æ€Žä¹ˆå­˜æ”¾ä¸Žç®¡ç†çš„ï¼Ÿ

Aï¼šAgent å®¹å™¨å¯åŠ¨æ—¶æŒ‚è½½äº†ä¸€ä¸ªç›®å½•ï¼Œé‡Œé¢æœ‰å…¨å¥—é™„å±žæ–‡ä»¶åŠ Jenkins > home ç›®å½•ã€‚build èŠ‚ç‚¹å®Œæˆè‡ªå·±å·¥ä½œåŽï¼Œå…¶å®ƒèŠ‚ç‚¹æŒ‰éœ€æŽ¥æ‰‹å¤„ç†ã€‚

---

### 2018-06-24ï¼šè‹å®å®¹å™¨äº‘åŸºäºŽ Kubernetes å’Œ Contiv çš„ç½‘ç»œæž¶æž„æŠ€æœ¯å®žçŽ°

> Qï¼šç½‘ç»œé™é€Ÿçš„å¯¹äºŽç³»ç»Ÿçº§åˆ«æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šç½‘ç»œé™é€Ÿå…¶å®žä¾ç„¶åˆ©ç”¨çš„æ“ä½œç³»ç»Ÿçš„ç‰¹æ€§ï¼Œæ¯”å¦‚ tcï¼Œå…¶å®žä¸ç®¡æ˜¯ OVS Ingress è¿˜æ˜¯ Netlink éƒ½æ˜¯é€šè¿‡å’Œå†…æ ¸é€šä¿¡ï¼Œå°†é™é€Ÿè§„åˆ™åŠ å…¥åˆ°å¯¹åº”çš„ port ä¸Šã€‚

> Qï¼šä¸Šé¢æåˆ°çš„ Kubernetes èµ„æºï¼Œå¯¹äºŽå®žçŽ° Pod-IP å›ºå®šæ˜¯æœ‰é™åˆ¶çš„å—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œå½“å‰ä»…ä»…æ”¯æŒ Deploymentã€ReplicaSetã€StatefulSetï¼Œå› ä¸ºéšç€å¯¹ä¸åŒèµ„æºç±»åž‹çš„æ”¯æŒï¼Œæˆ‘ä»¬å‘çŽ°å¤„ç†è¶Šå¤šçš„èµ„æºï¼Œå¯¹äºŽå®žçŽ° IP å›ºå®šçš„é€»è¾‘å°±è¶Šå¤æ‚ï¼Œæ¯”å¦‚è¦åˆ¤æ–­è¿™ä¸ªèµ„æºæ˜¯çœŸæ­£åˆ é™¤è¿˜æ˜¯é‡æ–°è°ƒåº¦ï¼Œåœ¨ä»£ç çº§åˆ«è¦å¤„ç†çš„å¾ˆç»†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æŒ‰ç…§è‡ªèº«çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼ŒçŽ°åœ¨åªå®žçŽ°ä¸‰ç§ã€‚

> Qï¼šRSF ç³»ç»Ÿæ˜¯ä»€ä¹ˆç³»ç»Ÿï¼ŸeBPF å’Œ XDP æ˜¯ä»€ä¹ˆï¼Ÿèƒ½ç®€å•ä»‹ç»ä¸‹å—ï¼Ÿ

Aï¼šeBPF å’Œ XDF æ˜¯ Calico ç½‘ç»œæ’ä»¶çš„æ¦‚å¿µï¼ŒeBPFï¼ˆextended Berkeley Packet Filterï¼‰èµ·æºäºŽ BPFï¼Œå®ƒæä¾›äº†å†…æ ¸çš„æ•°æ®åŒ…è¿‡æ»¤æœºåˆ¶ã€‚ BPF çš„åŸºæœ¬æ€æƒ³æ˜¯å¯¹ç”¨æˆ·æä¾›ä¸¤ç§ SOCKET é€‰é¡¹ï¼šSO_ATTACH_FILTER å’Œ SO_ATTACH_BPFï¼Œå…è®¸ç”¨æˆ·åœ¨ sokcet ä¸Šæ·»åŠ è‡ªå®šä¹‰çš„ filterï¼Œåªæœ‰æ»¡è¶³è¯¥ filter æŒ‡å®šæ¡ä»¶çš„æ•°æ®åŒ…æ‰ä¼šä¸Šå‘åˆ°ç”¨æˆ·ç©ºé—´ã€‚

> Qï¼šæ‚¨çŽ°åœ¨ç”¨çš„ Contiv ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Œé€šè¿‡ Pod çš„ä»€ä¹ˆå±žæ€§å®žçŽ° Pod IPï¼Ÿå®žçŽ° pod-ip å›ºåŒ–ç›®å‰ä»£ç æ”¹åŠ¨é‡æœ‰å¤šå¤§ï¼Œå¦‚æžœæŒ‰äººå¤©ç®—çš„è¯ï¼Ÿ

Aï¼šçŽ°åœ¨ç”¨ 1.2.0 ç‰ˆæœ¬ï¼ŒPod çš„å¯¹åº” pause å®¹å™¨çš„ IPã€Macã€‚æ”¹åŠ¨é‡éœ€è¦ 30 äºº/å¤©ï¼Œå‰ææ˜¯å¯¹ä»£ç ä»¥åŠæ•°æ®ç»“æž„æ¯”è¾ƒäº†è§£ï¼Œä¹Ÿæ¯”è¾ƒæ¸…æ¥š Kubernetes çš„ Pod åˆ›å»ºé€»è¾‘ã€‚

> Qï¼šä½ ä»¬åšäº†å¤§é‡å®šåˆ¶åŒ–å¼€å‘ï¼Œæ˜¯å¦æäº¤ç¤¾åŒºäº†ï¼Œå¦‚ä½•ä¿éšœä¸Žç¤¾åŒºåŒæ­¥ï¼Ÿ

Aï¼šæ²¡æœ‰æäº¤ç¤¾åŒºï¼Œä½†æ˜¯æˆ‘ä»¬å‘çŽ°äº†ä¸€äº›é‡è¦çš„ bug æäº¤äº†ï¼Œå¯èƒ½æ˜¯å› ä¸ºå¾ˆå¤šä»£ç æ¶‰åŠæ¯”è¾ƒå¹¿ï¼Œå¹¶ä¸”æˆ‘ä»¬æ”¹åŠ¨çš„æœ‰äº›å¹¶ä¸æ˜¯æ€ç§‘èƒ½å¤ŸæŽ¥å—çš„ï¼Œæ¯”å¦‚ pod-ip å›ºå®šï¼Œè¿™ä¸ªå…¶å®žä¸ç¬¦åˆ Kubernetes å¼€æºæ€æƒ³ã€‚

---

### 2018-06-14ï¼šç›˜ç‚¹ Kubernetes ç½‘ç»œé—®é¢˜çš„ 4 ç§è§£å†³æ–¹æ¡ˆ

> Qï¼šä»Šå¤©è®²äº†å¾ˆå¤šæ–¹æ³•è§£å†³å®¹å™¨ç½‘ç»œçš„é—®é¢˜ï¼Œä¼¼ä¹Žå¯ä»¥ä»Žé›†ç¾¤å¤–éƒ¨æˆ–é›†ç¾¤å†…éƒ¨å¯ä»¥ç›´æŽ¥è®¿é—®å®¹å™¨çš„ IPï¼Œä½†æ˜¯åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®å®¹å™¨ IP çš„åœºæ™¯æœ‰å—ï¼Ÿæˆ‘è§‰å¾—å®¹å™¨çš„ IP ä¸åº”è¯¥æš´éœ²å‡ºæ¥ï¼Œä»Žå¤–éƒ¨ä¸èƒ½ç›´æŽ¥è®¿é—®å®¹å™¨çš„ IPï¼Œå› ä¸ºå®¹å™¨çš„ IP å¯èƒ½æ˜¯å˜åŒ–çš„ã€‚æœ‰çš„æ—¶å€™ä½¿ç”¨ RC ä¹‹ç±»çš„ã€‚æˆ‘çš„é—®é¢˜æ˜¯èƒ½ä¸èƒ½ä»Žé›†ç¾¤å¤–éƒ¨é€šè¿‡ clusterip æˆ– node-port ip æ¥è®¿é—®åŸºäºŽå®¹å™¨çš„ä¸šåŠ¡å‘¢ï¼Ÿå¦‚æžœå¯ä»¥çš„è¯ï¼Œä»Šå¤©ä»‹ç»çš„ Flanel æˆ– Calico çš„ä»·å€¼æ˜¯ä»€ä¹ˆå‘¢ï¼Œè¿™ä¸¤ç§æ–¹æ¡ˆï¼Œæˆ‘æ„Ÿè§‰éƒ½æ˜¯ç›´æŽ¥è®¿é—®å®¹å™¨çš„ IP åœ°å€ï¼Œé‚£ä¹ˆå¦‚æžœæŸä¸ªå®¹å™¨å‡ºé—®é¢˜ï¼Œé‡å¯ä¹‹åŽï¼Œè‚¯å®šè¦æ¢ IPï¼Œé‚£è¿™ä¸ªæ—¶å€™æ€Žä¹ˆåŠžå‘¢ï¼Ÿå¦å¤–ï¼Œé›†ç¾¤å†…å®¹å™¨åˆ°å®¹å™¨çš„è®¿é—®ï¼Œåˆ°åº•æ˜¯ç›´æŽ¥è®¿é—®å¯¹ç«¯å®¹å™¨çš„ IPï¼Œè¿˜æ˜¯è®¿é—® cluster-ipï¼Œæˆ‘è¿™ä¸ªæœ‰ç‚¹æ™•ï¼Œè°¢è°¢ã€‚

Aï¼šé›†ç¾¤å†…å®¹å™¨åˆ°å®¹å™¨çš„è®¿é—®ï¼Œå¯ä»¥ç›´æŽ¥é€šè¿‡ localhost åŠ ç«¯å£å³å¯ã€‚å¦‚æžœæ˜¯åŒä¸€ä¸»æœºä¸Šçš„ Podï¼Œç”±äºŽå®ƒä»¬åœ¨åŒä¸€ä¸ª docker0 ç½‘æ¡¥ä¸Šï¼Œåœ°å€æ®µç›¸åŒï¼Œå¯ä»¥ç›´æŽ¥é€šä¿¡ã€‚å¦‚æžœæ˜¯ä¸åŒä¸»æœºä¸Šçš„ Podï¼Œåˆ™éœ€è¦è·¨è¶Šç‰©ç†æœºä¸Šçš„ç‰©ç†ç½‘å¡ï¼Œé€šè¿‡å®¿ä¸»æœºçš„ IP è½¬åˆ° docker0 ä¸Šå†åˆ°å¯¹åº”çš„ Pod é‡Œçš„æŸä¸ªå®¹å™¨ã€‚ä¸ç®¡æ˜¯ Flanel æˆ– Calicoï¼Œéƒ½æœ‰å„è‡ªçš„åº”ç”¨åœºæ™¯ã€‚Flanel ä¸æ˜¯ç›´æŽ¥è®¿é—®å®¹å™¨ IP çš„ï¼Œå®ƒè¿˜æœ‰è‡ªå·±çš„ flanel0 ç½‘æ¡¥ï¼ŒCalico èŠ‚ç‚¹ç»„ç½‘å¯ä»¥ç›´æŽ¥åˆ©ç”¨æ•°æ®ä¸­å¿ƒçš„ç½‘ç»œç»“æž„ï¼ˆæ”¯æŒ L2 æˆ–è€… L3ï¼‰ï¼Œå¯ä»¥ç›´æŽ¥é€šä¿¡ã€‚ä»Žå¤–éƒ¨å¯ä»¥ç›´æŽ¥è®¿é—®å®¹å™¨çš„ IPï¼Œéœ€è¦åšå®¹å™¨å›ºå®š IPï¼Œé’ˆå¯¹æŸäº›ç‰¹å®šåº”ç”¨æ¯”å¦‚æ•°æ®åº“ã€‚

> Qï¼šæœ‰æ²¡æœ‰ç¢°åˆ°å› ä¸º Pod æ•°é‡å¤§å¯¼è‡´ç½‘ç»œå¼‚å¸¸ï¼Ÿ

Aï¼šæš‚æ—¶æ²¡æœ‰ï¼ŒPod åœ¨å¤§æ‰¹é‡åˆ›å»ºåŽæœ‰çŠ¶æ€å¼‚å¸¸çš„ï¼Œå¯ä»¥å°†å…¶æ‰‹å·¥æ¢å¤åˆ° Running çŠ¶æ€ã€‚

> Qï¼šæƒ³é—®ä¸€ä¸‹ï¼Œæˆ‘ä»¬å®žé™…é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ä½¿ç”¨ Calico ç½‘ç»œï¼Œæœ‰æ²¡æœ‰é‡åˆ°å…¸åž‹çš„é—®é¢˜ï¼ŸCalico ipip ç”Ÿäº§çŽ¯å¢ƒåº”ç”¨æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿ

Aï¼šæ•°æ®ä¸­å¿ƒçŽ¯å¢ƒæœ‰ç”¨ Calicoï¼Œé—®é¢˜æ˜¯ç›®å‰ stable ç‰ˆæœ¬è¿˜æ— æ³•å¾ˆå¥½çš„æ”¯æŒç§æœ‰ç½‘ç»œã€‚

> Qï¼šå¯¹äºŽ Kubernetes ç‰ˆæœ¬é€‰æ‹©æ˜¯å¦å¯ä»¥æä¾›ä¸€äº›å»ºè®®ï¼Ÿ

Aï¼šå»ºè®®ä½¿ç”¨ 1.8 ä»¥ä¸Šç‰ˆæœ¬ï¼Œåœ¨é«˜å¯ç”¨ã€å…¼å®¹æ€§ã€ç¨³å®šæ€§ä¸Šéƒ½æ›´å¥½ä¸€äº›ã€‚

---

### 2018-05-27ï¼šè…¾è®¯äº‘ TSF å¾®æœåŠ¡å¹³å°åŠ ServiceMesh æŠ€æœ¯å®žè·µ

> Qï¼šæ„Ÿè°¢åˆ†äº«ï¼Œè¯·é—®ç›®å‰ TSF çš„é›†ç¾¤è§„æ¨¡å¤§æ¦‚æ˜¯å¤šå¤§ï¼ŒServiceMesh ä»Žé€‰åž‹åˆ°è½åœ°å¤§æ¦‚ç”¨äº†å¤šå°‘äººæœˆï¼Ÿ

Aï¼šå…¬å¸å†…éƒ¨ä¸‡çº§çš„é›†ç¾¤è§„æ¨¡ï¼ŒServiceMesh è½åœ°å¤§æ¦‚ 20 äººæœˆã€‚

> Qï¼šè¯·é—®ä½ ä»¬å¾®æœåŠ¡ä¸Ž Kubernetes çš„å…³ç³»æ˜¯æ€Žä¹ˆæ ·çš„ï¼Ÿä¸‹å±‚è·‘çš„æ˜¯ Kubernetes å®¹å™¨å—ï¼Ÿ

Aï¼šKubernetes åŽŸåˆ™ä¸Šæ˜¯å±žäºŽ PaaS å¹³å°ï¼ŒPaaS å¹³å°æ˜¯è´Ÿè´£æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä»¥åŠä¼¸ç¼©è¿ç»´ç­‰èƒ½åŠ›ã€‚è€Œæˆ‘ä»¬å¾®æœåŠ¡æ¡†æž¶æœ¬èº«å®žé™…ä¸Šæ›´å¤šæ˜¯é’ˆå¯¹æœåŠ¡è°ƒç”¨ä»¥åŠæ²»ç†æ–¹é¢ï¼Œå…¶æž¶æž„æ˜¯ä¸Ž PaaS è§£è€¦ï¼Œå¹¶ä¸”å¯ä»¥å¯¹æŽ¥ä¸åŒçš„ PaaS å¹³å°ï¼ˆåŒ…æ‹¬ Kubernetesï¼‰ï¼Œæˆ‘ä»¬ä¸‹å±‚æ”¯æŒå®¹å™¨åŠè™šæ‹Ÿæœºã€‚

> Qï¼šè¯·é—®ä¸€ä¸‹ TSF å¦‚ä½•èžåˆ Spring Cloud å’Œ ServiceMeshï¼Ÿ

Aï¼šTSF é€šè¿‡ 3 ç§æ–¹å¼èžåˆï¼šä¸€æ–¹é¢æˆ‘ä»¬æœ‰ä¸€éƒ¨åˆ† ServiceMesh æ–¹æ¡ˆåŸºäºŽ Spring Cloud å®žçŽ°ï¼›äºŒæ–¹é¢ï¼Œæ˜¯ç»Ÿä¸€æœåŠ¡æ¨¡åž‹ä¸Žé…ç½®æ¨¡åž‹ï¼›ä¸‰æ–¹é¢ï¼Œæ˜¯ä½“éªŒç»Ÿä¸€ï¼Œå°±æ˜¯æœåŠ¡çš„éƒ¨ç½²/å‡çº§åŠè¿ç»´çš„ä½“éªŒæ˜¯ä¸€è‡´ã€‚

> Qï¼šå¼•å…¥ Mesh ä¹‹åŽï¼Œä¼šé¢å¤–å¤šä¸€è·³ï¼Œè¿™å¤šä¸€è·³å¸¦æ¥çš„æ€§èƒ½æŸå¤±ï¼ŒTSF æ˜¯å¦‚ä½•æ‰¾å›žæ¥çš„ï¼Ÿ

Aï¼šå…¶å®žå¾ˆå¤šå›¢é˜Ÿä¼šçº ç»“å¼•å…¥ Mesh åŽå¤šäº†çš„é‚£ 1 è·³çš„æ€§èƒ½æŸå¤±ï¼Œå…¶å®žç»è¿‡æˆ‘ä»¬éªŒè¯ï¼Œä¸€æ–¹é¢ Envoy æ€§èƒ½æžé«˜ï¼Œåª²ç¾Ž Nginxï¼›äºŒæ˜¯è¿™ä¸€è·³çš„æŸè€—ï¼Œå®žé™…ä¸Šä¸Žä¸šåŠ¡å¤„ç†æ—¶å»¶æœ‰æ¯”è¾ƒå¤§çš„å…³ç³»ï¼Œå¦‚æžœä¸šåŠ¡å¤„ç†æ—¶å»¶åœ¨ 30 æ¯«ç§’ä»¥ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸€è·³å¸¦æ¥çš„æŸè€—å®žé™…ä¸Šå¯ä»¥æŽ§åˆ¶åœ¨å¯æŽ§èŒƒå›´å†…ï¼ˆå…·ä½“è¦çœ‹æœºå™¨æ€§èƒ½ï¼‰ã€‚

> Qï¼š30ms æ—¶å»¶ç®—å¾ˆå¤§äº†ã€‚å¦‚æžœæ˜¯ 2ms æˆ–è€… 0.xms æ˜¯ä¸æ˜¯å¿…é¡»è€ƒè™‘è¿™ä¸ªé—®é¢˜äº†ï¼Ÿä¹Ÿå°±æ˜¯è¯´å¯èƒ½å¾—çœ‹ Envoy çš„æ€§èƒ½ä¸Žä¸šåŠ¡çš„æ€§èƒ½æ˜¯å¦æŽ¥è¿‘ï¼Ÿ

Aï¼šæ ¹æ®æˆ‘ä»¬åœ¨å…¬æœ‰äº‘çš„æµ‹è¯•ç»“æžœæ¥çœ‹æ˜¯çš„ï¼Œå‡å¦‚ä¸šåŠ¡æ˜¯å±žäºŽé‚£ç§å¯¹å¿«é€Ÿå“åº”è€Œä¸”å¯¹æ—¶å»¶ç‰¹åˆ«æ•æ„Ÿçš„ä¸šåŠ¡ï¼Œç¡®å®žéœ€è¦è·Ÿè¿›å®žé™…çš„æµ‹è¯•æ¨¡åž‹æ¥è¯„ä¼°ä¸‹å…·ä½“çš„æ€§èƒ½æŸè€—ã€‚

> Qï¼šå¯¹äºŽ Spring Cloud ä¸Ž Spring Cloud Sidecar çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Œå¯¹äºŽä»Ž SOA è½¬åž‹åˆ° Spring Cloud æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®å—ï¼Ÿè°¢è°¢ã€‚

Aï¼šSpring Cloud Sidecar æ˜¯ä»¥ Sidecar æ–¹å¼æ”¯æŒéž Java åº”ç”¨è€Œæä¾›çš„ï¼Œå’Œ Spring Cloud æ²¡æœ‰å¤ªç›´æŽ¥å…³ç³»ã€‚å…·ä½“ä»Ž SOA åˆ° Spring Cloud è½¬åž‹è¿™ä¸ªä¸å¤ªå¥½æ³›æ³›è€Œè°ˆï¼Œè¦ç»“åˆå®žé™…æƒ…å†µåˆ†æžã€‚

> Qï¼šé›†ç¾¤å¤–çš„æœåŠ¡æ˜¯å¦‚ä½•è°ƒç”¨é›†ç¾¤å†…çš„æœåŠ¡çš„ï¼Ÿè‡ªå·±åšçš„åå‘ä»£ç†ä¹ˆï¼Ÿè¿˜æ˜¯ç”¨çš„ Zuulï¼Ÿ

Aï¼šTSF ç”¨çš„æ˜¯è‡ªç ”çš„ï¼Œæ€§èƒ½æ›´é«˜ï¼Œç¨³å®šæ€§æ›´å¥½ã€‚å¯¹äºŽå°è§„æ¨¡ç”¨æˆ·å¯ä»¥è€ƒè™‘ç”¨ Zuulã€‚

> Qï¼šä½ å¥½ï¼Œæ ¹æ®ä½ çš„ä»‹ç»ï¼Œä½ ä»¬ä½¿ç”¨ Sidecar çš„éƒ¨ç½²æ¨¡å¼ï¼Œé‚£åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ„Ÿè§‰å¼€å‘äººå‘˜åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ä¹Ÿå¾—äº†è§£å¦‚ä½•é€šè¿‡é…ç½®æœåŠ¡æœ¬èº«åŠ Envoy Sidecar å®žçŽ°æœåŠ¡çš„é€šè®¯ï¼Œå¯¹äºŽ Envoy æ¥è¯´ï¼Œå¼€å‘äººå‘˜æ¥é…ç½®è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œä½ ä»¬æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼é¿å…è¿™ç§å¤æ‚çš„ï¼Ÿ

Aï¼šå¦‚æžœæ²¡æœ‰ä¸€å¥—è‡ªåŠ¨åŒ–çš„ç®¡ç†éƒ¨ç½²å·¥å…·ï¼Œä»…é äººè‚‰æ”¯æŒè¿˜æ˜¯ä¸é è°±çš„ï¼Œå®šä½é—®é¢˜ä¹Ÿä¸æ–¹éï¼Œè¿™ä¹Ÿæ˜¯ TSF é›†æˆ Envoy è€—æ—¶æ¯”è¾ƒä¹…çš„ä¸€ä¸ªåŽŸå› ã€‚

> Qï¼šIstio å’Œ Kubernetes ç»“åˆä½¿ç”¨æ—¶ï¼ŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘çŽ°æ˜¯æ€Žä¹ˆç”¨çš„ï¼Ÿ

Aï¼šIstio æœ¬èº«æ”¯æŒå¤šç§æœåŠ¡æ³¨å†Œå‘çŽ°æœºåˆ¶ï¼ˆåŒ…æ‹¬ Kubernetesã€Consulã€Digital Foundryã€Ereuka ç­‰ï¼‰ï¼Œåœ¨å¯åŠ¨ Istio æ—¶ä½œä¸ºå‚æ•°æ¥é…ç½®å³å¯ã€‚

> Qï¼šè¯·é—®æ˜¯å¦æœ‰è¿‡ä½¿ç”¨ gRPC é€šè®¯çš„ç›¸å…³æ¡ˆä¾‹æˆ–è€…éœ€è¦æ³¨æ„çš„å‘ï¼Ÿç›®å‰æ˜¯å¦èƒ½å¤Ÿåœ¨ç”Ÿäº§çŽ¯å¢ƒåº”ç”¨ï¼Ÿ

Aï¼šæš‚æ—¶æ²¡æœ‰å‘çŽ° envoy-grpc çš„å‘ï¼Œä¸è¿‡ Istio å®˜æ–¹å¯¹äºŽ gRPC çš„ feature çŠ¶æ€æ˜¯ alphaï¼Œæ‰€ä»¥ä¸ªäººä¸å»ºè®®åœ¨ç”Ÿäº§çŽ¯å¢ƒçš„ä½¿ç”¨ Istioã€‚

---

### 2018-05-23ï¼šå…¨é¢å­¦ä¹  Prometheus

> Qï¼šPrometheus çš„æ•°æ®èƒ½å¦è‡ªåŠ¨åŒæ­¥åˆ° InfluxDB ä¸­ï¼Ÿ

Aï¼šå¯ä»¥ï¼Œé€šè¿‡ remote\_write å¯ä»¥å®žçŽ°ï¼Œå¯ä»¥å‚è€ƒï¼š[github.com/prometheus/apter](https://github.com/prometheus/prometheus/tree/master/documentation/examples/remote_storage/remote_storage_adapter)ã€‚Prometheus é€šè¿‡å°†é‡‡é›†åˆ°çš„æ•°æ®å‘é€åˆ° Adaptorï¼Œå†ç”± Adaptor å®Œæˆå¯¹æ•°æ®æ ¼å¼çš„è½¬æ¢å­˜å‚¨åˆ° InfluxDB å³å¯ã€‚

> Qï¼šè¯·é—®æ•°æ®é‡‡é›†çš„æ—¶é—´æˆ³æ˜¯ Prometheus é‡‡é›†æ•°æ®çš„æ—¶é—´ï¼Œè¿˜æ˜¯å¾®æœåŠ¡äº§ç”Ÿæ•°æ®çš„æ—¶é—´ï¼Ÿ

Aï¼šé‡‡é›†æ—¶é—´ï¼Œçœ‹ node exporter é‡Œé¢è¿”å›žçš„æ ·æœ¬æ•°æ®å¯ä»¥å‘çŽ°å…¶ä¸­å¹¶ä¸åŒ…å«æ—¶é—´æˆ³ã€‚

> Qï¼šPrometheus åšæœåŠ¡å‘çŽ°çš„æ—¶å€™ Job æ˜¯è¢«è‡ªåŠ¨åˆ†é…åˆ°ä¸åŒçš„ Server èŠ‚ç‚¹çš„å—ï¼Ÿå…·ä½“åˆ†é…ç­–æ˜¯ï¼Ÿ

Aï¼šéœ€è¦æ‰‹åŠ¨åˆ†é…ï¼Œç„¶åŽå†é€šè¿‡ [Prometheus Fedreation](https://prometheus.io/docs/prometheus/latest/federation/) è¿›è¡Œæ±‡é›†ã€‚

> Qï¼šPrometheus ä¸€ä¸ª Server æœ€å¤šèƒ½è¿è¡Œå¤šå°‘ä¸ª Jobï¼Ÿ

Aï¼šè¿™ä¸ªæ²¡æœ‰åšå…·ä½“çš„è¯•éªŒï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ Job ä»»åŠ¡é‡ï¼ˆå†™æ“ä½œï¼‰ï¼Œä¼šç›´æŽ¥å½±å“ Prometheus çš„æ€§èƒ½ï¼Œæœ€å¥½ä½¿ç”¨ federation å®žçŽ°è¯»å†™åˆ†ç¦»ã€‚

> Qï¼šè¯·é—®å‘Šè­¦ç”± Grafana å®žçŽ°æ¯”è¾ƒå¥½ï¼Œè¿˜æ˜¯ Alertmanagerï¼Œå¸¸ç”¨çš„ metric åˆ—è¡¨æœ‰æ²¡æœ‰æ±‡æ€»çš„æ¸…å•é“¾æŽ¥åˆ†äº«ä¸‹ï¼ŒåŽ†å²æ•°æ®é»˜è®¤ä¿ç•™æ—¶é—´å¦‚ä½•è®¾ç½®ï¼Ÿ

Aï¼šGrafana è‡ªèº«æ˜¯æ”¯æŒå¤šæ•°æ®æºï¼ŒPromethues åªæ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚ å¦‚æžœåªä½¿ç”¨ Promthues é‚£ç”¨ Alertmanager å°±å¥½äº†ï¼Œé‡Œé¢å®žçŽ°äº†å¾ˆå¤šå‘Šè­¦åŽ»é‡å’Œé™é»˜çš„æœºåˆ¶ï¼Œä¸ç„¶æ”¶åˆ°é‚®ä»¶è½°ç‚¸ä¹Ÿä¸å¤ªå¥½ã€‚ å¦‚æžœéœ€è¦åŸºäºŽ Grafana ä¸­ç”¨åˆ°çš„å¤šç§æ•°æ®æºåšå‘Šè­¦çš„è¯ï¼Œé‚£å°±ç”¨ Grafanaã€‚

> Qï¼šPrometheus ç›‘æŽ§æ•°æ®æŽ¨èå­˜å“ªé‡Œæ˜¯ InfluxDBï¼Œæˆ–è€… ES é‡Œé¢ï¼ŒInfluxDB å•èŠ‚ç‚¹å…è´¹ï¼Œå¤šèŠ‚çš„ä¼¼ä¹Žæ”¶è´¹çš„ï¼Ÿ

Aï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œç›´æŽ¥æ˜¯ä¿å­˜åˆ°æœ¬åœ°çš„ã€‚å¦‚æžœè¦æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç¬¬ä¸‰æ–¹å­˜å‚¨åªè¦å®žçŽ° remote_write æŽ¥å£å°±å¯ä»¥ã€‚ç†è®ºä¸Šå¯ä»¥å¯¹æŽ¥ä»»æ„çš„ç¬¬ä¸‰æ–¹å­˜å‚¨ã€‚ InfluxDB åªæ˜¯å®˜æ–¹æä¾›çš„ä¸€ä¸ªç¤ºä¾‹ä¹‹ä¸€ã€‚

> Qï¼šè¯·é—®å‘Šè­¦è§„åˆ™æ–‡ä»¶å¯ä»¥åŠ¨æ€é…ç½®å—ï¼Ÿæ¯”å¦‚ Prometheus å·²ç»å¯åŠ¨ï¼Œä¸€ä¸ªæ–°çš„å¾®æœåŠ¡ä¸Šçº¿ï¼Œå¹¶éœ€è¦é…ç½®æ–°çš„å‘Šè­¦è§„åˆ™ï¼Œè¿™æ—¶å¯ä»¥åŠ¨æ€æ·»åŠ å‘Šè­¦è§„åˆ™å—ï¼Ÿ

Aï¼š è¿™ä¸ªä¸èƒ½ï¼Œä¸è¿‡ä½ å¯ä»¥è‡ªå·±å®žçŽ°ä¸€ä¸ª sideca åœ¨, ä¸‹å‘å‘Šè­¦æ–‡ä»¶ä»¥åŽï¼Œè®© Prometheus Reload ä¸€æ¬¡ã€‚

> Qï¼šè¯·é—®éƒ¨ç½²å¤šå¥— Prometheus Serverï¼Œè¿™äº›ä¸åŒå®žä¾‹é—´çš„æ•°æ®ä¼šé‡å¤å—ï¼Ÿè¿˜æ˜¯æ¯ä¸ª Prometheus åªç®¡ç†ä¸åŒçš„æœåŠ¡çš„æ•°æ®æ”¶é›†ï¼Ÿ

Aï¼šå¦‚æžœåœ¨ä¸€ä¸ªä¸»æœºä¸Šè¿è¡Œå‡ ä¸ª Node Exporter é‚£æ•°æ®è‚¯å®šä¼šé‡å¤ï¼Œè¿™ä¸ªåº”è¯¥ä»Žéƒ¨ç½²ç»“æž„ä¸ŠåŽ»è€ƒè™‘ã€‚

> Qï¼š è¯·é—®"å†æœ‰ä¸Šå±‚ Prometheus Server å®žçŽ°å¯¹æ•°æ®çš„æ±‡èšã€‚"æ˜¯è¡¨ç¤ºè¯¥ Prometheus ä¼šå¯¹ä¸‹å±‚ Prometheus è¿›è¡Œæ•°æ®æ”¶é›†å—ï¼Ÿä½¿ç”¨ä»€ä¹ˆæŽ¥å£ï¼Ÿ

Aï¼š è¯·å‚è€ƒ [Prometheus Fedreation](https://prometheus.io/docs/prometheus/latest/federation/)ï¼Œè¿™é‡Œä¸»è¦æ˜¯æŒ‡ç”±ä¸€éƒ¨åˆ† Prometheus å®žä¾‹è´Ÿè´£é‡‡é›†ä»»åŠ¡ï¼Œç„¶åŽ Global çš„ Prometheus æ±‡é›†æ•°æ®ï¼Œå¹¶å¯¹å¤–æä¾›æŸ¥è¯¢æŽ¥å£ã€‚ å‡å°‘ Global Prometheus çš„åŽ‹åŠ›ã€‚

> Qï¼šèƒ½å¦æœ‰é›†ç¾¤æ–¹æ¡ˆåˆ†äº«ä¸€ä¸‹ï¼Ÿ

Aï¼š è¯·å‚è€ƒ [https://github.com/yunlzheng/prometheus-book](https://github.com/yunlzheng/prometheus-book/blob/master/ha/READMD.md)ã€‚

> Qï¼šå¤šä¸ª Prometheus ç›‘æŽ§æ–¹æ¡ˆæ•°æ®èƒ½å¦å…±äº«ï¼Ÿæ€Žä¹ˆæŒä¹…åŒ–æ•°æ®ï¼Ÿ

Aï¼šåŒä¸Šï¼Œè¯·å‚è€ƒ [https://github.com/yunlzheng/prometheus-book](https://github.com/yunlzheng/prometheus-book/blob/master/ha/READMD.md)ã€‚

> Qï¼šPrometheus æ€Žä¹ˆåšå‘Šè­¦èšåˆï¼Ÿ

Aï¼š ä¸è¿‡å¦‚æžœæ˜¯å¤šä¸ª Prometheus çš„å‘Šè­¦çš„æ•°æ®çš„è¯ï¼Œæ˜¯å¯ä»¥éƒ½å‘é€åˆ°ä¸€ä¸ª Alertmanagerï¼ˆå•å®žä¾‹æˆ–è€…é›†ç¾¤ï¼‰ç„¶åŽå†ç»Ÿä¸€å¤„ç†ã€‚Alertmanager å¯ä»¥æ ¹æ®å‘Šè­¦çš„æ ‡ç­¾ï¼Œå°†å¤šä¸ªå‘Šè­¦åˆå¹¶æˆä¸€ä¸ªé€šçŸ¥ã€‚

> Qï¼šä¸¤å° Prometheus server å¯å¦ç”¨ Keepalivedï¼Ÿ

Aï¼š ç›´æŽ¥è´Ÿè½½å‡è¡¡å°±å¯ä»¥äº†ï¼Œå¯¹äºŽ Prometheus è€Œè¨€ï¼Œå®žä¾‹ä¹‹é—´æœ¬èº«å¹¶æ²¡æœ‰ä»»ä½•çš„ç›´æŽ¥å…³ç³»ã€‚

> Qï¼šå‘Šè­¦é€šçŸ¥æ”¯æŒè„šæœ¬å—ï¼Ÿ

Aï¼šAlertmanger å¯¹æŽ¥ webhookï¼Œé€šè¿‡è¿™ä¸ªå¯ä»¥è‡ªå·±æ‰©å±•ã€‚

> Qï¼šå’¨è¯¢ä¸‹åœ¨ä¼ ç»ŸæœåŠ¡å™¨ä¸Šå®‰è£… node exporter åŽï¼Œæ€Žä¹ˆæ‰èƒ½åšåˆ°è¢« Prometheus è‡ªåŠ¨æ„ŸçŸ¥ï¼Ÿæ¯å¢žåŠ ä¸€å°æœåŠ¡å™¨å®‰è£… node exporter åŽï¼Œå†ä¿®æ”¹ Prometheus é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·å¤ªä¸æ–¹ä¾¿äº†ã€‚æœ‰ä»€ä¹ˆè‡ªåŠ¨æ³¨å†Œæ–¹æ¡ˆå—ï¼Ÿ

Aï¼šä½¿ç”¨æœåŠ¡å‘çŽ°çš„èƒ½åŠ›ï¼Œfile_sd_config å’Œ consul_sd_config åº”è¯¥éƒ½èƒ½è§£å†³ä½ çš„é—®é¢˜ã€‚

> Qï¼šæœ‰ä¸ªé—®é¢˜ Prometheus æ˜¯å¦‚ä½•ç›‘æŽ§åŸŸåçš„ï¼ŸZabbix å¯ä»¥ç›‘æŽ§åŸŸåï¼ŒPrometheus ä¸çŸ¥é“å¯ä¸å¯ä»¥ï¼Ÿ

Aï¼š ä¸Šé¢åˆ†äº«çš„ Blackbox exporter å°±æ˜¯åšè¿™ä¸ªçš„ã€‚

---

### 2018-05-13ï¼šKubernetes ç½‘ç»œå®‰å…¨ä¹‹è®¿é—®æŽ§åˆ¶æŠ€æœ¯å®žè·µ

> Qï¼šæ ¹æ® [docker-network-cloud](http://cmgs.me/life/docker-network-cloud) çš„æµ‹è¯•ï¼ŒWeave ç½‘ç»œæ–¹æ¡ˆåœ¨æ€§èƒ½ä¸Šæ¯”å…¶ä»–æ–¹æ¡ˆå·®å¾ˆå¤šï¼Œè¿™æ˜¯çœŸçš„å—ï¼Ÿ

Aï¼šè¯¥æ–‡ç« æµ‹è¯•çš„æ—¶å€™å¹¶æœªå¼€å¯ fast-data-pathï¼Œç»è¿‡æˆ‘ä»¬çš„æµ‹è¯•ï¼Œåœ¨ fast-data-path å¼€å¯çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯å¾ˆå¯è§‚çš„ã€‚å†µä¸”è¿™ä¸ªæµ‹è¯•åˆ°ä»Šå¤©å·²ç»è¿‡åŽ»äº† 2 å¹´æ—¶é—´ï¼ŒWeave ç¤¾åŒºä¸€ç›´ä»¥æ¥è¿˜æ˜¯å¾ˆæ´»è·ƒçš„ï¼Œç›¸ä¿¡æœªæ¥åªä¼šæ›´å¥½ã€‚

> Qï¼šè¯·é—®é’ˆå¯¹ Azure å’Œ AWS åœ¨ç½‘ç»œæ–¹é¢æœ‰æ²¡æœ‰é‡åˆ°ä»€ä¹ˆå‘ï¼Ÿå¥½åƒå‰é¢åªçœ‹åˆ° Aliyun çš„ã€‚

Aï¼šAWS æœ‰ä¸ª"æº/ç›®æ ‡åœ°å€æ£€æŸ¥"ï¼ŒåŽä¸ºäº‘ä¹Ÿæœ‰ç±»ä¼¼åŠŸèƒ½ï¼Œå¦‚æžœåœ¨ä½ çš„ç½‘ç»œè®¾è®¡ä¸­äº‘ä¸»æœºå‡ºæ¥æˆ–è¿›åŽ»çš„ IP ä¸Žæ³¨å†Œçš„äº‘ä¸»æœº IP ä¸ç¬¦ï¼Œåˆ™éœ€è¦æŠŠå®ƒå…³æŽ‰ï¼Œå¦å¤–å¦‚æžœä¸å…³"æº/ç›®æ ‡"åœ°æ£€æŸ¥ï¼Œä¹Ÿæ— æ³•æŠŠç›®æ ‡ä¸»æœºè®¾ç½®æˆè·¯ç”±çš„ next-hopï¼›Azure ä¸»è¦å°±æ˜¯é»˜è®¤åŠ¨æ€å…¬ç½‘ IPï¼Œéœ€è¦è°ƒæ•´æˆå›ºå®š IPã€‚å¦å¤–è¦ç‰¹åˆ«æ³¨æ„ä¸»æœºé—´ copy æ•°æ®çš„æµé‡è´¹ã€‚ AWS ä¸Šè®¾ç½® Kubernetes for Windows ç¡®å®žå¤§è´¹å‘¨æŠ˜ï¼Œæˆ‘ä»¬å½“æ—¶å’Œ Kubernetes ç¤¾åŒºçš„ Windows AIG çš„äººä¸€èµ·æžäº†ä¸ªæ–¹æ¡ˆï¼Œæ¯”è¾ƒå¤æ‚ã€‚

> Qï¼šæœ‰æ²¡æœ‰ä»€ä¹ˆåŠžæ³•ä¸ºæ¯ä¸ªå‘½åç©ºé—´è®¾ç½®ä¸€ä¸ªå…¨å±€çš„ NetworkPolicyï¼Œè¿˜æ˜¯è¯´å¿…é¡»è¦å…ˆåˆ›å»ºå‘½åç©ºé—´æ‰èƒ½å®šä¹‰ NetworkPolicyï¼ˆå¸Œæœ›æ˜¯å°±åƒ ClusterRoleBinding ä¸€æ ·ï¼‰ï¼Ÿ

Aï¼šè‡³å°‘çŽ°åœ¨è¿˜ä¸å¯ä»¥ï¼Œä¸€èˆ¬æ¥è¯´è¿™ä¸åº”è¯¥æ˜¯æ™®éçš„éœ€æ±‚ï¼Œå› ä¸ºæ¯ä¸ªåº”ç”¨åœ¨ä¸€ä¸ª Namespace ä¸‹ï¼Œè€Œæ¯ä¸ªåº”ç”¨çš„çš„è®¿é—®æŽ§åˆ¶ç­–ç•¥ä¸å¤§å¯èƒ½æ˜¯ç›¸åŒçš„ã€‚ä»Žå¦ä¸€ä¸ªæ–¹é¢çœ‹ï¼Œä»¥ Kubernetes ç¤¾åŒºçš„é£Žæ ¼ï¼Œä»»ä½•æ™®éçš„éœ€æ±‚æœ€ç»ˆéƒ½æ˜¯ä¼šè¢«å®žçŽ°çš„ï¼Œè€Œä¸”é€Ÿåº¦å¾ˆå¿«ã€‚

---

### 2018-05-09ï¼šTalkingData çš„ Spark On Kubernetes å®žè·µ

> Qï¼šæˆ‘æƒ³é—®æƒé™æ–¹é¢çš„é—®é¢˜ï¼Œå‰é¢æœ‰çœ‹åˆ°ä¸€ä¸ªæäº¤ä½œä¸šçš„ä¾‹å­æ˜¯ sparkï¼summit --files hdfs://host:port/path/to/file1ï¼Œå³ç”¨ Spark å¤„ç† HDFS ä¸Šçš„æ•°æ®ï¼Œå‡ºäºŽæ•°æ®å®‰å…¨çš„è€ƒè™‘ï¼ŒHDFS ä¸€èˆ¬ä¼šå¼€å¯æƒé™è®¤è¯ï¼Œç”¨æˆ·åœ¨ kerberos ä¸Šåšè®¤è¯ï¼Œç”¨åŒä¸€ä¸ªèº«ä»½ä¿¡æ¯è®¿é—® Spark å’Œ HDFSã€‚å¯¹äºŽ Spark on Kubernetes è¿™æ ·ä¸€ä¸ªæ–¹æ¡ˆï¼Œæ˜¯å¦‚ä½•è®¤è¯å¹¶ä¸Ž HDFS ç»“åˆçš„å‘¢ï¼Ÿ

Aï¼šè€å®žè¯´ï¼Œæˆ‘ä»¬åŽŸç”Ÿçš„ Spark é›†ç¾¤ä¹Ÿè¿˜æ˜¯åŸºäºŽ POSIXï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ kerberosã€‚ä¸è¿‡æˆ‘è®¤ä¸ºä¸€ä¸ªå¯è¡Œçš„ç»“åˆæ–¹æ¡ˆæ˜¯ä½¿ç”¨ Kubernetes çš„ webhookï¼Œåœ¨ä½œä¸šæäº¤æ—¶ï¼Œå’Œ kerberos äº¤äº’æ¢å–èº«ä»½éªŒè¯ä¿¡æ¯ã€‚å…·ä½“å¯å‚è€ƒï¼š[https://kubernetes.io/docs/hook/](https://kubernetes.io/docs/admin/authorization/webhook/)ã€‚

> Qï¼šä¸ºä»€ä¹ˆä½¿ç”¨ node label è¿›è¡Œèµ„æºéš”ç¦»ï¼Œè€Œä¸ä½¿ç”¨ ResourceQuota å¯¹å¤šç§Ÿæˆ·è¿›è¡Œèµ„æºéš”ç¦»ï¼Ÿ

Aï¼šç”±äºŽæˆ‘ä»¬å¾ˆå¤šå¤§æ•°æ®è®¡ç®—ä½œä¸šå¯¹ SLA æœ‰å¾ˆé«˜çš„è¦æ±‚ï¼Œå¹¶ä¸” Docker å®žé™…ä¸Šå¯¹å¾ˆå¤šåº”ç”¨çš„èµ„æºé™åˆ¶éƒ½æ”¯æŒçš„ä¸å¥½ã€‚æ‰€ä»¥æˆ‘ä»¬å‰æœŸä¸ºäº†ç¨³å¦¥ï¼Œè¿˜æ˜¯å¯¹è®¡ç®—èµ„æºè¿›è¡Œäº†ç‰©ç†éš”ç¦»ã€‚

> Qï¼šé™¤äº†æ—¥å¿—æ— æ³•èšåˆå¤–ï¼Œæ¯æ¬¡æŸ¥çœ‹ Driver UI ä¹Ÿæ˜¯ä¸ªé—®é¢˜ã€‚æ¯”å¦‚å½“æˆ‘è·‘çš„ç¨‹åºè¾ƒå¤šæ—¶æ€Žä¹ˆæœ‰æ•ˆåœ°ç®¡ç†è¿™äº› completed driver podï¼Ÿ

Aï¼šæ˜¯çš„ï¼ŒSpark On Kubernetes è¿˜ç¼ºå°‘åº”ç”¨ç®¡ç†çš„åŠŸèƒ½ã€‚ä¸è¿‡è¿™ä¸ªåŠŸèƒ½å·²ç»åˆ—åœ¨å®˜æ–¹çš„ todo list é‡Œã€‚

> Qï¼šæ¯”å¦‚ flannel æ˜¯æŠŠ flannel å‚æ•°ä¼ ç»™ Dockerï¼Œä¸€ç§ç”¨ CNI æ’ä»¶ï¼Œä»–ä»¬æœ‰ä½•å·®åˆ«ï¼Ÿ

Aï¼šå®žé™…ä¸Š CNI æ˜¯ Kubernetes çš„æ ‡å‡†ç½‘ç»œæŽ¥å£ï¼Œè€Œ flannel æ˜¯å®žçŽ° Pod é—´é€šä¿¡çš„ç½‘ç»œæ’ä»¶ã€‚CNI ä¸­æœ‰ä¸¤ç±»æ’ä»¶ï¼šä¸€ä¸ªæ˜¯ ipamï¼Œä¸€ä¸ªæ˜¯ network pluginsã€‚flannel å±žäºŽåŽè€…ï¼Œæ˜¯å¯ä»¥çº³å…¥ CNI ç®¡ç†çš„ã€‚

> Qï¼šè¿™é‡Œçš„å¤šç§Ÿæˆ·éš”ç¦»ï¼Œåªæåˆ°ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹çš„è°ƒåº¦ï¼Œé‚£å¯¹äºŽä¸åŒç§Ÿæˆ·çš„ä»»åŠ¡æäº¤ï¼ŒçŠ¶æ€ç›‘æŽ§ï¼Œç»“æžœå‘ˆçŽ°å¦‚ä½•å®žçŽ°éš”ç¦»çš„ï¼Ÿ

Aï¼šä¸åŒçš„ç§Ÿæˆ·å¯¹åº”ä¸åŒçš„ Kubernetes namespaceï¼Œæ‰€ä»¥è‡ªç„¶å®žçŽ°äº†ä»»åŠ¡æäº¤å’ŒçŠ¶æ€ç›‘æŽ§çš„éš”ç¦»ã€‚è‡³äºŽè®¡ç®—ç»“æžœï¼Œæˆ‘ä»¬ä»¥å¾€æ˜¯å•çº¯ç”¨ hdfs path åšéš”ç¦»ã€‚æˆ‘ä»¬ç›®å‰å†…éƒ¨æœ‰å¤§æ•°æ®å¹³å°ï¼Œé‚£é‡ŒçœŸæ­£å®žçŽ°äº†å¤šç§Ÿæˆ·ã€‚

> Qï¼šSpark On Kubernetes è¿™ç§æ–¹å¼ä¸ºå¼€å‘äººå‘˜å¢žåŠ äº†éš¾åº¦ï¼Œä¸åƒå…¶ä»–çš„é›†ç¾¤æ–¹æ¡ˆï¼Œå¼€å‘äººå‘˜é™¤äº†è¦ä¼š Spark è¿˜è¦ä¼š Kubernetesï¼Œè¯·é—®æ€Žä¹ˆæŽ¨ï¼Ÿ

Aï¼šå®žé™…ä¸Š Spark On Kubernetes å¯¹å¤§æ•°æ®å¼€å‘äººå‘˜æ˜¯é€æ˜Žçš„ï¼Œä»»åŠ¡çš„æäº¤æ–¹å¼å¹¶æ²¡æœ‰æ”¹å˜ï¼Œåªæ˜¯åŠ äº†ä¸€äº›é¢å¤–çš„ optionã€‚å¹¶ä¸”æˆ‘ä»¬ä¸Šå±‚æ˜¯æœ‰ç»Ÿä¸€çš„å¤§æ•°æ®å¹³å°ï¼Œè¿›è¡Œä½œä¸šæäº¤ã€‚

> Qï¼šåœ¨ä½¿ç”¨ HDFS å­˜å‚¨èµ„æºä¸‹ï¼Œå¦‚æžœä¸ä½¿ç”¨ Spark çš„æ•°æ®æœ¬åœ°æ€§ï¼Œå¤§é‡æ•°æ®ä¹‹é—´çš„ä¼ è¾“ï¼Œmap å’Œ reduce æ“ä½œæ˜¯å¦ä¼šå½±å“ Spark çš„è®¡ç®—æ€§èƒ½å‘¢ï¼Ÿ

Aï¼šä¸ªäººè®¤ä¸ºè‚¯å®šä¼šæœ‰å½±å“ï¼Œå› ä¸ºæ¯æ¬¡ä»Ž HDFS è¯»å–ï¼Œä¼šå¸¦æ¥å·¨å¤§çš„ç½‘ç»œæµé‡ã€‚ä½†æ˜¯æˆ‘æœ¬èº«å¯¹ Spark çš„æ•°æ®æœ¬åœ°æ€§æ²¡æœ‰ä»€ä¹ˆç ”ç©¶ã€‚åŽæœŸæˆ‘ä»¬è®¡åˆ’å°† HDFS å’Œ Kubernetes æ··éƒ¨ï¼Œå°†æ•°æ®å°½é‡é è¿‘è®¡ç®—èŠ‚ç‚¹ï¼Œä¸çŸ¥é“è¿™ç§æ–¹å¼èƒ½å¦ç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ Spark on Kubernetes çš„ external-shuffle-serviceï¼Œä»Žè€Œä½¿ç”¨ hostpath volume å°† shuffle å’Œ executor pods æ‰“é€šã€‚

> Qï¼šSpark ä¼šä½œä¸ºå“ªç§èµ„æºéƒ¨ç½²æ–¹å¼éƒ¨ç½²ï¼ŸDeployment è¿˜æ˜¯ StatefulSetï¼Ÿæˆ–è€…å…¶ä»–ï¼ŸSpark åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸Šéƒ¨ç½²æœ‰éœ€è¦ä»€ä¹ˆèµ„æºé…ç½®ï¼Ÿèƒ½å¦åˆ†äº«ä¸‹ TalkingData çš„ç”Ÿäº§çŽ¯å¢ƒæ˜¯å¦‚ä½•åˆ†é… Spark èµ„æºçš„ï¼Ÿ

Aï¼šSpark On Kubernetes å®žé™…å°±æ˜¯åˆ›å»ºäº† Spark driver headless serviceï¼Œç„¶åŽåˆ›å»º Spark driver podï¼Œæœ€åŽç”± driver åˆ›å»º executors podsã€‚ä¸Šè¿°åˆ†äº«ä¸­æˆ‘ä¹Ÿæåˆ°äº†ï¼Œç›®å‰æˆ‘ä»¬è¿˜æ˜¯ä»¥ç‰©ç†æœºä½œä¸º spark èµ„æºåˆ†é…çš„å•ä½ã€‚

> Qï¼šYarn vs Kubernetes ä¼˜ç¼ºç‚¹?

Aï¼šæˆ‘ä»¬ä»¥å‰çš„ Spark å°±æ˜¯é‡‡ç”¨ Spark On Yarn çš„æ–¹å¼ï¼Œä¸è¿‡æˆ‘å¯¹ Yarn ä¸æ˜¯éžå¸¸äº†è§£ã€‚ä¹‹æ‰€ä»¥é‡‡ç”¨ Kubernetes æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬æƒ³ç»Ÿä¸€åº•å±‚çš„èµ„æºè°ƒåº¦å¹³å°ã€‚ä½†æ˜¯ Yarn ç›®å‰è¿˜æ˜¯å’Œ Hadoop ç”Ÿæ€å¼ºè€¦åˆçš„ã€‚

---

### 2018-04-24ï¼šHelmï¼šå¼ºå¤§çš„ Kubernetes åŒ…ç®¡ç†å·¥å…·

> Qï¼šHelm ç»“åˆ CD æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®å—ï¼Ÿ

Aï¼šé‡‡ç”¨ Helm å¯ä»¥æŠŠé›¶æ•£çš„ Kubernetes åº”ç”¨é…ç½®æ–‡ä»¶ä½œä¸ºä¸€ä¸ª Chart ç®¡ç†ï¼ŒChart æºç å¯ä»¥å’Œæºä»£ç ä¸€èµ·æ”¾åˆ° Git åº“ä¸­ç®¡ç†ã€‚Helm è¿˜ç®€äº†åœ¨ CI/CD Pipeline çš„è½¯ä»¶éƒ¨ç½²æµç¨‹ã€‚é€šè¿‡æŠŠ Chart å‚æ•°åŒ–ï¼Œå¯ä»¥åœ¨æµ‹è¯•çŽ¯å¢ƒå’Œç”Ÿäº§çŽ¯å¢ƒå¯ä»¥é‡‡ç”¨ä¸åŒçš„ Chart å‚æ•°é…ç½®ã€‚

> Qï¼šè¯·é—®ä¸‹å¤šçŽ¯å¢ƒï¼ˆtestã€stagingã€productionï¼‰çš„ä¸šåŠ¡é…ç½®å¦‚ä½•ç®¡ç†å‘¢ï¼Ÿé€šè¿‡ Heml æ‰“åŒ… ConfigMap å—ï¼Œæ¯”å¦‚é…ç½®æ–‡ä»¶æ›´æ–°ï¼Œä¹Ÿè¦é‡æ–°æ‰“ Chart åŒ…å—ï¼Ÿè°¢è°¢ï¼Œè¿™å—æˆ‘æ¯”è¾ƒä¹±ã€‚

Aï¼šChart æ˜¯æ”¯æŒå‚æ•°æ›¿æ¢çš„ï¼Œå¯ä»¥æŠŠä¸šåŠ¡é…ç½®ç›¸å…³çš„å‚æ•°è®¾ç½®ä¸ºæ¨¡æ¿å˜é‡ã€‚ä½¿ç”¨ Helm install Chart çš„æ—¶å€™å¯ä»¥æŒ‡å®šä¸€ä¸ªå‚æ•°å€¼æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠä¸šåŠ¡å‚æ•°ä»Ž Chart ä¸­å‰¥ç¦»äº†ã€‚ä¾‹å­ï¼šhelm install --values=myvals.yaml wordpressã€‚

> Qï¼šHelm èƒ½è§£å†³æœåŠ¡ä¾èµ–å—ï¼Ÿ

Aï¼šå¯ä»¥çš„ï¼Œåœ¨ Chart å¯ä»¥é€šè¿‡ requirements.yaml å£°æ˜Žå¯¹å…¶ä»– Chart çš„ä¾èµ–å…³ç³»ã€‚å¦‚ä¸‹é¢å£°æ˜Žè¡¨æ˜Ž Chart ä¾èµ– Apache å’Œ MySQL è¿™ä¸¤ä¸ªç¬¬ä¸‰æ–¹ Chartã€‚

> Qï¼šChart çš„ reversion å¯ä»¥è‡ªå®šä¹‰å—ï¼Œæ¯”å¦‚è·Ÿ Git çš„ tagï¼Ÿ

Aï¼šè¿™ä½æœ‹å‹åº”è¯¥æ˜¯æŠŠ Chart çš„ version å’Œ Release çš„ reversion æžæ··äº†ï¼Œå‘µå‘µã€‚ Chart æ˜¯æ²¡æœ‰ reversion çš„ï¼ŒChart éƒ¨ç½²çš„ä¸€ä¸ªå®žä¾‹ï¼ˆReleaseï¼‰æ‰æœ‰ Reversionï¼ŒReversion æ˜¯ Release è¢«æ›´æ–°åŽè‡ªåŠ¨ç”Ÿæˆçš„ã€‚

> Qï¼šè¿™ä¸ªç®€å•ä¾‹å­å¹¶æ²¡æœ‰çœ‹å‡º Helm ç›¸æ¯” Kubectl æœ‰å“ªäº›ä¼˜åŠ¿ï¼Œå¯ä»¥ç®€è¦è¯´ä¸€ä¸‹å—ï¼Ÿ

Aï¼šHelm å°† Kubernetes åº”ç”¨ä½œä¸ºä¸€ä¸ªè½¯ä»¶åŒ…æ•´ä½“ç®¡ç†ï¼Œä¾‹å¦‚ä¸€ä¸ªåº”ç”¨å¯èƒ½æœ‰å‰ç«¯æœåŠ¡å™¨ï¼ŒåŽç«¯æœåŠ¡å™¨ï¼Œæ•°æ®åº“ï¼Œè¿™æ ·ä¼šæ¶‰åŠå¤šä¸ª Kubernetes éƒ¨ç½²é…ç½®æ–‡ä»¶ï¼ŒHelm å°±æ•´ä½“ç®¡ç†äº†ã€‚å¦å¤– Helm è¿˜æä¾›äº†è½¯ä»¶åŒ…ç‰ˆæœ¬ï¼Œä¸€é”®å®‰è£…ã€å‡çº§ã€å›žé€€ã€‚Kubectl å’Œ Helm å°±å¥½æ¯”ä½ æ‰‹å·¥ä¸‹è½½å®‰è£…ä¸€ä¸ªåº”ç”¨ å’Œä½¿ç”¨ apt-get å®‰è£…ä¸€ä¸ªåº”ç”¨çš„åŒºåˆ«ã€‚

> Qï¼šå¦‚ä½•åœ¨ Helm install æ—¶æŒ‡å®šå‘½åç©ºé—´ï¼Ÿ

Aï¼š`helm install local/testapi-chart --name testapi --namespace mynamespace`ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2018 å¹´ 4 æœˆ 24 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚

---

### 2018-04-17ï¼šDBaaS åœ¨é‡‘èžç”Ÿäº§çŽ¯å¢ƒçš„è½åœ°å®žè·µ

> Qï¼šè¯·é—®æ˜¯é‡‡å–ä»€ä¹ˆç­–ç•¥å‡çº§è¿™äº›æ•°æ®åº“ç±»åž‹çš„æœåŠ¡ï¼Ÿå‡çº§è¿‡ç¨‹æœ‰å®•æœºæ—¶é—´å—ï¼Ÿå¦‚æžœæ²¡æœ‰ï¼Œä¼šæœ‰åŒå†™é—®é¢˜å—ï¼Ÿ

Aï¼šåœ¨è®¾è®¡ä¸­æ˜¯å‡çº§æ“ä½œå°±æ˜¯æ›´æ–°å®¹å™¨é•œåƒã€‚æ›´æ–°ç­–ç•¥ä¼šæ ¹æ®æ•°æ®åº“çš„é«˜å¯ç”¨ç»“æž„è¿›è¡Œæ‘‡æ‘†å‡çº§ã€‚

> Qï¼šå…·ä½“æ˜¯å®žçŽ°æ–¹å¼æ˜¯æ€Žæ ·ï¼Œæœ‰æ²¡æœ‰ç”¨åˆ° StatefulSetï¼Œæˆ–è€… StatefulSet çš„åŒºåˆ«ï¼Ÿ

Aï¼šæ²¡æœ‰ç”¨åˆ° StatefulSetï¼Œç›®å‰æˆ‘ä»¬æž„å»ºäº†ä¸€ä¸ªåä¸ºæœåŠ¡å¯¹è±¡ï¼Œæ¥ç®¡ç†æœåŠ¡çš„ã€‚åº”è¯¥è¯´æˆ‘ä»¬æœåŠ¡å¯¹è±¡æ¯” service æ›´å¤æ‚ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ç”±å¤šä¸ªä¸åŒç±»åž‹çš„ Pod ç»„æˆçš„ã€‚

> Qï¼šè¯·é—®ä¸€ä¸‹ä½ ä»¬çš„ binlog å¤šé•¿æ—¶é—´è¿‡æœŸï¼Œæœ‰ç”¨ä»€ä¹ˆæŒä¹…åŒ–çš„æ–¹å¼å­˜å‚¨å—ï¼Ÿ

Aï¼šæˆ‘ä»¬åœ¨å°è£…å®¹å™¨é•œåƒæ—¶ï¼Œé’ˆå¯¹ä¸åŒæœåŠ¡é•œåƒæœ‰å¤–å›´çš„é…å¥—è„šæœ¬ã€‚ç±»ä¼¼äºŽ Kubernetes ä¸­ sidecat çš„å®žçŽ°ã€‚ç„¶åŽé€šè¿‡å®šæœŸè°ƒç”¨æ–¹å¼å¤‡ä»½ binlog åˆ°å¤‡ä»½å­˜å‚¨ã€‚å¹¶ä¸”æ¸…ç†å¤‡ä»½è¿‡çš„ binlogã€‚

> Qï¼šè¿˜æœ‰å…³äºŽä¸­é—´ä»¶å’Œé«˜å¯ç”¨çš„é€‰æ‹©ï¼Œæˆ‘ä»¬ç”¨ MaxScale å’Œ MHAï¼Œä½†æ˜¯å¹¶ä¸æ˜¯éžå¸¸ç¨³å®šï¼Ÿ

Aï¼šçš„ç¡®ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡ DBaaS ä¹Ÿè€ƒè™‘åˆ°äº†ï¼Œç”±äºŽç›®å‰åœ¨ MySQL ä¸­é—´ä»¶å’Œé«˜å¯ç”¨å¥—ä»¶æ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„å¼€æºäº§å“ï¼Œæ‰€ä»¥å¾ˆéš¾è¯´ä½ å¿…é¡»ç”¨å“ªä¸ªæ–¹æ¡ˆå®žçŽ°ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å¼€å‘ä¸­å°±å°†è¿™æ ·çš„éœ€æ±‚è®¾è®¡ä¸ºçµæ´»çš„æœåŠ¡æž¶æž„å®šä¹‰ï¼Œæˆ‘ä»¬å¹³å°æ”¯æŒä¸åŒç±»åž‹ MySQL é«˜å¯ç”¨æ–¹æ¡ˆå’Œä¸­é—´ä»¶æ–¹æ¡ˆã€‚æˆ‘ä»¬åœ¨ä¸­å›½é“¶è”æ˜¯è‡ªå·±å¼€å‘çš„é«˜å¯ç”¨ä¸­é—´ä»¶æ–¹æ¡ˆï¼Œé€šè¿‡é«˜å¯ç”¨ç»„ä»¶å‘çŽ°æ•…éšœè¿›è¡Œéš”ç¦»ï¼Œä½¿ç”¨ Proxy ç»„ä»¶è¿›è¡Œæ•°æ®è·¯ç”±ï¼Œä½¿ç”¨ MySQL åšæ•°æ®å¤åˆ¶ã€‚åœ¨æˆ‘ä»¬è®¾è®¡ä¸­ï¼Œå¯å®šåˆ¶ä¸åŒæœåŠ¡æž¶æž„æ¥è¿›è¡ŒæœåŠ¡çš„ç®¡ç†ã€‚

> Qï¼šè¯·é—®åœ¨è¿™å¥—å¹³å°é‡Œé¢æ”¯æŒæ¯”å¦‚è¯´ï¼Œå‰ç«¯å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©æ•°æ®åº“è¿è¡Œçš„æ–¹å¼ï¼ˆå•æœºï¼‰ï¼ˆè¿˜æ˜¯è¯»å†™åˆ†ç¦»ã€ä¸»ä»Žæž¶æž„ï¼‰ï¼Œè¿™ä¸ªæ˜¯è‡ªåŠ¨åŒ–é…ç½®çš„å—ï¼Ÿè¿™ä¸ªè¿‡ç¨‹æ˜¯æå‰æž„å»ºçš„å®¹å™¨é•œåƒå¯¹å—ï¼Ÿ

Aï¼šæ•°æ®åº“å®¹å™¨é•œåƒæ˜¯ç›¸åŒçš„ï¼Œå•æœºã€ä¸»ä»Žã€è¯»å†™åˆ†ç¦»ç­‰ä¸åŒæœåŠ¡æž¶æž„ä¼šç”Ÿæˆç›¸åº”çš„é…ç½®æ–‡ä»¶å’Œå¯åŠ¨é¡¹ï¼Œç®¡ç†é€»è¾‘ã€‚æ•´ä½“ç®¡ç†ä¼šä½¿ç”¨å®šä¹‰æœåŠ¡æž¶æž„é…ç½®ä¿¡æ¯è¿›è¡Œè‡ªåŠ¨è§£æžäº§ç”Ÿç›¸å¯¹åº”çš„ç®¡ç†æ“ä½œã€‚

> Qï¼šå•å…ƒã€å­æœåŠ¡ã€æœåŠ¡çš„ç†è§£è¿˜æ˜¯æ¯”è¾ƒæŠ½è±¡ï¼Œæœ‰æ›´æ˜“ç†è§£çš„ä¾‹å­å—ï¼Ÿ

Aï¼šå•å…ƒç›¸å½“äºŽä¸€ä¸ªæˆ‘ä»¬è‡ªå·±æž„å»ºçš„ Podï¼Œä½†ä¸åŒäºŽ Podã€‚å•å…ƒåªä¼šåŒ…æ¢ä¸€ä¸ªå®¹å™¨ã€‚å­æœåŠ¡å†…æ˜¯å¤šä¸ªç›¸åŒç±»åž‹çš„å•å…ƒï¼Œè¿™æ ·å•å…ƒå°±å¯ä»¥éƒ¨ç½²åœ¨ä¸åŒç‰©ç†æœºä¸Šï¼Œå¹¶ä¸”å®Œæˆæ•°æ®åº“çš„å¤åˆ¶å…³ç³»ã€‚æœåŠ¡æ˜¯å¤šä¸ªç±»åž‹çš„å­æœåŠ¡çš„é›†åˆï¼ŒæœåŠ¡å†…çš„å­æœåŠ¡ä¼šæœ‰å…³è”å…³ç³»ï¼Œæ¯”å¦‚ä¸€ä¸ªå®Œæ•´çš„ Redis å¯ä»¥æœ‰ä¸€ç»„ä¸‰ä¸ª sentinel ç»„æˆçš„å­æœåŠ¡ + ä¸€ç»„å¤š Redis Proxy çš„å­æœåŠ¡ + å¤šç»„ä¸»ä»Žå¤åˆ¶çš„ Reidsã€‚åŒæ ·çš„ç±»åž‹ç”šè‡³å¯ä»¥æ˜ å°„åˆ° TiDB ä¸Šï¼Œå¯ä»¥æœ‰ä¸€ç»„ä¸‰ä¸ª TiDB + ä¸€ç»„ä¸‰ä¸ª PD + ä¸€ç»„äº”ä¸ª TiKVã€‚

> Qï¼šå¦‚ä½•ç†è§£æ•°æ®åº“åº”ç”¨æ‹†åˆ†å’Œå®¹å™¨èƒŒé“è€Œé©°ï¼Ÿ

Aï¼šåœ¨å®¹å™¨å¼€å§‹é˜¶æ®µï¼Œå¤§å®¶ä¼šæœ‰å…±åŒçš„è®¤è¯†å°±æ˜¯å®¹å™¨åªé€‚åˆè¿è¡Œæ— çŠ¶æ€æœåŠ¡ã€‚ç›´åˆ°å¤§å®¶å¯¹å®¹å™¨éœ€æ±‚è¶Šæ¥è¶Šå¤šï¼Œæœ‰äº† Petsetï¼Œæœ‰äº† StatefulSetï¼Œç”šè‡³æœ‰äº† MySQL Operaterã€‚ä½†å›žå½’åˆ°å®¹å™¨æœ¬è´¨è¿˜æ˜¯ä¸ºç»Ÿä¸€è¿ç»´æ ‡å‡†ï¼Œå¿«é€Ÿçµæ´»çš„ç®¡ç†èµ„æºã€‚ä½†æ˜¯æœ‰çŠ¶æ€æœåŠ¡å¤©ç”Ÿå°±æ˜¯é‡çš„ï¼Œéœ€è¦ä½¿ç”¨ç»§æ‰¿å¼çš„æ–¹å¼è¿›è¡Œç®¡ç†ã€‚ä½†ä¸ºäº†å°†æœ‰çŠ¶æ€æœåŠ¡æ”¾åˆ°å®¹å™¨ï¼Œäº«å—å®¹å™¨çš„ä¼˜åŠ¿ï¼Œå°±å¿…é¡»è¿›è¡Œè®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œè¿™äº›å…³é”®èµ„æºçš„åˆ†ç¦»ã€‚

> Qï¼šè¯·é—®ä½ ä»¬çš„å¹³å°æ˜¯ç”¨ä»€ä¹ˆè¯­è¨€å†™çš„ï¼Œæœ‰ç”¨åˆ°é“¾è·¯è·Ÿè¸ªå—ï¼Ÿ

Aï¼šæˆ‘ä»¬å¹³å°å…¨éƒ¨ç»„ä»¶éƒ½æ˜¯ç”¨ Golang å†™çš„ã€‚ç›®å‰é“¾è·¯è·Ÿè¸ªè¿˜æ²¡æœ‰ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯é€šè¿‡æˆ‘ä»¬çš„è‡ªç ”çš„ç›‘æŽ§å¹³å°ï¼ŒèŽ·å–ç›‘æŽ§æ•°æ®ï¼Œç›‘æŽ§ç‰©ç†æœºï¼Œå®¹å™¨ï¼Œå’Œå®¹å™¨å†…æœåŠ¡çš„ä¿¡æ¯ï¼Œè¿›è¡Œé«˜å¯ç”¨çš„ç®¡ç†ï¼Œä¹Ÿæ­£åœ¨å’Œäººå·¥æ™ºèƒ½å…¬å¸åˆä½œï¼Œå¯¹è¿ç»´æ•°æ®è¿›è¡Œåˆ†æžï¼Œè¿›è¡Œæ•…éšœæ™ºèƒ½åˆ†æžã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2018 å¹´ 4 æœˆ 17 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚

åˆ†äº«äºº**é²ç³ï¼Œå¯Œéº¦ç§‘æŠ€äº§å“æž¶æž„å¸ˆï¼Œä¸­å›½é“¶è” DBaaS é¡¹ç›®æž¶æž„å¸ˆ**ã€‚

---

### 2018-04-16ï¼šKubernetes on DC/OS æœ€ä½³å®žè·µ

> Qï¼šç›®å‰æœ‰å…¬å¸è½åœ°è¿™å¥—æ–¹æ¡ˆä¸Šç”Ÿäº§å—ï¼Ÿ åœ¨ AWS æ˜¯å¦å®žè·µè¿‡è¿™ä¸ªæ–¹æ¡ˆï¼Ÿ

Aï¼šKubernetes on DC/OS æ˜¯åŽ»å¹´ä¹æœˆä»½å®˜æ–¹ç”± Mesosphere æ”¯æŒï¼Œç»è¿‡åŠå¹´çš„è¿­ä»£å¼€å‘ï¼Œç‰ˆæœ¬å·²ç» GAã€‚ç›®å‰å›½å¤–çš„æ¡ˆä¾‹è¾ƒå¤šä¸€äº›ï¼Œå›½å†…çš„ä¸­å›½è”é€šä¸Žä¸­å›½çŸ³åŒ–æ­£åœ¨å°è¯•ä½¿ç”¨ï¼Œå›½å†…çš„ä¸­å›½è”é€šå¸Œæœ›ç»“åˆç€ Fabric8 ä¸€èµ·æ¥ä½¿ç”¨ï¼Œä¸­çŸ³åŒ–å¸Œæœ›ç”¨æ¥è¿è¡Œå¾®æœåŠ¡ã€‚ç›®å‰ AWS Marketplace æ”¯æŒ DC/OSï¼Œå›½å¤–å¾ˆå¤šç”¨æˆ·ä¹Ÿåœ¨ç”¨ AWS æž„å»ºæ··åˆäº‘æ–¹æ¡ˆï¼ŒKubernetes on DC/OS å±è”½äº†åº•å±‚ï¼Œæ‰€ä»¥åªè¦ DC/OS è¿è¡Œåœ¨ AWS ä¸Šï¼ŒKubernetes å°±æ²¡æœ‰é—®é¢˜ã€‚

> Qï¼šKubeletã€Kube-proxyã€CoreDNS æ˜¯ä¸€ä¸€ä¸ª Pod ä¸­çš„ä¸‰ä¸ªå®¹å™¨è¿è¡Œåœ¨ Agent èŠ‚ç‚¹ä¸Šï¼Ÿè¿˜æ˜¯ä»¥ä¸‰ä¸ªç‹¬ç«‹çš„ UCR å®¹å™¨è¿è¡Œåœ¨ Agent ä¸Šï¼Ÿ

Aï¼šæ˜¯é€šè¿‡ä¸‰ä¸ª UCR ç‹¬ç«‹çš„å®¹å™¨è¿è¡Œåœ¨åŒä¸€ä¸ª Mesos Agent ä¸Šã€‚

> Q: è¿›æ¥çš„æ™šäº†ï¼Œé‚£ä¸ªå›¾å½¢ç®¡ç†æŽ§åˆ¶å°å«ä»€ä¹ˆåå­—ï¼Ÿ

Aï¼šKube-dashboardï¼Œæ˜¯ Kubernetes çš„ä¸€ä¸ª add-on ç»„ä»¶ã€‚

> Qï¼šDC/OS å…¨ç§°æ˜¯ä»€ä¹ˆï¼Ÿç‰©ç†æœºè·‘è™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºè·‘ DC/OSï¼ŒDC/OS åˆåµŒå¥—å®¹å™¨ä¼šä¸ä¼šæ— æ­¢å¢ƒçš„æž¶æž„ï¼Œè¶Šæ¥è¶Šå¤æ‚ï¼Ÿ

Aï¼šå…¨ç§°å°±æ˜¯ DC/OSï¼Œä¹Ÿç§° Datacenter Operating Systemï¼Œæ•°æ®ä¸­å¿ƒæ“ä½œç³»ç»Ÿã€‚ä¸ä¼šæ— æ­¢å¢ƒçš„ï¼ŒUCR å®˜æ–¹æ”¯æŒåµŒå¥—ä¸‰åäºŒå±‚ï¼Œä½†æ˜¯æˆ‘ä»¬å®¹å™¨å±‚é¢ä¸€èˆ¬åªåµŒå¥—ä¸€å±‚ï¼Œè€Œä¸”å®¹å™¨ä¸Žè™šæ‹Ÿæœºæœ€å¤§çš„ä¸åŒå°±æ˜¯ä¸ä¼šé€ æˆ OS çš„å¼€é”€ï¼Œæ‰€ä»¥å¤šå‡ å±‚åµŒå¥—é—®é¢˜ä¹Ÿä¸å¤§ã€‚

> Qï¼šå¦‚æžœåŒä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„å…¶ä»–åº”ç”¨æ²¡æœ‰å’Œ Kubernetes åœ¨ä¸€ä¸ª VXLAN é‡Œé¢ï¼Œä»–ä»¬å¦‚ä½•é€šè®¯ï¼Œå¯ä»¥é€šè¿‡ VIP å—ï¼Ÿ

Aï¼šéœ€è¦é€šè¿‡è´Ÿè½½å‡è¡¡ã€Node port æˆ– Ingress çš„æ–¹å¼ï¼Œä¸ä¹…ä¹‹åŽ DC/OS çš„æœåŠ¡ä¼šå’Œ Kubernetes çš„æœåŠ¡å…¨é¢èžåˆã€‚

> Qï¼šå¾ˆé«˜å…´èƒ½çœ‹åˆ°å…³äºŽ Mesos çš„åˆ†äº«ï¼Œç›®å‰å‘çŽ° Mesos è¶Šæ¥è¶Šè¢«è¾¹ç¼˜åŒ–çš„è¶‹åŠ¿ï¼Œæ¯”æ–¹è¯´ Cassandra Framework å·²ç»åœ¨ GitHub ä¸Šæ ‡è®°ä¸ºè¿‡æ—¶äº†ï¼Œæˆ‘çš„é—®é¢˜æ˜¯ DC/OS ä»¥åŽä¼šæ˜¯ Mesos ä¸»æµçš„éƒ¨ç½²æ–¹å¼å—ï¼Ÿç”¨ Mesos å¦‚æžœè¦ä½¿ç”¨ Framework çš„è¯æ˜¯ä¸æ˜¯è¦è‡ªå·±åŽ»å°è£…ï¼Ÿ

Aï¼šä¸èƒ½è¯´è¢«è¾¹ç¼˜åŒ–ï¼Œå¾ˆå¤šå¤§åž‹äº’è”ç½‘åŽ‚å•†éƒ½æ˜¯ä½Žè°ƒçš„åœ¨ä½¿ç”¨ï¼Œæ¯•ç«ŸæŠ€æœ¯å®šä½è¿˜æ˜¯ä¸åŒï¼Œè€Œä¸” Mesos ç¡®å®žåœ¨èµ„æºç®¡ç†æ–¹é¢æœ‰å…¶ç‹¬ç‰¹çš„ä¼˜åŠ¿ã€‚è€Œä¸” Cassandra è™½ç„¶åœ¨ GitHub ä¸Šè¿‡æ—¶äº†ï¼Œä½†æ˜¯åœ¨ Mesosphere å†…éƒ¨ä»Žæœªè¿‡æ—¶ï¼Œç‰ˆæœ¬æ›´æ–°çš„å¾ˆå¿«ï¼Œè¿˜å¯ä»¥æ— ç¼è¿ç§»ã€‚DC/OS çš„æ ¸å¿ƒåŸºäºŽ Mesosï¼Œè¿™ä¸ªä¸ä¼šå˜ï¼Œä½†æ˜¯æ”¯æŒ Kubernetes æ˜¯æˆ‘ä»¬çš„é‡ä¸­ä¹‹ä¸­ï¼Œè¿™ä¸ªä¹Ÿä¸ä¼šå˜ã€‚DC/OS çš„ Framework ç›®å‰å·²ç»å¥½å‡ åç§ï¼ŒMesosphere ä¹Ÿåœ¨ä¸æ–­åœ°æ‰©å¤§ç”Ÿæ€ï¼Œæ„Ÿå…´è¶£å¯ä»¥åˆ°å®˜æ–¹ Universe ä¸ŠæŸ¥çœ‹ï¼Œé‚£é‡Œè¯¦ç»†åœ°ä¾‹ä¸¾äº† Framework ä»¥åŠä¸åŒçš„ç‰ˆæœ¬å·ã€‚

> Qï¼šServer Agent çš„é«˜å¯ç”¨ï¼Œä»¥åŠå®ƒä»¬ä»»åŠ¡è°ƒåº¦å’Œ Framework ä¸Šçš„å®¹å™¨è°ƒåº¦ï¼Œä»»åŠ¡è°ƒåº¦æœ‰å…³ç³»å—ï¼Ÿ

Aï¼šServer Agentï¼Œæ‚¨æ˜¯æŒ‡ Mesos Agent å—ï¼ŸDC/OS ä¸Ž VMware ç­‰è™šæ‹ŸåŒ–å¹³å°åœ¨æŸäº›æ–¹é¢æœ‰ç±»ä¼¼çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´ï¼Œè‹¥ Agent èŠ‚ç‚¹å‡ºçŽ°æ•…éšœï¼ŒDC/OS ä¸Šçš„ Framework ä¼šå°† task è‡ªåŠ¨é‡å¯ï¼Œæˆ–è€…åœ¨å…¶ä»–ä¸»æœºé‡å¯ï¼Œå¯¹äºŽæœ‰çŠ¶æ€æœåŠ¡ï¼Œå»ºè®®ä½¿ç”¨å…±äº«å­˜å‚¨æ–¹æ¡ˆã€‚

> Qï¼šå¦‚æžœåŒä¸€ä¸ªé›†ç¾¤å†…çš„å…¶ä»–åº”ç”¨å’Œ Kubernetes ä¸åœ¨ä¸€ä¸ª VXLAN ä¸­ï¼Œä»–ä»¬ä¹‹é—´å¯ä»¥æ€Žæ ·é€šè®¯ï¼Ÿæœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆï¼Ÿ

Aï¼šè‹¥ DC/OS çš„æœåŠ¡ä¸Ž Kubernetes ä¸åœ¨åŒä¸€ä¸ª VXLAN ä¸Šï¼Œç›®å‰å°±éœ€è¦ä½¿ç”¨ Kubernetes çš„ NODE IPï¼ŒIngress æˆ–åˆ™ LBï¼Œè¿™ä¸ªå’Œå¼€æº Kubernetes ä½¿ç”¨æ–¹å¼ä¸€è‡´ã€‚å½“å‰çš„ Kubernetes å†…çš„æœåŠ¡è¿˜åªèƒ½å¤„åœ¨ä¸€ä¸ª flat network å†…ï¼Œä½†æ˜¯å¯ä»¥é›†æˆç¬¬ä¸‰æ–¹ Pluginï¼Œè¿™ä¸ªå’Œ DC/OS å…³ç³»ä¸å¤§ï¼Œç”¨æˆ·å¯è‡ªè¡Œé€‰æ‹©ã€‚

> Qï¼šå®žé™…ä½¿ç”¨ä¸­ Kafkaã€Elastic ç»„ä»¶ä¼šå‡ºçŽ°é›†ç¾¤ä¸ç¨³å®šæƒ…å†µï¼Œæ¯”å¦‚ Kafka èµ·ä¸‰ä¸ª brokerï¼Œæ­»æ´»å¯åŠ¨ä¸äº†ä¸‰ä¸ªçš„æƒ…å†µï¼Œæœ‰å¥½çš„è§£å†³åŠžæ³•å—ï¼Ÿè¡¥å……ï¼Œå› ä¸ºæ˜¯ Framework çš„æ–¹å¼æ„Ÿè§‰ä¸å¦‚ Docker å¥½ç®¡ç†ã€‚

Aï¼šèµ·ä¸æ¥çš„åŽŸå› æœ‰å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘å¾ˆå°‘é‡è§ä¸€ç›´èµ·ä¸æ¥ï¼Œæœ‰å¯èƒ½æ˜¯å•èŠ‚ç‚¹èµ„æºä¸å¤Ÿï¼Œæœ‰å¯èƒ½æ˜¯ç½‘ç»œåŽŸå› å¯¼è‡´ä¸€äº›é•œåƒæˆ– artifacts fetch ä¸ä¸‹æ¥æˆ–è€…æ˜¯èŠ‚ç‚¹æ•°é‡ä¸å¤Ÿï¼Œä½†æ˜¯ Framework ä¸Ž Docker çš„å®šä½æ¯•ç«Ÿä¸åŒï¼Œä¹Ÿä¸å±žäºŽä¸€ä¸ªæŠ€æœ¯ã€‚è¿™ä¸ªæˆ‘ä»¬å¯ä»¥ç§ä¸‹äº¤æµï¼Œæˆ‘å¯ä»¥å¸®åŠ©æ‚¨è§£å†³ä¸€äº›éƒ¨ç½²æœåŠ¡çš„é—®é¢˜ã€‚

> Qï¼šåˆšæ‰è®²çš„èŠ‚ç‚¹è§„åˆ’ï¼Œå¤šåŒºåŸŸç®¡ç†æ˜¯ä¸æ˜¯è¯´çš„æ˜¯ä¼ä¸šç‰ˆçš„åŠŸèƒ½ï¼Ÿ

Aï¼šè¿™ä¸ªæ˜¯ DC/OS 1.11 çš„æ–°åŠŸèƒ½ï¼Œå¤šåŒºåŸŸï¼ŒåŒæ—¶ Framework æ”¯æŒæ•…éšœæ„ŸçŸ¥ã€‚ä½†æ˜¯æ˜¯ä¸æ˜¯åªæœ‰ä¼ä¸šç‰ˆæ”¯æŒï¼Œæˆ‘éœ€è¦æŸ¥çœ‹ä¸€ä¸‹ï¼Œæ‚¨ä¹Ÿå¯ä»¥åˆ° DC/OS ç¤¾åŒºç½‘ç«™æŸ¥çœ‹ã€‚

> Qï¼šç›´æŽ¥ç”¨ Mesos å¯ä»¥éƒ¨ç½² DC/OS ç‚¹ Framework å—ï¼Ÿ

Aï¼šå¯ä»¥ï¼Œåªä¸è¿‡æ“ä½œèµ·æ¥æ²¡é‚£ä¹ˆå®¹æ˜“ï¼Œéœ€è¦ä¸€å®šçš„ä¸“ä¸šçŸ¥è¯†ã€‚æ¯•ç«Ÿ Framework å°±æ˜¯åŸºäºŽ Mesos å¼€å‘è€Œæˆï¼Œå¾ˆå¤šäº’è”ç½‘åŽ‚å•†ä¹Ÿæ˜¯ä»…ç”¨äº† Mesosï¼Œä½†æ˜¯è‡ªå·±å¼€å‘äº†å¾ˆå¤š Frameworkï¼Œæ—¢æ»¡è¶³è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¹Ÿä¸ºäº†æ“ä½œç®€ä¾¿ã€‚

> Qï¼šDC/OS ç¤¾åŒºç‰ˆè·Ÿä¼ä¸šç‰ˆæœ‰å¤šå¤§çš„å·®å¼‚ï¼Ÿ

Aï¼šå½“å‰çš„å·®å¼‚ä¸»è¦ä½“çŽ°åœ¨å®‰å…¨ã€å¤šç§Ÿæˆ·ã€Edge-LB ç­‰å‡ ä¸ªæ–¹é¢ï¼Œå…¶å®ƒæ–¹é¢å·®å¼‚ä¸å¤§ã€‚

> Qï¼šæ—¢ç„¶ Marathon æœ‰å®¹å™¨ç¼–æŽ’åŠŸèƒ½ï¼Œä¸ºä½•è¦å¼ƒ Marathonï¼Œè€Œç”¨ Kubernetesï¼Œå¢žåŠ ä½“ç³»å¤æ‚æ€§ï¼Œæˆ‘çš„é—®é¢˜æ˜¯ï¼Œè¿™åªæ˜¯ä¸ºäº†æ»¡è¶³ç”¨æˆ·åå¥½è¿˜æ˜¯ç¡®å®žæœ‰è®¾è®¡æˆ–æ€§èƒ½ä¼˜åŠ¿ï¼Ÿ

Aï¼šæ²¡æœ‰å«Œå¼ƒä¸ç”¨ï¼ŒKubernetes çš„ Framework ä¸å°±æ˜¯ Marathon åˆ›å»ºçš„å—ï¼Ÿè€Œä¸” Marathon ä¸Ž Kubernetes çš„è¿è¡Œæœºåˆ¶ä¹Ÿä¸å¤ªä¸€æ ·ï¼Œå„æœ‰å„çš„ä¼˜åŠ¿ã€‚åªæ˜¯å› ä¸º Kubemetes åœ¨å®¹å™¨ç¼–æŽ’æ–¹é¢ç¡®å®žå¾ˆä¼˜ç§€ï¼Œè€Œä¸”ç”Ÿæ€å¾ˆå¥½ï¼Œå› æ­¤ä¸ºå®¢æˆ·æä¾›æ›´å¤šçš„é€‰æ‹©ã€‚è¿™ä¸ªç»å¯¹ä¸æ˜¯ä¸ºäº†æ»¡è¶³ç”¨æˆ·åå¥½ï¼Œä¸ç„¶å…¬å¸ä¸ä¼šæŠ•å…¥è¿™ä¹ˆå¤šï¼Œå¤§å®¶æ¯å¤©éƒ½åœ¨ç¾¤é‡Œé¢è®¨è®ºå¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Œæä¾›å·®å¼‚åŒ–çš„æœåŠ¡ã€‚ä»Žå‘å¸ƒåˆ°çŽ°åœ¨ä»…ä»…å…­ä¸ªæœˆï¼Œä½†æ˜¯æ–¹ä¾¿çš„è¯å¯ä»¥ä½“éªŒä¸€ä¸‹ï¼Œç¡®å®žåœ¨ç®¡ç†å’Œè¿ç»´ä¸Šæœ‰å¾ˆå¤šä¼˜åŠ¿ã€‚è€Œä¸”ä»Ž Roadmap ä¸Šçœ‹æœªæ¥åœ¨æ€§èƒ½å’Œå®‰å…¨ä¸Šä¼šæœ‰å¾ˆå¤šæ–°çš„æå‡ã€‚

> Qï¼šä¸ºä»€ä¹ˆä¸ç›´æŽ¥ç”¨ Kubernetes å°±å¥½äº†å‘¢ï¼Ÿå¼•å…¥ Mesos ä¸€å¥—æŠ€æœ¯æ ˆï¼ŒæŠ•å…¥å’Œäº§å‡ºç›¸æ¯”å¦‚ä½•ï¼Ÿ

Aï¼šè¿˜æ˜¯åˆ†äº«æ—¶è¯´çš„ï¼ŒMesos åœ¨ç®¡ç†åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šæœ‰ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œæ‚¨å¯ä»¥ä½“éªŒä¸€ä¸‹ï¼Œåœ¨ DC/OS å®‰è£… Sparkã€HDFSã€Cassandraã€Kafka ç­‰ï¼Œå†è¯•ç€ç”¨ Kubernetes ä¸Šå®‰è£…ä¸€ä¸‹ï¼Œå°±è§£é‡Šçš„é€šäº†ã€‚

---

### 2018-04-10ï¼šæ‰‡è´ç½‘å¾®æœåŠ¡ç¼–æŽ’å’Œæ²»ç†å®žè·µ

> Qï¼šPrometheus åªé‡‡é›† Kubernetes é›†ç¾¤çš„æŒ‡æ ‡æ•°æ®ï¼Œé‚£éž Kubernetes çš„æŒ‡æ ‡æ•°æ®ç”¨ä»€ä¹ˆé‡‡é›†ï¼Ÿ

Aï¼šéƒ½æ˜¯ Prometheusï¼Œåº”ç”¨æ˜¯å¯ä»¥è£… Prometheus çš„ clientï¼Œæš´éœ²è‡ªå·±çš„ metrics çš„ï¼Œç„¶åŽ Redis ä»€ä¹ˆçš„ä¹Ÿéƒ½æœ‰ exporterã€‚

> Qï¼šè¯·é—®ä¸‹æ—¥å¿—å¦‚æžœéƒ½è½åˆ° stdout çš„è¯ï¼Œä¼šä¸ä¼šé€ æˆæ ¼å¼ä¸ä¸€è‡´ï¼Œä»Žè€Œå¯¼è‡´æ”¶é›†å’Œå½’æ¡£å›°éš¾ï¼Ÿæ¯”å¦‚è¯´ä¸šåŠ¡æ—¥å¿—å’Œä¸­é—´ä»¶æ—¥å¿—éƒ½æ‰“åˆ° stdoutï¼Œåœ¨ Filebeat æˆ–è€… Logstash å†…æ˜¯æ€Žä¹ˆå¤„ç†çš„ï¼Ÿå¦å¤–å®¹å™¨æ—¥å¿—å®šæœŸåˆ é™¤çš„ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šè¿™æ˜¯ä¸ªå¥½é—®é¢˜ï¼Œéœ€è¦åˆ†æ‹£çš„æ—¥å¿—ä¼šåœ¨ message çš„å¼€å¤´åšç‰¹å®šçš„æ ‡è®°ã€‚ä¾‹å¦‚[DATABEAT] è¡¨ç¤ºæ‰“ç‚¹æ•°æ®ã€‚ES æœ‰å¾ˆå¤šå·¥å…·å¯ä»¥åšå®šæœŸ archive çš„ï¼Œç­–ç•¥æ¯”å¦‚ä¿ç•™å¤šå°‘å¤©ï¼Œå¤šå°‘æœˆï¼Œæ ¹æ®ä¸åŒçš„æ•°æ®çš„ç­–ç•¥ä¸åŒã€‚

> Qï¼šEnvoy å¯¹æ€§èƒ½çš„æŸè€—æœ‰å¤šå¤§ï¼Œè‡ªèº«çš„æ€§èƒ½æ¶ˆè€—æœ‰å¤šå¤§ï¼Ÿ

Aï¼šEnvoy æ˜¯æœ‰æ€§èƒ½æŸè€—çš„ï¼Œå› ä¸º API çš„å¹³å‡å“åº”æ—¶é—´å·®ä¸å¤šåœ¨ 100-150 msï¼ŒåŒæ—¶ç›¸æ¯”å…¶å¸¦æ¥çš„å¥½å¤„ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™äº›æŸè€—æ˜¯å€¼å¾—çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…·ä½“å¹¶æ²¡æœ‰æµ‹ç®—ã€‚

> Qï¼šgRPC åšäº†æœåŠ¡æ³¨å†Œå—ï¼ŒgRPC æ–°å¢žå‡å°‘å­—æ®µå…¼å®¹æ€§å¦‚ä½•å¤„ç†çš„ï¼Ÿ

Aï¼šæœåŠ¡æ³¨å†Œ/å‘çŽ°æ˜¯åŸºäºŽ Kubernetes å’Œæˆ‘ä»¬å†™çš„ Kubernetes Endpoint åˆ° Envoy eds çš„è½¬åŒ–æœåŠ¡åšçš„ã€‚

> Qï¼šIstio å’Œ Envoy ä»€ä¹ˆå…³ç³»ï¼Ÿ

Aï¼šIstio åŒ…æ‹¬ä¸€ä¸ªæŽ§åˆ¶é¢ + æ•°æ®é¢ï¼ŒEnvoy å¯ä»¥ä½œä¸º Istio çš„æ•°æ®é¢çš„ä¸€ä¸ªå®žçŽ°ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2018 å¹´ 4 æœˆ 10 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚

---

### 2018-03-27ï¼šKubernetes å®˜æ–¹é›†ç¾¤éƒ¨ç½²å·¥å…· kubeadm åŽŸç†è§£æž

> Qï¼šetcd çš„å‡çº§æ˜¯æ€Žä¹ˆå¤„ç†ï¼Ÿ

Aï¼šetcd ä¹Ÿå¯ä»¥ç”± kubeadm è¿›è¡Œç®¡ç†ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œetcd çš„å‡çº§ä¹Ÿå°±å¯ä»¥ç”± kubeadm æ¥è¿›è¡Œäº†ã€‚å¯ä»¥å‚è€ƒåˆ†äº«ä¸­ kubeadm upgrade plan ä¸­çš„æç¤ºã€‚å¦‚æžœ kubeadm é…ç½®ä¸ºä½¿ç”¨å¤–éƒ¨ etcdï¼Œåˆ™éœ€è¦è‡ªè¡Œè¿›è¡Œ etcd çš„å‡çº§ã€‚

> Qï¼šä½ ä»¬ä½¿ç”¨çš„ç½‘ç»œæ’ä»¶æ˜¯ï¼Ÿ

Aï¼šæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸­å…´é€šè®¯è‡ªç ”çš„ç½‘ç»œæ’ä»¶ Knitterï¼Œè¯¥æ’ä»¶å¯ä»¥åŽŸç”Ÿæ”¯æŒå¤šç½‘ç»œå¹³é¢ï¼Œé€‚åˆ NFV çš„åœºæ™¯ã€‚

> Qï¼škubeadm å¯ä»¥æŒ‡å®šä»“åº“åœ°å€ï¼Œä¸ç„¶åœ¨å›½å†…å°±å¾—å…ˆæ³¨å…¥é•œåƒï¼Œä½ å¯ä»¥è¯•è¯•ã€‚

Aï¼šå¯¹çš„ï¼Œåœ¨åˆ†äº«ä¸­å…³äºŽé›·åŒºçš„è¯´æ˜Žä¸­æœ‰æåˆ°å¯ä»¥ä¸º kubeadm æŒ‡å®šå¯ç”¨çš„ç¬¬ä¸‰æ–¹é•œåƒåº“ï¼Œéœ€è¦åœ¨å¯åŠ¨å‚æ•°ä¸­è¿›è¡Œè®¾ç½®ã€‚

> Qï¼šDashboardã€ç½‘ç»œç»„ä»¶ã€æ—¥å¿—è¿™äº›ç»„ä»¶æ˜¯ä¸æ˜¯éƒ½éœ€è¦è‡ªå·±å†å®‰è£…ï¼Ÿè¿™äº›å®‰è£…è¿‡ç¨‹æœ‰æ²¡æœ‰ä»‹ç»æ–‡æ¡£ï¼Ÿæœ‰æ²¡æœ‰åŠžæ³•é€šè¿‡ kubeadm å¯¼å‡ºæ¯ä¸ªç‰ˆæœ¬çš„é•œåƒåå­—ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡ GitHub å’Œ Docker Hub å…³è”å¯¼å‡ºé•œåƒã€‚

Aï¼šå¯¹äºŽæ‚¨æåˆ°çš„å…¶ä»–ç»„ä»¶ï¼Œéƒ½æ˜¯éœ€è¦è‡ªå·±å†å®‰è£…çš„ï¼Œç›´æŽ¥æŒ‰å„ä¸ªç»„ä»¶å®˜æ–¹çš„å®‰è£…æ–‡æ¡£è¿›è¡Œå®‰è£…å³å¯ã€‚kubeadm ä½¿ç”¨çš„ master ç»„ä»¶é•œåƒåå­—ä¸€èˆ¬ä¸ºç±»ä¼¼è¿™æ ·çš„åç§°ï¼šgcr.io/google_containers/kube-apiserver-amd64:v1.9.6ã€‚

> Qï¼šä¸€å®šè¦ä½¿ç”¨ etcd å—ï¼Œå¯ä»¥ç”¨å…¶ä»–çš„æ•°æ®åº“ä»£æ›¿å—ï¼Ÿ

Aï¼šç›®å‰ Kubernetes åªæ”¯æŒä½¿ç”¨ etcdï¼Œåœ¨å¤§çº¦ä¸¤å¹´å‰ï¼Œç¤¾åŒºæœ‰å…³äºŽæ”¯æŒ Consul çš„è®¨è®ºï¼Œä¸è¿‡åŽæ¥ä¸äº†äº†ä¹‹ã€‚

> Qï¼šetcd é»˜è®¤æœ‰åšæ•…éšœæ¢å¤å—ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œæœ‰æ²¡æœ‰å¥½çš„æ–¹æ¡ˆï¼Ÿ

Aï¼šç”± kubeadm å¯åŠ¨çš„ etcd åº”è¯¥æ˜¯æ²¡æœ‰åšæ•…éšœæ¢å¤ï¼Œä¸ªäººç†è§£å¯ä»¥é€šè¿‡å»ºç«‹å¤–éƒ¨ etcd é«˜å¯ç”¨é›†ç¾¤çš„æ–¹å¼è¾¾åˆ°ç›®çš„ã€‚

> Qï¼šknitter èƒ½æè¿°ä¸€ä¸‹å—ï¼Œè·Ÿ Calicoã€Flannel æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿä½ ä»¬æœ‰æµ‹è¯•è¿‡å¤šé«˜çš„è´Ÿè½½ï¼Ÿ

Aï¼šknitter å·²ç»å¼€æºï¼Œå¯ä»¥åœ¨å…¶é¡¹ç›®åœ°å€æŸ¥çœ‹å…¶è¯´æ˜Žï¼š[ZTE/Knitter](https://github.com/ZTE/Knitter)ã€‚ä¸è¿‡ç”±äºŽåˆšåˆšå¼€æºä¸ä¹…ï¼Œä¸Šé¢çš„æ–‡æ¡£è¿˜ä¸æ˜¯ç‰¹åˆ«å®Œå–„ï¼Œæ•¬è¯·ä¿æŒå…³æ³¨ã€‚

> Qï¼šCA è¯ä¹¦è¿‡æœŸæ€Žä¹ˆå¤„ç†ï¼Ÿ

Aï¼škubeadm åˆ›å»ºçš„ CA è¯ä¹¦é»˜è®¤çš„æœ‰æ•ˆæœŸæ˜¯ 10 å¹´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦è€ƒè™‘ CA è¯ä¹¦è¿‡æœŸé—®é¢˜ã€‚ä¸è¿‡ apiserver çš„è¯ä¹¦æœ‰æ•ˆæœŸé»˜è®¤çš„æ˜¯ 1 å¹´ï¼Œè¿™ä¸ªéœ€è¦è€ƒè™‘è¿‡æœŸé—®é¢˜ã€‚æˆ‘åœ¨ 1.9 ä¸­æè¿‡ä¸€ä¸ª PRï¼Œåœ¨å‡çº§é›†ç¾¤çš„æ—¶å€™ï¼Œå¦‚æžœå‘çŽ° apiserver çš„è¯ä¹¦åˆ°æœŸæ—¶é—´å°äºŽ 180 å¤©ï¼Œä¼šé‡æ–°ç”Ÿæˆå…¶è¯ä¹¦ã€‚

> Qï¼šæˆ‘çœ‹è¿‡ kubelet é»˜è®¤æœ‰ä¸»åŠ¨æ³¨å†Œçš„é€‰é¡¹ï¼Œå¦‚æžœæä¾›è¯ä¹¦å¯†é’¥åº”è¯¥å°±ä¸éœ€è¦ä½¿ç”¨ kubeadm joinï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œä¸è¿‡è¿™ä¸ªå‰æå°±æ˜¯åƒä½ æ‰€æåˆ°çš„ï¼Œéœ€è¦å®ƒå·²ç»æœ‰ç›¸åº”çš„è¯ä¹¦å¯†é’¥ï¼Œå¦‚æžœä¸ä½¿ç”¨ kubeadm join çš„è¯ï¼Œå°±éœ€è¦æ‰‹åŠ¨åŽ»ä¸ºå®ƒåˆ›å»ºè¯ä¹¦å’Œå¯†é’¥ï¼Œå¯èƒ½è¿˜éœ€è¦ä¸€äº›å…¶ä»–é…ç½®ï¼Œè¿‡ç¨‹æ¯”è¾ƒç¹çã€‚æ‰€ä»¥å¦‚æžœé›†ç¾¤æ˜¯ç”± kubeadm æ¥ç®¡ç†çš„è¯ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨ kubeadm join æ¥åŠ å…¥ã€‚

> Qï¼škubeadm join ä½¿ç”¨çš„ token æ˜¯ä¸æ˜¯æœ‰æ—¶æ•ˆçš„ï¼Ÿ

Aï¼šå¯¹ï¼Œæˆ‘è®°å¾—è¿™ä¸ªæ—¶æ•ˆåº”è¯¥æ˜¯ 24 å°æ—¶ï¼Œå¦‚æžœè¶…è¿‡æ—¶æ•ˆï¼Œå¯ä»¥ä½¿ç”¨ kubeadm token create æ¥é‡æ–°ç”Ÿæˆä¸€ä¸ª tokenã€‚

> Qï¼š`kubectl get daemonset -o wide --all-namespaces` å¯ä»¥æŸ¥åˆ° kube-apiserver-master çš„æ˜¯ self-hosting æ¨¡å¼å—ï¼Ÿ

Aï¼šå¦‚æžœé€šè¿‡è¯¥å‘½ä»¤å¯ä»¥æŸ¥åˆ°ï¼Œé‚£åº”è¯¥å°±æ˜¯äº†ã€‚kubeadm åœ¨è¿™äº› DaemonSet çš„åå­—ä¸­ç»Ÿä¸€åŠ äº†"self-hosted-"å‰ç¼€ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2018 å¹´ 3 æœˆ 27 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚

---

### 2018-03-24ï¼šæ–°ä¸œæ–¹åˆ©ç”¨å®¹å™¨æŠ€æœ¯åœ¨ç”¨æˆ·è‡ªæœåŠ¡æ–¹é¢çš„æŽ¢ç´¢

> Qï¼šä¸ºä»€ä¹ˆä¸ç›´æŽ¥ä½¿ç”¨ Kubernetes æä¾›çš„ç¼–æŽ’æ–¹å¼ï¼Ÿ

Aï¼šæ–°ä¸œæ–¹çš„ IT äººå‘˜ä¸Žä¸šåŠ¡äººå‘˜æ¯”å€¼æ˜¯æ¯”è¾ƒä½Žçš„ï¼Œå› æ­¤åœ¨å°å›¢é˜Ÿä¸‹ç›´æŽ¥æž Kubernetes æ˜¯ä¸ªä¸çŽ°å®žçš„äº‹æƒ…ï¼Œå°å›¢é˜Ÿï¼Œé¡¹ç›®æ—¶é—´ç´§ ï¼Œå…ˆè§£å†³"æœ‰"çš„é—®é¢˜ï¼Œç»¼åˆèµ·æ¥çœ‹æœ€åŽé€‰æ‹©äº† Rancherï¼Œæˆ‘ä»¬çš„äºŒæœŸé¡¹ç›®å°†åŸºäºŽ Kubernetesã€‚

> Qï¼šæ··åˆäº‘çš„è¯ï¼Œç½‘ç»œç»„ä»¶ç”¨çš„å“ªä¸ªï¼Ÿ

Aï¼šç”¨çš„ Rancher å†…ç½®çš„ VXLANï¼ŒçŽ°åœ¨éƒ¨ç½²çš„çŽ¯å¢ƒå®Œå…¨åœ¨ç§æœ‰äº‘éƒ¨åˆ†éƒ¨ç½²ã€‚

> Qï¼šç›‘æŽ§æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šç›‘æŽ§æš‚æ—¶ä½¿ç”¨çš„æ˜¯ Rancher ç¤¾åŒºå†…ç½®çš„æ™®ç½—ç±³ä¿®æ–¯ï¼Œå®¿ä¸»æœºå±‚é¢æ²¿ç”¨äº† Zabbixï¼Œæˆ‘ä»¬ç›®å‰ Zabbix ç›‘æŽ§éžå¸¸å®Œå–„äº†ã€‚æ™®ç½—ç±³ä¿®æ–¯è¿˜åœ¨ç ”ç©¶ä¸­ã€‚

> Qï¼šè¯·é—®ä¸ºä»€ä¹ˆä¸ç›´æŽ¥ç”¨ Helmï¼Ÿ ç›¸å…³çš„åŒ…ç®¡ç†åŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚

Aï¼šç¡®å®ž Kubernetes å’Œ Helm æ›´å¼ºå¤§ã€‚ ä½†æ˜¯å¯¹äºŽä¸€ä¸ªåˆšåˆšæŽ¥è§¦å®¹å™¨çš„å›¢é˜Ÿç›´æŽ¥æž Kubernetes çš„æˆæœ¬è¿˜æ˜¯æœ‰äº›å¤§ã€‚æˆ‘ä»¬ä¸å¯èƒ½è®©æ‰€æœ‰äººç­‰æˆ‘ä»¬ä¸€å¹´åŠå¹´åŸ‹å¤´æžï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©äº† Rancherï¼Œå¤§å®¶éƒ½ä¼š Dockerï¼Œéƒ½çŸ¥é“ docker-composeï¼Œç¨å¾®å­¦ä¸€ä¸‹å°±ä¸Šæ‰‹äº†ã€‚

> Qï¼šè¯·é—® Rancher åœ¨ CI/CD æ–¹é¢æ˜¯å¦‚ä½•åšçš„ï¼Ÿ

Aï¼šCI/CD è¿™éƒ¨åˆ†ï¼Œä¹‹å‰æˆ‘ä»¬è‡ªå·±æžè¿‡ Jenkinsï¼ŒåŽæ¥ Rancher å‡ºäº† Pipeline å·¥å…·ã€‚Rancher Pipeline ä¹Ÿæ˜¯åŸºäºŽ Jenkinsï¼Œé›†æˆäº† GitLab å’Œ GitHubï¼Œå¹¶é…ç½®äº† UIï¼Œç”¨æˆ·ä½“éªŒè¿˜ä¸é”™ã€‚æˆ‘ä»¬è‡ªå·±çš„é•œåƒæ‰“åŒ…çŽ°åœ¨éƒ½åˆ‡æ¢åˆ° Pipeline äº†ã€‚Jenkins éƒ¨åˆ†å‡†å¤‡ç›´æŽ¥äº¤ç»™æµ‹è¯•éƒ¨é—¨æ¥æžï¼Œæˆ‘ä»¬é…åˆä»–ä»¬ï¼Œå› ä¸ºä»–ä»¬æž Jenkins æ›´ä¸“ä¸šã€‚

---

### 2018-03-11ï¼šèŠèŠ Docker ç›‘æŽ§é‚£ç‚¹äº‹å„¿

> Qï¼šæ—¢ç„¶å½“å‰å·²ç»å­˜åœ¨å¾ˆå¤šæŒ‡æ ‡ç›‘æŽ§æ–¹æ¡ˆï¼Œä½ ä»¬æ˜¯åŸºäºŽä»€ä¹ˆè€ƒè™‘è¦è‡ªå·±å†™çš„ï¼Ÿ

Aï¼šå› ä¸ºçŽ°æœ‰çš„æ–¹æ¡ˆéƒ½æ˜¯ç‹¬ç«‹çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬çš„ç›‘æŽ§å¯¹è±¡å¯ä¸æ­¢å®¹å™¨ï¼Œè€Œä¸”æŽ’æŸ¥é—®é¢˜çš„æ—¶å€™å¯èƒ½è¿˜éœ€è¦çœ‹å®¿ä¸»æœºçš„ç›‘æŽ§ã€ç½‘ç»œè®¾å¤‡çš„ç›‘æŽ§ç­‰ç­‰ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®¹å™¨çš„é›†æˆè¿›æ¥ï¼›å¦å¤–ç”¨å¼€æºçš„æ–¹æ¡ˆä¸å¥½åšå®šåˆ¶åŒ–ã€‚

> Qï¼šå®¹å™¨å‘ç”Ÿ OOM æ—¶ï¼Œè®¡ç®—çš„å†…å­˜æ˜¯åŒ…æ‹¬ Cache+RSS å—ï¼Ÿç”Ÿäº§çŽ¯å¢ƒç»å¸¸ä¼šå‘ç”Ÿä¸šåŠ¡å®¹å™¨ OOMï¼Œå¯ä»¥ä»Žé‚£å‡ ä¸ªæ–¹é¢æŽ’æŸ¥é—®é¢˜ï¼Œå¹¶è§£å†³ï¼Ÿ

Aï¼šæ˜¯çš„ï¼ŒæŽ’æŸ¥é—®é¢˜å½“ç„¶è¦åŸºäºŽç›‘æŽ§ï¼Œçœ‹æ˜¯å¦æ˜¯ä½¿ç”¨å†…å­˜ä¸€ç›´ä¸é‡Šæ”¾ï¼Œæˆ‘ä»¬é‡åˆ°çš„ OOM ä¸€å¤§éƒ¨åˆ†éƒ½æ˜¯åº”ç”¨æœ¬èº«æœ‰å†…å­˜æ³„æ¼ï¼›è¿™åœ¨ä½¿ç”¨è™šæ‹Ÿæœºçš„æ—¶å€™æ²¡æœ‰æš´éœ²å‡ºæ¥ï¼Œåœ¨ç”¨ Docker æ—¶å€™èµ„æºç»™å¾—æ›´å°‘äº†å°±æš´éœ²å‡ºæ¥äº†ã€‚

> Qï¼šæ˜¯å¦å¯ä»¥å°† Pod ä¸‹æ‰€æœ‰å®¹å™¨æ±‡æ€»çš„æŒ‡æ ‡ä½œä¸º Pod çš„æ€§èƒ½æŒ‡æ ‡å‘¢ï¼Ÿ

Aï¼šå¯¹äºŽ Kubernetes æ¥è¯´å°±æ›´å®¹æ˜“ä¸€äº›äº†ï¼Œå¯ä»¥é€šè¿‡ kubelet API server ç›´æŽ¥æ¥èŽ·å–çš„ã€‚

> Qï¼šå½“é‡åˆ°å¶å‘çš„ CPU throttled æƒ…å†µï¼Œæ˜¯å¦æ„å‘³ç€å·²ç»å¼€å§‹å‡ºçŽ°æ€§èƒ½ç“¶é¢ˆï¼Ÿ

Aï¼šä¸æ˜¯ï¼ŒCPU throttled æ˜¯åœ¨ä¸€ä¸ª period é‡Œé¢ CPU çš„æ—¶é—´ç‰‡åˆ°äº†é™åˆ¶è§¦å‘çš„ï¼Œå¦‚æžœæ˜¯ job ç±»åž‹çš„åº”ç”¨ï¼Œæ˜¯ä¼šå¶å‘ cpu throttledï¼Œè¿™æ—¶å€™å¯èƒ½ä¸éœ€è¦å…³å¿ƒã€‚

> Qï¼šçŽ°åœ¨é’ˆå¯¹å®¹å™¨çš„ç›‘æŽ§æ–¹æ¡ˆç‰¹åˆ«å¤šï¼Œä¹ŸåŸºæœ¬ä¸Šå¾ˆå®Œå–„ã€‚æ¯”å¦‚ Telegraf é‡‡é›†ã€æ™®ç½—ç±³ä¿®æ–¯é‡‡é›†ç­‰ã€‚æƒ³é—®ä¸‹ï¼Œä½ ä»¬é‚£è¾¹çŽ°åœ¨çš„å‘Šè­¦æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šå‘Šè­¦çŽ°åœ¨æˆ‘ä»¬æ›´å¤šåœ°é…ç½®åœ¨åº”ç”¨ä¸Šï¼Œè¿™æ ·ååº”åœ°æœ€ç›´è§‚ã€‚å¦‚æžœè¦åœ¨å®¹å™¨å±‚é¢åšçš„è¯ï¼Œå»ºè®®å¯¹æŒç»­çš„ CPU throttling å’Œ mem failcnt åšå‘Šè­¦ã€‚

> Qï¼šè¯·é—®æŒ‡æ ‡çš„å­˜å‚¨ç”¨çš„æ˜¯ä»€ä¹ˆæ•°æ®åº“ï¼Ÿ

Aï¼šä¹‹å‰ç”¨çš„ Elasticsearchï¼ŒçŽ°åœ¨ç”¨çš„ InfluxDBï¼Œè‡ªå·±åŒ…è£…å®žçŽ°äº†ä¸€å¥—é›†ç¾¤ã€‚

> Qï¼šå¯¹äºŽæ— çŠ¶æ€çš„ Java å¾®æœåŠ¡å®¹å™¨ï¼Œæ˜¯å¦æœ‰å¿…è¦è¿›è¡Œç›‘æŽ§ï¼Ÿ

Aï¼šè¿™ä¸ªæœ€å¥½åœ¨åº”ç”¨å±‚åŽ»ç›‘æŽ§ï¼Œä½†æ˜¯åœ¨æŽ’æŸ¥é—®é¢˜çš„æ—¶å€™è¿˜æ˜¯éœ€è¦å®¹å™¨å±‚é¢çš„æŒ‡æ ‡æ•°æ®ã€‚

> Qï¼šå…¶å®žç›‘æŽ§æœ¬èº«å¹¶ä¸æ˜¯æœ€ç»ˆç›®çš„ï¼Œç›‘æŽ§æ˜¯ä¸ºäº†å‘çŽ°é—®é¢˜ç„¶åŽè§£å†³é—®é¢˜ï¼Œå¯¹äºŽ Docker å®¹å™¨é—®é¢˜çš„å®šç•Œå®šä½æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆï¼Ÿä»¥ OOM ä¸ºä¾‹ï¼Œç›‘æŽ§å¯èƒ½ä¼šè§¦å‘ä¸€ä¸ªå†…å­˜é«˜çš„å‘Šè­¦ï¼Œé‚£ä¹ˆä¸‹ä¸€æ­¥è¯¥å¦‚ä½•å®šç•Œå®šé—®é¢˜æ ¹å› å‘¢ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œè¿™ä¸€èˆ¬æ˜¯å¼€å‘è€…å’Œ Docker è¿ç»´ç»å¸¸æ‰¯çš®çš„åœ°æ–¹ï¼›è¿™ä¸ªæ—¶å€™éœ€è¦ç»“æž„åº”ç”¨çš„ç›‘æŽ§æ¥çœ‹ï¼Œä¾‹å¦‚ OOM æ¥è¯´ï¼Œå¦‚æžœæ˜¯ Java åº”ç”¨å°±æ˜¯çœ‹åˆ° heap çš„ä½¿ç”¨ä¸€ç›´ä¸Šå‡ï¼Œé‚£è‚¯å®šæ˜¯åº”ç”¨æ–¹åŽ»æŸ¥é—®é¢˜äº†ã€‚

---

### 2018-02-03ï¼šåŸºäºŽ Kubernetes çš„ DevOps å®žè·µä¹‹è·¯

> Qï¼šiSCSI æŒ‚è½½ rbd åˆ° Windows Server çš„æ€§èƒ½å¦‚ä½•ï¼Ÿæ˜¯ç”¨ tgt æ¥å®žçŽ°å—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œ æ‚¨å¯ä»¥æŸ¥çœ‹è¿™ä¸ªæ–‡æ¡£ [use-iscsi-to-windows](https://github.com/Statemood/documents/blob/master/ceph/use-iscsi-to-windows.md)ã€‚è‡³äºŽæ€§èƒ½ï¼Œç›®å‰å­˜æ”¾äº†å‡  TB çš„æ•°æ®ï¼Œåªæœ‰ç½‘ç»œæ˜¯ç“¶é¢ˆï¼ˆåƒå…†ï¼‰ã€‚

> Qï¼šå¤šå¥—çŽ¯å¢ƒé€šè¿‡ Kubernetes å¦‚ä½•åˆ†å‰²å¼€çš„ï¼Ÿ

Aï¼š é€šè¿‡ä¸åŒçš„ namespaceï¼Œå‰ç«¯ Nginx ä»£ç†é€šè¿‡ä¸åŒçŽ¯å¢ƒç›‘å¬ä¸åŒ IP å®žçŽ°ã€‚

---

### 2018-01-26ï¼šTensorFlow on Kubernetes çš„æž¶æž„ä¸Žå®žè·µ

> Qï¼šWorker ä¸ºä»€ä¹ˆä¸ç›´æŽ¥ç”¨ Podï¼Œè€Œç”¨çš„ Jobï¼Ÿ

Aï¼šKubernetes ä¸­æ˜¯ä¸å»ºè®®ç›´æŽ¥ä½¿ç”¨ Pod çš„ï¼Œå»ºè®®é€šè¿‡ä¸€ä¸ªæŽ§åˆ¶å™¨ï¼ˆRSã€RCã€Deployã€StatefulSetsã€Job ç­‰ï¼‰æ¥åˆ›å»ºå’Œç®¡ç† Podã€‚

> Qï¼šæˆ‘çœ‹è®­ç»ƒçš„æ—¶å€™å¹¶æ²¡æœ‰æŒ‡å®šæ•°æ®é›†å’Œè®­ç»ƒå‚æ•°ç­‰ï¼Œæ˜¯éƒ½æ”¾åˆ°è®­ç»ƒè„šæœ¬å†…äº†å—ï¼Œè¿˜æœ‰è®­ç»ƒé›†æ˜¯æ”¾åˆ° Glusterï¼ŒæŒ‚è½½åˆ°å®¹å™¨å†…å—ï¼Œè¿˜æ˜¯æ¢å­˜åˆ°æœ¬åœ°ï¼Ÿ

Aï¼šç›®å‰è®­ç»ƒæ•°æ®å’Œå‚æ•°éƒ½æ˜¯åœ¨è„šæœ¬é‡Œç”¨æˆ·è‡ªå·±æžå®šï¼Œæ­£åœ¨æŠŠè¿™äº›æ”¾åˆ° Portalï¼Œæä¾›"å‘½ä»¤è¡Œå‚æ•°è‡ªå®šä¹‰"çš„èƒ½åŠ›ã€‚ç›®å‰æˆ‘ä»¬çš„è®­ç»ƒæ•°æ®æ˜¯ä»Ž HDFS é›†ç¾¤ç›´æŽ¥èµ°ç½‘ç»œè¯»å–ï¼ŒKubernetes æœ¬èº«ä¹Ÿæ²¡æœ‰ HDFS çš„ Volume Pluginã€‚

> Qï¼šè¯·é—® PS çš„ä¸ªæ•°æ˜¯ç”¨æˆ·æŒ‡å®šè¿˜æ˜¯æ ¹æ® Worker çš„æ•°é‡æ¥æŒ‡æ´¾ï¼Ÿ

Aï¼šPS å’Œ Worker æ•°éƒ½æ˜¯é€šè¿‡ç”¨æˆ·æŒ‡å®šï¼Œä½†å®žé™…ä¸Šéƒ½æ˜¯ç”¨æˆ·æ ¹æ®è‡ªå·±çš„è®­ç»ƒæ•°æ®å¤§å°æ¥è®¡ç®—çš„ã€‚

> Qï¼šåˆ†å¸ƒå¼è®­ç»ƒçš„æ—¶å€™ï¼ŒTraining data æ˜¯å¦‚ä½•åˆ†å‘åˆ°å„ä¸ª Worker èŠ‚ç‚¹çš„ï¼ŸTensorflow API å¯ä»¥åšåˆ°æŒ‰èŠ‚ç‚¹æ•°è‡ªåŠ¨åˆ†å‘å—ï¼Ÿ

Aï¼šå„ä¸ª Worker éƒ½æ˜¯ä»Ž HDFS é›†ç¾¤è¯»å–è®­ç»ƒæ•°æ®åŠ è½½åˆ°å†…å­˜çš„ã€‚æ•°æ®çš„åˆ†é…éƒ½æ˜¯ç”¨æˆ·è‡ªå·±åœ¨è„šæœ¬ç§å®žçŽ°çš„ã€‚

---

### 2018-01-17ï¼šKubernetes å­˜å‚¨ç³»ç»Ÿä»‹ç»åŠæœºåˆ¶å®žçŽ°

> Qï¼šKubernetes å’Œ Cloud Foundry æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä¼˜åŠ¿åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ

Aï¼šCloud Foundry æ›´åƒæ˜¯ Application PaaSï¼ŒKubernetes ä¸»è¦æ˜¯ Container PaaSã€‚CF ä¸ä¼šç›´æŽ¥æŠŠ container å±‚æš´éœ²ç»™ç”¨æˆ·ï¼ŒKubernetes åˆ™ä¸ç„¶ï¼Œä½ å¯ä»¥ç›´æŽ¥è®¿é—® containerã€‚ä¸ªäººè§‰å¾— kubernetes çš„éƒ¨ç½²å’Œä½¿ç”¨æ›´ç®€å•ï¼Œæ›´ç›´æŽ¥ï¼Œæ“ä½œèµ·æ¥ä¹Ÿæ›´æ–¹ä¾¿ã€‚

> Qï¼šè¯·é—®å¯¹äºŽ Galera Cluster çš„é›†ç¾¤å­˜å‚¨å¦‚ä½•è®¾è®¡å­˜å‚¨æ–¹æ¡ˆï¼ŒCSI æœ‰è€ƒè™‘æœ‰çŠ¶æ€å‚¨å­˜çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ

Aï¼šå¯¹äºŽæœ‰çŠ¶æ€æœåŠ¡ï¼Œè¯·ä½¿ç”¨ StatefulSet æ¥éƒ¨ç½²ä½ çš„åº”ç”¨ã€‚Volume åªæ˜¯ä¸€ä¸ªå­˜å‚¨çš„åœ°æ–¹ã€‚StatefulSet ä¼šè´Ÿè´£ç»™ Pod è®¾ç½®é¡ºåºç­‰ç­‰ï¼Œä¿è¯æ˜¯æœ‰åºçš„ï¼Œä¼˜é›…çš„åˆ é™¤åœæ­¢å’Œæ‰©å±•ã€‚

> Qï¼šæœ‰æ²¡æœ‰å¯¹è±¡å­˜å‚¨ï¼Œæ¯”å¦‚ CephRGWï¼Œåœ¨ Kubernetes é›†ç¾¤ä¸­çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œæ¯”å¦‚ç”¨æˆ·é€šè¿‡å®¢æˆ·ç«¯ä¸Šä¼ ã€ä¸‹è½½ PVC ä¸­çš„æ•°æ®ä¹‹ç±»çš„ï¼Ÿ

Aï¼šæœ‰è¯•è¿‡ RGW æ¥å­˜å‚¨æ•°æ®ï¼Œä½†æ˜¯æ€§èƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œé€Ÿåº¦è¦æ…¢å¾ˆå¤šã€‚åœ¨ Kubernetes é›†ç¾¤ä¸­å¯ä»¥ä½¿ç”¨ RGW æ¥å­˜å‚¨ä¸€äº›é™æ€çš„æ–‡ä»¶ï¼Œæ¯”å¦‚é…ç½®æ–‡ä»¶ï¼ŒNginx é™æ€ html æ–‡ä»¶ä¹‹ç±»ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥ä¸‹è½½ PV ä¸­çš„æ•°æ®ã€‚ä¸å»ºè®®å¯¹ RGW ä¸­çš„æ•°æ®è¿›è¡Œé¢‘ç¹çš„æ›´æ”¹ã€‚

> Qï¼šèƒ½å¦è¯¦ç»†è¯´ä¸‹ CSIï¼Ÿ

Aï¼šCSI åœ¨ kubernetes v1.9 æ‰å¼•å…¥ã€‚è¿™éƒ¨åˆ†å†…å®¹æ¯”è¾ƒå¤šï¼Œå¯ä»¥åŽ»çœ‹çœ‹ [CSI æ–‡æ¡£](https://github.com/container-storage-interface/spec)ï¼Œä»¥åŠ [Kubernetes å®˜æ–¹çš„ä»‹ç»](http://blog.kubernetes.io/2018/01/introducing-container-storage-interface.html)ï¼Œä»¥åŠ [è¿™ä¸ª feature å®žçŽ°ä»£ç ](https://github.com/kubernetes/kubernetes/pull/54529)ã€‚

> Qï¼šRBD ç”¨ä»€ä¹ˆæ’ä»¶ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆå‘ï¼Ÿ

Aï¼šéœ€è¦åœ¨ kubelet èŠ‚ç‚¹ä¸Šå®‰è£… `ceph-common`{.prettyprint}è¿™ä¸ªåŒ…ï¼Œåœ¨ volume mount çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ç›¸å…³çš„å‘½ä»¤ã€‚åŸºæœ¬ä¸Šæ²¡ä»€ä¹ˆå‘ï¼ŒRBD æä¾›çš„ volume è¿˜æ˜¯å¾ˆå¥½ä½¿çš„ã€‚

> Qï¼šå­˜å‚¨è¿™å— IO æ€§èƒ½ä¸‹é™å¤§æ¦‚å¤šå°‘å‘¢ï¼Œæœ‰å®žæµ‹è¿‡å—ï¼Ÿ

Aï¼šå­˜å‚¨çš„æ€§èƒ½ä¸Ž Cluster çš„èƒ½åŠ›ã€å­˜å‚¨çš„ç±»åž‹æœ‰å¾ˆå¤§å…³ç³»ã€‚å®žæµ‹è¿‡ RBD çš„ IO æ€§èƒ½ï¼Œå½“ç„¶ case by caseï¼Œå½“æ—¶æµ‹å‡ºæ¥çš„ç»“æžœè¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œç›¸æ¯”è¾ƒä¸Ž CephFSã€GlusterFSã€‚

> Qï¼šå¤šä¸ª Pod å…±äº«ä¸€ä¸ª Nasï¼Œæ˜¯å¦å¯è¡Œï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ

Aï¼šå¯è¡Œï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ Volume çš„è¯»å†™æƒé™ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ mount æ—¶å€™çš„ PV çš„ access mode è¿›è¡Œè®¾ç½®ï¼Œæ¯”å¦‚ ReadWriteã€ReadWriteOnce ç­‰ç­‰ã€‚

> Qï¼šCSI å’Œç¤¾åŒºå­µåŒ–çš„ volume provisioner æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

Aï¼šCSI çš„ä¸»è¦ç›®çš„è¿˜æ˜¯ä¸ºäº†ç»™å®¹å™¨å­˜å‚¨å®šä¹‰ä¸€ä¸ªç»Ÿä¸€çš„æŽ¥å£ï¼Œæ–¹ä¾¿è¿›è¡Œå®šåˆ¶åŒ–ï¼Œä»¥åŠæ–°åŠŸèƒ½æ·»åŠ ã€‚ç¤¾åŒºå­µåŒ–çš„ volume provisionerï¼Œä½ æŒ‡çš„åº”è¯¥æ˜¯ [external-storage](https://github.com/kubernetes-incubator/external-storage) è¿™ä¸ªé¡¹ç›®å§ï¼Œè¿™ä¸ªé¡¹ç›®çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿å¯¹ in-tree çš„é‚£äº› Plugin è¿›è¡Œä¿®æ”¹å’Œå®šåˆ¶ï¼Œè¿™æ ·å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œæ›´æ–°ã€‚

> Qï¼šè¯·é—®ä½ çŽ°åœ¨æœ‰æŠŠ MySQL å¯ä»¥æ”¾è¿› PV é‡Œé¢ä¹ˆï¼Ÿæ±‚ä»‹ç»è¿™æ–¹é¢çš„ç»éªŒã€‚

Aï¼šå¦‚æžœåªæ˜¯å•èŠ‚ç‚¹çš„ MySQLï¼Œç›´æŽ¥æ”¾è¿› PV å°±å¥½äº†ï¼Œè·Ÿå…¶å®ƒæ­£å¸¸æœåŠ¡ä¸€æ ·ã€‚å¯¹äºŽå¤šèŠ‚ç‚¹çš„ MySQL Clusterï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™å°±éœ€è¦æ³¨æ„äº†ï¼Œå»ºè®®éƒ¨ç½²æˆ StatefulSetï¼Œæœ‰çŠ¶æ€çš„æœåŠ¡ã€‚ä¹‹å‰æœ‰è¯•è¿‡ç”¨ Galera Cluster For MySQL æ¥éƒ¨ç½²é›†ç¾¤ï¼Œå‘çŽ°æ•ˆæžœä¸æ˜¯å¾ˆå¥½ï¼Œå°¤å…¶æ˜¯åœ¨éšæ„å¯åœ Pod çš„æ—¶å€™ï¼ŒCluster çš„æ²¡åŠžæ³•è‡ªç»„æˆæ–°çš„é›†ç¾¤ï¼Œæ–°èŠ‚ç‚¹ä¹Ÿæ— æ³•åŠ å…¥é›†ç¾¤ã€‚ä½ å¯ä»¥å†æ¬¡è¯•éªŒä¸‹ï¼Œç¡®è®¤ä¸€ä¸‹ã€‚ åŽæ¥ä½¿ç”¨ MySQL Cluster CGEï¼Œæ•ˆæžœå¾ˆå¥½ï¼ŒCluster èƒ½å¤ŸåŠæ—¶å›žå¤å¹¶é‡æ–°ç»„ç»‡èµ·æ¥ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2018 å¹´ 1 æœˆ 16 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚

åˆ†äº«äºº**å¾è¿ªï¼ŒKubernetes ç¤¾åŒº Memberï¼Œæ¯•ä¸šäºŽä¸Šæµ·äº¤é€šå¤§å­¦ï¼Œæœ‰ç€å››å¹´çš„å¼€æºè½¯ä»¶å¼€å‘ç»éªŒã€‚æ›¾ä»»èŒäºŽ IBM ä»Žäº‹ Openstack çš„å¼€å‘ï¼Œå¯¹ Kubernetesï¼ŒDocker ä»¥åŠå¾®æœåŠ¡æž¶æž„æœ‰ä¸°å¯Œçš„ç»éªŒã€‚ç›®å‰åœ¨ Arm ä¸»è¦ä»Žäº‹å¼€æºç¤¾åŒºçš„ç›¸å…³ç ”å‘å·¥ä½œ**ã€‚

---

### 2018-01-10ï¼šä¸€ä¸ªå¯ä¾›å‚è€ƒçš„ä¼ä¸šåº”ç”¨å®¹å™¨åŒ–å®žè·µæ¡ˆä¾‹

> Qï¼šæ‰€æœ‰å¼€å‘äººå‘˜éƒ½æ˜¯ç”¨ä¸€å¥— OpenShift é›†ç¾¤æµ‹è¯•å—ï¼ŸCI/CD ä¹Ÿæ˜¯åŒä¸€å¥—çŽ¯å¢ƒå—ï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯æŒ‰ä¸šåŠ¡åˆ†çš„ï¼ŒåŽŸåˆ™ä¸Šï¼Œä¸€å¥—ä¸šåŠ¡çº¿ï¼ˆä¸€ä¸ªä¸šåŠ¡éƒ¨é—¨ï¼‰ç”¨ä¸€å¥—ç³»ç»Ÿï¼Œè¿™æ ·æˆæœ¬ä¸Šä¹Ÿå¥½åˆ†æ‘Šã€‚

> Qï¼šOpenShift ä¹Ÿæ˜¯ç”¨ Go ç¼–å†™çš„ï¼Ÿ

Aï¼šæ˜¯çš„ï¼ŒOpenShift ç”¨çš„æ˜¯æºç çº§åˆ«çš„å’Œ Kubernetes çš„é›†æˆï¼Œä¸æ˜¯é€šè¿‡ client-go æˆ–è€… REST API çš„æ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒKubernetes å‘åž‹çš„ç‰ˆæœ¬æ€»æ˜¯æ¯” OpenShift çš„å¿« 1 åˆ° 2 ä¸ªç‰ˆæœ¬ã€‚

> Qï¼šå¯¹äºŽ OpenShift æ¯”è¾ƒé€‚åˆå¤šå¤§è§„æ¨¡çš„å›¢é˜Ÿï¼Ÿ

Aï¼šè¿™ä¸ªæ€Žä¹ˆè¯´å‘¢ï¼Œå…¶å®žå¼•å…¥ DevOps æˆ–è€… CI/CD çš„æµç¨‹å°±æ˜¯ä¸ºäº†ç»™ä¼ä¸šå‡å°‘äººå‘˜æˆæœ¬ï¼Œè®©æœ‰äº›èƒ½å¤Ÿè‡ªåŠ¨åŒ–çš„ä¸œè¥¿é€šè¿‡è®¡ç®—æœºè¿è¡Œèµ·æ¥ã€‚æ‰€ä»¥å› è¯¥æ˜¯äººå‘˜è¶Šå°‘è¶Šå¥½ï¼Œä½†æ˜¯äººå‘˜å¦‚æžœå°‘ï¼Œå°±è¦æ±‚æ¯ä¸ªäººçš„æŠ€æœ¯èƒ½é‡Œæ¯”è¾ƒå¼ºï¼Œå¼€æºçš„ä¸œè¥¿å¾€å¾€ç”¨èµ·æ¥ä¸éš¾ï¼Œä½†æ˜¯çœŸåˆ°å‡ºäº†é—®é¢˜çš„æ—¶å€™å°±éœ€è¦çœ‹ä»£ç åŽ»è§£å†³äº†ã€‚æ‰€ä»¥å¦‚æžœäººå°‘çš„è¯ï¼Œå¯èƒ½æ¯ä¸ªäººå°±è¦æ±‚æ‡‚å¾—å°±æ¯”è¾ƒå¤šä¸€äº›ã€‚

> Qï¼šrouter æœ¬èº«æ˜¯å¦å…·å¤‡ HAProxyï¼Ÿ

Aï¼šOpenShift çš„ Router å°±æ˜¯ç”¨ HAProxy å®žçŽ°çš„ï¼Œå½“ç„¶æˆ‘çŽ°åœ¨ç”¨çš„æ˜¯ 3.6.1 çš„ç‰ˆæœ¬ï¼Œæˆ‘ä¸çŸ¥é“ä»¥åŽä¼šä¸ä¼šæ”¯æŒ Nginx æˆ–è€…å…¶ä»–åˆ«çš„ LBï¼Œå› ä¸ºæˆ‘çœ‹åˆ°ä»£ç é‡Œå·²ç»æœ‰å…³äºŽ Nginx çš„ç›¸å…³é…ç½®äº†ï¼Œä½†æ˜¯æ²¡æœ‰æ¿€æ´»ã€‚OpenShift ä½¿ç”¨ HAProxy çš„å¤§è‡´æµç¨‹å°±æ˜¯é€šè¿‡ä¸€ä¸ª Yaml æˆ–è€… jason æ–‡ä»¶ï¼Œé…ç½®ä¸€æ¡ route ä¿¡æ¯ï¼Œç„¶åŽé€šè¿‡ api-server æŒä¹…åŒ–åˆ° etcd ä¸­ï¼Œrouter çš„ä»£ç å¯åŠ¨ä¸€ä¸ª goroutineï¼ŒåŽ»é€šè¿‡ api-server watch etcdï¼Œç„¶åŽæ ¹æ®é…ç½®ä¿¡æ¯å’ŒçŽ¯å¢ƒå˜é‡ï¼Œé€šè¿‡ haproxy-template æ¨¡ç‰ˆï¼ŒåŽ»ç”Ÿæˆ haproxy.confï¼Œç„¶åŽåŽ»åŠ¨æ€ reloadã€‚

> Qï¼šOpenShift çš„ project å’Œ Kubernetes çš„ namespace æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ä¹ˆï¼Ÿproject å¯ä»¥è®¾ç½®èµ„æºé…é¢ä¹ˆï¼Ÿæ€Žä¹ˆè®¾çš„ï¼Ÿ

Aï¼šæ˜¯ä¸€å¯¹ä¸€å…³ç³»ï¼Œå½“ç„¶æœ‰ä¸€äº› namespace æ˜¯æœ‰ä¸€äº›ç‰¹æ®Šæ„ä¹‰çš„ï¼Œä¸å»ºè®®åœ¨é‡Œé¢è·‘åº”ç”¨ã€‚project å¯ä»¥è®¾ç½®èµ„æºé…é¢ï¼Œå…·ä½“æ€Žä¹ˆè®¾ç½®å°±æ¯”è¾ƒå¤æ‚äº†ï¼Œå»ºè®®å‚è€ƒä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œç®€å•çš„è¯´å°±æ˜¯å¯ä»¥æ ¹æ® CPU å†…å­˜åšèµ„æºçš„é™å®šï¼Œè¿™ä¸ªå’Œ Kubernetes æ˜¯ä¸€æ ·çš„ã€‚

> Qï¼šOpenShift ä¸­åŽŸç”Ÿæ€§èƒ½æŒ‡æ ‡ç›‘æŽ§æœåŠ¡çš„ Pod æ€»æŒ‚æœ‰æ²¡æœ‰ç›¸åº”çš„è§£å†³åŠžæ³•ï¼Ÿ

Aï¼šè§£å†³ Pod æ€»æŒ‚çš„é—®é¢˜å°±å¾—å…·ä½“é—®é¢˜å…·ä½“åˆ†æžäº†ï¼Œæˆ‘è®°å¾—å®ƒåšæ€§èƒ½ç›‘æŽ§çš„é‚£ä¸ª Pod æ¯”è¾ƒåƒèµ„æºï¼Œå…¶å®žå¯ä»¥å¯¹ä»–è¿›è¡Œä¸€ä¸‹é™å®šï¼Œæ¯”å¦‚ï¼šoc env rc hawkular-cassandra-1 MAX_HEAP_SIZE=1024M -n openshift-infraã€‚

> Qï¼šOpenShift ä¸­çš„ router é»˜è®¤æƒ…å†µä¸‹æ˜¯è·‘åœ¨ Pod é‡Œçš„ï¼Œé‚£ä¹ˆå½“ service ç‰¹åˆ«å¤šï¼Œroute è§„åˆ™ä¹Ÿç‰¹åˆ«å¤šçš„æ—¶å€™ï¼Œå¦‚ä½•è§£å†³ router æœåŠ¡çš„æ€§èƒ½é—®é¢˜çš„ï¼Ÿ

Aï¼šè¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ï¼Œä½†å…¶å®žæˆ‘è§‰å¾—è¿™ä¸ªå’Œ HAProxy æœ‰å¾ˆå¤§çš„å…³ç³»ï¼Œè·Ÿåœ¨ä¸åœ¨ Pod ä¸­å…³ç³»ä¸å¤§ï¼Œå› ä¸º router è¿™ä¸ªå®¹å™¨å…¶å®žç”¨çš„æ˜¯ä¸»æœºç½‘ç»œï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜å…¶å®žå°±è½¬åŒ–æˆäº†å¦‚ä½•æå‡ HAProxy çš„æ€§èƒ½ï¼Œè¿™ç§æƒ…å†µå…¶å®žæœ‰å¾ˆå¤šå¯ä»¥å‚è€ƒçš„æ–¹æ¡ˆï¼Œæ¯”å¦‚å‰é¢åœ¨åŠ ä¸€å±‚ LVS è´Ÿè½½ï¼Œæˆ–è€…ç”¨ DNS åšåŸŸåè§£æžçš„æ—¶å€™è¿›è¡Œä¸€å®šçš„è´Ÿè½½åŠŸèƒ½ã€‚

---

### 2017-12-26ï¼šåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒæž¶æž„ä¸Žå®žæˆ˜

> Qï¼šè¯·é—®é…ç½®ä¸­å¿ƒå­˜å‚¨çš„æ˜¯é…ç½®æ–‡ä»¶è¿˜æ˜¯ key-value?åƒæ•°æ®åº“è¿žæŽ¥ä¸²ä¹‹ç±»çš„ä¿¡æ¯å¦‚ä½•ç®¡ç†çš„ï¼Ÿè·Ÿæ•°æ®è¿žæŽ¥æ± æ€Žä¹ˆé…åˆï¼Ÿ

Aï¼šæ˜¯ key-value çš„ï¼Œå­˜å‚¨åœ¨ etcd é›†ç¾¤ä¸Šï¼ŒæœåŠ¡å¯é€šè¿‡ hawk-client æ‹‰å–é…ç½®åˆ°æœåŠ¡æœ¬åœ°ç”Ÿæˆæœ¬åœ°çš„é…ç½®æˆ–ç›´æŽ¥å¯¼å…¥åˆ°æœ¬åœ°çŽ¯å¢ƒå˜é‡ï¼Œè¿™äº›é…ç½®éšç€æœåŠ¡å¯åŠ¨å°±ä¼šç”Ÿæ•ˆã€‚

> Qï¼šä¸ºä»€ä¹ˆè¦è‡ªå·±å¼€å‘ä¸€ä¸ªé…ç½®ä¸­å¿ƒï¼Œè€Œä¸æ˜¯ç›´æŽ¥ä½¿ç”¨ Spring Cloud Configï¼Ÿ

Aï¼šå…¶å®žå¾ˆå¾ˆç®€å•ï¼Œå•çº¯çš„ Spring Cloud Config æ²¡æœ‰åŠžæ³•å……åˆ†åœ°åˆ‡åˆä¼ä¸šç³»ç»Ÿçš„ç”Ÿäº§éœ€è¦ã€‚æˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªåŠŸèƒ½å¯¹æ¯”å›¾ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š

> Qï¼šè¯·é—®è¿™ä¸ªé…ç½®ä¸­å¿ƒåªèƒ½åº”ç”¨äºŽ Java è¯­éŸ³å—ï¼Ÿ

Aï¼šé…ç½®ä¸­å¿ƒçš„ä»£ç æ˜¯ Java ç¼–å†™çš„ï¼Œä½†æ˜¯é…ç½®ä¸­å¿ƒçš„ä½¿ç”¨æ–¹ï¼Œå³æ‹‰å–é…ç½®çš„ä¸€æ–¹æ˜¯ä¸é™åˆ¶è¯­è¨€ï¼Œå› ä¸ºé…ç½®æ‹‰å–æ˜¯åŸºäºŽ http åè®®ã€‚

> Qï¼šè¯·é—® CI/CD æµç¨‹æŽ§åˆ¶æ˜¯è‡ªå·±ç ”å‘çš„è¿˜æ˜¯ç”¨çš„å¼€æºæ–¹æ¡ˆï¼Ÿ

Aï¼šCI/CD æŒç»­é›†æˆï¼ŒæŒç»­äº¤äº’å…¶å®žæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ¦‚å¿µï¼Œæˆ‘ç†è§£ä½ æƒ³é—®çš„æ˜¯ Hawk çš„æ“ä½œæµç¨‹ä»¥åŠæ‰€ä½¿ç”¨çš„æŠ€æœ¯æ ˆçš„é—®é¢˜ï¼Œæœ€åˆæˆ‘ä»¬å‚è€ƒè¿‡å…¶ä»–çš„ä¸€äº›å¼€æºæ¯”å¦‚æºç¨‹çš„ Appoloï¼Œç™¾åº¦çš„ Disconf ç­‰ï¼Œç»“åˆä»–ä»¬çš„ä¸€äº›ç†å¿µï¼Œæˆ‘ä»¬åˆè‡ªå·±æ€»ç»“æ€è€ƒäº†è‡ªå·±çš„éœ€æ±‚ï¼Œå¯¹ CI/CD çš„ä¸šåŠ¡åšå‡ºå½’çº³ï¼Œä»¥è¾¾åˆ°ç®€å•ç›´æŽ¥çš„ç›®æ ‡ï¼ŒæŠ€æœ¯æ–¹é¢ï¼Œæˆ‘ä»¬ä¸»è¦ç”¨åˆ° Spring Bootï¼Œ Spring Cloud ä»¥åŠ etcd ç­‰æŠ€æœ¯ï¼Œå…¶ä¸­ Spring Cloud ä¸»è¦é€‚ç”¨äºŽæœåŠ¡æ³¨å†Œå‘çŽ°ï¼ŒæœåŠ¡æ²»ç†ç­‰æ–¹é¢ã€‚

> Qï¼šæˆ‘æƒ³é—®ä¸‹ï¼Œå…³äºŽé…ç½®ä¸­å¿ƒéƒ¨ç½²é—®é¢˜ï¼Œç¬¬ä¸€ä¸ªï¼Œä¸åŒçŽ¯å¢ƒæˆ–è€…ä¸åŒé›†ç¾¤ï¼Œä½ ä»¬é…ç½®ä¸­å¿ƒæ˜¯æ€Žä¹ˆéƒ¨ç½²çš„ï¼Œè¿˜æœ‰ï¼Œä¸€äº›åŸºç¡€ç»„ä»¶é…ç½®å’Œåº”ç”¨é…ç½®æ”¾åœ¨ä¸€ä¸ªé…ç½®ä¸­å¿ƒå—ï¼Ÿ

Aï¼š é…ç½®ä¸­å¿ƒé€šè¿‡ä¸åŒçš„å­˜å‚¨é›†ç¾¤ï¼Œå¯ä»¥å®žçŽ°ä¸€ä¸ªé…ç½®ä¸­å¿ƒæœåŠ¡å¤šä¸ªçŽ¯å¢ƒï¼Œä½†æ˜¯åŽŸåˆ™ä¸Šï¼Œå»ºè®®æµ‹è¯•ï¼Œå¼€å‘å…¬ç”¨ä¸€ä¸ªä¸ç†Ÿè€Œç”Ÿäº§ç‹¬ç«‹éƒ¨ç½²ï¼Œé…ç½®ä¸­å¿ƒçš„ä¸­å¿ƒæ¦‚å¿µæ˜¯åŸºäºŽå¾®æœåŠ¡ï¼Œæ‰€ä»¥ä»Žæ¦‚å¿µä¸Šè¯´ï¼Œæˆ‘ä»¬çš„é…ç½®æ˜¯ç”Ÿæ•ˆäºŽä¸€ä¸ªæœåŠ¡ä¸‹çš„å®žä¾‹çº§åˆ«ï¼Œè€Œä¸æ˜¯ç»„ä»¶çº§åˆ«ï¼Œæ¯ä¸ªå®žä¾‹ä¸‹åˆåˆ†ä¸ºä¸åŒçš„å‘½åç©ºé—´ï¼Œå‘½åç©ºé—´å¯åˆ’åˆ†ä¸ºï¼šåº”ç”¨å±‚ï¼ŒçŽ¯å¢ƒå˜é‡å’Œè‡ªå®šä¹‰çš„ç»„ä»¶ï¼Œå¯ç”±å®¢æˆ·è‡ªå®šä¹‰ï¼Œæ‰€ä»¥åŽŸåˆ™ä¸Šæ¶µç›–äº†ç»„ä»¶ä¸ŽæœåŠ¡çš„æ¦‚å¿µã€‚

---

### 2017-12-25ï¼šåœ¨é¡¹ç›®å®žè·µä¸­ï¼Œå¦‚ä½•è¿›è¡Œå®¹å™¨åŒ–æ”¹é€ å’Œ DevOps å»ºè®¾ï¼Ÿ

> Qï¼šæ‚¨ç¡®å®šä½ ä»¬æ˜¯ FTP åšæ–‡ä»¶ç®¡ç†ï¼Ÿ

Aï¼šFTP åªæœ‰ç”¨äºŽå­˜æ”¾æ´»åŠ¨å®£ä¼ çš„å›¾ç‰‡ï¼Œåœ¨å®¹å™¨çŽ¯å¢ƒä¸­ï¼Œéœ€è¦æŠŠè¿™äº›å›¾ç‰‡åŒæ­¥åˆ° stN å®¹å™¨ä¸­ã€‚

> Qï¼šç”¨ Jenkins æµ‹è¯•å®Œäº†ä»¥åŽå¦‚ä½•å‘å¸ƒåˆ°ç”Ÿäº§çŽ¯å¢ƒçš„ï¼Ÿ

Aï¼šç”±äºŽè¿™ä¸ªé¡¹ç›®çš„å®¢æˆ·æ˜¯å¼€å‘å’Œæµ‹è¯•çŽ¯å¢ƒä¸­ä¸€ä¸ªå®¹å™¨ç®¡ç†å¹³å°ï¼Œç”Ÿäº§çŽ¯å¢ƒä¸€ä¸ªå®¹å™¨ç®¡ç†å¹³å°ï¼Œå¼€å‘æµ‹è¯•å†™æˆï¼Œç”Ÿæˆç”Ÿäº§çŽ¯å¢ƒçš„é•œåƒ tagï¼›ç”±äºŽç”Ÿäº§çŽ¯å¢ƒçš„åº”ç”¨ stack æ›´æ–°ï¼Œéœ€è¦é€šè¿‡æ‰‹åŠ¨è§¦å‘ï¼Œè¿›è¡Œæ›´æ–°ã€‚

> Qï¼šè¯·é—®ï¼Œæ—¥å¿—çš„è¯ï¼Œæ˜¯ä¸æ˜¯æ¯ä¸ªæœåŠ¡éƒ½æœ‰è§„å®šæ ¼å¼ï¼Ÿ

Aï¼šåšåº”ç”¨å®¹å™¨åŒ–æ”¹é€ ï¼Œéœ€è¦è¿›è¡Œåº”ç”¨æ—¥å¿—çš„æ”¶é›†ï¼Œè¿™æ ·éœ€è¦è§„å®šåº”ç”¨æ—¥å¿—è¾“å‡ºçš„æ ¼å¼å’Œç›®å½•ã€‚è¿™æ ·æ–¹ä¾¿è¿›è¡Œç»Ÿä¸€çš„æ—¥å¿—æ”¶é›†ä¸Žç®¡ç†ã€‚

> Qï¼šè¿™ä¸ªçŽ¯å¢ƒæ”¯æŒåº”ç”¨ä¸€é”®éƒ¨ç½²åˆ°å…¬æœ‰äº‘å˜›ï¼Ÿ

Aï¼šå¦‚æžœä½¿ç”¨ PaaS äº‘æ··åˆäº‘éƒ¨ç½²ï¼Œæ˜¯å¯ä»¥æ”¯æŒä¸€é”®éƒ¨ç½²åˆ°å…¬æœ‰äº‘çŽ¯å¢ƒä¸­ã€‚

> Qï¼š å“ªäº›ç±»åž‹çš„åº”ç”¨å’Œç³»ç»Ÿï¼Œä¸é€‚åˆå®¹å™¨åŒ–å‘¢ï¼Ÿ

Aï¼šæœ‰ä¸€äº›å¯¹ IO è¦æ±‚å¤ªé«˜çš„åº”ç”¨æˆ–ç³»ç»Ÿï¼Œä¸å¤ªé€‚åˆå®¹å™¨åŒ–ã€‚

> Qï¼šè¯·é—®æ•°æ®åº“æ˜¯æ€Žæ ·éƒ¨ç½²çš„ï¼Œæœ‰è¿›è¡Œå®¹å™¨åŒ–å—ï¼Ÿ

Aï¼šæ­¤å®¢æˆ·é¡¹ç›®å®žæ–½ä¸­ï¼Œä½¿ç”¨ MySQL å’Œ MongoDB ä¸¤ç§æ•°æ®åº“ã€‚å…¶ä¸­ MongoDB é›†ç¾¤éƒ¨ç½²ï¼Œåšäº†å®¹å™¨åŒ–æ”¹é€ ï¼›å¦å¤–ï¼ŒMySQL æ•°æ®åº“ä½¿ç”¨é˜¿é‡Œäº‘çš„ RDS æ•°æ®åº“ï¼Œæ²¡æœ‰å®¹å™¨åŒ–ã€‚é˜¿é‡Œäº‘å¹³å°æä¾›æœåŠ¡åº“æœåŠ¡å’Œå¤‡ä»½ï¼Œå¿«ç…§ã€‚

> Qï¼šAKF åŽŸåˆ™å¯ä»¥è¯¦ç»†ä»‹ç»å˜›ï¼Ÿ

Aï¼šAKF æ‰©å±•ç«‹æ–¹ä½“ï¼ˆå‚è€ƒã€ŠThe Art of Scalabilityã€‹ï¼‰æŠ€æœ¯ä¸“å®¶æŠ½è±¡æ€»ç»“çš„åº”ç”¨æ‰©å±•çš„ä¸‰ä¸ªç»´åº¦ï¼š Y è½´ ï¼šæ˜¯åŠŸèƒ½åˆ†è§£ï¼Œå°†ä¸åŒèŒèƒ½çš„æ¨¡å—åˆ†æˆä¸åŒçš„æœåŠ¡ã€‚ä»Ž y è½´è¿™ä¸ªæ–¹å‘æ‰©å±•ï¼Œæ‰èƒ½å°†å·¨åž‹åº”ç”¨åˆ†è§£ä¸ºä¸€ç»„ä¸åŒçš„æœåŠ¡ï¼Œä¾‹å¦‚è®¢å•ç®¡ç†ä¸­å¿ƒã€å®¢æˆ·ä¿¡æ¯ç®¡ç†ä¸­å¿ƒã€å•†å“ç®¡ç†ä¸­å¿ƒã€æ”¯ä»˜ç³»ç»Ÿç­‰ç­‰ã€‚ è¯¦ç»†è¯·å‚è€ƒã€ŠThe Art of Scalabilityã€‹

> Qï¼šå¦‚ä½•åˆ‡æ¢å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§çŽ¯å¢ƒçš„å‚æ•°é…ç½®ï¼Ÿ

Aï¼š å¦‚æžœæ‚¨æœ‰ä¸‰ä¸ª Environment çŽ¯å¢ƒï¼Œå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§çŽ¯å¢ƒéœ€æ±‚ï¼›æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ä¸ªçŽ¯å¢ƒåˆ†åˆ«å¦‚ä¸‹ï¼šDEVï¼ˆå¼€å‘çŽ¯å¢ƒï¼‰ã€TESTï¼ˆæµ‹è¯•çŽ¯å¢ƒï¼‰ã€PROï¼ˆç”Ÿäº§çŽ¯å¢ƒï¼‰ï¼Œæ¯ä¸ªçŽ¯å¢ƒä¸‹é¢çš„åº”ç”¨æ ˆä¸Žå…¶å®ƒçŽ¯å¢ƒæƒ³åˆ°éš”ç¦»ï¼Œäº’ä¸å½±å“ï¼›å¦‚æžœéœ€è¦åˆ‡æ¢ç®¡ç†ï¼Œåªéœ€è¦åœ¨ç®¡ç†å¹³å°ä¸­è¿›è¡Œ ENV çŽ¯å¢ƒçš„åˆ‡æ¢ï¼Œå³å¯å¯¹ç›¸åº”çš„çŽ¯å¢ƒä¸Žåº”ç”¨æ ˆè¿›è¡Œç®¡ç†ã€‚

> Qï¼šè¯·é—®ç›®å‰ç›‘æŽ§ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆæ–¹æ¡ˆï¼Ÿ

Aï¼šå®¹å™¨ç®¡ç†å¹³å°æœ¬èº«æ˜¯åŸºäºŽ cAdvisor å¯ä»¥ç›‘æŽ§å®žæ—¶å®¹å™¨æŒ‡æ ‡ CPUã€Menoryã€I/Oã€ç½‘ç»œèµ„æºèµ„æºã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿå¯ä»¥éƒ¨ç½²ä½¿ç”¨å…¶å®ƒç›‘æŽ§åº”ç”¨æ ˆã€‚ä¾‹å¦‚ï¼šPrometheusã€Grafanaã€Datadog ç­‰ã€‚

> Qï¼šä»£ç æ€Žä¹ˆéƒ¨ç½²åˆ°å®¹å™¨ä¸­ï¼Œæ˜¯é€šè¿‡å¤–éƒ¨ç¡¬ç›˜æŒ‚è½½å—ï¼Œæ˜¯ä¸æ˜¯æ¯æ¬¡éƒ½é‡æ–°ç”Ÿæˆæ–°çš„é•œåƒï¼Ÿ

Aï¼šå®¹å™¨æœ¬èº«æ˜¯ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒçŸ­æš‚ï¼Œè€Œä¸”ä¼šæ ¹æ®ç­–ç•¥è‡ªåŠ¨è¿ç§»ã€‚ä¸€èˆ¬ä¸ä¼šæŠŠä»£ç ä»£ç é€šè¿‡å¤–éƒ¨æŒ‚è½½åˆ°å®¹å™¨ã€‚é€šå¸¸åšæ³•å¦‚æžœä»£ç å˜åŠ¨æˆ–æ›´æ–°ï¼Œé‡æ–° build é•œåƒã€‚å¯ä»¥æ ¹æ®è‡ªå·±å®šä¹‰æ˜¯æ—¶é—´æ®µè¿›è¡Œ build é•œåƒã€‚

> Qï¼šå¯¹äºŽæ•°æ®åº“é›†ç¾¤ï¼ŒçŽ°é˜¶æ®µæ˜¯æ€Žä¹ˆè¿ç»´çš„ï¼Œæœ‰æ¡ˆä¾‹ï¼ŸåŒæ—¶å¯¹äºŽæ•°æ®å®‰å…¨æ˜¯æ€Žä¹ˆä¿è¯çš„ï¼Ÿæ•°æ®çš„å¤‡ä»½é‡‡ç”¨ä»€ä¹ˆæ–¹å¼ï¼Ÿ

Aï¼šé’ˆå¯¹æ•°æ®åº“é›†ç¾¤çš„è¿ç»´ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªé’ˆå¯¹æ€§å¾ˆå¼ºçš„ä¸“ä¸šé—®é¢˜ï¼›æ•°æ®åº“çš„å¤‡ä»½/è¿˜åŽŸã€ç›‘æŽ§ã€æ•…éšœå¤„ç†ã€æ€§èƒ½ä¼˜åŒ–ã€å‡çº§/è¿ç§»ã€å¥åº·æ£€æŸ¥ï¼Œç”¨æˆ·åé¦ˆæ•°æ®åº“é—®é¢˜ç­‰ç­‰ï¼Œè¿™äº›éƒ½éœ€è¦ä¸“é—¨çš„ DBA å¤„ç†ã€‚æ•°æ®åº“è¿ç»´æ€»åŽŸåˆ™ï¼šç¬¬ä¸€ï¼šèƒ½ä¸ç»™æ•°æ®åº“åšçš„äº‹æƒ…ä¸è¦ç»™æ•°æ®åº“ï¼Œæ•°æ®åº“åªåšæ•°æ®å®¹å™¨ï¼›ç¬¬äºŒï¼šå¯¹äºŽæ•°æ®åº“çš„å˜æ›´å¿…é¡»æœ‰è®°å½•ï¼Œå¯ä»¥å›žæ»šã€‚ æ•°æ®åº“çš„å®‰å…¨è‡³å…³é‡è¦ï¼Œæœ‰ç›¸åº”çš„æƒé™ç®¡ç†ï¼Œä»¥æœ€ä½Žç²’åº¦çš„æŽ§åˆ¶æƒé™ã€‚æ‰€æœ‰å¼€å‘äººå‘˜æƒé™ç²’åº¦åˆ°è¡¨ä¸€çº§ï¼Œæ•°æ®åº“ç®¡ç†å‘˜å’Œç³»ç»Ÿç®¡ç†å‘˜æƒé™ç²’åº¦åˆ°åº“ä¸€çº§ç­‰ç­‰ã€‚ä¸åŒçš„æ•°æ®åº“ä»¥åŠéƒ¨ç½²æ–¹å¼ä¸ä¸€æ ·ï¼Œè¦æ±‚çš„å¤‡ä»½ä¹Ÿæœ‰å·®åˆ«ã€‚ä»¥ MySQL ä¸ºä¾‹ï¼Œå¦‚æžœæ­å»ºä¸»ä»Žæž¶æž„ï¼Œå°±è¦é€šè¿‡ binlog æ–‡ä»¶åŒæ­¥å¤åˆ¶ä¸»åº“çš„æ•°æ®ã€‚å¦å¤–ï¼Œé€šè¿‡ç³»ç»Ÿè®¡åˆ’ä»»åŠ¡æ‰§è¡Œ mysqldump åšå‘¨æœŸæ€§å…¨å¤‡ä»½ï¼›è¿˜æœ‰ï¼Œç‰©ç†å¤‡ä»½ï¼Œç›´æŽ¥æ‹·è´æ•°æ®æ–‡ä»¶ã€å‚æ•°æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ã€‚æœ€åŽï¼Œä¸“é—¨çš„å¤‡ä»½å·¥å…·å¦‚ï¼šmysqlhotcopyã€ibbackup ç­‰ã€‚

---

### 2017-12-22ï¼šJDOS 2.0ï¼šKubernetes çš„å·¥ä¸šçº§å®žè·µ

> Qï¼šè¯·é—® Skynet ç½‘ç»œåŸºäºŽ OpenStack Neutron å—ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ Kubernetes çš„ç½‘ç»œæ˜¯åˆ†ä¸ºä¸¤å¥—ã€‚æœ€å¼€å§‹æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Neutronï¼Œå› ä¸ºæˆ‘ä»¬çš„ JDOS 1.0 å·²ç»ç¨³å®šè¿è¡Œäº†å¤šå¹´ã€‚ä»Šå¹´å¼€å§‹ï¼Œæˆ‘ä»¬å¾ˆå¤šæ•°æ®ä¸­å¿ƒé‡‡ç”¨çš„æ˜¯ BGP çš„ç½‘ç»œã€‚å¯ä»¥å‚è€ƒ Calico çš„å®žçŽ°ã€‚

> Qï¼šLVM çš„ç£ç›˜ IO é™åˆ¶æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šè¿™æ˜¯é€šè¿‡æ”¹é€  kube-apiserver ä»¥åŠ kubeletï¼ŒæŠŠç£ç›˜é™åˆ¶çš„æŒ‡æ ‡ä¹Ÿä½œä¸ºä¸€ç§èµ„æºï¼Œåº•å±‚æœ€ç»ˆä½¿ç”¨ Cgroup å®žçŽ°çš„ã€‚

> Qï¼šå·¡æ£€å·¥å…·æ˜¯åªæ£€æŸ¥ä¸ä¿®å¤å—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œå·¡æ£€çš„ç›®çš„å°±åªæ˜¯æ£€æŸ¥å¹¶é€šçŸ¥ï¼Œä¸€èˆ¬æœ‰é—®é¢˜ä¼šæ‰¾è¿ç»´ä¿®å¤ã€‚

> Qï¼šä½¿ç”¨çš„ä»€ä¹ˆ Docker storage driverï¼Ÿ

Aï¼šæˆ‘ä»¬ JDOS 1.0 æ˜¯ä½¿ç”¨çš„è‡ªç ”çš„ Vdiskï¼Œ2.0 ä½¿ç”¨çš„æ˜¯ DMã€‚

> Qï¼šä¸ºäº†æå‡ Pod æ›´æ–°é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯¹å®¹å™¨åˆ é™¤çš„æµç¨‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå°† CNI æŽ¥å£çš„è°ƒç”¨æå‰åˆ°äº† stop å®¹å™¨ï¼Œæ²¡å¤ªæ˜Žç™½è¿™é‡Œã€‚

Aï¼šåˆ é™¤å®¹å™¨çš„æµç¨‹åŽŸæœ¬æ˜¯ stop app å®¹å™¨-> è°ƒç”¨ CNI->stop sandbox å®¹å™¨ã€‚å› ä¸ºåœ¨å®žé™…ä¸­ï¼Œstop app å®¹å™¨æ—¶é—´ä¼šè¾ƒé•¿ã€‚å› æ­¤æˆ‘ä»¬å°†å…¶è°ƒæ•´ä¸ºè°ƒç”¨ CNI->stop app å®¹å™¨->stop sandbox å®¹å™¨ã€‚è¿™æ ·å¯ä»¥æ›´å¿«é‡Šæ”¾ IPã€‚

> Qï¼šæœ‰ç”¨ PV PVC å—ï¼Ÿåº•å±‚å­˜å‚¨å¤šçš„ä»€ä¹ˆæŠ€æœ¯ï¼Ÿ

Aï¼šæœ‰ç”¨åˆ° PV PVCï¼Œåº•å±‚å­˜å‚¨ä½¿ç”¨çš„æ˜¯æˆ‘ä»¬è‡ªç ”çš„ ContainerFSã€‚ç›®å‰å·²ç»å¼€æºåœ¨ GitHub ä¸Šï¼Œæ¬¢è¿Žä½¿ç”¨ã€‚

> Qï¼šè¯·é—®ç›¸åŒ Service çš„ä¸åŒ Pod ä¸Šçš„ logï¼Œfmï¼Œpm æ€Žä¹ˆåšæ±‡æ€»çš„ï¼Ÿ

Aï¼šPod çš„æ—¥å¿—æ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨æœ‰ daemonset çš„ä¸€ä¸ªå®¹å™¨ï¼Œè´Ÿè´£æ”¶é›†è¯¥èŠ‚ç‚¹ä¸Šçš„æ—¥å¿—ï¼Œå¹¶å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—äºˆä»¥æ±‡æ€»çš„ã€‚

> Qï¼šèƒ½è¯¦ç»†æè¿°ä¸€ä¸‹"gRPC çš„é—®é¢˜å¯¼è‡´äº† apiserver çš„æ€§èƒ½ç“¶é¢ˆ"çš„å…·ä½“å†…å®¹å—ï¼Ÿ

Aï¼šåœ¨ 1.6 æˆ‘ä»¬åŽŸæ¥ä½¿ç”¨çš„å•ä¸ª apiserver åœ¨æœåŠ¡å¤§æ¦‚ 300 ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå°±ä¼šå¤§é‡æ‹’ç»è¯·æ±‚ï¼Œå‡ºçŽ° 409 é”™è¯¯ã€‚åŽæ¥æˆ‘ä»¬æŸ¥é˜…äº†ç¤¾åŒºçš„ç›¸å…³èµ„æ–™ï¼Œå‘çŽ°æ˜¯ gRPC çš„é—®é¢˜ï¼Œé€šè¿‡å‡çº§ gRPC åŒ…ï¼Œå¯ä»¥å®žçŽ° 600 ä»¥ä¸ŠèŠ‚ç‚¹æ— åŽ‹åŠ›ã€‚

> Qï¼šè¯·é—®å¤š IDC çš„åœºæ™¯ä½ ä»¬æ˜¯å¦‚ä½•ç®¡ç†çš„ï¼Ÿ

Aï¼šç›®å‰æ˜¯åˆ†å¤šä¸ªæ•°æ®ä¸­å¿ƒï¼Œæ¯ä¸ªæ•°æ®ä¸­å¿ƒå†åˆ’åˆ†å¤šä¸ªé›†ç¾¤ã€‚æŽ§åˆ¶å•ä¸ªé›†ç¾¤è§„æ¨¡ï¼Œè¿™æ ·æ–¹ä¾¿ç®¡ç†ã€‚ä½†æ˜¯é•œåƒã€é…ç½®ã€è°ƒåº¦å¯ä»¥åœ¨ä¸åŒæ•°æ®ä¸­å¿ƒã€ä¸åŒé›†ç¾¤é—´é€šç”¨ã€‚è¿™æ ·é›†ç¾¤å’Œæ•°æ®ä¸­å¿ƒå¯¹ç”¨æˆ·é€æ˜Žã€‚

> Qï¼šåŠ å›ºçŽ¯èŠ‚ï¼ˆåŒ…æ‹¬ etcd æ•…éšœã€apiserver å…¨éƒ¨å¤±è”ã€apiserver æ‹’ç»æœåŠ¡ç­‰ç­‰æžç«¯æƒ…å†µï¼‰ä¸Šé¢åˆ—ä¸¾çš„å‡ ç§æƒ…å†µå‘ç”Ÿæ—¶ä¼šé€ æˆç¾éš¾æ€§åŽæžœå—ï¼ŒKubernetes é›†ç¾¤çš„è¡Œä¸ºä¼šæ€Žæ ·ï¼Œæœ‰è¿›è¡Œæ¼”ç»ƒè¿‡ä¸ï¼Œè¿™å—å¯ä»¥ç»†è¯´ä¸€ä¸‹å—ï¼Ÿ

Aï¼šå½“ç„¶ï¼Œå¦‚æžœæœªç»è¿‡åŠ å›ºæˆ–è€…ä¸èƒ½æ­£å¸¸æ¢å¤ etcd æ•°æ®ï¼Œè¿˜å¯èƒ½å¯¼è‡´ pod å¤§é‡è¿ç§»æˆ–é”€æ¯ï¼Œç”šè‡³æ•´ä¸ªé›†ç¾¤èŠ‚ç‚¹åŽ‹åŠ›å¢žå¤§ï¼Œå‘ç”Ÿé›ªå´©æ•ˆåº”ï¼Œæœ€ç»ˆæ•´ä¸ªé›†ç¾¤å´©æºƒã€‚

> Qï¼šPod å›ºå®š IP çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆå®žé™…æ„ä¹‰ï¼Ÿ

Aï¼šå‘ƒï¼Œè¿™ä¸ªå®žé™…å¾ˆå¤šä¸šåŠ¡ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›è€ä¸šåŠ¡ï¼Œæ˜¯æ— æ³•åšåˆ°å®Œå…¨æ— çŠ¶æ€çš„ã€‚å¦‚æžœä¸èƒ½æä¾›å›ºå®š IPï¼Œé‚£ä¹ˆä»–ä»¬çš„é…ç½®ä¸Šçº¿éƒ½ä¼šå¾ˆéº»çƒ¦ã€‚

> Qï¼šè¯·é—®æœ‰ä½¿ç”¨ SR-IOV æˆ–è€… DPDK çš„æŠ€æœ¯å—ï¼Ÿå¦‚æžœç›®å‰æ²¡æœ‰ï¼Œæ˜¯æœ‰å“ªæ–¹é¢çš„è€ƒé‡ï¼Œå°†æ¥ä¼šè€ƒè™‘å—ï¼Ÿ**

Aï¼š æœ‰å•Šï¼Œå¯ä»¥å‚è§æˆ‘ä»¬çš„å›¢é˜Ÿçš„åˆ†äº«ï¼š[mp.weixin.qq.com/s/ZPDU66B_Cr1Zgb-k6t1zUA](http://mp.weixin.qq.com/s/ZPDU66B_Cr1Zgb-k6t1zUA)ã€‚

> Qï¼šè¯·é—®ç³»ç»Ÿå¼€å‘å®Œæ¯•åŽï¼Œä¸‹ä¸€æ­¥æœ‰ä»€ä¹ˆè®¡åˆ’ï¼Ÿè¿›å…¥ç»´æŠ¤ä¼˜åŒ–é˜¶æ®µï¼Œä¼˜ç§€çš„è®¾è®¡å¼€å‘äººå‘˜ä¸‹ä¸€æ­¥æ€Žä¹ˆçŽ©ï¼Ÿ

Aï¼šå®¹å™¨åŒ–ï¼Œè‡ªåŠ¨åŒ–è¿™æ‰æ˜¯ä¸‡é‡Œé•¿å¾çš„ç¬¬ä¸€æ­¥å•Šã€‚æˆ‘ä»¬å·²ç»åœ¨è°ƒåº¦æ–¹é¢åšäº†å¾ˆå¤šçš„å·¥ä½œï¼Œå¯ä»¥å‚çœ‹æˆ‘ä»¬å›¢é˜Ÿå…³äºŽé˜¿åŸºç±³å¾·çš„ä¸€äº›åˆ†äº«ã€‚é›†ç¾¤è‡ªæ²»ä¸Žæ™ºèƒ½åŒ–ï¼Œæˆ‘ä»¬å·²ç»åœ¨è·¯ä¸Šäº†ã€‚æ¬¢è¿Žå¤§å®¶ä¸€é“æ¥å®žè·µã€‚æœªæ¥æˆ‘ä»¬ä¹Ÿä¼šåŒå¤§å®¶åˆ†äº«è¿™å…¶ä¸­çš„ç»éªŒã€‚

> Qï¼šåº”ç”¨æ»šåŠ¨å‡çº§ï¼Œæœ‰æ— å®šåˆ¶ï¼Ÿè¿˜æ˜¯é‡‡ç”¨ Kubernetes é»˜è®¤æœºåˆ¶ï¼Ÿ

Aï¼šæ˜¯æˆ‘ä»¬è‡ªå·±å®šåˆ¶çš„ deploymentï¼Œè¿›è¡Œäº†é€‚å½“çš„æ”¹é€ ï¼Œå¯ä»¥æ”¯æŒæš‚åœçŠ¶æ€ï¼Œæ¯”å¦‚è¯´æ›´æ–°æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸¤ä¸ªç‰ˆæœ¬çš„ Pod ä¸ªæ•°æ¯”ä¾‹ï¼Œä¸­æ­¢åœ¨è¿™ä¸ªä¸­é—´çŠ¶æ€ã€‚

> Qï¼šèƒ½å¦ä»‹ç»ä¸€ä¸‹å¯¹ GPU æ”¯æŒè¿™å—ï¼Ÿ

Aï¼šGPU æˆ‘ä»¬çš„çŽ©æ³•å…¶å®žå¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªå®¹å™¨ä¸€å—å¡ï¼Œæ¯ä¸ªå¡åªåˆ†ç»™ä¸€ä¸ªå®¹å™¨ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å®‰å…¨ï¼Œåˆ†é…æ•ˆçŽ‡é«˜ï¼Œåˆ©ç”¨çŽ‡ä¹Ÿæ¯”è¾ƒé«˜ã€‚

---

### 2017-12-16ï¼šä¸œæ–¹å›½ä¿¡åŸºäºŽ Kubernetes æž„å»ºå®¹å™¨äº‘å¹³å°çš„å®žè·µå’Œæ€è€ƒ

> Qï¼šè¯·é—®ä¸ç”¨ Jenkinsï¼Œå¼€å‘ shera åŸºäºŽä»€ä¹ˆè€ƒè™‘ï¼Ÿ

Aï¼šåˆšå¼€æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿç”¨äº† Jenkinsï¼Œä½†æ˜¯å¾ˆéš¾è·Ÿæˆ‘ä»¬çš„å¤šç§Ÿæˆ·ç»“åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¹²è„†è‡ªå·±å¼€å‘ä¸€å¥—äº†ã€‚

> Qï¼šè¯·é—®ç°åº¦å‘å¸ƒå¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šç°åº¦å‘å¸ƒæ—¶é€šè¿‡ä¸€ä¸ª service å¯¹åº”ä¸¤ä¸ª rc æ¥å®žçŽ°ï¼Œä¸€ä¸ª rc ç®¡ç†è€çš„åº”ç”¨ï¼Œä¸€ä¸ª rc ç®¡ç†æ–°çš„åº”ç”¨ã€‚

> Qï¼šPinpoint æ˜¯ Tomcat å¯åŠ¨æ—¶å€™åŠ è½½çš„ï¼Œä¸é‡å¯åº”ç”¨çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•æŽ§åˆ¶ Pinpoint å¼€å…³ï¼Ÿ

Aï¼šæˆ‘ä»¬å¢žåŠ äº†çŽ¯å¢ƒå˜é‡ï¼Œé€šè¿‡è„šæœ¬åˆ¤æ–­çŽ¯å¢ƒå˜é‡ï¼Œç„¶åŽæŽ§åˆ¶ Tomcat å¯åŠ¨ã€‚

> Qï¼šè¯·é—®æŒ‚åœ¨çš„ Ceph å­˜å‚¨çš„æ–¹å¼æ˜¯ä»€ä¹ˆï¼Œå—è¿˜æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Ÿ

Aï¼šå—å’Œæ–‡ä»¶ç³»ç»Ÿæˆ‘ä»¬éƒ½æœ‰ç”¨ï¼Œéœ€è¦å¤šå®žä¾‹çš„å°±ç”¨æ–‡ä»¶ç³»ç»Ÿï¼ŒMySQLã€Redis ç­‰ï¼Œå°±ç”¨çš„å—ã€‚

> Qï¼šæœ‰æ²¡æœ‰æŠŠ MySQL æˆ–è€… Redis ä¹‹ç±»çš„ä¸­é—´ä»¶æ”¾å…¥å®¹å™¨ä¸­è¿è¡Œï¼Œå¦‚æžœæ˜¯å¦‚ä½•è°ƒè¯•ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œå¦‚ä½•å®žçŽ°å¼¹æ€§æ‰©å®¹ï¼Ÿ

Aï¼šæ”¾åˆ°å®¹å™¨é‡Œé¢äº†ï¼Œæˆ‘ä»¬ä¼šæŠŠæ—¥å¿—å­˜å‚¨åˆ°å—å­˜å‚¨é‡Œé¢ï¼Œæˆ‘ä»¬ä¹Ÿæä¾›äº† shellï¼Œå¯ä»¥ç™»å½•åˆ°å®¹å™¨å†…éƒ¨è¿›è¡Œè°ƒè¯•ï¼Œæœ‰æ—¥å¿—ï¼Œåˆæœ‰å‘½ä»¤è¡Œï¼Œè¿ç»´åŸºæœ¬æ²¡é—®é¢˜ã€‚æˆ‘ä»¬æš‚æ—¶æ²¡æœ‰åš MySQL å’Œ Redis çš„æ‰©å®¹å’Œç¼©å®¹ï¼Œä¸»è¦æ˜¯ MySQL ç”¨äºŽæµ‹è¯•ä½¿ç”¨ï¼Œå•æœºç‰ˆå°±å¤Ÿäº†ï¼Œç­‰æˆ‘ä»¬ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¥å­˜å‚¨ MySQL æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä¼šè€ƒè™‘åšä¸»è¢«ã€åŒä¸»ã€æ‰©å®¹ç­‰ï¼›Redis æˆ‘ä»¬æä¾›å•æœºç‰ˆå’Œ 8 èŠ‚ç‚¹çš„é›†ç¾¤ç‰ˆæœ¬ï¼Œåªæ˜¯å†…å­˜å¯ä»¥æ‰©å®¹ï¼ŒèŠ‚ç‚¹ä¸ªæ•°æ˜¯ä¸èƒ½å˜åŒ–çš„ï¼Œ8 ä¸ªèŠ‚ç‚¹æ¯ä¸ªèŠ‚ç‚¹æœ€å¤§ 16Gï¼Œæˆ‘ä»¬æ‰€æœ‰çš„ä¸šåŠ¡éƒ½èƒ½æ»¡è¶³äº†ã€‚

> Qï¼šè¯·é—® Ceph æ˜¯å¦‚ä½•ç®¡ç†çš„ï¼Œç”³è¯·å’Œå¼€é€šæŒ‚è½½éƒ½æ˜¯è‡ªåŠ¨çš„å—ï¼Ÿç”¨çš„ CephRBD å—ï¼Ÿ

Aï¼šæœ‰è‡ªåŠ¨çš„ä¹Ÿæœ‰ä¸æ˜¯è‡ªåŠ¨çš„ï¼Œæˆ‘ä»¬æœ‰ç•Œé¢å¯ä»¥ç”³è¯·å­˜å‚¨å’Œè¿›è¡Œå¿«ç…§ç®¡ç†ï¼Œè¿™å°±ä¸æ˜¯è‡ªåŠ¨çš„ï¼ŒMySQLã€Redis è¿™äº›åº”ç”¨æˆ‘ä»¬æ˜¯ç”¨çš„ PVC è‡ªåŠ¨ç®¡ç†çš„ã€‚RBD è·Ÿ CephFS éƒ½æœ‰ç”¨ã€‚

> Qï¼šä½¿ç”¨ Ceph æ‰¿è½½æœ‰çŠ¶æ€æœåŠ¡çš„æ•°æ®æŒä¹…åŒ–æœ‰é‡åˆ°ä»€ä¹ˆå‘å—ï¼Ÿ

Aï¼šæ²¡æœ‰å¤ªå¤šå‘ï¼Œå°±æ˜¯ Scheduler é•œåƒé‡Œé¢æ²¡æœ‰ Ceph çš„ RBD å¯æ‰§è¡Œç¨‹åºï¼Œéœ€è¦è‡ªå·±é‡æ–°åšä¸€ä¸‹é•œåƒï¼ŒæŠŠ RBD æ”¾è¿›åŽ»ã€‚

> Qï¼šè¯·é—®è¿™ä¸ªç³»ç»Ÿç”¨äº†å¤šå°‘äººå¤šä¹…å®Œæˆçš„ï¼Ÿ

Aï¼š2 å¹´å‰æˆ‘ä»¬å¼€å§‹åšå®¹å™¨ï¼Œæ•´å¥—ç³»ç»Ÿç”¨äº† 20 å¤šäººå¼€å‘è°ƒè¯•äº† 1 å¹´å¤šï¼ŒåŽé¢æˆ‘ä»¬åˆåšçš„å‡çº§ï¼Œç„¶åŽæŠŠ MySQLã€Redisã€Kafkaã€ZooKeeperã€ActiveMQã€TensorFlow ç­‰å¼„äº†è¿›æ¥ï¼ŒçŽ°åœ¨è¿˜åœ¨åš Hadoop çš„å®¹å™¨åŒ–ã€‚

> Qï¼šè¯·é—®è¿™å¥—æž¶æž„ï¼Œä»Žè§„åˆ’åˆ°å®žæ–½åˆ°æŽ¨å¹¿å®Œæˆç”¨äº†å¤šä¹…ï¼Ÿ

Aï¼šæŽ¨å¹¿å‘¨æœŸå¾ˆé•¿ï¼ŒåŽ»å¹´ä¸‹åŠå¹´æŽ¨å¹¿ä¸Šçº¿äº†ä¸€åŒ¹ä¸šåŠ¡ï¼Œä»Šå¹´å…¬å¸å…¨éƒ¨çš„äº§å“éƒ½å¼€å§‹æŽ¨å¹¿ä½¿ç”¨è¿™å¥—ç³»ç»Ÿï¼Œæ‰€ä»¥è¯´æŽ¨å¹¿å®Œç”¨å¤šä¹…ï¼Œä¸å¥½è¯´ï¼ŒçŽ°åœ¨ä¹Ÿæ˜¯è¾¹å¼€å‘è¾¹æŽ¨å¹¿ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 12 æœˆ 12 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚ åˆ†äº«äººå´”ä¸œï¼šä¸œæ–¹å›½ä¿¡å®¹å™¨äº‘æŠ€æœ¯è´Ÿè´£äººï¼Œä¸»è¦è´Ÿè´£å›½ä¿¡å®¹å™¨äº‘å¹³å°çš„æž¶æž„å’Œå®žçŽ°ï¼Œæ”¯æŒå…¬å¸å„äº§å“çº¿çš„äº‘åŒ–ã€‚

---

### 2017-12-13ï¼šDocker åœ¨æµ‹è¯•ä¸­çš„åº”ç”¨

> Qï¼šä½ å¥½ï¼Œæˆ‘æ˜¯ Docker åˆå­¦è€…åŒæ—¶å¯¹æµ‹è¯•å·¥ä½œä¸æ˜¯ç‰¹åˆ«äº†è§£ï¼Œæˆ‘èƒ½ç®€å•çš„ç†è§£ä½ ä»¬æ˜¯æ ¹æ® Web ç•Œé¢å¡«å†™çš„åŽ‹æµ‹éœ€æ±‚ç„¶åŽç”Ÿæˆå¾ˆå¤šçš„ Docker å®¹å™¨å……å½“å®¢æˆ·ç«¯åŽ»å¤§é‡è¯·æ±‚ä½ ä»¬æœåŠ¡ï¼Œç„¶åŽè¾¾åˆ°åŽ‹æµ‹æ•ˆæžœçš„å—ï¼Ÿ

Aï¼šæ‚¨ç†è§£çš„å¯¹ï¼Œå› ä¸ºåœ¨ä¼ ç»Ÿçš„åŽ‹æµ‹éœ€æ±‚ä¸­ï¼Œå¤šå°åŽ‹æµ‹ç«¯çš„éƒ¨ç½²æ˜¯ä¸ªéº»çƒ¦äº‹ï¼Œå¹¶ä¸”ä¸€å°ä¸»æœºå¦‚æžœé‡å¤åˆ©ç”¨ï¼ŒçŽ¯å¢ƒç®¡ç†æ˜¯ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰æœ‰ä½¿ç”¨ Docker çš„æƒ³æ³•ã€‚

> Qï¼šæƒ³è¯·é—®ä¸€ä¸‹åŽ‹åŠ›æµ‹è¯•ï¼Œéƒ½ä¼šå¯¹æœåŠ¡åšé‚£äº›æ–¹é¢çš„æµ‹è¯•ï¼Œæ¯”å¦‚æœ‰æ²¡æœ‰æ˜¯é«˜å¹¶å‘ç­‰ï¼Ÿ

Aï¼šä¸€èˆ¬æ¥è¯´ï¼Œæ€§èƒ½åŽ‹æµ‹å°±æ˜¯æ¨¡æ‹Ÿå¤šç”¨æˆ·ï¼Œä¸€èˆ¬æ˜¯é˜¶æ®µæ€§çš„åŽ‹æµ‹ï¼Œå¹¶å‘ã€‚æˆ‘ä»¬å…³å¿ƒçš„ç»“æžœï¼Œä¸šåŠ¡çš„è¿”å›žç ï¼Œå¹³å“ï¼Œå¹³å“åˆ†å¸ƒæ—¶é—´ç­‰ã€‚

> Qï¼šFlannel ç«¯å£æš´éœ²å’ŒæŽ¥å£å°è£…æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Œè¿˜æœ‰ Web ç•Œé¢ç”¨çš„æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šFlannel çš„ IP æš´éœ²é—®é¢˜ï¼Œæ‚¨æŸ¥è¯¢ä¸€ä¸‹ Flannel å®˜ç½‘ï¼Œè¿™ä¸ªç½‘ç»œæ’ä»¶å¯ä»¥è¾¾åˆ°æš´éœ² IPã€ç«¯å£çš„ç›®çš„ã€‚æŽ¥å£å°è£…ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯å°† Docker çš„åŽŸç”ŸæŽ¥å£è¿›è¡Œäº†å°è£…ï¼Œè¾¾åˆ°å¯ä»¥æŽ§åˆ¶å¤šå° Node çš„åŠŸèƒ½ï¼Œä¸»è¦å°è£…äº†åˆ›å»ºç½‘ç»œã€serviceï¼Œå®¹å™¨ç­‰æŽ¥å£ã€‚Web æ˜¯é‡‡ç”¨ Python çš„ Django æ¡†æž¶ã€‚

> Qï¼šéžå¸¸æ„Ÿè°¢åˆ†äº«ï¼Œæˆ‘ä¹Ÿæ˜¯ä»Žäº‹æ€§èƒ½å·¥ä½œçš„ã€‚æˆ‘æœ‰ä¸¤ä¸ªé—®é¢˜å¸Œæœ›èƒ½è§£ç­”ä¸‹ã€‚ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹åŽ‹æµ‹æœ¬èº«è€Œè¨€ï¼Œå…³æ³¨çš„ä¸ä»…ä»…æ˜¯åº”ç”¨å±‚é¢çš„æ€§èƒ½ï¼Œæ›´å¤šæ˜¯ä¸ºäº†æ˜Žç¡®çš„æµ‹è¯•ç›®æ ‡è€Œè®¾å®šçš„ç‰¹å®šåœºæ™¯ï¼Œæˆ‘æƒ³é—®çš„æ˜¯ï¼ŒDocker åœ¨è¿™æ–¹é¢å¦‚ä½•å®šä½æ€§èƒ½ç“¶é¢ˆå‡ºçŽ°åœ¨å“ªä¸ªå±‚çº§ï¼Ÿç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¦‚ä½•åˆ©ç”¨ Docker æ¨¡æ‹Ÿç”Ÿäº§çŽ¯å¢ƒçš„åŽ‹åŠ›ï¼Œæ¯”å¦‚å…¨é“¾è·¯åŽ‹æµ‹ï¼ŒJMeter æ˜¯å¦è¿˜é€‚åˆè¿™æ ·çš„ä¸šåŠ¡åœºæ™¯ï¼Œæœ‰æ²¡æœ‰å…¶ä»–çš„è§£å†³æ–¹æ¡ˆï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ Web æ˜¯æä¾›ä¼ å‚åŠŸèƒ½çš„ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰å‚æ•°æˆ–å‚æ•°åˆ—è¡¨ï¼Œè¾¾åˆ°å¤šæ ·åž‹çš„æµ‹è¯•ã€‚å¹¶ä¸”æˆ‘ä»¬æä¾›ç”¨æˆ·è‡ªå®šä¹‰æµé‡åŒ…çš„åŠŸèƒ½ã€‚åˆ°ç›®å‰ä¸ºæ­¤ï¼ŒåŽ‹æµ‹è¿‡ç¨‹ä¸­çš„ç“¶é¢ˆä¼šå¶å°”å‡ºçŽ°åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæ•°æ®é‡å¤§çš„æ—¶å€™åŽç«¯è®¡ç®—æ—¶ï¼Œä¼šå ç”¨å¤§é‡çš„å†…å­˜ã€‚ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæ¨¡æ‹Ÿç”Ÿäº§çŽ¯å¢ƒï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å›½äº§å¼€æºçš„ TCPCopyï¼Œæ‚¨å¯ä»¥æŸ¥è¯¢ä¸€ä¸‹ï¼ŒåŽŸç†å°±æ˜¯ Dump çº¿ä¸Šçš„æµé‡ï¼Œè¿›è¡Œçº¿ä¸‹å›žè®¿ã€‚æˆ–åœ¨ç‰¹å®šæ—¶é—´å›žè®¿åˆ°çº¿ä¸Šï¼Œä¸çŸ¥é“æ˜¯å¦å›žç­”äº†æ‚¨çš„é—®é¢˜ã€‚

---

### 2017-12-06ï¼šå°åž‹å…¬å¸ DevOps è½åœ°å®žè·µæ¡ˆä¾‹

> Qï¼šè¯·é—® Portainer ä»…ç”¨äºŽæµ‹è¯•çŽ¯å¢ƒè¿˜æ˜¯åœ¨ç”Ÿäº§ä¹Ÿç”¨è¿™ä¸€å¥—ï¼Ÿ

Aï¼šå› ä¸º Portainer æ˜¯ç›´æŽ¥é€šè¿‡ docker api æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰åœ¨æœåŠ¡å™¨ä¸Šè£…æœ‰ä»€ä¹ˆå®¢æˆ·ç«¯ï¼ˆä¹Ÿå°±æ˜¯æ— ä¾µå…¥ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é€‰ç”¨ä»–çš„åŽŸå› ï¼‰ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨ Docker é‡Œé¢é…ç½®äº†ä¸ª http çš„ TLS è¯ä¹¦ï¼ŒåŠ ä¸Šæˆ‘ä»¬å¯¹å®ƒåšäº†ä¸€äº›æ”¹é€ ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº† Portainer åº”ç”¨ç”Ÿäº§çŽ¯å¢ƒã€‚

> Qï¼šè¯·é—®ä¸‹æµ‹è¯•çš„æ—¶å€™æŽ¥å£æ¨¡æ‹Ÿæ‚¨è¿™è¾¹æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ

Aï¼šOstman é»˜è®¤å½•å…¥äº†å‡ ä¸ªå¤šç§æƒ…å†µä¸‹çš„å‡ºå‚ï¼Œå…¶æ¬¡ï¼Œæˆ‘ä»¬å‰ç«¯æ¯ä¸ªäººéƒ½æœ‰ä¸€å¥—ç‹¬ç«‹çŽ¯å¢ƒï¼Œé€šè¿‡ Web ç«¯ç®¡ç†éƒ¨ç½²ï¼ˆæ•°æ®åº“å’Œæµ‹è¯•äººå‘˜å…±ç”¨ï¼‰ï¼Œä¸ä¼šå—åŽå°å¼€å‘äººå‘˜å¯¹æŽ¥å£ä¿®æ”¹è€Œä¸­æ–­æœåŠ¡ã€‚å…¶æ¬¡æˆ‘ä»¬æœ‰å°‘é‡å‰ç«¯é¡µé¢ä½¿ç”¨äº† mock.jsã€‚

> Qï¼šè¯·é—® Docker é‡Œè·‘ Java åº”ç”¨æ€§èƒ½æ€Žä¹ˆè°ƒä¼˜ï¼Œé»˜è®¤æ˜¯å…±äº«èµ„æºæ± ï¼Œå¯¹ Java æ¥è¯´ CPU åˆ‡æ¢å¾ˆè´¹æ€§èƒ½ï¼Œé™¤äº†ç»‘å®š CPUï¼Œä½†è¿™æ ·å°±æ²¡æœ‰å¼¹æ€§ä¹‹è¯´ï¼Œéº»çƒ¦è¯´ä¸‹ï¼Ÿ

Aï¼šè¿™ä¸ªæ€§èƒ½ï¼Œæˆ‘ä»¬å¯¹ Java é¡¹ç›®è¿›è¡Œå¤šæ¬¡å†…å­˜ä¼˜åŒ–ï¼Œé€šè¿‡ ide çš„å†…å­˜ç®¡ç†ï¼Œçº¿ç¨‹æŸ¥çœ‹ç­‰å¤šé‡æ–¹æ³•è¿›è¡Œè°ƒä¼˜ï¼Œå•ä»Ž war åŒ…ä½“ç§¯ä¸Šæˆ‘ä»¬å°±ç¼©å°äº† 60%ï¼Œå†…å­˜ä¹Ÿä¸‹è°ƒå¾ˆå¤šã€‚æˆ‘ä»¬å¹¶ä¸èƒ½è‡ªåŠ¨ä¼¸ç¼©ï¼Œç›®å‰æ˜¯é€šè¿‡ Nginx é…ç½®å¤šå®¹å™¨æ¥å®žçŽ°è´Ÿè½½å‡è¡¡ã€‚

> Qï¼šå¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ

Aï¼šæˆ‘ä»¬åœ¨ Nginx å±‚é€šè¿‡ç­–ç•¥ä¿è¯åŒä¸€ä¸ªæœºå™¨è¯·æ±‚åªä¼šåˆ†å¸ƒåˆ°ä¸€å°æœºå™¨ä¸Šï¼Œç”¨æœ€å°‘ä»£ä»·è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…¶æ¬¡æˆ‘ä»¬é¡¹ç›®ä¸­ï¼Œå¤§éƒ¨åˆ†éƒ½ä½¿ç”¨å…¨å±€ uuid æ“ä½œå’Œæ’åº“ã€‚

> Qï¼šè´µå¸çš„ä¸šåŠ¡æ¨¡å¼è·Ÿæˆ‘ä»¬å¾ˆåƒï¼Œæ„Ÿè§‰å¾ˆå—ç”¨ã€‚æƒ³é—®ä¸‹ï¼Œå¤šå®¢æˆ·ã€å¤šç‰ˆæœ¬å…±å­˜çš„æƒ…å†µä¸‹ï¼Œç‰ˆæœ¬å‡çº§è¿™å—å„¿æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Git åˆ†æ”¯åŒ–ç®¡ç†ï¼Œç”± Jenkins å®šä¹‰ç‰ˆæœ¬å·ï¼ŒSQL åˆ†ä¸ºå…¬å…±å’Œç§æœ‰çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚æŸä¸ªå®¢æˆ·å‡çº§ 2.0.0 ç‰ˆæœ¬ï¼Œä¼šè‡ªåŠ¨æ£€æµ‹ä¸Šä¸ªç‰ˆæœ¬åˆ°æ­¤æ—¶çš„ SQL è¯­å¥ï¼Œæç¤ºé¡¹ç›®ç»ç†ç‚¹å‡»ï¼Œè‡ªåŠ¨æ‰§è¡Œã€‚ï¼ˆæˆ‘ä»¬çŽ°åœ¨å›žæ»šé¡¹ç›®ç‰ˆæœ¬ï¼Œä¸æ”¯æŒ SQL å›žæ»šï¼Œæ‰€ä»¥æˆ‘ä»¬ SQL ä¸€èˆ¬åªå¢žä¸å‡ã€ä¸æ”¹ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶æŸ¥çœ‹æŸå®¢æˆ·çº¿ä¸Šç‰ˆæœ¬å’Œ SQL æ‰§è¡Œåˆ°ä»€ä¹ˆåœ°æ–¹ã€‚

> Qï¼šæ—¥å¿—å¦‚ä½•å­˜å‚¨å’Œåˆ†æžï¼Ÿç”¨ä»€ä¹ˆå·¥å…·ï¼Ÿç³»ç»Ÿå¼‚å¸¸å¦‚ä½•ç›‘æŽ§ï¼Ÿ

Aï¼šå…ˆè¯´è¯´å¼‚å¸¸å¦‚ä½•æ£€æµ‹å§ï¼Œæˆ‘ä»¬åšäº†ä¸€å¥— http ç›‘æŽ§æ¡†æž¶ï¼Œä»¥ä»»åŠ¡çš„å½¢å¼æ·»åŠ ï¼Œç„¶åŽä¼šå¯¹å·²é…ç½®çš„çº¿ä¸ŠçŽ¯å¢ƒã€å¤šå®¹å™¨è¿›è¡Œç›‘æŽ§ï¼Œæ¯”å¦‚ä»»åŠ¡ä¸º `http://xx.com/..../messages?token=>{token}`ï¼Œåœ¨é…ç½®ä»»åŠ¡æ‰§è¡Œæ—¶é—´åŠé¢‘çŽ‡ï¼Œç„¶åŽé…ç½®é¡¹ç›®åˆ—è¡¨ï¼Œå…¶ä¸­é¡¹ç›®ç¼–è¾‘çš„ä¿¡æ¯æœ‰ hostï¼Œå¯ç†è§£ä¸º `http://xx.com/` è¿™å—ï¼Œè¿˜æœ‰å˜é‡åˆ—è¡¨ï¼Œæ”¯æŒéšæ„å®šä¹‰ï¼Œæ¯”å¦‚ token 11111111 ç”¨æˆ· token ä¿¡æ¯ï¼Œè¿™ç§ kã€vã€è¯´æ˜Žæ–‡å­—ï¼Œæ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œè‡ªåŠ¨æ›¿æ¢ host å’Œå ä½ç¬¦ã€‚ç³»ç»Ÿåªè®°å½•å˜æ›´ï¼Œæˆ‘ä»¬é¡¹ç›®æŽ¥å£ç»Ÿä¸€äº†å‡ºå‚ï¼Œå½“çŠ¶æ€ç å¼‚å¸¸æ—¶æ˜¾ç¤ºï¼Œæ­¤æ–¹æ¡ˆå¯å®žçŽ°ç›‘æŽ§å„ç§å®¹å™¨ã€å„ç§æµ‹è¯•ã€ç”Ÿäº§çŽ¯å¢ƒã€‚

---

### 2017-11-15ï¼šKubernetes è°ƒåº¦è¯¦è§£

> Qï¼šæ™®é€šç”¨æˆ·æœ‰è‡ªå®šä¹‰ Pod ä¼˜å…ˆçº§çš„æƒé™å—ï¼Ÿ

Aï¼šå¯ä»¥ï¼ŒPod ä¼˜å…ˆçº§å®šä¹‰ä¸Žåˆ›å»ºæ™®é€š Pod ç±»ä¼¼ï¼Œå¹¶æ²¡æœ‰ç‰¹åˆ«æƒé™æŽ§åˆ¶ã€‚å®šä¹‰ Pod ä¼˜å…ˆçº§ï¼Œéœ€è¦å…ˆå®šä¹‰ kind ä¸º PriorityClass ç±»åž‹çš„èµ„æºå¯¹è±¡ï¼Œç„¶åŽé€šè¿‡åœ¨ Pod çš„ spec. priorityClassName ä¸­æŒ‡å®šå·²å®šä¹‰çš„ PriorityClass åç§°å³å¯ã€‚

> Qï¼šKubernetes scheduler extender èƒ½ä»‹ç»ä¸€ä¸‹ä¹ˆï¼Ÿ

Aï¼šextender å¯ç†è§£ä¸º Kubernetes è°ƒåº¦ç­–ç•¥å’Œç®—æ³•çš„æ‰©å±•ï¼Œå±žäºŽè‡ªå®šä¹‰è°ƒåº¦å™¨çš„ä¸€ç§æ–¹å¼ï¼Œä¸Ž Kubernetes é»˜è®¤è°ƒåº¦å™¨çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œä¸»è¦æ˜¯é’ˆå¯¹ä¸€äº›ä¸ç®—å—é›†ç¾¤æœ¬èº«æŽ§åˆ¶çš„èµ„æºï¼ˆæ¯”å¦‚ç½‘ç»œï¼‰ï¼Œéœ€è¦é€šè¿‡å¤–éƒ¨è°ƒç”¨æ¥è¿›è¡Œè°ƒåº¦çš„æƒ…å†µã€‚

> Qï¼šç”¨æˆ·ä½¿ç”¨äº† NodeSelector æŒ‡å®šäº† Pod è°ƒåº¦çš„ node èŠ‚ç‚¹åŽï¼Œå¦‚æžœ node ä¸å¯ç”¨ï¼Œé‚£ä¹ˆ scheduler ä¼šé‡‡ç”¨åˆ«çš„ç­–ç•¥å—ï¼Ÿ

Aï¼šnodeSelector æ˜¯ç›®å‰æœ€ä¸ºç®€å•çš„ä¸€ç§ pod è¿è¡Œæ—¶è°ƒåº¦é™åˆ¶ï¼Œç›®å‰åœ¨ Kubernetes 1.7.x åŠä»¥ä¸‹ç‰ˆæœ¬å¯ç”¨ã€‚Pod.spec.nodeSelector é€šè¿‡ kubernetes çš„ label-selector æœºåˆ¶é€‰æ‹©èŠ‚ç‚¹ï¼Œç”±è°ƒåº¦å™¨è°ƒåº¦ç­–ç•¥åŒ¹é… labelï¼Œè€ŒåŽè°ƒåº¦ Pod åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¯¥åŒ¹é…è§„åˆ™å±žäºŽå¼ºåˆ¶çº¦æŸï¼Œå¦‚æžœ node ä¸å¯ç”¨ï¼ŒPod ä¼šä¸€ç›´å¤„äºŽ pending çŠ¶æ€ã€‚nodeAffinity å…·å¤‡ nodeSelector çš„å…¨éƒ¨åŠŸèƒ½ï¼Œæ‰€ä»¥æœªæ¥ Kubernetes ä¼šå°† nodeSelector åºŸé™¤ã€‚

---

### 2017-11-08ï¼šKubernetes çš„å¤šé›†ç¾¤ç®¡ç†å®žè·µ

> Qï¼šNode æœºå™¨æŽ¨èå‘½åè§„åˆ™ä¸Žç”Ÿæˆä½¿ç”¨ç»éªŒï¼Ÿ

Aï¼šæŽ¨èä½¿ç”¨"åœ°ç†ä½ç½® + æœºæˆ¿ç¼–å· + æœºæŸœå· + åº”ç”¨åç§°"çš„ç¼©å†™å­—æ¯æ¥å‘½åï¼Œè¿™æ ·ä¾¿äºŽè¿ç»´äººå‘˜åŽç»­çš„ç®¡ç†å’Œç»´æŠ¤ã€‚

> Qï¼šä¸ºä»€ä¹ˆè¦ä¿®æ”¹ etcd ä¸Ž apiserver çš„ç›‘å¬ç«¯å£ï¼Ÿ

Aï¼šä¿®æ”¹ etcd ç›‘å¬ IP ä¸º 0.0.0.0 æ˜¯ä¸ºäº†é˜²æ­¢å‡ºçŽ°ç›‘å¬äº† lo ç½‘å¡çš„ 127.0.0.1 çš„ IPï¼Œå‡ºçŽ°ä¸èƒ½è¿žæŽ¥çš„æƒ…å†µã€‚apiserver åˆ™æ˜¯å¼€å¯ 8080 ç«¯å£ç”¨äºŽæŽ¥æ”¶ http è¯·æ±‚ï¼Œè¿™æ ·æ˜¯ä¸ºäº†æµ‹è¯•æ—¶æ–¹ä¾¿ä¸ç”¨ä½¿ç”¨ CA è¯ä¹¦è®¤è¯ã€‚

> Qï¼šè¯·é—® Docker æºæ€Žä¹ˆå¼„ï¼Œå›½å†…ä¸€èˆ¬ä¸å¥½è¿žæŽ¥ï¼Œä¸‹è½½ä¸äº†ï¼Ÿå¦å¤–è¿˜æœ‰ 1.6 è¦å‡çº§åˆ° 1.7 æ€Žä¹ˆåšï¼Ÿ

Aï¼šå»ºè®®ä½¿ç”¨ç§‘å­¦ä¸Šç½‘æ–¹å¼ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ”¹åŠ¨é…ç½®ã€‚1.6 å‡çº§åˆ° 1.7ï¼Œå…ˆåœæ­¢ Kubelet æœåŠ¡ï¼Œç„¶åŽä¸‹è½½ 1.7 ç‰ˆæœ¬çš„ kubernetes-server-linux-amd64.tar.gz åŒ…ï¼Œè§£åŽ‹æ›¿æ¢/usr/bin ç›®å½•ä¸‹çš„åŒåæ–‡ä»¶ï¼Œç„¶åŽå†æŠŠ Kubelet æœåŠ¡å¯åŠ¨ã€‚

> Qï¼šåœ¨è”é‚¦é›†ç¾¤ä¸­éƒ¨ç½²æœåŠ¡ï¼Œå¯ä»¥å°†æœåŠ¡åªéƒ¨ç½²åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ä¹ˆï¼Ÿ

Aï¼šå¯ä»¥åªéƒ¨ç½²æœåŠ¡åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œé€šè¿‡ç¼–æŽ’æ–‡ä»¶ä¸­ federation.kubernetes.io/replica-set-preference æ¥æŽ§åˆ¶å‰¯æœ¬åˆ†å¸ƒåœ¨å“ªä¸ªé›†ç¾¤ã€‚

> Qï¼šè”é‚¦é›†ç¾¤çš„å‡ ä¸ªç»„ä»¶çŽ°åœ¨æœ‰æ”¯æŒé«˜å¯ç”¨ä¹ˆï¼Ÿæ²¡æœ‰çš„è¯ï¼Œæˆ‘ä»¬åº”è¯¥æ€Žä¹ˆé¿å…è”é‚¦ç»„ä»¶çš„ bug å¯¼è‡´çš„æœåŠ¡ä¸å¯ç”¨ï¼Ÿ

A ï¼šè”é‚¦é›†ç¾¤çš„ Federation ç»„ç›®å½•æ²¡æœ‰æ”¯æŒé«˜å¯ç”¨ï¼Œä½†è”é‚¦åŠŸèƒ½ä¸»è¦æ˜¯ä¸ºäº†è°ƒåº¦ç®¡ç† Kubernetes é›†ç¾¤çš„ï¼Œæ‰€ä»¥è”é‚¦é›†ç¾¤ Federation ç»„ä»¶å‡ºçŽ°æ•…éšœæ—¶å¹¶ä¸ä¼šç›´æŽ¥å½±å“åˆ°ä¸‹é¢å„ä¸ªé›†ç¾¤è‡ªèº«çš„å·²ç»åœ¨è¿è¡Œçš„æœåŠ¡ã€‚

> Qï¼šæ ¹æ®åº”ç”¨åœ°ç†åŒºåŸŸéœ€æ±‚ï¼Œè°ƒåº¦å·¥ä½œè´Ÿè½½åˆ°ä¸åŒçš„ Kubernetes é›†ç¾¤ä¸­ï¼Œå¯¹äºŽä¸åŒçš„ç»ˆç«¯ç”¨æˆ·ï¼Œæä¾›æ›´é«˜çš„å¸¦å®½å’Œæ›´ä½Žçš„å»¶è¿Ÿ.è¿™ä¸ªè°ƒåº¦åˆ°ä¸åŒçš„é›†ç¾¤ï¼Œæ˜¯ Kubernetes æ ¹æ®åœ°ç†ä½ç½®è°ƒåº¦å—ï¼Ÿæ˜¯ Kubernetes è‡ªå·±è°ƒåº¦å—ï¼Ÿ

Aï¼šå·¥ä½œè´Ÿè½½ Kubernetes å¯ä»¥è‡ªå·±è°ƒåº¦åˆ°æ¯”è¾ƒç©ºé—²çš„é›†ç¾¤ä¸Šï¼Œåœ°ç†ä½ç½®è°ƒåº¦è¿™ä¸ªéœ€è¦é€šè¿‡ç¼–æŽ’æ–‡ä»¶æŽ§åˆ¶åº”ç”¨çš„å®¹å™¨åˆ†é…åˆ°æ›´åˆé€‚çš„åŒºåŸŸæœºæˆ¿ã€‚

> Qï¼šæ˜¯å…ˆå»ºç«‹ 3 ä¸ª Kubernetes é›†ç¾¤ï¼Œç„¶åŽåœ¨ 1 ä¸ªé›†ç¾¤çš„ master ä¸Š kubefed init fellowship æ˜¯å—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œåœ¨å…¶ä¸­ 1 ä¸ªé›†ç¾¤çš„ master ä¸Šå®‰è£… Federation ç»„ä»¶ï¼Œç„¶åŽæŠŠ 3 ä¸ª Kubernetes é›†ç¾¤åŠ è¿›æ¥ç®¡ç†ã€‚

> Qï¼šæ·»åŠ è”é‚¦é›†ç¾¤æ–‡ä»¶æ—¶ï¼Œé‡Œé¢çš„ serverAddress æ˜¯ä»€ä¹ˆåœ°å€ï¼Ÿ

Aï¼šserverAddress å°±æ˜¯ Kubernetes é›†ç¾¤çš„ API server çš„ IP å’Œç«¯å£ï¼Œc1.yaml é‡Œé¢çš„ serverAddress å°±æ˜¯é›†ç¾¤ 01 çš„ API server çš„ IP å’Œç«¯å£ï¼Œc2.yaml é‡Œé¢çš„ serverAddress å°±æ˜¯é›†ç¾¤ 02 çš„ API server çš„ IP å’Œç«¯å£ã€‚

---

### 2017-10-31ï¼šç“œå­äº‘çš„ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ

> Qï¼šè¯·é—®ä¸‹è‡ªåŠ¨è§¦å‘ med-sdk æž„å»º Docker é•œåƒï¼Œmed-sdk æ˜¯ä»€ä¹ˆå¼€æºé¡¹ç›®ï¼Œèƒ½ä»‹ç»ä¸‹ä¹ˆï¼Ÿ

Aï¼šmed-sdk æ˜¯ç“œå­è‡ªè¡Œå¼€å‘çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºŽæŠŠä»£ç æ‰“æˆ Docker é•œåƒåŒ…ã€‚æ¯ä¸ª Git é‡Œé¢åªéœ€è¦æ·»åŠ ä¸€ä¸ª med.yml å°±å¯ä»¥å®žçŽ°ã€‚

> Qï¼šè¯·é—®ä¸ºä»€ä¹ˆè¦é›†æˆ Kubernetesï¼Ÿ

Aï¼šAirflow çš„ Worker éœ€è¦æ‰‹åŠ¨æ­å»ºï¼Œå¯æ‰©å±•æ€§ä¸å¥½ï¼›Job ä»£ç æ›´æ–°ä¹‹åŽï¼Œéœ€è¦æ‰‹åŠ¨éƒ¨ç½²åˆ° Worker ä¸Šï¼Œéžå¸¸ç¹çï¼›Airflow Worker çš„çŽ¯å¢ƒå¤ªå¤šï¼Œç”±å„ä¸ªå›¢é˜Ÿè‡ªè¡Œç»´æŠ¤ï¼Œç»´æŠ¤æˆæœ¬å¤ªé«˜ï¼›äº‘å¹³å°æ­å»ºä¹‹åŽï¼Œæ‰€æœ‰æœºå™¨éƒ½ä¼šè¢«å›žæ”¶ï¼Œå„ä¸šåŠ¡çº¿æ‹¥æœ‰çš„æœºå™¨å°†ä¼šå¾ˆå°‘ï¼ŒWorker å°†ä¼šæ²¡æœ‰åœ°æ–¹éƒ¨ç½²ã€‚

> Qï¼šAirflow å¤„ç†çš„è°ƒåº¦é‡æ˜¯ä»€ä¹ˆè§„æ¨¡ï¼Œä¹Ÿå°±æ˜¯æ‰¹é‡ä»»åŠ¡ä¼šä¸ä¼šé˜»å¡žï¼Œä¸€æ¬¡å¹¶å‘æœ‰å¤šå°‘ Podï¼Œå¤šå°‘å®¹å™¨å®žä¾‹ï¼Œä¸€å¥— Kubernetes Master èƒ½å¦æ‰›å¾—ä½ï¼Œæ–¹ä¾¿ç»™ä¸ªæ•°æ®é‡è¿›è¡Œå‚è€ƒå—ï¼Ÿ

Aï¼šç›®å‰ç“œå­æ¯å¤©æœ‰ 2000 ä¸ªä»»åŠ¡ã€‚ä»»åŠ¡çš„æ‰§è¡Œåœ°ç‚¹éƒ½æ˜¯åœ¨ Kubernetes ä¸Šçš„ï¼Œä¸ä¼šé˜»å¡žã€‚å¹¶å‘çš„ Pod ä¸ªæ•°æ˜¯ç”±åŒæ—¶å¤„ç†çš„ Job æ•°å®šçš„ï¼ŒAirflow çš„ Worker æœ‰è®¾ç½®ä¸€ä¸ª Worker å¯ä»¥åŒæ—¶è·‘å‡ ä¸ª Jobã€‚æˆ‘ä»¬å¹¶å‘ Pod æœ‰ 20 ä¸ªã€‚ä¸€å¥— Kubernetes å¯ä»¥æŠ—ä½æˆ‘ä»¬çš„è§„æ¨¡ã€‚æ•°æ®é‡ä¸å¥½ç»™ï¼Œå› ä¸ºä»»åŠ¡çš„è®¡ç®—é‡ä¸å¥½ä¼°ç®—ï¼Œæœ‰çš„å¤§æœ‰çš„å°ã€‚

> Qï¼šä¸ºä»€ä¹ˆä¸è€ƒè™‘ Celery ä¹‹ç±»çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Ÿ

Aï¼šé¦–å…ˆæ˜¯æˆ‘ä»¬ä¹‹å‰é€‰ç”¨çš„æ˜¯ Airflowï¼Œç”¨ Python å†™çš„ DAGï¼Œéžå¸¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬çš„ DAG éœ€æ±‚å¾ˆå¤§ï¼Œæ¯”å¦‚æ•°æ®ä»“åº“ï¼Œæ‰€ä»¥é€‰æ‹©äº† Airflowã€‚

> Q: æœ‰åšè¿‡ç±»ä¼¼è½¯ä»¶çš„å¯¹æ¯”ä¹ˆï¼Œå·®å¼‚åœ¨å“ªï¼Ÿ

Aï¼šKubernetes ç›®å‰è¢« Docker å®˜æ–¹æ”¯æŒã€‚Mesos ç”¨ C å†™çš„ï¼Œä¸å¥½è¿ç»´ã€‚Rancher ç¤¾åŒºä¸å¤Ÿå¤§ã€‚å…¶å®žåŠŸèƒ½å¤§å®¶éƒ½æ”¯æŒï¼Œä¸»è¦æ˜¯ç¤¾åŒºã€‚

> Qï¼šå¹¶å‘çš„å®¹å™¨æ•°é‡æ˜¯å¤šå°‘ï¼Œå®žé™…çš„ Docker å®žä¾‹ä¸ªæ•°é‡çº§ï¼Œ20 ä¸ª Pod å¯å¤§å¯å°ã€‚æ–¹ä¾¿ç»™ä¸ªå‚è€ƒå—ï¼Ÿè°¢è°¢ï¼

Aï¼šæˆ‘ä»¬æµ‹è¿‡æ¯å°æœºçš„ä¸Šé™åœ¨ 100 ä¸ªï¼Œæˆ‘ä»¬çš„æœºå™¨æ˜¯ 128Gï¼Œ24coresã€‚æˆ‘ä»¬ Airflow çš„ Worker æœ‰ 20 ä¸ª Podã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 10 æœˆ 31 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚

---

### 2017-10-10ï¼šä¹é«˜å¼å¾®æœåŠ¡åŒ–æ”¹é€ 

> Qï¼šé…ç½®ä¸­å¿ƒä½¿ç”¨ Consul çš„é…ç½®å…±äº«ï¼Œæœ‰æ²¡æœ‰è€ƒè™‘è¿‡ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„é…ç½®ä¸­å¿ƒé‡Œé¢é™¤äº†é”®å€¼å¯¹å½¢å¼çš„é…ç½®é¡¹ï¼Œæ›´å¤šçš„æ˜¯å­˜å‚¨äº†æ–‡ä»¶å½¢å¼çš„é…ç½®æ–‡ä»¶ï¼Œè€Œ Consul ä¸€èˆ¬å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹ä¿¡æ¯ã€‚å¦å¤–ï¼Œé™¤äº†å­˜å‚¨ã€è¯»å–é…ç½®çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›ä¸Šå±‚çš„èƒ½åŠ›ï¼Œæ¯”å¦‚çŽ¯å¢ƒéš”ç¦»ã€ç‰ˆæœ¬åŒ¹é…ã€ç‰ˆæœ¬ç®¡ç†ç­‰ï¼Œè¿™äº› Consul ä¹Ÿæ— æ³•ç›´æŽ¥æä¾›ã€‚

> Qï¼šä»Šå¤©è®²çš„è¿™äº› Spring Cloudã€Spring Bootã€é…ç½®ä¸­å¿ƒã€æŽˆæƒä¸­å¿ƒç­‰ç­‰ï¼Œæœ‰æ²¡æœ‰å¥½çš„å…¥é—¨ä¹¦ç±æŽ¨èä¸‹ï¼Ÿ

Aï¼šå¯ä»¥å…³æ³¨ä¸€ä¸‹æˆ‘çš„åšå®¢ï¼Œé‡Œé¢æä¾›äº†å¾ˆå¤šå‚è€ƒèµ„æºã€‚[emacoo.cn](http://emacoo.cn/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1)

> Qï¼šæœåŠ¡è¾¹ç•Œçš„åˆ’åˆ†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®ï¼Ÿ

Aï¼šè¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè§ä»è§æ™ºçš„é—®é¢˜ã€‚æŒ‰ç…§æˆ‘ç›®å‰çš„ç†è§£ï¼Œè¾¹ç•Œè‡³å°‘æ„å‘³ç€ï¼š1. å•æ•°æ®åº“ï¼Œä¿è¯æ•°æ®ç‹¬äº«ï¼›2. å„ä¸ªæœåŠ¡å±‚æ¬¡æ¸…æ™°ï¼Œæ— å¾ªçŽ¯ä¾èµ–ã€‚å¦å¤–ï¼Œå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œéšç€ä¸šåŠ¡å¤æ‚åº¦çš„ä¸Šå‡ï¼Œä¸€ä¸ªå¾®æœåŠ¡å¯èƒ½ä¼šéœ€è¦è¿›ä¸€æ­¥æ‹†åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´è¾¹ç•Œæ˜¯è·Ÿå¤æ‚åº¦æŒ‚é’©çš„ã€‚

> Qï¼šå¾®æœåŠ¡å¤šå¤§ç¨‹åº¦åº”è¯¥ç‹¬äº«æ•°æ®åº“è¿˜æ˜¯å…±äº«æ•°æ®åº“èµ„æºï¼Ÿ

Aï¼šå»ºè®®ç‹¬äº«æ•°æ®åº“ï¼Œæ•°æ®é€šè¿‡æŽ¥å£æš´éœ²ç»™å…¶ä»–æœåŠ¡ã€‚

> Qï¼šè¯·é—®ä¸‹å¦‚æžœæœ‰ä¸€ä¸ª Spring Boot æœåŠ¡æŒ‚äº†ï¼Œèƒ½è‡ªåŠ¨å‘çŽ°ç„¶åŽé‡å¯ä¹ˆï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ¡ˆæŽ¨èï¼Ÿ

Aï¼šè¦å®žçŽ°è¿™ä¸€ç‚¹æœ‰å¾ˆå¤šæ–¹æ¡ˆã€‚æˆ‘ä»¬æ‰€æœ‰çš„æœåŠ¡éƒ½æ˜¯è·‘åœ¨å®¹å™¨é‡Œé¢ï¼Œå€ŸåŠ© Marathon çš„æµ‹æ´»æœºåˆ¶å®žçŽ°äº†æœåŠ¡æ„å¤–å®•æœºåŽçš„è‡ªåŠ¨æ¢å¤ã€‚å¦‚æžœæ˜¯éžå®¹å™¨çŽ¯å¢ƒï¼Œå¯ä»¥é€šè¿‡ç›‘æŽ§å¹³å°ï¼ˆæ¯”å¦‚ Zabbixã€Open-Falconï¼‰å®žæ—¶ç›‘æŽ§æœåŠ¡å¹¶å°è¯•æ¢å¤ã€‚

> Qï¼šçœ‹è´µå…¬å¸çš„æž¶æž„ï¼Œå¾®æœåŠ¡æ˜¯åšäº†å®¹å™¨åŒ–éƒ¨ç½²çš„ï¼Œå¾®æœåŠ¡å®¹å™¨åŒ–ä¹‹åŽé‡‡å–ä»€ä¹ˆæ ·çš„ç½‘ç»œæ–¹å¼æš´éœ²æœåŠ¡ï¼Ÿ

Aï¼šæ²¡é”™ï¼Œæˆ‘ä»¬æ‰€æœ‰å¾®æœåŠ¡éƒ½æ˜¯è·‘åœ¨å®¹å™¨é‡Œé¢çš„ã€‚æµ‹è¯•çŽ¯å¢ƒé€šè¿‡ Marathon LB æš´éœ²æœåŠ¡ï¼Œç”Ÿäº§çŽ¯å¢ƒé€šè¿‡ Consul Registrator è‡ªåŠ¨å‘çŽ°æœåŠ¡ï¼Œç„¶åŽç”± Consul Template å®šæ—¶åˆ·æ–° LB é…ç½®ï¼ŒLB å‰é¢è¿˜æœ‰ä¸€å±‚å†…ç½‘ DNSï¼Œæœ€ç»ˆæœåŠ¡è°ƒç”¨æ–¹é€šè¿‡å†…ç½‘åŸŸåè®¿é—®æœåŠ¡ã€‚

> Qï¼šé›†æˆ Nginx å®žçŽ°è´Ÿè½½å‡è¡¡è¿™ä¸ªæ˜¯æ€Žä¹ˆèƒ½å®žçŽ°çš„ï¼Œèƒ½è®²ä¸€ä¸‹å—ï¼Ÿ

Aï¼šéžå¸¸ç®€å•ï¼Œåˆ©ç”¨ Nginx è‡ªå¸¦çš„ upstream ç‰¹æ€§ï¼Œç›¸å½“äºŽä¸€ä¸ªè™šæ‹Ÿä¸»æœºæŒ‚å¤šä¸ªæœåŠ¡åœ°å€ã€‚

> Qï¼šå¯¹ä¸€ä¸ªç³»ç»Ÿåšå¾®æœåŠ¡æ”¹é€ æ—¶ï¼Œä»€ä¹ˆæ ·çš„åŠŸèƒ½æˆ–è€…åº”ç”¨ä¸é€‚åˆé‡‡ç”¨å¾®æœåŠ¡æ¨¡å¼ï¼Œè€Œæ˜¯åº”è¯¥ä¿ç•™å•ä½“åº”ç”¨æž¶æž„ï¼Ÿ

Aï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œå…³é”®çœ‹ä¸¤ç‚¹ï¼Œç¬¬ä¸€ï¼Œä¸šåŠ¡å¤æ‚åº¦ä»¥åŠå›¢é˜Ÿå¯¹é¢†åŸŸæ¨¡åž‹çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼›ç¬¬äºŒï¼Œå›¢é˜ŸæŠ€æœ¯å®žåŠ›ï¼Œå°¤å…¶æ˜¯ DevOps æ°´å¹³ï¼Œçœ‹èƒ½ä¸èƒ½ Hold ä½å¾®æœåŠ¡æœ¬èº«æ‰€éœ€çš„æŠ€æœ¯æ¡†æž¶ï¼Œä»¥åŠæ”¯æ’‘å¾®æœåŠ¡çš„å„ç±»ä¸­é—´ä»¶ã€è¿ç»´å¹³å°ã€‚

> Qï¼šè´µå…¬å¸åœ¨è¿›è¡Œå¾®æœåŠ¡æ”¹é€ çš„æ—¶å€™ï¼Œåº”è¯¥å¾ˆéš¾ä¸€ä¸‹å­å…¨éƒ¨æ”¹é€ æˆå¾®æœåŠ¡åŒæ—¶ä¸Šçº¿ï¼Œæ”¹é€ åº”ç”¨çš„é¡ºåºæ˜¯æ¨ªå‘è¿˜æ˜¯çºµå‘çš„ï¼Ÿ

Aï¼šå¯¹ï¼Œæˆ‘ä»¬é‡‡å–çš„æ˜¯æ”¹è‰¯å¼è·¯çº¿ï¼ŒåŸºæœ¬çš„æ€è·¯æ˜¯ï¼Œé¦–å…ˆé€šè¿‡é‡æž„å°†åŽŸæœ¬å•ä½“åº”ç”¨ä¸­çš„æŸä¸ªæ¨¡å—çš„è¾¹ç•Œè¿›è¡Œçºµå‘åˆ’åˆ†ï¼Œç„¶åŽæ–°å»ºæ•°æ®åº“ã€è¿ç§»è€æ•°æ®ã€åŒå†™æ–°è€æ•°æ®åº“ï¼Œæœ€åŽç­‰æ–°æœåŠ¡å¼€å‘å®Œä¸Šçº¿ä¹‹åŽï¼Œå†å°†åŽŸæœ¬åŒä¸€åº”ç”¨é‡Œçš„ä»£ç è°ƒç”¨åˆ‡æ¢ä¸ºå¤–éƒ¨æœåŠ¡è°ƒç”¨ã€‚

---

### 2017-09-26ï¼šBizCloudï¼šåŸºäºŽ Kubernetes çš„ç§æœ‰äº‘å®žè·µ

> Qï¼šæœ‰çŠ¶æ€æœåŠ¡å’Œæ— çŠ¶æ€æœåŠ¡çš„ä¸»è¦åŒºåˆ«æ˜¯å“ªäº›ï¼Ÿ

Aï¼šæœ‰çŠ¶æ€æœåŠ¡ï¼Œæ˜¯æŒ‡æœåŠ¡å™¨ç«¯å…·å¤‡ä¸Šä¸‹æ–‡å…³ç³»ï¼Œå¦‚ Redis æœåŠ¡ï¼Œå½“æœåŠ¡æŒ‚æŽ‰ä¹‹åŽï¼ŒRedis çš„å†…å­˜æ•°æ®ä¸¢å¤±ï¼Œæˆ‘ä»¬ä¸èƒ½ç®€å•åœ°åœ¨å¦ä¸€ä¸ªæœºå™¨ä¸Šæ‹‰èµ·æœåŠ¡æ¥æ¢å¤æœåŠ¡ï¼Œå¿…é¡»åŒæ—¶æ¢å¤æ•°æ®ï¼ˆçŠ¶æ€ï¼‰ï¼Œè€Œæ— çŠ¶æ€æœåŠ¡æ²¡æœ‰çŠ¶æ€ï¼ˆæ•°æ®ï¼‰ä¾èµ–ã€‚

> Qï¼šé€šè¿‡æ¨¡æ¿çš„æ–¹å¼ï¼Œä¼šä¸ä¼šå½±å“çµæ´»æ€§å•Šï¼Ÿå› ä¸ºå¤§å¤šæ•°é…ç½®éƒ½æ˜¯åŸºæœ¬å›ºå®šçš„ã€‚

Aï¼šè¿™ä¸ªä¼šç‰ºç‰²ä¸€å®šçš„çµæ´»æ€§ï¼Œä½†æ˜¯ä¼šæå‡å‘å¸ƒçš„å®‰å…¨æ€§ï¼Œå¹¶ä¸”è¾¾åˆ°å¯¹ä¸Šå±‚åº”ç”¨æ— æ„ŸçŸ¥ã€‚ç›®å‰æˆ‘ä»¬ä¹Ÿä¼šé’ˆå¯¹ä¸åŒçš„åº”ç”¨ç±»åž‹å®šåˆ¶ä¸åŒçš„æ¨¡æ¿ï¼Œå¦‚æ— çŠ¶æ€æœåŠ¡ã€æœ‰çŠ¶æ€æœåŠ¡çš„æ¨¡æ¿æ˜¯ä¸ä¸€æ ·çš„ã€‚é€šè¿‡æ¨¡æ¿å¯ä»¥æ»¡è¶³æ”¯æŒç»å¤§å¤šæ•°æœåŠ¡éœ€æ±‚ï¼Œå¯¹äºŽç‰¹å®šæœåŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿé¢„ç•™äº†ç‰¹æ®Šé…ç½®æŽ¥å£ã€‚åŽç»­æˆ‘ä»¬ä¹Ÿä¼šå°è¯•å¼•å…¥ Helm Chart å•å…ƒåŒ–æ¨¡æ¿ã€‚

> Qï¼ševent å­˜åœ¨ä¸¢å¤±çš„çŽ°è±¡ï¼Œè¯·é—®å¦‚ä½•å¤„ç†ï¼Ÿæˆ‘è§‰å¾—è¿‡åº¦ä¾é  event ä¼šé€ æˆå¾ˆç´§çš„å¶åˆã€‚

Aï¼šæˆ‘ä»¬ watch event çš„æ—¶å€™ä½¿ç”¨äº† ResourceVersionï¼Œä¸ä¼šå‡ºçŽ°ä¸¢äº‹ä»¶çš„æƒ…å†µï¼Œå¦‚æžœ watch æç¤º ResourceVersion è¿‡æ—©ï¼Œæˆ‘ä»¬ä¼šå…ˆ List Podï¼Œå’ŒæœåŠ¡ç®¡ç†æ¨¡å—åšä¸€æ¬¡åŒæ­¥ï¼Œæ¸…ç†è„æ•°æ®ã€‚ å‡ºçŽ°è¿‡æ”¶åˆ°ä¸å®Œæ•´ event çš„æƒ…å†µï¼Œå› ä¸ºæœ€åˆç»™ Kubernetes åŠ ä¸Š Nginx ä»£ç†æ—¶ï¼ŒNginx é»˜è®¤å¼€å¯äº† proxy_bufferingï¼Œä¼šæ”¶åˆ°ä¸å®Œæ•´äº‹ä»¶æƒ…å†µï¼Œå…³é—­ proxy_buffering è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

> Qï¼šè¯·é—® k8s-monitor æ˜¯é€šè¿‡ Kubernetes çš„å“ªä¸ª API ç›‘æŽ§åˆ° Pods çš„çŠ¶æ€äº‹ä»¶ ADDã€MODIFYã€DELETEï¼Ÿ

Aï¼š[kubernetes/client-go](https://github.com/kubernetes/client-go) çš„ watch APIã€‚

> Qï¼šèƒ½å¦è®²ä¸‹"Nginx ä¼šå®žæ—¶ä»ŽæœåŠ¡ç®¡ç†ä¸­å¿ƒèŽ·å–æœåŠ¡å¯¹åº”å…³ç³»"çš„åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šæˆ‘ä»¬åœ¨ OpenResty åŸºç¡€ä¸Šï¼Œé€šè¿‡ Lua è„šæœ¬ä»Ž\"æœåŠ¡ç®¡ç†ä¸­å¿ƒ\"å¤„æŸ¥è¯¢å’Œè®¢é˜…æœåŠ¡å¯¹åº”å…³ç³»ï¼Œå®žæ—¶ä¿®æ”¹ Nginx é…ç½®ï¼Œè¿›è¡Œè´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘çŽ°ã€‚

> Qï¼šè¯·é—®ä½ ä»¬ Docker æ˜¯å®‰è£…åœ¨ç‰©ç†æœºè¿˜æ˜¯ï¼Ÿ

Aï¼šDocker æ˜¯å®‰è£…åœ¨ç‰©ç†æœºä¸Šï¼Œè€Œä¸” Docker å®‰è£…å¯åŠ¨æ˜¯éœ€è¦ root æƒé™çš„ã€‚

> Qï¼šç½‘ç»œé—®é¢˜æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿæ²¡æœ‰ä½¿ç”¨è‡ªå¸¦çš„ service å—ï¼Ÿ

Aï¼šç½‘ç»œé—®é¢˜æ˜¯æŒ‡æˆ‘ä»¬çš„ç½‘ç»œæ¨¡å¼ä¹ˆï¼Ÿæˆ‘ä»¬çš„å®¹å™¨åˆ†é…çš„æ˜¯ä¸€ä¸ªå†…ç½‘ IPï¼Œå¯¹å¤–éƒ¨æœåŠ¡æ˜¯å¯è§çš„ï¼Œå¦‚æžœå‘ç”Ÿäº†èŠ‚ç‚¹ç½‘ç»œé—®é¢˜ï¼Œåœ¨æœåŠ¡åŒ–è¿™å±‚æœ¬èº«ä¼šè‡ªåŠ¨æ‘˜é™¤è¿™ä¸ªèŠ‚ç‚¹ï¼Œåœ¨è°ƒåº¦å±‚é¢ä¸€å®šè¶…æ—¶åŽä¹Ÿä¼šè‡ªåŠ¨é‡æ–°è°ƒåº¦åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚æˆ‘ä»¬æ²¡æœ‰é‡‡ç”¨ Kubernetes çš„ serviceï¼ŒåŽŸå› æ˜¯å› ä¸ºåœ¨æ—©æœŸ Kubernetes çš„è°ƒç ”ä¸­ï¼Œservice å­˜åœ¨ iptables æ¡æ•°è¿‡å¤šå¯¼è‡´æ€§èƒ½ä¸‹é™é—®é¢˜ï¼Œä¹Ÿæ‹…å¿ƒ service ä¸ç¨³å®šé€ æˆæœåŠ¡è®¿é—®é—®é¢˜ã€‚

> Qï¼šè¯·é—®ä¸‹ä½ ä»¬æœåŠ¡åŠ¨æ€æ‰©å®¹æ˜¯å…¨è‡ªåŠ¨åŒ–çš„ä¹ˆï¼Ÿ

Aï¼šç›®å‰æœåŠ¡åŠ¨æ€æ‰©å®¹æ˜¯ä¸€é”®åŒ–çš„ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿé¢„ç•™äº†ä¸€äº› APIï¼Œæ¥å®žçŽ°å…¨è‡ªåŠ¨åŒ–ï¼Œå¤§è‡´çš„æ–¹æ¡ˆæ˜¯ï¼šäº‘å¹³å°ä¼šå¯¹æŽ¥ä¸€ä¸ªç»Ÿä¸€ç›‘æŽ§ä¸­å¿ƒï¼Œé€šè¿‡ç»Ÿä¸€ç›‘æŽ§ä¸­å¿ƒçš„å®žæ—¶ç›‘æŽ§æ•°æ®ï¼ˆç³»ç»Ÿæ•°æ®ï¼Œæµé‡æ•°æ®ï¼‰ï¼Œåˆ†æžæœåŠ¡çš„è®¿é—®åŽ‹åŠ›ï¼Œæ¥å®žæ—¶æ‰©ç¼©å®¹ã€‚

> Qï¼šé—®ä¸‹ä½ ä»¬ç¨‹åºåŒ…åˆ†å‘å¦‚ä½•å®žçŽ°çš„ï¼Œç¨‹åºåŒ…æ”¾é•œåƒå†…è¿˜æ˜¯é•œåƒå¤–ï¼Ÿ

Aï¼šæˆ‘ä»¬å¼€å‘äº†è‡ªå·±çš„ CI æ¨¡å—ï¼Œå¯ä»¥ä¸€é”®ä»Ž SVN ä¸­ç”Ÿç¨‹åºåŒ…ï¼Œç„¶åŽæˆé•œåƒï¼Œç¼–è¯‘ç”Ÿæˆé•œåƒçš„æ—¶å€™ä¼šä»Žç»Ÿä¸€æœåŠ¡ç®¡ç†æ¨¡å—ä¸­èŽ·å–å¿…è¦çš„æœåŠ¡ä¿¡æ¯ã€‚ç¨‹åºåŒ…æ”¾åœ¨é•œåƒå†…ã€‚

> Qï¼šè¯·é—®ä½ ä»¬ Docker æ˜¯åŸºäºŽ CentOS åˆ¶ä½œçš„é•œåƒå—ï¼Ÿæœ‰ä»€ä¹ˆä¼˜åŒ–åœ°æ–¹ï¼Ÿ

Aï¼šæ˜¯åŸºäºŽ CentOS 7.2 åˆ¶ä½œçš„é•œåƒï¼Œæˆ‘ä»¬åœ¨é•œåƒä¸­åšäº†ä¸€äº›ä¸¥æ ¼çš„æƒé™æŽ§åˆ¶ï¼Œé™åˆ¶äº†åº”ç”¨çš„ä¸€äº›è¡Œä¸ºã€‚

> Qï¼šWebShell çš„è¯ï¼Œæ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ Agent çš„å§ï¼Œè¿˜æ˜¯é€šè¿‡ Kubernetes åŽŸç”Ÿæä¾›çš„åŠŸèƒ½å‘¢ï¼Ÿ

Aï¼šä¸éœ€è¦æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ Agentï¼Œæˆ‘ä»¬åªè¦å®žçŽ° Docker Controller å³å¯ï¼ŒDocker Controller ä¼šåŽ» Docker Daemon ä¸ŠèŽ·å–å®¹å™¨çš„å…·ä½“ä¿¡æ¯ã€‚

> Qï¼šä½ ä»¬æ•°æ®åº“é›†ç¾¤æ˜¯ç”¨çš„å“ªç§æ–¹æ¡ˆå‘¢ï¼Œèƒ½ä»‹ç»ä¸‹å—ï¼Ÿ

Aï¼šæ— çŠ¶æ€æœåŠ¡çš„è¯ï¼Œå°±æ˜¯ä½¿ç”¨ hostPath æœ¬åœ°æŒ‚è½½ï¼Œæ—¥å¿—æ•°æ®æˆ‘ä»¬ä¼šæœ‰å®žæ—¶é‡‡é›†çš„æœåŠ¡ã€‚æœ‰çŠ¶æ€æœåŠ¡å¦‚æ•°æ®åº“ï¼Œæˆ‘ä»¬ç›®å‰è¿˜æ²¡æœ‰åœ¨ç”Ÿäº§çŽ¯å¢ƒè¿›è¡Œå¤§è§„æ¨¡çš„æ•°æ®åº“å®¹å™¨åŒ–ã€‚æˆ‘ä»¬çš„åŸºæœ¬æ€è·¯æ˜¯å®šåˆ¶åŒ– CRD + Ceph åˆ†å¸ƒå¼å­˜å‚¨ã€‚ä¹Ÿå¸Œæœ›åŽé¢éšç€æ•°æ®åº“å®¹å™¨åŒ–å·¥ä½œä¸æ–­æŽ¨è¿›ï¼Œèƒ½å¤Ÿå’Œå¤§å®¶æœ‰æ›´æ·±å…¥çš„äº¤æµã€‚

---

### 2017-09-23ï¼šFreeWheel åŸºäºŽ Kubernetes å®¹å™¨äº‘æž„å»ºä¸Žå®žè·µï¼šåº”ç”¨ç¼–æŽ’ä¸ŽæœåŠ¡è´¨é‡ä¿è¯

> Qï¼šè¿™ä¸ªä¸œè¥¿çš„æœ¬è´¨ï¼Œæ˜¯ä¸æ˜¯ç±»ä¼¼æŠŠ kubectl çš„é‚£ä¸€å¥—æŒ‡ä»¤åšäº†å°è£…å‘¢ï¼Œä½¿æ“ä½œç®€åŒ–ï¼Ÿ

Aï¼šä¸æ˜¯çš„ï¼ŒHelm çš„å®šä½æ˜¯ Kubernetes åº”ç”¨çš„åŒ…ç®¡ç†å·¥å…·ï¼Œæ˜¯å¯¹ Kubernetes çš„è¡¥å……è€Œä¸æ˜¯ä»£æ›¿ã€‚Helm å¯¹ Release æä¾›äº†éžå¸¸å¼ºå¤§çš„ç‰ˆæœ¬ç®¡ç†ã€é…ç½®ä»¥åŠ Hook ç­‰åŠŸèƒ½ï¼Œè¿™äº›éƒ½æ˜¯åŽŸç”Ÿ Kubernetes ä¸å…·å¤‡çš„ã€‚

> Qï¼šHelm æ˜¯ä¸€ä¸ª cli client å¯¹å§ï¼Ÿtiller æœ‰æ²¡æœ‰ API å¯ä»¥è°ƒç”¨ï¼Ÿ

Aï¼šæ˜¯çš„ã€‚tiller ç›®å‰æš‚æ—¶ä¸æä¾› API è°ƒç”¨ï¼Œä»¥ Pod å½¢å¼å®‰è£…çš„ Tiller serviceï¼Œé‡‡ç”¨çš„æ˜¯ clusterIPï¼Œç„¶åŽ helm client ä½¿ç”¨ kubectl proxy è¿žæŽ¥ã€‚

> Qï¼šè¯·é—®ç”Ÿäº§çŽ¯å¢ƒè´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘çŽ°æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆï¼Ÿ

Aï¼šå¯¹äºŽç”Ÿäº§çŽ¯å¢ƒè´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥é‡‡ç”¨ HAProxy/Nginx ç­‰è´Ÿè½½å‡è¡¡å™¨ä»£æ›¿ kube-proxy ä»¥æ±‚æ›´å¥½çš„è½¬å‘æ€§èƒ½ã€‚ å¯¹äºŽ Kubernetes æœåŠ¡å‘çŽ°ï¼šæœ‰ 2 ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯çŽ¯å¢ƒå˜é‡ï¼Œç¬¬äºŒç§ Kubernetes DNSã€‚æŽ¨èç”¨ Kubernetes DNSï¼Œå› ä¸ºçŽ¯å¢ƒå˜é‡æ–¹å¼å¯¹ Pod å¯åŠ¨é¡ºåºæœ‰éžå¸¸å¼ºçš„ä¾èµ–ï¼Œå³å…ˆå¯åŠ¨çš„ Pod çœ‹ä¸åˆ°åœ¨å…¶ä¹‹åŽå¯åŠ¨ Pod æœåŠ¡çš„çŽ¯å¢ƒæ³¨å…¥ä¿¡æ¯ã€‚

> Qï¼šKubernetes çš„ä¸‰ç§å¥åº·æ£€æŸ¥ç±»åž‹ execï¼Œtcpï¼Œhttp èƒ½åœ¨ä¸€ä¸ªå®¹å™¨ä¸­åŒæ—¶ä½¿ç”¨å—ï¼Ÿå®ƒä»¬åˆ†åˆ«çš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šå¯ä»¥çš„ï¼ŒKubernetes å¹¶æ²¡æœ‰å¯¹æ­¤é™åˆ¶ã€‚ä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå®¹å™¨æœåŠ¡ä¸ä¼šåŒæ—¶æä¾› TCP å’Œ HTTP æœåŠ¡ã€‚ HTTPGetActionï¼šé€‚ç”¨äºŽ HTTP æœåŠ¡çš„å¥åº·æ£€æŸ¥ï¼Œä½†ä½¿ç”¨å‰ææ˜¯æœåŠ¡æœ¬èº«éœ€è¦æä¾›å¥åº·æ£€æŸ¥è·¯å¾„ã€‚

> Qï¼šä½¿ç”¨ Helm æ˜¯å¦å¯ä»¥ä¸ç”¨ kubectl äº†ï¼Ÿå¦å¤–æ˜¯å¦æ”¯æŒ Windowsï¼Œæ”¯æŒçš„è¯å¦‚ä½•é…ç½®å‘¢ï¼Ÿ

Aï¼šä¸æ˜¯çš„ã€‚Helm æ˜¯ Kubernetes åº”ç”¨çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå¯¹ Kubernetes æ¥è¯´ï¼ŒHelm æ˜¯å¯¹å…¶ Release ç‰ˆæœ¬ç®¡ç†ã€é…ç½®ç­‰åŠŸèƒ½çš„è¡¥å……ã€‚

---

### 2017-09-21ï¼šå®¹å™¨äº‘åœ¨ä¸‡è¾¾çš„è½åœ°ç»éªŒ

> Qï¼šGrafana æ˜¯å®žæ—¶æ˜¾ç¤ºæ•°æ®çš„ï¼Œè¯·é—®ä»–å¦‚ä½•èƒ½åšåˆ°å‘Šè­¦ï¼Ÿå°±æ˜¯ grafana è¾¾åˆ°ä¸€å®šå‘Šè­¦é˜ˆå€¼æ—¶åšå‘Šè­¦ï¼Ÿ

Aï¼šGrafana æ–°ç‰ˆæœ¬ä¸­æ·»åŠ äº†ç®€å•çš„å‘Šè­¦åŠŸèƒ½ï¼Œåœ¨ Notification Channels é¡µé¢æœ‰ä¸ªæ–°å»ºé€šé“ï¼Œåœ¨é‡Œé¢è®¾ç½®ä¸€ä¸‹ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹å®˜æ–¹çš„æ–‡æ¡£ã€‚

> Qï¼šè¯·é—®å¦‚ä½•å®žçŽ°å®¹å™¨é™é€Ÿçš„ï¼Ÿ

Aï¼šä½ æ˜¯è¯´å®¹å™¨çš„ç½‘ç»œé™é€Ÿå—ï¼Ÿæµé‡é™åˆ¶åŠŸèƒ½æˆ‘ä»¬æ˜¯é€šè¿‡åœ¨ pod çš„ annotations å­—æ®µè®¾ç½® `kubernetes.io/ingress-bandwidth` ï¼ˆè®¾ç½®è¾“å…¥æµé‡å¸¦å®½ï¼‰å’Œ `kubernetes.io/egress-bandwidth` ï¼ˆè®¾ç½®è¾“å‡ºæµé‡å¸¦å®½ï¼‰æ¥å®žçŽ°ã€‚

> Qï¼šè¯·é—®ä½¿ç”¨ä»€ä¹ˆæ“ä½œç³»ç»Ÿéƒ¨ç½² Kubernetesï¼Œæœ‰ä»€ä¹ˆè€ƒè™‘ï¼Ÿ

Aï¼šç”¨çš„ CentOS 7ï¼Œä¼ä¸šä¸€èˆ¬çš„ç”¨æ³•ï¼Œè¿˜æœ‰å°±æ˜¯å®ƒç¨³å®šï¼Œä¸å®¹æ˜“å‡ºé—®é¢˜ï¼ŒKubernetes å’Œ Docker çš„æ”¯æŒæ¯”è¾ƒå¥½ã€‚

> Qï¼šå¦‚ä½•æŠŠæ‰€æœ‰å‘Šè­¦ä¿¡æ¯å…¨éƒ¨é€’ç»™ Zabbixï¼ŒZabbix è‡ªèº«æ˜¯å¦ä¹ŸèŽ·å–äº†ç›‘æŽ§å€¼ä¿¡æ¯äº†ï¼Ÿ

Aï¼šå…¨éƒ¨æŽ¨é€åŽ‹åŠ›å¤§ï¼Œå…ˆå°† APIserverã€Heapster ä¸­ç›¸å…³çš„ä¿¡æ¯æ”¾ MySQLï¼Œä¸­é—´åšä¸ªæ•°æ®åº“ã€‚

> Qï¼šetcd 3 çš„å®¹ç¾å’Œå®‰å…¨åšäº†å—ï¼Ÿ

Aï¼šetcd éžå¸¸å…³é”®ï¼Œæˆ‘ä»¬ä¼šåœ¨å‡çº§å’Œå®šæœŸç”¨ etcdctl åš backupã€‚å‡çº§æ—¶éœ€å°† --initial-cluster-state æ”¹ä¸º existing ï¼Œå®‰å…¨æ–¹é¢è¿˜æ²¡æœ‰ã€‚

> Qï¼šåšç°åº¦å‘å¸ƒæˆ– HPA è‡ªåŠ¨æ‰©å®¹æ—¶ï¼Œå®žçŽ°äº†ä¸å½±å“æ­£åœ¨æä¾›æœåŠ¡çš„æœåŠ¡å—ï¼Ÿ

Aï¼šç°åº¦å‘å¸ƒä¸ä¼šå½±å“æœåŠ¡ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Ingress + Nginx æ¥ä¿è¯ Pod çš„å˜åŒ–ä¸å—å½±å“ã€‚HPA è¿™å—æˆ‘ä»¬ä¸æ•¢ä¸Šçº¿ï¼ŒåŠŸèƒ½å®Œæˆäº†ï¼Œä½†æ²¡æœ‰ç»è¿‡å¤§é‡æµ‹è¯•ã€‚

> Qï¼šä½¿ç”¨ rbd ä½œä¸ºåŽç«¯å­˜å‚¨ï¼Œå½“ pod å‘ç”Ÿè¿ç§»åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹åŽå¦‚ä½•å†æ¬¡æŒ‚è½½è¿™ä¸ª rbdï¼Ÿ

Aï¼šå°† PVC çš„ volume.beta.kubernetes.io/storage-class å’Œ StorageClass çš„ name åå­—ä¸€æ ·å°±å¯ã€‚ä¸éœ€è¦ç®¡åŽé¢ Podã€‚

> Qï¼šetcd 3 åœ¨å“ªäº›æ–¹é¢ä¸å¦‚ etcd 2ï¼Ÿ

Aï¼šæ²¡æœ‰åŽ»åšå¯¹æ¯”ï¼Œetcd 3 æ˜¯é€šè¿‡æœé›†äº† etcd 2 ç”¨æˆ·çš„åé¦ˆå’Œå®žé™…æ‰©å±• etcd 2 çš„ç»éªŒåŸºç¡€ä¸Šå…¨æ–°è®¾è®¡äº† API çš„äº§å“ã€‚etcd 3 åœ¨æ•ˆçŽ‡ï¼Œå¯é æ€§å’Œå¹¶å‘æŽ§åˆ¶ä¸Šæ”¹è¿›æ¯”è¾ƒå¤šã€‚etcd 2 æ”¯æŒå¤šè¯­è¨€å®¢æˆ·ç«¯é©±åŠ¨ï¼Œetcd 3 ç”±äºŽé‡‡ç”¨ gRPCï¼Œå¾ˆå¤šéœ€è¦è‡ªå·±å®žçŽ°é©±åŠ¨ã€‚

> Qï¼šè¯·é—®æœ‰çŠ¶æ€çš„ pod è¿ç§»ï¼Œä½¿ç”¨ ceph pv æ˜¯æ€Žä¹ˆä¿è¯åˆ†åˆ°åŒä¸€ä¸ª volumeï¼Ÿ

Aï¼šæˆ‘ä»¬ç”¨çš„æ˜¯ StorageClassï¼Œåœ¨ PVC æ—¶æŒ‡å®šå’Œ StorageClass åå­—ä¸€æ ·å°±å¯ã€‚é€šè¿‡ volume.beta.kubernetes.io/storage-class æ¥æŒ‡å®šè¯¥åå­—ã€‚

> Qï¼šè¯·é—®è¿è¡Œåœ¨ä¸åŒçš„ Node ä¸Šé¢çš„ Pod å¦‚ä½•å…±äº« Volume å­˜å‚¨ï¼Œæ¯”å¦‚è¦å…±äº«ä¸€ä»½ä»£ç ï¼Ÿ

Aï¼šä¸åŒ Node é—´çš„ Pod å·å…±äº«æ–¹å¼æ¯”è¾ƒå¤šï¼Œä½†ä¸€èˆ¬éœ€è¦ç½‘ç»œå­˜å‚¨ï¼Œæ¯”å¦‚ï¼šNFSï¼ŒGlusterFSï¼ŒCephFSï¼ŒCeph rbdï¼Œå½“ç„¶è¿˜åŒ…æ‹¬å¾ˆå¤šå¤§åŽ‚å¦‚ï¼šGCE çš„ pdï¼ŒAWS çš„ ebs ç­‰ã€‚ç”šè‡³å¯ä»¥ä½¿ç”¨ ConfigMap æ¥å…±äº«ï¼Œç„¶åŽ mount åˆ°ç›¸åº”çš„ç›®å½•å³å¯ã€‚

> Qï¼šè¯·é—®æœ‰æ²¡æœ‰å¯¹æ¯”è¿‡å…±æœ‰çš„å®¹å™¨äº‘å’Œç§æœ‰çš„å®¹å™¨äº‘çš„ä¼˜ç¼ºç‚¹ï¼Ÿ

Aï¼šå…¬æœ‰äº‘æ¯”è¾ƒéš¾åšï¼Œæˆ‘ä»¬ä¹‹å‰æ˜¯åšç§æœ‰äº‘ï¼ˆç‰©ç†èµ„æºéš”ç¦»ï¼Œç”¨æˆ·æ•°æ®æ›´å®‰å…¨å¯æŽ§ï¼›ç‹¬å èµ„æºï¼Œä¸å—å¹²æ‰°ï¼›è‡ªè¡Œè§„åˆ’çµæ´»è°ƒæ•´èµ„æºå¤ç”¨æ¯”ä¾‹ï¼Œæˆæœ¬æ›´ä¼˜ï¼‰ï¼Œå…¬æœ‰äº‘ï¼ˆå…¬æœ‰äº‘å¼¹æ€§ï¼Œè‡ªå¦‚åº”å¯¹ä¸šåŠ¡å˜åŒ–ï¼›å…·å¤‡è·¨æœºæˆ¿ã€è·¨åœ°åŒºçš„å®¹ç¾èƒ½åŠ›ï¼‰æˆ‘ä»¬ä¹Ÿåœ¨åšï¼Œæ­£åœ¨å’Œ IBM åˆä½œã€‚

> Qï¼šè¯·æ•™å¤š Master ä¸‹ï¼Œå½“æŸä¸ª Master down æŽ‰ï¼Œdefault/kubernetes endpoints ä¸­çš„ IP æ²¡æ›´æ–°çš„é—®é¢˜ï¼Œä½ ä»¬æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ

Aï¼šè¿™ä¸ªä¸»è¦æ˜¯ Endpoints æŽ§åˆ¶å™¨è´Ÿè´£ Endpoints å¯¹è±¡çš„åˆ›å»ºï¼Œæ›´æ–°ã€‚æ–° leader master æŽŒç®¡åŽï¼ŒKubernetes ä¼šç”¨ checkLeftoverEndpoints æ¥åˆ é™¤ æ²¡æœ‰å“åº”çš„æœåŠ¡çš„ endpointsï¼Œé‡å¯ä¸€ä¸‹ kube-controller-manager è¯•è¯•ã€‚

> Qï¼šåšè¿‡é›†ç¾¤è”ç›Ÿå—ï¼Ÿ

Aï¼šæœ‰æµ‹è¯•è¿‡ï¼Œä½†ç›®å‰ Kubernetes å¯ä»¥æ”¯æŒè¾¾ 1000 èŠ‚ç‚¹äº†ï¼Œèƒ½æ»¡è¶³æˆ‘ä»¬ç›®å‰çš„éœ€æ±‚ï¼Œæ‰€ä»¥è¿˜æ²¡æœ‰ä¸Šã€‚

> Qï¼šHPA ä¸æ˜¯ Kubernetes æ”¯æŒçš„å—ï¼Ÿä½ ä»¬å¯¹å…¶åšäº†å“ªäº›äºŒæ¬¡å¼€å‘ï¼Ÿæ”¯æŒè“ç»¿éƒ¨ç½²å—ï¼Ÿ

Aï¼šå¯¹çš„ï¼Œç›®å‰æ˜¯æ”¯æŒ CPU è¿˜æœ‰ä¸€äº›åº”ç”¨ç¨‹åºæä¾›çš„ metrics äº†ï¼Œä¹‹å‰åœ¨ç¤¾åŒºè¿˜æ²¡æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰è‡ªå·±å¼€å‘ï¼Œä¸»è¦æ˜¯é€šè¿‡ heapster ç›‘æŽ§ qps è¿˜æä¾›è‡ªå®šä¹‰çš„ä¸€äº›åº¦é‡æ¥å®Œæˆ HPAã€‚ä½† HPA è¿™ä¸ªä¸€æ—¦å‡ºé—®é¢˜ä¼šä¸å¯æŽ§ï¼Œæ‰€ä»¥æš‚æ—¶è¿˜ä¸æ•¢ä¸Šçº¿ã€‚è“ç»¿éƒ¨ç½²æ¯”è¾ƒè€—ç¡¬ä»¶èµ„æºï¼Œç›¸å½“äºŽè¦å¤šä¸€æ–°ç‰ˆæœ¬å¤‡ä»½ï¼Œç›®å‰æˆ‘ä»¬è¿˜ä¸æ”¯æŒè“ç»¿éƒ¨ç½²ã€‚

> Qï¼šå¦‚æžœæƒ³çœ‹æ—¥å¿—æ–‡ä»¶æœ‰æ²¡æœ‰å¥½çš„åŠžæ³•ï¼Œæ„Ÿè§‰åœ¨ ES é‡è¢«åˆ‡å‰²äº†ä¸å‹å¥½ï¼Ÿ

Aï¼šæ—¥å¿—æ–‡ä»¶å¯ä»¥é€šè¿‡åœ¨å¯åŠ¨çš„æ—¶å€™æ–°å»ºä¸€ä¸ªä»¥åº”ç”¨åå­—å‘½åçš„ç›®å½•æŒ‚è½½åˆ°æœ¬åœ°æˆ–è€…ç½‘ç»œå­˜å‚¨ä¸­ï¼Œç„¶åŽåº”ç”¨çš„æ ‡å‡†æˆ–é”™è¯¯è¾“å‡ºä¼šç›´æŽ¥è¾“å‡ºåˆ° docker daemon çš„æ—¥å¿—ç›®å½•ä¸‹ï¼Œå¦‚æžœåº”ç”¨æœ‰è‡ªå·±çš„ä¸“é—¨çš„æ–‡ä»¶è¾“å‡ºæ–¹å¼ï¼Œåˆ™å¯ä»¥ç”¨ tail -f æ–¹å¼è¿›è¡Œè½¬å‘ä¸Ž docker daemon å¯¹æŽ¥ã€‚

> Qï¼šè¿˜æœ‰å°±æ˜¯åŸºç¡€å®¹å™¨æ˜¯ç”¨çš„ CentOS é•œåƒå—ï¼Ÿå®ƒé»˜è®¤å°±æŽ¥è¿‘ 200mã€‚å¼€å‘è¯­è¨€ç”¨çš„ Go çš„è¯æœ‰å•¥ä¼˜åŒ–å®¹å™¨çš„åœ°æ–¹ï¼Ÿ

Aï¼šåŸºç¡€å®¹å™¨ä¸€èˆ¬ CentOS çš„å¤šäº›ï¼Œæœ‰äº›ä¼šç›´æŽ¥é‡‡ç”¨ docker hub æä¾›çš„åŽŸå§‹é•œåƒï¼Œç„¶åŽåšäº›è‡ªå®šä¹‰ç»„ä»¶æ·»åŠ å¹¶é‡æ‰“åŒ…ã€‚ä¸€èˆ¬çš„ä¼šæ¯”è¾ƒå¤§ä¸€äº›ï¼Œé•œåƒå¯ä»¥å¯¹ Dockerfile è¿›è¡Œä¼˜åŒ–æ¥å˜å°ã€‚å¯ä»¥ç”¨ pprof æ¥åˆ†æž Go ä»£ç æ€§èƒ½ï¼Œå®¹å™¨çš„ä¼˜åŒ–è¿˜ä¸»è¦åœ¨ Dockerfileã€‚

> Qï¼šè¯·é—®ä½ ä»¬å¯¹äºŽç”¨æˆ·ä½“éªŒæ–¹é¢æ˜¯å¦‚ä½•ç›‘æŽ§çš„ï¼Ÿæ¯”å¦‚æ¯ä¸ªç‚¹å‡»åœ¨ä¸åŒæœåŠ¡å±‚é¢ä¸Šçš„å»¶æ—¶å„æ˜¯å¤šå°‘ï¼Œè¶…æ—¶æŠ¥è­¦ç­‰ï¼Ÿ

Aï¼šè¿™æ˜¯ä¸ªä¸é”™çš„æƒ³æ³•ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰åšè¿™å—ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡åº”ç”¨æä¾›çš„ urlï¼Œå¯¹å…¶ç›‘æŽ§ HTTP get çš„ response æ—¶é—´æ¥æŽ§åˆ¶ã€‚

> Qï¼šå‰ç«¯åŸºäºŽ Opads å’ŒåŽç«¯ Pluto å®žçŽ° CIï¼Œæœ‰å…·ä½“çš„æ–‡æ¡£å¯ä»¥å‚è€ƒå—ï¼Ÿ

Aï¼šè¿™ä¸¤ä¸ªéƒ½æ˜¯è‡ªå·±å†…éƒ¨å¼€å‘çš„æ¨¡å—ï¼Œä¸€ä¸ªåŸºäºŽ PHPï¼Œä¸€ä¸ªåŸºäºŽ Pythonï¼Œæ–‡æ¡£ä¸æ–¹ä¾¿åˆ†äº«ã€‚

> Qï¼šç›®å‰å¤§è§„æ¨¡è½åœ°äº‘å¹³å°æ˜¯å»ºè®®ä¸Šå®¹å™¨äº‘å—ï¼Ÿ

Aï¼šå»ºè®®ä¸Šã€‚

> Qï¼šæœåŠ¡å¯åŠ¨ä¾èµ–å’Œåº”ç”¨ç‰ˆæœ¬æŽ§åˆ¶å¦‚ä½•åšçš„ï¼Ÿ

Aï¼šè¿™å—æˆ‘ä»¬åšçš„ä¸å¤§å¥½ï¼Œä¸€èˆ¬å¯ä»¥å°†æ¯ä¸ªæœåŠ¡æ³¨å†Œåˆ°å‘çŽ°æœåŠ¡ï¼Œç„¶åŽè®°å½•å®ƒä»¬çš„ä¾èµ–ï¼Œåœ¨å¯åŠ¨æ—¶è¿›è¡ŒæœåŠ¡å‘çŽ°åŠå¯åŠ¨ï¼Œè¿™ä¸ªåœ¨å¾®æœåŠ¡æ¡†æž¶ä¸­æœ‰äº›ã€‚æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºç‰ˆæœ¬æŽ§åˆ¶æ–¹é¢æœ‰è‡ªå·±çš„çº¦æŸè§„èŒƒï¼Œä½†åŽé¢ä¼šæœ‰ helm æ¥è¯•è¯•ã€‚

> Qï¼šetcd é›†ç¾¤ä¸ºä»€ä¹ˆä¸ç›´æŽ¥ç”¨ Compose å¯åŠ¨ï¼Ÿ

Aï¼šè¿™ä¸ªæˆ‘ä»¬ä¸ºäº† ansible éƒ¨ç½²æ–¹ä¾¿

> Qï¼šNode èŠ‚ç‚¹é‡‡ç”¨è™šæ‹Ÿæœºè¿˜æ˜¯ç‰©ç†æœºéƒ¨ç½²çš„ï¼Ÿ

Aï¼šç‰©ç†æœºã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 09 æœˆ 21 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚

åˆ†äº«äºº**é™ˆå¼ºï¼Œä¸‡è¾¾ç½‘ç»œèµ„æ·±å·¥ç¨‹å¸ˆï¼Œæ¯•ä¸šäºŽåŽä¸œå¸ˆèŒƒå¤§å­¦ã€‚ç›®å‰åœ¨ä¸‡è¾¾ç½‘ç»œç§‘æŠ€é›†å›¢äº‘å…¬å¸åŸºç¡€æž¶æž„éƒ¨è´Ÿè´£ Kubernetes ä¸Ž Docker çš„è½åœ°ä¸Žå®žè·µå·¥ä½œã€‚æ›¾å…ˆåŽå°±èŒäºŽ Intelã€IBM å’Œçˆ±å¥‡è‰ºã€‚åœ¨äº‘è®¡ç®—é¢†åŸŸé•¿å¹´æ¬ç –ï¼Œå¯¹ Mesos/Kubernetes/Docker ç­‰æœ‰è¾ƒæ·±å…¥çš„ç ”ç©¶**ã€‚

---

### 2017-09-16ï¼šServerless äº‘å‡½æ•°æž¶æž„ç²¾è§£

> Qï¼šè¯·é—®ä»£ç æ€Žä¹ˆéƒ¨ç½²åˆ° Docker ä¸­ï¼Ÿ

Aï¼šç›´æŽ¥å°†ä»£ç ä¸‹è½½è‡³æ¯æœºï¼Œå†å°†ä»£ç ç›®å½•æŒ‚è½½è‡³ Dockerã€‚

> Qï¼šäº‘å‡½æ•°æ˜¯é€šç”¨çš„è¿˜æ˜¯åªèƒ½åœ¨äº‘å¹³å°è¿è¡Œï¼Ÿ

Aï¼šäº‘æä¾›äº†äº‘å‡½æ•°æœåŠ¡ï¼Œè‡ªå·±ä¹Ÿå¯æ­å»ºï¼Œç›®å‰ GitHub ä¸Šæœ‰ä¸å°‘å¼€æºäº‘å‡½æ•°å¹³å°ï¼Œæ¯”å¦‚ OpenLambdaï¼ŒIron.io ç­‰ï¼Œå»ºè®®ç›´æŽ¥ä½¿ç”¨äº‘çš„æœåŠ¡ï¼Œå› ä¸ºå¯ä»¥å’Œå¤šä¸ªäº‘äº§å“æ‰“é€šï¼Œå•é äº‘å‡½æ•°è‡ªèº«éš¾ä»¥æž„å»ºå®Œæ•´æœåŠ¡ã€‚

> Qï¼šäº‹ä»¶ä¼ é€’ä½¿ç”¨çš„æ˜¯é˜Ÿåˆ—å—ï¼Ÿ

Aï¼šå¼‚æ­¥äº‹ä»¶ç”¨äº† CMQ æ¶ˆæ¯é˜Ÿåˆ—æŒä¹…åŒ–å­˜å‚¨ï¼ŒåŒæ­¥äº‹ä»¶æœªä½¿ç”¨ã€‚

> Qï¼šè¯·é—®äº‘å‡½æ•°å¯¹å¼€å‘è¯­è¨€æœ‰é™åˆ¶å¦ï¼Ÿå¦‚æžœæœ‰ï¼Œç›®å‰å¯¹ Go è¯­è¨€çš„æ”¯æŒå¦‚ä½•ï¼Ÿ

Aï¼šç›®å‰æ”¯æŒ Python 2.7/3.6ï¼ŒNode.js 4.3/6.10ï¼ŒJava 8ï¼Œå¦‚æžœæœ‰é€šç”¨çš„ç”¨æˆ·éœ€æ±‚ï¼Œå¯ä»¥æ”¯æŒå…¶å®ƒè¯­è¨€ï¼Œæ¯”å¦‚ PHPã€Go ç­‰ã€‚

> Qï¼šæœ‰ç³»ç»Ÿå‡½æ•°è°ƒç”¨å—ï¼Ÿè‡ªå®šä¹‰å‡½æ•°çš„é¢—ç²’åº¦æœ‰ä½•å»ºè®®ï¼Ÿ

Aï¼šç»å¤§éƒ¨åˆ†çš„ç³»ç»Ÿè°ƒç”¨éƒ½å¯è°ƒç”¨ï¼Œé™¤äº†ä¸€äº›å±é™©æ“ä½œï¼Œæ¯”å¦‚å…³æœºï¼Œé‡å¯ï¼Œç½‘ç»œæœåŠ¡ç›‘å¬ç­‰ï¼Œå‡½æ•°é¢—ç²’åº¦å¯å‚è€ƒå¾®æœåŠ¡çš„è®¾è®¡åŽŸåˆ™ï¼Œå°†åŠŸèƒ½å°½é‡æ‹†ç»†ã€‚

> Qï¼šèƒ½ä»‹ç»ä¸‹å°†è¯·æ±‚è°ƒåº¦åˆ°å‡½æ•°å®žä¾‹çš„å®žçŽ°å—ï¼Ÿ

Aï¼šè¿™é‡Œæœ‰ä¸ª Invoker æ¨¡å—å¯¹æ¯ä¸ªå‡½æ•°ç»´æŒæœ‰ä¸€ä¸ªè¯·æ±‚é˜Ÿåˆ—ï¼Œç›®å‰æ²¡è®¾ç½®ä¼˜å…ˆçº§ï¼ŒæŒ‰ç…§å…ˆæ¥å…ˆåˆ°çš„é¡ºåºä¾æ¬¡è°ƒåº¦ï¼Œè°ƒåº¦æ—¶ä¼šä»Žå‡½æ•°æ‰€æœ‰å¯ç”¨çš„å‡½æ•°å®žä¾‹ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªä¸‹å‘ã€‚å‡½æ•°å®žä¾‹é‡Œæœ‰ä¸ªå¾ªçŽ¯æŽ¥å—è¯·æ±‚ï¼Œæ”¶åˆ°æ—¶ä¼ é€’å‚æ•°è°ƒç”¨ç”¨æˆ·å‡½æ•°ã€‚

> Qï¼šä»£ç å¯ä»¥ä¸‹äº‘è½åœ°å—ï¼Ÿ

Aï¼šä»£ç é‡Œä¸€èˆ¬ä¼šæ¶‰åŠå…¶å®ƒäº‘äº§å“çš„è°ƒç”¨ï¼Œæ‰€ä»¥ä¸€èˆ¬å¯¹äº‘å¹³å°æœ‰ä¸€äº›ä¾èµ–ï¼Œå¯ä»¥å…³æ³¨ä¸‹å¼€æºçš„ Serverless æ¡†æž¶ï¼Œåœ¨å…¬æœ‰äº‘äº‘å‡½æ•°ä¸Šå°è£…äº†ä¸€å±‚ï¼Œç”¨æ¥è§£é™¤ä¾èµ–ï¼Œå®žçŽ°åœ¨å„ä¸ªäº‘å¹³å°çš„å¹³æ»‘è¿ç§»ã€‚

> Qï¼šäº‘å‡½æ•°çš„ä»£ç æœ‰å“ªäº›é™åˆ¶ï¼Ÿæ¯”å¦‚ä»€ä¹ˆæ ·çš„å‡½æ•°ä¸å¯ä»¥è°ƒç”¨ï¼Œä»€ä¹ˆæ ·çš„åº“ä¸èƒ½ importï¼Ÿ

Aï¼šå¯ä»¥åŸºæœ¬è®¤ä¸ºæ— é™åˆ¶ï¼Œä½†ä¼šç¦æ­¢æ¶æ„è¡Œä¸ºï¼Œæ¯”å¦‚å…³æœºï¼Œé‡å¯ï¼Œç«¯å£æ‰«æç­‰ï¼›ä¹Ÿä¼šç¦æ­¢ç«¯å£ç›‘å¬ï¼Œå› ä¸ºå¸¸é©»è¿›ç¨‹ä¸ç¬¦åˆäº‘å‡½æ•°æŒ‰éœ€å¯ç”¨çš„åŽŸåˆ™ã€‚å¦‚æžœé¢„è£…åº“ä¸ç¬¦åˆè¦æ±‚ï¼Œå¯ä»¥è‡ªè¡Œå°†ä¾èµ–åº“æ‰“åŒ…è‡³ zip é‡Œä¸Šä¼ ã€‚

---

### 2017-08-25ï¼šåŸºäºŽ Kubernetes çš„åº”ç”¨ç¼–æŽ’å®žè·µ

> Qï¼šè…¾è®¯äº‘ Kubernetes ç½‘ç»œç”¨çš„æ˜¯å“ªä¸ªç»„ä»¶å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬ç”¨çš„æ˜¯å…¨å±€è·¯ç”±çš„æ–¹å¼ï¼Œç›´æŽ¥å’Œæˆ‘ä»¬è…¾è®¯äº‘çš„ VPC ç½‘ç»œæ‰“é€šã€‚

> Qï¼šä½¿ç”¨ ConfigMap çš„æ—¶å€™ï¼Œåœ¨é…ç½®ä¿®æ”¹å®Œï¼Œéœ€è¦é‡å¯æœåŠ¡ã€‚è…¾è®¯äº‘å®¹å™¨æœåŠ¡é…ç½®æ–‡ä»¶çš„å˜æ›´å¦‚ä½•è§¦å‘æœåŠ¡çš„é‡æ–°å¯åŠ¨ï¼Ÿ

Aï¼šé€šè¿‡è§¦å‘å™¨çš„æ¨¡å¼ï¼Œå¯ä»¥åœ¨ä¿®æ”¹é…ç½®æ—¶è§¦å‘æœåŠ¡çš„æ›´æ–°ã€‚

> Qï¼šåº”ç”¨é…ç½®å¦‚ä½•å®žçŽ°ç‰ˆæœ¬æŽ§åˆ¶çš„ï¼Ÿ

Aï¼šå¯¹äºŽæ¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬æ”¯æŒæ¯ä¸€æ¬¡ä¿®æ”¹é»˜è®¤åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œå…·æœ‰å”¯ä¸€çš„ç‰ˆæœ¬å·ã€‚

> Qï¼šåº”ç”¨é‡Œçš„æœåŠ¡å…·ä½“è¦æ€Žä¹ˆæ›´æ–°å‘¢ï¼Ÿ

Aï¼šä¸€èˆ¬å»ºè®®çš„æ›´æ–°æ–¹æ³•æ˜¯ï¼Œå…ˆä¿®æ”¹é…ç½®ï¼Œä¼šç”Ÿæˆé…ç½®çš„ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œè¿™æ ·è¿™æ¬¡ä¿®æ”¹åœ¨é…ç½®ä¸­æ˜¯å¯ä»¥è®°å½•çš„ã€‚ç„¶åŽæ›´æ–°åº”ç”¨æ±‡æ€»é…ç½®æ–‡ä»¶çš„ç‰ˆæœ¬ã€‚è§¦å‘æˆ–è€…æ‰‹åŠ¨æ›´æ–°å¯¹åº”çš„æœåŠ¡ã€‚åœ¨ä¿®æ”¹é…ç½®æ–‡ä»¶çš„ç‰ˆæœ¬åŽï¼Œæˆ‘ä»¬ä¼šæ¯”è¾ƒå‡ºå“ªäº›æœåŠ¡æœ‰å˜åŒ–ï¼Œéœ€è¦æ›´æ–°ã€‚

> Qï¼šå¤–éƒ¨è®¿é—®é›†ç¾¤æ˜¯é€šè¿‡ Nginx è½¬å‘åˆ° Pod è¿˜æ˜¯é€šè¿‡ Kubernetes æœ¬æ¥éƒ½ DNS æœåŠ¡æ¥è½¬å‘ï¼Œä¸¤è€…ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šå¤–éƒ¨è®¿é—®ï¼Œæ”¯æŒä¸¤ç§æ–¹å¼ã€‚ä¸€ç§æ˜¯é€šè¿‡æœåŠ¡çš„ LB ç›´æŽ¥è½¬å‘åˆ°å¯¹åº”çš„ Podï¼Œä½†éœ€è¦åœ¨åˆ›å»ºæœåŠ¡æ—¶æŒ‡å®šè®¿é—®æ–¹å¼ä¸ºå¤–éƒ¨è®¿é—®ï¼ˆå¯¹åº”äºŽ Kubernetes ä¸­çš„ LoadBanace æ–¹å¼ï¼‰ã€‚å¦å¤–ä¸€ç§æ˜¯é€šè¿‡ingress çš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼ä¼šæœ‰ä¸€ä¸ªç»Ÿä¸€çš„ LB ä½œä¸ºå…¥å£ã€‚ç„¶åŽé…ç½®å¯¹åº”çš„åŽç«¯åŸŸåè½¬å‘è§„åˆ™ã€‚å¯ä»¥å°†å¤–éƒ¨çš„è®¿é—®æŒ‰ç…§é…ç½®çš„è§„åˆ™è½¬å‘åŽç«¯çš„æœåŠ¡ã€‚

> Qï¼šåº”ç”¨çš„æ‰©å®¹ç¼©å®¹é€šè¿‡ä»€ä¹ˆç›‘æŽ§ï¼Œæœ‰ä»€ä¹ˆæŒ‡æ ‡å¯ä»¥å‚è€ƒï¼Ÿ

Aï¼šè‡ªåŠ¨æ‰©å®¹å’Œç¼©å®¹æˆ‘ä»¬å‚è€ƒçš„æ˜¯ç¤¾åŒº HPA çš„æ–¹æ¡ˆã€‚æŒ‡æ ‡ç›®å‰è€ƒè™‘çš„æ˜¯ CPU å’Œå†…å­˜ã€‚

> Qï¼šçŠ¶æ€åŒ–çš„å®¹å™¨æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šç›®å‰çœ‹åˆ°çš„æœ‰ä¸‰ç§æ–¹å¼ï¼šä¸€ç§æ˜¯ç¤¾åŒºæŽ¨èçš„ Stateful èµ„æº +headles serviceï¼Œå¦å¤–ä¸€ç§æ˜¯å°†æœåŠ¡çš„æ¯ä¸€ä¸ªå®žä¾‹æ‹†åˆ†æˆç‹¬ç«‹çš„ headless service ï¼Œç¬¬ä¸‰ç§æ˜¯é‡‡ç”¨ CoreOS æå‡ºçš„ operater æ–¹å¼ã€‚å­˜å‚¨éƒ¨åˆ†ä¸€èˆ¬æŽ¨èä½¿ç”¨ PVC çš„æ–¹å¼ï¼Œä½†æœ‰å…¶ä»–çš„å­˜å‚¨æ–¹å¼ä¹Ÿå¯ä»¥ã€‚

---

### 2017-08-22ï¼šç™½è¯ Kubernetes ç½‘ç»œ

> Qï¼šKubernetes çš„ç½‘ç»œç­–ç•¥é‡‡ç”¨äº†æ¯”è¾ƒä¸¥æ ¼çš„å•å‘æµæŽ§åˆ¶ï¼Œå³å‡å¦‚å…è®¸æœåŠ¡ A è®¿é—®æœåŠ¡ Bï¼Œåè¿‡æ¥æœåŠ¡ B å¹¶ä¸ä¸€å®šèƒ½è®¿é—®æœåŠ¡ Aã€‚ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆä¸¥æ ¼å•å‘æµå‘¢ï¼Ÿ

Aï¼šä¸»è¦æ˜¯å®‰å…¨æ€§çš„åŽŸå› ï¼Œè¿™æ˜¯ä¸€ç§æ›´ç²¾ç»†çš„æƒé™æŽ§åˆ¶ç­–ç•¥ï¼Œé™¤äº†æ–¹å‘ï¼ŒKuberetes è¿˜å…è®¸å¯¹å¯è®¿é—®çš„ç«¯å£è¿›è¡ŒæŽ§åˆ¶ã€‚

> Qï¼šOpen vSwitch æœ‰æµ‹è¿‡ä¹ˆï¼Ÿ

Aï¼šæ²¡æœ‰æµ‹è¯•ï¼ŒOpen vSwitch åŒæ ·å¯ä»¥é…ç½®æˆ Overlay ç½‘ç»œæˆ–è€… Macvlan ç½‘ç»œç­‰ä¸åŒçš„é€šä¿¡æ¨¡å¼ï¼Œé€Ÿåº¦ä¹Ÿä¼šè½åˆ°ç›¸åº”çš„æ¡£ä½ä¸Šã€‚é‚£ä¸ªæµ‹è¯•ä¾‹å­åªæ˜¯ä¸ºäº†è¯´æ˜Žç½‘ç»œé€Ÿåº¦ä¸Žé‡‡ç”¨çš„é€šä¿¡åŽŸç†æœ‰å…³ï¼ŒåŒæ—¶å¼•å‡ºå‡ ç§ä¸»æµçš„é€šä¿¡æ¨¡å¼åŽŸç†ï¼Œæµ‹è¯•æ•°æ®æ˜¯ä¸å‡†ç¡®çš„ï¼Œå»ºè®®ä»¥åœ¨è‡ªå·±çš„å®žé™…çŽ¯å¢ƒä¸­æµ‹è¯•ç»“æžœä¸ºå‡†ã€‚

> Qï¼šCalico æ€Žä¹ˆåšç½‘æ®µé—´çš„éš”ç¦»ï¼Ÿ

Aï¼šå„ç§ç½‘ç»œå·¥å…·çš„ç½‘ç»œç­–ç•¥åŸºæœ¬ä¸Šéƒ½æ˜¯åŸºäºŽå†…æ ¸çš„ Iptables æ¨¡å—å®žçŽ°çš„ã€‚æ¯”å¦‚ Calico åªæ˜¯æ ¹æ®ç”¨æˆ·é…ç½®ï¼Œè‡ªåŠ¨ç®¡ç†å„ä¸ªèŠ‚ç‚¹ä¸Šçš„ Iptables è§„åˆ™ã€‚å…¶ä»–æœ‰äº›æ”¹è¿›çš„ï¼Œæ¯”å¦‚ Romana è®¾è®¡äº†ä¸€ç§åŸºäºŽ"ç§Ÿæˆ·"çš„è§„åˆ™ç®¡ç†æœºåˆ¶ï¼Œå¯ä»¥ç”¨æ›´å°‘çš„ Iptables è§„åˆ™å®žçŽ°ç½‘ç»œéš”ç¦»ã€‚

> Qï¼šå¦‚æžœåœ¨ Kubernetes é‡Œé¢éœ€è¦åšåˆ°å¹³è¡Œç½‘ç»œï¼Œè®©æ¯ä¸€ä¸ª Pod èŽ·å–ä¸€ä¸ªä¸šåŠ¡ IPï¼Œé™¤äº† Bridge+Vlan çš„æ–¹å¼ï¼Œè¿˜æœ‰æ›´å¥½çš„å»ºè®®ä¹ˆï¼Ÿ

Aï¼šè¿™æ¬¡è®²çš„è¿™äº› CNI æ’ä»¶éƒ½ä¼šè®©æ¯ä¸€ä¸ª Pod èŽ·å¾—ä¸€ä¸ªç‹¬ç«‹ä¸šåŠ¡ IPã€‚å¯ä»¥æ ¹æ®å®žé™…ç½‘ç»œæƒ…å†µå’Œå¯¹é€Ÿåº¦çš„éœ€æ±‚é€‰æ‹©ã€‚

> Qï¼šCalico BGP IPIP NAT ä¸‰ç§æ¨¡å¼åˆ†åˆ«æ€Žä¹ˆé…ç½®ï¼ŸåŽŸç†æ˜¯æ€Žæ ·çš„ï¼Ÿå…¶ä¸­ IPIP è¿˜æœ‰ä¸¤ç§æ¨¡å¼ï¼ŒåŒºåˆ«åœ¨å“ªï¼Ÿ

Aï¼šåœ¨ Calico çš„é…ç½®ä¸­è®¾ç½® `spec.ipip.enabled: ture` {.prettyprint}å°±ä¼šå¼€å¯ IPIP æ¨¡å¼ï¼Œå¦åˆ™é»˜è®¤æ˜¯çº¯ BGP æ¨¡å¼ã€‚IPIP çš„ä¸¤ç§æ¨¡å¼å…¶å®žæ˜¯æŒ‡çº¯ IPIPï¼ˆipip always æ¨¡å¼ï¼‰æˆ–è€…æ··åˆ IPIP å’Œ BGPï¼ˆipip cross-subnetï¼‰ï¼ŒåŽè€…æŒ‡çš„æ˜¯"åŒå­ç½‘å†…è·¯ç”±é‡‡ç”¨ BGPï¼Œè·¨å­ç½‘è·¯ç”±é‡‡ç”¨ IPIP"ï¼Œä¸»è¦ç”¨äºŽå³æƒ³åœ¨å†…ç½‘èŽ·å¾—é«˜é€Ÿï¼Œåˆæƒ³åœ¨è·¨å…¬ç½‘æ—¶èƒ½ä¿æŒè”é€šçš„æƒ…å†µã€‚è¿™ç§æ¨¡å¼éœ€è¦æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨æ—¶ç”¨ `--ip` {.prettyprint}å‚æ•°é¢„å…ˆé…ç½®èŠ‚ç‚¹çš„å­ç½‘ï¼Œå¹¶ä¸”æ‰€æœ‰èŠ‚ç‚¹ç‰ˆæœ¬éƒ½åœ¨ v2.1 ä»¥ä¸Šã€‚

> Qï¼šèƒ½éº»çƒ¦å…·ä½“ä»‹ç»ä¸€ä¸‹ kube-proxy è¿™ç§ç½‘ç»œæ¨¡å¼çš„ä¼˜ç¼ºç‚¹å—ï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘çŽ°å¾ˆä¸ç¨³å®šï¼Œä½†æ˜¯åˆæ²¡å‘çŽ°è¶³å¤Ÿçš„è¯æ®ã€‚

Aï¼škube-proxy æ˜¯ Kubernetes çš„ä¸€ä¸ªç»„ä»¶ï¼Œæä¾›é€šè¿‡ Service åˆ° Pod çš„è·¯ç”±ï¼Œå¹¶ä¸æ˜¯ä¸€ç§ç½‘ç»œæ¨¡å¼ï¼Œä¸åŒçš„ç½‘ç»œæ’ä»¶éƒ½ä¼šä½¿ç”¨åˆ°è¿™ä¸ªç»„ä»¶ã€‚

---

### 2017-08-17ï¼šKubernetes ä¸»æœºå’Œå®¹å™¨çš„ç›‘æŽ§æ–¹æ¡ˆ

> Qï¼šå®¹å™¨ç›‘æŽ§å’Œä¸»æœºç›‘æŽ§ä¸ºä½•ä¸èƒ½ç”¨åŒä¸€å¥—æ–¹æ¡ˆï¼Œæ¯”å¦‚ Prometheusï¼Ÿ

Aï¼šå¯ä»¥ï¼Œä¸»è¦è€ƒè™‘åˆ° Prometheus çš„ç»„ä»¶æ¯”è¾ƒå¤šï¼Œå®ƒå°† DBã€Graphã€Statisticã€Alert éƒ½é›†äºŽä¸€ä½“ï¼Œä½†æ˜¯å®ƒçš„æ‰©å±•æ€§ä¸å¥½ï¼Œå†…å­˜å ç”¨çŽ‡å¤§ï¼Œåœ¨ SSD ç›˜ä¸‹ IO å ç”¨æ¯”è¾ƒé«˜ï¼ŒåŒæ—¶å¯èƒ½ä¼šæœ‰å¤§é‡æ•°æ®å †ç§¯å†…å­˜ï¼Œç»´æŠ¤æˆæœ¬æ¯”è¾ƒå¤§ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é¿å…ï¼Œå…¶å®žè¿˜æ˜¯è¦çœ‹å…·ä½“çš„ä¸šåŠ¡åœºæ™¯å’Œéœ€æ±‚ï¼Œå¦‚æžœæ˜¯é’ˆå¯¹å¤§è§„æ¨¡çš„ä¸»æœºå’Œå®¹å™¨ç›‘æŽ§ï¼Œå¹¶ä¸”å¯¹ DBã€Graphã€Statisticã€Alert çš„è¦æ±‚éƒ½æ¯”è¾ƒé«˜ï¼Œé‚£ä¹ˆ Prometheus è‚¯å®šæ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ï¼Œå¦å¤–è¿˜å¯ä»¥ä½¿ç”¨ cAdvisor + Prometheus + Grafana çš„ç»„åˆæ–¹æ¡ˆï¼Œå°†è¿™å‡ ä¸ªå·¥å…·çš„æœ‰ç‚¹ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚

> Qï¼šæœ‰æ²¡æœ‰èƒ½é›†æˆé‚®ä»¶æˆ–çŸ­ä¿¡å‘Šè­¦å·¥å…·çš„å‘¢ï¼Ÿ

Aï¼šæ¯”å¦‚ Prometheus å’Œ Zabbix éƒ½æœ‰é‡‡é›†ï¼Œå±•ç¤ºï¼Œå‘Šè­¦çš„åŠŸèƒ½ã€‚

> Qï¼šPrometheus çš„æ•°æ®å­˜å‚¨åœ¨å“ªå„¿ï¼Œç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šPrometheus æœ¬èº«æ˜¯ç”¨çš„ LevelDB æ•°æ®åº“ï¼Œæ•°æ®å­˜å‚¨åˆ†ä¸¤éƒ¨åˆ†ï¼šå†…å­˜å’Œæœ¬åœ°ç£ç›˜ä¸­ã€‚

> Qï¼škubelet å’Œ cAdvisor æ•´åˆåŽï¼Œç›‘æŽ§å¦‚æžœå‡ºé—®é¢˜å²‚ä¸æ˜¯ä¼šå½±å“æœåŠ¡ç¨³å®šæ€§ï¼Ÿè¿™ä¸ªå¦‚ä½•è§£å†³ï¼Ÿ

Aï¼šåœ¨ Kubernetes çš„æ–°ç‰ˆæœ¬ä¸­å·²ç»é›†æˆäº† cAdvisorï¼ŒcAdvisor ä½œä¸ºä¸€ä¸ª daemon è·‘åœ¨ Kubernetes ä¸Šé¢ï¼Œå³ä½¿ cAdvisor å‡ºçŽ°é—®é¢˜ï¼Œå¯¹ Kubernetes å¹¶æ²¡æœ‰å½±å“ï¼Œè€Œä¸” Kubernetes æœ¬èº«ä¹Ÿæœ‰ä¸€å¥—ç®¡ç†æœºåˆ¶ã€‚

> Qï¼šæƒ³é—®ä¸€ä¸‹å¯¹äºŽ Pod çš„ç”Ÿå‘½å‘¨æœŸçš„ç›‘æŽ§æœ‰æ²¡æœ‰å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæƒ³ç›‘æŽ§ä¸€äº› pod ä¸æ˜ŽåŽŸå› é¢‘ç¹åˆ é™¤å’Œæ–°å»ºï¼Ÿ

Aï¼šcAdvisor å¯ä»¥å¯¹ Pod è¿›è¡Œç›‘æŽ§ï¼Œå¦‚æžœæƒ³æŸ¥åŽŸå› ï¼Œå¯ä»¥å¯¹æ—¥å¿—è¿›è¡Œç›‘æŽ§å’Œåˆ†æžã€‚

Aï¼šå¯ä»¥ä½¿ç”¨ Prometheusã€Icingaã€Zabbix çš„å‘Šè­¦åŠŸèƒ½ã€‚

> Qï¼šcAdvisor çš„é‡‡é›†ç²’åº¦æ˜¯å¤šé•¿æ—¶é—´ï¼Ÿå½“éœ€è¦é‡‡é›†ç§’çº§çš„æ€§èƒ½æ•°æ®æ—¶ cAdvisor æ˜¯å¦èƒ½æ»¡è¶³è¦æ±‚ï¼Ÿ

Aï¼šcAdvisor é‡‡é›†äº†æœ€è¿‘æŽ¥è¿‘ä¸¤åˆ†é’Ÿå†…çš„ 8 ç»„æ•°æ®, å¯ä»¥æ»¡è¶³ï¼Œè¿™é‡Œä¸»è¦æ˜¯è¦è€ƒè™‘ä¸‹å­˜å‚¨é—®é¢˜ï¼Œå› ä¸ºåˆ°é‡‡é›†åˆ°ç§’çº§åˆ«åŽï¼Œæ•°æ®ä¼šå¾ˆå¤§ã€‚

> Qï¼šå®¹å™¨ä¸­ä½¿ç”¨åƒ JVM è¿™ç§éƒ½ä¼šæ€Žä¹ˆæ¥è¿›è¡Œç›‘æŽ§å‘¢ï¼Ÿ

Aï¼šELK stack åº”è¯¥é€‚åˆè¿™ç§åœºæ™¯ï¼Œå¦å¤– Datadog ä¹Ÿæ˜¯ SaaS ç›‘æµ‹å·¥å…·ï¼ŒDatadog æ¯”è¾ƒçµæ´»ï¼Œéœ€è¦æ¤å…¥è‡ªå·±çš„ä»£ç ï¼Œå¯èƒ½æ²¡æœ‰å‰è€…ç”¨èµ·æ¥ç®€å•ã€‚

> Qï¼šå¯¹äºŽç¾¤é›†çŽ¯å¢ƒï¼Œèƒ½ä¸èƒ½ç®€å•æ¯”è¾ƒä¸€ä¸‹å„æ•°æ®é‡‡é›†è½¯ä»¶çš„å¥½åï¼Ÿæˆ–è€…åˆ†äº«ä¸€ä¸‹ç”¨è¿‡çš„å·¥å…·å’Œå‘ã€‚

Aï¼šè¿™å‡ ä¸ªé‡‡é›†å·¥å…·ä¸å¥½è¯´å“ªä¸ªå¥½é‚£ä¸ªåï¼Œè¿˜æ˜¯è¦çœ‹å…·ä½“åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ï¼Œé€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„ï¼ˆå˜¿å˜¿ï¼‰ã€‚ä¾‹å¦‚ï¼šåŠŸèƒ½å…¨çš„å·¥å…·å¯èƒ½ä¼šå¾ˆè‡ƒè‚¿ï¼Œå ç”¨èµ„æºä¹Ÿå¤šï¼Œè€Œä¸”å¹¶ä¸ä¸€å®šä½¿ç”¨æ‰€æœ‰åœºæ™¯ï¼ŒåŠŸèƒ½å°‘çš„æ‰©å±•æ€§å¯èƒ½å¾ˆå¥½ã€‚

> Qï¼šå®¹å™¨ç›‘æŽ§åº”è¯¥æ˜¯ä¸ºäº†å®¹å™¨èƒ½æ›´å¥½çš„è¿è¡Œã€‚é‚£ä¹ˆå½“å®¹å™¨å‡ºçŽ°ä¸€äº›å¼‚å¸¸æƒ…å†µï¼Œæ¯”å¦‚ IO å ç”¨è¿‡é«˜ï¼Œå¸¦å®½å ç”¨å¾ˆå¤šæ—¶ï¼Œè¯¥æ€Žä¹ˆå¤„ç†å‘¢ã€‚

Aï¼šè¿™æ˜¯ç›‘æŽ§ç³»ç»Ÿä¸­è‡ªåŠ¨åŒ–å¤„ç†çš„é‚£éƒ¨åˆ†ï¼Œé’ˆå¯¹å®¹å™¨å‡ºçŽ°çš„å¼‚å¸¸åˆ°åº•æ˜¯è¦é‡‡å–ä»€ä¹ˆè‡ªåŠ¨åŒ–æ“ä½œè¿˜æ˜¯è¦çœ‹å…·ä½“æƒ…å†µï¼Œä¸€èˆ¬å¦‚æžœå®¹å™¨å¼‚å¸¸æŒ‚æŽ‰ï¼Œå¯èƒ½ä¼šé€‰æ‹©è‡ªåŠ¨æ‹‰èµ·ï¼Œä½†å¦‚æžœåƒ IO å ç”¨è¿‡é«˜è¿™ä¸­é—®é¢˜ï¼Œå› ä¸ºå¯¼è‡´çš„åŽŸå› å¤ªå¤šäº†ï¼Œå¯èƒ½æ˜¯ä¸»æœºçš„é—®é¢˜ï¼Œä¹Ÿå¯èƒ½æ˜¯ç¨‹åºæœ¬èº«çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦äººä¸ºåŽ»æŽ’æŸ¥æ‰è¡Œã€‚

> Qï¼šcAdvisor æ˜¯å®šæ—¶é‡‡é›†æ•°æ®ï¼Œä½†æ˜¯æœ‰æ—¶å€™æ—¶é—´ç‚¹é‡‡é›†ä¸åˆ°æ•°æ®ï¼Œæ˜¯ä¸ºä»€ä¹ˆï¼Ÿ

Aï¼šå¯ä»¥çœ‹ä¸‹ cAdvisor æœ‰æ²¡æœ‰å¼‚å¸¸é‡å¯è¿‡ï¼Œç„¶åŽå¯ä»¥æ‰‹åŠ¨åŒºä¸»æœºçš„æ–‡ä»¶ä¸‹æŸ¥çœ‹æ•°æ®ï¼Œç„¶åŽè·Ÿ cAdvisor å–åˆ°çš„æ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œæœ‰å¯èƒ½æ˜¯æ˜¯åœ¨é‡‡é›†æ•°æ®çš„æ—¶å€™æœ‰é—®é¢˜ã€‚

> Qï¼šæ•°æ®é‡‡é›†ä¸­ï¼Œæ‚¨æåˆ°ä¸»åŠ¨è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œé‚£ä¹ˆæ¶‰åŠåˆ°æ—¥å¿—æ–‡ä»¶çš„è¯»å–é‡‡é›†ï¼Œé‚£è¿™å—æ€Žä¹ˆåšå‘¢ï¼Ÿ

Aï¼šå¦‚æžœæ˜¯ä¼ ç»Ÿçš„æ—¥å¿—æ±‡æ€»æ”¶é›†æœ‰å¼€æºçš„è½¯ä»¶ ELK å’Œ Facebook å¼€æºçš„ Scribeï¼Œå®¹å™¨çš„æ—¥å¿—ç®¡ç†å¯ä»¥å‚è€ƒ Fluentdã€‚

> Qï¼šè¿™äº›ç›‘æŽ§æ–¹æ¡ˆä¸­ä»Žèµ„æºå ç”¨æ•°æ®å‡†ç¡®æ€§è§’åº¦æ¥çœ‹ï¼Œå“ªä¸ªæ›´å¥½ç”¨ï¼Ÿ

Aï¼šå‡†ç¡®æ€§éƒ½ä¸ä¼šå·®ï¼Œä»–ä»¬é‡‡é›†çš„æºæ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåœ¨èµ„æºå ç”¨è¿™å—ï¼ŒcAdvisor æ˜¯å ç”¨èµ„æºæœ€å°‘çš„ï¼ŒPrometheus å ç”¨èµ„æºæ¯”è¾ƒå¤šã€‚

> Q16ï¼šæœ‰ä¸€å¤„æˆ‘ä¸æ˜¯å¾ˆç¡®å®šæ˜¯å¦è®²é”™äº†ï¼Œæˆ‘å®žè·µå‘çŽ°å³ä¾¿ä¸ºå®¹å™¨è®¾ç½®äº† MEMã€CPU é™åˆ¶ï¼Œæ‰€ç›‘æŽ§åˆ°çš„ä¾ç„¶æ˜¯ä¸»æœºçš„æ€» MEM å’Œ CPUã€‚

Aï¼šæˆ‘æµ‹è¯•äº†ï¼Œåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™è®¾ç½® MEM å’Œ CPU é™åˆ¶åŽï¼Œé€šè¿‡ docker stats å‘½ä»¤ç›‘æŽ§çš„æ˜¯è®¾ç½®çš„å€¼ã€‚

> Qï¼šå¦‚æžœè¦ç›‘æŽ§æŸä¸ªå®¹å™¨å†…æ­£åœ¨è·‘çš„è¿›ç¨‹ï¼Œä½ ä»¬çŽ°åœ¨çš„æ–¹æ¡ˆæ˜¯å¦‚ä½•çš„ï¼Œèƒ½ä»‹ç»ä¸‹å—ï¼Ÿ

Aï¼šå¯ä»¥å‚è€ƒ Kubernetes ä¸­ Pod å¥åº·éƒ¨åˆ†ï¼š[kubernetes.io/docs](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/)ï¼Œåˆ©ç”¨æŽ¢é’ˆçš„æ–¹å¼ç›‘æŽ§è¿›ç¨‹ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 07 æœˆ 27 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æŽå¼ºï¼Œæœ‰å®¹äº‘åŽç«¯å¼€å‘å·¥ç¨‹å¸ˆã€‚æœ‰ç€å¤šå¹´çš„æœåŠ¡å™¨ã€ç½‘ç»œã€å®¹å™¨ã€è™šæ‹ŸåŒ–ç­‰äº‘è®¡ç®—æŠ€æœ¯ç›¸å…³å·¥ä½œç»éªŒï¼ŒçŽ°ä¸»è¦è´Ÿè´£ Kubernetes å®‰è£…ã€é›†ç¾¤ã€ç›‘æŽ§ç­‰ç›¸å…³çš„åŽå°ç ”å‘å·¥ä½œ**ã€‚

---

### 2017-08-09ï¼šKubernetes å¥åº·æ£€æŸ¥ç­–ç•¥

> Qï¼šè¯·é—® Pod çš„çŠ¶æ€æ˜¯ crashbackoff é™¤äº†ä¸‹è½½é•œåƒå¤±è´¥æœ‰å“ªäº›å¯èƒ½ï¼Ÿä¸‹è½½çš„é•œåƒèƒ½å¦æŒ‡å®š registryï¼Ÿ pod å¦‚æžœæœ‰ä¸€ä¸ªå®¹å™¨æ˜¯ exit 0ï¼Œé‚£æ˜¯å¦å°±æ˜¯æ‚¨ä¹‹å‰æåˆ°çš„ succeed?ä½¿ç”¨ livenessProbe æ£€æµ‹å¤±è´¥çš„æ˜¯ failed è¿˜æ˜¯ crashbackoffï¼Ÿ

Aï¼šCrashbackoff å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å¤±è´¥ï¼Œæ¯”å¦‚ tomcat å¯åŠ¨å¤±è´¥äº†ï¼Œåˆå­¦è€…æ¯”è¾ƒå®¹å™¨çŠ¯çš„é”™è¯¯æ˜¯ CMD çš„å‘½ä»¤æ˜¯ä¸€ä¸ªéžé˜»å¡žå‘½ä»¤ï¼Œè¿™æ ·å®¹å™¨ä¸€è¿è¡Œå°±é©¬ä¸Šé€€å‡ºäº†ã€‚ä¸‹è½½çš„é•œåƒå¯ä»¥æŒ‡å®š registryï¼Œæ ¹æ®é•œåƒçš„å‘½ä»¤æ¥çš„ï¼Œæ¯”å¦‚ test.registry.com/image:versionã€‚å®¹å™¨ exit 0 äº†ï¼Œå¾—æ ¹æ®é‡å¯ç­–ç•¥æ¥åˆ¤æ–­ã€‚è€Œ livenessProbe æ£€æµ‹æ˜¯ä¸šåŠ¡å±‚é¢çš„æ£€æµ‹ã€‚

> Qï¼šè¯·é—® readinessProbe æ£€æµ‹å¤±è´¥åŽï¼Œæ˜¯æ‰‹åŠ¨ Scale æ·»åŠ  Pod ç¡®ä¿ä¸šåŠ¡ç¨³å®šè¿˜æ˜¯å¯ä»¥åœ¨ ReplicationController çš„ yaml é‡Œé¢å®šä¹‰ï¼Ÿ

Aï¼šè¿™éƒ¨åˆ† Kubernetes å¹¶ä¸æ”¯æŒï¼Œæ˜¯æˆ‘ä»¬è‡ªå·±å‡†å¤‡å¼€å‘çš„åŠŸèƒ½ã€‚å°±æ˜¯å‘çŽ° Pod NotReady åŽï¼Œä¸€æ¥ä¿ç•™é—®é¢˜å®¹å™¨ï¼ŒäºŒæ¥æ–°å¢žä¸€ä¸ª Pod é¡¶æ›¿ã€‚

> Qï¼šè¯·é—® Supervisord æ˜¯æ‰‹åŠ¨åœ¨ Pod é‡Œé¢çš„å®¹å™¨é‡Œé¢æ·»åŠ ä¹ˆï¼Ÿè¿˜æ˜¯æœ‰ä¸“é—¨çš„é•œåƒå·²ç»è‡ªå¸¦ï¼Ÿè°¢è°¢ï¼å®¹å™¨å‡ºé”™åŽæ”¶é›†çš„çŽ°åœºä¿¡æ¯éƒ½ä¿å­˜åœ¨å“ªé‡Œï¼Ÿ

Aï¼šSupervisord å°±å®‰è£…åˆ°å®¹å™¨é‡Œé¢å°±è¡Œäº†ï¼Œæ¯”å¦‚æˆ‘ä»¬æ˜¯ CentOS åŸºç¡€é•œåƒï¼Œç„¶åŽ yum install å³å¯ã€‚å½“è¿›ç¨‹å¼‚å¸¸çš„æ—¶å€™ï¼ŒSupervisord å¯ä»¥é‡å¯è¿›ç¨‹å¹¶ä¸”ä¿è¯å®¹å™¨ä¸ä¼šé€€å‡ºï¼Œè¿™æ ·ä¸€æ¥å°±å¯ä»¥ç™»å½•åˆ°å®¹å™¨é‡Œé¢æŽ’æŸ¥é—®é¢˜ï¼Œä¿¡æ¯çš„è¯æ ¹æ®ç»„ä»¶çš„æƒ…å†µæ¥å®šäº†ã€‚

> Qï¼šè¯·é—®ï¼Œå¦‚æžœä¸€ä¸ª deployment æœ‰ä¸‰ä¸ªå‰¯æœ¬ï¼Œåˆ†åˆ«éƒ¨ç½²å†ä¸‰ä¸ª Node ä¸Šï¼Œå½“å…¶ä¸­ä¸€ä¸ª Node å®•æœºäº†ï¼Œè¿™æ—¶å€™å¯¹åº”çš„ service ä¸­çš„ endpoint æ›´æ–°éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œç”¨æˆ·åœ¨è¿™ä¸ªæ—¶é—´æ®µè®¿é—®å°±ä¼šæœ‰ 1/3 çš„é”™è¯¯å¯èƒ½ï¼Œè¿™ç§æƒ…å†µæ€Žä¹ˆåŠžï¼Ÿ

Aï¼šå½“ Pod å¼‚å¸¸çš„æ—¶å€™ï¼Œæ¯”å¦‚æ˜¯ NotReadyï¼ŒService çš„ endpoint äº†é©¬ä¸Šå°±ä¼šå‰”é™¤è¿™ä¸ª Pod äº†ã€‚Kubernetes çš„å®žçŽ°éƒ½æ˜¯å®žæ—¶ watch çš„ã€‚

> Qï¼šä¿ç•™å®¹å™¨çŽ°åœºå¦‚æžœé€ æˆå¤šä¸ªåƒµå°¸å®¹å™¨æ€Žä¹ˆåŠžï¼Ÿ

Aï¼šå½“ Pod NotReady çš„æ—¶å€™ï¼Œæ–°å»º Pod é¡¶æ›¿ï¼Œæ–°å»ºçš„ Pod ä¹Ÿå¼‚å¸¸çš„è¯ï¼Œå°±ä¸èƒ½ä¸€ç›´é‡å»ºã€‚ç„¶åŽå®šä½å®ŒæˆåŽï¼Œåªèƒ½æ‰‹åŠ¨åŽ»æ¸…ç† Pod äº†ã€‚

> Qï¼šç”¨ Supervisor æ¥å¯åŠ¨æœåŠ¡ï¼Œåº”ç”¨çš„æ—¥å¿—æ˜¯æ‰“åˆ°æŒ‡å®šçš„ç›®å½•çš„è¿˜æ˜¯ç›´æŽ¥ std è¾“å‡ºç„¶åŽå†å¤„ç†çš„å•Šï¼Ÿ

Aï¼šåº”ç”¨çš„æ—¥å¿—æ‰“å°åˆ°æ–‡ä»¶å¤„ç†ã€‚Stdout è¢« Supervisor å ç”¨äº†

> Q:ä¸€ä¸ªå®¹å™¨é‡Œé¢æŽ¨èåªè·‘ä¸€ä¸ªè¿›ç¨‹ï¼Œå¯¹äºŽé‡åˆ°ä¸€ä¸ªé¡¹ç›®è¦è·‘å¤šä¸ªæœåŠ¡çš„æƒ…å†µï¼Œæ˜¯æ¯ä¸ªæœåŠ¡éƒ½å•ç‹¬ç”Ÿæˆä¸€ä¸ªå®¹å™¨å—ï¼Ÿå¦‚æžœæ˜¯è¿™æ ·çš„è¯ä»£ç æ˜¯æ€Žä¹ˆç®¡ç†çš„ï¼Ÿæ¯ä¸ªæœåŠ¡ä¸€ä¸ªåˆ†æ”¯å—ï¼Ÿè€Œä¸”å¾€å¾€å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§æ˜¯ä¸åŒçš„åˆ†æ”¯ï¼Œè¿™æ ·æœåŠ¡å¤šäº†çš„è¯å¯¹äºŽä»£ç ç®¡ç†å¾ˆéº»çƒ¦ï¼Œå¦‚æžœä¸€ä¸ªå®¹å™¨é‡Œé¢ç”¨ Supervisor æ¥è·‘å¤šä¸ªè¿›ç¨‹çš„è¯ç†è®ºä¸Šå¯ä»¥ï¼Œä½†æ˜¯æ˜¾ç„¶åšæ³•ä¸å¥½ã€‚

Aï¼šæ¯ä¸ªæœåŠ¡å¯ä»¥åšæˆä¸€ä¸ªå®¹å™¨ã€‚é‚£è¿™ä¸ªæ˜¯ç®¡ç†çš„æˆæœ¬äº†ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›å·¥å…·å’Œè„šæœ¬æ¥è‡ªåŠ¨åŒ–ã€‚è‡³äºŽè¦ä¸è¦è·‘å¤šè¿›ç¨‹ï¼Œçœ‹å®žé™…åœºæ™¯ï¼Œéƒ½æ˜¯å¯ä»¥çš„ï¼Œå…¶å®žåªè¦ä¿è¯ Pod æä¾›çš„ä¸šåŠ¡æ˜¯æ­£å¸¸çš„å³å¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ Probe æ¥å¯¹ä¸šåŠ¡æ£€æŸ¥ï¼Œ

> Qï¼šè¯·é—® Kubernetes çš„åº”ç”¨çš„æ—¥å¿—æ˜¯æ€Žä¹ˆç®¡ç†çš„ï¼Œç”¨çš„ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿè¿˜æ˜¯å…¶ä»–çš„æ–¹å¼ï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯è¦æ±‚åº”ç”¨çš„æ—¥å¿—å…¨éƒ¨è¾“å‡ºåˆ°æŒ‡å®šç›®å½•ï¼Œæ¯”å¦‚/var/logã€‚ç„¶åŽæˆ‘ä»¬é’ˆå¯¹å®¹å™¨é‡Œé¢çš„æ—¥å¿—ç›®å½•ç»Ÿä¸€æŒ‚è½½åˆ° Ceph å­˜å‚¨ã€‚

> Qï¼šæ˜¯å¦å¯ä»¥é€šè¿‡ preStop å…ƒç´ åœ¨ pod failed è¢«ç§»é™¤å‰æ‰§è¡Œä¸€äº›æ”¶é›†çŽ°åœºä¿¡æ¯çš„å‘½ä»¤ï¼Ÿ

Aï¼šä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯å¤§éƒ¨åˆ†äººå®šä½é—®é¢˜è¿˜æ˜¯å¸Œæœ›èƒ½å¤Ÿç™»å½•åˆ°å®¹å™¨é‡Œé¢å®šä½ï¼Œè¿™æ ·æ˜¯æœ€å¿«æœ€æ–¹ä¾¿çš„æ–¹å¼ã€‚

> Qï¼šSupervisor çš„æ–¹å¼æ‰“ä¹±äº† Kubernetes åŽŸæ¥çš„å®¹å™¨é‡å¯æ–¹å¼ï¼Œå¯èƒ½ä¼šå¸¦æ¥æ›´å¤§çš„é—®é¢˜ã€‚ä¸å¦‚è€ƒè™‘åœ¨ Kubernetes çš„åŸºç¡€ä¸Šä¿®æ”¹å¢žå¼ºã€‚

Aï¼šæ˜¯ä¸ªé—®é¢˜ã€‚å¯ä»¥è¯´ Supervisor å°±è¦†ç›–äº† Kubernetes çš„é‡å¯æ–¹å¼ï¼Œä½†æ˜¯ä¸€æ–¹é¢ Supervisor çš„é‡å¯æ–¹å¼æ›´åŠ çµæ´»ï¼Œå¦ä¸€æ–¹é¢ä¿®æ”¹ Kubernetes çš„è¯ä¾µå…¥æ€§æ¯”è¾ƒå¤§ã€‚æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©ç”¨ Supervisorã€‚

> Qï¼šä½ ä»¬çš„åº”ç”¨æ—¥å¿—ç»Ÿä¸€æŒ‚è½½å­˜å‚¨çš„è¯ï¼Œå­˜å‚¨ä¸Šæ˜¯ä¸ºæ¯ä¸ªå®¹å™¨æ–°å»ºä¸€ä¸ªç›®å½•å—ï¼Ÿ

Aï¼šè¿™éƒ¨é—¨æˆ‘ä»¬æ˜¯ä¿®æ”¹äº† Kubernetes çš„ä»£ç ï¼Œä¸ºæ¯ä¸ª pod åœ¨å®¿ä¸»æœºåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç„¶åŽå®¿ä¸»æœºçš„è¿™ä¸ªç›®å½•æ˜¯æŒ‚è½½ Cephfs çš„ã€‚

> Qï¼šå‡å¦‚ APP ä¸èƒ½æ­£å¸¸è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼ˆè¿žä¸ä¸Šæ•°æ®ç­‰åŽŸå› ï¼‰ï¼Œè€Œ health check ä¾ç„¶æ­£å¸¸è¿”å›žã€‚æ€Žä¹ˆåŠžï¼Ÿä½ ä»¬ä¼šå¼ºåˆ¶è¦æ±‚å¼€å‘å¯¹ APP çš„çŠ¶æ€è¿›è¡Œç®¡ç†ï¼Œåœ¨ health check é‡Œè¿”å›žå—ï¼Ÿ

Aï¼šè¿™æ˜¯ä¸ªå¥½é—®é¢˜ã€‚æˆ‘ä»¬ä¼šå°½é‡è¦æ±‚åº”ç”¨æä¾›çš„ health æŽ¥å£å°½é‡å‡†ç¡®ï¼Œä½†æ˜¯è¿™ä¹Ÿå¾ˆéš¾ä¿è¯ 100% çš„ä¸šåŠ¡æ­£å¸¸ï¼Œæ‰€ä»¥ç›®å‰å°±æ˜¯éœ€è¦æƒè¡¡ï¼Œè¿™éƒ¨é—¨æˆ‘ä»¬ä¹Ÿåœ¨ç»†åŒ–ä¸­ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 08 æœˆ 08 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**å´é¾™è¾‰ï¼Œç½‘å®¿ç§‘æŠ€äº‘è®¡ç®—æž¶æž„å¸ˆï¼Œè´Ÿè´£è®¾è®¡å¼€å‘ PaaS å¹³å°ï¼Œã€ŠKubernetes å®žæˆ˜ã€‹ä½œè€…**ã€‚

---

### 2017-08-06ï¼šæ±‚å–ä¸€ä»½æžè‡´çš„ç®€å•ï¼šæµ·é‡åº”ç”¨å®¹å™¨åŒ–æ”¹é€ ä¹‹è·¯

> Qï¼šæž„å»ºé•œåƒç”¨çš„ä»€ä¹ˆæŠ€æœ¯ï¼Ÿ

Aï¼šæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Docker è‡ªèº«æä¾›çš„ docker build å‘½ä»¤è¿›è¡Œé•œåƒæž„å»ºçš„ã€‚

> Qï¼šConfig Center èƒ½å¦è¯¦ç»†è¯´ä¸€ä¸‹ï¼Ÿ

Aï¼šæˆ‘ä»¬ä½¿ç”¨ Config Center ä¸»è¦æ¥ç®¡ç†åº”ç”¨è‡ªèº«çš„é…ç½®æ–‡ä»¶ï¼Œåº”è¯¥åœ¨å¯åŠ¨å‰é¦–å…ˆæ‹½ä¸‹è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼›è¿˜æœ‰å°±æ˜¯å¯¹åº”ç”¨è¿›è¡Œ Leader æŽ§åˆ¶ï¼Œå› ä¸ºåº”ç”¨å¯èƒ½ä¼šè·‘å¤šä¸ªå®žä¾‹çš„ï¼Œåƒå®šæ—¶ä»»åŠ¡ç±»çš„åŠŸèƒ½ï¼Œåœ¨åŒä¸€ä¸ªæ—¶é—´ç‚¹åªèƒ½å…¶ä¸­ä¸€ä¸ªå®žä¾‹ç”Ÿæ•ˆã€‚

> Qï¼š å¦‚ä½•åŠ¨æ€ç”Ÿæˆ Dockerfileï¼Œå¦‚ä½•åœ¨ Docker é•œåƒé‡Œé…ç½® JVM å‚æ•°ï¼Ÿ

Aï¼šDockerfile æ–‡ä»¶ï¼šæˆ‘ä»¬æ˜¯ä½¿ç”¨ sh è„šæœ¬ç”Ÿæˆçš„ï¼Œå°†å†…å®¹ >> Dockerfile ä¸­ï¼›JVM å‚æ•°æ˜¯åœ¨åº”ç”¨ä¸­é…ç½®çš„ï¼Œå‘é€æž„å»ºæ¶ˆæ¯æ—¶ï¼Œä½œä¸ºæ¶ˆæ¯å†…å®¹é€è¿‡åŽ»ã€‚

> Qï¼š Deployment æ»šåŠ¨æ›´æ–°å¦‚ä½•è®¾ç½®é—´éš”æ—¶é—´å‘¢ï¼Ÿ

Aï¼šDeployment å¯¹è±¡æœ‰ä¸ª minReadySeconds å±žæ€§å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚

> Qï¼š Logstash çš„æ—¥å¿—ä¸ºå•¥æ˜¯å‘é€åˆ° HDFS è€Œä¸æ˜¯ ESï¼Ÿæœ‰ä»€ä¹ˆè€ƒè™‘ä¹ˆï¼Ÿ

Aï¼šæˆ‘ä»¬å°† Logstash é‡‡é›†åˆ°çš„æ—¥å¿—è¾“å‡ºåˆ°ä¸¤ä¸ªåœ°æ–¹ï¼šESã€HDFSï¼Œè¾“å‡ºåˆ° ES ç›´æŽ¥åœ¨ Kibana ä¸Šæœç´¢åˆ°ï¼Œè€Œè¾“å‡ºåˆ° HDFS ä¾¿äºŽåœ¨ Kibana ä¸Šé¢å°†æ—¥å¿—æ–‡ä»¶è¿›è¡Œä¸‹è½½ä¸‹æ¥ã€‚

> Qï¼šDocker Registry çš„åœ¨ garbage collect æ—¶æ€Žä¹ˆä¿è¯é«˜å¯ç”¨ï¼Ÿ

Aï¼šæˆ‘ä»¬ä½¿ç”¨çš„ç”± VMware å…¬å¸ä¸­å›½å›¢é˜Ÿå¼€æºçš„ Harborï¼Œæ— è®ºå®‰å…¨ã€æ•ˆçŽ‡ã€å¯ç”¨æ€§æ–¹é¢éƒ½æä¾›äº†å¾ˆå¼ºçš„ä¿éšœäº†ã€‚

> Qï¼škubectl set image çš„æ—¶å€™ èƒ½ä¸èƒ½é™åˆ¶æ¯å˜æ›´ä¸€ä¸ªå®¹å™¨ï¼Œå†ä¿è¯ http è®¿é—®æ­£å¸¸çš„å‰æä¸‹ï¼Œå†å˜æ›´ä¸‹ä¸€ä¸ªå®¹å™¨ã€‚æ¯•ç«Ÿæœ‰çš„æœåŠ¡å¯åŠ¨æ—¶é—´è¶…è¿‡ 30 ç§’ï¼Œå¯¹å¤–çš„æœåŠ¡å¿å—ä¸äº†ä¿¡ä¹ˆä¹…çš„ä¸å¯è®¿é—®æ—¶é—´çš„ï¼Ÿ

Aï¼šè¿™ä¸ªå¯ä»¥ç›´æŽ¥å€ŸåŠ© Kubernetes çš„ RollingUpdate åŠŸèƒ½å°±å¯ä»¥åšäº†ã€‚

> Qï¼šDockerfile åŠ¨æ€ç”Ÿæˆæ€Žä¹ˆåšçš„ï¼Œç”¨çš„æ˜¯ä»€ä¹ˆç”Ÿæˆå·¥å…·ï¼Ÿ

Aï¼šä½¿ç”¨ sh è„šæœ¬ç”Ÿæˆ,å°†å†…å®¹ >> Dockerfile ä¸­åŽ»å¯ä»¥äº†ã€‚

> Qï¼šç»Ÿä¸€çš„æµç¨‹ç»™å®žé™…çš„ç”Ÿäº§å¸¦æ¥äº†æ€Žæ ·çš„å¥½å¤„èƒ½å¦ä»‹ç»ä¸€ä¸‹ï¼Ÿ

Aï¼šæµç¨‹ç»Ÿä¸€åŽï¼Œåƒæºç ç®¡ç†ã€æ—¥å¿—é‡‡é›†åŠæœç´¢ã€åº”ç”¨å‘å¸ƒï¼Œåº”ç”¨æ»šåŠ¨å‡çº§ç­‰å°±ä¸éœ€è¦åº”ç”¨æœ¬èº«æ¥ç®¡äº†ï¼Œè¿™æ ·å„ä¸šåŠ¡ç³»ç»Ÿæœ¬èº«å°±ä¼šæ›´åŠ ä¸“æ³¨äºŽè‡ªèº«çš„ä¸šåŠ¡åŠŸèƒ½äº†ã€‚

---

### 2017-08-02ï¼šå›½å†…æŸå¤§åž‹é…’åº—ç®¡ç†é›†å›¢åŸºäºŽ Kubernetes çš„å®žè·µ

> Qï¼šå®¹å™¨çš„æ—¥å¿—æ€Žä¹ˆç®¡ç†å‘¢ï¼Ÿä¸åŒåº”ç”¨çš„æ—¥å¿—æ€Žä¹ˆç®¡ç†ï¼Ÿ

Aï¼šæˆ‘ä»¬åœ¨å®¹å™¨åŒ–ä¹‹å‰å·²ç»å¼€å§‹ä½¿ç”¨ ELK çš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥æˆ‘ä»¬æ•´ä¸ªå®¹å™¨åŒ–å¹³å°çš„æ”¹é€ ä¸­ä¹Ÿæ•´åˆäº† ELK çš„æ–¹æ¡ˆã€‚ 1.  Docker å¯åŠ¨çš„æ—¶å€™ mount ä¸€ä¸ªå…±äº«å­˜å‚¨ï¼Œæ—¥å¿—éƒ½å†™åœ¨è¿™ä¸ªå…±äº«å­˜å‚¨é‡Œï¼Œç„¶åŽé…ç½® Logstach é‡‡é›†ï¼Œæœ€åŽååˆ° ES é‡Œï¼Œç”¨ kibana å±•ç¤ºï¼Œç¼ºç‚¹æ˜¯æŒ‚å…±äº«å­˜å‚¨ï¼Œæ€§èƒ½ç•¥å·®ã€‚ä¼˜ç‚¹æ˜¯æ—¥å¿—å¯ä»¥æ ¹æ®åº”ç”¨æ¥åˆ†åˆ°ä¸åŒçš„ ELK ä¸Šï¼Œå¹¶ä¸”æ—¥å¿—åšå½’æ¡£æ¯”è¾ƒå®¹æ˜“ï¼Œæˆ‘ä»¬æœ‰åœºæ™¯è¦æŸ¥ä¸€å¹´å‰çš„æ—¥å¿—ã€‚ 2.  æˆ‘ä»¬åœ¨ Kubernetes èŠ‚ç‚¹ä¸Šå®‰è£… fluentd ç»„ä»¶ï¼Œé‡‡é›† Kubernetes     node ä¸Šçš„æ—¥å¿—ï¼Œåº”ç”¨éƒ¨åˆ†åªéœ€è¦åœ¨ log4j çš„é…ç½®é‡Œå°†æ—¥å¿—è¾“å‡ºæ‰“åˆ°æ ‡å‡†è¾“å‡ºä¸Šç³»ç»Ÿå³å¯é‡‡é›†ï¼Œç¼ºç‚¹æ˜¯è¿™ä¸ªé›†ç¾¤çš„æ—¥å¿—ä¼šå…¨éƒ¨èšåˆåˆ°ä¸€å¥— ELK ä¸Šã€‚ä¼˜ç‚¹æ˜¯åº”ç”¨å‡ ä¹Žæ— éœ€åšä»€ä¹ˆæ”¹é€ ã€‚

> Qï¼šå®¹å™¨ä¸­éœ€è¦æŒä¹…åŒ–çš„æ•°æ®æ€Žä¹ˆå¤„ç†ï¼Ÿ

Aï¼šåŽŸåˆ™ä¸Šæˆ‘ä»¬ä¸å»ºè®®åœ¨å®¹å™¨åŒ–å¹³å°ä¸Šçš„åº”ç”¨æœ‰æŒä¹…åŒ–æ•°æ® ï¼Œå¦‚æžœäº’è”ç½‘åº”ç”¨çš„èƒŒæ™¯ï¼Œåº”ç”¨æ— çŠ¶æ€åŒ–è®¾è®¡å¯¹äºŽåº”ç”¨æœ‰æ¨ªå‘æ‰©å±•éœ€æ±‚æ˜¯æ›´åŠ é€‚åˆçš„ï¼Œåº”ç”¨åœ¨ä¸Šå®¹å™¨äº‘å¹³å°å‰è¦å®Œæˆè¿™éƒ¨åˆ†æ”¹é€ ã€‚ä½†æ˜¯æˆ‘ä»¬çš„ç¡®æœ‰åšè¿‡æ•°æ®æŒä¹…åŒ–çš„ç ”ç©¶ï¼Œå½“æ—¶ä¸»è¦è€ƒè™‘ ES é›†ç¾¤ä¼šæœ‰æŒä¹…åŒ–æ•°æ®ï¼Œæˆ‘ä»¬çš„æ–¹æ¡ˆæ˜¯ Kubernetes+GlusterFS çš„æ–¹æ¡ˆã€‚ä½†æ˜¯ç”±äºŽ ES é›†ç¾¤æœ¬èº«å¾ˆç¨³å®šï¼Œä¹Ÿä¸ä¼šæœ‰å‘å¸ƒï¼Œå®¹å™¨åŒ–æ„ä¹‰å¹¶ä¸å¤§ï¼Œæ‰€ä»¥æš‚æ—¶æˆ‘ä»¬è¿™éƒ¨åˆ†ä»ä¿ç•™åœ¨ VM ä¸Šã€‚

> Qï¼šè¯·æ•™ä¸‹ï¼Œå¦‚æžœå¼€å‘æœºåœ¨æœ¬åœ°ï¼Œå¦‚ä½•è¿žåˆ°æµ‹è¯•çŽ¯å¢ƒï¼ˆè”è°ƒçŽ¯å¢ƒï¼‰ä¸ŠåŽ»ï¼Œä½ ä»¬çš„ç½‘ç»œå¦‚ä½•æ‰“é€šï¼Ÿ

Aï¼šæˆ‘ä»¬ä¸å»ºè®®å¼€å‘ä½¿ç”¨æœ¬åœ°èµ„æºè¿›è¡Œå¼€å‘ï¼Œæˆ‘ä»¬æä¾›æ•´å¥—çš„ QA çŽ¯å¢ƒï¼ˆéƒ½åœ¨ Kubernetes ä¸Šï¼‰ã€‚ å¦‚æžœå®žåœ¨è¦ç™»å½•åˆ° Node ä¸Šçœ‹ä¸€äº›ä¸œè¥¿ï¼Œæˆ‘ä»¬æœ‰å ¡åž’æœºã€‚

> Qï¼šDocker ç½‘ç»œç”¨çš„ä»€ä¹ˆæ–¹æ¡ˆï¼Ÿ

Aï¼šFlannelï¼Œèƒ½ç”¨ï¼Œæ€§èƒ½ä¸å¤ªå¥½ï¼Œå‡†å¤‡è¿­ä»£æŽ‰å®ƒã€‚è¿™æ˜¯å‘ï¼å¤§å®¶ä¸è¦è¸©ã€‚

> Qï¼šæœåŠ¡å¯¹å¤–æš´éœ²æ˜¯ç”¨ä»€ä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šé›†ç¾¤å†…éƒ¨è®¿é—®ä¹‹å‰è¯´äº†ï¼ŒæœåŠ¡åçš„æ–¹å¼ï¼Œé›†ç¾¤å¤–çš„è®¿é—®ï¼ŒKubernetes æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æä¾›æœåŠ¡ã€‚ä½†æ˜¯å¦‚æžœæ‰€æœ‰è¯·æ±‚éƒ½è½åœ¨ä¸€ä¸ª Kubernetes èŠ‚ç‚¹ä¸Šï¼Œè¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªå•ç‚¹ã€‚ æ‰€ä»¥æˆ‘ä»¬æä¾›å¯¹å¤–æœåŠ¡æ—¶ä»ç„¶ä¼šåœ¨ node å‰é¢åŠ ä¸€å±‚ loadbalanceï¼ŒLB åŽé¢å°† 5-10 ä¸ª Kubernetes çš„èŠ‚ç‚¹ä½œä¸º backend æ·»åŠ ä¸ŠåŽ»ã€‚å¦å¤–è¿™éƒ¨åˆ†èŠ‚ç‚¹æœ€å¥½ä¸è¦è°ƒåº¦ä»»åŠ¡åœ¨ä¸Šé¢è·‘ã€‚

> Qï¼šä½ ä»¬çš„ Docker å®¹å™¨åœ¨ Windows ä¸Šæ˜¯æ€Žä¹ˆè§£å†³ IP é€šä¿¡çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¸ç”¨ Windows çš„ Dockerï¼ŒDocker æ˜¯è¿›ç¨‹å…±äº«çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ŒWindows å’Œ Linux å…±äº«å“ªé—¨å­è¿›ç¨‹ï¼Ÿæ„Ÿè§‰ä¸å¤ªé è°±ï¼Œæ‰€ä»¥ä¸ç”¨ã€‚ï¼ˆæ¯”è¾ƒä¸»è§‚ï¼‰ å¾®è½¯è‡ªå·±ä¹Ÿåœ¨æžç±»ä¼¼ Docker+Kubernetes çš„æž¶æž„çš„ä¸€å¥—ä¸œè¥¿ï¼Œå¤§å®¶å¯ä»¥å…³æ³¨ä¸€ä¸‹ï¼Œå¦‚æžœè¦ä¸Š Windows çš„ Docker é‚£è¿˜æ˜¯ç”¨ MS çš„è§£å†³æ–¹æ¡ˆæ¯”è¾ƒé è°±ã€‚

> Qï¼šä½ ä»¬çš„å®¿ä¸»æœºã€å®¹å™¨ã€æœåŠ¡çš„ç›‘æŽ§å‘Šè­¦ç³»ç»Ÿæž¶æž„æ˜¯æ€Žæ ·çš„ï¼Œèƒ½ç®€å•ä»‹ç»ä¸‹å—ï¼Ÿ

Aï¼šå®¿ä¸»æœºæˆ‘ä»¬è¿˜æ˜¯ç”¨ Zabbixï¼ŒæœåŠ¡çš„å¯ç”¨æ€§æˆ‘ä»¬ä¹Ÿç”¨ Zabbixï¼ˆè¿™æ˜¯å®¹å™¨åŒ–ä¹‹å‰å°±ä¿ç•™ä¸‹æ¥çš„ï¼‰ä½†æ˜¯åªæœ‰å½“æ‰€æœ‰ pod éƒ½æŒ‚æŽ‰æ‰ä¼šæŠ¥è­¦ï¼Œå®¹å™¨çš„ç›‘æŽ§æˆ‘ä»¬æ˜¯ä½¿ç”¨ Prometheus å’Œ Grafanaã€‚

> Qï¼šå››ä¸ªçŽ¯å¢ƒçš„å‘å¸ƒæƒé™ä½ ä»¬æ€Žä¹ˆåŽ»åˆç†é…ç½®å‘¢ï¼Ÿ

Aï¼šåŽŸåˆ™ä¸Šç”¨æˆ·ç™»å½•æ‰€æœ‰çŽ¯å¢ƒéƒ½éœ€è¦é€šè¿‡å ¡åž’æœºï¼Œ4 ä¸ªçŽ¯å¢ƒçš„å‘å¸ƒï¼Œéƒ½æ˜¯é€šè¿‡ Jenkins æ¥å®žçŽ°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šæŽ§åˆ¶ Jenkins ä¸Šå¯¹åº”çš„ Pipline çš„æƒé™ã€‚ï¼ˆGit->Jenkins->Kubernetesï¼‰è¿™ä¸€æ®µæ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œå¼€å‘äººå‘˜èƒ½åšçš„å°±æ˜¯è§¦å‘æž„å»ºä»»åŠ¡ã€‚ å¦‚æœ‰ç‰¹æ®Šçš„éœ€æ±‚ï¼Œéœ€è¦è®©è¿ç»´äººå‘˜æ“ä½œã€‚

> Qï¼šå¦‚æžœæœ‰å¼€å‘äººå‘˜éœ€è¦ä¸ŠåŽ»çœ‹é”™è¯¯æ—¥å¿—ï¼Œå‡è®¾è¿™ç§é”™è¯¯æ—¥å¿—æ˜¯éœ€è¦è°ƒè¯•ï¼Œä¸ä¼šè¢«æ”¶é›†ï¼Œæ˜¯åªèƒ½é€šè¿‡å ¡åž’æœºåŽ»çœ‹å—ï¼Ÿå®¹å™¨çš„æ—¥å¿—æ€Žä¹ˆè¿›è¡Œå­˜å‚¨ï¼Œå¦‚æžœæŒ‚åˆ°å®¿ä¸»æœºç›®å½•é‚£å¥½å¤šå®¹å™¨æ€Žä¹ˆåˆ†æ–‡ä»¶å¤¹å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬æ–¹æ¡ˆé‡Œ fluentd å¯ä»¥æ”¶é›† node ä¸Šå‡ ä¹Žæ‰€æœ‰çš„æ—¥å¿—ï¼Œå¦å¤–å…³äºŽé”™è¯¯è°ƒè¯•æ—¥å¿—ï¼Œå¦‚æžœæ˜¯åº”ç”¨çš„ï¼Œé‚£å¼€å‘äººå‘˜æŒ‰ç…§éœ€æ±‚è°ƒæ•´è¾“å‡ºè·¯å¾„å°±å¥½äº†ï¼Œç”¨ ELK é‡‡é›†å°±å¥½äº†ã€‚å¦‚æžœæ˜¯ç³»ç»Ÿçº§åˆ«çš„ï¼Œè¿ç»´äººå‘˜å°±æŠŠå®ƒä½œä¸ºä¸€ä¸ª Linux ä¸»æœºæŸ¥æ—¥å¿—æ‹é”™å°±å¥½äº†ã€‚ å¦å¤–å®¹å™¨çš„æ—¥å¿—ï¼Œè§£é‡Šèµ·æ¥æœ‰äº›é•¿ï¼Œä½ å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„å¸–å­ã€Š[Docker æ—¥å¿—é‚£ç‚¹äº‹](https://mp.weixin.qq.com/s?__biz=MzA4MjQ1NTgyOQ==&mid=300723383&idx=1&sn=2c31770da35b429b74ef0264bfb17201&chksm=0b9d70cd3ceaf9db43d7cb943533500a15ebe5463f8f06d3b13075b305c23dadfa725f91e19b&mpshare=1&scene=1&srcid=0725JDmSrXiXVBDLGj4A4yRe#rd)ã€‹ï¼Œå®¹å™¨æ—¥å¿—çš„ç›®å½•å’Œæ ¼å¼éƒ½æœ‰å†™åˆ°ã€‚

> Qï¼šç”¨çš„ Overlay ç½‘ç»œï¼Œé‚£ä½ ä»¬ç”¨çš„ NodePort æš´éœ²çš„æœåŠ¡ï¼Œç„¶åŽå¤–éƒ¨ LB è®¿é—® NodePortï¼Ÿé‚£ä½ ä»¬çŽ°åœ¨å®¹å™¨ä¸€ä¸ªé›†ç¾¤å†…æœ‰å¤šå°‘å®¹å™¨ï¼Ÿkube-proxy çš„æ€§èƒ½æœ‰åšè¿‡åŽ‹åŠ›æµ‹è¯•å—ï¼Ÿ

Aï¼šå›žç­”åŽé¢ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ¯ä¸ªçŽ¯å¢ƒéƒ½æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œä¾‹å¦‚ QA æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼ŒUAT æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œæˆ‘ä»¬ä¸€ä¸ªç”Ÿäº§é›†ç¾¤ç›®å‰å¤§æ¦‚ 1000+ ä¸ªå®¹å™¨ã€‚ å¦å¤–æˆ‘ä»¬åº”ç”¨ä¸Šçº¿å‰ä¼šåšåŽ‹åŠ›æµ‹è¯•ï¼Œç›®å‰æˆ‘ä»¬æ²¡é‡åˆ°è¿‡ kube-proxy è¢«åŽ‹æ­»çš„æƒ…å†µï¼Œå¤šæ˜¯æˆ‘ä»¬çš„åŽ‹åŠ›ä¸å¤Ÿï¼ˆæˆ‘ä»¬ä½¿ç”¨ JMeterï¼Œå¤§å¤šæ—¶å€™æ˜¯ JMeter æ­»æŽ‰ï¼‰ã€‚

> Qï¼šå„çŽ¯å¢ƒç”¨çš„æ˜¯åŒä¸€ä¸ª imagebuild ç”¨ env åŒºåˆ†ï¼Ÿè¿˜æ˜¯ä¸åŒ buildï¼Ÿæœ‰æ¯”è¾ƒè¿‡æˆ–é‡åˆ°ä»€ä¹ˆå‘å—ï¼Ÿ

Aï¼šå¼€å§‹çš„åˆ†äº«æåˆ°äº†ï¼Œä¸€ä¸ª image build ç”¨ env åŒºåˆ†ï¼Œå°±æ˜¯å‘ã€‚é…ç½®æ–‡ä»¶ç®¡ç†å˜æˆäº† env çš„ç®¡ç†ã€‚æ‰€ä»¥è€è€å®žå®žæ¯ä¸ªçŽ¯å¢ƒ build ä¸€ä¸ªé•œåƒã€‚

> Qï¼šå„çŽ¯å¢ƒçš„ config æ˜¯æ€Žæ ·å’Œä»€ä¹ˆæ—¶å€™æ‰“åˆ° image é‡Œçš„ï¼Ÿ

Aï¼šé…ç½®æ–‡ä»¶ä¸€èµ·æ”¾åœ¨ Git ä¸Šï¼ŒJenkins æ‹‰å®Œä»£ç å†æŠŠé…ç½®æ–‡ä»¶æ‹‰ä¸‹æ¥ï¼Œç®€å•ç‚¹ä½¿ç”¨ CP å‘½ä»¤æŠŠå¯¹åº”çš„é…ç½®æ–‡ä»¶å’Œ war æˆ–è€… jar ä»¥åŠ Dockerfile æ”¾åˆ°å¯¹åº”çš„ç›®å½•ä¸‹ï¼Œè¿›è¡Œ build å°±å¥½äº†ã€‚

---

### 2017-07-21ï¼šæ·±å…¥ç†è§£ Kubernetes ç½‘ç»œç­–ç•¥

> Qï¼šCalico å’Œ Weave ä»Ž Policy å¤„ç†æ€§èƒ½æ¥çœ‹ï¼Œä¸¤è€…å“ªä¸ªæ›´ä¼˜ï¼Ÿ

Aï¼šä¸¤è€…åœ¨ iptables å±‚é¢ä¸Šçš„å®žçŽ°åŽŸç†æ˜¯ä¸€æ ·çš„ã€‚éƒ½ç”¨äº† -m state å’Œ ipset ä¼˜åŒ–ï¼Œæ€§èƒ½å·®åˆ«ä¸å¤§ã€‚

> Qï¼šCalico ç»“åˆ Kubernetes æ€Žä¹ˆå®žçŽ°å¤šç§Ÿæˆ·ï¼Œæ¯”å¦‚ç½‘ç»œéš”ç¦»ä¹‹ç±»çš„ï¼Ÿ

Aï¼šå¯ä»¥è€ƒè™‘ç”¨ namespace æ¥éš”ç¦»ã€‚æ²¡æœ‰ Network Policy çš„æƒ…å†µä¸‹å½“ç„¶æ˜¯äº’é€šçš„ã€‚ä½†æ˜¯ Kubernetes çš„ Network Policy æ”¯æŒ namespaceSelectorï¼Œå¯ä»¥è½»æ¾æžå®šã€‚

> Qï¼šWeaveã€Calicoã€Flannel æ¯”è¾ƒï¼Œé€‚ç”¨åœºæ™¯å’Œä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼ŒFlannel out äº†ä¹ˆï¼Ÿ

Aï¼šå„æœ‰å„çš„å¸‚åœº :-)ã€‚ Flannel æ¯”è¾ƒç®€å•ï¼Œèµ„æºæ¶ˆè€—ä¹Ÿä¼šå°äº›ã€‚Flannel ä¸èƒ½ç®— out äº†ã€‚Cannel çš„å‡ºçŽ°å°† Flannel å’Œ Calico æ•´åˆäº†èµ·æ¥ã€‚

> Qï¼šNPC å¿…é¡»ç”¨ iptables å®žçŽ°å—ï¼Ÿåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒPod å‡ºå‘æµé‡å¹¶ä¸ä¼šç”±ä¸»æœºåè®®æ ˆï¼Œè¿™æ · iptables å°±ç”¨ä¸äº†ï¼Œè¿™ç§æƒ…å†µä¸‹ NPC æ€Žä¹ˆå®žçŽ°å‘¢ ï¼Ÿ

Aï¼šCalicoã€Weaveã€Romana çš„ NPC éƒ½æ˜¯é€šè¿‡ iptables å®žçŽ°çš„

---

### 2017-07-19ï¼š58 èµ¶é›†åŸºäºŽ Docker çš„è‡ªåŠ¨åŒ–éƒ¨ç½²å®žè·µ

> Qï¼šå¦‚ä½•æ›´æ–° nginx upstreamï¼Ÿ

Aï¼šNginx æœºå™¨ä¸Šéƒ¨ç½²æœ‰ Agentï¼ŒWeb ç±»çš„ä¸šåŠ¡æœ‰ç»Ÿä¸€çš„æ¡†æž¶ï¼ŒæœåŠ¡å¯åŠ¨æ—¶ä¼šå‘ Consul æ³¨å†Œã€‚Agent è®¢é˜… Consul ä¸­çš„èŠ‚ç‚¹æ•°æ®ï¼Œç„¶åŽé…åˆ nginx dyups æ¨¡å—ï¼ŒåŠ¨æ€ä¿®æ”¹ nginx upstreamã€‚

> Qï¼šæ‰“åŒ…å¥½é•œåƒåŽï¼Œä½¿ç”¨é•œåƒè¿˜ç”¨å†è¿›è¡Œé…ç½®å—ï¼Œå°±æ˜¯è¯´è¿˜ç”¨æ‰‹åŠ¨é…ç½®å—ï¼Ÿ

Aï¼šä¸ç”¨é…ç½®ï¼Œä¸åŒçŽ¯å¢ƒä¹‹é—´æµè½¬çš„æ˜¯åŒä¸€ä¸ªé•œåƒï¼ŒåŒ…å«äº†å„ä¸ªçŽ¯å¢ƒçš„æ‰€æœ‰é…ç½®ï¼Œé€šè¿‡å¯åŠ¨å®¹å™¨çš„çŽ¯å¢ƒå˜é‡æ¥è¯†åˆ«åˆ‡æ¢ã€‚

> Qï¼šDocker çš„æ­£ç¡®çš„ä½¿ç”¨å§¿åŠ¿ï¼Œåœ¨æœ¬åœ°çŽ¯å¢ƒå·²ç»æž„å»ºäº†ä¼ä¸šç§æœ‰ Registry Harborï¼Œé‚£ä¹ˆæˆ‘è¦æž„å»ºåŸºäºŽä¸šåŠ¡çš„åº”ç”¨æ—¶ï¼Œæ˜¯å…ˆä»Ž Linux ç³»åˆ—çš„åƒ Ubuntu æˆ– CentOS çš„ Base çš„ Docker é•œåƒå¼€å§‹ï¼Œç„¶åŽé€šè¿‡ Dockerfile å®šåˆ¶ä¸šåŠ¡éœ€æ±‚ï¼Œæ¥ä½¿ç”¨å—ï¼Ÿ

Aï¼šæˆ‘ä»¬åŸºç¡€é•œåƒç»Ÿä¸€é‡‡ç”¨ CentOS 6.8ï¼Œä¸åŒçš„ä¸šåŠ¡æœ‰ä¸åŒçš„ Dockerfile æ¨¡æ¿ï¼Œç”Ÿæˆé•œåƒçš„è¿‡ç¨‹ä¸šåŠ¡å¯¹ Dockerfile æ˜¯é€æ˜Žçš„ã€‚

> Qï¼šè¿™é‡Œå®žçŽ°ç°åº¦å‘å¸ƒäº†å—ï¼Ÿèƒ½å¦ä¸åœäº¤æ˜“æ›´æ–°ï¼Ÿ

Aï¼šå®žçŽ°äº† PV ç°åº¦ï¼Œæš‚æ—¶æ²¡å®žçŽ° UV ç°åº¦ï¼Œå¯¹äºŽæ— çŠ¶æ€çš„ä¸šåŠ¡å·²ç»èƒ½æ»¡è¶³éœ€æ±‚äº†ï¼Œå¯¹äºŽæœ‰çŠ¶æ€çš„ä¸šåŠ¡ï¼Œæ¯”å¦‚äº¤æ˜“ç±»åž‹çš„ä¸»è¦è¿˜æ˜¯éœ€è¦ç¨‹åºæž¶æž„æ¥å®žçŽ°ã€‚

> Qï¼šè¯·é—®å¦‚ä½•ä¿è¯ NGINX çš„é«˜å¯ç”¨ï¼Ÿ

Aï¼šåŸŸå->CNAMEï¼ˆå¿«é€Ÿåˆ‡æ¢ IP è§£æžï¼‰->LVSï¼ˆå¤šä¸ª ripï¼‰-> å¤šä¸ª NGINX å®žä¾‹ï¼ˆå¹³è¡Œå®žä¾‹ï¼‰ï¼›NGINX åŒæ—¶å’Œ LVS ä¿æŒå¿ƒè·³æ¥è‡ªåŠ¨è¸¢æŽ‰æ•…éšœçš„å®žä¾‹ã€‚

---

### 2017-07-13ï¼šJuice---ä¸€ç§åŸºäºŽ MesosFramework çš„ä»»åŠ¡äº‘æ¡†æž¶

> Qï¼šJuice ä¸Ž Elastic-Job æœ‰å“ªäº›å·®å¼‚ï¼Ÿ

Aï¼šæˆ‘æœ¬èº«å¯¹äºŽ Elastic-Job å¹¶ä¸ç®—å¤ªç†Ÿæ‚‰ï¼Œå°±éšä¾¿è¯´å‡ ç‚¹ï¼Œå¦‚æžœæœ‰é”™è¿˜è¯·å„ä½çº æ­£ï¼š Juice ç›®å‰ç‰ˆæœ¬å¹¶ä¸æ”¯æŒä½œä¸šåˆ†ç‰‡ã€‚

> Qï¼šèƒ½è¯¦ç»†ä»‹ç»ä¸‹ä»»åŠ¡èµ„æºåˆ†é…è¿™ä¸€å—çš„ç®—æ³•å—ï¼Ÿ

Aï¼šä¹‹å‰å·²ç»ç®€å•ä»‹ç»è¿‡äº†ï¼Œé€šè¿‡æŽ¥æ”¶\'OFFERS\'äº‹ä»¶è§¦å‘ç›¸å…³ä»»åŠ¡ï¼èµ„æºåˆ†é…çš„ä»£ç å—ã€‚ ç”±äºŽå¾—åˆ°çš„ Offer å¯¹è±¡å®žé™…ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼Œå¤„ç†é€»è¾‘ä¼šå¾ªçŽ¯ä¸ºæ¯ä¸€ä¸ª Offer åˆ†é…å…·ä½“çš„ä»»åŠ¡ï¼Œè€Œæ¯ä¸ª Offer çš„ä»»åŠ¡åˆ—è¡¨æ€»èµ„æºï¼ˆCPUã€Memory ç­‰ï¼‰å¿…éœ€å°äºŽ Offer resources \* RESOURCES\_USE\_THRESHOLDï¼ˆèµ„æºä½¿ç”¨é˜€å€¼ï¼Œå¯é€šè¿‡é…ç½®æ–‡ä»¶ resources.use.threshold è®¾ç½®ï¼Œé»˜è®¤ 0.8ï¼‰ï¼Œæ¯åˆ†é…å®Œä¸€ä¸ª Offer çš„ task\_infos åŽï¼Œä¾¿ç”Ÿæˆ Accept Call ç”±å‘é€çº¿ç¨‹æ± è¿›è¡Œå‘é€å¤„ç†ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯å¼‚æ­¥éžé˜»å¡žçš„ã€‚

> Qï¼šæ‰€æœ‰çš„ä»»åŠ¡éƒ½å­˜æ¡£åœ¨ Docker é‡Œé¢å¯¹äºŽä¸€äº›ä¸´æ—¶çš„ä»»åŠ¡å¦‚ä½•å¤„ç†?

Aï¼šä¸´æ—¶çš„ä»»åŠ¡ç¡®å®žä¼šäº§ç”Ÿä¸€äº›åžƒåœ¾çš„é•œåƒï¼Œéœ€è¦å®šæœŸå¯¹ Docker ä»“åº“è¿›è¡Œæ¸…ç†ï¼Œä¸€èˆ¬è®¾ç½®æ¸…ç†å‘¨æœŸä¸º 1 ä¸ªæœˆã€‚

> Qï¼šä»»åŠ¡ç³»ç»Ÿæ˜¯æ˜¯å¦æœ‰å¸®åŠ©ç”¨æˆ·å®Œæˆ Docker å°è£…çš„æ“ä½œï¼Ÿ

Aï¼šç›®å‰æ²¡æœ‰ï¼Œæ‰€ä»¥ä½¿ç”¨è€…å¿…éœ€ä¼šä¸€äº› Docker çš„åŸºæœ¬æ“ä½œï¼Œè‡³å°‘è¦ä¼šæ‰“é•œåƒï¼Œæäº¤é•œåƒç­‰ã€‚å½“ç„¶ï¼Œåƒä¸€äº› Docker çš„è®¾ç½®ï¼Œæ¯”å¦‚æŒ‚è½½ Volumeï¼Œç½‘ç»œï¼ˆbridgeã€hostï¼‰ç­‰å¯ä»¥åœ¨æäº¤ä»»åŠ¡æ—¶é€šè¿‡å‚æ•°è®¾ç½®ã€‚

> Qï¼šMesos å’Œ Kubernetes çš„ä¼˜åŠ£åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šå…¶å®žæˆ‘ä¸»è¦ä½¿ç”¨ Mesosï¼ŒMesos ç›¸å¯¹ Kubernetes åº”è¯¥æ˜¯ä¸€å¥—æ›´é‡çš„ç³»ç»Ÿï¼ŒMesos æ›´åƒæ˜¯ä¸ªåˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿï¼Œè€Œ Kubernetes åœ¨å®¹å™¨ç¼–æŽ’æ–¹é¢æ›´æœ‰ä¼˜åŠ¿ï¼ˆPod ä¹‹ç±»ï¼‰ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 07 æœˆ 13 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**å¾ä½³ï¼Œæ²ªæ±Ÿ Java å·¥ç¨‹å¸ˆï¼Œå¼€æºæ¡†æž¶ Juice ä½œè€…ï¼Œ10 å¤šå¹´å¼€å‘ç»éªŒ**ã€‚

---

### 2017-07-12ï¼šæŽ¢ç©¶ PaaS ç½‘ç»œæ¨¡åž‹è®¾è®¡

> Qï¼šæœ‰è¿™ä¹ˆå¤šè™šæ‹Ÿç½‘ç»œï¼Œè¦†ç›–ç½‘ç»œï¼Œä¼šä¸ä¼šæœ‰ç½‘ç»œå»¶è¿Ÿï¼Ÿ

Aï¼šç½‘ç»œè™šæ‹Ÿä¼šå¸¦æ¥æ€§èƒ½æŸè€—ï¼Œæ¯”å¦‚ Flannel éœ€è¦å°†æŠ¥æ–‡å°è£…åˆ° UDP åŒ…ä¸­ä¼ è¾“ï¼Œè¿™ä¸­é—´çš„å°åŒ…è§£åŒ…å°±ä¼šå¸¦æ¥æŸè€—ã€‚æ‰€ä»¥ç½‘ç»œè™šæ‹ŸåŒ–çš„éƒ¨åˆ†ï¼Œè½¯ä»¶çš„å®žçŽ°è¿˜æœ‰å¾…ä¼˜åŒ–ï¼Œå…¶å®žæ›´å¥½çš„æ–¹å¼æ˜¯ç¡¬ä»¶æ”¯æŒï¼Œæ¯”å¦‚çŽ°åœ¨æçš„å¾ˆå¤šçš„ SDN ç½‘ç»œã€‚

> Qï¼šPod ä¸ºä»€ä¹ˆè¦æœ‰ä¸ªç½‘ç»œå®¹å™¨ï¼Ÿ

Aï¼š ä¸€æ–¹é¢è¿™æ˜¯è§£è€¦ï¼Œé€šè¿‡ç½‘ç»œå®¹å™¨æ¥è´Ÿè´£ç½‘ç»œé…ç½®ï¼Œè¿™æ ·å¯¹äºŽä¸šåŠ¡å®¹å™¨æ¥è¯´ç¨³å®šæ€§ä¼šæ›´é«˜ï¼Œæ¯”å¦‚åœ¨å¤šä¸ªä¸šåŠ¡å®¹å™¨ä¸­ï¼ŒæŸä¸€ä¸ªä¸šåŠ¡å®¹å™¨æ–­äº†ï¼Œè¿™æ ·å°±ä¸ä¼šå¯¼è‡´ç½‘ç»œä¸­æ–­ã€‚

> Qï¼šCalico é»˜è®¤å…¨ç½‘æ˜¯æ‰“é€šçš„ï¼Œæ€Žä¹ˆåšåŸºäºŽç½‘æ®µä¹‹é—´çš„éš”ç¦»ï¼Ÿ

Aï¼šç›®å‰æ¥è¯´è¦åšç½‘æ®µéš”ç¦»ï¼Œå¯èƒ½åå‘å®‰å…¨æ€§æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œæˆ‘ä»¬ç›®å‰æ˜¯åšç§æœ‰äº‘åœºæ™¯ï¼Œå¯¹éš”ç¦»çš„è¦æ±‚æ²¡é‚£ä¹ˆé«˜ã€‚æ‰€ä»¥å¦‚æžœè¦åšéš”ç¦»çš„è¯ï¼Œå¯ä»¥å‚è€ƒ OpenStack çš„ OVS æ–¹æ¡ˆã€‚

> Qï¼šåœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸‹ï¼ŒPod çš„ IP éœ€è¦å›ºå®šï¼Œè€Œä¸æ˜¯é‡å¯ä¹‹åŽ IP å¯èƒ½ä¼šå˜åŒ–ï¼Œè¯·é—®å¦‚ä½•æ»¡è¶³è¿™ç§åœºæ™¯çš„éœ€æ±‚ï¼Ÿ

Aï¼šPod çš„ IP éœ€è¦å›ºå®šçš„è¯ï¼Œä¸€ç§æ–¹å¼æ˜¯ä¿®æ”¹ Docker çš„ä»£ç ï¼Œæ®æˆ‘æ‰€çŸ¥è…¾è®¯æœ‰å®žçŽ°è¿‡ã€‚å¦å¤–çš„æ–¹æ¡ˆå°±æ˜¯åš L3 çš„ä»£ç†ï¼Œç»™ Pod ä¸€ä¸ªæµ®åŠ¨ IPï¼Œæœ‰ç‚¹åƒ OpenStack çš„å®žçŽ°ã€‚

> Qï¼šIngress çš„æµé‡é»˜è®¤æ˜¯å…ˆèµ° Service ç„¶åŽåˆ° Podï¼Œè¿˜æ˜¯ç›´æŽ¥åˆ° Podï¼Ÿ

Aï¼šå–å†³ä½ çš„å®žçŽ°ï¼Œå®˜æ–¹çš„å®žçŽ°æ˜¯å…ˆèµ° Sevice å†åˆ° Podï¼Œæˆ‘ä»¬æ˜¯ç›´æŽ¥åˆ° Podã€‚

> Qï¼šIngress-Controller å®žçŽ°é™¤äº†ä½¿ç”¨ LVS å’Œ Nginx å¤–ï¼Œèƒ½å¦é‡‡ç”¨å•†ç”¨è´Ÿè½½è®¾å¤‡æ¥å®žçŽ°ï¼Ÿå®žçŽ°æ˜¯å¦å–å†³äºŽå’Œ Kubernetes API çš„å¯¹æŽ¥ï¼Ÿ

Aï¼šå¯ä»¥ï¼Œåªè¦æœ‰æŽ¥å£éƒ½å¯ä»¥å®žçŽ°ï¼Œé€šè¿‡å®žçŽ° Ingress-Controllerï¼Œæ¯”å¦‚å¯¹æŽ¥ F5 çš„ç¡¬ä»¶è®¾å¤‡ï¼Œåªè¦ F5 æ”¯æŒç›¸å…³çš„ APIã€‚

> Qï¼šä»£ç†å…¥å£ä¸Šæœ‰å“ªäº›æ–¹æ³•è§£å†³å•ç‚¹å¤±æ•ˆçš„é—®é¢˜å‘¢ï¼Ÿ

Aï¼šè¿™ä¸ªæ¯”è¾ƒä¼ ç»Ÿäº†ï¼Œè½¯ä»¶å®žçŽ°å°± Keepalived ä¹‹ç±»çš„ã€‚

> Qï¼šIgress-Cntroller æ¯”è¾ƒå¥½çš„åº“éƒ½æœ‰å“ªäº›ï¼Œåˆ†åˆ«åŸºäºŽ Nginx Haproxy LVS çš„ï¼Ÿ

Aï¼šGitHub æœ‰è›®å¤šå®žçŽ°çš„ï¼Œå…¶å®žè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œåƒ go è¯­è¨€çš„è¯ï¼Œç›´æŽ¥å¥—ç”¨å®˜æ–¹æä¾›çš„ demo å³å¯ï¼Œå…¶ä»–è¯­è¨€å¯ä»¥å¯¹æŽ¥ Kubernetes çš„ API å®žçŽ°ã€‚

> Qï¼šè¿™ä¹ˆå¤šå±‚çš„ç½‘ç»œï¼Œå¤šå±‚è½¬å‘åŽç½‘ç»œæ€§èƒ½æ€Žä¹ˆæ ·ï¼Ÿæœ‰æ²¡æœ‰åŠžæ³•å®žçŽ°é«˜é€Ÿæ•°æ®è½¬å‘è§£å†³æ–¹æ¡ˆï¼Ÿ

Aï¼šä»£ç†å±‚ï¼Œè™šæ‹Ÿå±‚éƒ½ä¼šæœ‰æŸè€—ï¼Œè¿™ä¸ªå°±æ˜¯è¦è€ƒè™‘ç®¡ç†æˆæœ¬å’Œæ€§èƒ½çš„æƒè¡¡äº†ã€‚å¦‚ä½•è¦å®žçŽ°é«˜æ€§èƒ½çš„è¯ï¼Œå°±æ˜¯è¦å¾€ SDN ç½‘ç»œç ”ç©¶ï¼Œé€šè¿‡ç¡¬ä»¶å±‚çš„æ”¯æŒæ¥å®žçŽ°è™šã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 07 æœˆ 11 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**å´é¾™è¾‰ï¼Œç½‘å®¿ç§‘æŠ€äº‘è®¡ç®—æž¶æž„å¸ˆï¼Œè´Ÿè´£è®¾è®¡å¼€å‘ PaaS å¹³å°ï¼Œã€ŠKubernetes å®žæˆ˜ã€‹ä½œè€…**ã€‚

---

### 2017-07-14ï¼šèŠèŠ Service Meshï¼šlinkerd

> Qï¼šå…·ä½“çš„æµ‹è¯•æ€§èƒ½æœ‰ä¹ˆï¼Œå¯¹æ¯” LVSã€Nginxï¼Ÿ

Aï¼šlinkerd è™½ç„¶æ˜¯ç½‘ç»œä»£ç†ï¼Œä½†è·Ÿ LVSã€Nginx è¿˜æ˜¯æœ‰ä¸åŒçš„ï¼Œæ‰€è§£å†³çš„é—®é¢˜ä¹Ÿä¸åŒï¼Œæ¯”å¦‚ linkerd å¸¸ç”¨çš„éƒ¨ç½²æ–¹å¼ä»¥ sidecar æ¨¡å¼éƒ¨ç½²ã€‚ å¯¹äºŽæ€§èƒ½æ•°æ®ï¼Œå•ä¸ª linkerd æ˜¯å¯ä»¥å¯ä»¥å¤„ç† 20K/sec è¯·æ±‚ï¼Œp99 å»¶è¿Ÿåœ¨ 10ms ä»¥å†…ï¼Œä½†æ˜¯è¶…è¿‡ 20Kï¼Œåœ¨æˆ‘çš„æµ‹è¯•çŽ¯å¢ƒï¼Œæé«˜ä¸å¤§ã€‚è€Œè·Ÿ Nginx å’Œ LVS çš„å¯¹æ¯”ï¼Œè¿˜æ²¡åšè¿‡ã€‚

> Qï¼šèƒ½å¦è¯´è¯´ "ç†”æ–­æœºåˆ¶ï¼ˆcircuit-breakingï¼‰ "æ€Žä¹ˆç†è§£ï¼Ÿ

Aï¼šlinkerd æ”¯æŒ 2 ç§æ–¹å¼è¿›è¡Œç†”æ–­ï¼Œä¸€ç§æ˜¯åŸºäºŽä¼šè¯æˆ–è€…é“¾æŽ¥ï¼Œå¦ä¸€ç§æ˜¯åŸºäºŽè¯·æ±‚çš„ç†”æ–­ã€‚å¯¹äºŽä¼šè¯å±‚çš„ç†”æ–­ï¼Œlinkerd åœ¨è½¬å‘è¯·æ±‚åˆ°åŽç«¯åº”ç”¨å®žä¾‹æ—¶ï¼Œå¦‚æžœå‘çŽ°å…¶ä¸­ä¸€ä¸ªé“¾æŽ¥å‡ºçŽ°é—®é¢˜ï¼Œlinkerd ä¼šå°†å®ƒä»Žç»´æŠ¤çš„ä¸€ä¸ªæ± å­é‡Œç§»é™¤ï¼Œä¸ä¼šæœ‰çœŸå®žè¯·æ±‚å‘é€åˆ°è¯¥å®žä¾‹ï¼Œè€Œåœ¨åŽå°ï¼Œlinkerd ä¼šå°è¯•è¿žæŽ¥ï¼Œä¸€æ—¦è¿žæŽ¥æˆåŠŸï¼Œlinkerd å†æ¬¡å°†å®ƒåŠ å…¥æ± å­ç»§ç»­æä¾›æœåŠ¡ã€‚ è€Œå¯¹åŸºäºŽè¯·æ±‚çš„ç†”æ–­ï¼Œlinkerd ä¼šæ ¹æ® linkerd çš„é…ç½®è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚é…ç½®ä¸º io.l5d.consecutiveFailuresï¼Œ linkerd è§‚å¯Ÿåˆ°æŒ‡å®šæ•°é‡çš„è¿žç»­é”™è¯¯ï¼Œåˆ™ç†”æ–­ï¼Œå…¶ä»–çš„æ–¹å¼å¯ä»¥æŸ¥çœ‹ [linkerd.io/config/1.1.](https://linkerd.io/config/1.1.0/linkerd/index.html#failure-accrual)ã€‚

> Qï¼šlinkerd å¦‚ä½•å®žçŽ°æ°´å¹³æ‰©å±•çš„ï¼Ÿé›†ç¾¤å¯¹ linkerd è®¡ç®—èŠ‚ç‚¹æ•°é‡æœ‰é™åˆ¶å—ï¼Ÿ

Aï¼šlinkerd æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼Œæ‰€ä»¥æ°´å¹³æ‰©å±•éžå¸¸å®¹æ˜“ï¼Œé›†ç¾¤å¯¹ linkerd çš„æ•°é‡å–å†³äºŽä½ æ˜¯æ€Žä¹ˆéƒ¨ç½² linkerd çš„ï¼Œ[https://linkerd.io/in-depth/deployment/](https://linkerd.io/in-depth/deployment/)è¿™ä¸ªåœ°æ–¹åˆ—å‡ºå„ç§éƒ¨ç½²æ–¹å¼ä¼˜åŠ¿åŠç¼ºç‚¹ã€‚

> Qï¼šçœ‹æœ€åŽçš„è¡¨æ ¼å¥½åƒèƒ½å®žçŽ°å±•ç¤ºæœåŠ¡è°ƒç”¨é“¾ï¼Œå±•ç¤ºä¸Šä¸‹æ¸¸å…³ç³»ï¼Ÿèƒ½ä¸èƒ½å€Ÿæ­¤å‘çŽ°å…·ä½“æœåŠ¡åŽ‹åŠ›ç“¶é¢ˆåœ¨å“ªä¸€çŽ¯ï¼Œæ˜¯å¦æœ‰æ€§èƒ½ç›‘æŽ§ï¼Ÿ

Aï¼šlinkerd æä¾›è¯¦ç»†çš„ metric, è¿™äº› metric ä¼šå‘Šè¯‰ä½ æ€§èƒ½å‡ºçŽ°åœ¨å“ªä¸ªåœ°æ–¹ï¼Œè¿˜æœ‰ linkerd åŽŸç”Ÿè·Ÿ zipkin é›†æˆï¼Œæ‰€ä»¥ä½ èƒ½ trace åˆ°æœåŠ¡çš„è®¿é—®æµï¼Œä¼šå±•ç¤ºæ¯ä¸€çŽ¯èŠ‚çš„æ€§èƒ½æƒ…å†µã€‚

> Qï¼šå¯å¦å¯¹æ¯”ä¸€ä¸‹ Istioï¼Ÿ

Aï¼šå¯¹åº” Istio çš„åº•å±‚ Envoy å’Œ linkerd æœ¬è´¨ä¸Šå®žçŽ°äº†å·®ä¸å¤šç±»ä¼¼çš„åŠŸèƒ½ï¼Œlinkerd æ”¯æŒ Kubernetesã€DC/OSï¼Œå¹¶ä¸”è·Ÿå¤šç§æœåŠ¡å‘çŽ°å·¥å…·é›†æˆï¼Œè€Œ Istioï¼Œå°±æˆ‘äº†è§£ï¼Œç›®å‰æ”¯æŒ Kubernetesï¼Œå…·ä½“ Istio çš„ä½¿ç”¨ï¼Œæ²¡æœ‰ä½¿ç”¨è¿‡ï¼Œä¸å¤ªæ¸…æ¥šã€‚

> Qï¼šå¦‚æžœ linkd æ˜¯æ— çŠ¶æ€ï¼Œé‚£æ€Žä¹ˆç»´æŠ¤å†…éƒ¨çš„ç†”æ–­æ± ï¼Ÿ

Aï¼šè¿™é‡Œçš„æ— çŠ¶æ€æ˜¯æŒ‡ linkerd å·¥ä½œæ—¶å„ä¸ªå®žä¾‹ä¹‹é—´ä¸éœ€è¦ä¿¡æ¯çš„åŒæ­¥ï¼Œå³ä½¿ä¸€ä¸ªå®žä¾‹å‡ºçŽ°é—®é¢˜ï¼Œå¯¹ä¸ªæ•´ä¸ªçŽ¯å¢ƒçš„æ­£å¸¸å·¥ä½œæ— å…³ç—›ç—’ï¼Œåªéœ€é‡æ–°å¯åŠ¨å³å¯ï¼Œæ‰€æœ‰æœåŠ¡å‘çŽ°çš„ä¿¡æ¯éƒ½æ˜¯å­˜å‚¨åœ¨å¤–éƒ¨ï¼Œæ¯”å¦‚ Consulã€ZK ç­‰ï¼Œæœ¬åœ°åªä¼šæœ‰ç¼“å­˜ï¼Œæ²¡æœ‰æŒä¹…åŒ–çš„æ•°æ®ï¼Œè€Œç†”æ–­æ± çš„ä¿¡æ¯å°±æ˜¯æ¥è‡ªäºŽæœåŠ¡å‘çŽ°ç³»ç»Ÿã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 07 æœˆ 04 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æ¨ç« æ˜¾ï¼Œæ€ç§‘é«˜çº§ç³»ç»Ÿå·¥ç¨‹å¸ˆã€‚ä¸»è¦å…³æ³¨äº‘è®¡ç®—ï¼Œå®¹å™¨ï¼Œå¾®æœåŠ¡ç­‰é¢†åŸŸï¼Œç›®å‰åœ¨æ€ç§‘è´Ÿè´£å†…éƒ¨ PaaS å¹³å°çš„æž„å»ºç›¸å…³å·¥ä½œ**ã€‚

---

### 2017-07-04ï¼šå®¹å™¨åŒ–éƒ¨ç½² OpenStack çš„æ­£ç¡®å§¿åŠ¿

> Qï¼šå®¹å™¨è™šæ‹Ÿ CPU æ”¯æŒè™šæ‹ŸåŒ–å—ï¼Ÿ

Aï¼šå®¹å™¨åªæ˜¯ä¸€ä¸ªè¿›ç¨‹æœåŠ¡ï¼Œä¾èµ–äºŽ CPU è™šæ‹ŸåŒ–ã€‚

> Qï¼šKolla-Ansible éƒ¨ç½²çš„ OpenStack æ˜¯å¦æ»¡è¶³ç”Ÿäº§çŽ¯å¢ƒï¼Ÿ

Aï¼šå®Œå…¨æ»¡è¶³ï¼Œå·²æœ‰å®¢æˆ·ä¸Šç”Ÿäº§çŽ¯å¢ƒè·‘é‡è¦ä¸šåŠ¡ã€‚

> Qï¼šOpenStack æœåŠ¡çš„å¯é æ€§ï¼Œä¸»è¢«ä»²è£ï¼Œé…ç½®å˜æ›´ç­‰ï¼Œå¯ä»¥æ€Žä¹ˆç®¡ç†å‘¢ï¼š

Aï¼šOpenStack æœåŠ¡çš„å¯é æ€§ï¼Œä¸»è¢«ä»²è£ï¼ŒKolla å’Œ Ansible å‡æ”¯æŒåŒ…æ‹¬ HAproxy ç­‰åœ¨å†…çš„ OpenStack æœåŠ¡å’Œ Mariadb æ•°æ®åº“çš„é«˜å¯ç”¨æ€§ï¼Œç¤¾åŒºæŽ¨è DB ä½¿ç”¨ä¸»ä¸»æ–¹å¼ï¼›è‡³äºŽç®¡ç†ï¼Œä½¿ç”¨ Ansibleã€‚

> Qï¼š OpenStack å®¹å™¨åŒ–éƒ¨ç½²åŽæ•°æ®æŒä¹…åŒ–çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ

Aï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®æ–‡ä»¶æ•°æ®å­˜æ”¾åœ¨ä¸»æœºçš„/etc/kolla ç›®å½•ä¸‹ï¼Œæ•°æ®åº“æ•°æ®åˆ™åœ¨å®¹å™¨ä¸­ï¼Œå¯¹äºŽæŒä¹…åŒ–ç­‰ï¼Œå¯ä»¥è€ƒè™‘ docker volume ç­‰ç›¸å…³æ–¹æ¡ˆï¼Œå¤šç§å¤šæ ·ã€‚

> Qï¼šé€šè¿‡ Kolla-Ansible éƒ¨ç½²ä¹‹åŽçš„ OpenStack å¯¹ç½‘ç»œæ˜¯å¦æœ‰è¦æ±‚ï¼Œæˆ–è€…éœ€è¦å•ç‹¬é…ç½®ç½‘ç»œè¿™å—ï¼Ÿ

Aï¼šä½¿ç”¨ Kolla-Ansible éƒ¨ç½²çš„ OpenStack çŽ¯å¢ƒï¼Œå’Œä½¿ç”¨å…¶ä»–æ–¹å¼éƒ¨ç½²çš„ç½‘ç»œçŽ¯å¢ƒä¸€æ ·ï¼Œç®¡ç†ç½‘ã€ä¸šåŠ¡ç½‘å’Œå¤–ç½‘ç­‰ã€‚

> Qï¼šå¯å¦å¯¹ Kolla-Ansible é¡¹ç›®åš Socker åŒ–ï¼Œç›®çš„æ˜¯é€šè¿‡è¿™ä¸ªé•œåƒåŽ»éƒ¨ç½² OpenStackï¼Œå‡å°‘é‡å¤é…ç½® Kolla-Ansible çš„è¿è¡ŒçŽ¯å¢ƒï¼Ÿ

Aï¼šKolla-Ansible åªæ˜¯ä¸€ä¸ªéƒ¨ç½²å·¥å…·ï¼Œåšé…ç½®ç®¡ç†ã€‚å¯ä»¥æŠŠ Kollaã€Ansible å’Œ Docker é•œåƒéƒ½æ”¾åœ¨ä¸€ä¸ªéƒ¨ç½²æ¨¡æ¿ä¸Šï¼Œé€šè¿‡è¿™ä¸ªéƒ¨ç½²æ¨¡æ¿åŽ»ä»»æ„ éƒ¨ç½² OpenStack çŽ¯å¢ƒï¼Œè¿™ç±»ä¼¼äºŽ Fuel ISOã€‚

---

### 2017-06-30ï¼šå®¹å™¨å¦‚ä½•ç›‘æŽ§ï¼Ÿ

> Qï¼šæœ‰å¯¹ Docker æœ¬èº«åšä»€ä¹ˆç›‘æŽ§ä¹ˆï¼Ÿ

Aï¼šå¯ä»¥è®¤ä¸º Docker ç›‘æŽ§æ˜¯ç±»ä¸»æœºç›‘æŽ§ï¼Œåªä¸è¿‡æ˜¯ç¼©å°ç‰ˆï¼ŒåŸºæœ¬ä¸Šåˆ†ä¸º 4 éƒ¨åˆ† CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œã€‚

> Qï¼šä½¿ç”¨çš„æ•´å¥—ç›‘æŽ§å·¥å…·æ˜¯å“ªäº›ï¼Ÿå®¹å™¨ CPU å†…å­˜ç½‘ç»œå¦‚ä½•ç›‘æŽ§ï¼Ÿå®¹å™¨äº‹ä»¶æ¯”å¦‚èµ·åœå¦‚ä½•ç›‘æŽ§ã€‚

Aï¼šæ•´å¥—å·¥å…·æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Cadvisor + Prometheus + Grafana ,å½“ç„¶ä¸­é—´çš„ç»„ä»¶æ˜¯å¯ä»¥æ›¿æ¢çš„ï¼Œä½†åŸºæœ¬ä¸Šå›´ç»•ç€ é‡‡é›†ã€å­˜å‚¨è®¡ç®—ã€å±•çŽ°æ¥åšã€‚é‡‡é›†ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„ï¼Œæ¯”å¦‚æ–‡ç« è¯´çš„è‡ªå·±å†™ä»£ç†åŽ»æ‹¿ã€‚å®¹å™¨çš„ç›‘æŽ§æ•°æ®å½“ç„¶é é‡‡é›†ç¨‹åºäº†ã€‚èµ·åœè¿™ä¸ªä¸€èˆ¬é€šè¿‡ç›‘æŽ§ Docker çš„äº‹ä»¶æ¥å®žçŽ°ï¼Œé‡‡é›†å·¥å…·ä¹Ÿèƒ½æ”¶ã€‚

> Qï¼šåˆ†äº«çš„ç›‘æŽ§å›¾ç‰‡ï¼Œæœ‰æ•°æ®çš„ï¼Œæ˜¯ä½¿ç”¨ä»€ä¹ˆç›‘æŽ§å·¥å…·è¾¾æˆçš„ï¼Ÿ

Aï¼šè¿™ä¸ªåˆ†ä¸¤ç§ï¼Œä¸€ç§æ˜¯é åº•å±‚çš„ç»˜å›¾å¼•æ“Žï¼Œå°†æ•°æ®ä»Žå­˜å‚¨é‡Œè¯»å‡ºæ¥è‡ªå·±ç»˜åˆ¶ï¼Œä¸€ç§å°±æ˜¯ç”¨ç±» Grafana çš„ç¨‹åºã€‚

> Qï¼šå¦‚æžœç”¨ Zabbix ç›‘æŽ§ï¼Œæ˜¯å¦éœ€è¦å®šä¹‰å®¹å™¨çš„çš„åŽ†å²æ•°æ®ä¿ç•™æ—¶é—´å’Œè¶‹åŠ¿æ•°æ®å­˜å‚¨å‘¨æœŸï¼Œæˆ‘è®¾å®šçš„æ—¶åŽ†å²æ•°æ®ä¿ç•™ 7 å¤©ï¼Œè¶‹åŠ¿æ•°æ® 14 å¤©ï¼Œè¿™æ ·æ˜¯å¦åˆç†ï¼Ÿ

Aï¼šæˆ‘è®¤ä¸º Zabbix æ˜¯ä¸Šä¸€ä»£ç›‘æŽ§ä½“ç³»ï¼Œæˆ–è€…ä»¥ä¸»æœºä¸ºä¸­å¿ƒçš„ç›‘æŽ§ä½“ç³»ï¼Œå¦‚æžœæ˜¯å®¹å™¨ç›‘æŽ§ï¼Œæˆ‘å»ºè®®è¿˜æ˜¯è€ƒè™‘æ—¶åºç±»çš„ç›‘æŽ§ä½“ç³»ï¼Œæ¯”å¦‚ Influxdb\\Prometheus ç­‰ï¼Œç»§ç»­åˆšæ‰çš„ï¼ŒZabbix è¿˜å¯ä»¥æ²¿ç”¨ä½œä¸ºä¸»æœºçš„ï¼Œåªæ˜¯ Docker å•ç‹¬åˆ†ç¦»å‡ºæ¥ï¼Œè¿™æ ·åŸºç¡€å»ºè®¾å¯ä»¥å¤ç”¨ã€‚

> Qï¼šå»ºä¸å»ºè®®é€šè¿‡ Pod ä¸­æ”¾ä¸€ä¸ªç›‘æŽ§å®¹å™¨æ¥ç›‘æŽ§åº”ç”¨å®¹å™¨ï¼Œæ¯”å¦‚ Zabbix å®¢æˆ·ç«¯çš„ç›‘æŽ§å®¹å™¨åœ¨ Pod ä¸­ï¼Œå¦‚æžœè¿™ä¹ˆåšä¼˜ç¼ºç‚¹å“ªäº›ï¼Ÿ

Aï¼šPod åº”è¯¥æ˜¯ Kubernetes çš„æ¦‚å¿µï¼Œå’Œå®¹å™¨å…¶å®žå…³ç³»ä¸å¤§ï¼Œè¿™ä¸ª Kubernetes è‡ªå·±åº”è¯¥ä¼šæä¾›æ•°æ®ï¼Œå…·ä½“æˆ‘ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚ä½†æ˜¯ Abbix è¿˜æ˜¯å»ºè®®ä¿ç•™åœ¨ä¸»æœºå±‚é¢ä½¿ç”¨ï¼Œé™¤éžå¤§æ”¹ï¼Œå¦åˆ™å³ä½¿é æ‹†åˆ†æ•°æ®åº“ä»€ä¹ˆçš„è§£å†³ï¼Œæœªæ¥ç»´æŠ¤å’Œæ€§èƒ½ä¹Ÿæ˜¯è¿ç»´å¤§å‘ã€‚

> Qï¼šåšå®¹å™¨ç›‘æŽ§å’Œ JVM ç›‘æŽ§æ˜¯å¦æœ‰ä»€ä¹ˆå·¥å…·å¯ä»¥æŽ¨èï¼Œæ„Ÿè°¢ã€‚

Aï¼šå®¹å™¨ç›‘æŽ§çŽ°åœ¨è‡ªå·±çŽ©å¥—è·¯éƒ½æ˜¯è·Ÿç€å¼€æºèµ°ï¼Œå¯ä»¥è€ƒè™‘åˆšæ‰æˆ‘ä»¬çš„å¥—è·¯ï¼Œä¸è¿‡å¯ä»¥ä¸­é—´ç»„ä»¶ä»»æ„æ¢ï¼Œæ¯”å¦‚å­˜å‚¨ InfluxDBï¼ŒJVMï¼Œæˆ‘å·²çŸ¥é“æ²¡æœ‰ä»€ä¹ˆå¥½çš„å¥—è·¯ï¼ŒåŸºæœ¬ä¸Šèµ°è·Ÿå®žä¾‹çš„è·¯å­ï¼Œå°±æ˜¯åšä¸ªå°ç¨‹åºè·Ÿç€ç¨‹åºèµ°ï¼Œç„¶åŽæä¾›ç»Ÿä¸€æŽ¥å£ç”¨è½¯ä»¶æŠ“ã€‚

> Qï¼šCadvisor Heapster å’Œ Prometheus å“ªç§å¥½ç”¨ä¸€äº›ï¼Œå„è‡ªä¼˜ç¼ºç‚¹æœ‰å“ªäº›ã€‚

Aï¼š Heapster ä¸ç†Ÿæ‚‰ï¼Œ Prometheus å¾ˆå¥½ï¼ŒGoogle ä¸ªäººçš„å¼€æºé¡¹ç›®ï¼Œéƒ½æ˜¯ Google å¥—è·¯ï¼Œå”¯ç‹¬å­˜å‚¨æ˜¯ä¸ªé—®é¢˜ï¼Œè¿™å—è¿˜éœ€è¦çœ‹ä»–ä»¬æœªæ¥å¦‚ä½•å¤„ç†ï¼ŒçŽ°åœ¨å•æœºå­˜å‚¨è™½ç„¶æ€§èƒ½ä¸Šè¿˜å¯ä»¥ï¼Œä½†æ˜¯æ‰©å±•èƒ½åŠ›æ¯”è¾ƒå·®ã€‚

> Qï¼šè¯·é—®å¦‚ä½•ç›‘æŽ§ç½‘ç»œå¸¦å®½ï¼Œå¹¶å¯¹å¸¦å®½è¿›è¡Œé™åˆ¶ï¼Ÿ

Aï¼šå¸¦å®½ç›‘æŽ§å¯ä»¥æŒ‰ç…§å®¹å™¨æä¾›çš„æ•°æ®èµ°ï¼Œè¿˜æ˜¯å¾ˆå‡†çš„ï¼Œå…·ä½“é™åˆ¶è¿™ä¸ªæ˜¯å¦ä¸€ä¸ªçº¬åº¦äº†ï¼Œå±žäºŽå®¹å™¨ç½‘ç»œï¼Œè¿™ä¸ªå‘æ¯”è¾ƒå¤§ä¸é€‚åˆä»Šå¤©è®¨è®ºã€‚

> Qï¼šDocker å¤šå¥—çŽ¯å¢ƒä½¿ç”¨çš„åŸŸåè¦ç›¸åŒè¿˜æ˜¯ä¸åŒï¼Ÿå¦‚æžœç›¸åŒçš„è¯å¦‚ä½•éš”ç¦»ï¼Œå¦‚æžœä¸åŒçš„è¯å¦‚ä½•ç»´æŠ¤é…ç½®ï¼Ÿ

Aï¼šè¿™ä¸ªè®¾è®¡åˆ°å®¹å™¨æœåŠ¡çš„ç½‘ç»œè§„åˆ’é—®é¢˜ï¼Œçœ‹ç½‘ç»œé€‰æ‹©ã€‚éš”ç¦»ä¹Ÿçœ‹ç½‘ç»œé€‰åž‹ã€‚å’Œä¹‹å‰è¯´çš„ä¸€æ ·è¿™ä¸ªå±žäºŽå®¹å™¨ç½‘ç»œã€‚å‘å¤§ã€‚

> Qï¼šç›‘æŽ§å·¥å…·æŽ¨èé‚£ä¸ªï¼Ÿå¯¹äºŽå®¹å™¨ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œæœ‰ä½•ç­–ç•¥åº”å¯¹ï¼Ÿå®¹å™¨å¿«é€ŸåŽï¼Œå¦‚ä½•å®žçŽ°å¿«é€Ÿç›‘æŽ§ç­–ç•¥ï¼Ÿ

Aï¼šç›‘æŽ§å·¥å…·æŽ¨èåˆšæ‰å·²ç»è¯´äº†ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä»¬çš„æ–¹æ¡ˆç„¶åŽè‡ªå·±æ‘¸ç´¢å‡ºé€‚åˆè‡ªå·±çš„ã€‚è‡³äºŽå®¹å™¨ç”Ÿå‘½å‘¨æœŸçŸ­çš„é—®é¢˜ï¼Œè¿™ä¸ªä¸å°±æ˜¯å®¹å™¨è®¾è®¡å˜›ï¼Œå¾ˆæ­£å¸¸ï¼Œå¤šèµ·å‡ ä¸ªç›¸åŒçš„æœåŠ¡é¡¶ä¸Šã€‚å®¹å™¨å¿«é€ŸåŽæ˜¯ä»€ä¹ˆ?

> Qï¼šå®¹å™¨çš„ä¸€å¤§ç‰¹ç‚¹æ˜¯ IP æˆ–è€… ID ä¿¡æ¯å˜åŒ–é¢‘ç¹ï¼Œè¿™å°±ä¼šå¯¼è‡´æ—¶é—´åºåˆ—æ•°æ®åº“å­˜å‚¨çš„ç›‘æŽ§æ•°æ®é‡å¢žé•¿å’Œ vm ç›¸æ¯”å¤§ä¸Šä¸å°‘ï¼Œè¿™å—æœ‰ä»€ä¹ˆåº”å¯¹æ–¹æ¡ˆå—ï¼Ÿå°è¯•è¿‡å›ºå®š ID çš„ï¼Œä½†æ˜¯æ•ˆæžœä¸ä½³ã€‚

Aï¼šè¿™å—ç¡®å®žæ²¡æœ‰ä»€ä¹ˆå¥½åŠžæ³•ï¼Œä¸è¿‡å¯ä»¥æ¢ä¸ªè§’åº¦ï¼Œä½ å¯ä»¥å°†åº•å±‚çš„å®žä¾‹æŠ½è±¡ä¸€ä¸ªçº¬åº¦ï¼Œæ¯”å¦‚èµ·äº† 1 ä¸ªæœåŠ¡ 10 ä¸ªå®¹å™¨ï¼Œä½ å¯ä»¥å§å®¹å™¨ç¼–å· 0-9ï¼Œå¯¹åº”æŒ‚æŽ‰çš„å®¹å™¨ï¼Œæ–°å¯åŠ¨ç»§æ‰¿è¿™ä¸ªç¼–å·ã€‚è¿™æ ·ä»Žæ—¶åºä¸Šç”¨è¿™ä¸ªä½œä¸ºæ ‡è®°ï¼Œè¿™æ ·ä½ å°±èƒ½çœ‹æ¯”è¾ƒç›´è§‚çš„æ˜¾ç¤ºäº†ã€‚è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬ SWAN å®žçŽ°äº†ï¼Œå¯ä»¥è€ƒè™‘ã€‚

> Qï¼šå®¹å™¨çš„å®‰å…¨å¦‚ä½•åšç›‘æŽ§ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜é—®çš„å¥½ï¼ŒçŽ°åœ¨æ¯”è¾ƒé€šç”¨çš„ç›‘æŽ§åŸºæœ¬ä¸Šèµ°çš„æ˜¯ä¸¤æ¡è·¯ï¼Œä¸€ä¸ªæ˜¯ç›‘æŽ§æ€§èƒ½ï¼Œä¸€ä¸ªæ˜¯ç›‘æŽ§ä¸šåŠ¡ï¼Œå®‰å…¨å±‚é¢ç›‘æŽ§ï¼Œåˆ°çŽ°åœ¨æˆ‘è§‰å¾—è¿˜æ˜¯è¦é ç½‘ç»œå±‚æ¥ç›‘æŽ§æ¯”è¾ƒé è°±ã€‚

> Qï¼šDocker å¯åŠ¨ Kafka é›†ç¾¤çš„é—®é¢˜ï¼Œæœ‰æ²¡æœ‰æŽ§åˆ¶å†…å­˜æ–¹é¢çš„ç»éªŒå‘¢ï¼Ÿ

Aï¼šKafka é›†ç¾¤ï¼Œæ€§èƒ½ç›‘æŽ§çš„è¯ï¼Œå¯ä»¥æ²¿ç”¨åŽŸæ¥çš„ Kafka é›†ç¾¤ç›‘æŽ§è½¯ä»¶ï¼Œè¿™ä¸ªæˆ‘è®°å¾—åŽŸæ¥æœ‰ä¸€ä¸ªä»€ä¹ˆæ¥ç€ï¼Œå½“ç„¶å¦‚æžœæƒ³åšæ•°æ®æ±‡èšï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¼€æºè½¯ä»¶å°†æ•°æ®æ±‡èšåˆ°ä¸€ä¸ªæ•°æ®å­˜å‚¨ï¼Œç„¶åŽåœ¨æ±‡èšå‡ºæ¥ã€‚å…³äºŽ Docker å†…å­˜çš„è¶…å‡ºè¢«æ€é—®é¢˜ï¼Œè¿™ä¸ªä¸»è¦æ˜¯çœ‹ä½ å¯¹äºŽå®¹å™¨å†…å­˜è®¾ç½®çš„å®¹å¿åº¦é—®é¢˜ï¼Œè¿™é‡Œä½ å¤§å¯ä»¥æŠŠå®¹å™¨å½“æˆä¸€ä¸ªæœºå™¨ï¼Œçœ‹åˆ°åº•ç»™è¿™ä¸ªæœºå™¨æ’å¤šå°‘å†…å­˜åˆé€‚ã€‚

> Qï¼šPromethues æœ‰æ²¡æœ‰åšé«˜å¯ç”¨ï¼Ÿ

Aï¼šå¦‚æžœå­˜å‚¨é«˜å¯ç”¨çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸¤å° Prometheus åŒæ—¶æŠ“ï¼Œè¿™æ ·æ•°æ®å®Œå…¨ä¸€æ ·ï¼Œä¹Ÿæ²¡å•¥åŽ‹åŠ›ã€‚

---

### 2017-06-22ï¼šDocker çš„å¦ç±»ç”¨æ³•ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ç²—æš´

> Qï¼šè¯·é—®ä»Žå¼€å§‹çœ‹ Docker åˆ°å®ŒæˆçŽ¯å¢ƒæ­å»ºå¤§æ¦‚ç”¨äº†å¤šé•¿æ—¶é—´ï¼Ÿ

Aï¼šå‰æœŸçš„å­¦ä¹ å’Œé€‰åž‹ç”¨äº† 2 ä¸ªæœˆã€‚åŽé¢åŸºç¡€æ­å»ºç”¨äº† 1 ä¸ªæœˆï¼Œè€—æ—¶æœ€é•¿çš„æ˜¯æ—§æœåŠ¡çš„ Docker åŒ–ï¼Œè¿™ä¸ªåˆ°çŽ°åœ¨è¿˜æ²¡å…¨éƒ¨å®Œæˆï¼Œå› ä¸ºæŠ€æœ¯å€ºå¤ªå¤šã€‚

> Qï¼šå¯ä»¥è¯´æ˜Žä¸‹ä¸ºä»€ä¹ˆç”Ÿäº§çŽ¯å¢ƒä¸ç”¨ Docker å—ï¼Œè·Ÿä½ ä»¬æ˜¯é‡‘èžå…¬å¸å±žæ€§æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ

Aï¼šå› ä¸ºé‡‘èžå…¬å¸å¯¹äºŽç¨³å®šæ€§æœ‰éžå¸¸é«˜çš„è¦æ±‚ï¼ŒåŒæ—¶å¯¹äºŽç”Ÿäº§æœåŠ¡å™¨æ•°é‡å’Œç©ºç½®çŽ‡åˆä¸æ•æ„Ÿã€‚æ‰€ä»¥ Docker è¿™æ ·çš„æ–°æŠ€æœ¯åº”ç”¨è¿˜æ˜¯éœ€è¦ä¸ä¼šé‚£ä¹ˆå¿«åˆ‡å…¥ã€‚åŒæ—¶è¿ç»´å›¢é˜Ÿä¹Ÿè¦åŽ»å­¦ä¹ ï¼ŒæŠ€æœ¯å‚¨å¤‡ç­‰éƒ½æ˜¯é˜»ç¢ã€‚æ‰€ä»¥çŽ°åœ¨å¾ˆå¤šé“¶è¡Œä¹Ÿåªæ˜¯åœ¨å‘¨å›´ä¸é‡è¦ï¼Œå˜åŒ–é¢‘ç¹çš„ç³»ç»Ÿå¼€å§‹å°è¯• Dockerã€‚

> Qï¼šä¸»è¦æƒ³äº†è§£ä¸‹ä½ ä»¬é›†æˆçš„æµç¨‹ï¼Ÿ

Aï¼šCI çš„æµç¨‹å’Œæ™®é€šçš„ CI ç±»ä¼¼ã€‚ä»£ç å˜åŠ¨åŽè§¦å‘ Jenkinsï¼ŒJenkins ä¼šç¼–è¯‘ï¼Œæ‰“åŒ…ï¼Œäº§ç”Ÿä¸€ä¸ªå¯¹åº”çš„å‘å¸ƒå•å…ƒçš„æ–°å®¹å™¨ç‰ˆæœ¬ã€‚ç„¶åŽè§¦å‘å¯¹åº”çš„è„šæœ¬æ¥åœæœåŠ¡ï¼Œå–é•œåƒï¼Œå¯åŠ¨å®¹å™¨ã€‚

> Qï¼šä¸ºä»€ä¹ˆä¸è€ƒè™‘åœ¨ç§æœ‰äº‘å¹³å°ä¸ŠçŽ©ï¼Ÿ

Aï¼šå› ä¸ºèµ„æºé™åˆ¶ï¼Œä»Žç¡¬ä»¶åŠäººåŠ›ä¸Šéƒ½ä¸è¶³ã€‚å¦å¤–å°±å‡ åå°æœåŠ¡å™¨ï¼Œæ²¡å¿…è¦ã€‚å¦‚æžœæœ‰å‡ ç™¾å°å°±è¦è€ƒè™‘èµ„æºè°ƒåº¦ç­‰å› ç´ ã€‚

> Qï¼šè¯·é—®å®¹å™¨åšç¼–æŽ’ç®¡ç†ï¼Œä½ ä»¬é€‰ç”¨ä»€ä¹ˆå·¥å…·

Aï¼šæˆ‘ä»¬åªç”¨äº†åŽŸç”Ÿçš„ Swarmã€‚è¿™æ ·ä¸ç”¨è€ƒè™‘å¼€æºè½¯ä»¶äºŒæ¬¡å¼€å‘åŠå·¥å…·é—´çš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜ã€‚

> Qï¼šå¦‚ä½•è®©å®¿ä¸»æœºæŒ‚è½½åˆ°å­˜å‚¨ä¹‹åŽï¼Œè®©å®¹å™¨å…¨éƒ¨è·‘åœ¨å­˜å‚¨é‡Œé¢ï¼Ÿ

Aï¼šå®¹å™¨æœ¬èº«è¿˜æ˜¯åœ¨ Docker ä¸»æœºçš„ç£ç›˜ä¸­ï¼Œä½†å…¶ä»–æ•°æ®ï¼šä¾‹å¦‚é…ç½®æ–‡ä»¶éƒ½æ˜¯ä»Ž SAN ä¸ŠæŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚è¿™æ ·ä¿è¯å¦‚æžœ Docker ä¸»æœº down äº†ï¼Œå®¹å™¨å¯ä»¥åœ¨å…¶ä»–ä¸»æœºä¸Šé‡å¯æ¢å¤ã€‚

> Qï¼šz387 çš„ ip å¦‚ä½•åˆ†é…ï¼Ÿ

Aï¼šContiv ä¼šå¸®ä½ åˆ†é… IP çš„ï¼Œä¸ç”¨è‡ªå·±ç®¡ç†ã€‚

> Qï¼šä¸ºä»€ä¹ˆæŠŠ JIRA ä¹Ÿ Dockerï¼Ÿ

Aï¼šå› ä¸ºèµ„æºä¸è¶³ï¼Œæ²¡æœ‰å¼ºå¤§çš„ä¸»æœºæ¥è·‘ JIRAï¼Œä¹Ÿæ²¡æœ‰åŠžæ³•ä¸»å¤‡ã€‚æ‰€ä»¥å¹²è„†æŠŠè¿™äº›é‡è¦ç³»ç»Ÿéƒ½æ”¾åˆ°å®¹å™¨é‡Œã€‚è¿™æ ·å°±å¯ä»¥ç”¨è¾ƒå°‘çš„ä¸»æœºæ¥ä¿è¯æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚

> Qï¼šé•œåƒå¸¦çŽ¯å¢ƒå˜é‡å±žæ€§å—ï¼Ÿ

Aï¼šçœ‹æƒ…å†µï¼Œæˆ‘ä»¬è·‘è‡ªåŠ¨åŒ–æµ‹è¯•çš„é•œåƒæœ‰çŽ¯å¢ƒå˜é‡å±žæ€§ï¼Œå› ä¸ºæœ‰å¾ˆå¤šå¯å˜å‚æ•°ã€‚

> Qï¼šå¦‚æžœæœåŠ¡æŒ‚äº†ï¼Œé‡å¯æœåŠ¡ã€‚é‡æ–°ä¿®æ”¹ DNS å’Œ Nginxï¼Œé—®é¢˜ 1ï¼šæœåŠ¡æŒ‚äº†ï¼ŒSwarm å¯ä»¥è´Ÿè´£é‡å¯å§ï¼Ÿé—®é¢˜ 2ï¼šä¸ºä»€ä¹ˆé‡å¯åŽéœ€è¦æ”¹ DNS Nginxã€‚Swarmçš„ingress ç½‘ç»œå¯ä»¥ä»Žä»»ä½•ä¸€å° node è·¯ç”±åˆ°å¯¹åº”çš„ Container å§ã€‚

Aï¼šå¦‚æžœé•œåƒ down äº†ï¼ŒSwarm ä¼šç®¡ç†çš„ã€‚ä½†å¦‚æžœæ˜¯æœåŠ¡ä¸å¯ç”¨ï¼ŒSwarm æ˜¯ä¸çŸ¥é“çš„ã€‚è¿™æ—¶å€™å°±éœ€è¦åœ¨æœåŠ¡ç›‘æŽ§é‚£é‡Œè§¦å‘é‡å¯ã€‚ç”±äºŽæœåŠ¡è¿˜æœ‰ç«¯å£çš„é—®é¢˜ï¼Œæ‰€ä»¥æ˜¯åœ¨ Nginx ä¸Šè½¬å‘åˆ°çœŸå®žçš„æœåŠ¡ç«¯å£ä¸Šã€‚DNS åŸºæœ¬éƒ½æ˜¯é…ç½®åˆ° Nginx ä¸Šï¼Œå¦‚æžœ Nginx æŒ‚äº†ï¼Œå°±è¦æŠŠ DNS é‡æ–°æŒ‡å‘ã€‚

> Qï¼šåº”ç”¨æ˜¯ Java çš„å—ï¼Œæ ¹æ®çŽ¯å¢ƒä¸åŒçš„é…ç½®æ–‡ä»¶å¦‚ä½•å¤„ç†ï¼Ÿ

Aï¼šå¤§éƒ¨åˆ†æ˜¯ Java çš„ï¼Œä¹Ÿæœ‰ Python ç­‰ã€‚æˆ‘ä»¬è‡ªå·±å¼€å‘äº†ä¸€å¥—é…ç½®æ–‡ä»¶ç®¡ç†çš„ç³»ç»Ÿï¼ŒåŒæ—¶å¯¹é…ç½®æ–‡ä»¶é‡Œçš„é…ç½®é¡¹è¿›è¡Œå‘½åè§„èŒƒï¼Œè¿™æ ·ä»Žä¸€å¥—çŽ¯å¢ƒåˆ°å¦ä¸€å¥—å¤§éƒ¨åˆ†æƒ…å†µæ˜¯ç›´æŽ¥è‡ªåŠ¨è¿›è¡Œä¿®æ”¹çš„ã€‚

> Qï¼šå¦‚ä½•åšå¤šç‰ˆæœ¬çŽ¯å¢ƒéš”ç¦»æµ‹è¯•ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬æ²¡æœ‰è¿™æ ·çš„éœ€æ±‚ã€‚æµ‹è¯•çŽ¯å¢ƒåŸºæœ¬ä¸Šéƒ½æ˜¯å’Œç”Ÿäº§å¯¹é½ã€‚ç‰¹æ®Šæƒ…å†µæ˜¯åœ¨ Jenkins ä¸Šæ¥é€‰æ‹©ç‰¹å®šçš„ä»£ç ç‰ˆæœ¬æ¥è¿›è¡Œéƒ¨ç½²ã€‚æ‰€ä»¥åœ¨ä¸åŒçš„çŽ¯å¢ƒé‡Œå¯ä»¥éƒ¨ç½²ä¸åŒçš„ä»£ç ã€‚

> Qï¼šè¯·é—® Ngin é…ç½®çš„æ˜¯ Container çš„ IP è¿˜æ˜¯ç‰©ç†æœº IPï¼Ÿ

Aï¼šNginx æ˜¯æš´éœ²å‡º 80 ç«¯å£åœ¨å®¹å™¨å®¿ä¸»æœºä¸Šçš„ã€‚

> Qï¼šä¸åŒçŽ¯å¢ƒçš„é…ç½®æ–‡ä»¶æ˜¯åœ¨é•œåƒå±‚é¢æ›¿æ¢è¿›åŽ»è¿˜æ˜¯åœ¨å®¹å™¨å±‚é¢æ›¿æ¢è¿›åŽ»

Aï¼šæ˜¯åœ¨å®¹å™¨å±‚é¢çš„ã€‚æ¯ä¸ªå®¹å™¨ä¸Šæœ‰ä¸ª Agentï¼Œè´Ÿè´£åŽ»æ‹‰å–é…ç½®æ–‡ä»¶ã€‚

---

### 2017-06-11ï¼šæ·±ä¿¡æœå®¹å™¨äº‘çš„è´Ÿè½½å‡è¡¡å®žçŽ°

> Qï¼šHAProxy æ˜¯åœ¨ Kubernetes å†…éƒ¨å¯¹ pod äº’é€šï¼Œæ˜¯å¦‚ä½•å®žçŽ° pod çš„å‘çŽ°çš„ï¼Ÿ

Aï¼šKubernetes æœ‰ä¸€ä¸ªå¼€æºæœºåˆ¶ï¼Œå«åšingress æ¨¡å—ï¼Œæä¾›äº† pod åŸºäºŽ service çš„å‘çŽ°ã€‚

> Qï¼šHaproxy æ˜¯é€šè¿‡é…ç½®æ¨¡ç‰ˆç”Ÿæˆçš„å—ï¼Ÿæ›´æ–°ç„¶åŽé‡è½½å—ï¼Ÿ

Aï¼šæ˜¯é€šè¿‡é…ç½®æ¨¡æ¿æ¥ç”Ÿæˆè´Ÿè½½å‡è¡¡çš„åˆ†å‘è§„åˆ™ï¼Œæˆ‘ä»¬æ—¶åˆ»åŠ¨æ€åˆ·æ–°é…ç½®ï¼Œæˆ‘ä»¬é‡è½½é…ç½®ï¼Œé“¾æŽ¥è¾¾åˆ° 0 ä¸¢å¤±ã€‚

> Qï¼šå¦‚æžœä½ ä»¬çš„ HAProxy çš„ lbå’Œingress ä¸€æ ·ä»…æ”¯æŒå››ï¼Œä¸ƒå±‚çš„ lbï¼Œé‚£ä¹ˆå¯¹äºŽ Nginx æˆ–è€… traefik çš„ä¼˜åŠ¿åœ¨äºŽå“ªé‡Œå‘¢ï¼Ÿ

Aï¼šå„æœ‰ä¼˜ç¼ºç‚¹ï¼ŒHAProxy æ›´åŠ é€‚ç”¨äºŽæˆ‘ä»¬çš„å¹³å°ã€‚å¯¹äºŽ Nginx ç­‰ï¼Œæˆ‘ä»¬æ›´åŠ è½»é‡ï¼Œæ›´åŠ ç®€å• ï¼Œè¿­ä»£å¿«ã€‚

> Qï¼šHAProxy ç»å¸¸ reload æœ‰æ€§èƒ½æ¶ˆè€—ï¼Œæ€Žä¹ˆåšå¯¹å•ä¸ªå‘å¸ƒçš„åº”ç”¨è¿›è¡ŒåŠ¨æ€æ›´æ–°ï¼Ÿä¹‹å‰æ–°æµªæœ‰ Consul + Nginxï¼Ÿ

Aï¼šä¸å­˜åœ¨æ€§èƒ½æ¶ˆè€—ï¼Œæˆ‘ä»¬é’ˆå¯¹äºŽå•ä¸ªåº”ç”¨çš„åŠ¨æ€æ›´æ–°ä¸Žå¤šä¸ªçš„æ€§èƒ½å·®å¼‚å¾ˆå°ï¼Œå› ä¸ºéƒ½æ˜¯é…ç½® é‡è½½ã€‚

> Qï¼šå¦‚ä½•åšåˆ° HAProxy é‡è½½é…ç½®é“¾æŽ¥ 0 ä¸¢å¤±çš„ï¼Ÿ

Aï¼šé¦–å…ˆé‡è½½ä¹‹å‰çš„ iptable è§„åˆ™ï¼Œä¸¢å¼ƒæ¡æ‰‹åŒ…ï¼Œé‡å¯ä¹‹åŽï¼ŒåŽ»æŽ‰è§„åˆ™ï¼Œè¾¾åˆ°é‡è½½æ—¶é—´å†…æ–°è¯·æ±‚ä¸ä¸¢å¤±ï¼ŒåŽŸæœ‰é“¾æŽ¥ï¼Œhaproxy æä¾›æœºåˆ¶æ”¯æŒï¼ŒæŽ¥ç®¡åŽŸæ¥çš„é“¾æŽ¥ã€‚

> Qï¼šHAProxy æ˜¯æ€Žä¹ˆè°ƒç”¨ service çš„ï¼Ÿ ç›´æŽ¥è°ƒç”¨ service çš„ç¾¤é›† ipï¼Ÿ

Aï¼šåŸºäºŽ Kubernetes çš„ listwatch èµ„æºç›‘å¬ï¼Œé€šè¿‡ service å¯¹åº”çš„ endpoint èŽ·å–åˆ° pod çš„ ipã€‚

---

### 2017-06-10ï¼šè½»æ¾ç­¹ç›‘æŽ§ç³»ç»Ÿå®žçŽ°æ–¹æ¡ˆ

> Qï¼šé’ˆå¯¹ Grafana ä¸æ”¯æŒçš„æŠ¥è­¦ï¼Œä½ ä»¬è‡ªå·±å®žçŽ°çš„æŠ¥è­¦å¼•æ“Žæ˜¯ç›´æŽ¥åœ¨ grafana çš„åŸºç¡€ä¸Šä¿®æ”¹çš„ä¹ˆï¼Œè¿˜æ˜¯ç‹¬ç«‹äºŽ Grafana å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬ç”¨ Go è‡ªå·±å®žçŽ°çš„ä¸€ä¸ªæŠ¥è­¦å¼•æ“Žï¼Œç‹¬ç«‹äºŽ Grafanaã€‚

> Qï¼šLogstash ä½ ä»¬é‡åˆ°è¿‡æ”¶é›†æ…¢å’Œä¸¢æ—¥å¿—çš„æƒ…å†µå—ï¼ŸçŽ°åœ¨ä½ ä»¬ Logstash æ”¶é›†æ—¥å¿—åˆ°ä»€ä¹ˆè§„æ¨¡äº†ï¼Ÿ

Aï¼šæˆ‘ä»¬ç›®å‰çš„æ—¥è´¨é‡å¤§æ¦‚æ¯å¤© 2 äº¿æ¡ï¼Œé«˜å³°æ—¶å€™æ¯å°æ—¶ 2000 ä¸‡æ¡å·¦å³ã€‚Logstash è¿è¡Œçš„è¿˜å¯ä»¥ï¼Œå¦‚æžœåŽæœŸé‡åˆ°æ‰‹æœºæ…¢ï¼Œåšç®€å•çš„æ–¹å¼æ˜¯æ‰©æœºå™¨ï¼Œå…ˆè§£å†³é—®é¢˜ï¼Œå†æƒ³æ›´å¥½çš„ä¼˜åŒ–ç­–ç•¥ã€‚

> Qï¼šå¦‚æžœç±»ä¼¼äºŽ Nginxã€MySQL è¿™ç§æ—¥å¿—ï¼Œç±»åž‹å¢žåŠ éœ€è¦è§£æžæ¯å¢žåŠ ä¸€ä¸ªå°±è¦åŽ»æ”¹ Logstash çš„ grok å—ï¼Ÿ

Aï¼šé’ˆå¯¹å¸¸ç”¨çš„æœåŠ¡ï¼Œgrok å·²ç»æä¾›äº†ä¸€äº›æ­£åˆ™çš„ patternï¼Œä¾‹å¦‚ä½ æåˆ°çš„ Nginxã€MySQLã€‚ç›®å‰æ˜¯æ¯å¢žåŠ ä¸€ä¸ªå°±éœ€è¦ä¿®æ”¹ grokï¼ŒåŽæœŸå¯ä»¥å®žçŽ°ä¸€ä¸ª UI æ¥æé«˜ä¿®æ”¹æ•ˆçŽ‡ã€‚

> Qï¼šè¿™ä¸ª lostash æ—¥å¿—æ ¼å¼è½¬æ¢æ€Žä¹ˆå­¦ä¹ ï¼Ÿ

Aï¼šLogstash æœ‰å¾ˆå®Œå–„çš„æ–‡æ¡£ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥å‚è€ƒ [www.elastic.co/guide/](https://www.elastic.co/guide/en/logstash/current/index.html)

> Qï¼šæ®è¯´ Logstash æ¯”è¾ƒåƒå†…å­˜ï¼Œfluentd ä½œä¸º EFK ç»„åˆä¹Ÿç»å¸¸å‡ºçŽ°ï¼Œè¯·é—®ä½ ä»¬æœ‰æ²¡æœ‰åšè¿‡é€‰åž‹å‘¢ï¼Ÿ

Aï¼šå½“æ—¶é€‰æ‹©äº† ELKï¼Œå°±æ²¡æœ‰åšå¤ªå¤šçš„é€‰åž‹äº†ï¼ŒLogstash åƒå†…å­˜çš„é—®é¢˜çŽ°åœ¨è¿˜ä¸æ˜¯å¤ªçªå‡ºã€‚

> Qï¼šæ—¥å¿—çš„å®Œæ•´æ€§æ€Žä¹ˆä¿è¯çš„ï¼Ÿæ€Žä¹ˆçŸ¥é“æ²¡ä¸¢æ—¥å¿—ï¼Œæˆ–ä¸¢å¤±äº†å¤šå°‘æ—¥å¿—ï¼Ÿ

Aï¼šFilebeat å’Œ Logstash çš„è¾“å‡ºæ’ä»¶éƒ½æœ‰ä¸€äº›é‡è¯•çš„ç­–ç•¥ï¼Œä½†æ˜¯ä¹Ÿå…ä¸äº†æ—¥å¿—ä¸¢å¤±ã€‚æ—¥å¿—çš„å®Œæ•´æ€§ç¡®å®žå’Œä¿è¯æ—¥å¿—ä¸ä¸¢ä¹Ÿæ˜¯æˆ‘ä»¬ç›®å‰åœ¨å°è¯•è§£å†³çš„é—®é¢˜ã€‚

> Qï¼šè¯·é—®ç›‘æŽ§ç³»ç»Ÿéœ€è¦è€ƒè™‘é«˜å¯ç”¨å—ï¼Ÿ

Aï¼šè‚¯å®šæ˜¯è¦è€ƒè™‘é«˜å¯ç”¨ï¼Œå½“åŽæœŸæ›´å¤šçš„ä¸šåŠ¡ä¾èµ–ç›‘æŽ§ç³»ç»ŸåŽï¼Œå°±è¦ä¿è¯ç›‘æŽ§ç³»ç»Ÿä¸æŒ‚ï¼ŒæŸ¥è¯¢è¦å¿«ï¼Œå®žæ—¶ç›‘æŽ§ï¼ŒæŠ¥è­¦å‡†ç¡®ç­‰ã€‚

---

### 2017-06-04ï¼šå¦‚ä½•æ‰©å±• Kubernetes ç®¡ç†çš„èµ„æºå¯¹è±¡

> Qï¼šéœ€è¦æ‰©å±•ç®¡ç†èµ„æºå¯¹è±¡çš„åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿèƒ½å¦ä¸¾ä¸ªä¾‹å­è¯´æ˜Žä¸€ä¸‹ï¼Ÿ

Aï¼šä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼ŒNginx ä½œä¸ºåå‘ä»£ç†ï¼Œæˆ‘ä»¬éœ€è¦éžå¸¸è¯¦ç»†çš„ç®¡ç†å…·ä½“é…ç½®ï¼Œå¹¶ä¸” Nginx çš„ upstream ä¸å•å•æ˜¯å®¹å™¨è¿˜æœ‰è®¸å¤šéƒ¨ç½²åœ¨ç‰©ç†æœºå’Œè™šæ‹Ÿæœºä¸Šçš„åº”ç”¨ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬éœ€è¦å…·ä½“å®šä¹‰ä¸“é—¨ç®¡ç† Nginx çš„èµ„æºå¯¹è±¡ï¼›ç”±äºŽä¼ä¸šåº”ç”¨åœºæ™¯æ˜¯ååˆ†å…·ä½“çš„ï¼Œä¹Ÿå°±éœ€è¦å¯¹äºŽèµ„æºåšå…·ä½“æè¿°ã€‚

> Qï¼šèƒ½å¦è®²ä¸‹å…·ä½“åº”ç”¨åœºæ™¯å’Œè”é‚¦åŽçš„ç”¨æ³•ï¼Ÿ

Aï¼šåœºæ™¯ä¸Šä¸ªé—®é¢˜è®²è¿‡äº†ï¼Œå…³äºŽè”é‚¦æˆ‘ç›®å‰çš„æ–¹æ¡ˆæ˜¯åœ¨è‡ªå®šä¹‰çš„ Controller é‡Œåšç›¸å…³è”ç³»å’Œæ“ä½œã€‚

> Qï¼šæ‰©å±• API Server å’Œé€šè¿‡ third party resource +controller çš„æ–¹å¼ç›¸æ¯”æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿæ”¯æŒå’Œå¤šä¸ªé›†ç¾¤çš„è”é‚¦å—ï¼ŸKubernetes ç¤¾åŒºå¯¹è¿™ä¸¤ç§æ‰©å±•æ¨¡å¼çš„æ€åº¦æ˜¯æ€Žä¹ˆæ ·çš„ï¼Ÿ

Aï¼šé¦–å…ˆ third party resource åœ¨ Kubernetes é‡Œä¸€ç›´ä¸æ˜¯å¾ˆç¨³å®šï¼Œå†è€… third party resource å’ŒåŽŸç”Ÿèµ„æºæœ‰å¾ˆå¤šä¸åŒï¼ˆå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰ï¼Œæ»¡è¶³ä¸€äº›å°çš„åœºæ™¯å¯ä»¥ï¼Œä½†æ˜¯å¯¹äºŽæ·±åº¦å®šåˆ¶åŒ–ï¼ˆèµ„æºä¹‹é—´å…³è”ã€æƒé™é™åˆ¶ç­‰ï¼‰ï¼Œæˆ‘è¿˜æ˜¯ä¼šé€‰æ‹©æ‰©å±• API Serverã€‚

---

### 2017-06-02ï¼šæŽ¢ç´¢ Kubernetes çš„ç½‘ç»œåŽŸç†åŠæ–¹æ¡ˆ

> Qï¼šA çš„ Pod å¦‚ä½•è¿žæŽ¥ B çš„ Podï¼Ÿ kube-dns èµ·åˆ°ä»€ä¹ˆä½œç”¨ï¼Ÿkube-dns å¦‚æžœè°ƒç”¨ kube-proxyï¼Ÿ

Aï¼šè¿™é‡Œè¯´çš„ A å’Œ B åº”å½“æ˜¯æŒ‡ Serviceï¼ŒA Service ä¸­ Pod ä¸Ž B Service Pod ä¹‹é—´çš„é€šä¿¡ï¼Œå¯ä»¥åœ¨å…¶å®¹å™¨çš„çŽ¯å¢ƒå˜é‡ä¸­å®šä¹‰ Service IP æˆ–æ˜¯ Service Name æ¥å®žçŽ°ï¼›ç”±äºŽ Service IP æå‰ä¸çŸ¥é“ï¼Œä½¿ç”¨å¼•å…¥ kube-dns åšæœåŠ¡å‘çŽ°ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ç›‘å¬ Service å˜åŒ–å¹¶æ›´æ–° DNSï¼Œå³ Pod é€šè¿‡æœåŠ¡åç§°å¯ä»¥æŸ¥è¯¢ DNSï¼›kube-proxy æ˜¯ä¸€ä¸ªç®€å•çš„ç½‘ç»œä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒçš„ä½œç”¨ä¸»è¦æ˜¯è´Ÿè´£ service çš„å®žçŽ°ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯å®žçŽ°äº†å†…éƒ¨ä»Ž Pod åˆ° Service å’Œå¤–éƒ¨çš„ä»Ž NodePort å‘ Service çš„è®¿é—®ï¼Œå¯ä»¥è¯´ kube-dns å’Œ kube-proxy éƒ½æ˜¯ä¸º Service æœåŠ¡çš„ã€‚

> Qï¼šç½‘ç»œé—®é¢˜ docker default æ˜¯ç½‘æ¡¥æ¨¡å¼ï¼ˆNATï¼‰å¦‚æžœç”¨è·¯ç”±çš„æ¨¡å¼ï¼Œæ‰€ä»¥ Pod çš„ç½‘å…³éƒ½ä¼šæ˜¯ docker 0 IP ï¼Ÿ é‚£ Pod 1 ä¸Ž Pod2 ä¹‹é—´ä¹Ÿèµ°è·¯ç”± ï¼Œè¿™ä¼šä½¿è·¯ç”±è¡¨å¾ˆå¤§ï¼Ÿ Flannel ç½‘ç»œæ˜¯ä¸æ˜¯å¯ä»¥æŠŠæ‰€æœ‰çš„ Node ä¸Šï¼Œç›¸å½“äºŽä¸€ä¸ªåˆ†å¸ƒå¼äº¤æ¢æœºï¼Ÿ

Aï¼šDocker å®žçŽ°è·¨ä¸»æœºé€šä¿¡å¯ä»¥é€šè¿‡æ¡¥æŽ¥å’Œè·¯ç”±çš„æ–¹å¼ï¼Œæ¡¥æŽ¥çš„æ–¹å¼æ˜¯å°† docker0 æ¡¥æŽ¥åœ¨ä¸»æœºçš„ç½‘å¡ä¸Šï¼Œè€Œè·¯ç”±ç›´æŽ¥é€šè¿‡ä¸»æœºç½‘å£è½¬å‘å‡ºåŽ»ï¼›Kubernetes ç½‘ç»œæœ‰ Pod å’Œ Serverï¼ŒPod ç½‘ç»œå®žçŽ°çš„æ–¹å¼å¾ˆå¤šï¼Œå¯ä»¥å‚è€ƒ CNI ç½‘ç»œæ¨¡åž‹ï¼ŒFlannel å®žè´¨ä¸Šæ˜¯ä¸€ç§"è¦†ç›–ç½‘ç»œï¼ˆOverlay Networkï¼‰"ï¼Œä¹Ÿå°±æ˜¯å°† TCP æ•°æ®åŒ…è£…åœ¨å¦ä¸€ç§ç½‘ç»œåŒ…é‡Œé¢è¿›è¡Œè·¯ç”±è½¬å‘å’Œé€šä¿¡ã€‚

> Qï¼šå¤§è§„æ¨¡å®¹å™¨é›†ç¾¤å¦‚ä½•ä¿è¯å®‰å…¨? ä¸»è¦ä»Žå‡ ä¸ªæ–¹é¢è€ƒè™‘ï¼Ÿ

Aï¼šä¸€ä¸ªå¤§è§„æ¨¡å®¹å™¨é›†ç¾¤ä»Žå®‰å…¨æ€§è€ƒè™‘æ¥è®²ï¼Œå¯ä»¥åˆ†ä¸ºå‡ ä¸ªæ–¹é¢ï¼š1ã€é›†ç¾¤å®‰å…¨ï¼ŒåŒ…æ‹¬é›†ç¾¤é«˜å¯ç”¨ï¼›2ã€è®¿é—®å®‰å…¨ï¼ŒåŒ…æ‹¬è®¤è¯ã€æŽˆæƒã€è®¿é—®æŽ§åˆ¶ç­‰ï¼›3ã€èµ„æºéš”ç¦»ï¼ŒåŒ…æ‹¬å¤šç§Ÿæˆ·ç­‰ï¼›4ã€ç½‘ç»œå®‰å…¨ï¼ŒåŒ…æ‹¬ç½‘ç»œéš”ç¦»ã€æµé‡æŽ§åˆ¶ç­‰ï¼›5ã€é•œåƒå®‰å…¨ï¼ŒåŒ…æ‹¬å®¹å™¨æ¼æ´žç­‰ï¼›6ã€å®¹å™¨å®‰å…¨ï¼ŒåŒ…æ‹¬ç«¯å£æš´éœ²ã€privileged æƒé™ç­‰ã€‚

> Qï¼šSVC å¦‚ä½•è¿›è¡Œå®¢æˆ·ç«¯åˆ†æµï¼ŒA ç½‘æ®µçš„è®¿é—® Pod1ï¼ŒB ç½‘æ®µçš„è®¿é—® Pod2ï¼ŒC ç½‘æ®µçš„è®¿é—® Pod3ï¼Œ3 ä¸ª Pod éƒ½åœ¨ SVC çš„ Endpoint ä¸­ï¼Ÿ

Aï¼šå†…éƒ¨ä»Ž Pod åˆ° Service çš„å®žçŽ°æ˜¯ç”± kube-proxyï¼ˆç®€å•çš„ç½‘ç»œä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ï¼‰æ¥å®Œæˆï¼Œkube-proxy é»˜è®¤é‡‡ç”¨è½®è¯¢æ–¹æ³•è¿›è¡Œåˆ†é…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å°† service.spec.sessionAffinity è®¾ç½®ä¸º"ClientIP"ï¼ˆé»˜è®¤ä¸º"æ— "ï¼‰æ¥é€‰æ‹©åŸºäºŽå®¢æˆ·ç«¯ IP çš„ä¼šè¯å…³è”ï¼Œç›®å‰è¿˜ä¸èƒ½è¿›è¡Œç½‘æ®µçš„æŒ‡å®šã€‚

> Qï¼šå¯¹äºŽ Ingress+HAProxy è¿™ç§å®žçŽ° Service è´Ÿè½½å‡è¡¡çš„æ–¹å¼ï¼ŒIngresscontroller è½®è¯¢ Service åŽé¢çš„ Pods çŠ¶æ€ï¼Œå¹¶é‡æ–°ç”Ÿæˆ HAProxy é…ç½®æ–‡ä»¶ï¼Œç„¶åŽé‡å¯ HAProxyï¼Œä»Žè€Œè¾¾åˆ°æœåŠ¡å‘çŽ°çš„ç›®çš„ã€‚è¿™ç§åŽŸç†å¯¹äºŽ HAProxy æ¥è®²æ˜¯ä¸æ˜¯æœåŠ¡ä¼šæš‚æ—¶é—´æ–­ã€‚æœ‰æ²¡æœ‰å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Ÿä¹‹å‰çœ‹åˆ° Golang å®žçŽ°çš„ TrÃ¦fikï¼Œå¯æ— ç¼å¯¹æŽ¥ Kubernetesï¼ŒåŒæ—¶ä¸éœ€è¦ Ingress äº†ã€‚æ–¹æ¡ˆå¯è¡Œä¹ˆï¼Ÿ

Aï¼šç”±äºŽå¾®æœåŠ¡æž¶æž„ä»¥åŠ Docker æŠ€æœ¯å’Œ Kubernetes ç¼–æŽ’å·¥å…·æœ€è¿‘å‡ å¹´æ‰å¼€å§‹é€æ¸æµè¡Œï¼Œæ‰€ä»¥ä¸€å¼€å§‹çš„åå‘ä»£ç†æœåŠ¡å™¨æ¯”å¦‚ Nginx/HAProxy å¹¶æœªæä¾›å…¶æ”¯æŒï¼Œæ¯•ç«Ÿä»–ä»¬ä¹Ÿä¸æ˜¯å…ˆçŸ¥ï¼Œæ‰€ä»¥æ‰ä¼šå‡ºçŽ° IngressController è¿™ç§ä¸œè¥¿æ¥åš Kubernetes å’Œå‰ç«¯è´Ÿè½½å‡è¡¡å™¨å¦‚ Nginx/HAProxy ä¹‹é—´åšè¡”æŽ¥ï¼Œå³ Ingress Controller çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†èƒ½è·Ÿ Kubernetes äº¤äº’ï¼Œåˆèƒ½å†™ Nginx/HAProxy é…ç½®ï¼Œè¿˜èƒ½ reload å®ƒï¼Œè¿™æ˜¯ä¸€ç§æŠ˜ä¸­æ–¹æ¡ˆï¼›è€Œæœ€è¿‘å¼€å§‹å‡ºçŽ°çš„ Traefik å¤©ç”Ÿå°±æ˜¯æä¾›äº†å¯¹ Kubernetes çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯è¯´ Traefik æœ¬èº«å°±èƒ½è·Ÿ Kubernetes API äº¤äº’ï¼Œæ„ŸçŸ¥åŽç«¯å˜åŒ–ï¼Œå› æ­¤åœ¨ä½¿ç”¨ Traefik æ—¶å°±ä¸éœ€è¦ Ingress Controllerï¼Œæ­¤æ–¹æ¡ˆå½“ç„¶å¯è¡Œã€‚

> Qï¼š1ã€ä¸€ä¸ª POD é‡Œé¢çš„å¤šä¸ª Container æ˜¯åŒä¸€ä¸ª Service çš„ï¼Ÿè¿˜æ˜¯ç”±ä¸åŒçš„ Service çš„ç»„æˆï¼Ÿæ˜¯å•¥æ ·çš„åˆ†é…é€»è¾‘ï¼Ÿ 2ã€Flannel æ˜¯å®žçŽ°å¤šä¸ªå®¿ä¸»æœºä¸Šçš„ N å¤šçš„ Service ä»¥åŠ Pod é‡Œé¢çš„å„ä¸ª Container çš„ IP çš„å”¯ä¸€æ€§ä¹ˆï¼Ÿ3ã€Kubernetes å…·å¤‡è´Ÿè½½å‡è¡¡çš„æ•ˆæžœ ã€‚é‚£æ˜¯å¦å°±ä¸ç”¨åœ¨è€ƒè™‘ Nigixï¼Ÿ

Aï¼šPod æ˜¯ Kubernetes çš„åŸºæœ¬æ“ä½œå•å…ƒï¼ŒPod åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªç›¸å…³çš„å®¹å™¨ï¼ŒPod å¯ä»¥è®¤ä¸ºæ˜¯å®¹å™¨çš„ä¸€ç§å»¶ä¼¸æ‰©å±•ï¼Œä¸€ä¸ª Pod ä¹Ÿæ˜¯ä¸€ä¸ªéš”ç¦»ä½“ï¼Œè€Œ Pod å†…éƒ¨åŒ…å«çš„ä¸€ç»„å®¹å™¨åˆæ˜¯å…±äº«çš„ï¼ˆåŒ…æ‹¬ PIDã€Networkã€IPCã€UTSï¼‰ï¼›Service æ˜¯ Pod çš„è·¯ç”±ä»£ç†æŠ½è±¡ï¼Œèƒ½è§£å†³ Pod ä¹‹é—´çš„æœåŠ¡å‘çŽ°é—®é¢˜ï¼›Flannel çš„è®¾è®¡ç›®çš„å°±æ˜¯ä¸ºé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹é‡æ–°è§„åˆ’ IP åœ°å€çš„ä½¿ç”¨è§„åˆ™ï¼Œä»Žè€Œä½¿å¾—ä¸åŒèŠ‚ç‚¹ä¸Šçš„å®¹å™¨èƒ½å¤ŸèŽ·å¾—"åŒå±žä¸€ä¸ªå†…ç½‘"ä¸”"ä¸é‡å¤çš„"IP åœ°å€ï¼Œå¹¶è®©å±žäºŽä¸åŒèŠ‚ç‚¹ä¸Šçš„å®¹å™¨èƒ½å¤Ÿç›´æŽ¥é€šè¿‡å†…ç½‘ IP é€šä¿¡ï¼›Kubernetes kube-proxy å®žçŽ°çš„æ˜¯å†…éƒ¨ L4 å±‚è½®è¯¢æœºåˆ¶çš„è´Ÿè½½å‡è¡¡ï¼Œè¦æ”¯æŒ L4ã€L7 è´Ÿè½½å‡è¡¡ï¼ŒKubernetes ä¹Ÿæä¾›äº† Ingress ç»„ä»¶ï¼Œé€šè¿‡åå‘ä»£ç†è´Ÿè½½å‡è¡¡å™¨ï¼ˆNginx/HAProxyï¼‰+Ingress Controller+Ingress å¯ä»¥å®žçŽ°å¯¹å¤–æœåŠ¡æš´éœ²ï¼Œå¦å¤–ä½¿ç”¨ Traefik æ–¹æ¡ˆæ¥å®žçŽ° Service çš„è´Ÿè½½å‡è¡¡ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„é€‰æ‹©ã€‚

> Qï¼škube-proxy æ˜¯æ€Žæ ·è¿›è¡Œè´Ÿè½½ï¼Ÿ Service è™šæ‹Ÿ IP å­˜åœ¨å“ªé‡Œï¼Ÿ

Aï¼škube-proxy æœ‰ 2 ä¸ªæ¨¡å¼å®žçŽ°è´Ÿè½½å‡è¡¡ï¼Œä¸€ç§æ˜¯ userspaceï¼Œé€šè¿‡ Iptables é‡å®šå‘åˆ° kube-proxy å¯¹åº”çš„ç«¯å£ä¸Šï¼Œç„¶åŽç”± kube-proxy è¿›ä¸€æ­¥æŠŠæ•°æ®å‘é€åˆ°å…¶ä¸­çš„ä¸€ä¸ª Pod ä¸Šï¼Œå¦ä¸€ç§æ˜¯ Iptablesï¼Œçº¯é‡‡ç”¨ Iptables æ¥å®žçŽ°è´Ÿè½½å‡è¡¡ï¼Œkube-proxy é»˜è®¤é‡‡ç”¨è½®è¯¢æ–¹æ³•è¿›è¡Œåˆ†é…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å°† service.spec.sessionAffinity è®¾ç½®ä¸º"ClientIP"ï¼ˆé»˜è®¤ä¸º"æ— "ï¼‰æ¥é€‰æ‹©åŸºäºŽå®¢æˆ·ç«¯ IP çš„ä¼šè¯å…³è”ï¼›Service Cluster IP å®ƒæ˜¯ä¸€ä¸ªè™šæ‹Ÿ IPï¼Œæ˜¯ç”± kube-proxy ä½¿ç”¨ Iptables è§„åˆ™é‡æ–°å®šå‘åˆ°å…¶æœ¬åœ°ç«¯å£ï¼Œå†å‡è¡¡åˆ°åŽç«¯ Pod çš„ï¼Œé€šè¿‡ apiserver çš„å¯åŠ¨å‚æ•°\--service-cluster-ip-range æ¥è®¾ç½®ï¼Œç”± kubernetes é›†ç¾¤å†…éƒ¨ç»´æŠ¤ã€‚

> Qï¼šKubernetes ç½‘ç»œå¤æ‚ï¼Œå¦‚æžœè¦å®žçŽ°è¿œç¨‹è°ƒè¯•ï¼Œè¯¥æ€Žä¹ˆåšï¼Œç«¯å£æ˜ å°„çš„æ–¹å¼ä¼šæœ‰ä»€ä¹ˆæ ·çš„éšæ‚£ï¼Ÿ

Aï¼šKubernetes ç½‘ç»œè¿™å—é‡‡ç”¨çš„æ˜¯ CNI è§„èŒƒï¼Œç½‘ç»œæ’ä»¶åŒ–ï¼Œéžå¸¸çµæ´»ï¼Œä¸åŒçš„ç½‘ç»œæ’ä»¶è°ƒè¯•çš„æ–¹æ³•ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼›ç«¯å£æ˜ å°„æ–¹å¼çš„æœ€å¤§éšæ‚£å°±æ˜¯å¾ˆå®¹æ˜“é€ æˆç«¯å£å†²çªã€‚

> Qï¼šRPC çš„æœåŠ¡æ³¨å†Œï¼ŒæŠŠæœ¬æœº IP æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œå¦‚æžœåœ¨å®¹å™¨é‡Œé¢ä¼šæ³¨å†Œé‚£ä¸ªè™šæ‹Ÿ IPï¼Œé›†ç¾¤å¤–é¢æ²¡æ³•è°ƒç”¨ï¼Œæœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ

Aï¼šKubernetes Service åˆ° Pod çš„é€šä¿¡æ˜¯ç”± kube-proxy ä»£ç†åˆ†å‘ï¼Œè€Œ Pod ä¸­å®¹å™¨çš„é€šä¿¡æ˜¯é€šè¿‡ç«¯å£ï¼Œä¸åŒ Service é—´é€šä¿¡å¯ä»¥é€šè¿‡ DNSï¼Œä¸ä¸€å®šè¦ä½¿ç”¨è™šæ‹Ÿ IPã€‚

> Qï¼šæˆ‘çŽ°åœ¨æ‰ç”¨çš„æ˜¯ CoreOS ä½œä¸ºåº•å±‚ï¼Œæ‰€ä»¥ç½‘ç»œé‡‡ç”¨çš„æ˜¯ Flannel ä½†æ˜¯ä¸Šå±‚ç”¨ Calico ä½œä¸º NetworkPolicyï¼Œæœ€è¿‘æœ‰ä¸€ä¸ª Canal çš„ç»“æž„å’Œè¿™ä¸ªæ¯”è¾ƒç±»ä¼¼ï¼Œèƒ½ä»‹ç»ä¸€ä¸‹ä¹ˆï¼Œå¯ä»¥çš„è¯ï¼Œèƒ½è¯¦ç»†ä»‹ç»ä¸€ä¸‹ CNI åŽŸç†å’Œ Callico çš„ Policy å®žçŽ°ä¹ˆï¼Ÿ

Aï¼šCanal ä¸æ˜¯å¾ˆäº†è§£ï¼›CNI å¹¶ä¸æ˜¯ç½‘ç»œå®žçŽ°ï¼Œå®ƒæ˜¯ç½‘ç»œè§„èŒƒå’Œç½‘ç»œä½“ç³»ï¼Œä»Žç ”å‘çš„è§’åº¦å®ƒå°±æ˜¯ä¸€å †æŽ¥å£ï¼Œå…³å¿ƒçš„æ˜¯ç½‘ç»œç®¡ç†çš„é—®é¢˜ï¼ŒCNI çš„å®žçŽ°ä¾èµ–äºŽä¸¤ç§ Pluginï¼Œä¸€ç§æ˜¯ CNI Plugin è´Ÿè´£å°†å®¹å™¨ connect/disconnect åˆ° host ä¸­çš„ vbridge/vswitchï¼Œå¦ä¸€ç§æ˜¯ IPAM Plugin è´Ÿè´£é…ç½®å®¹å™¨ Namespace ä¸­çš„ç½‘ç»œå‚æ•°ï¼›Calico çš„ policy æ˜¯åŸºäºŽ Iptablesï¼Œä¿è¯é€šè¿‡å„ä¸ªèŠ‚ç‚¹ä¸Šçš„ ACLs æ¥æä¾› workload çš„å¤šç§Ÿæˆ·éš”ç¦»ã€å®‰å…¨ç»„ä»¥åŠå…¶ä»–å¯è¾¾æ€§é™åˆ¶ç­‰åŠŸèƒ½ã€‚

> Qï¼šCNI æ˜¯æ€Žä¹ˆç®¡ç†ç½‘ç»œçš„ï¼Ÿæˆ–è€…è¯´å®ƒè·Ÿç½‘ç»œæ–¹æ¡ˆä¹‹é—´æ˜¯æ€Žä¹ˆé…åˆçš„ï¼Ÿ

Aï¼šCNI å¹¶ä¸æ˜¯ç½‘ç»œå®žçŽ°ï¼Œå®ƒæ˜¯ç½‘ç»œè§„èŒƒå’Œç½‘ç»œä½“ç³»ï¼Œä»Žç ”å‘çš„è§’åº¦å®ƒå°±æ˜¯ä¸€å †æŽ¥å£ï¼Œä½ åº•å±‚æ˜¯ç”¨ Flannel ä¹Ÿå¥½ã€ç”¨ Calico ä¹Ÿå¥½ï¼Œå®ƒå¹¶ä¸å…³å¿ƒï¼Œå®ƒå…³å¿ƒçš„æ˜¯ç½‘ç»œç®¡ç†çš„é—®é¢˜ï¼ŒCNI çš„å®žçŽ°ä¾èµ–äºŽä¸¤ç§ pluginï¼Œä¸€ç§æ˜¯ CNI Plugin è´Ÿè´£å°†å®¹å™¨ connect/disconnect åˆ° host ä¸­çš„ vbridge/vswitchï¼Œå¦ä¸€ç§æ˜¯ IPAM Plugin è´Ÿè´£é…ç½®å®¹å™¨ Namespace ä¸­çš„ç½‘ç»œå‚æ•°ã€‚

> Qï¼šService æ˜¯ä¸ªå®žä½“ç»„ä»¶ä¹ˆï¼Ÿé‚£äº›ä¸ª Service é…ç½®æ–‡ä»¶ï¼Œä»€ä¹ˆéƒ¨ä»¶æ¥æ‰§è¡Œå‘¢ï¼Ÿ

Aï¼šServices æ˜¯ Kubernetes çš„åŸºæœ¬æ“ä½œå•å…ƒï¼Œæ˜¯çœŸå®žåº”ç”¨æœåŠ¡çš„æŠ½è±¡ï¼ŒService IP èŒƒå›´åœ¨é…ç½® kube-apiserver æœåŠ¡çš„æ—¶å€™é€šè¿‡--service-cluster-ip-range å‚æ•°æŒ‡å®šï¼Œç”± Kubernetes é›†ç¾¤è‡ªèº«ç»´æŠ¤ã€‚

---

### 2017-05-24ï¼šå–œé©¬æ‹‰é›… FM æµ‹è¯•çŽ¯å¢ƒçš„ Docker åŒ–å®žè·µæ¡ˆä¾‹

> Qï¼šé•œåƒç²¾ç‚¼å½±å“å¾ˆå¤§å—ï¼ŸDocker ç›¸åŒå±‚ä¸æ˜¯åªä¸‹è½½ä¸€æ¬¡å—ï¼Ÿ

Aï¼šæˆ‘ä»¬ç»å¤§éƒ¨åˆ†æ˜¯ Java é¡¹ç›®ï¼Œé€šå¸¸ä¸€ä¸ª war åŒ…äº”å…­å Mï¼Œæ›´å¤§çš„ä¹Ÿæœ‰ï¼Œå ç”¨ä¸€ä¸ª layerã€‚é¢‘ç¹çš„å‘å¸ƒå’Œéƒ¨ç½²ï¼Œä»…ä»…æ˜¯ä¸‹è½½è¿™ä¸€ä¸ª layerï¼Œæ—¶é—´ä¸Šè¿˜æ˜¯æœ‰ä¸€ç‚¹è€—æ—¶çš„ã€‚

> Qï¼šç½‘ç»œå¯¹äºŽ Kubernetes å‡ºæ¥å®¹æ˜“ï¼Œè¿›åŽ»å¾ˆéš¾ã€‚ä¸çŸ¥é“ä½ ä»¬è¯´çš„ç‰©ç†æœºå’Œ Docker ç½‘ç»œæ˜¯æ€Žä¹ˆäº’é€šçš„ï¼Ÿå¸Œæœ›èƒ½è¯¦ç»†è¯´ä¸‹ã€‚

Aï¼šé¦–å…ˆé€šè¿‡ docker ipam driver æˆ‘ä»¬ä¸ºæ¯ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ª IPï¼ŒDocker æœ¬èº«ä¹Ÿæ”¯æŒ MacVLANï¼Œä¸å‡†ç¡®çš„è¯´ï¼Œç›¸å½“äºŽæ¯ä¸ªå®¹å™¨æœ‰ä¸€ä¸ªç‰©ç†ç½‘å¡ï¼Œåªæ˜¯å’Œç‰©ç†æœºç½‘æ®µä¸åŒã€‚æˆ‘ä»¬é€šè¿‡äº¤æ¢æœºè¿žé€šä¸¤ä¸ªç½‘æ®µã€‚

> Qï¼šé—®ä¸€ä¸‹ï¼Œé…ç½®çš„ç»Ÿä¸€ç®¡ç†æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿå“ªäº›é…ç½®ä¿¡æ¯åšäº†ç»Ÿä¸€ç®¡ç†ï¼Œæ•°æ®åº“çš„é“¾æŽ¥ä¿¡æ¯ä¹Ÿæ˜¯æ”¾åˆ°é…ç½®ä¿¡æ¯é‡Œå—ï¼Ÿ

Aï¼šå¯èƒ½æˆ‘æ–‡ä¸­ç”¨é…ç½®ä¸€è¯ä¸å¤ªå¯¹ï¼Œæ–‡ä¸­çš„é…ç½®æ›´å¤šæŒ‡çš„æ˜¯ï¼ŒTomcat çš„å®‰è£…ç›®å½•ï¼ŒTomcat çš„ Web ç«¯å£ã€debug ç«¯å£å·ï¼Œæ—¥å¿—ç›®å½•å‘½åç­‰çº¦å®šã€‚è¿™ä¸ªæ˜¯åšé•œåƒæ—¶ä¾¿å·²ç»ç¡®å®šçš„ã€‚

> Qï¼šå®¹å™¨æœ‰äº†å›ºå®š IP é‚£ä¹ˆå°±ä¸éœ€è¦ NAT äº†ï¼Œé‚£ä¹ˆåœ¨åŽŸ Mesos ä¸‹çš„æœåŠ¡å‘çŽ°å°±ä¸é€‚ç”¨äº†ï¼Œèƒ½è¯¦ç»†ä»‹ç»ä¸‹è¿™å—æ€Žä¹ˆæžä¹ˆï¼Ÿ

Aï¼šä»Žæ ¹æœ¬ä¸Šï¼Œä¸ç®¡å®¹å™¨ IP å˜ä¸å˜ï¼Œå› ä¸ºä»¥åŽåšæ‰©å®¹ç¼©å®¹ï¼Œæˆ‘ä»¬è®¤ä¸ºæœåŠ¡çš„ IP æ€»æ˜¯ä¼šå˜å¾—ã€‚å› æ­¤æˆ‘ä»¬å†™äº† Nginx æ’ä»¶ç­‰é¢å¤–ç»„ä»¶æ¥å±è”½ IP çš„å˜åŒ–ï¼Œè€Œä¸æ˜¯å°è¯•è®© IP ä¸å˜ã€‚

> Qï¼šæ€Žä¹ˆæ”¶é›† Tomcat å¯åŠ¨æ—¶çš„ logï¼Ÿ æœ‰æ²¡æœ‰æƒ³è¿‡ç”¨ WebSocketï¼Ÿ

Aï¼šæˆ‘ä»¬å…¬å¸æœ‰è‡ªå·±çš„æ—¥å¿—é‡‡é›†ç³»ç»Ÿï¼Œå¯ä»¥é‡‡é›†å¹¶åˆ†æžä¸šåŠ¡æ—¥å¿—ã€‚è‡³äºŽ Tomcat æ—¥å¿—ï¼Œæˆ‘ä»¬ä¸šåŠ¡ä¸Šæš‚æ—¶è¿˜ä¸éœ€è¦é‡‡é›†ã€‚æˆ‘ä»¬æœ‰è‡ªå·±çš„æ‰‹æ®µæ¥é‡‡é›† Tomcat è¿è¡ŒçŠ¶æ€ã€‚è¿™é‡Œé¡ºä¾¿è¯´ä¸‹ï¼Œå¾ˆå¤šæ–¹æ¡ˆæˆ‘ä»¬çš„é€‰æ‹©ï¼Œæ˜¯åŸºäºŽå…¬å¸ç›®å‰å·²æœ‰çš„ä¸€äº›æ¡†æž¶å·¥å…·ï¼Œå¤§å®¶è¦æŒ‰ç…§è‡ªå·±çš„æƒ…å†µå› åœ°åˆ¶å®œã€‚

> Qï¼šå°†å®¹å™¨çš„åº”ç”¨ç«¯å£æ˜ å°„åˆ°ä¸»æœºç«¯å£ï¼Œèƒ½ä¸èƒ½è§£å†³ IP å˜åŒ–é—®é¢˜ï¼Ÿ

Aï¼šå› ä¸ºå®¹å™¨ä¼šåœ¨ä¸»æœºä¹‹é—´æ¼‚ç§»ï¼Œæˆ‘ä»¬é€šè¿‡"ç‰©ç†æœº IPï¼šç‰©ç†æœº port"æ¥è®¿é—®å®¹å™¨æ—¶ï¼Œå®¹å™¨å¯¹åº”çš„ç‰©ç†æœº IP åœ¨ deploy åŽï¼Œè¿˜æ˜¯ä¼šå˜å¾—ã€‚

---

### 2017-05-19ï¼šåŸºäºŽ Kubernetes çš„ç§æœ‰å®¹å™¨äº‘å»ºè®¾å®žè·µ

> Qï¼šè¯·æ•™ä¸€ä¸‹å¤„ç† CI æ—¶ï¼Œæ¯”å¦‚é›†ç¾¤è‡ªåŠ¨åŒ–éƒ¨ç½²æ–¹é¢çš„ç²’åº¦æ˜¯æ€Žæ ·çš„ï¼Ÿæ¯”å¦‚ä¿®å¤ä¸€ä¸ª bug æ”¹äº†ä¸€ä¸ª class æ–‡ä»¶ï¼Œç„¶åŽæœ¬åœ°æµ‹è¯•å®Œä¹‹åŽéœ€è¦åˆ°çº¿ä¸Šéƒ¨ç½²è¿› AB æµ‹è¯•ï¼Œé‚£ä¹ˆå°±ç›´æŽ¥é€šè¿‡ CI è‡ªåŠ¨éƒ¨ç½²åˆ°é›†ç¾¤æœåŠ¡å™¨å—ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„åšæ³•æ˜¯åªè¦æœ‰ä¿®æ”¹å°±è§¦å‘é‡æ–°æž„å»ºï¼Œè¿™åªé€‚åˆæˆ‘ä»¬å…¬å¸çš„æƒ…å†µï¼Œæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ…å†µåšå‡ºç²’åº¦é€‰æ‹©ã€‚

> Qï¼šèƒ½è¯¦ç»†è¯´è¯´ Dubbo åº”ç”¨è¿ç§»é‡åˆ°çš„é—®é¢˜åŠè§£å†³åŠžæ³•å—ï¼Ÿ

Aï¼šè§£å†³æ–¹æ¡ˆæ¯”è¾ƒç²—æš´ï¼Œå¯¹äºŽ Flannelï¼ŒContainer å¯ä»¥å¾€å‡ºåŽ»ï¼Œä½†æ˜¯å¤–é¢çš„è¯·æ±‚è¿›ä¸åˆ° Containerï¼Œå› ä¸ºæˆ‘ä»¬ç‰©ç†æœºè§„æ¨¡æœ‰é™ï¼Œæˆ‘ä»¬å°±é…ç½®é™æ€è·¯ç”±ï¼Œåªè¦è®©åˆ°è¾¾ Node çš„èƒ½æ‰¾åˆ° Container å°±è¡Œäº†ã€‚

> Qï¼šè‡ªåŠ¨ç”Ÿæˆ Dockerfile çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ ·åšæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ ‡å‡†åŒ–è§„èŒƒåŒ–çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„åº”ç”¨å¤§å¤šæ˜¯ Java Webï¼Œç›¸ä¼¼åº¦å¾ˆé«˜ï¼Œæ‰€ä»¥å¯ä»¥è‡ªåŠ¨ç”Ÿæˆï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šéœ€è¦å¼€å‘è‡ªå·±å†™çš„ï¼›å¦å¤–ï¼Œæˆ‘ä»¬åœ¨ CI å¹³å°é‡Œï¼Œç•™å‡ºäº†ç¼–è¾‘ Docker çš„å£å­ï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹ç‰¹æ®Šçš„æƒ…å†µè‡ªå·±ç¼–å†™ï¼Œä½†æ˜¯è¿™ç§æ˜¯éžå¸¸å°‘æ•°çš„æƒ…å†µã€‚CI è·Ÿæ¯ä¸ªä¼ä¸šçš„ä¸šåŠ¡æƒ…å†µç´§å¯†ç›¸å…³ï¼Œè¿˜æ˜¯å…·ä½“æƒ…å†µå…·ä½“åˆ†æžå§ã€‚

> Qï¼šæˆ‘èµ·äº†ä¸€äº› Podï¼Œå¯¹å¤–æœ‰ Serviceï¼Œç„¶åŽæˆ‘æƒ³è®© Pod å®žçŽ°å•ä»»åŠ¡ï¼Œä½†é—®é¢˜æ˜¯ï¼ŒService å¯¹ Pod é€‰æ‹©æœºåˆ¶æ˜¯éšæœºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰å¯èƒ½ä¼šå‡ºçŽ°å¤šä¸ªä»»åŠ¡è¯·æ±‚åˆ°ä¸€ä¸ª Pod ä¸Šï¼Œè¾¾ä¸åˆ°æˆ‘çš„è¦æ±‚ï¼Œæ€Žä¹ˆè§£å†³ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜æˆ‘ä¸ªäººçš„ç†è§£ï¼Œæ‚¨è¦è§£å†³çš„é—®é¢˜è·Ÿä¸€ä¸ª Service å¯¹åº”å¤šä¸ª Pod çš„åœºæ™¯ä¸å¤ªå»åˆï¼Œæˆ‘å»ºè®®æ‚¨è€ƒè™‘å…¶ä»–çš„æ–¹å¼å®žçŽ°ï¼Œæ¯”å¦‚å¤šä¸ª sevice-pod çš„ç»„åˆç­‰ç­‰ï¼Œæˆ–è€…è€ƒè™‘å…¶ä»–çš„æ–¹å¼ã€‚

> Qï¼šã€ŒKubernetes master é«˜å¯ç”¨ã€å¦‚ä½•è®¾è®¡ï¼Ÿå¤šä¸ªæ•°æ®ä¸­é—´æ˜¯ stand-by å…³ç³»ï¼Ÿ

Aï¼šAPI Server æ˜¯æ— çŠ¶æ€çš„ï¼Œå¯ä»¥éƒ¨ç½²å¤šä¸ªï¼Œå‰ç«¯è´Ÿè½½å‡è¡¡ï¼ŒScheduler/ControllerManager æœ‰çŠ¶æ€å¯ä»¥åšæˆä¸»å¤‡ã€‚Kubernetes è¿˜ç®—ç¨³å®šï¼ˆå½“ç„¶æˆ‘ä»¬çš„é‡å°ï¼‰ã€‚

> Qï¼šè´µå¸ä½¿ç”¨çš„ Kubernetes ç‰ˆæœ¬æ˜¯ï¼ŸRBD é”æ­»çš„é—®é¢˜åªèƒ½é€šè¿‡æ‰‹åŠ¨è§£é”æ¥è§£å†³å—ï¼Ÿæœ‰å…¶ä»–æ–¹æ¡ˆå—ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¸Šçº¿æ¯”è¾ƒæ—©ï¼Œç”Ÿäº§ç³»ç»Ÿè¿˜æ˜¯ 1.2 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬æ­£åœ¨å‡çº§ 1.6 ç‰ˆæœ¬ã€‚RBD æˆ‘åªå°è¯•äº†æ‰‹åŠ¨è§£é”çš„æ–¹æ³•ï¼Œåˆ«çš„æ–¹æ³•æ²¡æœ‰å°è¯•ã€‚

> Qï¼šæƒ³é—®ä¸‹å…³äºŽä½ ä»¬ Kubernetes åˆ†å¸ƒå¼å­˜å‚¨çš„é€‰æ‹©ï¼Œä»¥åŠåœ¨ä½¿ç”¨å½“ä¸­é‡åˆ°äº†é‚£äº›é—®é¢˜ï¼Ÿ

Aï¼šæˆ‘ä»¬åº”ç”¨ä¸æŒ‚ç›˜ï¼Œæ‰€ä»¥ä½¿ç”¨ Ceph çš„åœºæ™¯ä¸å¤šã€‚ä½¿ç”¨ RBD æ²¡é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œæœ‰äº›åœºæ™¯æˆ‘ä»¬éœ€è¦å…±äº«å­˜å‚¨ï¼ˆFilesystem)ï¼Œå› ä¸ºæˆ‘ä»¬äººæ‰‹æœ‰é™ï¼Œæ²¡ç²¾åŠ›å°è¯• Ceph FS æˆ–è€…å…¶ä»–æ–¹å¼ï¼Œè¿™ç®—ä¸ªé—®é¢˜å§ã€‚

> Qï¼šåœ¨ EFK çš„æž¶æž„ä¸­æœ‰ Kafka çš„å­˜åœ¨ï¼Œç›®çš„ä½•åœ¨ï¼Ÿæ˜¯ä¿è¯æ—¥å¿—ä¸ä¸¢å¤±ï¼Œè¿˜æ˜¯æé«˜åžåé‡ï¼Ÿ

Aï¼šä¸»è¦æ˜¯åš Buffering ç¼“å†²ï¼Œæˆ‘ä»¬è¿™ä¸ªé‡Œè¿˜æœ‰ä¸ªåˆ«æ—¥å¿—éœ€è¦ä¸­é—´å¤„ç†çš„è¿‡ç¨‹ï¼Œä»Ž Kafka å–å‡ºåŠ å·¥ï¼Œå†æ”¾å…¥ Kafkaï¼Œæœ€åŽåˆ° Elasticsearchã€‚

> Qï¼šèƒ½å¦è¯¦ç»†ä»‹ç»ä¸‹ CI ç³»ç»Ÿè€ƒæ ¸çš„é‡è¦æ ‡å‡†:å¯¹å¸¸ç”¨æŠ€æœ¯æ ˆå’Œé…ç½®è¿›è¡Œæ ‡å‡†åŒ–ã€‚å…·ä½“å¯¹å“ªäº›æŒ‡æ ‡åšäº†æ ‡å‡†åŒ–ï¼ŸæŠ€æœ¯æ–¹é¢å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šå¯¹äºŽ Java åº”ç”¨ï¼Œæˆ‘ä»¬åªæä¾› JDK 7 å’Œ JDK 8ï¼Œè§„å®šæ—¥å¿—ç›®å½•çš„ä½ç½®ï¼Œæä¾›æ ‡å‡†çš„ Log4jï¼Œé…ç½®ä¸Žä»£ç åˆ†ç¦»ï¼Œwar åŒ…ä¸ŽçŽ¯å¢ƒä¸ç®¡ç­‰ç­‰å¼ºåˆ¶çš„è¦æ±‚ã€‚

> Qï¼šDocker Registry çš„é•œåƒå¤åˆ¶æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šè·‘è„šæœ¬ã€docker saveã€scpã€docker loadï¼Œè¿™ç§åšæ³•æ¯”è¾ƒ lowï¼Œå»ºè®®ç›´æŽ¥ç”¨ Harbor åšå§ã€‚

> Qï¼šè¯·é—® Dockerfile è‡ªåŠ¨ç”Ÿæˆæ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šæ ¹æ®æ¨¡æ¿ç”Ÿæˆäº†ï¼Œæ¯”å¦‚å¯¹äºŽ Java Webï¼Œåœ¨è§„å®šå¥½æ—¥å¿—è¾“å‡ºç›®å½•ç­‰æƒ…å†µç³»ï¼Œå¯å˜çš„åªæ˜¯å·¥ç¨‹åç§°ç­‰å¾ˆå°‘éƒ¨åˆ†ï¼Œåç§° CI ç³»ç»ŸçŸ¥é“ï¼Œæ‰€ä»¥å°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆäº†ã€‚

> Qï¼škube-proxy é‚£è¾¹æ€§èƒ½æ€Žä¹ˆæ ·ï¼Ÿè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸€äº›ç‰¹å®šçš„å®¹å™¨çš„å›ºå®š IP æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šæˆ‘ä»¬é‡æ¯”è¾ƒå°ï¼Œæ²¡æœ‰æ€§èƒ½ç“¶é¢ˆï¼Œ1.2ï¼ˆå…·ä½“è®°ä¸æ¸…äº†ï¼‰ä»¥åŽ kube-proxy æ˜¯çº¯ iptables å®žçŽ°ï¼Œæ²¡é‚£ä¹ˆå·®å§ï¼Œä¸šå†…ä¹Ÿæœ‰ç”¨ HAProxy ç­‰ä»£æ›¿çš„ï¼Œä¸ªäººè§‰å¾—æ²¡å¿…è¦ã€‚ç‰¹å®šçš„å®¹å™¨å›ºå®š IP æˆ‘ä»¬æ²¡æœ‰å®žçŽ°ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿™ç§åœºæ™¯ã€‚ä½ å¯ä»¥æŠ˜ä¸­ä¸€ä¸‹ï¼Œç»™ä¸ª NodePortï¼Œå›ºå®š IP æˆ‘ä¸ªäººè§‰å¾—å°½é‡å°‘ç”¨ä¸ºå¥½ã€‚

> Qï¼šé•œåƒçš„è‡ªæè¿°èƒ½å¦å±•å¼€è®²è®²å‘¢ï¼Ÿ

Aï¼šå°±æ˜¯æ¯ä¸ªé•œåƒé‡Œéƒ½æœ‰æè¿°å®ƒæž„å»ºè¿‡ç¨‹çš„ Dockerfile

> Qï¼šå¯¹äºŽä½ ä»¬çŽ°åœ¨ä½¿ç”¨çš„è¿™å¥—å®¹å™¨äº‘å¹³å°ï¼ŒæœåŠ¡ä¹‹é—´çš„ä¾èµ–æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿæ€Žä¹ˆåŒºåˆ†çš„çŽ¯å¢ƒï¼Ÿå¦å¤–åº”ç”¨å¥åº·æ£€æŸ¥å’Œè¿½è¸ªç”¨çš„æ˜¯ä»€ä¹ˆæ–¹æ¡ˆï¼Ÿ

Aï¼šæœåŠ¡ä¹‹é—´çš„ä¾èµ–æŒ‡ä»€ä¹ˆï¼Ÿå¦‚æžœæ˜¯åº”ç”¨ï¼Œä»–ä»¬è¿˜æ˜¯é€šè¿‡ Dubbo èµ°ï¼Œå¦‚æžœæ˜¯éž Java å¾—åº”ç”¨ï¼Œå°±é€šè¿‡ Service è°ƒç”¨ã€‚æˆ‘ä»¬åœ¨ä¸åŒçš„çŽ¯å¢ƒéƒ¨ç½²äº† Kubernetes é›†ç¾¤ï¼Œæ¯ä¸ªé›†ç¾¤ä¹Ÿéƒ¨ç½²äº†ç®¡ç†ç³»ç»Ÿï¼Œè¿™æ ·å°±çŸ¥é“æ¯ä¸ªç³»ç»Ÿå¯¹åº”å“ªä¸ªçŽ¯å¢ƒäº†ã€‚å¥åº·æ£€æŸ¥å°±æ˜¯é€šè¿‡ Kubernetes çš„å¥åº·æ£€æŸ¥æœºåˆ¶å®žçŽ°çš„ï¼Œlivenessprobeã€‚

> Qï¼šå¤šæ•°æ®ä¸­å¿ƒç¾å¤‡èƒ½å…·ä½“è®²ä¸€ä¸‹å—ï¼Œæ˜¯åœ¨å¤šä¸ª dc æœ‰å¤šå¥—ä¸€æ ·çš„é›†ç¾¤ï¼Œå…¨éƒ¨æ˜¯å†·å¤‡çŠ¶æ€å—ï¼Ÿ

Aï¼šæˆ‘ä»¬ç”Ÿäº§æœ‰ä¸‰ä¸ªæ•°æ®ä¸­å¿ƒï¼Œæ¯æ¬¡å‘å¸ƒï¼Œæˆ‘ä»¬éƒ½ä¼šå‘æ¯ä¸ªæ•°æ®ä¸­å¿ƒå‘è¯·æ±‚ï¼Œä¸æ˜¯å†·å¤‡ï¼Œæ˜¯å¤šæ´»ã€‚

> Qï¼šç›‘æŽ§ä½“ç³»æ­å»ºå¾—ç»†èŠ‚å’Œç›‘æŽ§å†…å®¹éƒ½æ˜¯å“ªäº›ï¼Œæ¯”å¦‚ CPU å†…å­˜ï¼ŒPod äº‹ä»¶ç­‰ï¼ŒåŒ…æ‹¬å‘Šè­¦ä½“ç³»ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜å¾ˆå¥½ï¼Œæˆ‘ä»¬è¿™æ–¹é¢åšå¾—éžå¸¸ä¸è¶³ï¼Œç›‘æŽ§çš„æ ‡å‡†æˆ‘ä»¬åˆšåˆšæ‹¿å‡ºç»†èŠ‚æ–¹æ¡ˆã€‚æˆ‘ä»¬çŽ°åœ¨çš„æ–¹æ¡ˆæ˜¯æŠŠ CPU è¿™äº›æŒ‡æ ‡è¾“å‡ºåˆ°æ—¥å¿—ä¸­å¿ƒï¼ˆåŒ…å«ç›‘æŽ§æŠ¥è­¦éƒ¨åˆ†ï¼‰ï¼Œç”±æ—¥å¿—ä¸­å¿ƒæ¥å®Œæˆã€‚Pod äº‹ä»¶ç­‰è¿˜æ²¡æœ‰ç›‘æŽ§æŠ¥è­¦ã€‚

> Qï¼šæ—¥å¿—å¦‚ä½•è®©ç»„ä»¶æ–¹æ–¹ä¾¿æŸ¥çœ‹åŒæ—¶å¯ä»¥æŽ’æŸ¥é—®é¢˜ï¼Œæ¯”å¦‚å¯åŠ¨æ—¶çš„æ—¥å¿—ï¼Ÿ

Aï¼šåº”ç”¨æ—¥å¿—é€šè¿‡æ—¥å¿—ä¸­å¿ƒï¼ˆELKï¼‰æŸ¥çœ‹ï¼›å¯åŠ¨æ—¥å¿—é€šè¿‡å®¹å™¨äº‘ç•Œé¢æŸ¥çœ‹ï¼Œé€šè¿‡ Kubernetes çš„ API æŽ¥å£å®žçŽ°ã€‚

> Qï¼šå¾ˆå¤šç»„ä»¶æœ‰ IP ç™½åå•çš„é—®é¢˜ï¼Œè€Œ Kubernetes é›†ç¾¤ IP ç»å¸¸å˜æ¢ ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ

Aï¼šè¦ä¹ˆæ”¹ç»„ä»¶ï¼Œè¦ä¹ˆåœ¨ç½‘ç»œå±‚åšé™åˆ¶ï¼ˆæ¯”å¦‚ Calico æˆ–è€…å…¶ä»–çš„ï¼‰ï¼Œå°½é‡åˆ«åœ¨ Kubernetes å±‚è§£å†³ã€‚

> Qï¼šå®¹å™¨ç®¡ç†å¹³å°æ˜¯è‡ªç ”çš„å—ï¼Ÿä½¿ç”¨ä½•ç§è¯­è¨€å¼€å‘çš„ï¼Ÿæ˜¯å…¨éƒ¨åŸºäºŽ API æŽ¥å£å—ï¼Ÿ

Aï¼šæ˜¯è‡ªç ”çš„ï¼Œå‰å° AngularJSï¼ŒåŽå° Golangï¼Œå…¨éƒ¨åŸºäºŽ Kubernetes çš„ APIï¼Œå¼€å‘è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼ŒKubernetes çš„ API è®¾è®¡çš„éžå¸¸å®Œå–„ï¼ŒæŽ¨èå°è¯•ã€‚

---

### 2017-05-14ï¼šå®¹å™¨æŠ€æœ¯åœ¨ä¼ä¸šçº§æœåŠ¡é‡Œçš„å®žè·µ

> Qï¼šè¯·é—®åœ¨å®¹å™¨å’Œè™šæ‹Ÿæœºä¹‹é—´è®¿é—®ç½‘ç»œæœ‰ä»€ä¹ˆç»éªŒï¼Œé€šè¿‡ Calico ä½¿è·¨ä¸»æœºä¹‹é—´å®¹å™¨äº’è®¿ï¼Œå®¹å™¨å¤–çš„è™šæ‹Ÿæœºå¦‚ä½•è®¿é—®å®¹å™¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å…¬æœ‰äº‘çŽ¯å¢ƒä¸‹ PaaS æœåŠ¡å¦‚ä½•ä¸Žå®¹å™¨ä¹‹é—´è¿›è¡Œè®¿é—®ï¼Ÿ

Aï¼šæˆ‘ä»¬çŽ°åœ¨å…¬æœ‰äº‘ PaaS æ¯ä¸ªç”¨æˆ·æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºçš„æ–¹å¼ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„é€šè®¯é‡‡ç”¨çš„é»˜è®¤çš„ç½‘ç»œæ–¹å¼ Overlayï¼Œåœ¨ä¸æ˜¯å¤§å¹¶å‘æƒ…å†µä¸‹è¿™ç§é—®é¢˜å¹¶ä¸æ˜Žæ˜¾ã€‚

> Qï¼šå®¹å™¨æ˜¯å¦è£¸æœºéƒ¨ç½²ã€å®¹å™¨ç¼–æŽ’å’Œè°ƒåº¦å·¥å…·ï¼Ÿ

Aï¼šæˆ‘ä»¬ç§æœ‰äº‘äº§å“æ˜¯è£¸æœºéƒ¨ç½²ï¼Œå®¹å™¨ç¼–æŽ’å’Œè°ƒåº¦å·¥å…·ç›®å‰æœ‰ç‰ˆ Kubernetesã€‚

> Qï¼šè¯·é—®ä½ ä»¬çš„ç§æœ‰äº‘å»ºè®¾ä¸»è¦ç”¨äº†ä»€ä¹ˆè½¯ä»¶ï¼Ÿ

Aï¼šç§æœ‰äº‘å°±æ˜¯è£¸æœº + å®¹å™¨ + ç¼–æŽ’å·¥å…· + åŸºç¡€èƒ½åŠ›å®¹å™¨ï¼ˆæ¯”å¦‚æ¶ˆæ¯ã€SDN ç­‰ï¼‰ã€‚

> Qï¼šAuto Scaling æ˜¯åž‚ç›´çš„ï¼Œè¿˜æ˜¯æ°´å¹³çš„ï¼Ÿ

Aï¼šæ˜¯æ°´å¹³æ‰©å±•çš„ï¼Œå°±æ˜¯åœ¨å¦å¤–è®¾å¤‡é‡Œé¢é‡æ–°å¯åŠ¨ä¸€ç»„å®¹å™¨ï¼Œå¹¶ä¸”å°†æ•°æ®åº“å®¹å™¨åŠ å…¥åˆ° ge èŠ‚ç‚¹ä¸­å–ã€‚

> Qï¼šå¾®æœåŠ¡æ³¨å†Œï¼ŒæœåŠ¡å‘çŽ°æ˜¯æ€Žä¹ˆåšåˆ°çš„ï¼Ÿ

Aï¼šå¾®æœåŠ¡æ³¨å†Œåˆ†æˆ 2 éƒ¨åˆ†ï¼š1. å¾®æœåŠ¡æ˜¯å¦ç»è¿‡äº†äº‘å®¡æ ¸ï¼Œæ˜¯å¦èƒ½é€šè¿‡ LOTE ç½‘å…³éªŒè¯ï¼›2. åœ¨å†…éƒ¨æ˜¯é€šè¿‡ etcd ä¸€æ•´å¥—æ¥å®žçŽ°çš„ï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚

---

### 2017-05-09ï¼šæ²ªæ±Ÿå®¹å™¨åŒ–è¿ç»´å®žè·µ

> Qï¼šè¯·é—® Prometheus å…·ä½“æ€Žä¹ˆçŽ©çš„å‘¢ï¼Ÿæ¯”å¦‚ï¼Œå†·çƒ­å­˜å‚¨ Metrics æ•°æ®æœ‰åšä»€ä¹ˆå¤„ç†å—ï¼Ÿå‘Šè­¦åªç”¨äº† Grafana4.0 çš„å—ï¼Ÿ

Aï¼šå¯ä»¥è‡ªå·±ç§ä¸‹çœ‹çœ‹å…ˆå…³æ–‡æ¡£ï¼Œè¿™é‡Œä¸€æ—¶åŠä¼šä¹Ÿè¯´ä¸æ¸…ï¼›Metrics æ•°æ®æ—¶ä»¥æ—¶åºæ–¹å¼æŒä¹…åŒ–åœ¨ Prometheus ä¸­ï¼Œä¸åšä»»ä½•å¤„ç†ï¼ŒåŸºäºŽç±» SQL æ–¹å¼æŸ¥è¯¢ï¼›æŸ¥è¯¢è¯­å¥ä¸­å¯ä»¥è®¾ç½®è¿‡æ»¤ï¼Œæˆ–è€…æ¡ä»¶æŸ¥è¯¢ï¼›Grafana 4.0 åŠä»¥åŽæ‰æ”¯æŒæŠ¥è­¦ï¼ŒåŒæ—¶ä¼ ç»Ÿçš„ç›‘æŽ§æŠ¥è­¦ä¹Ÿæœ‰ Zabbixã€‚

> Qï¼šè¯·é—®ä¸åŒåº”ç”¨çš„ QoS æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿå®¹å™¨çš„ç§Ÿæˆ·ç®¡ç†å’Œç²’åº¦æ˜¯æ€Žæ ·çš„ï¼Ÿ

Aï¼šæµé‡æŽ§åˆ¶è¿™å—å¯ä»¥è€ƒè™‘åœ¨ HAProxyã€æˆ–è€… Nginx è¿™å—æ¥åš API Gatewayï¼›ç›®å‰æˆ‘ä»¬å®¹å™¨å°±è‡ªå·±ä½¿ç”¨ï¼Œç§Ÿæˆ·ç®¡ç†è¿™å—æ²¡æœ‰ç»†åˆ†ã€‚

> Qï¼šè¯·é—® Marathon éƒ¨ç½²çš„æµç¨‹æ˜¯æ€Žä¹ˆæ ·çš„ï¼Œæ–°ç‰ˆæœ¬æ˜¯æ›¿æ¢è€ç‰ˆæœ¬æ˜¯åˆ›å»ºæ–°çš„ APPï¼Œåˆ é™¤è€çš„ï¼Œè¿˜æ˜¯æ€Žä¹ˆæ ·çš„ï¼ŒAPP å‘½åè§„èŒƒæœ‰æ²¡æœ‰ä»€ä¹ˆå»ºè®®ã€‚å®¹å™¨éƒ¨ç½²åŽå¦‚ä½•æ³¨å†Œåˆ° Nginx ä¸Šï¼Œå®¹å™¨çš„ IP å¦‚ä½•ä¸Žä¸Šæ¸¸ Upstream åŸŸåè¿›è¡Œå…³è”å‘¢ï¼Ÿ

Aï¼šå…ˆæŒ‰ç…§ä¸€å®šæ¯”ä¾‹ï¼ˆ2 ä¸ªï¼‰å‘å¸ƒæ–°çš„å®žä¾‹ï¼Œç„¶åŽåˆ é™¤è€çš„å®žä¾‹ï¼Œæœ€ç»ˆå®žçŽ°å®žä¾‹æ•°ç›®ä¸€è‡´ï¼›å‘½åæœ€å¥½æœ‰è§„èŒƒï¼Œé˜²æ­¢å†²çªï¼›Nginx + Consul serve r + Agent + Template å¯ä»¥è§£å†³ä½ çš„æ‰€æœ‰ç–‘é—®ã€‚

> Qï¼šåœ¨æ­¤ç½‘ç»œçŽ¯å¢ƒä¸­æ˜¯å¦ä¼šå‡ºçŽ°ç½‘ç»œé—®é¢˜å¯¼è‡´ç³»ç»Ÿå¼‚å¸¸ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¹‹å‰é‡åˆ°è¿‡ Docker 1.9.1 ä½Žç‰ˆæœ¬ bug å¯¼è‡´ç½‘ç»œä¸¢åŒ…ï¼ŒåŽæ¥å‡çº§äº† Docker è‡³ 12.5ï¼Œé—®é¢˜è§£å†³ï¼›ç›®å‰ä½¿ç”¨å†…æ ¸ 4.4.18ï¼ŒDocker 1.13.0ï¼Œæ²¡æœ‰ä»»ä½•ç½‘ç»œé—®é¢˜ã€‚

> Qï¼šé—®ä¸‹æ™®ç½—ç±³ä¿®æ–¯çš„é›†ç¾¤è¿™ä¹ˆåšçš„ï¼ŸåŽç«¯æ•°æ®åº“æ²¡æœ‰æ²¡è€ƒè™‘è¿‡ OpenTSDB å‘¢ï¼Ÿ

Aï¼šç›®å‰å•æœºæ²¡æœ‰æ€§èƒ½ç“¶é¢ˆï¼Œå¦‚æžœå­˜åœ¨æ€§èƒ½é—®é¢˜å¯ä»¥è€ƒè™‘åˆ†æœºæˆ¿éƒ¨ç½²ï¼Œæœ€ç»ˆçš„å±•ç¤ºå’ŒæŠ¥è­¦ç»Ÿä¸€æ”¾åœ¨ Grafana ä¸Šé¢ï¼›æ²¡æœ‰ä½¿ç”¨ OpenTSDBã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 5 æœˆ 9 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**è€¿æ—­ä¸œï¼Œæ²ªæ±Ÿæ•™è‚²è¿ç»´æž¶æž„å¸ˆã€‚ç›®å‰ä¸»è¦ä»Žäº‹å®¹å™¨æŠ€æœ¯å­¦ä¹ ç ”ç©¶ã€Ceph åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿç»´æŠ¤ã€æ²ªæ±Ÿéƒ¨åˆ†ä¸šåŠ¡è¿ç»´ç›¸å…³å·¥ä½œ**ã€‚

---

### 2017-05-04ï¼šæŸè‚¡ä»½åˆ¶å•†ä¸šé“¶è¡Œå®šåˆ¶åŒ– PaaS ä»‹ç»

> Qï¼šå¼¹æ€§è¿™å—ï¼Œæ‰©å®¹å¥½è¯´ï¼Œç¼©çš„è¯æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿˜æœ‰ç”¨æˆ·è¯·æ±‚åœ¨è¿™ä¸ªå®¹å™¨ä¸Šï¼Œæ€Žä¹ˆåŠžï¼Ÿ

Aï¼š åœ¨è¯¥é¡¹ç›®ä¸­æˆ‘ä»¬å¹¶æœªå¯¹è¿™ç§æƒ…å†µåšç‰¹æ®Šå¤„ç†ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬å¦å¤–çš„äº§å“ä¸­ï¼Œå·²ç»è€ƒè™‘åˆ°äº†è¯¥é—®é¢˜ã€‚æ­£ç¡®çš„æ–¹æ³•åº”è¯¥æ˜¯åŸºäºŽingress è®¾ç½®ä¸€ä¸ªé”€æ¯å®¹å™¨çš„å®½é™æ—¶é—´ï¼Œå³ï¼šåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œä¸å…è®¸æ–°æµé‡å¯¼å…¥å³å°†é”€æ¯çš„å®¹å™¨ï¼Œè¿™äº›å®¹å™¨åœ¨è¯¥å®½é™æ—¶é—´åˆ°æœŸåŽï¼Œè‡ªåŠ¨é”€æ¯ã€‚

> Qï¼šæ„Ÿè°¢åˆ†äº«ï¼Œå¯¹å¼¹æ€§ä¼¸ç¼©éƒ¨åˆ†è¯·æ•™ä¸€ä¸‹:æ‚¨åˆ†äº«çš„å¼¹æ€§ä¼¸ç¼©çš„åœºæ™¯ä¸šåŠ¡å‘¨æœŸæ€§å¾ˆæ˜Žæ˜¾ï¼Œæ‰€ä»¥åŸºäºŽæ—¶é—´åŒºé—´è§¦å‘é‡‡å–ä¸åŒçš„ä¼¸ç¼©æ“ä½œï¼Œå¦‚æžœä¸šåŠ¡å‘¨æœŸæ€§ä¸æ˜Žæ˜¾ï¼Œä¼¸ç¼©æœºåˆ¶èƒ½å¤„ç†å—ï¼Ÿå¦‚ä½•å¤„ç†ï¼Ÿ

Aï¼šåœ¨å½“å‰é¡¹ç›®ä¸­ï¼Œå®¢æˆ·æ˜Žç¡®è¦æ±‚æŒ‰ç…§ 1 å¤©ä¸ºå‘¨æœŸã€‚åœ¨æˆ‘ä»¬è‡ªå·±çš„ PaaS äº§å“çº¿ä¸­ï¼Œå¼¹æ€§ä¼¸ç¼©å¯ä»¥è°ƒæ•´å‘¨æœŸï¼ˆæ¯”å¦‚ï¼šæ˜ŸæœŸã€æœˆä»½ç­‰ï¼‰ï¼Œå¦å¤–ï¼Œè¿˜å¯ä»¥ä¸æŒ‰ç…§æ—¶é—´å‘¨æœŸï¼Œç›´æŽ¥åŸºäºŽ CPUã€å†…å­˜æˆ–è€…æŸä¸€ä¸ªå¯ç›‘æŽ§é¡¹ã€‚ä½ å¯ä»¥ç†è§£ä¸ºåªè¦èƒ½å¤Ÿè¢«ç›‘æŽ§çš„ç›‘æŽ§é¡¹ï¼Œéƒ½å¯ä»¥ä½œä¸ºå¼¹æ€§ä¼¸ç¼©çš„ä¾æ®ã€‚

> Qï¼šæˆ‘ç›®å‰å…³æ³¨çš„æ˜¯æ—¥å¿—è¿™å—ï¼Œæ€Žä¹ˆæ‰èƒ½æŠŠæ—¥å¿—é›†ä¸­åœ¨ä¸€èµ·ï¼Œèƒ½ä¸èƒ½è¯´çš„å…·ä½“ç‚¹ï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯å°†æ—¥å¿—æ”¶é›†åŽï¼Œç»Ÿä¸€å‘é€åˆ° kafka é›†ç¾¤ï¼Œä½ å¯ä»¥ç†è§£ä¸ºæ‹·è´ä¸€ä»½é›†ä¸­å­˜å‚¨åˆ° kafka é›†ç¾¤ã€‚è¿™é‡Œçš„é›†ä¸­ä¸æ˜¯ä»€ä¹ˆéš¾ç‚¹ï¼Œéš¾ç‚¹åœ¨äºŽå¯¹æ—¥å¿—çš„æ”¶é›†ï¼Œæ¶‰åŠä¸‰ä¸ªå±‚é¢ï¼šä¸»æœºã€å®¹å™¨ã€åº”ç”¨ã€‚æˆ‘ä»¬çš„æ–¹å¼æ˜¯åœ¨å„å°ä¸»æœºä¸Šéƒ¨ç½²å®¹å™¨åŒ–åŽçš„ logstashï¼Œç„¶åŽé€šè¿‡ç¨‹åºä¿®æ”¹å…¶é…ç½®æ¨¡æ¿ï¼Œä»Žè€Œæ”¶é›†ä¸åŒç›®å½•çš„æ—¥å¿—ã€‚è€Œè¿™äº›ç›®å½•å°±åˆ†åˆ«å¯¹åº”ç€ä¸»æœºæ—¥å¿—ã€å®¹å™¨æ—¥å¿—æ˜ å°„åˆ°ä¸»æœºçš„ç›®å½•ã€ä»¥åŠåº”ç”¨æ—¥å¿—æ˜ å°„åˆ°ä¸»æœºçš„ç›®å½•ã€‚

> Qï¼šæ ¹æ®æ—¥å¿—æ ‡ç­¾èŽ·å¾—åº”ç”¨æ—¥å¿—ç›®å½•ï¼Œè¯·é—®å®¹å™¨æ ‡ç­¾å…·ä½“æ˜¯ä»€ä¹ˆæ ¼å¼çš„ï¼Œé‡‡é›†æ—¥å¿—ä¿¡æ¯ä¸­åŒ…å«èŠ‚ç‚¹ä¿¡æ¯ï¼Œå®¹å™¨ä¿¡æ¯ï¼Œåº”ç”¨ä¿¡æ¯ç­‰è·Ÿå¹³å°ã€åº”ç”¨ç›¸å…³çš„å…ƒæ•°æ®å­—æ®µå—ï¼Ÿ

Aï¼šè¿™é‡Œçš„æ—¥å¿—æ ‡ç­¾æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œç›¸å½“äºŽä¸»æœºä¸Šçš„ daemon ç¨‹åºä¼šç›‘å¬è¯¥ä¸»æœºä¸Šå®¹å™¨çš„åˆ›å»ºã€é”€æ¯ç­‰ eventï¼Œä¸€æ—¦å‘çŽ°å®¹å™¨åˆ›å»ºï¼Œå°±åŽ» check å…¶æ ‡ç­¾ï¼Œæ˜¯å¦æœ‰è‡ªå®šä¹‰çš„"æ—¥å¿—ç›®å½•ä¿¡æ¯"ï¼Œ"æ—¥å¿—æ–‡ä»¶æ‰©å±•åä¿¡æ¯"ã€‚è¿™äº›æ—¥å¿—ç›®å½•éƒ½æœ‰å¯¹åº”çš„ volume æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Šï¼Œå› æ­¤é€šè¿‡åˆ†æžå®¹å™¨çš„ inspect ä¿¡æ¯ï¼Œå°±èƒ½å¤Ÿæ‰¾åˆ°æ—¥å¿—ç›®å½•æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç›®å½•ã€‚è€Œä½ æåˆ°çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¿™äº›æ˜¯æ¯ä¸ªå®¿ä¸»æœºä¸Šçš„æ—¥å¿—æ”¶é›†çš„æœåŠ¡å®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™å°±å®šä¹‰å¥½çš„ï¼Œæ‰€æœ‰ç”±å®ƒæ”¶é›†å¹¶å‘é€å‡ºåŽ»çš„æ—¥å¿—ï¼Œéƒ½ä¼šæœ‰è¯¥å®¿ä¸»æœºçš„æ ‡ç­¾ã€‚

> Qï¼šå…³äºŽæ—¥å¿—æ”¶é›†çš„æ—¶é—´å–å€¼é—®é¢˜ï¼Œæ˜¯æ—¥å¿—æ”¶é›†ç‚¹çš„æœ¬åœ°æ—¶é—´è¿˜æ˜¯ç³»ç»Ÿæ—¶é—´ï¼Œå…·ä½“å¦‚ä½•ä¿æŒä¸€è‡´ï¼ŸNTPï¼Ÿ

Aï¼šæ˜¯æ—¥å¿—æ”¶é›†ç‚¹çš„æœ¬åœ°æ—¶é—´ï¼Œå…·ä½“é€šè¿‡ NTPï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œéœ€è¦ä¿éšœå®¹å™¨æ—¶é—´ä¸Žå®¿ä¸»æœºæ—¶é—´ï¼ˆæ—¶åŒºï¼‰è¦ä¿æŒä¸€è‡´ã€‚

> Qï¼šå¼¹æ€§ä¼¸ç¼©å¦ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æžœä¸æ˜¯å‘¨æœŸæ€§å¼¹æ€§ä¼¸ç¼©æ˜¯å¦è€ƒè™‘é¿å…çŸ­æœŸè„‰å†²çŽ°è±¡å¼•èµ·çš„ä¸å¿…è¦çš„å¼¹æ€§ä¼¸ç¼©æ“ä½œï¼Ÿ

Aï¼šæ‰€ä»¥åœ¨å¼¹æ€§ä¼¸ç¼©çš„è§„åˆ™é‡Œé¢æœ‰ä¸€ä¸ªå‚æ•°ä¸ºï¼š"retrigger time" ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªå®‰å…¨çš„æ—¶é—´ç‰‡ï¼Œå†ä¸€æ¬¡ä¼¸ç¼©åŠ¨ä½œä¹‹åŽï¼Œå¿…é¡»è¦ç­‰å¾…è¿™ä¸ªæ—¶é—´ç‰‡ç»“æŸä¹‹åŽæ‰ä¼šå†æ¬¡è§¦å‘å¼¹æ€§ä¼¸ç¼©è¡Œä¸ºã€‚å¦åˆ™ä¸äºˆå“åº”ã€‚

---

### 2017-04-20ï¼šåŸºäºŽ Neutron çš„ Kubernetes SDN å®žè·µç»éªŒä¹‹è°ˆ

> Qï¼šè¯·é—® Skynet ç”¨åˆ°çš„ neutron-linux-agent éœ€è¦éƒ¨ç½²åˆ°æ‰€æœ‰ kubelet èŠ‚ç‚¹ä¸Šå—ï¼Ÿå¦å¤–æœ‰æ²¡æœ‰å¼€æºçš„ demo ç‰ˆæœ¬å­¦ä¹ ä¸‹å‘¢ï¼Ÿ

Aï¼šéœ€è¦éƒ¨ç½²ï¼Œè¿™ä¸ª Agent ä¸åªæ˜¯å®‰å…¨ç»„ï¼Œå¯¹ VXLAN ç±»åž‹çš„ç½‘ç»œï¼Œå®ƒè¿˜å¯ä»¥ç¼–å†™ FDB è§„åˆ™å®žçŽ° VXLAN ç½‘ç»œã€‚ä»£ç å¼€æºæ­£åœ¨ç­¹åˆ’ä¸­ï¼Œå†æµ‹è¯•ä¸€æ³¢ï¼Œå°±ä¼šå‘å¸ƒã€‚

> Qï¼šæ„Ÿè°¢åˆ†äº«ï¼Œè¯·é—®ä½ ä»¬æœ‰æ²¡æœ‰åœ¨åœ¨ä¸€ä¸ªè™šæœºå†…çš„ pod éœ€è¦æŒ‚åˆ°ä¸åŒç½‘ç»œçš„åœºæ™¯ï¼Ÿå¦‚æžœæœ‰çš„è¯ï¼Œpod ä¹‹é—´è·¨äºŒå±‚ç½‘ç»œçš„äº’é€šä½ ä»¬æ˜¯æ€Žä¹ˆåšåˆ°çš„ï¼Ÿ

Aï¼šç›®å‰æ¥çœ‹ï¼Œå•ä¸ª POD æŒ‚æŽ¥åˆ°ä¸åŒç½‘ç»œé‡Œçš„åœºæ™¯è¿˜æ¯”è¾ƒå°‘ï¼Œä½†é€»è¾‘ä¸Šæ¥è¯´ï¼Œè·Ÿè®¾ç½®å•ç½‘ç»œçš„æ–¹å¼åŒºåˆ«ä¸å¤§ï¼Œåªæ˜¯é»˜è®¤è·¯ç”±èµ°å“ªå¼ ç½‘å¡çš„é—®é¢˜å€¼å¾—å•†æ¦·ã€‚POD ä¹‹é—´è·¨äºŒå±‚ç½‘ç»œäº’é€šå¯ä»¥é€šè¿‡ç‰©ç†äº¤æ¢æœºé…ç½®ä¸¤ä¸ª VLAN äº’é€šæˆ–è€…ç›´æŽ¥é€šè¿‡ Neutron çš„ vRouter åšç½‘å…³ã€‚

> Qï¼šè¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå½“ä¸€ä¸ª Docker ç‰©ç†æœº down äº†ï¼Œä¸Šé¢çš„å®¹å™¨ä¼šè‡ªåŠ¨è¿ç§»åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹è¿˜æ˜¯ Kubernetes è‡ªåŠ¨å¯åŠ¨ç›¸å…³çš„å®¹å™¨ï¼èƒ½å¦å®žçŽ°ç‰¹å®šå®¹å™¨åœ¨ä¸åŒçš„ Kubernetes èŠ‚ç‚¹ä¸Šè‡ªåŠ¨è¿ç§»è€Œä¸”ä¿æŒ ip ä¸å˜ï¼

Aï¼šé™¤éž POD æŒ‡å®šçš„è°ƒåº¦éœ€æ±‚æ— æ³•æ»¡è¶³ï¼ŒKubernetes ä¼šè‡ªåŠ¨å°è¯•è¿ç§» POD åˆ°å…¶ä»–ä¸»æœºä¸Šå¯åŠ¨ã€‚POD IP çš„ä¿æŒè¿˜æ”¯æŒé€šè¿‡æ³¨è§£çš„æ–¹å¼è®¾ç½® POD çš„ IPï¼Œå½“ç„¶éœ€è¦é™åˆ¶ RC çš„å‰¯æœ¬æ•°åªèƒ½æ˜¯ 1 æˆ–è€…è¿è¡Œçš„æ˜¯å• PODï¼Œå¦åˆ™ä¼šå‡ºçŽ° IP å†²çªã€‚

> Qï¼šå®¹å™¨çš„ port æ”¯æŒ Neutron çš„ä¸€äº› QoS ç‰¹æ€§å—ï¼Ÿä¾‹å¦‚é™é€Ÿã€‚

Aï¼šæ®æˆ‘å¯¹ OpenStack çš„è°ƒç ”ï¼ŒNeutron çš„ç½‘ç»œé™é€Ÿä½¿ç”¨çš„æ˜¯ tc è§„åˆ™å®šä¹‰çš„ï¼Œåœ¨ä½¿ç”¨ Linux bridge+VLAN ç½‘ç»œçš„æƒ…å†µä¸‹ï¼ŒSkynet å¯ä»¥ä¿è¯ POD çš„ç½‘ç»œé…ç½®ä¸Ž VM çš„é…ç½®ä¸€è‡´ï¼Œä»Žè€Œä½¿ QoS è§„åˆ™èƒ½å¤Ÿæ­£å¸¸è¿ä½œï¼Œå®žçŽ°é™é€Ÿã€‚å…¶ä»–ç‰¹æ€§æš‚æ—¶è¿˜æ²¡æœ‰ç ”ç©¶è¿‡ï¼ŒåŽæœŸä¼šç»§ç»­è°ƒç ”ã€‚

> Qï¼šSkynet ç›®å‰æ”¯æŒ Overlay çš„ç½‘ç»œå—ï¼Ÿå¦‚ä½•è§£å†³å†…ç½‘å’Œå¤–éƒ¨ç½‘ç»œç›¸äº’è®¿é—®å‘¢ï¼Ÿ

Aï¼šç›®å‰ Skynet æ”¯æŒä½¿ç”¨ Neutron çš„ VXLAN ç½‘ç»œå®žçŽ° Overlayï¼Œç»“åˆ Neutron vRouter çš„å¤–ç½‘ç½‘å…³åŠŸèƒ½ï¼Œé€šè¿‡è®¾ç½®è·¯ç”±ä¸º vRouter çš„å¤–ç½‘ç½‘å…³ï¼Œä½¿å†…å¤–ç½‘èƒ½å¤Ÿäº’é€šã€‚

> Qï¼šè¯·é—® Veth è®¾å¤‡å¦ä¸€ç«¯è¿žæŽ¥çš„æ˜¯ä»€ä¹ˆè®¾å¤‡ï¼Ÿ

Aï¼šVeth pair æ˜¯ Linux ç½‘ç»œçš„åŸºç¡€æŠ€æœ¯ï¼ŒVeth æ€»æ˜¯æˆå¯¹å‡ºçŽ°çš„ï¼Œæ‰€ä»¥ Veth çš„å¦ä¸€ç«¯è¿˜æ˜¯ä¸€ä¸ª Vethï¼Œå¯ä»¥è¿žæŽ¥åˆ° bridge ä¸Šæˆ–è€…ç›´æŽ¥æš´éœ²åœ¨ä¸»æœºä¸Šã€‚

> Qï¼šç›®å‰ OpenStack ç¤¾åŒºä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„é¡¹ç›® Kuryrï¼Œä½ èƒ½ç®€å•ä»‹ç»ä¸‹ä½ ä»¬çš„æ–¹æ¡ˆå’Œ Kuryr çš„å·®å¼‚å—ï¼Ÿ

Aï¼šKuryr æ˜¯ç¤¾åŒºé¡¹ç›®ï¼Œè€ƒè™‘çš„ä¸åƒæˆ‘ä»¬ Skynet è¿™ä¹ˆç®€å•ï¼Œå¯ä»¥çŸ­å¹³å¿«åœ°ä»¥å®žçŽ°åŠŸèƒ½ä¸ºé¦–è¦ç›®æ ‡ï¼Œè€Œ Kuryr éœ€è¦è€ƒè™‘çš„å°±æ¯”è¾ƒå¤šï¼Œéœ€è¦åŒæ—¶æ”¯æŒ Docker çš„ CNM å’Œ Kubernetes çš„ CNIã€‚æˆ‘ä»¬çš„ Skynet ä»ŽåŽ»å¹´ 11 æœˆä»½å¼€å§‹è°ƒç ”å®žçŽ°ï¼Œå½“æ—¶ Kuryr çš„ Kubernetes æ”¯æŒè¿˜åªæ˜¯ä¸ªç©ºå£³å­ã€‚çŽ°åœ¨ï¼Œæ ¹æ® Kuryr åœ¨çš„ BPï¼Œæˆ‘ä»¬çš„å®žçŽ°æ€è·¯å·®åˆ«ä¸å¤§ï¼Œåªæ˜¯ Kuryr æ›´å¤šçš„è€ƒè™‘äº†ç§Ÿæˆ·å¯¹æŽ¥ç­‰ç­‰é—®é¢˜ã€‚

> Qï¼špod çš„ IP ä¿æŒæ˜¯æ€Žä¹ˆåšåˆ°çš„èƒ½è¯¦ç»†ä»‹ç»ä¸€ä¸‹å—ï¼Ÿå¦‚æžœ pod åå­—å‘ç”Ÿå˜åŒ–äº†ï¼Œå¯ä»¥ä¿æŒå—ï¼Ÿ

Aï¼šå¦‚å‰é¢ä¸¤ä¸ªç±»ä¼¼é—®é¢˜ï¼ŒPOD çš„ IP ä¿æŒé€šè¿‡ä¸¤ç§æ–¹å¼ï¼šå¦‚æžœ POD åç§°ä¸å˜ï¼ˆæ¯”å¦‚ StatefulSet ä¸­çš„ PODï¼‰ï¼Œåˆ™å¯¹åº”çš„ port å°±ä¸ä¼šå˜ï¼Œå› æ­¤æ ¹æ® port è®¾ç½®çš„ POD IPã€MACã€ä¸»æœºåéƒ½ä¸ä¼šå˜ã€‚å¦‚æžœ POD åç§°å˜åŒ–ï¼Œåœ¨ä¸€å®šçš„çº¦æŸä¸‹ï¼Œé€šè¿‡æ³¨è§£ä¿ç•™ POD çš„ IP åœ°å€ä¿¡æ¯ï¼Œå¼ºåˆ¶ä½¿ POD ä¿æŒ IP ä¸å˜ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 04 æœˆ 18 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**å†¯å»ºå»ºï¼Œå¤©äº‘è½¯ä»¶ ECP å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸»è¦è´Ÿè´£ ECP å®¹å™¨ç®¡ç†å¹³å°çš„ç½‘ç»œã€å­˜å‚¨ç­‰æ–¹é¢çš„åŠŸèƒ½å®žçŽ°ã€‚ç†Ÿæ‚‰ CloudStackã€OpenStack ç­‰å¼€æº IaaS å¹³å°è½¯ä»¶ã€‚æœ€è¿‘ä¸“æ³¨äºŽå®¹å™¨é›†ç¾¤ç®¡ç†å¹³å°çš„æŠ€æœ¯å®žè·µï¼ŒåŒ…æ‹¬ Kubernetesã€Swarmï¼Œå¯¹å®ƒä»¬çš„ç½‘ç»œå®žçŽ°ã€å­˜å‚¨å®žçŽ°éƒ½æœ‰æ¯”è¾ƒæ·±å…¥çš„äº†è§£**ã€‚

---

### 2017-04-06ï¼šä»Žä¸€ä¸ªå®žé™…æ¡ˆä¾‹æ¥è°ˆå®¹å™¨è½åœ°çš„é—®é¢˜

> Qï¼šæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œæ—¥å¿—æ‰“ä¸¤ä»½çš„è¯å…·ä½“æ˜¯æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Œç”¨åˆ°äº†å“ªäº›æŠ€æœ¯æˆ–çŽ°æœ‰çš„å·¥å…·å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬è‡ªå·±å®žçŽ°äº†ä¸€ä¸ª log-agent, ç„¶åŽ log-agent å¯ä»¥å®žçŽ°è¿™ä¸ªåŠŸèƒ½ã€‚

> Qï¼šå¦‚æžœåº”ç”¨æœ‰è‡ªå·±çš„å†™çš„æ—¥å¿—ï¼Œå¦‚ log4j çš„ï¼Œè¾“å‡ºä¸åˆ°æ ‡å‡†è¾“å‡ºï¼Œè¿˜æ€Žä¹ˆå¤„ç†ï¼Ÿ

Aï¼šlog4j è²Œä¼¼æ˜¯å¯é€šè¿‡é…ç½®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºçš„ï¼Œå¦å¤–å¦‚æžœæœ‰äº›åº”ç”¨ä¸èƒ½è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºçš„ï¼Œå¯ä»¥é…ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œæˆ‘ä»¬ä¼šåŽ»è¯»æ–‡ä»¶ã€‚

> Qï¼šç¼©å®¹çš„äº§ç”Ÿæ¡ä»¶æ˜¯å¦æœ‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚æ ¹æ® CPUã€å†…å­˜ç”šè‡³ä¸šåŠ¡è§„åˆ™å¤šç»´åº¦çš„è¿›è¡Œè€ƒå¯Ÿï¼Ÿ

Aï¼šç¼©å®¹å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯éº»çƒ¦çš„æ˜¯å¦‚ä½•å®‰å…¨çš„ç¼©å®¹ï¼Œæˆ‘ç†è§£è¿™ä¸ªçŽ¯èŠ‚å…¶å®žæ˜¯è·Ÿåº”ç”¨çš„é€»è¾‘æœ‰ç›´æŽ¥å…³ç³»çš„ï¼Œå¦‚æžœåº”ç”¨æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åº”ç”¨ï¼Œé‚£ä¹ˆç¼©å®¹éžå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨å‰ç«¯æŽ§åˆ¶æµé‡ï¼Œç„¶åŽåœæ­¢å®¹å™¨å³å¯ï¼Œä½†æ˜¯å¦‚æžœæ˜¯æœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å¯¹ç”¨æˆ·é€ æˆå½±å“ã€‚

> Qï¼šé…ç½®ç®¡ç†è¿™å—ï¼Œä¸æ–­çš„è¦†ç›–ä¼šå¢žåŠ é•œåƒä½“ç§¯ï¼Œå¦‚ä½•æœ€å¤§åŒ–å‡å°‘é•œåƒå¤§å°å‘¢ï¼Ÿ

Aï¼šé¦–å…ˆï¼Œä¸€ä¸ªé•œåƒæœ€å¤šè¢«è¦†ç›– 2ï¼Œ3 æ¬¡ï¼Œæµ‹è¯•é•œåƒä¸€æ¬¡ï¼Œç”Ÿäº§é•œåƒä¸€æ¬¡ï¼Œè€Œä¸”é…ç½®æ–‡ä»¶ä¸€èˆ¬æ˜¯å¾ˆå°çš„ï¼Œå‡ ä¹Žå¯¹é•œåƒå¤§å°æ²¡æœ‰å½±å“ã€‚

> Qï¼šæµ‹è¯•çŽ¯å¢ƒé…ç½®æ–‡ä»¶è¦†ç›–å¼€å‘çŽ¯å¢ƒé•œåƒï¼Œæ˜¯åªç”¨æµ‹è¯•çŽ¯å¢ƒçš„ docket file å—ï¼Ÿå¦‚æžœæ¯å¤©æ‰“ç‰ˆï¼Œä¼šå¾ˆéº»çƒ¦å—ï¼Ÿ

Aï¼šé€šè¿‡è¦†ç›–æµ‹è¯•æ–‡ä»¶æ¥è§£å†³çŽ¯å¢ƒé—®é¢˜ï¼Œåªæ˜¯ä¸€ä¸ªæ€è·¯ï¼Œä¸ä¸€å®šéžè¦ä½¿ç”¨å¼€å‘æµ‹è¯•çŽ¯å¢ƒçš„ä¿¡æ¯ï¼Œè¿™ä¸ªå¯ä»¥å…·ä½“æƒ…å†µå…·ä½“åˆ†æžã€‚

> Qï¼šlog-agent å…·ä½“å®žçŽ°å‘¢ï¼Œæ—¥å¿—ç›´æŽ¥æ‰“ç»™ log-agent è¿˜æ˜¯ log-agent è¯»å–æœ¬åœ°æ—¥å¿—æ–‡ä»¶å‘¢ï¼Ÿæˆ–è€…è¯´ log-agent è¯»å–æ ‡å‡†è¾“å‡ºçš„å†…å®¹å‘¢ï¼Ÿ

Aï¼šlog-agent å¯ä»¥é€šè¿‡ Docker çš„ log-driver èŽ·å–æ ‡å‡†è¾“å‡ºçš„æ—¥å¿—ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç›´æŽ¥è¯»å–æ—¥å¿—æ–‡ä»¶çš„æ—¥å¿—ã€‚

> Qï¼šé…ç½® ENV åŒ–å®Œå…¨å¯ä»¥ç”±è¿ç»´æ¥å®žçŽ°ï¼Œå®¹å™¨çš„å¯åŠ¨äº¤ç”±è„šæœ¬æ¥æ‰§è¡Œï¼Œç„¶åŽåœ¨è„šæœ¬ä¸­æ¥è¯»å–æ‰€æœ‰çš„ ENV å¹¶ä¿®æ”¹åº”ç”¨ï¼Œå®ŒæˆåŽå†å¯åŠ¨åº”ç”¨ï¼Œè¿™æ ·å°±åªéœ€è¦æ¥ç»´æŠ¤è„šæœ¬äº†ã€‚

Aï¼šæ˜¯ä¸ªå¥½ä¸»æ„ï¼Œä½†æ˜¯æˆ‘ä»¬å½“æ—¶è€ƒè™‘é…ç½®æ–‡ä»¶è¦†ç›–è¿™ä¸ªæ–¹æ¡ˆçš„æ—¶å€™ï¼Œæ˜¯åŸºäºŽå¼€å‘äººå‘˜ä¸å¯¹ä»£ç åšä»»ä½•ä¿®æ”¹çš„æ€è·¯æ¥è€ƒè™‘çš„ã€‚

> Qï¼šå®¹å™¨ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Ÿå¦‚ä½•åšåˆ°åŠ¨æ€ç›‘æŽ§ï¼Ÿä½ ä»¬å…·ä½“ç›‘æŽ§äº†å“ªäº›é‡è¦æŒ‡æ ‡ï¼Ÿè°¢è°¢ã€‚

Aï¼šæˆ‘ä»¬ç›‘æŽ§ç”¨çš„æ˜¯ Prometheus æ–¹æ¡ˆï¼Œç›‘æŽ§åšäº† ä¸»æœºï¼Œå®¹å™¨ï¼Œä¸­é—´ä»¶ å‡ ä¸ªå¤§çš„èŒƒå›´ã€‚

---

### 2017-04-02ï¼šFlannel ä¸­ vxlan backend çš„åŽŸç†å’Œå®žçŽ°

> Qï¼šFlannel åˆ›å»ºå¤šä¸ªç½‘ç»œï¼Œå¹¶ä¸”å®žçŽ°ç½‘ç»œä¹‹é—´éš”ç¦»å¯ä»¥å®žçŽ°å—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œæœ€æ–°çš„ Flannel ä¸­å·²ç»åŠ å…¥ç®¡ç†å¤šä¸ªç½‘ç»œçš„èƒ½åŠ›ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨æ—¶åˆ¶å®šå¤šä¸ªç½‘ç»œï¼Œetcd ä¸­é…ç½®ä¿¡æ¯çš„çš„æ ¼å¼ç•¥æœ‰ä¸åŒï¼Œå¯åŠ¨ flanneld æ—¶æœ‰å‚æ•°å¯ä»¥åˆ¶å®šåˆå§‹åŒ–å“ªå‡ ä¸ªç½‘ç»œã€‚> Qï¼šå¦‚æžœä½¿ç”¨ Flannel è¿‡ç¨‹ä¸­å‘çŽ°ï¼Œè·¨èŠ‚ç‚¹æ— æ³•è®¿é—®ï¼Œè¯¥ä»Žå“ªäº›æ–¹ä¾¿ç€æ‰‹æŽ’é”™ï¼Ÿ

Aï¼šé¦–å…ˆçœ‹ä¸€ä¸‹ä½ æŒ‡å®šçš„è™šæ‹Ÿç½‘ç»œæ˜¯å¦å’ŒçŽ°æœ‰ç‰©ç†ç½‘è·¯ä¸­çš„ç½‘æ®µå†²çªäº†ï¼›ç„¶åŽæ£€æŸ¥èŠ‚ç‚¹ä¹‹é—´çš„ UDP ç«¯å£æ˜¯å¦å¯ä»¥è¿žé€šï¼Œæœ€åŽè¿˜éœ€è¦è€ƒè™‘å½“å‰ç³»ç»Ÿæ˜¯å¦æ”¯æŒ VXLANï¼Œæœ€ä½Žè¦æ±‚ v3.7ï¼Œå»ºè®® v3.9+ï¼ŒCentOS7 çš„é»˜è®¤å†…æ ¸å·²ç»å¯ä»¥æ»¡è¶³è¦æ±‚ã€‚

> Qï¼šè¿‡ä¸€ç»„æµ‹è¯•æ•°æ®ä¸¤å° VM to VM (vlan): 7.74 GBits/secï¼Œä½¿ç”¨ flannel vxlanï¼Œä¸¤ä¸ª container ä¹‹é—´ 1.71 GBits/secï¼Œè¯·é—®è¿™ä¸ªæ•°æ®æ­£å¸¸å—ï¼Œvxlan çš„å¸¦å®½æŸè€—å‘ç”Ÿå“ª, æœ‰å•¥è°ƒä¼˜æ€è·¯ï¼Œè°¢è°¢ã€‚

Aï¼šé¦–å…ˆæˆ‘æƒ³ç¡®è®¤ä¸€ä¸‹ä½ æµ‹è¯•çš„ç»“æžœæ˜¯ TCP è¿˜æ˜¯ UDPï¼Œå»ºè®®å®žé™…æµ‹è¯•ä¸€ä¸‹ï¼Œè¿™ä¸ªæ˜¯æˆ‘åœ¨ Digital Ocean ä¸Š 2 å° VPS é—´çš„æµ‹è¯•ç»“æžœï¼Œä»…ä¾›å‚è€ƒï¼šæžæ¸…æ¥šåŽŸç†ä»¥åŽï¼Œç›¸ä¿¡å¾ˆå®¹æ˜“åˆ¤æ–­ç“¶é¢ˆä½ç½®ï¼šèŠ‚ç‚¹ä¹‹é—´æ˜¯é€šè¿‡ UDP æ¥è½¬å‘ L2 çš„æ•°æ®åŒ…çš„ï¼Œæˆ‘è®¤ä¸ºè¿™éƒ¨åˆ†å¯èƒ½æœ‰æ¯”è¾ƒå¤§çš„å«Œç–‘ã€‚

> Qï¼šFlannel åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¦‚æžœéœ€è¦æ–°å¢žç½‘æ®µï¼Œå¦‚ä½•è®©æ¯ä¸ªèŠ‚ç‚¹èŽ·å–æœ€æ–°çš„è·¯ç”±è¡¨ä¿¡æ¯ï¼Ÿéœ€è¦æ›´æ–°æ‰€æœ‰èŠ‚ç‚¹çš„ Flannel é…ç½®é¡¹ï¼Œé‡å¯ Flannel å—ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜å…¶å®žè¿˜ä¸é”™ï¼Œæ¯”è¾ƒæŽ¥è¿‘å®žæˆ˜äº†ï¼›é¦–å…ˆä½ ç¡®å®žå¯ä»¥é‡å¯ flanneld æ¥æ›´æ–°ç½‘ç»œé…ç½®ï¼›ç„¶åŽ Flannel æ¯ 24h ä¼šè‡ªåŠ¨é‡æ–°åˆ†é…é›†ç¾¤å†…çš„ç½‘ç»œï¼Œæ‰€ä»¥ä½ å°±ç®—ä¸é‡å¯ï¼Œæ¯ 24h ä¹Ÿä¼šè‡ªåŠ¨åˆ·æ–°æœ¬åœ°ç½‘ç»œçš„ï¼Œå¦‚æžœå‘çŽ°æœ¬åœ°ç½‘ç»œé…ç½®ä¸ç¬¦åˆ Flannel åœ¨ etcd ä¸­é…ç½®çš„è¦æ±‚ï¼Œä¼šé‡æ–°ç”Ÿæˆç½‘ç»œé…ç½®ã€‚

> Qï¼šæˆ‘åœ¨é¡¹ç›®ä¸­ç”¨äº† flanne lvxlan backendã€‚æŒ‰ç…§æ–‡ä¸­è¯´æ³•ï¼Œè½¬å‘ç”±å†…æ ¸è¿›è¡Œï¼ŒFlannel æŒ‚æŽ‰å¹¶ä¸å½±å“é€šå®µã€‚ä½†æ˜¯å®žé™…ä½¿ç”¨ä¸­ï¼ŒFlannel æŒ‚æŽ‰ç¡®å®žå¯¼è‡´å¤–éƒ¨å…¶ä»–è®¿é—®ä¸åˆ° Dockerã€‚è¯·é—®è¿™ä¸ªå¯èƒ½æ˜¯ä»€ä¹ˆåŽŸå› ï¼Ÿ

Aï¼šé¦–å…ˆè¦æ¾„æ¸…ä¸€ä¸‹ï¼Œå¹¶ä¸æ˜¯è¯´æŒ‚æŽ‰ç½‘ç»œæ²¡å½±å“ï¼Œflanneld æŒ‚æŽ‰ä¼šå¯¼è‡´æœ¬åœ°çš„ ARP entry æ— æ³•è‡ªåŠ¨æ›´æ–°ï¼Œä½†æ˜¯å·²ç»ç”Ÿæˆçš„ç½‘ç»œçŽ¯å¢ƒè¿˜æ˜¯å¯ç”¨çš„ï¼Œå…·ä½“å¯ä»¥çœ‹æˆ‘å‰é¢æ‰‹åŠ¨æ­å»º overlay network çš„è¿‡ç¨‹ï¼Œæ ¹æœ¬åœ¨äºŽ ARP tableã€‚

---

### 2017-03-19ï¼šDocker åœ¨æ²ªæ±Ÿè½åœ°çš„å®žè·µ

> Qï¼šCeph é›†ç¾¤åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æœ‰é‡åˆ°è¿‡ä»€ä¹ˆå‘å—ï¼Œèƒ½å¦åˆ†äº«ä¸€ä¸‹ï¼Ÿ

Aï¼šCeph é›†ç¾¤åœ¨äº§çº¿çŽ¯å¢ƒä¸Šä½¿ç”¨çš„ç¡®æœ‰å¾ˆå¤šé—®é¢˜è¦æ³¨æ„ï¼Œä½†è¿™å’Œæœ¬æ¬¡åˆ†äº«æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œä¸‹æ¬¡æˆ‘å¯ä»¥åˆ†äº«ä¸€äº› Ceph é›†ç¾¤æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚

> Qï¼šæ—¥å¿—å¦‚ä½•è¿›è¡Œæœé›†ï¼Œå‡ºçŽ°ä¸šåŠ¡æ•…éšœæ—¶å¦‚ä½•å¿«é€Ÿå®šä½é—®é¢˜æˆ–è€…çº¿ä¸Š debugï¼Ÿ

Aï¼šæ—¥å¿—æ˜¯é€šè¿‡å·æŒ‚è½½ Host çš„æ–¹å¼æ”¾åœ¨äº†ç»Ÿä¸€çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œç”± Logstash æ”¶é›†åŽä¸ŠæŠ¥ ES åŽé€šè¿‡ Kibana å±•çŽ°å‡ºæ¥ã€‚å¦‚æžœå‡ºçŽ°æ•…éšœï¼Œè¿ç»´ç³»ç»Ÿä¼šå‡ºçŽ°æŠ¥è­¦ï¼Œæˆ‘ä»¬æ ¹æ® ELK stack çœ‹åˆ°é—®é¢˜æ‰€åœ¨ã€‚

> Qï¼šåŸºç¡€æž¶æž„å±‚çš„åˆ†å¸ƒå¼å­˜å‚¨æ˜¯å¦ä½¿ç”¨çš„ Cephï¼Œå­˜å‚¨é›†ç¾¤çš„è§„æ¨¡æ˜¯å¤šå¤§ï¼Ÿ

Aï¼šçš„ç¡®ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Ceph ä½œä¸ºåˆ†å¸ƒå¼å­˜å‚¨ã€‚ä¸»è¦ä½¿ç”¨çš„æ˜¯å®ƒçš„ file system ä¸Ž Object storageã€‚è§„æ¨¡ä¸Šï¼ŒOSD æœ‰ 20 å°ï¼Œå­˜å‚¨å®¹é‡åœ¨ 900Tã€‚

> Qï¼šå­˜å‚¨æ–¹æ¡ˆä¸ºä»€ä¹ˆéœ€è¦å®žçŽ°å¤šç§ volume æ–¹æ¡ˆï¼Ÿ

Aï¼šç”±äºŽä¸šåŠ¡çš„éœ€è¦ï¼ŒDocker ä¸ä½†è¦æŠŠæ—¥å¿—è¾“å‡ºåˆ° HOST çš„ç£ç›˜ä¸Šç»™ ELK ä½¿ç”¨ï¼Œè¿˜è¦æŒ‚è½½ Ceph æ–‡ä»¶å­˜å‚¨ï¼Œä¸¤è€…å¯¹åº”çš„é©±åŠ¨æ˜¯ä¸ä¸€æ ·çš„ï¼ŒHOST ç£ç›˜ä½¿ç”¨çš„æ˜¯ Direct-lvmï¼Œè€Œ Ceph åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ä½¿ç”¨çš„æ˜¯ ceph-fuseã€‚

> Qï¼šDocker æ€Žä¹ˆè·ŸçŽ°æœ‰çš„ä¸šåŠ¡ä¹‹é—´ç›¸äº’è®¿é—®ï¼Œç½‘ç»œå±‚ IP æ€Žä¹ˆè§£å†³çš„ï¼Ÿ

Aï¼šæ­£å¦‚åˆšæ‰æˆ‘åˆ†äº«çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ Docker Network ä½œä¸ºæˆ‘ä»¬ç½‘ç»œçš„è§£å†³æ–¹æ¡ˆã€‚åœ¨ Docker Network ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Overlay ç½‘ç»œï¼Œå®¹å™¨ä¹‹é—´æœ‰å†…éƒ¨ç½‘ç»œï¼Œè·¯ç”±è¡¨å­˜å‚¨åœ¨ zk ä¸­ï¼Œå®¹å™¨ä¸­æœ‰ä¸¤ä¸ªè™šæ‹Ÿç½‘å¡ï¼Œä¸€ä¸ªå¯¹åœ¨ Overlay ä¸­åŒç½‘æ®µçš„å®¹å™¨ï¼Œä¸€ä¸ªå¯¹ HOSTã€‚Overlay çš„ IP èŒƒå›´æ˜¯å¯ä»¥è®¾ç½®ï¼Œå»ºè®®ä¸è¦è®¾ç½®å¤ªå¤§ï¼Œå®¹æ˜“å¼•èµ·ç½‘ç»œé£Žæš´ã€‚

> Qï¼šä½¿ç”¨ Docker Network è·¨ä¸»æœºçš„å®¹å™¨ IP æ˜¯å¦èƒ½äº’é€šï¼Ÿ

Aï¼šèƒ½ï¼Œè€Œä¸”å¿…é¡»èƒ½ï¼Œå¦åˆ™è¿™ç§æ–¹æ¡ˆæ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚è¡¥å……ä¸€ç‚¹ï¼ŒDocker Network è¿˜èƒ½é€šè¿‡è®¿é—®æŽ§åˆ¶ï¼Œæ¥éš”ç¦»å„ä¸ª Overlay ç½‘ç»œçš„äº’è®¿ã€‚

> Qï¼šç½‘ç»œå­˜å‚¨æ˜¯æ€Žä¹ˆå’Œ Ceph ç»“åˆçš„å‘¢ï¼Œåˆ©ç”¨ Ceph çš„ rbd æŒ‚è½½åˆ°ä¸»æœºä¸Šå—ï¼Ÿ

Aï¼šå¾ˆå¤šå…¬å¸éƒ½æ˜¯è¿™ä¹ˆåšçš„ã€‚ä¸è¿‡æˆ‘ä»¬æ²¡æœ‰è¿™ä¹ˆå¹²ï¼Œå› ä¸º rbd æ˜¯å—å­˜å‚¨è®¾å¤‡ï¼Œç›¸å½“äºŽåœ¨ Docker ä¸­æŒ‚è½½äº†ä¸€å—è£¸ç›˜ï¼Œæ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿæ— æ³•ä½¿ç”¨ã€‚æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ ceph-fuse å¹¶ä½¿ç”¨é©±åŠ¨çš„å½¢å¼æŒ‚è½½è½½ Docker å†…ã€‚

> Qï¼šè½¬ç æ˜¯ CPU å’Œå†…å­˜å¯†é›†åž‹æ“ä½œï¼Œè¯·é—®å½“åˆæ˜¯åŸºäºŽæ€Žæ ·çš„è€ƒè™‘ä¸Š Docker çš„ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜å…¶å®žæŒºæœ‰æ„æ€ï¼Œæœ‰äººå¤§æ¦‚è¿˜ä¸äº†è§£è½¬ç ï¼Œå…¶å®žå°±æ˜¯éŸ³è§†é¢‘çš„ç çŽ‡ã€ç¼–ç æ ¼å¼è½¬æ¢çš„å¤„ç†ã€‚ä¾‹å¦‚æŠŠä¸€ä¸ª mp4 è§†å±ï¼Œè½¬æ¢æˆ HLS åˆ‡ç‰‡æ ¼å¼ã€‚è¿™çš„ç¡®æ˜¯æ¶ˆè€— CPU å’Œå†…å­˜çš„æ“ä½œã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æœ‰ Mesos è¿™ä¸ªå¼ºå¤§çš„èµ„æºç®¡å®¶ã€‚å¦‚æžœä¸€ä¸ªè§†é¢‘è¿‡é•¿è¿‡å¤§ï¼Œä¸€å°æœåŠ¡å™¨è½¬ç é€Ÿåº¦å¤ªæ…¢ï¼Œå¯ä»¥åˆ‡æˆå°ä»½è®©å¤šå°æœåŠ¡å™¨ä¸€èµ·å·¥ä½œï¼Œå†åˆå¹¶èµ·æ¥ã€‚Docker çš„ä¼˜åŠ¿å°±ä½“çŽ°äº†ï¼Œæˆ‘ä»¬æŠŠè½¬ç ç§°ä¸º workerï¼Œå½“æ¯ä¸ª work æŽ¥æ”¶åˆ°ä»»åŠ¡åŽï¼Œè®© Mesos è°ƒåº¦èµ„æºï¼Œå·¥ä½œå®ŒæˆåŽç«‹åˆ»å›žæ”¶èµ„æºã€‚è¿™æ ·æ—¢ä¸æµªè´¹æœåŠ¡å™¨ä¹Ÿæ›´èƒ½ä½“çŽ°å¾®æœåŠ¡ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥é˜…è¯»æˆ‘çš„å¦ä¸€ç‰‡æ–‡ç« ï¼šJuice ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿã€‚

> Qï¼šèƒ½åšåˆ°æ ¹æ®åŽ‹åŠ›è‡ªåŠ¨æ‰©å®¹ä¹ˆï¼Ÿ

Aï¼šå¯ä»¥çš„ã€‚æˆ‘ä»¬å¼€æºä¸€ä¸ªè‡ªåŠ¨æ‰©å®¹ç¨‹åºï¼Œå®ƒçš„ä¸»è¦æ€æƒ³æ˜¯ï¼šå®šæ—¶æ£€æŸ¥ Mesos çš„ Metrics ä¸­ CPU å’Œå†…å­˜çš„å ç”¨ï¼Œå¦‚æžœè¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼ï¼Œä¾¿ç»™ Marathon å‘ä¸€ä¸ªæ‰©å®¹è¯·æ±‚ï¼ŒMarathon æŽ¥æ”¶åˆ°è¯·æ±‚åŽä¾¿å¯æŒ‰ä¸€å®šçš„æ¯”ä¾‹æ‰©å……æœåŠ¡ã€‚å¦‚å›¾æ‰€ç¤ºï¼š

> Qï¼šè¯·æ•™ä¸€ä¸‹å…³äºŽå®¹å™¨çš„èµ„æºåˆ†é…å’Œç¨‹åºåˆ‡åˆ†é—®é¢˜ï¼Œæˆ‘æœ‰å¾ˆå¤šæœåŠ¡å®¹å™¨ï¼Œæ”¾çš„æ˜¯ Java Web Seriveï¼Œæ¯æ¬¡å¯åŠ¨å°±å äº† 128m å†…å­˜ï¼Œ4G å†…å­˜çš„ä¸»æœºä¹Ÿå°±æ”¾ 20 ä¸ªæœåŠ¡ï¼Œio wait è¾¾åˆ° 10%ï¼Œå¸Œæœ›èƒ½ç»™ä¸€äº›å»ºè®®ï¼Œè°¢è°¢ã€‚

Aï¼šè¿™ä¸ªé—®é¢˜æˆ‘ä»¬æ›¾ç»ä¹Ÿé‡åˆ°è¿‡ã€‚ä¸å…‰ io wait é«˜ï¼Œè¿ž Swap åŒºå ç”¨éƒ½å¾ˆåŽ‰å®³ã€‚åŽæ¥ç ”ç©¶å‘çŽ°äº†ï¼Œå…¶å®žè¿™æ˜¯ Docker CGroup å†…å­˜éš”ç¦»çš„é”…ã€‚å½“æˆ‘ä»¬çš„ Docker å®¹å™¨åˆ†é…è¿‡å°‘çš„å†…å­˜åŽï¼Œåº”ç”¨ç¨‹åºçš„å†…å­˜ä¸å¤Ÿç”¨ï¼ŒDocker ä¼šè®¤ä¸ºç‰©ç†å†…å­˜å·²ç»å å®Œï¼Œä¼šä½¿ç”¨äº¤æ¢åŒºï¼Œä¹Ÿå°±æ˜¯ç¡¬ç›˜ä¸­çš„ Buffer ä½œä¸ºå†…å­˜ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´é¢‘ç¹çš„ io äº¤äº’ã€‚åœ¨é«˜å¹¶å‘çš„çŠ¶æ€ä¸‹ï¼Œio wait å°±é«˜äº†ã€‚è§£å†³æ–¹å¼æ˜¯ï¼Œæ‰©å¤§ Docker çš„å†…å­˜è®¾ç½®ã€‚

> Qï¼šä¼ ç»Ÿçš„ Java Web åž‹åº”ç”¨å¦‚ä½•æ”¾åˆ°å®¹å™¨é‡Œï¼Œä¸€ä¸ªé•œåƒéƒ½è¦ 600m å·¦å³ï¼Ÿ

Aï¼šå¦‚æžœä½¿ç”¨å®˜æ–¹çš„ Java åŸºç¡€é•œåƒï¼Œå®ƒçš„æ“ä½œç³»ç»Ÿé€‰ç”¨çš„æ˜¯ Debianï¼Œè‡ªç„¶å¾ˆå¤§ã€‚æˆ‘ä»¬ä½¿ç”¨çš„ java-jre:alpine é•œåƒï¼ŒAlpine æ˜¯æœ€å°çš„ Linux é›†åˆï¼Œåªæœ‰ 5mï¼ŒåŠ ä¸Šä½¿ç”¨ jreï¼ŒåŸºç¡€é•œåƒåªæœ‰ 140 å¤š mã€‚Java æ¡†æž¶ä½¿ç”¨ Spring Bootï¼Œå†åŠ ä¸Šå¾®æœåŠ¡çš„æ‹†åˆ†ï¼Œä¸€ä¸ªå…¸åž‹çš„ Web åº”ç”¨ä¹Ÿå°± 200m å·¦å³ã€‚

> Qï¼šMesos é›†ç¾¤æœ¬èº«æ€Žä¹ˆé‰´æŽ§ï¼Ÿæ˜¯å¦å¯ä»¥è‡ªåŠ¨åŒ–æŽ’é™¤é›†ç¾¤æ•…éšœï¼Œå¦‚ç½‘ç»œå¼‚å¸¸å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´ï¼Ÿ

Aï¼šMesos é›†ç¾¤ç”± Mesos çš„ master ç›‘æŽ§ç€ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ç”¨ Zabbix ç­‰å¯¹ä¸Šé¢çš„ Mesos æœåŠ¡åšç€ç›‘æŽ§ã€‚ä½† Mesos ä¸­ä»»ä½• Slave æœ‰é—®é¢˜ï¼Œå¯¹çº¿ä¸Šä¸šåŠ¡ä¸ä¼šå—åˆ°å½±å“ï¼Œè¿™å¾—ç›ŠäºŽ Marathon è¿™ä¸ªåº”ç”¨ç¨‹åºçš„ä¿å§†ï¼Œä¼šè‡ªåŠ¨åœ¨å¯ç”¨é›†ç¾¤å†…è¿ç§»åº”ç”¨ç¨‹åºã€‚è‡³äºŽç½‘ç»œå¼‚å¸¸å¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜çœŸæ²¡é‡åˆ°è¿‡ï¼Œæˆ‘ä»¬å¤§éƒ¨åˆ†çš„æœåŠ¡æ˜¯æ— çŠ¶æ€çš„æœåŠ¡ï¼Œå¯¹æœ‰çŠ¶æ€çš„æœåŠ¡ä¸€èˆ¬é‡‡ç”¨ä¸»ã€ä»Žã€é€‰ä¸»ä¸‰æœåŠ¡çš„ç»å…¸ HA æ–¹æ¡ˆã€‚

---

### 2017-03-09ï¼šä¸­å°åž‹å›¢é˜Ÿçš„å®¹å™¨åŒ–ä¹‹è·¯

> Qï¼šæˆ‘æœ‰å‡ ä¸ªé—®é¢˜è¯·æ•™ï¼š 1.åº•å±‚æ˜¯å¦ä½¿ç”¨äº†è™šæ‹ŸåŒ–ï¼Ÿ2.æŠ€æœ¯é€‰é¡¹æ—¶æ²¡è€ƒè™‘ Rancherï¼Ÿ 3.å¥åº·æ£€æŸ¥ i æ˜¯å¦å¯ä»¥åŠ¨æ€è®¾ç½®ï¼Ÿ

Aï¼šåº•å±‚ä½¿ç”¨äº†è™šæ‹ŸåŒ–ï¼Œè€ƒè™‘è¿‡ Rancherï¼Œä½†æ˜¯å½“æ—¶å¤ªæ—© Rancher éžå¸¸ä¸ç¨³å®šï¼ŒåŽæ¥è¿˜æ˜¯æ”¾å¼ƒäº†ï¼Œå‰å‡ å¤©çº¿ä¸‹è·Ÿä»–ä»¬å›¢é˜Ÿäº¤æµè¿‡è²Œä¼¼é‡å†™äº†ï¼Œå€¼å¾—å¤§å®¶è¯•è¯•ã€‚å¥åº·æ£€æŸ¥çš„ i æ˜¯é€»è¾‘ä¸Šçš„ï¼Œå¥åº·æ£€æŸ¥æœ¬èº«æ²¡æœ‰è¿™ä¸ªé…ç½®é¡¹ï¼Œi å¯ä»¥é€šè¿‡ Scale åŠŸèƒ½éšæ—¶è°ƒæ•´ã€‚

> Qï¼šè¯·é—®ä½ ä»¬æ˜¯å¦ä½¿ç”¨äº† CI/CD å·¥å…·ï¼Ÿå¦‚ä½•è´¯ç©¿æ•´ä¸ªåº”ç”¨çš„å‘¨æœŸçš„ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜å¤ªå¤§äº†ï¼Œå¯ä»¥å¦å¼€ä¸€ä¸ªå¤´äº†ã€‚ æˆ‘ä»¬ä½¿ç”¨ Jenkins åš CIï¼Œç”Ÿäº§çš„ CD è¿˜æœ‰è¾¾åˆ°ï¼Œå‘å¸ƒçš„æ—¶å€™éƒ½æ˜¯æ‰‹åŠ¨å‘å¸ƒäººç›¯ç€ã€‚

> Qï¼šæˆ‘ä»¬ç›®å‰åœ¨ç”¨ä½ ä»¬çš„äº§å“ï¼Œåªè¦ç”¨æ¥ç»Ÿè®¡å®‰å“å’Œ IOS ç«¯çš„ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰è‡ªå·±çš„å®¹å™¨ï¼Œå¹¶ä¸”ç¼–æŽ’å·¥å…·æ˜¯ Kubernetesï¼Œç›®å‰å…¶ä»–è¿˜ç®—ç¨³å®šï¼Œå°±æ˜¯å¶å°”å‡ºçŽ°èµ„æºåˆ†å‘æ—¶ä¸åŒé›†ç¾¤çš„çŠ¶æ€ä¸ä¸€è‡´ï¼Œè¯·é—®èƒ½å¦ç”¨ Marathon åŽ»æ›¿æ¢è§£å†³ï¼Œæ˜¯ä¸æ˜¯ä»£ä»·æœ‰ç‚¹å¤§ï¼Ÿ

Aï¼šæˆ‘çš„å»ºè®®æ˜¯ç»§ç»­ä½¿ç”¨ Kubernetesï¼ŒMarathon å¹¶ä¸æ˜¯å®Œå…¨æ²¡æœ‰ bugï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­åŒæ ·ä¼šæœ‰å‘åœ¨é‡Œé¢ï¼ŒKubernetes å‘å±•å¾ˆå¥½ï¼Œåªä¸è¿‡ Marathon å¯¹æˆ‘ä»¬è€Œè¨€æ›´åˆé€‚ã€‚

> Qï¼šé—®é¢˜ 1. æ•°æ®åº“æœ‰ç”¨åˆ°å®¹å™¨å—ï¼Ÿéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿé—®é¢˜ 2.ç”Ÿäº§çŽ¯å¢ƒé•œåƒæ›´æ–°ï¼Œé•œåƒè¾ƒå¤§ï¼Œç„¶è€Œæ¯æ¬¡åªæ›´æ–°ä¸€ä¸ªæ–‡ä»¶ï¼Œæœ‰ä»€ä¹ˆå¥½çš„å»ºè®®ï¼Ÿ

Aï¼šé—®é¢˜ 1. æµ‹è¯•çŽ¯å¢ƒæœ‰ç”¨åˆ°æ•°æ®åº“çš„å®¹å™¨ï¼Œä¸»è¦æ˜¯éƒ¨ç½²æ¯”è¾ƒæ–¹ä¾¿ã€‚ç”Ÿäº§æ²¡æœ‰ç”¨åˆ°ï¼Œè¿˜æ˜¯æ€§èƒ½é—®é¢˜å§ã€‚é—®é¢˜ 2. åŸºç¡€é•œåƒè¦é€‰å¥½ï¼Œä¸è¦æŠŠå®¹å™¨å½“è™šæ‹Ÿæœºç”¨ï¼ŒJVM çš„è¯­è¨€æ‰“åŒ…å‡ºæ¥ç®—å¤§äº†ï¼Œä¹Ÿå¯ä»¥æŽ§åˆ¶åœ¨ 200M å·¦å³ã€‚

> Qï¼šä½ ä»¬æ˜¯é’ˆå¯¹æ¯ä¸ªçŽ¯å¢ƒéƒ½æ‰“åŒ…ä¸åŒçš„é•œåƒï¼Ÿè¿˜æ˜¯ä½¿ç”¨åŒä¸€ä¸ªé•œåƒï¼Ÿé…ç½®ç®¡ç†æ€Žä¹ˆåšçš„ï¼Ÿå¯ä»¥åšåˆ°é…ç½®åŠ¨æ€åŠ è½½å—ï¼Ÿ

Aï¼šä¸æ˜¯é’ˆå¯¹æ¯ä¸ªçŽ¯å¢ƒæ‰“ä¸åŒçš„é•œåƒï¼Œæ˜¯æŠŠåº”ç”¨æœ¬èº«å¯¹çŽ¯å¢ƒæœ‰è¦æ±‚çš„é€‰é¡¹åšæˆåŠ¨æ€çš„ï¼Œé€šè¿‡çŽ¯å¢ƒå˜é‡æ³¨å…¥ã€‚åŠ¨æ€åŠ è½½éœ€è¦è‡ªå·±ç¼–å†™å·¥å…·é€šè¿‡ Consul å®žçŽ°ã€‚

> Qï¼šä½ ä»¬ç ”å‘çš„ç¨‹åºæ˜¯æ€Žä¹ˆå¾®æœåŠ¡åŒ–çš„å‘¢ï¼Ÿæ€Žä¹ˆç”¨å®¹å™¨æé«˜ç ”å‘çš„æ•ˆçŽ‡ï¼Ÿ

Aï¼šå¾®æœåŠ¡çš„è¯é¢˜ä¹Ÿå¾ˆå¤§ï¼Œæˆ‘ä»¬åœ¨æ‹†åˆ†æœåŠ¡çš„æ—¶å€™éƒ½ä¼šå†ä¸‰æ€è€ƒæœ‰æ²¡æœ‰å¿…è¦ï¼Œæ‹†åˆ†å¸¦æ¥çš„å¥½å¤„æ˜¯ä»€ä¹ˆã€‚æ¯”å¦‚è¯´æˆ‘ä»¬æŠŠè®¤è¯è¿™å—å•ç‹¬æ‹†åˆ†æˆä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ˜¯æ ¹æ®åŠŸèƒ½æ‹†åˆ†ã€‚è¿˜æœ‰ä¸ºäº†æå‡æ€§èƒ½çš„æ‹†åˆ†ï¼Œä¸åŒèµ„æºå€¾æ–œçš„æ‹†åˆ†ã€‚å®¹å™¨å¸¦æ¥çš„æœ€å¤§å¥½å¤„å°±æ˜¯æ‰“åŒ…çŽ¯å¢ƒï¼Œèƒ½åšåˆ°å¿«é€Ÿéƒ¨ç½²ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 3 æœˆ 7 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æž—ç”Ÿç”Ÿï¼ŒGrowingIO æœåŠ¡ç«¯ç ”å‘å·¥ç¨‹å¸ˆã€‚ä»Žäº‹ GrowingIO æ ¸å¿ƒç³»ç»Ÿç ”å‘ã€‚å¥‰è¡Œ DevOpsï¼Œå¯¹ä¸€åˆ‡èƒ½æé«˜ç ”å‘æ•ˆçŽ‡çš„æŠ€æœ¯ç—´è¿·**ã€‚

---

### 2017-03-01ï¼šåŸºäºŽ Jenkins å’Œ Kubernetes çš„ CI å·¥ä½œæµ

> Qï¼šå…³äºŽ Jenkins å’Œ Docker é›†æˆçš„å‡ ä¸ªæ’ä»¶å¯ä»¥åˆ†äº«ä¸€ä¸‹å—ï¼Ÿ

Aï¼šDocker Pipelineã€Docker Pluginã€docker-build-step è¿™å‡ ä¸ªæ’ä»¶ã€‚

> Qï¼šè¯·é—®æœ‰å®¹äº‘çš„é•œåƒå¤åˆ¶å¤§ä½“æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿç›®å‰æˆ‘ä»¬æ˜¯æµ‹è¯•ã€é¢„å‘å¸ƒã€å‘å¸ƒå…±äº«ä¸€ä¸ªä»“åº“ã€‚é€šè¿‡è¾…åŠ©æ¨¡å—æ ‡ç­¾å®žçŽ°çš„ã€‚

Aï¼šé•œåƒå¤åˆ¶åŠŸèƒ½ï¼Œç®€å•æ¥è¯´å®žçŽ°äº†ä¸åŒé¡¹ç›®é—´çš„é•œåƒå…‹éš†ï¼Œæ ¹æ®æˆ‘ä»¬é•œåƒä»“åº“çš„è®¾è®¡ï¼Œå¯¹ä¸åŒé˜¶æ®µï¼ˆå¼€å‘ã€æµ‹è¯•ã€å¯ä¸Šçº¿ï¼‰çš„é•œåƒä»¥ä¸åŒé¡¹ç›®åˆ†ç±»ï¼ŒåŸºäºŽé•œåƒå¤åˆ¶åŠŸèƒ½å³å¯å¿«é€Ÿå®žçŽ°ä¸åŒé˜¶æ®µçš„äº§å“å‘å¸ƒï¼Œä¹Ÿå°±æ˜¯é•œåƒå‘å¸ƒï¼Œæ­¤åŠŸèƒ½å¯ä¸‹è½½ AppHouse ç‰ˆæœ¬è¿›è¡Œè¯•ç”¨ã€‚

> Qï¼šè´µå…¬å¸çš„å†…éƒ¨ä»“åº“å’Œå¤–éƒ¨ä»“åº“é•œåƒæ˜¯å®žæ—¶åŒæ­¥çš„å—ï¼Ÿä½ ä»¬çš„é…ç½®æ–‡ä»¶æ˜¯é€šè¿‡é…ç½®ä¸­å¿ƒç®¡ç†è¿˜æ˜¯é•œåƒé—´çš„çŽ¯å¢ƒå˜é‡å®žçŽ°çš„ï¼Ÿ

Aï¼šä¸æ˜¯å®žæ—¶åŒæ­¥çš„ï¼Œè€Œæ˜¯é€šè¿‡äº†æˆ‘ä»¬å…¬å¸é•œåƒåº“äº§å“çš„é•œåƒå¤åˆ¶èƒ½åŠ›å®žçŽ°çš„ã€‚ç›®å‰å¼€å‘æµç¨‹ä¸­çš„äº§å“è¿è¡Œé…ç½®æ˜¯é€šè¿‡è‡ªèº«å¢žå¼ºçš„é…ç½®æ–‡ä»¶èƒ½åŠ›å®žçŽ°çš„ï¼Œé…ç½®ä¼šç”¨æ¥ä¿®æ”¹åº”ç”¨éƒ¨ç½²çš„ YAML æ–‡ä»¶ï¼Œä¹Ÿä¼šç”Ÿæˆä¸º ConfigMapã€‚

> Qï¼šæœ‰æ²¡æœ‰ä¸€ä¸ªç®€å•çš„ sampleï¼Œå¯ä»¥ä¸Šæ‰‹è·Ÿç€ç»ƒä¹ ä¸€ä¸‹ï¼Ÿ

Aï¼šåŸºäºŽ Kubernetes çš„ CICD äº§å“å³å°†å‘å¸ƒï¼Œä¼šæä¾›å¯¹åº”çš„ demo æ¼”ç¤ºå¹³å°ï¼Œè¯·åŠæ—¶å…³æ³¨ï¼Œè°¢è°¢ï¼

> Qï¼šKubernetes çš„ YAML çš„éƒ¨ç½²æ–‡ä»¶çš„æ¨¡æ¿æ€Žä¹ˆåŽ»æ›¿æ¢å ä½ç¬¦ï¼Ÿæ—§ç‰ˆæœ¬çš„å®¹å™¨æ€Žä¹ˆå¤„ç†ï¼Ÿ

Aï¼šä½¿ç”¨äº†è‡ªèº«å¼€å‘çš„ä¸€å¥—æ–‡æœ¬æ¨¡æ¿å¼•æ“Žï¼Œå…¶å®žç±»ä¼¼ Web æ¡†æž¶ä¸­çš„æ¨¡æ¿å¼•æ“Žï¼Œå®Œæˆæ¨¡æ¿å’Œé…ç½®çš„åˆå¹¶ï¼Œé€šè¿‡ä½¿ç”¨é…ç½®ä¸­çš„ key-valueï¼Œæ›¿æ¢æŽ‰æ¨¡æ¿ä¸­ key çš„å ä½ç¬¦ã€‚å¦å¤–ç”±äºŽæ˜¯ä½¿ç”¨çš„ Kubernetes deployment çš„ rolling updateï¼Œå‡çº§å®ŒæˆåŽæ—§ç‰ˆæœ¬çš„å®¹å™¨/pod ä¼šç”± Kubernetes è‡ªè¡Œåˆ é™¤ã€‚

> Qï¼šä¼ ç»Ÿå•ä½“åº”ç”¨å¦‚ä½•å®¹å™¨åŒ–æ”¹é€ ï¼Œå¯å¦åˆ†é˜¶æ®µå®žæ–½ï¼Ÿ

Aï¼šå¯ä»¥çš„ï¼Œå®¹å™¨åŒ–æ”¹é€ æˆ–å¾®æœåŠ¡åŒ–æ”¹é€ æœ‰å¾ˆå¤šå®žæ–½æ–¹æ³•ï¼Œä¾‹å¦‚é€æ¸é‡æž„æ‹†è§£ï¼Œæˆ–æ–°å¢žæ¨¡å—è¿›è¡Œå¾®æœåŠ¡åŒ–å’Œå®¹å™¨åŒ–ï¼Œæˆ–å¼€å‘æ–°çš„æ¨¡å—æ›¿ä»£åŽŸæœ‰åº”ç”¨çš„åŠŸèƒ½ç‚¹ï¼Œç­‰ç­‰ã€‚å„å›¢é˜Ÿå‡å¯ä»¥é€‰æ‹©åˆé€‚è‡ªèº«çš„æµç¨‹æ¥è¿›è¡Œæ”¹é€ ã€‚

> Qï¼šæ•°æ®åº“å¯ä»¥å®¹å™¨åŒ–å—ï¼Ÿ

Aï¼šå¯é€šè¿‡å°†æ•°æ®å·æŒ‚å…¥å®¹å™¨çš„æ–¹å¼å°†æ•°æ®åº“å®¹å™¨åŒ–ï¼Œä½†æ˜¯çŽ°åœ¨å®žé™…é¡¹ç›®ä¸­è¿˜å¾ˆå°‘è§ã€‚

> Qï¼šæœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œä¸¤ä¸ªæœåŠ¡æœ‰ä¾èµ–å…³ç³»ï¼ŒæœåŠ¡ A ä¾èµ–äºŽæœåŠ¡ Bï¼Œå¦‚ä½•ä¿è¯æœåŠ¡ A å’Œ B çš„å¯åŠ¨é¡ºåºçš„ï¼Ÿ

Aï¼šè‰¯å¥½çš„è®¾è®¡æ˜¯ä½¿å¾— A æœåŠ¡å¯åŠ¨åŽè‡ªè¡Œå®Œæˆå¯¹ B æœåŠ¡çš„æ£€æµ‹å‘çŽ°å’Œè°ƒç”¨ï¼Œè€Œä¸æ˜¯å¼ºä¾èµ–å…¶å¯åŠ¨é¡ºåº.

> Qï¼šKubernetes çš„æœåŠ¡çš„æ¨¡æ¿å’Œé…ç½®ï¼Œè¿™ä¸ªæ¨¡æ¿æ€Žä¹ˆæ¥çš„ï¼Œæ˜¯ç”¨æˆ·è‡ªå·±ç¼–æŽ’ï¼Ÿè¿˜æ˜¯è‡ªå·±äº‹å…ˆå‡†å¤‡å¥½çš„ï¼Ÿé…ç½®æ•°æ®æ˜¯æ€Žä¹ˆå­˜å‚¨çš„ï¼Ÿ

Aï¼šå› ä¸ºå½“å‰æ¨¡æ¿å’Œé…ç½®åªç”¨æ¥å¯åŠ¨æˆ‘ä»¬è‡ªèº«å¼€å‘çš„åº”ç”¨ï¼Œå› æ­¤è¿™ä¸ªæ¨¡æ¿æ˜¯æˆ‘ä»¬è‡ªå·±ä¸ºæˆ‘ä»¬çš„åº”ç”¨å‡†å¤‡çš„ã€‚é…ç½®æ•°æ®ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨ï¼Œä½†åŒæ—¶åœ¨ä½¿ç”¨æ–‡æœ¬å¼•æ“Žåšæ¨¡æ¿å’Œé…ç½®åˆå¹¶æ—¶ï¼Œä¹Ÿå¯ä»¥æŽ¥å—å‚æ•°ä½œä¸ºé…ç½®ã€‚

> Qï¼šä»€ä¹ˆæ˜¯ CI å’Œ CDï¼Œè¿™ä¸ªæžä¸æ‡‚ï¼Ÿ

Aï¼šCI æ›´å¤šæ˜¯åå‘åº”ç”¨ç¼–è¯‘ï¼Œä»£ç æ£€æŸ¥ï¼Œå•å…ƒæµ‹è¯•ç­‰åŠ¨ä½œï¼ŒCD æ˜¯åå‘äºŽåº”ç”¨éƒ¨ç½²ï¼Œè¿è¡Œæµç¨‹ã€‚æˆ‘ä»¬çš„å¼€å‘è¿‡ç¨‹åœ¨ç¼–è¯‘æ‰“åŒ…å®ŒæˆåŽï¼Œå®žé™…ä¹Ÿä¼šå°†åº”ç”¨è·‘èµ·æ¥ç”¨äºŽæµ‹è¯•ï¼Œä¹Ÿå¯ä»¥ç®—æ˜¯é’ˆå¯¹æµ‹è¯•çš„ CDã€‚

> Qï¼šä½¿ç”¨å®¹å™¨æ‰“åŒ… Jenkins æµç¨‹çš„ä¸»è¦æ”¶ç›Šæ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šç”±äºŽä¸åŒç¨‹åºå¯¹äºŽç¼–è¯‘çŽ¯å¢ƒçš„ä¾èµ–å„æœ‰ä¸åŒï¼ŒåŽŸæœ‰ä½¿ç”¨ Jenkins æ–¹æ³•æ˜¯åœ¨ Jenkins node ä¸Šå®ŒæˆçŽ¯å¢ƒå‡†å¤‡ï¼ŒçŽ°åœ¨å¯ä»¥åˆ©ç”¨å®¹å™¨å®ŒæˆçŽ¯å¢ƒå‡†å¤‡ï¼Œå¯¹äºŽ Jenkins node çš„ä¾èµ–å¯ä»¥è¿›ä¸€æ­¥é™ä½Žã€‚åŒæ—¶çŽ¯å¢ƒå˜æ›´ä¹Ÿå¯ä»¥ç”±å¼€å‘äººå‘˜è‡ªè¡ŒæŽ§åˆ¶ã€‚

> Qï¼šå¤šç¼–è¯‘çŽ¯å¢ƒæ˜¯ç”¨çš„ä¸åŒé•œåƒä¹ˆï¼Ÿå¦‚ä½•å¤„ç† Pipeline å¤„ç†ç¼–è¯‘çŽ¯å¢ƒçš„é—®é¢˜ï¼Ÿ

Aï¼šæ˜¯çš„ã€‚ç”±äºŽæˆ‘ä»¬æœ¬èº«äº§å“å¼€å‘å„ä¸ªæ¨¡å—æœ‰å„ä¸ªæ¨¡å—çš„å¼€å‘è¯­è¨€å’Œæ¡†æž¶ï¼Œå› æ­¤å„æ¨¡å—éƒ½è¦ç»´æŠ¤è‡ªèº«çš„ç¼–è¯‘çŽ¯å¢ƒé•œåƒã€‚ä½¿ç”¨ Pipeline åœ¨è¿›è¡Œç¼–è¯‘æ—¶ï¼Œæ˜¯é€šè¿‡ä½¿ç”¨é•œåƒè¿è¡Œå®¹å™¨ç„¶åŽåœ¨å®¹å™¨å†…ç¼–è¯‘çš„æ–¹å¼æ¥ä½¿ç”¨ç¼–è¯‘çŽ¯å¢ƒçš„ã€‚

> Qï¼šè¯·é—® Jenkins ä¹Ÿæ˜¯éƒ¨ç½²åœ¨ Docker é‡Œé¢çš„å—ï¼Ÿå¦‚æžœ Jenkins åœ¨ Docker é‡Œé¢æ€Žä¹ˆæ ·åœ¨ Docker é‡Œé¢ä½¿ç”¨ Docker æ‰§è¡Œ CIï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨æ‘¸ç´¢å°† Jenkins æœ¬èº«æ”¾åˆ°å®¹å™¨ä¸­è¿è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJenkins å®¹å™¨å†…ä½¿ç”¨ root æƒé™ï¼ŒæŒ‚è½½ docker.sock å’Œ Docker æ•°æ®ç›®å½•åˆ°å®¹å™¨ä¸­å°±å¯ä»¥äº†ã€‚

> Qï¼šä½¿ç”¨ Pipeline å…ˆæž„å»ºç¼–è¯‘çŽ¯å¢ƒé•œåƒï¼Œå†ç¼–è¯‘ï¼Œæ˜¯å¦ä¼šå¯¼è‡´æ•´ä¸ªæµç¨‹éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Ÿæ˜¯å¦æœ‰ä¼˜åŒ–æ–¹æ¡ˆï¼Ÿ

Aï¼šç¼–è¯‘é•œåƒç”±äºŽä¸ä¼šç»å¸¸å˜åŠ¨ï¼Œå› æ­¤è¿™ä¸ªé•œåƒçš„æž„å»ºé€šå¸¸ä½¿ç”¨ cache å°±èƒ½ç›´æŽ¥å®Œæˆï¼Œå¦å¤–æˆ‘ä»¬ä¹ŸæŠŠç¼–è¯‘çŽ¯å¢ƒé•œåƒæ‰“åŒ…è¿™ä¸ªæ­¥éª¤æŠ½å‡ºæ¥å•ç‹¬ä½œä¸º job æ‰§è¡Œäº†ï¼Œè¿™æ ·åœ¨å®žé™…ç¼–è¯‘æµç¨‹ä¸­å°±æ— éœ€å†è¿›è¡Œç¼–è¯‘çŽ¯å¢ƒæž„å»ºã€‚

> Qï¼šJenkins å’Œ Kubernetes çš„ç”¨æˆ·æ˜¯æ€Žä¹ˆç®¡ç†çš„ï¼Ÿæˆ‘çš„æœŸæœ›æ˜¯ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±å¾—èµ„æºï¼Œåˆ«çš„ç”¨æˆ·æ˜¯æ²¡æœ‰æƒé™çš„ã€‚

Aï¼šæˆ‘ä»¬æœ¬èº«åªæ˜¯ä½¿ç”¨è¿™ä¸¤ç§å·¥å…·ï¼Œåœ¨å¼€å‘çŽ¯å¢ƒä¸­ä¸å¯¹å¤–ï¼Œæ‰€æœ‰ä¸å­˜åœ¨ç”¨æˆ·ç®¡ç†çš„é—®é¢˜ã€‚åœ¨æˆ‘ä»¬å…¬å¸æ­£åœ¨å¼€å‘çš„ CICD äº§å“ä¸­ï¼Œå¯¹è¿™å—æœ‰æˆ‘ä»¬è‡ªèº«ç†è§£åŸºç¡€ä¸Šçš„è®¾è®¡ã€‚

> Qï¼šJenkins çš„æŒç»­é›†æˆæ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿæ¯”å¦‚ä¸åŒçš„æºç ä»“åº“çš„æäº¤è§¦å‘ï¼Œå¦‚ GitHubã€GitLab ç‰ˆæœ¬å·æ€Žä¹ˆæŽ§åˆ¶çš„ï¼Ÿ

Aï¼šJenkins çš„ CI æµç¨‹è§¦å‘å¯ä»¥æœ‰å¾ˆå¤šç§ï¼Œä»£ç æäº¤è§¦å‘ï¼Œå®šæ—¶è§¦å‘ï¼Œæ‰‹åŠ¨è§¦å‘ã€‚ç‰ˆæœ¬å·çš„æŽ§åˆ¶ä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šæ–¹æ¡ˆï¼Œæ¯”å¦‚ä½¿ç”¨ job çš„ç¼–å·ï¼Œä½¿ç”¨ Git çš„ commit å·ï¼Œä½¿ç”¨æ—¶é—´æˆ³ç­‰ç­‰ã€‚

> Qï¼šå®¹å™¨åŒ–åŽå‘å¸ƒä¹Ÿè¦é€šè¿‡ Jenkinsï¼Œæ„Ÿè§‰ Docker çš„å‘å¸ƒæ²¡æœ‰ Jenkins æ–¹ä¾¿ï¼Œé™¤äº†å®¹å™¨åŒ–çš„å¯ç§»æ¤ï¼Œè¿˜æœ‰ä»€ä¹ˆåŽŸå› å€¼å¾—æŽ¨è¿›é¡¹ç›®å®¹å™¨åŒ–ï¼Ÿ

Aï¼šåº”ç”¨å®¹å™¨åŒ–ï¼Œå…¶å®žæ›´å¤šçš„æ˜¯çœ‹é‡åº”ç”¨åœ¨å®¹å™¨ç®¡ç†å¹³å°ä¸Šè¿è¡Œèµ·æ¥åŽæ‰€èŽ·å¾—çš„èƒ½åŠ›ï¼Œä¾‹å¦‚åœ¨ Kubernetes ä¸Šè¿è¡ŒåŽçš„æ°´å¹³æ‰©å±•ï¼ŒæœåŠ¡å‘çŽ°ï¼Œæ»šåŠ¨å‡çº§ï¼Œç­‰ç­‰ã€‚

> Qï¼šKubernetes update éœ€è¦åˆ¶å®šæ–°çš„é•œåƒæ‰èƒ½åšæ»šæœæ›´æ–°ï¼ˆå‡çº§ï¼‰ï¼Œå¦‚æžœåªæ˜¯æ›´æ–°äº† ConfigMapï¼Œæœ‰åŠžæ³•åšæ»šæœæ›´æ–°å—ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ CI æµç¨‹å®ŒæˆåŽï¼Œå„æ¨¡å—çš„é•œåƒ tag ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬åˆ©ç”¨å…·ä½“ç”Ÿæˆçš„ tag ç”Ÿæˆé…ç½®ï¼Œç„¶åŽéƒ¨ç½²çš„ YAML æ–‡ä»¶å†™ä¸ºæ¨¡æ¿ï¼Œé•œåƒçš„å…·ä½“ tag ä¼šæ ¹æ®æ¯æ¬¡ CI æµç¨‹ç”Ÿæˆçš„é…ç½®ä¸åŒè€Œç»„åˆä¸ºä¸åŒçš„ YAML æ–‡ä»¶ï¼Œç„¶åŽä½¿ç”¨ç»„åˆåŽçš„ yamlï¼Œå³ tag å·²ç»å˜æ›´ä¸ºæœ€æ–°ç‰ˆæœ¬çš„ YAML æ–‡ä»¶è¿›è¡Œåº”ç”¨çš„æ»šåŠ¨å‡çº§ã€‚

> Qï¼šPipeline é‡‡ç”¨åœ¨é•œåƒé‡Œæž„å»ºçš„æ–¹æ¡ˆï¼Œæ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿç”¨ Jenkins çŽ°æˆçš„æ’ä»¶ or ç”¨ Groovy è„šæœ¬å®žçŽ°ï¼Ÿ

Aï¼šä½¿ç”¨äº† Jenkins çš„ Docker æ’ä»¶ï¼ŒåŒæ—¶ä½¿ç”¨æ–¹å¼æ˜¯å°†ç›¸åº”å‘½ä»¤å†™åœ¨ Groovy è„šæœ¬é‡Œï¼Œä¾‹å¦‚ï¼š`stage('Build'){docker.image('golang:1.7').inside { sh './script/build.sh'   }  }`{.prettyprint}ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 2 æœˆ 28 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**é»„æ–‡ä¿Šï¼Œæœ‰å®¹äº‘èµ„æ·±ç³»ç»Ÿæž¶æž„å¸ˆã€‚ä¸»è¦è´Ÿè´£å®¹å™¨äº‘å¹³å°äº§å“æž¶æž„åŠè®¾è®¡ï¼Œ8 å¹´å·¥ä½œç»éªŒï¼Œæœ‰ç€ä¼ä¸šçº§å­˜å‚¨ï¼Œäº‘è®¡ç®—è§£å†³æ–¹æ¡ˆç›¸å…³ç†è§£ã€‚å…³æ³¨äºŽå¾®æœåŠ¡è®¾è®¡æ€è€ƒï¼Œå¼€å‘æµç¨‹ä¼˜åŒ–ï¼ŒDocker åŠ Kubernetes æŠ€æœ¯åœ¨å®žé™…çŽ¯å¢ƒä¸­çš„åº”ç”¨ã€‚

---

### 2017-02-22ï¼šSRE å·¥ç¨‹å®žè·µ------åŸºäºŽæ—¶é—´åºåˆ—å­˜å‚¨æ•°æ®çš„æŠ¥è­¦

> Qï¼šå‘Šè­¦ä¿¡æ¯æ”¶åˆ°åŽï¼Œç³»ç»Ÿæœ‰æ²¡æœ‰èƒ½åŠ›è‡ªåŠ¨è§£å†³å‘Šè­¦æŠ¥å‘Šçš„é—®é¢˜ï¼Ÿè¿˜æ˜¯éœ€è¦äººå·¥è§£å†³é—®é¢˜ï¼Ÿè°¢è°¢

Aï¼šè¿™ä¸ªè¦åˆ†æƒ…å†µï¼Œå¥½çš„æœºåˆ¶æ˜¯æŠ¥è­¦åº”è¯¥å‘å‡ºçš„æ˜¯æ–°çš„é—®é¢˜ï¼Œç„¶åŽé€šè¿‡åé¦ˆæœºåˆ¶ï¼Œè®©åŒç±»çš„é—®é¢˜ä¸å†å‘ç”Ÿï¼Œæˆ–è€…ç”±ç›‘æŽ§ç³»ç»Ÿè‡ªèº«è§£å†³ã€‚

> Qï¼šInfluxDB ç³»åˆ—æ–¹æ¡ˆæ˜¯å¦æœ‰è€ƒè™‘ï¼ŒGrafana æœ€æ–°ç‰ˆä¹Ÿæœ‰äº†å¾ˆå¥½çš„å‘Šè­¦æœºåˆ¶ï¼Œæ˜¯å¦æœ‰å°è¯•ï¼Ÿ

Aï¼šæ›¾ç»è€ƒè™‘å¹¶å®žè·µè¿‡ InfluxDB çš„ TICK ç»„åˆæ–¹æ¡ˆï¼Œéžå¸¸æ–¹ä¾¿å¯ä»¥å®žçŽ°æ•°æ®æ”¶é›†å­˜å‚¨å¤„ç†å±•ç¤ºçš„å®Œæ•´æµç¨‹ã€‚é€šè¿‡å¯¹æ¯”ï¼Œæˆ‘ä»¬å‘çŽ° Prometheus æ›´ç¬¦åˆ Google SRE å¯¹äºŽç›‘æŽ§çš„ç†å¿µï¼Œè‡ªèº«ç¤¾åŒºä¹Ÿéžå¸¸æ´»è·ƒï¼Œå°±è½¬å‘ Prometheus çš„æ–¹æ¡ˆäº†ã€‚Grafana å®žçŽ°äº†å¼ºå¤§çš„å¯è§†åŒ–é…ç½®æŠ¥è­¦è§„åˆ™çš„åŠŸèƒ½ï¼Œå¯¹äºŽåŽŸæœ¬åªåšä¸ºå±•ç¤ºçš„å·¥å…·ï¼Œæ˜¯å¾ˆå¥½çš„å¢žå¼ºï¼Œè¿™ä¸ªå¯¹æˆ‘ä»¬çš„å¯å‘ä¹Ÿå¾ˆå¤§ï¼Œä¹Ÿåœ¨å­¦ä¹ ä¸­ã€‚

> Qï¼šæŠ¥è­¦è§„åˆ™é…ç½®æ˜¯ä»€ä¹ˆè¯­æ³•ï¼Œæ˜¯å¦å¯ä»¥å¯è§†åŒ–ï¼Ÿ

Aï¼šPrometheus æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­æè¿°æŠ¥è­¦è§„åˆ™ã€‚å¯ä»¥è‡ªå·±åŠ¨æ‰‹å®žçŽ°å¯è§†åŒ–ã€‚

> Qï¼šæ•°æ®é‡åºžå¤§çš„æƒ…å†µæ€Žä¹ˆè§£å†³ï¼Œæ¯”å¦‚è¯´ä¸‡å°æœºå™¨ï¼Œ500 ä¸ªæŒ‡æ ‡æ•°æ®ç­‰ä¸€åˆ†é’Ÿä¸€ä¸ªç‚¹ 60*2430*50010000 çš„æ•°æ®é‡ï¼Œå¦‚ä½•ä¿å­˜ï¼Œå¦‚ä½•å¿«é€ŸæŸ¥è¯¢æ•°æ®ã€‚éœ€è¦ä»€ä¹ˆæ ·çš„æž¶æž„å’Œç¡¬ä»¶ï¼Ÿ

Aï¼šç®€å•å›žç­”ï¼ŒPrometheus å¯ä»¥é€šè¿‡åˆ†ç»„æ”¯æŒå¤§è§„æ¨¡çš„é›†ç¾¤ï¼Œä½†æ˜¯è¾¾åˆ°æŸä¸ªç¡®å®šçš„è§„æ¨¡ï¼Œé‚£å°±éœ€è¦å®žè·µç»™å‡ºç­”æ¡ˆäº†ã€‚

> Qï¼šè¯·é—®åœ¨ç›‘æŽ§æŠ¥è­¦æ–¹é¢æœ‰æ²¡æœ‰è€ƒè™‘æˆ–å®žè·µè¿‡æ™ºèƒ½é¢„è­¦ï¼Œæ¯”å¦‚åŸºäºŽåŽ†å²ç›‘æŽ§æ•°æ®ï¼Œé€šè¿‡æœºå™¨å­¦ä¹ ï¼Œå®žçŽ°æå‰é¢„è­¦ç­‰ï¼Ÿ

Aï¼šè¿™ä¸ªä¸æ˜¯ SRE æŽ¨èçš„æ–¹å¼ï¼ŒæŠ¥è­¦åº”è¯¥ç®€å•ï¼Œé«˜çº§çš„åŠŸèƒ½ä¼šæ¨¡ç³ŠçœŸå®žçš„æ„å›¾ã€‚

> Qï¼šè¯·é—®åŸºäºŽæ­¤æ–¹æ¡ˆéƒ¨ç½²çš„ä¸»æœºå’Œå®¹å™¨è§„æ¨¡æœ‰å¤šå¤§ï¼ŒåŸºäºŽä»€ä¹ˆé¢‘çŽ‡è¿›è¡Œç›‘æŽ§æ”¶é›†ï¼Ÿ

Aï¼šæœ¬æ¬¡åˆ†äº«çš„æ˜¯æµ‹è¯•çŽ¯å¢ƒï¼Œè§„æ¨¡ä¸å¤§ã€‚Prometheus å®šæ—¶ä»Ž cAdvisor æ”¶é›†æ•°æ®ï¼ŒæŠ“å–é¢‘çŽ‡ 5sã€‚

> Qï¼šcAdvisor é‡‡é›†æ•°æ®çš„æ€§èƒ½è¡¨çŽ°æ€Žä¹ˆæ ·ï¼Œå ç”¨ä¸»æœºçš„èµ„æºå¤§å˜›ï¼Ÿ

Aï¼šæ€§èƒ½è¡¨çŽ°ä¼˜å¼‚ï¼Œæ‹…å¿ƒå ç”¨èµ„æºï¼Œå¯ä»¥åœ¨å¯åŠ¨å®¹å™¨æ—¶è¿›è¡Œèµ„æºé™åˆ¶ã€‚

> Qï¼šAPP è‡ªèº«ä¸šåŠ¡é€»è¾‘éœ€è¦ç›‘æŽ§çš„æ•°æ®ï¼Œæ¯”å¦‚ Counterï¼ŒGauge ç­‰ï¼Œä¼ ç»Ÿç”¨ Zabbix ç­‰å¯ä»¥è¿›è¡Œæ•°æ®é‡‡é›†ã€‚æˆ‘æ˜Žç™½ cAdvisor æ˜¯å¯¹ Container è¿›è¡Œæ•°æ®é‡‡é›†ã€‚ä½†æ˜¯æœ‰æ²¡æœ‰å¯èƒ½æŠŠ APP è‡ªèº«çš„ç›‘æŽ§å’Œ Container çš„ç›‘æŽ§ç»“åˆï¼Ÿ

Aï¼šåŽç»­è¯é¢˜ï¼Œæˆ‘ä»¬ä¼šå®žè·µæœ‰å…³åº”ç”¨çš„ç›‘æŽ§æŠ¥è­¦ã€‚Prometheus çš„é€»è¾‘æ˜¯å®šæ—¶ä»Ž exporter æŠ“å–æ•°æ®ï¼Œç„¶åŽå¯¹å­˜å‚¨çš„æ—¶åºæ•°æ®ï¼Œé€šè¿‡ PromQL è¿›è¡ŒæŸ¥è¯¢å’Œåˆ†æžï¼Œæ‰€ä»¥æ˜¯å¯ä»¥å®žçŽ° APP è‡ªèº«çš„ç›‘æŽ§å’Œå®¹å™¨ç›‘æŽ§çš„ç»“åˆçš„ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 2 æœˆ 21 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**çª¦ä¸­å¼ºï¼Œæ•°äººäº‘ç ”å‘å·¥ç¨‹å¸ˆã€‚å¤šå¹´è¿ç»´å¼€å‘ç»éªŒï¼Œç†Ÿæ‚‰é…ç½®ç®¡ç†ï¼ŒæŒç»­é›†æˆç­‰ç›¸å…³æŠ€æœ¯å’Œå®žè·µï¼Œç›®å‰è´Ÿè´£æ•°äººäº‘å¹³å°ç›‘æŽ§æŠ¥è­¦ç»„ä»¶çš„ç ”å‘å·¥ä½œã€‚

---

### 2017-02-15ï¼šä¹è§†äº‘åŸºäºŽ Kubernetes çš„ PaaS å¹³å°å»ºè®¾

> Qï¼šä½ ä»¬çš„ IP ç®¡ç†åº”è¯¥åšäº†å¾ˆå¤§çš„å¼€å‘å·¥ä½œå§ï¼Ÿèƒ½è¯¦ç»†ä»‹ç»ä¸€ä¸‹ï¼Ÿ

Aï¼šç¡®å®žåšäº†å¾ˆå¤šå¼€å‘å·¥ä½œï¼Œå…¶ä¸­å¾ˆå¤§çš„ä¸€ä¸ªå¼€å‘é‡æ˜¯å…³äºŽç©ºé—² IP èŽ·å–è¿™å—ã€‚

> Qï¼šè¿˜æœ‰ä½ ä»¬çš„ç°åº¦å‘å¸ƒæ˜¯ç”¨çš„ Kubernetes æœ¬èº«æ»šåŠ¨æ›´æ–°åŠŸèƒ½ï¼Ÿè¿˜æ˜¯è‡ªå·±å®žçŽ°çš„ï¼Ÿ

Aï¼šç°åº¦å‘å¸ƒæ²¡ç”¨ Kubernetes çš„æ»šåŠ¨æ›´æ–°æ›´èƒ½ï¼Œè€Œæ˜¯ç”¨äº†ä¸åŒçš„ RC çš„ç›¸äº’åˆ‡æ¢ã€‚

> Qï¼šå¤šä¸ª Region çš„é•œåƒç®¡ç†ï¼Œå¦‚ä½•å®žçŽ°é•œåƒåŒæ­¥ä¸Žæ›´æ–°ï¼Ÿ

Aï¼š æˆ‘ä»¬ä¸éœ€è¦å®žçŽ°é•œåƒçš„åŒæ­¥ã€‚åˆ†äº«ä¸­å·²ç»æåˆ°è¿‡ï¼Œå„ä¸ª Region æœ‰è‡ªå·±çš„é•œåƒä»“åº“ã€‚

> Qï¼šä½ å¥½è¯·é—®ä½ ä»¬å¤§äºŒå±‚ç½‘ç»œæ˜¯ç”¨å¼€æºæ–¹æ¡ˆå®žçŽ°çš„è¿˜æ˜¯è‡ªå·±æ ¹æ® OVS å¼€å‘å®žçŽ°çš„ï¼Ÿ

Aï¼šæ˜¯æˆ‘ä»¬è‡ªå·±å®žçŽ°çš„ï¼Œæˆ‘ä»¬ CNI ä¸­è°ƒç”¨äº† OVSï¼Œä¸»è¦æ˜¯ä½¿ç”¨äº† OVS çš„ç½‘æ¡¥åŠŸèƒ½ã€‚

> Qï¼šåº”ç”¨è·¨æœºæˆ¿éƒ¨ç½²ï¼Œæˆ‘ç†è§£ä¹Ÿå°±æ˜¯å¯ä»¥è·¨ Kubernetes é›†ç¾¤éƒ¨ç½²ï¼ŒKubernetes é‡Œçš„è°ƒåº¦æ˜¯å¦‚ä½•åšçš„ï¼Ÿ

Aï¼šåº”ç”¨çš„æ¦‚å¿µï¼Œæ˜¯åœ¨ Kubernetes é›†ç¾¤ä¹‹ä¸Šçš„ï¼Œåº”ç”¨å¯ä»¥éƒ¨ç½²åœ¨å¤šä¸ª Kubernetes é›†ç¾¤ä¸­ã€‚

> Qï¼šè¯·é—®è´µå…¬å¸å†…éƒ¨æœåŠ¡ä¹‹é—´çš„äº’ç›¸è°ƒç”¨æ˜¯æ€Žä¹ˆæŽ§åˆ¶çš„ï¼Ÿå®¹å™¨åˆ°å®¹å™¨è¿˜æ˜¯å®¹å™¨-Nginx-å®¹å™¨ï¼ˆç­‰åŒå¤–éƒ¨ï¼‰ï¼Ÿ

Aï¼š1. å®¹å™¨-> å®¹å™¨ 2. å¤–éƒ¨æœåŠ¡->Nginx-> å®¹å™¨ 3. å®¹å™¨->Nginx-> å®¹å™¨ 4. å®¹å™¨-> å¤–éƒ¨æœåŠ¡ã€‚ è¿™ç§æƒ…å†µéƒ½æœ‰ï¼Œä¸»è¦çœ‹ä¸šåŠ¡åœºæ™¯ã€‚

> Qï¼šæž„å»ºæœåŠ¡é›†ç¾¤ç”¨åˆ°ä»€ä¹ˆ CI å·¥å…·ï¼Œè¿˜æ˜¯è‡ªå·±å¼€å‘çš„ï¼Ÿetcd åœ¨å…¶ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

Aï¼šè‡ªå·±å¼€å‘çš„ï¼Œetcd ç›¸å½“äºŽæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒæŽ§åˆ¶å±‚æ”¶åˆ°æž„å»ºè¯·æ±‚åŽï¼Œetcd ä¸­å­˜æ”¾äº†çŽ°é˜¶æ®µé›†ç¾¤ä¸‹éƒ½æœ‰å“ªäº›æž„å»ºæœºï¼Œå½“æ¥åˆ°æž„å»ºè¯·æ±‚åŽï¼ŒæŽ§åˆ¶å±‚ä¼šå¯»æ‰¾ä¸€ä¸ªæž„å»ºæœºå™¨ï¼Œå¹¶å‘æž„å»ºæœºå™¨æ‰€åœ¨çš„ etcd key ä¸­å‘é€å‘½ä»¤ï¼Œ å¯¹åº”çš„æž„å»ºæœºå™¨åœ¨ç›‘æŽ§è‡ªå·±çš„ key å‘ç”Ÿå˜åŒ–åŽï¼Œä¼šæ‰§è¡Œç›¸åº”çš„æž„å»ºä»»åŠ¡ã€‚

---

### 2017-01-18ï¼šåº¦é‡é©±åŠ¨çš„ DevOps è½¬åž‹

> Qï¼šåŸºäºŽ Jenkins çš„ CI/CD ä¸åŒç”¨æˆ·æ˜¯æ€Žä¹ˆç®¡ç†çš„ ï¼Ÿæƒé™æ€Žä¹ˆæŽ§åˆ¶çš„ï¼Ÿ

Aï¼šåœ¨ DevOps å®žæ–½é‡Œé¢æå€¡å……åˆ†æŽˆæƒå›¢é˜Ÿï¼Œæ‰€ä»¥åœ¨åŸºç¡€è®¾æ–½è‡ªæœåŠ¡çš„åŸºç¡€ä¸Šè®©å›¢é˜Ÿæœ‰è‡ªå·±ç‹¬å çš„ Jenkins Master èƒ½å¤Ÿæœ‰æ•ˆçš„å‡å°‘æƒé™æŽ§åˆ¶æ­¤ç±»é—®é¢˜ï¼ŒåŒæ—¶å¯ä»¥é¿å…ä¸åŒå›¢é˜Ÿä¹‹é—´æž„å»ºä»»åŠ¡çš„ç›¸äº’å½±å“ï¼›å¦‚æžœæ˜¯å…±ç”¨ JenkinsMasterï¼ŒJenkins æœ‰æƒé™æŽ§åˆ¶çš„æ’ä»¶å¯ä»¥æŽ§åˆ¶ç”¨æˆ·çš„æƒé™ã€‚

> Qï¼šåˆšæ‰ä½ ä»‹ç»çš„ CI æ•´ä¸ªäº¤ä»˜æµç¨‹ï¼Œæ¯ä¸ªç»†èŠ‚éƒ½éœ€è¦èŠ±å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›åŽ»å¼€å‘å’Œå®žæ–½ï¼Œå¦‚æžœå…¬å¸å›¢é˜Ÿå¾ˆå¤šï¼Œå¦‚æžœåˆ†é…è‡ªå·±å›¢é˜Ÿçš„æ—¶é—´ï¼Œæ—¶é—´å°‘äº†è‡ªç„¶è¾¾ä¸åˆ°æ•ˆæžœã€‚

Aï¼šåœ¨å®žæ–½ DevOps è½¬åž‹è¿‡ç¨‹é‡Œé¢ï¼Œå¯ä»¥å…ˆå°è¯•è¯•ç‚¹å›¢é˜Ÿï¼Œé€šè¿‡è¯•ç‚¹å›¢é˜ŸåŽ»å®Œæˆ DevOps å·¥å…·é“¾ç›¸å…³çš„æŠ€æœ¯é€‰åž‹ï¼Œåœ¨å·¥å…·é“¾æˆç†Ÿçš„æƒ…å†µä¸‹å‘å…¶å®ƒå›¢é˜ŸæŽ¨å¹¿ã€‚

> Qï¼šè¯·é—®ä½ ä»¬æœ‰ DevOps çš„è‡ªåŠ¨åŒ–è¿ç»´å¹³å°å—ï¼Ÿå¯èƒ½æ˜¯ä¸€ä¸ª Web é¡µé¢ï¼ŒæŠŠ DevOps ç›¸å…³çš„æµç¨‹å’Œå·¥å…·é›†æˆåœ¨ä¸Šé¢ï¼Œæ–¹ä¾¿ç®¡ç†çš„åŒæ—¶ä¹Ÿæ–¹ä¾¿è¿ç»´å¼€å‘ä¸€ä½“åŒ–æ“ä½œã€‚è¿™ä¸ªå¹³å°å¯èƒ½è¿˜åŒ…æ‹¬å…¨é“¾è·¯æ£€æµ‹ç³»ç»Ÿï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬å…¬å¸åšçš„åŸºäºŽå®¹å™¨æŒç»­äº¤ä»˜å¹³å°ä¸»è¦å°±æ˜¯è§£å†³æ­¤ç±»é—®é¢˜ï¼Œé€šè¿‡æµæ°´çº¿æ¥ç»„ç»‡å·¥å…·é“¾ï¼ŒåŒæ—¶å¯¹ç›¸å…³çš„çŽ¯èŠ‚è¿›è¡Œåº¦é‡ï¼Œä¸ºé¿å…å¹¿å‘Šå«Œç–‘å°±ä¸ä¾¿å¤šè¯´ã€‚

> Qï¼šä½ ä»¬åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ€Žä¹ˆåšæ²Ÿé€šç®¡ç†ï¼Œä»¥é˜²æ­¢å› ä¸ºè¿™é€ æˆçš„å¯¹éœ€æ±‚ç†è§£çš„åå·®ç­‰é—®é¢˜ï¼Ÿ

Aï¼šè¿™å—æ›´å¤šæ˜¯å›¢é˜Ÿçš„ç»„ç»‡ç»“æž„çš„é—®é¢˜ï¼Œæœ‰å…´è¶£å¯ä»¥å°è¯•é€šè¿‡çœ‹æ¿æ–¹æ³•ï¼Œå›¢é˜Ÿçš„å„ä¸ªè§’è‰²éƒ½ä¼šåŸºäºŽçœ‹æ¿å®Œæˆè¿­ä»£çš„å¼€å‘ï¼Œé€šè¿‡çœ‹æ¿å¯ä»¥å¸®åŠ©å›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„æ²Ÿé€šå’Œéœ€æ±‚ç¡®è®¤ã€‚

> Qï¼šå› ä¸ºå¾ˆç®€å•ï¼ŒæŒç»­é›†æˆæŒç»­äº¤ä»˜ï¼Œå¿«é€Ÿè¿­ä»£ï¼Œå°æ­¥å¿«è·‘ï¼Œç¨³æ‰Žç¨³æ‰“ï¼Œè¿™äº›éƒ½æœ‰æ‰€æœ‰çš„ç†è®ºæœ€åŽéƒ½å›žå½’åˆ°ä»£ç ï¼Œæ‰€æœ‰çš„å˜æ›´éƒ½å›žå½’åˆ°æœ¬æºä»£ç çš„å˜æ›´ï¼Œå¦‚ä½•ä¿éšœæ‰€æœ‰çš„å˜æ›´æ— é—æ¼ï¼Œå¦‚ä½•ä¿è¯æ¯ä¸€æ¬¡ä»»åŠ¡éƒ½åœ¨æ­£ç¡®çš„ä»£ç åŸºå‡†çº¿ä¸Šè¿›è¡Œï¼Œå¦‚ä½•å‡ºäº†é—®é¢˜å¿«é€Ÿåé¦ˆåˆ°ç ”å‘ç¬¬ä¸€çº¿ï¼ŒåŠæ—¶ç»ˆæ­¢é—®é¢˜çš„è”“å»¶ï¼Ÿ

Aï¼šè¿™å—å…¶å®žä¸»è¦çš„æ–¹å¼å°±æ˜¯åŸºäºŽæŒç»­éƒ¨ç½²æµæ°´çº¿çš„æ–¹å¼ï¼Œä¸Šé¢åˆ†äº«çš„æ—¶å€™æœ‰æåˆ°ã€‚é€šè¿‡å°†æµæ°´çº¿é€šè¿‡è‡ªåŠ¨åŒ–æµæ°´çº¿çš„æ–¹å¼è¿›è¡ŒæŽ§åˆ¶ï¼Œåœ¨ä»»ä½•é˜¶æ®µå‡ºçŽ°é—®é¢˜éƒ½åº”è¯¥è®©æµæ°´çº¿å¤±è´¥ï¼ˆé—¨ç¦ï¼‰ï¼Œå¦å¤–å‡ºé—®é¢˜ä¸æ€•ï¼Œå¿«é€Ÿè§£å†³é—®é¢˜æ˜¯å…³é”®ï¼Œå¯¹äºŽæµæ°´çº¿æœ€å¥½å¯ä»¥è®¾ç½® Webhook å®žæ—¶è§¦å‘ï¼Œå¯ä»¥ç¡®ä¿å½“é—®é¢˜å‡ºçŽ°åŽï¼Œé—®é¢˜ä»£ç çš„åŸŸå¯ä»¥å…³è”åˆ°æœ€è¿‘çš„ä¸€æ¬¡æäº¤ã€‚

> Qï¼šè¯·é—®ä½ ä»¬å®¹å™¨å‘å¸ƒæ˜¯å¦‚ä½•è‡ªåŠ¨åŒºåˆ†å¼€å‘ã€æµ‹è¯•ã€æ­£å¼ç­‰ä¸åŒçŽ¯å¢ƒçš„ï¼Œæ˜¯å¦éœ€è¦äººå·¥ä»‹å…¥ä¿®æ”¹åº”ç”¨è®¿é—®å…³ç³»å’Œå¯åŠ¨çŽ¯å¢ƒå˜é‡ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬è‡ªå·±æŒç»­äº¤ä»˜å¹³å°å¯¹æŽ¥ä¸åŒçš„å®¹å™¨è¿è¡ŒçŽ¯å¢ƒï¼ˆç›®å‰ä¸»è¦æ˜¯ Rancherï¼‰ï¼Œå›¢é˜Ÿä¼šå¯¹çŽ¯å¢ƒè¿›è¡Œåˆ†ç±»ç®¡ç†ï¼Œæµæ°´çº¿ä¸­è¿›è¡Œå®¹å™¨éƒ¨ç½²çš„æ—¶å€™é€‰æ‹©ç›¸åº”çš„çŽ¯å¢ƒå³å¯ï¼›å¦å¤–ç”±äºŽä¸»è¦æ˜¯åŸºäºŽå®¹å™¨åœ¨åšï¼Œæ‰€ä»¥ä¹Ÿå¯¹å®¹å™¨é•œåƒçš„ä¸åŒçŠ¶æ€ä¹Ÿè¿›è¡Œäº†åˆ’åˆ†ï¼Œå¹¶ä¸”åœ¨å¤šä¸ª Registry å®žä¾‹ä¹‹é—´è¿›è¡Œäº†æµè½¬ï¼Œç‰©ç†éš”ç¦»äº†å¼€å‘ï¼Œæµ‹è¯•ä»¥åŠå‘å¸ƒçŠ¶æ€çš„å®¹å™¨é•œåƒã€‚äººå·¥ä»‹å…¥çš„éƒ¨åˆ†ä¸»è¦æ˜¯æŽ§åˆ¶é•œåƒçŠ¶æ€çš„å˜åŒ–è¿™å—ã€‚

> Qï¼šJenkins çš„ Pipeline å’Œæ™®é€šçš„ Project éƒ½å¯ä»¥æ”¯æŒæµæ°´çº¿ ï¼Œ2 è€…æœ‰åŒºåˆ«å—ï¼Ÿ

Aï¼šä¸»è¦è§£å†³çš„é—®é¢˜å°±æ˜¯å½“æž„å»ºå‡ºé—®é¢˜çš„æ—¶å€™å¦‚ä½•å¿«é€Ÿå®šä½é—®é¢˜ï¼Œå‡å¦‚åœ¨æµæ°´çº¿çº¿ä¸­æ¶‰åŠ 8 ä¸ªé˜¶æ®µï¼Œå¦‚æžœåªæ˜¯åœ¨ä¸€ä¸ª Project ä¸­å®žçŽ°ï¼Œéœ€è¦å¼€å‘è€…èŠ±å¾ˆå¤šæ—¶é—´å®šä½ï¼›å¦‚æžœæ˜¯ Build Pipeline çš„è¯ï¼Œåˆ™å¯ä»¥å¾ˆç›´è§‚çš„çŸ¥é“é—®é¢˜æ˜¯å‘ç”Ÿåœ¨ä»€ä¹ˆé˜¶æ®µã€‚

---

### 2017-01-17ï¼šè‰ºé¾™éƒ¨ç½²ä½“ç³»çš„æ¼”è¿›

> Qï¼šéº»çƒ¦é—®ä¸€ä¸‹ï¼Œæ¡¥æŽ¥çš„ç½‘ç»œæ˜¯ç»™å®¹å™¨çš„åˆ†é…ä¸€ä¸ªç‰©ç†ç½‘ç»œçš„ IP å—ï¼Ÿå¦å¤–ä¾æ®ä»€ä¹ˆæ¥ç¡®å®šæ¯å°ä¸»æœºè¿è¡Œå¤šå°‘å®¹å™¨ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œæˆ‘ä»¬ç»™æ¯ä¸ªå®¹å™¨åˆ†é…äº†ä¸€ä¸ªç‰©ç†ç½‘ç»œçš„ IPï¼Œæˆ‘ä»¬æ ¹æ®ç›®å‰æˆ‘ä»¬ç‰©ç†æœºçš„è§„æ ¼åŽ»åˆ¶å®šçš„å®¹å™¨æ•°é‡ï¼Œç›®å‰æ¯å°ç‰©ç†æœºåˆ†é…ä¸Šé™æ˜¯ 64 ä¸ªã€‚

> Qï¼šDocker å­˜å‚¨è€ƒè™‘è¿‡ Overlay å½“æ—¶å—ï¼Ÿæ®è¯´è¿™ç§æž„å»ºé•œåƒæ¯”è¾ƒå¿«ã€‚

Aï¼šè€ƒè™‘è¿‡ï¼Œå½“æ—¶ä¹Ÿåšè¿‡å„ä¸ªæ–¹é¢çš„æµ‹è¯•ï¼Œè¿™ç§å¢žé‡å¼çš„æž„å»ºï¼Œè‚¯å®šæœ€å¿«ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æœ‰ä¸“äººä»Žæºç çº§åˆ«å¯¹å…¶è¿›è¡Œç»´æŠ¤ï¼Œæˆæœ¬å¯¹äºŽæˆ‘ä»¬è¿˜æ˜¯æœ‰ç‚¹é«˜ï¼Œæˆ‘ä»¬åŽæœŸæ‰“ç®—é‡‡ç”¨çŽ¯å¢ƒå’Œä»£ç åˆ†ç¦»çš„æ–¹å¼ï¼Œå³çŽ¯å¢ƒéƒ¨ç½²ä¸€æ¬¡ï¼Œä»£ç å¤šæ¬¡éƒ¨ç½²æ¥æå‡æ•ˆçŽ‡ã€‚

> Qï¼š.net ä¸æ˜¯ä¹Ÿå¯ä»¥è·‘åˆ° Linux ä¸Šäº†å—ï¼Ÿæœ‰.net é•œåƒå§ï¼Ÿ

Aï¼šæˆ‘ä»¬è°ƒç ”è¿‡ï¼Œä½†æ˜¯è¿™ä¸ªæŠ€æœ¯å¤ªæ–°äº†ï¼Œç¨³å®šæ˜¯æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ–°æŠ€æœ¯çš„å‰æï¼Œè€Œä¸”æˆ‘ä»¬çš„.net æœåŠ¡å¤§å¤šå·²ç»æ˜¯å¾ˆå¤šå¹´å‰çš„è€æœåŠ¡ï¼ŒæŠ˜è…¾èµ·æ¥æ¯”è¾ƒè´¹åŠ›ï¼Œæš‚æ—¶.net æ–¹é¢æˆ‘ä»¬åªèƒ½æç½®ï¼Œä½†æ˜¯ä¹Ÿä¼šç»§ç»­è·Ÿè¿›ã€‚

> Qï¼šè¯·é—®æ²¡æœ‰é‡‡ç”¨ ZooKeeper å’Œ etcd è€Œé€‰æ‹©è‡ªç ”çš„åŽŸå› æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦å¦‚ä½•è¿›è¡ŒæŠ€æœ¯å¯¹æ¯”çš„ï¼Ÿ

Aï¼šå°±æ˜¯æˆ‘åˆšæ‰è¯´çš„ï¼Œå¯¹äºŽ ZooKeeper æ¥è¯´ï¼ŒZooKeeper åŸºäºŽ Java ç¼–å†™ï¼Œåœ¨ GC å±‚é¢å­˜åœ¨ä¸€å®šçš„é—®é¢˜ï¼Œæ•°æ®é‡è¿‡å¤§æ—¶å€™ä¼šå¯¼è‡´æœåŠ¡å¯ç”¨æ€§é™ä½Žï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨ä»–åšé…ç½®ç®¡ç†ï¼Œæˆ‘ä»¬ç”šè‡³æœ‰ä¸€äº›ä¸Š M çš„é…ç½®æ–‡ä»¶ï¼Œæœ€ç»ˆçš„é…ç½®æ— è®ºæ˜¯é…ç½®é¡¹ï¼Œè¿˜æ˜¯æœ€ç»ˆå¤§å°ï¼Œéƒ½ä¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é‡çº§ã€‚äºŒæ˜¯æˆ‘ä»¬é˜…è¯»äº†å®ƒçš„æºç ï¼Œå®ƒçš„ Recovery åœ¨æ£€æµ‹ä¸ä¸€è‡´æ—¶å¤„ç†ä¹Ÿæ¯”è¾ƒæš´åŠ›ï¼ŒåŒæ—¶ ZAB åè®®è¾ƒå¤æ‚ï¼Œè¿™ä¸ªä»Žå®ƒçš„è®ºæ–‡ä¸Šå°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œå› æ­¤è¿ç»´èµ·æ¥æˆæœ¬è¾ƒé«˜ã€‚

---

### 2017-01-15ï¼šKubernetes æœ‰çŠ¶æ€é›†ç¾¤æœåŠ¡éƒ¨ç½²ä¸Žç®¡ç†

> Qï¼š å‰é¢æåˆ° Init Containerï¼ŒKubernetes é‡Œ Pod åˆå§‹åŒ–æ˜¯åŸºäºŽ GCR çš„ pauseï¼Œè¿™ä¸ªåˆå§‹åŒ–é•œåƒæ˜¯è‡ªå®šä¹‰çš„å—ï¼Ÿ

Aï¼šInit Container å’Œ GCR çš„ Pause æ˜¯ä¸åŒçš„æ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯åˆå§‹åŒ–å®¹å™¨ï¼ˆè¿è¡Œå®Œå°±ç»“æŸï¼‰ï¼Œä¸€ä¸ªæ˜¯åŸºç¡€å®¹å™¨ï¼ˆä¸€ç›´è¿è¡Œï¼‰ã€‚

> Qï¼šä½ ä»‹ç»çš„ Kubernetes å­˜å‚¨æŠ€æœ¯éƒ½æ˜¯æ¯”è¾ƒæ–°çš„ï¼Œèƒ½å¦é€‚åº”ä¼ä¸šç”Ÿäº§å¤§è§„æ¨¡ä½¿ç”¨ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ€§èƒ½å’Œç¨³å®šæ€§é—®é¢˜ï¼Ÿ

Aï¼š æ€§èƒ½å’Œç¨³å®šæ€§ä¸Šæˆ‘ä»¬ä¹Ÿåœ¨ä¸æ–­å°è¯•ï¼Œå…ˆä½¿ç”¨èµ·æ¥çœ‹çœ‹æ•ˆæžœï¼Œç›®å‰åˆ›å»ºè¿‡å‡ ç™¾ä¸ªé›†ç¾¤ï¼Œæš‚æ—¶æ²¡æœ‰ç¢°åˆ°å¤ªå¤šç¨³å®šæ€§é—®é¢˜ã€‚

> Qï¼šå­˜å‚¨ç³»ç»Ÿå¦‚ä½•åŠ¨æ€åˆ›å»º StorageClassï¼Œå¦‚æžœ Headless Service æ²¡æœ‰ Cluster IPï¼ŒæœåŠ¡å¦‚ä½•è°ƒç”¨ï¼Ÿ

Aï¼šKubernetes é€šè¿‡ StorageClass è®©å­˜å‚¨ç³»ç»ŸåŠ¨æ€åˆ›å»º PVï¼Œä¸æ˜¯åŠ¨æ€åˆ›å»º StorageClassã€‚Headless Service ç”¨äºŽé›†ç¾¤å†…éƒ¨é€šä¿¡ï¼Œå¤–éƒ¨è°ƒç”¨ï¼Œå†å»ºæ™®é€š Serviceï¼ŒäºŒè€…å¹¶å­˜ã€‚

> Qï¼šæœ‰çŠ¶æ€é›†ç¾¤è¿˜æœ‰å…¶ä»–çš„å®žçŽ°æ–¹å¼å—ï¼Ÿ

Aï¼š åœ¨å®¹å™¨äº‘é‡Œæ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯ç”¨ PetSetï¼Œå½“ç„¶ä¹Ÿèƒ½è‡ªå·±åšï¼Œç›¸å½“äºŽè‡ªå·±å®žçŽ° PetSet çš„ä¸€äº›åŠŸèƒ½ã€‚

> Qï¼šåŒæ­¥åˆ°æ•´ä¸ªé›†ç¾¤æ‰ç®—å†™å…¥æˆåŠŸï¼Œæ˜¯ä¸æ˜¯æ„å‘³ç€ä¸é€‚åˆé«˜è´Ÿè½½çš„é¡¹ç›®ä½¿ç”¨ï¼Ÿæœ‰å¯èƒ½å¢žåŠ å…¶å®ƒç­–ç•¥ä¾›é€‰æ‹©å—ï¼Ÿ

Aï¼šç”±äºŽé‡‡ç”¨å¤šä¸»æ–¹å¼ï¼Œå¯¹å¤–åªå†™å…¥ä¸€ä¸ªï¼Œå†…éƒ¨æ‰©æ•£åŒæ­¥å¯ä»¥å¹¶è¡Œï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½å¯¹å¤–æä¾›æœåŠ¡ï¼Œç›¸å½“äºŽå¢žåŠ äº†æœåŠ¡å¸¦å®½ï¼Œæ‰€ä»¥æ€§èƒ½ä¸æ˜¯é—®é¢˜ã€‚

> Qï¼šæ‚¨å¥½ï¼Œä½ ä»¬æ˜¯é‡‡ç”¨ä»€ä¹ˆåˆ†å¸ƒå¼å­˜å‚¨çš„ï¼Œio æ€§èƒ½å¦‚ä½•ï¼Ÿå¥½åƒä¸€äº›å¼€æºåˆ†å¸ƒå¼çš„å­˜å‚¨å†™ io çš„æ€§èƒ½æ™®éæ¯”è¾ƒä½Žï¼Œèƒ½æ’‘å¾—ä½ä¸€äº› io é«˜æ€§èƒ½çš„åº”ç”¨å—ï¼Ÿ

Aï¼š æ€§èƒ½ä¸Šè¦ç­‰åˆ°æ”¯æŒ host æ¨¡å¼åŽï¼Œæ‰èƒ½æ»¡è¶³ä¸€äº› IO è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 01 æœˆ 10 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**å¼ å¯¿çº¢ï¼Œæ—¶é€Ÿäº‘æž¶æž„å¸ˆã€‚ä»Žäº‹è½¯ä»¶ç ”å‘å·¥ä½œåä½™å¹´ï¼Œç›®å‰ä»Žäº‹åŸºäºŽ Docker å’Œ Kubernetes çš„ä¼ä¸šçº§å®¹å™¨äº‘å¹³å°ç ”å‘å·¥ä½œï¼Œä¸»è¦åŒ…æ‹¬å®¹å™¨æœåŠ¡ã€å­˜å‚¨æœåŠ¡ã€CI/CD å’Œé•œåƒæœåŠ¡ç­‰ã€‚åœ¨åŠ å…¥æ—¶é€Ÿäº‘ä¹‹å‰ï¼Œå…ˆåŽåœ¨ CATechnologies å’Œ Symantec æ‹…ä»» Tech Lead å’Œ Principal Software Engineerã€‚å‚ä¸Žç ”å‘çš„è½¯ä»¶äº§å“æœ‰ï¼šä¼ä¸šæ•°æ®ä¿æŠ¤è½¯ä»¶ã€äº‘å¹³å°ä¸Šçš„æœåŠ¡ç®¡ç†ç³»ç»Ÿã€ä¼ä¸šå®¢æˆ·æœåŠ¡å¹³å°ç­‰ã€‚

---

### 2017-01-06ï¼šåŸºäºŽå®¹å™¨çš„æ—¥å¿—ç®¡ç†å®žè·µ

> Qï¼šOverlay æ˜¯æ²¡æœ‰å®žçŽ° inotify æŽ¥å£çš„ï¼Œæ˜¯å’‹èŽ·å–æ–‡ä»¶æ—¥å¿—å¢žé‡æ•°æ®çš„ï¼Ÿ

Aï¼šé€šè¿‡å¾ªçŽ¯è¯»å–æ–‡ä»¶çš„æ–¹å¼ï¼Œè®°å½•æ–‡ä»¶ offsetã€‚

> Qï¼šæ—¢ç„¶ä¸»è¦æ¡†æž¶æ˜¯ ELKï¼Œé‡‡é›†ç«¯ä¸ç›´æŽ¥ç”¨ Filebeat æ˜¯å› ä¸º Filebeat æœ‰å±€é™æ€§å—ï¼Ÿ

Aï¼šFilebeat æ²¡æœ‰æ»¡è¶³æˆ‘ä»¬äº§å“åŸºäºŽ Docker çš„éœ€æ±‚ï¼Œç­‰äºŽä¸Šé¢åŠ äº† Docker çš„é€»è¾‘ã€‚

> Qï¼šè‡ªç ”çš„æ—¥å¿—ç³»ç»Ÿï¼Œæ‰“å‡ºæ¥çš„æ¯æ¡æ—¥å¿—æ ¼å¼éƒ½æ˜¯è§„å®šå¥½çš„å—ï¼Ÿå¼€å‘ä¸­æ¯ä¸ªäººéƒ½è¦æŒ‰è¿™ä¸ªè§„èŒƒæ¥åšå—ï¼Ÿä¸ç®¡æ˜¯ä»€ä¹ˆçº§åˆ«çš„æ—¥å¿—ï¼Ÿ

Aï¼šå…¶å®žå¹¶æ²¡æœ‰ï¼Œä½†æ˜¯å¦‚æžœæ˜¯å†…éƒ¨ä½¿ç”¨ï¼Œèƒ½è§„çº¦å¥½å½“ç„¶æ›´å¥½ï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„å¤„ç†ï¼Œè€Œä¸”å¯ä»¥åšæ›´ç»†ç²’åº¦çš„åˆ†æžã€‚

> Qï¼šæ—¥å¿—æ”¶é›†æœ‰åšåˆ†æžå±•ç¤ºå¤„ç†å—ï¼Ÿç”¨ä»€ä¹ˆå¤„ç†çš„ã€‚

Aï¼šå¯¹äºŽæ—¥å¿—å†…å®¹çš„åˆ†æžè¿˜æ²¡åšï¼Œä¾‹å¦‚ Nginx è¯·æ±‚æ—¥å¿—è¿˜æ˜¯æœ‰åˆ†æžæ„ä¹‰çš„ã€‚

> Qï¼šé‡‡é›†æ–¹é¢æœ‰è€ƒè™‘ç›´æŽ¥ä½¿ç”¨ç³»ç»Ÿçš„ Syslog å’Œ Logrotate å—ï¼Ÿ

Aï¼šç”¨è¿‡ Syslog åŽæ¥å› ä¸ºå®¹å™¨å†…çš„æ–‡ä»¶æ—¥å¿—éœ€æ±‚é‡æ–°å¼€å‘çš„ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2017 å¹´ 1 æœˆ 5 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äººéƒ­å·²é’¦ï¼Œæ•°äººäº‘ç ”å‘å·¥ç¨‹å¸ˆã€‚æ—©æœŸä»Žäº‹ Java&JavaScript å¼€å‘ï¼Œçˆ¬è™«å¤§æ•°æ®å¼€å‘ï¼Œä¹‹åŽå¼€å§‹å†™ Goï¼Œå‚ä¸Žå¼€æºå®¹å™¨ç®¡ç†å·¥å…· Crane çš„ç ”å‘ä¸Žç»´æŠ¤ï¼Œç›®å‰åœ¨æ•°äººäº‘åšäº‘å¹³å°ç ”å‘å·¥ä½œã€‚

---

### 2017-01-03ï¼šæž„å»ºå®¹å™¨æœåŠ¡å¹³å°ï¼ˆCaaSï¼‰

> Qï¼šè·¨åŒºåŸŸçš„å®¹å™¨é›†ç¾¤é—´æ˜¯å¦èƒ½é€šä¿¡ï¼Ÿ

Aï¼šç›®å‰è·¨åŒºåŸŸæœºå™¨ä¸èƒ½é€šè®¯ã€‚è·¨åŒºåŸŸä¹‹é—´æœºå™¨æ˜¯ç§Ÿæˆ·å®Œå…¨éš”ç¦»ã€‚å¦‚æžœç§Ÿæˆ·éœ€è¦é€šè®¯ï¼Œéœ€è¦é’ˆå¯¹å…·ä½“æœºå™¨è¿›è¡Œå¼€å¢™ã€‚

> Qï¼šè¯·é—®ä½¿ç”¨ DeviceMapper å…¶ä¸­é‡åˆ°äº†é‚£äº›é—®é¢˜ï¼Ÿ

Aï¼šæœ€å¸¸é‡åˆ°çš„æ˜¯ device busyã€‚ä¼šå¯¼è‡´å®¹å™¨æ— æ³•åˆ é™¤ã€‚æ­¤æ—¶éœ€è¦äººå·¥å¹²é¢„ã€‚

> Qï¼šé•œåƒç®¡ç†å¦‚æžœåªæ˜¯åŸºäºŽ distribution çš„è¯ï¼Œæƒé™ä¸Žå¤šç§Ÿæˆ·ç®¡ç†æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šæƒé™çº³å…¥å¹³å°ç®¡ç†ï¼Œç”±æˆ‘ä»¬è‡ªè¡Œå®žçŽ°ã€‚ç§Ÿæˆ·ä¹‹é—´çš„é•œåƒä¸å¯å…±äº«ã€‚ç§Ÿæˆ·å†…çš„å¯å…±äº«å’Œç§æœ‰ã€‚ ç§Ÿæˆ·é—´çš„é•œåƒå¿…é¡»é€šè¿‡å‘å¸ƒï¼Œç”±å¹³å°å®¡æ ¸æ–¹èƒ½åœ¨å„ä¸ªåŒºåŸŸå’Œå„ä¸ªç§Ÿæˆ·é—´å…±äº«ã€‚

> Qï¼šç›‘æŽ§æ˜¯ç”¨ä»€ä¹ˆè¯­è¨€å¼€å‘çš„ï¼Œæ˜¯è‡ªä¸»å¼€å‘è¿˜æ˜¯ç”¨å¼€æºçš„ï¼Ÿ

Aï¼šç›‘æŽ§ï¼Œæˆ‘è¿™è¾¹é’ˆå¯¹é•œåƒå’Œå®¹å™¨è¿™å—åšäº†ä¸€äº›ç›‘æŽ§æ•°æ®çš„æ”¶é›†ï¼Œç„¶åŽæä¾›ç»™ç›‘æŽ§å¹³å°ã€‚ç›‘æŽ§å¹³å°ç”±éƒ¨é—¨å¦å¤–ä¸€ç»„å¼€å‘ã€‚ç›®å‰åŸºäºŽ Zabbix è¿›è¡Œå¼€å‘ã€‚

> Qï¼šè¯·é—®ï¼š1. DockerHUB åªæœ‰ä¸€ä¸ªå®žä¾‹å—ï¼Ÿå¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ2. DockerServer é—´åŒæ­¥çš„æ˜¯ä»€ä¹ˆå†…å®¹å‘¢ï¼ŸDocker äº‹ä»¶ï¼Ÿ

Aï¼šæ‰€æœ‰åŒºåŸŸï¼ŒåŒ…æ‹¬ pub å’Œ mirrorï¼Œéƒ½æ˜¯ keepalive+lvs æ­å»ºã€‚ç›®å‰ä½¿ç”¨åŒ registry+ å…±äº« nasã€‚è€Œè¿™ä¸¤ä¸ª Registry æ‰€åœ¨çš„ vm æ˜¯è·¨ azã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ª Registry å®•å®Œå…¨ä¸å½±å“å¦å¤–ä¸€ä¸ªæä¾›ã€‚è€Œ nas æ˜¯åŒå†™ nasï¼Œæˆ‘ä»¬è¿™è¾¹çš„å­˜å‚¨ç»„æä¾›çš„ DNAS æœåŠ¡ã€‚å¤‡ä»½ç­–ç•¥ä¹Ÿæ˜¯å¯ä»¥æ ¹æ®è‡ªå·±å®šä¹‰ã€‚

> Qï¼špub hub èŽ·å– docker hub é•œåƒçš„æ–¹å¼ï¼Œç›®å‰æ˜¯è‡ªåŠ¨ç»´æŠ¤å—ï¼Ÿ

Aï¼šä¸æ˜¯ï¼Œä»Ž docker hub è¿›å…¥å…¬å¸å®˜æ–¹é•œåƒä»“åº“ï¼Œéƒ½æ˜¯äººå·¥ç»´æŠ¤åŒæ­¥ã€‚æˆ‘ä»¬éœ€è¦é’ˆå¯¹ä¸€äº›é•œåƒåšç‰¹æ®Šå¤„ç†ã€‚

> Qï¼šIPsec çš„æ€§èƒ½ä¼ è¯´ä¸æ˜¯å¾ˆå¥½ï¼Œä½ ä»¬æœ‰é‡åˆ°è¿‡ç½‘ç»œçš„é—®é¢˜å—ï¼ŸRancher çš„ IPsec ç½‘ç»œæ€§èƒ½æ€Žä¹ˆæ ·ï¼Ÿå®¹å™¨æœ‰æ¶‰åŠåˆ°å¼¹æ€§ä¼¸ç¼©å—ï¼Ÿå®¹å™¨é—´é‡‡ç”¨ Rancher å®žçŽ°ç½‘ç»œé€šä¿¡ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰é€‰æ‹©ç±»ä¼¼ç»„ä»¶ï¼Ÿ

Aï¼šè¿™ 3 ä¸ªé—®é¢˜ç»Ÿä¸€å›žç­”ã€‚ç›®å‰æ˜¯ä½¿ç”¨ IPsecã€‚ç”±äºŽå½“å‰æ¯ä¸ª Rancher å¯¹æŽ¥çš„å®¹å™¨æ•°ç›®ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œè¿˜æ²¡äº§ç”Ÿç½‘ç»œé—®é¢˜ã€‚å¦å¤–å¯¹å¤–ç½‘ç»œèµ°çš„æ˜¯äº‘ä¸»æœºç½‘ç»œã€‚ æœ‰è€ƒè™‘è¿‡å…¶ä»–ç»„ä»¶ï¼Œç”±äºŽä¹‹å‰èµ·æ­¥é˜¶æ®µï¼Œæ‰€æœ‰ç›´æŽ¥é‡‡å– rancher æä¾›çš„ã€‚æœ€è¿‘ Rancher æä¾›æ”¯æŒ CNI çš„æ–¹æ¡ˆã€‚ç›®å‰æ­£åœ¨ç ”ç©¶å¯¹åº”çš„ç»„ä»¶ã€‚

> Qï¼šæˆ‘èƒ½æƒ³åˆ°çš„ä¸€ä¸ªæ–¹æ¡ˆæ˜¯è‡ªå·±çš„ç”¨æˆ·ä½“ç³»åŠ äº‘å¹³å°çš„ç§Ÿæˆ·å’Œäº‘å¹³å°çš„ç”¨æˆ·ä½“ç³»ï¼Œå¤šå¯¹ 1 çš„æ˜ å°„ï¼Œå½“å®¡æ ¸é€šè¿‡åŽï¼Œä½¿ç”¨ä¸åŒçš„äº‘å¹³å°ç”¨æˆ·ï¼Œè¿™æ ·æƒé™å°±ä¸ä¸€æ ·äº†ã€‚æ˜¯è¿™æ ·å—ï¼Ÿ

Aï¼šç›®å‰å®¹å™¨æœåŠ¡åªé’ˆå¯¹å…¬å¸å†…éƒ¨å¼€æ”¾ï¼Œç›´æŽ¥å…¼å®¹äº‘å¹³å°ç§Ÿæˆ·ã€‚

> Qï¼šè¯·é—®å†…æ ¸ç‰ˆæœ¬æ˜¯ï¼Ÿç”¨ 4.9 çš„è®¡åˆ’å—ï¼Ÿå¹³å®‰äº‘æ˜¯ OpenStack å—ï¼Ÿç”¨ Magnum å—ï¼Ÿ

Aï¼šä½¿ç”¨ CentOS 7.2ï¼Œå†…æ ¸ç‰ˆæœ¬æ˜¯ 3.10.xxx,å¹³å®‰äº‘ä½¿ç”¨ Cloud Foundryï¼Œå¹³å®‰äº‘ä½¿ç”¨äº†å¤šç§è™šæ‹Ÿæœºï¼ŒVMware å’Œ KVM æ˜¯ä¸»è¦ã€‚

> Qï¼šå®¹å™¨æ˜¯è·‘åœ¨ç‰©ç†æœºä¸Šè¿˜æ˜¯è™šæ‹Ÿæœºä¸Šï¼Œå®¹å™¨æ‰€åœ¨çš„æ“ä½œç³»ç»Ÿå½’ç§Ÿæˆ·æ‰€æœ‰è¿˜æ˜¯è¿è¥å•†æ‰€æœ‰ï¼Ÿå®¹å™¨çš„åˆ†é…è§„åˆ™ç”±è°å†³å®šï¼Ÿä¸€ä¸ªå®¿ä¸»æœºè·‘å¤šå°‘ä¸ªå®¹å™¨ç”±è°å†³å®šï¼Ÿ

Aï¼šç›®å‰èµ„æºé™åˆ¶è¿˜æ˜¯äº¤ç»™ Rancher æ¥ç®¡ç†ï¼Œæˆ‘ä»¬å¯¹ Rancher çš„è§„åˆ’æ˜¯ï¼šè®© Rancher ç®¡ç†èµ„æºï¼Œåˆ†é…å®¹å™¨ã€‚åœ¨é¡µé¢æä¾› Docker ç›®å‰æ”¯æŒçš„èµ„æºå‚æ•°ã€‚ å®¹å™¨æ‰€åœ¨çš„æ“ä½œç³»ç»Ÿå½’ç§Ÿæˆ·æ‰€æœ‰ã€‚ç§Ÿæˆ·å¯ä»¥ä»»æ„æ·»åŠ è‡ªå·±çš„äº‘ä¸»æœºåˆ°å®¹å™¨åŽçŽ¯å¢ƒä¸­ã€‚

> Qï¼šç›®å‰è¿™ä¸ªç³»ç»Ÿæ˜¯å†…éƒ¨ç”¨çš„å§ï¼Ÿå®‰å…¨æ€§æœ‰æ²¡æœ‰è€ƒè™‘ï¼Ÿ

Aï¼šå®‰å…¨ï¼šç›®å‰é’ˆå¯¹å…¬å¸å†…éƒ¨ï¼Œä½¿ç”¨å…¬å¸ AD è®¤è¯ç™»å½•ã€‚è€Œè®¡ç®—èµ„æºé™åˆ¶é‡‡ç”¨ç§Ÿæˆ·éš”ç¦»ã€‚é•œåƒè¿™å—å®‰å…¨é‡‡ç”¨ä¸»æœºäº’ä¿¡ã€‚

> Qï¼šå¾ˆå¤šä¸šåŠ¡æ—¥å¿—æ˜¯ä¸ç›´æŽ¥è¾“å‡ºåˆ° stdout çš„ï¼Œè¿™äº›ä¸šåŠ¡æ—¥å¿—å¦‚ä½•æœé›†ï¼Ÿå®¹å™¨æ—¥å¿—çš„é‡‡é›†é‡‡ç”¨ä»€ä¹ˆæ–¹å¼ï¼Ÿå®¹å™¨è§„æ¨¡å¤§çº¦æœ‰å¤šå¤§å‘¢ï¼Ÿå½“é‡‡é›†æ–¹å‡ºçŽ°é‡‡é›†ä¸­æ–­çš„æ—¶å€™ä¼šæœ‰æŠ¥è­¦æç¤ºå—ï¼Ÿæ‰“å…¥åˆ° es åŽï¼Œåšäº†å“ªäº›æ¯”è¾ƒæœ‰æ•ˆçš„æŠ¥è¡¨æ•°æ®å‘¢ï¼Ÿ

---

### 2016-12-18ï¼šæµ·èˆªç”Ÿæ€ç§‘æŠ€èˆ†æƒ…å¤§æ•°æ®å¹³å°å®¹å™¨åŒ–æ”¹é€ 

> Qï¼šSpark ç›´æŽ¥è¿è¡Œåœ¨ Mesos ä¸æ˜¯å¾ˆæ–¹ä¾¿ä¹ˆï¼Œå®¹å™¨åŒ–ä¼˜åŠ¿æ˜¯å¦æ˜Žæ˜¾ï¼Ÿä¸»è¦è€ƒè™‘ç‚¹åœ¨å“ªï¼Ÿ

Aï¼šå®¹å™¨åŒ–ä¸»è¦è€ƒè™‘ä¸¤ç‚¹:ä¸€ è§£å†³æµ·é‡æ•°æ®è®¡ç®—çš„èµ„æºç¼–æŽ’é—®é¢˜ ï¼Œæœªæ¥ä¹Ÿä¼šåŸºäºŽ CaaS äº‘æä¾›æœåŠ¡ , äºŒ ç ”å‘ä½“ç³»çš„æ•æ·åŒ–ä¸Žæ ‡å‡†åŒ–é—®é¢˜ã€‚æˆ‘ä»¬æ­£åœ¨è€ƒè™‘æ ¹æ®è®¡ç®—éœ€è¦å®žçŽ°å¼¹æ€§ä¼¸ç¼©ï¼Œå®¹å™¨åŒ–æ˜¯ä¸€ä¸ªåŠ©åŠ›ã€‚

> Qï¼šè¯·é—®ä¸ºä»€ä¹ˆ Elasticsearchï¼Œè€Œæ²¡æœ‰é€‰æ‹© Solr å‘¢ï¼Ÿ

Aï¼šåœ¨æœ‰ç´¢å¼•ä¸‹ï¼ŒES æ€§èƒ½ä¼šè¦å¥½ä¸€äº›ï¼Œè€Œä¸”å®ƒåŽŸç”Ÿåˆ†å¸ƒå¼æ”¯æŒï¼Œå®‰è£…é…ç½®ä¹Ÿç®€å•ã€‚

> Qï¼šä»£ç æ²¡æœ‰æ‰“åŒ…è¿›é•œåƒä¸­æ˜¯å‡ºäºŽä»€ä¹ˆåŽŸå› ï¼Ÿ

Aï¼šè¿™æ ·éƒ¨ç½²è¿è¡Œä¼šæ›´çµæ´»ï¼Œæˆ‘å¯ä»¥ä»£ç æ”¾åˆ°æœ¬åœ°ï¼Œä¹Ÿå¯ä»¥ä¸Šä¼ åˆ°å®žä¾‹ä¸­ã€‚ä»£ç æäº¤æ¯”è¾ƒé¢‘ç¹ï¼Œæ‰§è¡ŒçŽ¯å¢ƒå˜åŒ–å´ä¸å¤§ï¼Œåªæ›¿æ¢å˜æ¢çš„éƒ¨åˆ†éƒ¨ç½²ä¼šæ›´å¿«é€Ÿã€‚ä¸»è¦æ˜¯ä¸ºäº†é€‚åº”ç›®å‰è¿™ç§éƒ¨ç½²æ–¹å¼ã€‚

> Qï¼šçˆ¬è™«å®¹å™¨å¦‚ä½•è°ƒåº¦ï¼Œæ˜¯åˆ†å¸ƒå¼å—ï¼Ÿ

Aï¼šæ˜¯åˆ†å¸ƒå¼çš„ï¼Œè¿™ä¸ªæ˜¯æŒ‰æ—¶é—´å®šæ—¶è¿è¡Œçš„ï¼ŒRancher æä¾›çš„ crontabï¼Œçˆ¬è™«ç¨‹åºæä¾›æ‰§è¡Œå…¥å£ã€‚

> Qï¼šHBase ä¸»é”®è®¾è®¡ä¾ç„¶æ²¡æœ‰è§£å†³çƒ­ç‚¹é—®é¢˜ï¼Ÿ

Aï¼šç¡®å®žæœªå®Œå…¨è§£å†³ï¼ŒåŸºäºŽæ—¶é—´åºåˆ—çš„æš‚æ—¶æœªæ‰¾åˆ°æ›´å¥½çš„ rowkey è®¾è®¡æ–¹æ³•ï¼›æŠŠä»–åˆ†æˆ 24 å°æ®µï¼ŒåŠ å…¥æ—¶é—´ï¼Œå•ç‹¬å¯¹æ¯æ®µæ¥è¯´ï¼Œå®ƒæ˜¯æŒ‰æ—¶é—´æŽ’åºçš„ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§æŠ˜ä¸­ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 12 æœˆ 13 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**é«˜é¢œï¼Œå°±èŒäºŽæµ·èˆªç”Ÿæ€ç§‘æŠ€æŠ€æœ¯ç ”ç©¶é™¢ï¼Œä»»èŒå¤§æ•°æ®å¼€å‘å·¥ç¨‹å¸ˆï¼Œä»Žäº‹å¤§æ•°æ®å¹³å°åº”ç”¨å¼€å‘å¹´ï¼Œè´Ÿè´£å¤§æ•°æ®å¹³å°æŠ€æœ¯é€‰åž‹ï¼Œæž¶æž„è®¾è®¡åŠä»£ç å¼€å‘å·¥ä½œ**ã€‚

---

### 2016-11-23ï¼šçˆ±æ²¹ç§‘æŠ€åŸºäºŽ SpringCloud çš„å¾®æœåŠ¡å®žè·µ

> Qï¼šä½ ä»¬æ˜¯éƒ¨ç½²åœ¨å…¬æœ‰äº‘ï¼Œè¿˜æ˜¯æ‰˜ç®¡æœºæˆ¿ï¼Ÿ

Aï¼šæˆ‘ä»¬éƒ¨ç½²åœ¨é˜¿é‡Œäº‘ä¸Šï¼Œä½¿ç”¨äº†å¾ˆå¤šé˜¿é‡Œäº‘æœåŠ¡ä½œä¸ºåŸºç¡€è®¾æ–½ï¼Œè¿™ä¸€ç‚¹æ˜¯ä¸ºäº†èŠ‚çº¦è¿ç»´æˆæœ¬ã€‚

> Qï¼šæ€Žä¹ˆè§£å†³æœåŠ¡è¿‡å¤šä¾èµ–é—®é¢˜ï¼Ÿå¼€å‘ä¹Ÿä¼šæœ‰éº»çƒ¦ï¼Œå› ä¸ºè¦å¼€å‘ä¸€ä¸ªåŠŸèƒ½ï¼Œä¸ºäº†æŠŠæœåŠ¡è·‘èµ·æ¥ï¼Œå¯èƒ½è¦è·‘å¾ˆå¤šæœåŠ¡ã€‚

Aï¼šåœ¨æˆ‘ä»¬çš„å®žé™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¹Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚ä¸»è¦çš„æ˜¯é€šè¿‡éƒ¨ç½²å‡ ä¸ªä¸åŒçš„ä»¿çœŸçŽ¯å¢ƒï¼Œä¸€ç»„å¼€å‘è€…å¯ä»¥å…±ç”¨è¿™ç»„çŽ¯å¢ƒã€‚æœ¬åœ°å¼€å‘ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦æŠŠ Consul æŒ‡å‘åˆ°è¿™ä¸ªé›†ç¾¤çš„ Consul ä¸Šå³å¯ã€‚

> Qï¼šä½ ä»¬å¾®æœåŠ¡ä¸šåŠ¡è°ƒç”¨æœ€æ·±æœ‰å‡ å±‚ï¼Ÿrestful æŽ¥å£è°ƒç”¨é“¾çš„æ•ˆçŽ‡å¦‚ä½•ï¼Ÿæ¯”å•ä½“ç»“æž„æ…¢å¤šå°‘ï¼Ÿ

Aï¼šä¸€èˆ¬ä¸è¶…è¿‡ 3 å±‚ï¼Œè¿™æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ç»™æˆ‘ä»¬å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œå•ä¸ªæœåŠ¡å‡ ä¹Žè‡ªå·±å°±èƒ½å®ŒæˆèŒè´£èŒƒå›´å†…çš„ä»»åŠ¡ï¼Œæ²¡æœ‰å‡ºçŽ° RPC ç¾éš¾ï¼Œä¸€ä¸ªä¸šåŠ¡æˆ‘ä»¬ä¹Ÿä¸å€¾å‘äºŽæ‹†åˆ†æˆè‹¥å¹²ä¸ªè¿œç¨‹æ“ä½œè¿›è¡Œã€‚

> Qï¼šä½ å¥½ï¼Œæˆ‘ä»¬å•ä½ä»Ž 6 æœˆä»½å¼€å§‹å®žæ–½å¾®æœåŠ¡åŒ–ï¼ˆO2O ä¸šåŠ¡ï¼‰ï¼Œä½¿ç”¨çš„æ˜¯ Dubboï¼Œä½¿ç”¨äº‹åŠ¡åž‹æ¶ˆæ¯æ¥åšæœ€ç»ˆä¸€è‡´æ€§ï¼Œè¯·é—® CQRS+Event Sourcing ç›¸å¯¹äºŽäº‹åŠ¡åž‹æ¶ˆæ¯é˜Ÿåˆ—æ¥å¤„ç†ä¸€è‡´æ€§é—®é¢˜ æœ‰ä»€ä¹ˆä¼˜åŠ¿ä¹ˆï¼Ÿ

Aï¼šå…¶å®ž CQRS+Event Sourcing æ˜¯ä¸€ç§è§‚å¿µçš„è½¬å˜ï¼Œè½åœ°è¿˜æ˜¯éœ€è¦é å­˜å‚¨å’Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¼˜åŠ¿åœ¨äºŽå¯ä»¥æ¶ˆé™¤ç³»ç»Ÿä¸­çš„é”ç‚¹ï¼Œæ€§èƒ½ä¼šæ›´å¥½ã€‚

> Qï¼šå…³äºŽé¢†åŸŸäº‹ä»¶ï¼Œå¦‚æžœæœ¬åœ°äº‹åŠ¡æäº¤åŽï¼Œä¸‹æ¸¸çš„æœåŠ¡æŠ¥é”™ï¼Œæ˜¯å¦åªèƒ½åœ¨ä¸šåŠ¡å±‚é¢å†å‘èµ·ä¸€ä¸ªè¡¥å¿çš„äº‹ä»¶ï¼Œè®©æœ¬åœ°äº‹åŠ¡è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§å‘¢ï¼Ÿ

Aï¼šå¦‚æžœä¸‹æ¸¸æœåŠ¡æŠ¥é”™ï¼Œé‚£ä¹ˆäº‹ä»¶ä¸ä¼šè¢«æ¶ˆè´¹ã€‚ä¼šä»¥é€€é¿é‡è¯•çš„æ–¹å¼é‡å‘äº‹ä»¶ã€‚

> Qï¼šåˆ†äº«å¾ˆæ£’ï¼Œè¯·é—®ä½ ä»¬çš„ Docker çš„éƒ¨ç½²æ˜¯åŸºäºŽåŽŸç”Ÿçš„ Docker å’Œ Swarmï¼Œè¿˜æ˜¯ Kubernetes æ¥åšçš„ï¼Ÿ

Aï¼šè°¢è°¢ï¼Œæˆ‘ä»¬ä½¿ç”¨ Rancher æ¥ç®¡ç†é›†ç¾¤ã€‚æ²¡é€‰ Kubernetes çš„åŽŸå› æ˜¯å› ä¸ºå›¢é˜Ÿèµ„æºæœ‰é™ï¼ŒSwarm æœ€åˆè¯•è¿‡ï¼Œè°ƒåº¦ä¸å¤Ÿå®Œå–„ã€‚åŽæ¥ Docker 1.12 ä»¥åŽçš„ Swarmkit åº”è¯¥æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚

> Qï¼šå¾®æœåŠ¡å¼€å‘æµ‹è¯•ç”¨ä¾‹ç›¸æ¯”äºŽå•ä½“åº”ç”¨æ˜¯ä¸æ˜¯æ›´å¤æ‚ä¸€äº›ï¼Ÿä½ ä»¬æ˜¯æ€Žæ ·ä¿è¯æµ‹è¯•è¦†ç›–çŽ‡çš„ï¼Ÿ

Aï¼šäº‹å®žä¸Šå¯¹äºŽå•å…ƒæµ‹è¯•æ¥è®²ï¼Œåè€Œæ›´å®¹æ˜“è¿›è¡Œäº†ã€‚å› ä¸ºç³»ç»Ÿæ‹†åˆ†ä¹‹åŽï¼ŒæŠŠåŽŸæ¥å¾ˆéš¾æµ‹è¯•çš„ä¸€äº›èŠ‚ç‚¹ç»™ç–é€šäº†ã€‚

> Qï¼šä½ å¥½è¯·æ•™ä¸€ä¸‹ï¼Œå½“å¾®æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»æ¯”è¾ƒå¤šï¼Œä¸”å±‚æ¬¡æ¯”è¾ƒæ·±æ—¶ï¼ŒæœåŠ¡çš„å¯åŠ¨ï¼Œåœæ­¢ï¼Œä»¥åŠå‡çº§ä¹‹é—´çš„å…³ç³»å¦‚ä½•å¤„ç†ï¼Ÿ

Aï¼šç›®å‰è¿˜å‡ ä¹Žæ²¡å‡ºçŽ°è¿‡éœ€è¦å½»åº•å†·å¯åŠ¨çš„æƒ…å†µã€‚è€Œä¸”å¯åŠ¨æœåŠ¡æ—¶å¹¶ä¸éœ€è¦ä¾èµ–æœåŠ¡ä¹Ÿå¯åŠ¨ï¼Œåªéœ€è¦å‘ç”Ÿä¸šåŠ¡æ—¶ï¼Œä¾èµ–æœåŠ¡å¯åŠ¨å³å¯ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 11 æœˆ 15 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**åˆ˜æ€è´¤ï¼ˆå¾®åš [\@starlight36](http://weibo.com/starlight36)ï¼‰ï¼Œçˆ±æ²¹ç§‘æŠ€æž¶æž„å¸ˆã€PMPã€‚ä¸»è¦è´Ÿè´£ä¸šåŠ¡å¹³å°æž¶æž„è®¾è®¡ï¼ŒDevOps å®žæ–½å’Œç ”å‘è¿‡ç¨‹æŒç»­æ”¹è¿›ç­‰ï¼Œå…³æ³¨é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸Žå¾®æœåŠ¡ã€å»ºè®¾é«˜æ•ˆå›¢é˜Ÿå’Œå·¥ç¨‹å¸ˆæ–‡åŒ–åŸ¹å…»**ã€‚

---

### 2016-11-16ï¼šæ ‘èŽ“æ´¾ä¸Šçš„ Docker é›†ç¾¤ç®¡ç†

> Qï¼šå…ˆé—®ä¸€ä¸ªé—®é¢˜ï¼Œæ‚¨å®¶é‡Œçš„æ ‘èŽ“é›†ç¾¤ç”¨æ¥åšä»€ä¹ˆï¼Ÿæœ‰å“ªäº›åœºæ™¯ä¼šç”¨åˆ°æ ‘èŽ“ Dockerï¼Ÿ

Aï¼šè¿™ä¸ªéœ€æ±‚ç‚¹æ¥è‡ª MBH æ ‘èŽ“æ´¾ç¤¾åŒºçš„æœ‹å‹ï¼Œä»–ä»¬æå‡ºå¸Œæœ›èƒ½å¤Ÿç®€åŒ–å¤šä¸ªæ ‘èŽ“æ´¾ä¸Šéƒ¨ç½²ç¨‹åºï¼ŒåŒæ—¶æˆ‘å¯¹æœªæ¥ Docker åœ¨ arm æœåŠ¡å™¨ä¸Šçš„è¿è¡ŒæŠ±æœ‰å¾ˆå¤§æœŸæœ›ï¼Œæˆ‘åªæ˜¯å¯¹è¿™å—è¿›è¡Œäº†ä¸€äº›æŽ¢ç´¢ã€‚ç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°çœŸå®žçš„éœ€æ±‚ç‚¹ï¼Œè¿˜éœ€è¦æ›´æ·±å…¥çš„è½åœ°ã€‚

> Qï¼šæ‚¨å¯¹ CoreOS å’Œ RancherOS çš„åŒºåˆ«æˆ–ä¼˜åŠ£åŠ¿ä¸Šï¼Œæ‚¨æ˜¯æ€Žä¹ˆçœ‹çš„ï¼Ÿå¤šè°¢ï¼

Aï¼šå®žé™…ä¸Šä½¿ç”¨äº† CoreOS å’Œ RancherOS åŽï¼Œä¼šå‘çŽ°è¿™ä¸¤ä¸ªåœ¨æ€è·¯å’Œç†å¿µä¸Šç¡®å®žå¾ˆåƒã€‚RancherOS æ¯” CoreOS çš„å®¹å™¨åŒ–åšçš„æ›´åŠ æ·±å…¥ï¼ŒCoreOS çš„ç¨³å®šæ€§ä¼šæ›´å¥½ã€‚RancherOS è®¾è®¡é¢å‘ Rancherï¼ŒCoreOS æ›´å¤šä¼šè€ƒè™‘ Kubernetesã€‚CoreOS åº”è¯¥ä¼šæŒç»­æ·±è€•æœåŠ¡å™¨ç«¯ï¼Œè€Œ RancherOS ä¹Ÿè®¸ä¼šåœ¨ IOT ç«¯å‘åŠ›ä¸€ä¸‹ã€‚

> Qï¼šæ ‘èŽ“æ´¾çš„å†…å­˜ä¸å¤§ï¼Œå•ä¸ªä¸»æœºä¸Šå®¹å™¨æ•°ä¼šæœ‰å¾ˆå¤§é™åˆ¶å§ï¼Ÿ

Aï¼šæ ‘èŽ“æ´¾ä¸Šè·‘æ˜¯ä¸ºäº†åªæ˜¯ä¸ºäº†å•çº¯ç®€åŒ–ç¨‹åºéƒ¨ç½²ï¼Œå½“ç„¶ä¸ä¼šè¿½æ±‚è®¡ç®—å¯†åº¦ã€‚è®¡ç®—å¯†åº¦é‚£æ˜¯æœåŠ¡å™¨å…³æ³¨çš„äº‹ï¼Œå¦å¤–ï¼Œæ ‘èŽ“æ´¾çš„å†…å­˜ä¸å¤§åªæ˜¯æš‚æ—¶çš„ã€‚

> Qï¼šè¯·é—®åœ¨ arm æž¶æž„é‡Œ partition æ˜¯æ€Žä¹ˆåšçš„?

Aï¼šdd å†™å®Œé•œåƒåŽï¼Œé»˜è®¤åˆä¸€ä¸ªæ ¹åˆ†åŒºï¼Œå¯ä»¥å†å»ºä¸€ä¸ªåˆ†åŒºï¼ŒæŠŠ docker çš„ç›®å½•æŒ‚ä¸ŠåŽ»ï¼Œè¿™æ ·èƒ½å……åˆ†åˆ©ç”¨æ•´ä¸ª sd å¡ã€‚

> Qï¼šRancherOS ä¸Šä½¿ç”¨ Dockerï¼Œåº”ç”¨èƒ½åœ¨å®¹å™¨ä¸­é€šè¿‡ GPU æ‰§è¡Œæµ®ç‚¹è¿ç®—å—ï¼Ÿéœ€è¦è£…é©±åŠ¨å—ï¼Ÿåœ¨å“ªè£…ï¼Ÿ

Aï¼š RancherOS æ˜¯ä¸€ä¸ªå®Œå…¨å¯ä»¥å®šåˆ¶çš„æ“ä½œç³»ç»Ÿã€‚åªè¦æœ‰å¯¹åº”çš„ moduleï¼Œéƒ½å¯ä»¥åˆå§‹åŒ–åˆ° RancherOS ä¸­ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 11 æœˆ 15 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**å¼ æ™ºåšï¼ˆniusmallnanï¼‰ï¼Œåˆå‡ºèŒ…åºåœ¨é˜¿é‡Œå·´å·´å£ç¢‘ç½‘ï¼Œå‚ä¸Žæœ¬åœ°æœç´¢ä¸šåŠ¡ç ”å‘å·¥ä½œï¼ŒåŽä¸Žæœ‹å‹è”åˆåˆ›åŠžç¾Žé£Ÿç‚¹è¯„ç¤¾åŒº"ç¾Žé£Ÿè¡Œ"ï¼Œä¹‹åŽåœ¨å„ç§å…¬å¸ä»Žäº‹äº‘è®¡ç®—ç ”å‘å·¥ä½œã€‚Rancher ä¸­å›½ç¤¾åŒºå¸ƒé“å¸ˆï¼ŒMBH æ ‘èŽ“æ´¾ç¤¾åŒºæˆå‘˜ï¼ŒOpenStack ä¸­å›½ç¤¾åŒºé•¿æœŸä½œè€…ã€‚çƒ­çˆ± codingï¼Œçƒ­çˆ±æŠ€æœ¯åˆ†äº«ï¼ŒæŠ€æœ¯å®…&ç§‘å¹»ç²‰ï¼Œæ ‘èŽ“æ´¾çƒ­è¡€é’å¹´**ã€‚

---

### 2016-11-09ï¼šå”¯å“ä¼šåŸºäºŽ Kubernetes çš„ç½‘ç»œæ–¹æ¡ˆæ¼”è¿›

> Qï¼šæƒ³é—®ä¸‹è¿™ä¸ª IP å¤–ç½‘å¯ä»¥ç›´æŽ¥è®¿é—®å—ï¼Ÿ

Aï¼šåœ¨ Flannel ç½‘ç»œä¸‹ä¸å¯ä»¥ç›´æŽ¥è®¿é—® Podï¼Œåœ¨ Contiv ç½‘ç»œä¸‹ï¼ŒPod æ‰€åˆ†é…çš„ç½‘æ®µæ˜¯åœ¨äº¤æ¢æœºç«¯æ‰“äº† tag çš„ï¼Œé»˜è®¤åŠžå…¬ç½‘ç»œæ˜¯å¯ä»¥ç›´æŽ¥è®¿é—®çš„ã€‚

> Qï¼šè´µå¸èŠ±äº†ç›¸å½“å¤§çš„ç²¾åŠ›åŽ»åšå®¹å™¨äº’é€šå¹¶æ˜¾è‘—æé«˜äº†å¤æ‚åº¦ï¼Œå¦‚æžœç›´æŽ¥ç”¨ Kubernetes çš„ host network æ–¹å¼æ˜¯å¦å¯ä»¥ç›´æŽ¥ç»•è¿‡è¿™äº›å¤æ‚ç‚¹ï¼Ÿ

Aï¼šé¦–å…ˆæ˜¯å…¬å¸ä¸šåŠ¡çš„éœ€æ±‚ã€‚å…¬å¸æœ‰ 1k+ çš„ä¸šåŠ¡åŸŸï¼Œè¿è¡Œåœ¨ä¸åŒçš„ Docker å®¹å™¨é‡Œï¼Œæ¯ä¸ªä¸šåŠ¡åŸŸçš„é…ç½®åŸºæœ¬æ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚ Tomcat æˆ– Nginx ä½¿ç”¨çš„ç«¯å£ï¼Œå¦‚æžœä½¿ç”¨ host network çš„è¯ï¼Œç«¯å£å†²çªæ˜¯é¢ä¸´çš„é¦–è¦é—®é¢˜ï¼Œæ•´ä¸ªæœåŠ¡åŒ–çš„ç®¡ç†æ–¹å¼ä¹Ÿè¦æ”¹å˜äº†ã€‚

> Qï¼šæ–‡ä¸­æåˆ°ä¸€ä¸ªåº”ç”¨çš„è¿è¡Œæ€å¯¹åº” Kubernetes çš„ä¸€ä¸ª RC å’Œ Serviceï¼ŒRS æ˜¯å¦å¥½è¿‡ RCï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ Kubernetes ç‰ˆæœ¬æ˜¯ 1.2ï¼ŒKubernetes 1.2 é‡Œé¢ RS è¿™ä¸ªä¸œè¥¿è¿˜å¤„äºŽä¸€ä¸ªéžå¸¸æ—©æœŸçš„ç‰ˆæœ¬ï¼ŒåŽé¢æ‰æœ‰çš„ï¼ŒRS ä¹Ÿæ˜¯æŽ¨èçš„ä¸‹ä¸€ä»£ RCã€‚

> Qï¼šä»€ä¹ˆæ ·çš„åº”ç”¨å¿…é¡»è¦å›ºå®š IPï¼Œæ˜¯å¦æœ‰å…¶ä»–åŠžæ³•å¯ä»¥é¿å¼€ï¼Ÿ

Aï¼šä¸šåŠ¡åŸŸä¹‹é—´ç›¸äº’è°ƒç”¨ï¼Œæœ‰äº›ä¸šåŠ¡åŸŸè¦æ±‚æä¾›è°ƒç”¨æ–¹ç™½åå•ã€‚è¿˜æœ‰äº›ä¸šåŠ¡åŸŸä¼šéœ€è¦çº¿ä¸Šçš„æ•°æ®è®¿é—®ï¼Œè¦åŠ å…¥ç›¸åº”çš„é˜²ç«å¢™æƒé™ç­‰ã€‚

> Qï¼šå›ºå®š ip çš„æƒ…å†µä¸‹ï¼šå®¹å™¨çš„ IP æ˜¯é€šè¿‡æ¡¥æŽ¥åˆ°å®¿ä¸»æœºçš„ç½‘æ¡¥è¿žæŽ¥åˆ°å®¿ä¸»æœºç½‘ç»œçš„å—ï¼Ÿ

Aï¼šå›ºå®š IP çš„æƒ…å†µä¸‹ï¼Œä»ç„¶æ˜¯åŸºäºŽ Contiv çš„ç½‘ç»œå·¥ä½œæ–¹å¼ï¼Œåªæ˜¯åœ¨ Docker è¿è¡Œæ—¶ç”± IPAllocator è´Ÿè´£åˆ†é…å¥½ IPï¼ŒDocker å¯åŠ¨æ—¶ä½¿ç”¨\--ip çš„æ–¹å¼ç»‘å®šè¯¥ IPã€‚å½“å‰ OVS çš„å·¥ä½œæ–¹å¼ä¹Ÿæ˜¯é€šè¿‡ ovsbridge è¿žæŽ¥åˆ°å®¿ä¸»æœºçš„ç‰©ç†ç½‘å¡çš„ã€‚

> Qï¼šå›ºå®š IPï¼Œåˆ†é…çš„ IP éœ€è¦å’Œå®¿ä¸»æœºåŒç½‘æ®µå—ï¼Ÿ

Aï¼š Kubernetes node ä¸»æœºç½‘æ®µå’Œ pod ç½‘æ®µæ˜¯ä¸åŒçš„ã€‚åŽŸåˆ™ä¸Šå¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒã€‚

> Qï¼šKubernetes æ”¯æŒ Docker å¯åŠ¨åŠ å‚æ•°å—ï¼Œä¾‹å¦‚ --ipï¼Ÿ

Aï¼šé»˜è®¤ä¸æ”¯æŒï¼Œæˆ‘ä»¬å¯¹ kubelet åšäº†ä¸€äº›ä¿®æ”¹: ä¾‹å¦‚é€šè¿‡å‚æ•°ä¼ å…¥ vlan id ä»¥åŠæ ¹æ® PodSpec ä¸­æ‰€åˆ†é… IP æŒ‡å®š docker run çš„ \--ipã€‚

> Qï¼šæ®æˆ‘äº†è§£ Contiv çŽ°åœ¨æ›´å¤šçš„æ˜¯å¯¹ CNM çš„æ”¯æŒï¼Œ å¯¹ Kubernetes çš„è¯ä½ ä»¬å®šåˆ¶å¼€å‘çš„å¤šå—ï¼Ÿ

Aï¼šKubernetes ç”¨çš„ CNIï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯ CNMã€‚æ›´å¤šæ˜¯é€‚åº”å½“å‰çš„ Contiv å¯¹ç›¸å…³ç»„ä»¶åšä¿®æ”¹ï¼Œä»¥åŠåŽé¢çš„å›ºå®š IPï¼ˆæŠŠ IPAM é›†æˆåˆ°äº† Kubernetes APIServerï¼‰ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 11 æœˆ 8 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**çŽ‹æˆæ˜Œï¼Œå”¯å“ä¼š PaaS å¹³å°é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸»è¦å·¥ä½œå†…å®¹åŒ…æ‹¬ï¼šå¹³å° DevOps æ–¹æ¡ˆæµç¨‹ä¼˜åŒ–ï¼ŒæŒç»­éƒ¨ç½²ï¼Œå¹³å°æ—¥å¿—æ”¶é›†ï¼ŒDocker ä»¥åŠ Kubernetes ç ”ç©¶**ã€‚

---

### 2016-11-05ï¼šé­…æ—äº‘ Docker å®žè·µ

> Qï¼šè¯·é—®ä¸‹è´Ÿè½½å‡è¡¡ LVS æ˜¯æ€Žä¹ˆå’Œå®¹å™¨ç»“åˆçš„ï¼Ÿ

Aï¼šçŽ°é˜¶æ®µæˆ‘ä»¬çš„å®¹å™¨æ˜¯å½“è™šæœºæ¥ç”¨ï¼Œæœ‰å›ºå®š IPï¼Œæ‰€ä»¥ LVS æŒ‰ç…§ä¼ ç»Ÿæ–¹å¼ä½¿ç”¨å³å¯ï¼Œåœ¨å®¹å™¨é‡Œé¢é…ä¸Š VIPï¼Œå¦‚æžœæ˜¯ FullNAT æ–¹å¼åˆ™ä¸éœ€è¦ã€‚

> Qï¼šé­…æ—äº‘çš„ç¼–æŽ’å·¥å…·ä¼˜é€‰å“ªä¸ªï¼Œæœ‰æ··åˆäº‘çš„è®¡åˆ’å—ï¼Ÿ

Aï¼šçŽ°é˜¶æ®µæˆ‘ä»¬æ˜¯åŽŸæ¥çš„å¹³å°ä¸Šåšé€‚é…ã€‚ä»Šå¤©çš„å†…å®¹æˆ‘ä»¬è®²çš„éƒ½æ˜¯å¯¹å†…çš„ç§æœ‰äº‘ï¼Œå…¬æœ‰äº‘æ­£åœ¨å¼€å‘æµ‹è¯•é˜¶æ®µã€‚

> Qï¼šä½ ä»¬çš„ç¼©å®¹ï¼Œå…·ä½“æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šCPUã€å†…å­˜æ˜¯ä¿®æ”¹ CGroup é…ç½®ï¼Œç£ç›˜åˆ™é€šè¿‡ LVM è¿›è¡Œç¼©å®¹ã€‚

> Qï¼šè¯·é—®ï¼Œæ—¥å¿—é›†ä¸­å­˜å‚¨ä¸Žæ—¥å¿—æŸ¥çœ‹æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬æœ‰åŸºäºŽ ELK å®žçŽ°çš„ç»Ÿä¸€æ—¥å¿—ç®¡ç†ä¸­å¿ƒï¼Œæ—¥å¿—éƒ½å‘å¾€æ—¥å¿—ä¸­å¿ƒå­˜å‚¨ï¼Œå¯åœ¨ç®¡ç†å¹³å°ä¸Šè¿›è¡ŒæŸ¥çœ‹ã€‚

> Qï¼š"é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨å†…éƒ¨çš„ proc æ˜¾ç¤ºçš„æ˜¯å®¿ä¸»æœºçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬é€šè¿‡èŽ·å– CGroup ä¸­çš„ç»Ÿè®¡ä¿¡æ¯æ¥è¦†ç›–æŽ‰è¿™éƒ¨åˆ† proc ä¿¡æ¯" è¿™ä¸ª Agent æ˜¯ä½ ä»¬è‡ªç ”çš„ï¼Ÿ æ–¹ä¾¿è¯´ä¸‹ç»†èŠ‚å—ï¼Ÿè°¢è°¢ï¼

Aï¼šç®€å•ç‚¹è¯´å°±æ˜¯é€šè¿‡æ‹¦æˆªç³»ç»Ÿå’Œç¨‹åºè¯»å– proc ç›®å½•ä¸‹ cpuinfoã€meminfo ç­‰èµ„æºæ–‡ä»¶ï¼Œè®©å®ƒåŽ»è¯»å–æˆ‘ä»¬é€šè¿‡ CGroup ç®—å¥½çš„æ–‡ä»¶ï¼Œä»Žè€Œå¾—åˆ°æ­£ç¡®çš„å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µã€‚

> Qï¼šå®¹å™¨å¼è™šæ‹Ÿæœºå’Œè™šæ‹Ÿæœºå¼å®¹å™¨ä¹‹é—´ï¼Œåœ¨ä¸šåŠ¡ä¸Šè½åœ°æ–¹æ¡ˆæ˜¯æ€Žä¹ˆæ ·çš„ï¼Œå€¾å‘äºŽå“ªä¸ªï¼Ÿ

Aï¼šå› ä¸ºæˆ‘ä»¬æœ‰è™šæ‹Ÿæœºçš„åŽ†å²åŒ…è¢±ï¼Œæ‰€ä»¥è½åœ°æ–¹æ¡ˆä¸Šä¼šé€‰æ‹©è™šæ‹Ÿæœºå¼å®¹å™¨ï¼Œ å¦‚æžœæ²¡æœ‰åŽ†å²åŒ…è¢±ï¼Œç›´æŽ¥å¯ä»¥ä¸Šå®¹å™¨ã€‚

> Qï¼šå®¹å™¨æœ‰åˆ†æœ‰çŠ¶æ€å’Œæ— çŠ¶æ€ä¹ˆï¼Œå®¹å™¨å¦‚æžœæ˜¯æœ‰çŠ¶æ€çš„å®¹å™¨åˆ†å¸ƒå¼å­˜å‚¨æ˜¯æ€Žä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ

Aï¼šæœ‰çŠ¶æ€çš„å®¹å™¨å­˜å‚¨æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯å°†æœ¬åœ°ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ï¼Œä¸€ç§æ˜¯åœ¨å®¹å™¨é‡Œé¢æŒ‚è½½åˆ†å¸ƒå¼å­˜å‚¨ã€‚

> Qï¼šè¯·é—®ä¸€ä¸‹å®¹é‡ç³»ç»Ÿä¸»è¦ç”¨æ¥ç›‘æŽ§å“ªäº›è®¾å¤‡ï¼Ÿæœ‰æ²¡æœ‰å®¹é‡ä¸è¶³ä¼šæå‰é¢„çŸ¥çš„åŠŸèƒ½ï¼Ÿ

Aï¼šç›‘æŽ§ä¸šåŠ¡èµ„æºæ˜¯ä½¿ç”¨æƒ…å†µã€‚ä¸šåŠ¡å®¹é‡ä¸è¶³æˆ–è€…å®¹é‡æµªè´¹éƒ½ä¼šæœ‰é¢„è­¦ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 10 æœˆ 25 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æž—é’Ÿæ´ªï¼Œ2014 å¹´åŠ å…¥é­…æ—ç ”å‘ä¸­å¿ƒï¼Œä»»è¿ç»´æž¶æž„å¸ˆï¼Œè´Ÿè´£é­…æ—äº‘å¹³å°è™šæ‹ŸåŒ–åŠé­…æ—æ—¥å¿—å¹³å°ç ”å‘ï¼Œä¸»è¦åŒ…æ‹¬ï¼šKVM è™šæ‹ŸåŒ–ï¼ŒDocker å®¹å™¨åŒ–ã€åˆ†å¸ƒå¼å­˜å‚¨ã€é›†ä¸­å¼æ—¥å¿—ç³»ç»Ÿ**ã€‚

---

### 2016-11-04ï¼šå¦‚ä½•ä½¿ç”¨ Node.js å’Œ Docker æž„å»ºé«˜è´¨é‡çš„å¾®æœåŠ¡

> Qï¼šè¯·é—® Kubernetes çš„ç½‘ç»œç”¨çš„ä»€ä¹ˆï¼Ÿ

Aï¼šè¿™ä¸ªè¦çœ‹å…·ä½“ä¸šåŠ¡åœºæ™¯ï¼Œç®€å•çš„ Flannelã€iptables å°±å¤Ÿäº†ã€‚

> Qï¼šè¯·é—®å¤–éƒ¨è®¿é—®æœåŠ¡å’Œå†…éƒ¨è®¿é—®å¾®æœåŠ¡æ–¹å¼æ˜¯ä¸€æ ·çš„å—ï¼Ÿéƒ½æ˜¯é€šè¿‡ API Gateway çš„è¯ï¼Œæ˜¯å¦æœ‰æ€§èƒ½åŽ‹åŠ›ï¼Ÿå¦å¤–ï¼Œå¯¹å¤–æš´éœ²çš„æœåŠ¡è¦åˆ†é…å¤–ç½‘åœ°å€ï¼Œçº¯å†…éƒ¨æœåŠ¡åªè¦å†…ç½‘åœ°å€ï¼Œæ€Žä¹ˆåŒºåˆ†ï¼Ÿ

Aï¼šå†…éƒ¨ç”¨æˆ–è€…å¾®æœåŠ¡ä¹‹é—´è®¿é—®å¯ä»¥é€šè¿‡ å†…ç½‘åœ°å€ è®¿é—®ï¼Œå¤–éƒ¨ç”¨ç»‘å®šä¸€ä¸ªå¤–ç½‘åœ°å€å°±å¯ä»¥äº†ï¼Œè€ƒè™‘æ€§èƒ½çš„è¯ï¼Œå¯ä»¥é€šè¿‡ Nginx ç­‰å®žçŽ° Kong çš„é«˜å¯ç”¨ã€‚

> Qï¼šæ„Ÿè°¢åˆ†äº«ï¼æˆ‘æƒ³é—®ä¸€ä¸‹å®¹å™¨ç½‘ç»œå¯¹å¾®æœåŠ¡çš„å½±å“ï¼Œéœ€è¦è‡ªå®šä¹‰ç½‘ç»œå—ï¼Ÿè¿˜æ˜¯ç”¨ Kubernetes å°±å¯ä»¥äº†ï¼Ÿæœ‰æ›´å¥½çš„æ–¹æ¡ˆå—ï¼Ÿ

Aï¼šåœ¨æˆ‘ä»¬å®žè·µè¿‡ç¨‹ä¸­ï¼Œæ˜¯æ²¡æœ‰è‡ªå®šä¹‰ç½‘ç»œçš„ï¼Œå¾®æœåŠ¡ä¹‹é—´é€šè¿‡ rest api è¿›è¡Œäº¤äº’ï¼Œå¯¹å®¢æˆ·ç«¯é€šè¿‡ Kong æä¾›ç»Ÿä¸€å…¥å£ï¼Œç„¶åŽç”¨ Kubernetes çš„è´Ÿè½½å‡è¡¡å°±å·®ä¸å¤šäº†ã€‚

> Qï¼šNode.js å’Œ Vue.js å¦‚ä½•é€‰æ‹©ï¼Ÿ

Aï¼šç«¥éž‹ï¼Œè¿™ä¸¤ä¸ªæ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿ï¼ŒNode.js æ˜¯åŽç«¯ï¼ŒVue.js æ˜¯ä¸€ä¸ªå‰ç«¯åº“ï¼Œå¦‚æžœä½ éžè¦é€‰æ‹©ï¼Œæˆ‘é€‰æ‹© reactã€‚

---

### 2016-11-01ï¼šæ‰“é€ ç™¾äº¿çº§æ•°æ®å¤„ç†é‡çš„å¼¹æ€§è°ƒåº¦å®¹å™¨å¹³å°

> Qï¼šè¯·é—®ç®¡ç†ç³»ç»Ÿæ˜¯åŸºäºŽä»€ä¹ˆå¼€å‘çš„ï¼Ÿè¿™ä¸ªç³»ç»Ÿä¼šå¼€æºå—ï¼Ÿ

Aï¼šDora çš„è°ƒåº¦æ¡†æž¶æ˜¯åŸºæœ¬ GO è¯­è¨€å¼€å‘çš„ã€‚ç›®å‰ä¸ä¼šå¼€æºï¼Œä½†æä¾›ç§æœ‰éƒ¨ç½²ã€‚

> Qï¼šåˆšå¼€å§‹çœ‹ Mesos æ¡†æž¶å®žçŽ°ï¼Œè¯·é—®è‡ªå®šä¹‰çš„ Scheduler ä¸­å¦‚ä½•è°ƒç”¨è‡ªå®šä¹‰çš„ executorï¼Ÿ

Aï¼šSchesuler è·Ÿ executor è¿™ä¸ªéƒ½æ˜¯æŒ‰ç…§ Mesos æœ€æ–°çš„ v1 ç‰ˆçš„ HTTP API åŽ»åšçš„ï¼Œè¿™ä¸ªæ²¡æœ‰ä¸å…¼å®¹çš„é—®é¢˜ï¼Œåªæ˜¯ mesos go ç‰ˆæœ¬çš„ SDK æœ‰äº›è€æ—§ï¼Œæ›´æ–°ä¹Ÿæ¯”è¾ƒç¼“æ…¢ï¼Œè¿™ä¸ªåœ°æ–¹æˆ‘ä»¬è‡ªå·±æ ¹æ®éœ€è¦åšäº†äº›æ›´æ”¹ã€‚

> Qï¼šè¯·é—®ç›®å‰ Consul é›†ç¾¤æ˜¯å¤šå¤§è§„æ¨¡å‘¢ï¼Ÿæœ‰æ²¡æœ‰è€ƒè™‘ Consul æ‰©å±•çš„æ€§èƒ½ç“¶é¢ˆå‘¢ï¼Ÿ

Aï¼šConsul æ˜¯åœ¨æ¯ä¸ª slave èŠ‚ç‚¹ä¸Šä¼šæœ‰ä¸€ä¸ª Consul çš„ Agent ï¼Œæˆ‘ä»¬ä¸€ä¸ªæœºæˆ¿æœ‰ 200 å¤šå°ä¸“é—¨ç”¨äºŽæ•°æ®å¤„ç†çš„æœºå™¨ï¼Œæ‰€ä»¥ Consul çš„é›†ç¾¤è§„æ¨¡ä¹Ÿå°±è¿™ä¹ˆå¤§ï¼Œå•æœºæˆ¿ã€‚å¯¹æˆ‘ä»¬å½“å‰æ¥è¯´ä¸å­˜åœ¨ç“¶é¢ˆï¼Œå› ä¸ºæˆ‘ä»¬å¯¹ Consul çš„ä½¿ç”¨çš„åœºæ™¯ç›¸å¯¹å•ä¸€ç®€å•ï¼šä½œä¸º Metadata çš„å¯é å­˜å‚¨ï¼ŒMetadata çš„æ›´æ–°å…¶å®žå¹¶ä¸æ˜¯å¾ˆé¢‘ç¹ï¼Œè¿™ä¸ªæˆ‘ä»¬å‚è€ƒè¿‡åˆ«äººåšè¿‡çš„ä¸€äº›æ€§èƒ½æµ‹è¯•å’Œæˆ‘ä»¬è‡ªå·±çš„ä¸€äº›æµ‹è¯•ï¼Œæ€§èƒ½æ˜¯æ»¡è¶³éœ€æ±‚çš„ã€‚å¦å¤–ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯æœåŠ¡å‘çŽ°ä¸Žå®žä¾‹çš„å¥åº·æ£€æŸ¥ï¼Œå¥åº·æ£€æŸ¥æ˜¯ç”±è¿è¡Œåœ¨æ¯ä¸ªæœºå™¨ä¸Šçš„ Consul Agent è´Ÿè´£çš„ï¼Œå‡æ‘Šåˆ°æ¯ä¸ªæœºå™¨ä¸Šï¼Œå…¶å®žå•ä¸ªæœºå™¨ä¸Šçš„å®žä¾‹æ•°ä¸ä¼šç‰¹åˆ«çš„å¤šï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„åŽ‹åŠ›ã€‚å½“ç„¶äº†ï¼Œè¿™ä¸ªä¹Ÿæ˜¯è·Ÿä¸šåŠ¡è§„æ¨¡ç›¸å…³çš„ï¼Œå‡å®šå“ªå¤© Consul çš„æ‰©å±•æ€§æˆæˆ‘ä»¬çš„é—®é¢˜äº†ï¼Œä¹Ÿè¯´æ˜Žæˆ‘ä»¬çš„ä¸šåŠ¡é‡ç‰¹åˆ«ç‰¹åˆ«çš„å¤§äº†ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯å¾ˆæœŸæœ›è¿™ä¸€å¤©åˆ°æ¥çš„ã€‚

> Qï¼šDora æ˜¯å¦å¯ä»¥æ”¯æŒ MySQL çš„è‡ªåŠ¨ä¼¸ç¼©æ‰©å®¹ï¼Ÿ

Aï¼šDora ç³»ç»Ÿçš„åº”ç”¨åœºæ™¯è¿˜æ˜¯è¿è¡Œä¸€äº›æ•°æ®å¤„ç†å‘½ä»¤è¿™ç±»æ— çŠ¶æ€çš„æœåŠ¡ã€‚MySQL è¿™ç±»ç³»ç»Ÿä¸é€‚åˆç›´æŽ¥è·‘åœ¨ Dora è¿™ä¸ªé‡Œé¢ï¼Œå¦‚æžœæœŸæœ› MySQL è·‘åœ¨ Mesos ä¸Šé¢çš„è¯ï¼Œéœ€è¦è‡ªå·±å®žçŽ°ä¸€ä¸ªä¸“é—¨é’ˆå¯¹ MySQL çš„è°ƒåº¦å™¨ï¼Œå› ä¸º MySQL å®žä¾‹çš„æ‰©ç¼©å®¹ï¼Œå®žä¾‹æ•…éšœçš„ä¿®å¤éƒ½æœ‰ MySQL è‡ªèº«ç‰¹å®šçš„éœ€æ±‚ã€‚æˆ‘ä»¬å…¬å¸ MySQL è¿™ç±»æœ‰çŠ¶æ€æœåŠ¡çš„å®¹å™¨åŒ–æ˜¯ç”±å…¬å¸å¦ä¸€ä¸ªå®¹å™¨å¹³å°å®žçŽ°çš„ã€‚MySQL çš„ç”¨çš„æ˜¯ Percona XtraDB Cluster æ–¹æ¡ˆï¼Œæˆ‘ä»¬åˆ©ç”¨å¦ä¸€ä¸ªå®¹å™¨å¹³å°çš„ API å†™äº†ä¸€ä¸ª Percona XtraDB Cluster çš„è°ƒåº¦å™¨ï¼ŒæŠŠ Percona XtraDB Cluster çš„å¤§éƒ¨åˆ†è¿ç»´æ“ä½œåœ¨å®¹å™¨å¹³å°ä¸Šè‡ªåŠ¨åŒ–äº†ã€‚

> Qï¼šä½ ä»¬çš„ Ansible host æ–‡ä»¶æ˜¯åŠ¨æ€ç”Ÿæˆçš„å˜›ï¼Ÿä»£ç æŽ¨é€ä¹Ÿæ˜¯é€šè¿‡ Ansible å˜›ï¼Ÿæ–°å¢žåˆ é™¤èŠ‚ç‚¹ï¼Œä»¥åŠå›žæ»šç­‰æ“ä½œæ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šæœ€å¼€å§‹å®žè·µçš„æ—¶å€™ä¸æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œå…¶å®žæˆ‘ä»¬æ˜¯å¯ä»¥ä»Ž Consul ä¸­èŽ·å–åˆ°å½“å‰é›†ç¾¤é‡Œé¢çš„èŠ‚ç‚¹å’ŒèŠ‚ç‚¹çš„ä¸€äº›ç®€å•çš„é…ç½®ä¿¡æ¯ï¼ŒåŽé¢æœ‰è€ƒè™‘ä»Ž Consul é‡Œé¢æ‹¿èŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŠ¨æ€ç”Ÿæˆç”¨äºŽ Ansible ç°åº¦çš„ host æ–‡ä»¶ã€‚ä»£ç æŽ¨é€ä¹Ÿæ˜¯ä½¿ç”¨çš„ Ansibleï¼Œå¦‚æžœèƒ½å’Œå¤–ç½‘è¿žæŽ¥çš„æœºå™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ GitHubã€‚å› ä¸ºæˆ‘ä»¬çš„ Playbook çš„è§’è‰²æ˜¯é€šè¿‡ç»„ä»¶åŒºåˆ†çš„ï¼Œæ–°å¢žåˆ é™¤èŠ‚ç‚¹åªéœ€è¦ä¿®æ”¹ Host æ–‡ä»¶ï¼ŒæŠŠç›¸åº”çš„èŠ‚ç‚¹åŠ å…¥å®‰è£…æˆ–åˆ é™¤ç›¸åº”çš„ç»„ä»¶ã€‚å¦‚å›žæ»šæ“ä½œï¼š ``` {.prettyprint} $Â ansible-playbookÂ rollback.ymlÂ -iÂ hostsÂ -eÂ "hosts_env=XXXÂ app_env=XXXÂ version_env=XXX"   hosts_envï¼šè¡¨ç¤ºè¦å›žæ»šçš„ä¸»æœºç»„ï¼Œå¦‚ Masterapp_envï¼šè¡¨ç¤ºè¦å›žæ»šçš„ç»„ä»¶ï¼Œå¦‚ ZooKeeperxxx_versionï¼šè¡¨ç¤ºè¦å›žæ»šç»„ä»¶çš„ç‰ˆæœ¬å·ï¼Œå¦‚ v1.0.1.20160918

> Qï¼šDora çš„è°ƒåº¦ç­–ç•¥æ˜¯æ€Žä¹ˆæ ·çš„ï¼Ÿå¯å¦ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚

Aï¼šé¦–å…ˆä¿è¯åŒä¸€ç§æ•°æ®å¤„ç†å‘½ä»¤çš„å®žä¾‹å°½é‡å‡åŒ€åˆ†æ•£åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œç„¶åŽå†æ˜¯ä¿è¯å‡è¡¡æ¯ä¸ªæœºå™¨ä¸Šçš„è´Ÿè½½ã€‚

> Qï¼šPrometheus ç›®å‰æ˜¯å•æœºçš„ï¼Œæ•°æ®é‡å¤§äº†æ€Žä¹ˆåŠžï¼ŸPrometheus çš„ç›‘æŽ§æ•°æ®æ˜¯å­˜åœ¨ InfluxDB å—ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬æ˜¯æŒ‰ä¸šåŠ¡æ‹†åˆ† serverï¼Œæ•°æ®é‡å¯ä»¥æ”¯æ’‘ã€‚æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ InfluxDBï¼Œè¿˜æ˜¯ç”¨çš„åŽŸç”Ÿçš„ LevelDBã€‚

> Qï¼šè¿™ä¹ˆå¤§æ–‡ä»¶é‡ï¼Œä½ ä»¬åœ¨å­˜å‚¨æŠ€æœ¯æ–¹é¢æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å¤„ç†å—ï¼Ÿæ€Žä¹ˆå®žçŽ°é«˜æ€§èƒ½å’Œæµ·é‡å­˜å‚¨ä¹‹é—´å‡è¡¡ï¼Ÿ

Aï¼šä¸ƒç‰›äº‘å­˜å‚¨çš„è®¾è®¡ç›®æ ‡æ˜¯é’ˆå¯¹æµ·é‡å°æ–‡ä»¶çš„å­˜å‚¨ï¼Œæ‰€ä»¥å®ƒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªæ”¹å˜ä¹Ÿæ˜¯åŽ»å…³ç³»ï¼Œä¹Ÿå°±æ˜¯åŽ»ç›®å½•ç»“æž„ï¼ˆæœ‰ç›®å½•æ„å‘³ç€æœ‰çˆ¶å­å…³ç³»ï¼‰ã€‚æ‰€ä»¥ä¸ƒç‰›äº‘å­˜å‚¨ä¸æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œæ˜¯é”®å€¼å­˜å‚¨ï¼Œæˆ–å¯¹è±¡å­˜å‚¨ã€‚æˆ‘ä»¬æ¯ä¸ªå¤§æ–‡ä»¶éƒ½æ˜¯åˆ‡å‰²æˆå°æ–‡ä»¶å­˜å‚¨ä¸‹æ¥çš„ï¼Œå…ƒä¿¡æ¯å•ç‹¬å­˜æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œç”¨æˆ·è¯·æ±‚çš„æ—¶å€™é€šè¿‡ä¸šåŠ¡å±‚åˆå¹¶å¤„ç†åŽè¿”å›žã€‚å› æ­¤ç†è®ºä¸Šç£ç›˜åªå­˜å‚¨å°æ–‡ä»¶ï¼Œå¤§æ–‡ä»¶å­˜å‚¨å’Œè¯»å–çš„æ€§èƒ½ä¸»è¦åœ¨äºŽæ–‡ä»¶åˆ‡å‰²å’Œåˆå¹¶ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 11 æœˆ 1 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äººé™ˆçˆ±çï¼Œä¸ƒç‰›äº‘å¸ƒé“å¸ˆï¼Œè´Ÿè´£ DevOps ï¼Œå®¹å™¨ï¼Œå¾®æœåŠ¡ç›¸å…³æŠ€æœ¯çš„è½åœ°ç ”ç©¶ä¸Žå¸ƒé“ã€‚å¤šå¹´ä¼ä¸šçº§ç³»ç»Ÿè¿ç»´ç®¡ç†ç»éªŒï¼Œå¯¹å¤§åž‹åˆ†å¸ƒå¼ç³»ç»Ÿæž¶æž„è®¾è®¡åŠè¿ç»´æœ‰ä¸°å¯Œçš„ç»éªŒã€‚

---

### 2016-10-25ï¼šçŒŽè±¹ç§»åŠ¨åŸºäºŽ CoreOS åœ¨ AWS ä¸Šçš„é¡¹ç›®å®žè·µ

> Qï¼šæ²¡æœ‰ç”¨åˆ° Flannelï¼Œç½‘ç»œå®žçŽ°æ˜¯ä»€ä¹ˆï¼Œæœªæ¥å¯¹ CoreOS çš„å®¹å™¨ç®¡ç†å·¥å…· rkt çš„è®¡åˆ’ï¼Ÿ

Aï¼šç½‘ç»œä¸Šæˆ‘ä»¬ç›´æŽ¥ä½¿ç”¨çš„ host çš„æ–¹å¼ï¼Œå®¹å™¨ä¸»è¦æ˜¯çœ‹ä¸­äº† CI å’Œ CD çš„ä¾¿åˆ©å¥½æ²¡æœ‰å¾€é«˜å¯†åº¦çš„åœºæ™¯è®¾è®¡çš„è®¡åˆ’ï¼Œrkt æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œæ›´æœ‰å¼€æºçš„æ„Ÿè§‰ï¼Œçœ‹åŽæœŸ Docker ç¤¾åŒºå‘å±•æƒ…å†µæ˜¯å¦è¶Šæ¥è¶Šå°é—­ã€‚

> Qï¼šregistry æ€Žä¹ˆ ha çš„ï¼Œæ˜¯åœ¨å®¹å™¨è¿˜æ˜¯ VMï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜ä¹‹å‰ä¹Ÿæ˜¯ä¸€ç›´å›°æ‰°ç€æˆ‘ä»¬ï¼Œæˆ‘ä»¬ç”¨ AWS çš„ ELB åšè´Ÿè½½å‡è¡¡ï¼ŒåŽç«¯æ”¾ 2 å° EC2ï¼Œé•œåƒå­˜åˆ° S3ï¼Œç¼“å­˜å†™åœ¨ Redis é‡Œï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨å®˜æ–¹çš„ imageï¼Œéšæ—¶ç”¨éšæ—¶ä¸Šä¼ å’Œä½¿ç”¨ï¼ŒæŒ‚äº†å°±å†å¯åŠ¨ä¸€ä¸ªï¼Œä¸ä¾èµ–é•¿æœŸæœ‰æ•ˆçš„ hubã€‚

> Qï¼šæœ€è¿‘æš´æ¼çš„å®‰å…¨é—®é¢˜éœ€è¦å†…æ ¸å‡çº§æ‰èƒ½è§£å†³ï¼Œè¿™æ­£æ˜¯ CoreOS çš„ä¼˜åŠ¿ã€ä¸å¿…é‡å¯ç³»ç»Ÿï¼ŒçŒŽè±¹æ˜¯å¦åœ¨çº¿ä¸Šæœ‰è¿™ç§ç»éªŒï¼Ÿå®žé™…ä¸­ CoreOS åœ¨å‡çº§å†…æ ¸æ—¶æ˜¯å¦çœŸé‚£ä¹ˆæ–¹ä¾¿ï¼Ÿ

Aï¼šè¿™ä¸ªæ˜¯æˆ‘ä»¬éžå¸¸å–œæ¬¢çš„ä¸€ä¸ªç‰¹æ€§ï¼Œè‡ªåŠ¨å‡çº§å†…æ ¸ï¼Œåšè¿‡è¿ç»´çš„åŒå­¦éƒ½çŸ¥é“ï¼Œåšä¸€æ¬¡å†…æ ¸å‡çº§æ˜¯å¤šä¹ˆç—›è‹¦ï¼Œæˆ‘ä»¬æœ€å¼€å§‹ç”¨çš„æ˜¯ stable766.4ï¼ŒçŽ°åœ¨éƒ½ä¸ç”¨æˆ‘ä»¬åŽ»å‡çº§å°±è‡ªåŠ¨å¸®æˆ‘ä»¬å‡çº§åˆ° 8xx çš„ stable ç‰ˆæœ¬äº†ã€‚

> Qï¼šé›†ç¾¤ä¸­ etcd èŠ‚ç‚¹æ•°ç›®æ˜¯å¤šå°‘ï¼Œå¥‡æ•°ä¸ª etcd èŠ‚ç‚¹çš„ä¼˜åŠ¿å…·ä½“æ€Žä¹ˆä½“çŽ°çš„ï¼Œä»¥åŠ etcd çš„ä»£ç†èŠ‚ç‚¹åœ¨ä¸šåŠ¡ä¸­çš„ä»·å€¼ï¼Ÿ

Aï¼šetcd å¾ˆç±»ä¼¼äºŽ ZooKeeperï¼Œleader èŠ‚ç‚¹å¿…é¡»æ˜¯å¥‡æ•°ä¸ªï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯ 3 ä¸ªï¼Œæœ€å¤š 5 ä¸ªï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šä¸»åŠ¨å’Œ leader èŠ‚ç‚¹é€šè®¯ï¼Œleader èŠ‚ç‚¹å¯ä»¥è¿è¡Œåœ¨é›†ç¾¤ä»»ä½•èŠ‚ç‚¹ä¸Šï¼Œä¹Ÿå¯ä»¥é€šè¿‡ API æŽ¥å£æ‰‹åŠ¨è°ƒæ•´ leader èŠ‚ç‚¹æ‰€åœ¨çš„åº•å±‚æœåŠ¡å™¨ï¼Œå¾ˆçµæ´»ï¼Œä»»ä½•ä¸€å°éƒ½å¯ä»¥é€‰ä¸¾æˆ leaderï¼Œä¸ç”¨éƒ¨ç½²ä»»ä½•é¢å¤–é…ç½®ï¼Œçœå¿ƒã€‚

> Qï¼šç¼–æŽ’è°ƒåº¦éƒ½æ˜¯è‡ªå·±å¼€å‘çš„ç³»ç»Ÿå—ï¼Œå¦‚ä½•ç®¡ç†é‚£ä¹ˆå¤šçš„å®¹å™¨ï¼Ÿ

Aï¼šç”¨çš„ CoreOS è‡ªå¸¦çš„æ¨¡å—ï¼Œetcd+fleet+systemdï¼Œå¾ˆåº•å±‚ï¼Œç™»é™†ä»»ä½•ä¸€å°æœºå™¨åšæ“ä½œå°±å¯ä»¥ç®¡ç†æ•´ä¸ªé›†ç¾¤ï¼Œå°±åƒç®¡ç†ä¸€å°æœºå™¨ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠæ—¥å¸¸å‘å¸ƒç­‰æ“ä½œåŸºæœ¬éƒ½ç”¨ Jenkins ä»£åŠ³äº†ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 10 æœˆ 25 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**é½æµ·æ¾Žï¼ˆKumaQiï¼‰ï¼ŒçŒŽè±¹ç§»åŠ¨é«˜çº§è¿ç»´å·¥ç¨‹å¸ˆã€‚è´Ÿè´£çŒŽè±¹ç§»åŠ¨å•†ä¸šå¹¿å‘Šäº§å“ä¸Žå¤§æ•°æ®ç›¸å…³äº§å“çš„è¿ç»´å›¢é˜Ÿç®¡ç†ï¼Œä½œä¸ºçŒŽè±¹ç§»åŠ¨è¿ç»´éƒ¨çš„ç®¡ç†å›¢é˜Ÿæˆå‘˜ï¼Œè´Ÿè´£å•†ä¸šå¹¿å‘Šä¸šåŠ¡å’Œå¤§æ•°æ®è®¡ç®—åœ¨ AWS æœåŠ¡ä¸Šçš„ç¨³å®šè¿è¡Œï¼Œå¹¶å¸®åŠ©å…¬å¸å¼€å±•å®¹å™¨æŠ€æœ¯çš„åˆæ­¥å°è¯•ã€‚3 å¹´ AWS æœåŠ¡ä½¿ç”¨ä¸Žè¿ç»´ç»éªŒï¼Œè¿ç»´å…¨çƒ 8 ä¸ª region æ•°ä»¥åƒè®¡çš„è®¡ç®—æœåŠ¡èµ„æºï¼Œæ­å»ºå¹¶è¿ç»´èµ·è·¨ 5 ä¸ªåœ°åŒºçš„åŸºäºŽ CoreOS çš„ Docker é›†ç¾¤**ã€‚

---

### 2016-10-25ï¼šæ’ç”Ÿé‡‘èžäº¤æ˜“ç³»ç»Ÿçš„ Docker åŒ–å®žè·µ

> Qï¼šè¯·é—®ä¸‹ï¼Œä½ ä»¬çŽ°åœ¨è¿™ä¸ªç³»ç»Ÿå®¹å™¨è§„æ¨¡å¤šå¤§ï¼ŸOverlayFS æœ‰é‡åˆ°ä»€ä¹ˆå‘å—ï¼Ÿ

Aï¼šçŽ°åœ¨ç³»ç»Ÿå®¹å™¨æ˜¯ 100 å¤šä¸ªã€‚ç”±äºŽé•œåƒæ•°å°‘ï¼Œå¯¹æ–‡ä»¶ inode å ç”¨å°‘ï¼Œæ‰€ä»¥ OverlayFS åŸºæœ¬æ»¡è¶³éœ€æ±‚ã€‚ä½†æ˜¯éœ€è¦ä¸»æœºå†…æ ¸é«˜ä¸€ç‚¹ï¼Œåœ¨ 3.18 ä»¥ä¸Šã€‚

> Qï¼šè¯·æ•™ä¸€ä¸‹ã€‚å’±ä»¬è¿™ä¸ªå®¹å™¨ç®¡ç†å¹³å°æ˜¯ç”¨ä»€ä¹ˆè¯­è¨€å¼€å‘çš„ï¼Ÿç›´æŽ¥è°ƒç”¨ Docker Remote API å—ï¼Œç”¨çš„æ˜¯æœ€æ–°çš„ 1.24 ä¹ˆï¼Ÿ

Aï¼šJava è¯­è¨€å¼€å‘ï¼Œç›´æŽ¥è°ƒç”¨çš„ Docker Remote APIï¼Œç‰ˆæœ¬æ˜¯ 1.24.

> Qï¼šMySQL æœåŠ¡ä¹Ÿ Docker åŒ–äº†å—ï¼Œæ€Žä¹ˆä¿è¯å­˜å‚¨å®‰å…¨ï¼Ÿ

Aï¼šMySQL è¿™å—æ˜¯æˆ‘ä»¬å®žçŽ°äº† RDSï¼Œåº•å±‚ç”¨ MySQL çš„å¤åˆ¶æ–¹æ¡ˆã€‚

> Qï¼šäº¤æ˜“ç³»ç»Ÿåº”è¯¥æ¶‰åŠå¾ˆå¤šè¿è¡Œç»„ä»¶ã€‚åœ¨å†³å®šå“ªäº›ç»„ä»¶å®¹å™¨åŒ–æ—¶æœ‰å“ªäº›è€ƒè™‘ï¼Ÿ

Aï¼šä¸€èˆ¬æ€§èƒ½è¦æ±‚å¾ˆé«˜ï¼Œå»¶è¿Ÿè¦æ±‚åœ¨å¾®ç§’çº§çš„ç»„ä»¶ï¼Œæ¯”å¦‚é«˜é¢‘äº¤æ˜“ç­‰ï¼ŒåŸºæœ¬ä¸è€ƒè™‘ Docker åŒ–ã€‚

> Qï¼šæ ¸å¿ƒæž¶æž„æ˜¯ Swarm+Docker+Confd+Registratorï¼Œå¦‚ä½•å®žçŽ°åŠ¨æ€æ‰©å±•ï¼Ÿ

Aï¼šç»„ä»¶è¿˜åŒ…æ‹¬äº† Etcdï¼Œåˆ©ç”¨ Etcd+Confd+Registrator æ¥åšæœåŠ¡æ³¨å†Œå’Œå‘çŽ°åŠé…ç½®ç®¡ç†ï¼Œåˆ©ç”¨ Docker Compose çš„ Scale åšæœåŠ¡çš„æ‰©å±•ã€‚

> Qï¼šè¯·é—®ä½ ä»¬ç”¨çš„ç¼–æŽ’ç³»ç»Ÿéƒ½æ˜¯ Docker 1.12 çš„ Swarm å—ï¼Œå¦‚ä½•å®žçŽ°å®¹å™¨éƒ½æ˜¯å¤¸ä¸»æœºå†—ä½™éƒ¨ç½²ï¼Ÿ

Aï¼š1.12 ä¹Ÿåœ¨è¯•ç”¨ï¼ŒçŽ°åœ¨ä¸»è¦æ˜¯è€æ¨¡å¼çš„ Swarmï¼Œåˆ©ç”¨å®¹å™¨çš„äº’æ–¥æ€§ï¼Œç›¸åŒé›†ç¾¤çš„ 2 ä¸ªå®¹å™¨å®žä¾‹ï¼Œä¸è¦éƒ¨ç½²åˆ°åŒä¸€å°ä¸»æœºä¸Šã€‚

> Qï¼šè¯·æ•™ä¸‹ä¸šåŠ¡ç»„ä»¶çš„é•œåƒæœ‰å¤šå¤§ï¼Ÿå¦‚ä½•å®žçŽ°è·¨å¹³å°è¿ç§»ï¼Œä¸å¦‚ä»ŽåŽä¸ºäº‘éƒ¨ç½²åˆ°é˜¿é‡Œäº‘ä¹‹ç±»ï¼Ÿ

Aï¼šé•œåƒå¤§å°åœ¨å‡ ç™¾ Mï¼Œåˆ©ç”¨é•œåƒä¸­å¿ƒçš„è¿œç¨‹å¤åˆ¶åŠŸèƒ½ï¼ŒåŒæ­¥åˆ°ç”Ÿäº§çŽ¯å¢ƒçš„é•œåƒä¸­å¿ƒï¼Œæ¯”å¦‚é˜¿é‡Œäº‘å’ŒåŽä¸ºäº‘ä¸Šã€‚

> Qï¼šé•œåƒå®‰å…¨å¦‚ä½•ä¿è¯ï¼Ÿ

Aï¼šç›®å‰åŸºç¡€é•œåƒéƒ½æ˜¯ç”±æˆ‘ä»¬è‡ªå·±åˆ¶ä½œï¼Œä¼šæ£€æŸ¥å®‰è£…çš„è½¯ä»¶å’Œç‰ˆæœ¬ã€‚åŽç»­ä¼šå¼•è¿›é•œåƒå®‰å…¨æ‰«æï¼Œæ¥å®šæœŸæ£€æŸ¥é•œåƒã€‚

> Qï¼šè¯·é—®ç½‘ç»œé‡‡ç”¨ host æ¨¡å¼ï¼Œå¦‚æžœä¸€å°ä¸»æœºè¿è¡Œå¤šä¸ªåŒä¸€ç«¯å£çš„å®¹å™¨æ€Žä¹ˆåŠžï¼Ÿæ¯”å¦‚è¿è¡Œ 2 ä¸ª Tomcat é¡¹ç›®ï¼Ÿ

Aï¼šæˆ‘ä»¬åœ¨å®¹å™¨ç®¡ç†å·¥å…·ä¸­å¢žåŠ äº†ç«¯å£çš„é…ç½®ç®¡ç†ï¼Œä¸ä¼šå‡ºçŽ°è¿™ç§æƒ…å†µã€‚å¦å¤–éƒ¨åˆ†ç½‘ç»œæ€§èƒ½è¦æ±‚ä¸é«˜çš„åº”ç”¨ï¼Œä¹Ÿä¼šé‡‡ç”¨ flannel host-gw çš„æ–¹æ¡ˆï¼Œè¿™æ ·ç«¯å£å°±å¯ä»¥ç›¸åŒäº†ã€‚åŽç»­ä¼šè°ƒç ” MacVLAN æ¨¡å¼ï¼Œç»™æ¯ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªç‰©ç† IP åœ°å€ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 10 æœˆ 18 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æŸ³æ­£é¾™ï¼Œæ’ç”Ÿç”µå­ç ”å‘ä¸­å¿ƒ Docker æŠ€æœ¯è´Ÿè´£äººã€‚8 å¹´æ¥ä¸€ç›´ä¸“æ³¨äºŽé‡‘èžè¡Œä¸šé«˜æ€§èƒ½ä¸­é—´ä»¶ã€åˆ†å¸ƒå¼æ¶ˆæ¯åˆ†å‘ç³»ç»Ÿæž¶æž„å’Œç ”å‘ã€‚å¯¹äºŽç½‘ç»œé€šä¿¡ã€æœåŠ¡å™¨æ€§èƒ½è°ƒä¼˜ã€GDB è°ƒè¯•ç­‰æœ‰ä¸°å¯Œçš„ç»éªŒã€‚2015 å¹´å¼€å§‹ç ”ç©¶ Docker æŠ€æœ¯ï¼ŒçŽ°è´Ÿè´£æŽ¨è¿› Docker æŠ€æœ¯åœ¨å…¬å¸å†…çš„è½åœ°**ã€‚

---

### 2016-10-24ï¼šPPTV èšåŠ›ä¼ åª’çš„ Docker ä¸Ž DevOps

> Qï¼šçº¿ä¸Šå’Œçº¿ä¸‹çŽ¯å¢ƒä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé€šè¿‡é…ç½®ä¸­å¿ƒï¼Œæ¯”å¦‚æ–‡ä»¶æˆ–è€…å®‰å…¨å˜é‡ï¼Œå®¹å™¨ App å¯åŠ¨è¯»å–æ–‡ä»¶æˆ–è€…å˜é‡ï¼Œå°±èƒ½è¿‡åŽ»æ­£ç¡®çš„é…ç½®ï¼Œè¿™æ ·æ–¹å¼ pptv å®žè·µä¸ºä»€ä¹ˆä¸é‡‡ç”¨è¿™ä¸ªæ–¹æ³•å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬çº¿ä¸ŠçŽ¯å¢ƒæ˜¯æœ‰é…ç½®ä¸­å¿ƒçš„ï¼Œä½†æ˜¯å› ä¸ºç®¡ç†ä¸Šçš„åŽŸå› ï¼Œé…ç½®ä¸­å¿ƒä¸»è¦æ˜¯ç®¡ç†ç³»ç»Ÿçº§åˆ«çš„é…ç½®ï¼Œå’Œä¸šåŠ¡ç›¸å…³çš„é…ç½®ä¸æ”¾åœ¨é…ç½®ä¸­å¿ƒé‡Œã€‚è€Œä¸”æˆ‘ä»¬æƒ³è¦åšåˆ°çš„æ•ˆæžœæ˜¯ä½¿ç”¨ç›¸åŒçš„é…ç½®åœ¨çº¿ä¸‹çº¿ä¸ŠçŽ¯å¢ƒè·‘ï¼Œé€šè¿‡é…ç½®ä¸­å¿ƒæ¥åšçš„è¯ï¼Œåªæ˜¯æŠŠé…ç½®é¡¹åšæˆäº†å˜é‡ï¼Œé…ç½®å®žé™…ä¸Šè¿˜æ˜¯æœ‰å·®å¼‚çš„ã€‚

> Qï¼šDB å˜æ›´æµç¨‹æ€Žä¹ˆæŽ§åˆ¶çš„ï¼ŒPPTV çš„ä¸šåŠ¡ä¸­æ˜¯å¦æ¶‰åŠåˆ°åˆ†åº“åˆ†è¡¨ï¼Œåˆé‡‡ç”¨äº†å“ªäº›æ‰‹æ®µæ¥é’ˆå¯¹æµ‹è¯•åº“ä¸Žç”Ÿäº§åº“çš„æ•°æ®å˜æ›´å¸¦æ¥å¯¹ä¸šåŠ¡çš„å½±å“ï¼Ÿ

Aï¼šDB å˜æ›´ä¸»è¦é€šè¿‡æµç¨‹åŽ»è§„èŒƒï¼Œæ¯”å¦‚åˆ†åº“åˆ†è¡¨ã€è¡¨ç»“æž„å˜æ›´ï¼Œéœ€è¦æå‰ 1 å¤©ä»¥ä¸Šç”³è¯·ï¼Œç”± DBA è¯„ä¼°å®¡æ ¸ï¼Œæ¶‰åŠæ•°æ®åº“çš„æ›´æ–°å¿…é¡»é¿å¼€ä¸šåŠ¡é«˜å³°æœŸï¼Œé€‰æ‹©å‡Œæ™¨æˆ–è€…æ—©ä¸Š 8 ç‚¹å‰ã€‚æŠ€æœ¯ä¸Šï¼Œè¦æ±‚ä¸šåŠ¡æ–¹åœ¨æ•°æ®åº“å˜æ›´åº”è¯¥æœ‰å¤‡ä»½è„šæœ¬ï¼Œå¤‡ä»½éœ€è¦æ›´æ–°çš„æ•°æ®ã€‚

> Qï¼šå¦‚ä½•è§£å†³å‘å¸ƒçš„æ—¶å€™ Nginx é¢‘ç¹ reload é—®é¢˜ï¼Ÿå¯¹å®¹å™¨çš„ Swap æœ‰é™åˆ¶ä¹ˆï¼Ÿ

Aï¼šMarathon ä¸Šæœ‰å˜æ›´çš„æ—¶å€™ä¸ä¼šç«‹å³è§¦å‘ reloadï¼Œé¦–å…ˆä¼šå°†å˜æ›´çš„ä¿¡æ¯è®°å½•åˆ° DB ä¸­ï¼Œç„¶åŽæœ‰é—´éš”çš„æ‰¹é‡åŒæ­¥è§¦å‘ reloadï¼ŒSwap ç›®å‰æ²¡æœ‰åšé…ç½®

> Qï¼š1ã€Redisã€MySQLã€DBã€ZooKeeper è¿™äº›å¦‚æžœè·‘åœ¨å®¹å™¨ï¼Œæ•°æ®åˆå§‹åŒ–æŒä¹…åŒ–çš„æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Œ2ã€linux bridge ç½‘ç»œæ–¹æ¡ˆ æœ‰æ²¡æœ‰å¯¹æ¯”è¿‡ Calico Contiv ç­‰ï¼Ÿ

Aï¼š1. æŒ‚è½½å¤–éƒ¨å· GlusterFS å®žçŽ°æŒä¹…åŒ–å­˜å‚¨ ã€‚ 2.å¯¹æ¯”è¿‡ Calicoï¼Œå¯ä»¥å‚è€ƒä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ã€Š[PPTV Docker é›†ç¾¤çš„ç½‘ç»œæ–¹æ¡ˆé€‰åž‹](http://dockone.io/article/1673)ã€‹ï¼ŒContiv æ²¡æœ‰åšè¿‡å¯¹æ¯”ã€‚

> Qï¼šæŒç»­ç»„ä»¶ ZooKeeperã€MySQL ä¹‹ç±»çš„æ˜¯æ€Žä¹ˆå’Œåº”ç”¨é›†æˆçš„ï¼Œæ˜¯ä¸€ä¸ªæ•´ä½“é•œåƒè¿˜æ˜¯å•ä¸ªé•œåƒç»„åˆçš„ï¼Ÿ

Aï¼šZooKeeperã€MySQL æ˜¯ä¸åŒé•œåƒï¼Œè¿è¡Œåœ¨ä¸åŒå®¹å™¨ä¸­ã€‚

> Qï¼šè¯·é—®æœåŠ¡è‡ªåŠ¨å‘çŽ°æ€Žä¹ˆæžçš„?æ–°æ‰‹ï¼Œä¸çŸ¥å¦‚ä½•å°† Node æ³¨å†Œè¿› HAProxy æˆ– Nginxï¼Ÿ

Aï¼šå¯¹ Marathon çš„ label å±žæ€§è¿›è¡Œçº¦å®šï¼Œé»˜è®¤ label å±žæ€§æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­åˆ¤æ–­ label æ˜¯å¦ç¬¦åˆçº¦å®šæ¡ä»¶ï¼Œå¹¶è§¦å‘æ³¨å†Œã€ä¿®æ”¹æ“ä½œã€‚

> Qï¼šæ‚¨å¥½ï¼Œè¯·é—®ä½ ä»¬çš„ DNS æ˜¯æ€Žä¹ˆåšçš„ï¼Œå•ç‚¹æ•…éšœé—®é¢˜æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ

Aï¼šDNS ä¹Ÿè¿è¡Œåœ¨ç”± Marathon è°ƒåº¦çš„å®¹å™¨ä¸­ï¼ŒMarathon å®žçŽ°æ•…éšœè‡ªæ„ˆï¼ŒDNS é‡å¯çš„åŒæ—¶å°†è§¦å‘æœåŠ¡å‘çŽ°çš„åŒæ­¥æ“ä½œã€‚

> Qï¼šç°åº¦å‘å¸ƒå›žé€€æ˜¯å›žé€€ images è¿˜æ˜¯ç›´æŽ¥å›žé€€ Docker ä¸­çš„åº”ç”¨åŒ…å‘¢ï¼Œå›žé€€å‰å¦‚æžœæ”¹è¿‡ Volume ä¸­æ•°æ®åº“è¯ï¼Œæ•°æ®åº“ä¹Ÿä¸€èµ·å›žé€€ï¼Ÿé‡åˆ°ä»€ä¹ˆé—®é¢˜ä¹ˆï¼Ÿ

Aï¼šç›®å‰çº¿ä¸ŠçŽ¯å¢ƒçš„å®¹å™¨åŒ–è¿˜åœ¨è¿›è¡Œä¸­ï¼Œå°†æ¥ä¼šæ˜¯å›žé€€ imagesã€‚çº¿ä¸Šçš„æ•°æ®åº“ä¸ä¼šè·‘åœ¨å®¹å™¨ä¸­ï¼Œå›žé€€çš„æ—¶å€™æ•°æ®åº“ä¹Ÿå›žé€€ï¼Œå’Œæ²¡æœ‰ç”¨å®¹å™¨çš„æ—¶å€™æµç¨‹ä¸€æ ·ã€‚

> Qï¼šåœ¨ç”Ÿäº§çŽ¯å¢ƒï¼Œä¸€ä¸ª App ID ä¼šå­˜åœ¨éœ€è¦å¤šä¸ªå®¹å™¨çš„æƒ…å†µï¼Œä¹Ÿå°±éœ€è¦å¤šä¸ª IPã€‚æŒ‰ä¸Šè¿°ä½¿ç”¨æ–¹å¼åº”è¯¥ä¼šæœ‰é—®é¢˜ã€‚è¿™å—æ˜¯å¦‚ä½•è§£å†³å‘¢ï¼Ÿ

Aï¼šåœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­åœ¨ Marathon ä¸Šå±‚å°è£…äº†ä¸€å¥—å‘å¸ƒç³»ç»Ÿï¼ŒåŒä¸€ä¸ªé¡¹ç›®åˆ›å»ºå¤šä¸ªå®¹å™¨ï¼Œä¼šåœ¨ Marathon ä¸Šåˆ›å»ºå¤šä¸ª App IDï¼ŒMarathon ä¸Šçš„ä¿¡æ¯å¯¹å¤–ä¸å¯è§ã€‚

> Qï¼šæˆ‘æƒ³é—®ï¼Œä½¿ç”¨ bridgeï¼Œ10.199.45.0/24ï¼Œä¼šä¸ä¼š IP è€—å°½ï¼Ÿè¿˜æœ‰æœ‰æ²¡æœ‰æµ‹è¯•è¿‡ bridge çš„æ•ˆçŽ‡ï¼Ÿ

Aï¼š10.199.45.0/24 åªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼Œå®žé™…åœºæ™¯ä¸‹ä¼šæœ‰å¤šä¸ª IP æ®µï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªå¤§çš„ç½‘æ®µã€‚åªåšäº†ç®€å•çš„æµ‹è¯•ï¼Œbridge æ•ˆçŽ‡åŸºæœ¬èƒ½è¾¾åˆ°åŽŸç”Ÿç½‘ç»œçš„ 90% ä»¥ä¸Šã€‚

> Qï¼šé€‰æ‹© CentOS è€Œä¸æ˜¯ Ubuntu æˆ–è€… CoreOS çš„åŽŸå› æ˜¯ä»€ä¹ˆï¼ŸDNS å’Œ IP åœ°å€æ± å¦‚ä½•åè°ƒï¼Ÿ

Aï¼šæŠ€æœ¯æ ˆåŽŸå› ï¼Œå…¬å¸ä¸€ç›´åœ¨ç”¨ RedHat å’Œ CentOSã€‚DNS å’Œ IP ç”± DCOS ç®¡ç†å¹³å°è¿›è¡Œç®¡ç†ã€‚

> Qï¼šMesos å’Œ Marathon ç»“åˆæ—¶ï¼Œå…³é—­å®¹å™¨åŽä¼šäº§ç”Ÿ stop çŠ¶æ€çš„å®¹å™¨è€Œä¸è‡ªåŠ¨æ¸…ç†ï¼Œåªèƒ½è„šæœ¬æ¸…ç†ï¼Œè¿™ä¸ªè¯·é—®ä½ ä»¬æœ‰ä»€ä¹ˆæ–¹æ¡ˆå¤„ç†ä¹ˆï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬ä¹Ÿæ˜¯è„šæœ¬ã€‚å°†æ¥å¯èƒ½ä¼šå’Œ Mesos çš„ hook åšåˆ°ä¸€èµ·ï¼ŒMesos å‘çŽ° task ç»“æŸæ—¶åˆ é™¤å®¹å™¨ï¼Œæˆ–è€…é€šçŸ¥ç®¡ç†å¹³å°ï¼Œç”±ç®¡ç†å¹³å°å®šæœŸæ‰¹é‡å¤„ç†ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 10 æœˆ 11 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æŽå‘¨ï¼ŒPPTV èšåŠ›ä¼ åª’ DCOS æŠ€æœ¯ä¸»è¦è´Ÿè´£äººï¼Œä¸“æ³¨äºŽ Docker ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œå®¹å™¨ç›‘æŽ§ï¼ŒDevOpsã€‚ä¹‹å‰åœ¨ä¸­å°åˆ›ä¸šå…¬å¸é•¿æœŸè´Ÿè´£å®¢æˆ·çŽ°åœºå®žæ–½å·¥ä½œï¼Œç§¯ç´¯äº†å¤§é‡å…³äºŽç½‘ç»œï¼Œç›‘æŽ§ï¼Œæƒé™è®¤è¯ï¼Œå¤§æ•°æ®ï¼ŒOracleï¼Œä¸­é—´ä»¶ç­‰ç»éªŒï¼ŒåŒæ—¶å–œæ¬¢ç ”ç©¶å„ç§æ–°å…´æŠ€æœ¯**ã€‚

---

### 2016-10-20ï¼šåŸºäºŽ Docker çš„å¼€å‘äº‘æé«˜èµ„æºåˆ©ç”¨çŽ‡çš„å®žè·µ

> Qï¼šä½ å¥½ï¼Œä½ ä»¬æœ‰åšä¸å½±å“æœåŠ¡çš„å‡çº§å’Œè‡ªåŠ¨ä¼¸ç¼©å—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œä¸Šè¾¹æåˆ°çš„"åŠ¨æ€åº”ç”¨éƒ¨ç½²"ç»„ä»¶å°±æ˜¯èƒ½å¤Ÿå®žçŽ°åº”ç”¨çš„å‡çº§æ›´æ–°ä¸å—å½±å“ï¼Œè‡ªåŠ¨ä¼¸ç¼©é€šè¿‡ Rancher çš„ç›‘æŽ§å’Œåº”ç”¨å¤šå®žä¾‹æ¥å®žçŽ°ï¼Œç›‘æŽ§åˆ°åº”ç”¨å®¹æ˜“çš„ CPUã€å†…å­˜ã€ç½‘ç»œç­‰å¦‚æžœåœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…ä¸€ç›´å¤„äºŽè¾ƒé«˜çš„åˆ©ç”¨çŽ‡ï¼Œå°±å¢žåŠ åº”ç”¨å®žä¾‹ï¼Œåä¹‹åˆ™å‡å°‘ï¼Œä¿è¯åº”ç”¨çš„è¿žç»­æ€§ã€‚

> Qï¼šè¯·é—®å¯¹ Docker å­¦ä¹ éœ€è¦çœ‹ Docker æºç å—ï¼Ÿ

è¿˜æ˜¯ç”¨ Docker ç­‰å·¥å…·æ¥è§£å†³é—®é¢˜å°±å¯ä»¥äº†ï¼Ÿ

Aï¼šè¿™ä¸ªå¾—æ ¹æ®å®žé™…éœ€è¦æ¥äº†ï¼Œå¦‚æžœæ˜¯è¯´éœ€è¦ä»Ž Docker å®¹å™¨å±‚é¢ä¸Šæ¥å®šåˆ¶å¼€å‘ï¼Œé‚£ Docker æºç è‚¯å®šæ˜¯éœ€è¦åŽ»ç ”ç©¶çš„ï¼Œè‹¥ä»…ä»…æ˜¯å°† Docker ä½œä¸ºå·¥å…·ä½¿ç”¨ï¼Œé‚£å…³æ³¨ç‚¹å¯ä»¥æ”¾åœ¨ç›¸å…³çš„å·¥å…·å¦‚ Rancherã€Mesosã€Kubernetes ç­‰ï¼Œå½“ç„¶äº†ï¼Œè‹¥æ—¶é—´å…è®¸ï¼Œäº†è§£æºç å¥½å¤„å¤šå¤šï¼Œå¯ä»¥ä»Žåº•å±‚å¼„æ¸…æ¥š Docker çš„å„ç§æœºåˆ¶ï¼Œæœ‰åˆ©æ— å¼Šã€‚

> Qï¼šæ„Ÿè°¢åˆ†äº«ï¼Œè¯·é—®åœ¨å®¹å™¨èµ„æºæ± éƒ¨åˆ†æåˆ°çš„"è¿è¡ŒçŠ¶æ€çš„ IDE å®¹å™¨ï¼Œä¸Žå¼€å‘è€…çš„è®¿é—®åŸŸåç»‘å®š" å‡è®¾æœ‰ä¸¤ä¸ªç”¨æˆ·,ç”¨æˆ· A å’Œç”¨æˆ· Bï¼Œä»–ä»¬è®¿é—®çš„åŸŸååˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šè¿™ä¸ªæ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„äºŒçº§åŸŸåï¼Œå‡å¦‚åŸºäºŽé¡¶çº§åŸŸå cloudx5.comï¼Œç”¨æˆ· A åˆ›å»ºä¸€ä¸ª IDE å®žä¾‹ï¼Œè¿™æ˜¯ä»–å¯ä»¥è¾“å…¥ä¸€ä¸ªäºŒçº§åŸŸåå¦‚ a.cloudx5.comï¼ˆæˆ–è€…æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªï¼‰ï¼Œèµ„æºæ± ç»„ä»¶å°±ä¼šå°†è¿™ä¸ªåŸŸåä¸ŽèŽ·å–çš„ IDE å®¹å™¨ç»‘å®šï¼Œç”¨æˆ· A å°±å¯ä»¥è®¿é—®äº†ã€‚

> Qï¼šæƒ³é—®ä¸‹ Docker éƒ¨ç½²åº”ç”¨ï¼Œåº”ç”¨é…ç½®å‚æ•°æ€Žä¹ˆå¤„ç†ï¼Ÿæ”¹ä¸€ä¸ªå‚æ•°å°±è¦é‡æ–°æ‰“ä¸€åŒ…å—ï¼Ÿ

Aï¼šå…¶å®žåœ¨æˆ‘ä»¬è¿™ä¸ªç»“æž„ä¸­ï¼Œç”¨æˆ·å¹¶ä¸éœ€è¦å…³å¿ƒæ‰“åŒ…åŠå‚æ•°é…ç½®ï¼Œä»–éœ€è¦åšçš„ï¼Œå°±æ˜¯æŠŠå¼€å‘çš„ä»£ç ä¸Šä¼ ï¼Œæˆ‘ä»¬åŽç«¯ä½¿ç”¨äº† Jenkins æ¥åšç»Ÿä¸€çš„æ‰“åŒ…ï¼Œæ‰“åŒ…å®ŒæˆåŽä¼šè°ƒç”¨"åŠ¨æ€åº”ç”¨éƒ¨ç½²"çŽ¯èŠ‚æåˆ°çš„ Deployer å®¹å™¨ï¼Œè¿™ä¸ª Deployer ä¼šåŽ»çº¦å®šå¥½çš„ç›®å½•ä¸‹è½½æ‰“åŒ…å¥½çš„æ–‡ä»¶åšéƒ¨ç½²é…ç½®ã€‚

> Qï¼šå®žä¾‹æ”¶ç¼©çš„æ—¶å€™èƒ½ä¿è¯é‡Šæ”¾çš„å®¹å™¨æ²¡æœ‰ä¸šåŠ¡è®¿é—®ï¼Ÿ

Aï¼šè¿™ä¸ªä¸éœ€è¦ä¿è¯ï¼Œè¿è¡Œç€çš„å®žä¾‹å®¹å™¨éƒ½æ˜¯æ— çŠ¶æ€çš„ï¼Œå®žä¾‹ä¹‹é—´çš„ Session æ˜¯å…±äº«çš„ï¼Œéœ€è¦æŒä¹…åŒ–çš„æ•°æ®ä¹Ÿæ˜¯å­˜åœ¨åˆ«çš„å®¹å™¨ä¸­çš„å¦‚ MySQLã€‚

> Qï¼šLB è·¯ç”± WebApp çš„æ—¶å€™æ˜¯æŒ‰ç…§ IP å¯»å€çš„å—ï¼Ÿè¿™æ ·å¦‚ä½•ä¿è¯ WebApp é‡å¯æ—¶å€™ IP ä¸å˜åŒ–?

Aï¼šLB è·¯ç”±çš„æœ¬è´¨æ˜¯ä¸€ä¸ªå¸¦æœ‰æœåŠ¡å‘çŽ°åŠŸèƒ½çš„ Haproxyï¼ŒWebApp é‡å¯åŽ IP å˜åŒ–äº†ï¼ŒLB ä¼šå¾—çŸ¥è¿™ä¸ªå˜åŒ–å¹¶ä¿®æ”¹é…ç½®å’Œ reloadã€‚

> Qï¼šå°±æ˜¯è¯´é…ç½®æ–‡ä»¶è¿˜æ˜¯æ‰“åˆ° Docker é‡Œçš„ï¼Œæ¯”å¦‚è¿™æ—¶å¼€å‘è¦æ”¹ä¸ªé…ç½®æˆ–åŠ ä¸€é…ç½®ï¼Œè€Œä»£ç éƒ½æ²¡å˜ï¼Œè¿™æ—¶åªèƒ½åœ¨æ‰“ä¸€ä¸ªæ–°çš„åŒ…ï¼Ÿ

Aï¼šå…³äºŽè¿™ä¸ªæˆ‘ä»¬åšäº†ä¸€äº›çº¦å®šï¼Œä¾‹å¦‚ä¸Šè¾¹è®²åˆ°çš„ä¸€ä¸ªæœ€åŸºæœ¬çš„ Wex5 åº”ç”¨ï¼Œæˆ‘ä»¬å°†å…¶åˆ†ä¸º Wex5 APP å®¹å™¨ã€MySQL å®¹å™¨ä¸Ž Deployer å®¹å™¨ï¼ŒAPP åº”ç”¨å®¹å™¨è®¿é—® MySQL å®¹å™¨éƒ½æ˜¯é€šè¿‡ Rancher çš„å†…éƒ¨ DNS è§£æž MySQL å®¹å™¨åœ¨ Rancher ä¸­çš„æœåŠ¡åç§°æ¥è®¿é—®ï¼Œè¿™ä¸ªæ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œä¾‹å¦‚åœ¨å¤–å– APP åº”ç”¨ä¸­é…ç½®çš„ MySQL çš„åœ°å€æ˜¯ï¼šdatabase.waimaiï¼Œdatabase æ˜¯æœåŠ¡åç§°ï¼Œwaimai æ˜¯ Rancher çš„ stack åç§°ã€‚

---

### 2016-10-04ï¼šæ·±å…¥è§£æž DC/OS

> Qï¼šè¯·é—® DC/OS ç›®å‰æµ‹è¯•çš„æœ€å¤§é›†ç¾¤æ˜¯å¤šå°‘èŠ‚ç‚¹çš„ï¼Ÿ

Aï¼š Mesos çš„èŠ‚ç‚¹æ•° Tweeter å’Œ Apple ç½‘ä¸Šè¯´çš„æ•°ç›®éƒ½ä¸‡èŠ‚ç‚¹ä»¥ä¸Šï¼Œæˆ‘ä»¬å…¬å¸çŽ°åœ¨çš„å®¢æˆ·æœ‰åƒèŠ‚ç‚¹çº§åˆ«çš„ã€‚

> Qï¼šDC/OS ç›®å‰ç”¨åœ¨ä»€ä¹ˆåœºæ™¯ï¼Ÿ

Aï¼šDC/OS ç›®å‰çš„åº”ç”¨åœºæ™¯ä¸»è¦è¿˜æ˜¯å¾®æœåŠ¡å’Œå¤§æ•°æ®æ··åˆéƒ¨ç½²æ¯”è¾ƒå¤šï¼Œä¹Ÿæ˜¯å…¶è®¾è®¡æ ¸å¿ƒæ‰€åœ¨ã€‚

> Qï¼šè¯·é—®æœ‰éƒ¨ç½² Stateful çš„åº”ç”¨ï¼Œæ¯”å¦‚ MySQL å—ï¼Ÿ

Aï¼šæ˜¯ç”¨ DC/OS è¿˜æ˜¯å»ºè®®ä»Žæ— çŠ¶æ€çš„æœåŠ¡å¼€å§‹ï¼Œéšç€è¿ç»´èƒ½åŠ›çš„æé«˜ï¼Œå¯ä»¥éƒ¨ç½²æœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œä½†æ˜¯æœ‰çŠ¶æ€çš„æœåŠ¡ä¸å»ºè®®ç›´æŽ¥ä½¿ç”¨ Marathon è¿›è¡Œéƒ¨ç½²ï¼Œä¸€æ–¹é¢å®ƒæ— æ³•åŒºåˆ†å¤šä¸ª instance ä¹‹é—´çš„åŒºåˆ«ï¼Œå¦ä¸€æ–¹é¢éœ€è¦é…åˆç»Ÿä¸€å­˜å‚¨æ¥å®žçŽ°ã€‚å¯¹äºŽæœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œå¯ä»¥è‡ªå·±å®žçŽ° Frameworkï¼Œä¾‹å¦‚æˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®åº“æ˜¯ MongoDBï¼Œä¹Ÿæ˜¯å†™äº†è‡ªå·±çš„ Framework çš„ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 10 æœˆ 4 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**åˆ˜è¶…ï¼ŒLinker Networks é¦–å¸­æž¶æž„å¸ˆï¼Œ10 å¹´äº‘è®¡ç®—é¢†åŸŸç ”å‘åŠæž¶æž„ç»éªŒï¼ŒOpenDC/OS è´¡çŒ®è€…ã€‚é•¿æœŸä¸“æ³¨äºŽ OpenStackã€Hadoopã€Dockerã€Sparkã€Mesos ç­‰å¼€æºè½¯ä»¶çš„ä¼ä¸šçº§åº”ç”¨åŠäº§å“åŒ–ã€‚[ä¸ªäººåšå®¢ï¼š](http://blog.csdn.net/popsuper1982)**ã€‚

---

### 2016-09-27ï¼šDocker åœ¨ B ç«™çš„å®žæ–½ä¹‹è·¯

> Qï¼šä½ å¥½ é—®ä¸‹è´µå…¬å¸çš„è‡ªåŠ¨æ‰©å®¹æ˜¯é’ˆå¯¹åº”ç”¨çš„å§

æœ‰æ²¡æœ‰é’ˆå¯¹ Mesos èµ„æºæ± ç›‘æŽ§å¹¶åš Mesos Agent çš„æ‰©å®¹ï¼Ÿ

Aï¼šç›®å‰çš„è‡ªåŠ¨æ‰©å®¹æ˜¯é’ˆå¯¹åº”ç”¨çš„ã€‚Mesos Agent æ‰©å®¹æ—¶ï¼Œå…ˆæŠŠç‰©ç†æœºä¿¡æ¯å½•å…¥ PaaS å¹³å°ï¼Œæ‰‹åŠ¨åœ¨ PaaS å¹³å°ç‚¹å‡»æ‰©å®¹ï¼ŒåŽå°ä¼šè°ƒç”¨ Ansibleï¼Œåˆ†é’Ÿå¿«é€Ÿçº§æ‰© Mesos Agentã€‚

> Qï¼šçŽ°åœ¨æ˜¯ç¡®å®š Nginx+UpSync+Upsteam check æ˜¯æ— æ³•ä¸€èµ·ç”¨çš„ä¹ˆï¼Ÿè´µå…¬å¸çš„ Nginx ç‰ˆæœ¬æ˜¯å¤šå°‘å“‡ï¼Ÿ

Aï¼šæµ‹è¯•è¿‡ Nginx 1.8 å’Œ 1.10ï¼Œç¡®è®¤æ— æ³•ä¸€åŒç¼–è¯‘ã€‚æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„ Nginxï¼ˆSLBï¼‰æ˜¯ Tengine 2.1.1ï¼Œéƒ¨ç½²åœ¨ Docker ä¸Šã€‚

> Qï¼šæ—¢ç„¶æ˜¯å°è£…ï¼Œ é‚£åº•å±‚ç”¨ Mesos æ¯” Kubernets å¹¶æ²¡æœ‰å¤ªå¤§çš„çµæ´»æ€§å§ï¼Ÿ

Aï¼šå¯¹äºŽ PaaS å¹³å°ï¼Œç›®å‰æˆ‘ä»¬å¸Œæœ›çš„åªéœ€è¦èµ„æºè°ƒåº¦è¿™ä¸ªåŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½æˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›å¯ä»¥è‡ªå·±å®žçŽ°ï¼Œè€Œ Mesos æ˜¯ä¸“æ³¨äºŽè°ƒåº¦èµ„æºï¼Œè€Œä¸”å·²ç»åŽ†ç»äº†å¤§é‡çº§çš„è€ƒéªŒã€‚è€Œ Kubernetes ç›®å‰æä¾›çš„å¾ˆå¤šæœåŠ¡ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ï¼Œæ‰€ä»¥é€‰æ‹©äº† Mesosã€‚

> Qï¼šå®¹å™¨æ˜¯é‡‡ç”¨ Monitor Agent ç›‘æŽ§ï¼Œé‚£å®¹å™¨å†…çš„å‘¢ï¼Ÿä¹Ÿè¿˜æ˜¯å†…éƒ¨åŸ‹ç‚¹ï¼Ÿè¿˜æ˜¯ EFK å—ï¼Ÿç›‘æŽ§æ˜¯é‡‡ç”¨ Prometheus å—ï¼Ÿ

Aï¼šPrometheus æ²¡æœ‰ä½¿ç”¨ï¼Œæˆ‘ä»¬æ˜¯ç”¨è‡ªå·±çš„ç›‘æŽ§ Agent InfluxDBã€‚å®¹å™¨å†…æœ‰å¤šç§ç›‘æŽ§æ–¹å¼ã€‚æœ‰ç”¨ ELKï¼Œä¹Ÿæœ‰å…¶ä»–åŸ‹ç‚¹ï¼Œæ¯”å¦‚ StatsDï¼ŒåŸºäºŽ Dapper è®ºæ–‡å®žçŽ°çš„å…¨é“¾è·¯è¿½è¸ªã€‚

> Qï¼šç½‘ç»œé€‰åž‹è¿™å—,è¿˜è°ƒç ”è¿‡å…¶ä»–ç½‘ç»œæ–¹æ¡ˆå—ï¼Ÿè­¬å¦‚ Calicoã€Weave ç­‰ï¼Œä¸ºä»€ä¹ˆä¼šé€‰ç”¨ Macvlanï¼Ÿ

Aï¼šæˆ‘ä»¬çš„é€‰åž‹ç¬¬ä¸€æ­¥æ˜¯å…ˆé€‰æ‹©æ ‡å‡†çš„ï¼Œè¦ä»Ž CoreOS ä¸»å¯¼çš„ cni è¿˜æ˜¯ Docker å®˜æ–¹ä¸»å¯¼ cnm é‡Œé¢é€‰æ‹©ï¼Œç›®å‰ç”±äºŽæˆ‘ä»¬å®¹å™¨æ–¹æ¡ˆè¿˜æ˜¯èµ°çš„ Dockerï¼Œæ‰€ä»¥é€‰æ‹©äº† cnmï¼Œé‚£ä»Ž cnm çš„æ ‡å‡†é‡Œé¢çš„é€‰æ‹©åŸºæœ¬æ˜¯ï¼š1. åŸºäºŽ XVLAN çš„ Overlayï¼›2. åŸºäºŽä¸‰å±‚è·¯ç”±çš„ Calicoï¼›3. åŸºäºŽäºŒå±‚éš”ç¦»çš„ Macvlanï¼Œå®žé™…ä»¥ä¸Šçš„æ–¹æ¡ˆæˆ‘ä»¬éƒ½è°ƒç ”ä½¿ç”¨è¿‡ï¼ŒåŸºäºŽå¸Œæœ›å°½é‡ç®€å•çš„åŽŸåˆ™æœ€ç»ˆé€‰åž‹è¿˜æ˜¯ Macvlanã€‚

Qï¼šBili PaaS å¹³å°ï¼Œè‡ªåŠ¨æ‰©å®¹å’Œæ‰‹åŠ¨æ‰©å®¹ï¼Œåº”ç”¨å¤šçš„æ˜¯å“ªç§æ–¹å¼ï¼Ÿè‡ªåŠ¨æ‰©å®¹åŽï¼Œèµ„æºä¼šé‡è°ƒåº¦ä¹ˆï¼Ÿæ˜¯å¦ä¼šä¸­æ–­å·²æœ‰ä¸šåŠ¡å‘¢ï¼Ÿ

Aï¼šç”¨çš„æ›´å¤šçš„æ˜¯æ ¹æ®åˆ¶å®šå¥½çš„ç­–ç•¥ï¼Œè‡ªåŠ¨æ‰©å®¹ã€‚é€šè¿‡ Nginx åŠ¨æ€ Upstream å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¸ä¼šä¸­æ–­ä¸šåŠ¡ã€‚

> Qï¼šå…³äºŽæ—¥å¿—æ”¶é›†æ¯ä¸ªå®¹å™¨é‡Œéƒ½è·‘ä¸€ä¸ª Logstash å—ï¼Ÿå¥½åƒ ELK ä¸èƒ½æœç´¢å±•ç¤ºä¸Šä¸‹æ–‡çš„å•Šï¼Ÿ

Aï¼šå®¹å™¨é‡Œé¢æ²¡æœ‰è·‘ Logstashã€‚ç›®å‰æ˜¯åœ¨è¿œç«¯çš„ Logstash é›†ç¾¤ä¸Šç›‘å¬ä¸€ä¸ª UDP ç«¯å£ï¼Œåº”ç”¨ç›´æŽ¥æŠŠæ—¥å¿—æŽ¨é€åˆ° Logstash çš„ UDP ç«¯å£ï¼Œç„¶åŽ Logstash æŠŠæ—¥å¿—æŽ¨é€åˆ° Kafkaï¼ŒKafka çš„æ¶ˆè´¹è€…æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ Elasticsearchï¼Œä¸€ä¸ªæ˜¯ HDFSã€‚ä¸€èˆ¬ç”¨ ELK è¶³ä»¥ã€‚éœ€è¦è¯¦ç»†æ—¥å¿—æ—¶ï¼Œç”±è¿ç»´é€šè¿‡ HDFS æŸ¥è¯¢ã€‚

> Qï¼šæˆ‘æƒ³è¯·æ•™ä¸‹ Nginx çš„ä¸€äº›åŠ¨æ€é…ç½®æ–‡ä»¶æ˜¯å°è£…åœ¨å®¹å™¨å†…éƒ¨äº†ï¼Ÿè¿˜æ˜¯é€šè¿‡ volume çš„æ–¹å¼æŒ‚è½½äº†ï¼Ÿæœ‰æ²¡æœ‰é…ç½®ä¸­å¿ƒç±»ä¼¼çš„æœåŠ¡ï¼Ÿè¿™å—æƒ³äº†è§£ä¸‹æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šNginx çš„ Upstream æ˜¯ä»Ž Consul åŠ¨æ€èŽ·å–ç”Ÿæˆåœ¨æœ¬åœ°çš„ï¼Œé€šè¿‡ Volume æŒ‚è½½ï¼ŒæŒä¹…åŒ–åˆ°å®¿ä¸»æœºã€‚æœ‰é…ç½®ä¸­å¿ƒã€‚ä¸šåŠ¡ Docker åŒ–æ—¶ï¼Œå°±ä¼šæŽ¨åŠ¨ä¸šåŠ¡é…ç½®æŽ¥é…ç½®ä¸­å¿ƒï¼ŒDocker ä¸­ä¸åœ¨ä¿å­˜ä¸šåŠ¡ä¾èµ–çš„é…ç½®ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 9 æœˆ 27 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æ­¦å®‰é—¯ï¼ŒBilibili è¿ç»´å·¥ç¨‹å¸ˆï¼Œç›®å‰ä¸»è¦è´Ÿè´£ B ç«™è¿ç»´å’Œä¸šåŠ¡ Docker åŒ–çš„å®žæ–½ã€‚ä¸€ç›´å…³æ³¨äºŽ Docker çš„å‘å±•ï¼ŒDocker ä¸Ž Mesos ç»“åˆçš„å®¹å™¨å¹³å°å®žæ–½**

---

### 2016-09-20ï¼š Acttao å¼€å‘ã€è¿ç»´å®¹å™¨åŒ–å®žè·µ

> Qï¼šä¸ºä»€ä¹ˆä¸é‡‡ç”¨ Kubernetes å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬åœ¨ 2015 å¹´åˆåšé€‰åž‹æ—¶ï¼ŒKubernetes è¿˜ä¸æ˜¯å¾ˆæˆç†Ÿã€‚å½“æ—¶æˆ‘ä»¬è¯„ä¼° Mesos å’Œ Kubernetes åŽï¼Œè§‰å¾— Kubernetes å¤ªå¤æ‚ï¼ŒMesos çš„æ ¸å¿ƒåŠŸèƒ½å¾ˆç®€å•ï¼Œå…¶ä»–çš„åŠŸèƒ½éƒ½ç”± Framework æ¥å®žçŽ°ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“å°±ç†è§£äº† Mesosï¼ŒäºŽæ˜¯å°±é€‰æ‹©äº† Mesosã€‚

> Qï¼šæ‚¨å¯¹å®¹å™¨åŒ– OpenStack æ€Žä¹ˆçœ‹ï¼Ÿ

Aï¼šOpenStack åœ¨æˆ‘ä»¬çœ‹æ¥åªæ˜¯æ›´æ–¹ä¾¿çš„æä¾›åº•å±‚èµ„æºçš„å¹³å°ï¼Œå®¹å™¨åŒ–åŽçš„ OpenStack åªæ˜¯èƒ½ä½¿ç”¨ OpenStack çš„æ–¹å¼ç®¡ç†å®¹å™¨äº†ã€‚ä½†ä½¿ç”¨ Mesos æ¥ç®¡ç†å®¹å™¨çš„è¯å®ƒä¸å…³å¿ƒåº•å±‚åˆ°åº•æ˜¯è™šæ‹Ÿæœºè¿˜æ˜¯ç‰©ç†æœºã€‚ å®¹å™¨åŒ– OpenStack è½¯ä»¶æœ¬èº«åŽéƒ¨ç½²å‡çº§ OpenStack ä¹Ÿè¾ƒä¸ºæ–¹ä¾¿ã€‚æˆ‘ä»¬çŽ°åœ¨è¿™ä¸ªç³»ç»Ÿéƒ¨ç½²çš„è½¯ä»¶é™¤äº† Mesos å¤–ï¼Œèƒ½ä½¿ç”¨ Docker è¿è¡Œçš„ä¹Ÿå°½é‡åœ°é‡‡ç”¨äº† Docker è¿›è¡Œè¿è¡Œã€‚

> Qï¼šå…³äºŽ Weave å¾ˆå¤šæ–‡ç« éƒ½è¯´æ€§èƒ½ä¸è¡Œï¼Œå°±ä½ ä»¬çš„é¡¹ç›®å’Œå®žé™…ä½¿ç”¨æƒ…å†µæ¥çœ‹ï¼Œèƒ½å¯¹ Weave åšæ›´å¤šçš„è¯„ä»·ä¹ˆï¼Ÿ

Aï¼šæˆ‘ä»¬è‡ªå·±å½“æ—¶æµ‹è¯•åœ¨ FastDb æ¨¡å¼ä¸‹ï¼ŒWeave çš„æ€§èƒ½è¿˜åœ¨æŽ¥å—çš„èŒƒå›´é‡Œï¼Œå¤§æ¦‚æ¯” OpenStack ä¸­çš„ Neutron ç½‘ç»œæŸå¤±äº† 10% ï½ž 20% ã€‚å°±å®žé™…çš„ä½¿ç”¨æƒ…å†µçœ‹æ¥ï¼ŒWeave é›†ç¾¤æ­å»ºèµ·æ¥éžå¸¸å®¹æ˜“ï¼Œæ¯•ç«Ÿä¸ä¾èµ–äºŽä»»ä½•å¤–éƒ¨å­˜å‚¨ã€‚ä½†æ˜¯å®ƒå‡ºçŽ°ä»»ä½•é—®é¢˜æ—¶ï¼Œè°ƒè¯•ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚

> Qï¼šContainer ç½‘ç»œä¸­ï¼ŒWeave æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Œä¸ºä»€ä¹ˆä¸é‡‡ç”¨ Flannelï¼Ÿ

Aï¼šWeave çš„ä¼˜ç‚¹æ­å»ºæ–¹ä¾¿ï¼Œæœ‰ proxyã€pluginã€cni æ¨¡å¼ï¼Œè‡ªå¸¦ DNS åšæœåŠ¡å‘çŽ°ã€‚åœ¨ Mesos è¿˜æ²¡æœ‰åŽŸç”Ÿçš„å®¹å™¨ç½‘ç»œæ”¯æŒæ—¶ï¼Œweave proxy çš„æ–¹å¼èƒ½å¾ˆå®¹å™¨çš„è®©ä½¿ç”¨ Marathon åˆ›å»ºçš„ Docker å®¹å™¨æ‹¥æœ‰è‡ªå·±çš„ç½‘ç»œã€‚ æˆ‘ä»¬æ˜¯ä¸€ä¸ªå°çš„å›¢é˜Ÿï¼Œä¼˜å…ˆè€ƒè™‘æˆ‘ä»¬èƒ½å®¹æ˜“ç†è§£çš„æ–¹æ¡ˆã€‚

> Qï¼šè¯·é—®ç›®å‰ä½ ä»¬ Staging å’Œ Product çŽ¯å¢ƒçš„å‘å¸ƒé¢‘çŽ‡å¦‚ä½•ï¼Ÿä¸¤å¥—çŽ¯å¢ƒæ˜¯ç”¨çš„åŒä¸€å¥— CI/CD ç³»ç»Ÿå—ï¼Ÿå¯¹äºŽéƒ¨ç½²åœ¨å®¢æˆ·çš„ç³»ç»Ÿå³ç½‘ç»œä¸è¿žé€šçš„ï¼Œå¦‚ä½•å®žçŽ°é•œåƒæˆ–çŽ¯å¢ƒåŒæ­¥çš„ï¼Ÿ

Aï¼šStaging çŽ¯å¢ƒçš„å‘å¸ƒé¢‘çŽ‡å¾ˆå¿«ï¼Œå¼€å‘æ¨ä¸å¾—æ²¡ merge ä¸€ä¸ª mr å°±åšä¸€æ¬¡å‘å¸ƒã€‚Product çŽ¯å¢ƒåœ¨ä»Šå¤©ä¹‹å‰ä¾ç„¶æ˜¯è¿ç»´äººå·¥åŽ»éƒ¨ç½²çš„ï¼Œæ˜Žå¤©æ­£å¼è¿ç§»åˆ°é˜¿é‡Œäº‘åŽï¼Œå‰æœŸä¾ç„¶ä¼šé‡‡ç”¨äººå·¥è°ƒç”¨æˆ‘ä»¬çš„ PaaS å·¥å…·åŽ»åšå‘å¸ƒã€‚ç­‰å¤§å®¶éƒ½æŽ¥å—å®¹å™¨åŒ–è‡ªåŠ¨åŒ–çš„éƒ¨ç½²æ–¹å¼å¯èƒ½ä¼šè€ƒè™‘åœ¨ç”Ÿäº§çŽ¯å¢ƒä¹Ÿè¿›è¡Œè‡ªåŠ¨éƒ¨ç½²ã€‚ éƒ½æ˜¯ç”¨çš„åŒä¸€å¥— CI/CD ç³»ç»Ÿã€‚ æˆ‘ä»¬çŽ°åœ¨çš„ Registry ä½¿ç”¨çš„é˜¿é‡Œäº‘çš„ OSSï¼Œæ¯ä¸ªç½‘ç»œçš„å†…éƒ¨éƒ¨ç½²è‡ªå·±çš„ Registryã€‚

> Qï¼šä¸ºä»€ä¹ˆä¸ç›´æŽ¥ç”¨é˜¿é‡Œäº‘çš„å®¹å™¨æœåŠ¡è€Œè‡ªå·±æ­å»ºå‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬è‡ªå·±å¼„è¿™å¥—çŽ¯å¢ƒæ—¶ï¼Œæ²¡æœ‰æƒ³è¿‡ä¼šä½¿ç”¨é˜¿é‡Œäº‘ã€‚å½“è®¡åˆ’è¿ç§»åˆ°é˜¿é‡Œäº‘æ—¶ï¼Œè‡ªå·±çš„é‚£å¥—ä¸œè¥¿å·²ç»è¿è¡Œå¾ˆç¨³å®šï¼Œå’Œå¼€å‘æµç¨‹é…åˆçš„å¾ˆå¥½ã€‚ä½¿ç”¨é˜¿é‡Œäº‘çš„å®¹å™¨æœåŠ¡å¯èƒ½çŽ°æœ‰çš„æµç¨‹è¦è°ƒæ•´ï¼Œè€Œä¸”æˆ‘ä¹Ÿä¸ç¡®è®¤å…¬å¸è¿˜ä¼šä¸ä¼šä»Žé˜¿é‡Œäº‘è¿èµ°ã€‚

> Qï¼šå¦‚æžœçŽ°åœ¨é€‰ï¼Œä¼šé€‰ Kubernetes å—ï¼Ÿ ä¸ºä»€ä¹ˆï¼Ÿ

Aï¼šä¾ç„¶ä¼šé€‰æ‹© Mesosï¼Œå› ä¸ºé™¤äº†å®¹å™¨ç¼–æŽ’ï¼Œä¸æŽ’é™¤æˆ‘ä»¬åŽç»­ä¼šä½¿ç”¨å…¶ä»–çš„æœåŠ¡ï¼Œæ¯”å¦‚ Spark ã€‚åŒæ—¶ï¼ŒKubernetes æœ‰çš„ï¼Œ Mesos çŽ°åœ¨ä¹Ÿæœ‰ï¼Œcniã€Docker Volume ç­‰ç­‰ã€‚

> Qï¼šä½ ä»¬çš„ç½‘ç»œä¼¼ä¹Žç»åŽ†äº† Calico- Weave- Calico çš„è¿‡ç¨‹ï¼Œwhyï¼Ÿ

Aï¼šæˆ‘ä»¬ä»Žæ¥æ²¡æœ‰åœ¨æ­£å¼çš„çŽ¯å¢ƒä¸­ä½¿ç”¨è¿‡ Calicoã€‚é€‰ç”¨ Weave çš„åŽŸå› æ˜¯ weave proxy æ¨¡å¼åœ¨å½“æ—¶èƒ½å¾ˆå¥½çš„ Mesos/Marathon è¿›è¡Œé›†æˆã€‚ çŽ°åœ¨è€ƒè™‘ Calico çš„åŽŸå› æ˜¯ Mesos 1.0 åŽæ”¯æŒ cni äº†ï¼ŒCalico cni èƒ½å¾ˆå¥½çš„é›†æˆè¿› Mesosï¼Œè€Œä¸” Calico çš„æ€§èƒ½ã€ç¨³å®šæ€§ã€ç½‘ç»œéš”ç¦»è¾ƒ Weave å¥½ã€‚

> Qï¼šè¿™ä¹ˆå¤šåº”ç”¨ï¼Œæ•°æ®åº“åˆ†å¸ƒæ˜¯æ€Žæ ·çš„ï¼Ÿæ•°æ®æ˜¯æŒ‚è½½è¿› Docker çš„ï¼Ÿ

Aï¼šä½¿ç”¨çš„ REX-Ray æŠŠ OpenStack çš„å—å­˜å‚¨ä½œä¸ºæ•°æ®ç›˜æŒ‚è½½åˆ° VM çš„ï¼Œç„¶åŽé‡‡ç”¨ docker volume plugin çš„æ–¹å¼æŒ‚è½½åˆ°å®¹å™¨é‡Œçš„ã€‚ä¸€ä¸ª Volume å¯¹åº”ä¸€ä¸ª Cinder å—è®¾å¤‡ã€‚

> Qï¼šä»Žä½ è¯´çš„æŠŠä½ ä»¬è¿™å¥— CI/CD ç§»åˆ°é˜¿é‡Œäº‘ä¸Šå·®ä¸å¤šç”¨äº†æŽ¥è¿‘ä¸¤ä¸ªæœˆçš„æ—¶é—´ï¼Œè¿™ä¹Ÿç®—æ¯”è¾ƒé•¿äº†ï¼Œèƒ½è¯´è¯´åœ¨è¿ç§»è¿‡ç¨‹ä¸­éƒ½åšäº†å“ªäº›äº‹æƒ…ï¼Œæœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿé‚£ä¸€èˆ¬ä¸€ä¸ªæ™®é€šçš„åº”ç”¨ç³»ç»Ÿå¦‚æžœè¿ç§»åˆ°é˜¿é‡Œäº‘ä¸Šï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬å…¶ç»´æŠ¤çš„ CI/CDï¼‰ï¼Œéœ€è¦å¤šé•¿æ—¶é—´ï¼Œæœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ

Aï¼šå®žé™…çš„è¿ç§»æ—¶é—´æ²¡æœ‰ç”¨åˆ°ä¸¤ä¸ªæœˆï¼Œåœ¨é˜¿é‡Œäº‘ä¸Šæ­å»ºè¿™ä¸ªç³»ç»Ÿå¤§æ¦‚èŠ±äº† 2 åˆ° 3 å‘¨çš„æ—¶é—´ï¼ˆå¤§éƒ¨åˆ†çš„æ—¶é—´éƒ½åœ¨ç¼–å†™ Aliyun çš„ terraform providerï¼‰ï¼ŒçœŸæ­£éƒ¨ç½²èµ·æ¥ç”¨äº†ä¸€å¤©çš„æ—¶é—´ï¼Œæˆ‘è®°å¾—æ˜¯åœ¨ 8 æœˆ 13ï¼Œé‚£å¤©æˆ‘ä»¬é‡‡ç”¨åŒ…æœˆçš„æ–¹å¼ä¹°äº†ä¸€æ‰¹çš„é˜¿é‡Œäº‘èµ„æºã€‚åŽç»­çš„æ—¶é—´å¤§å¤šæ˜¯åœ¨åšè¿ç§»åŽçš„æµ‹è¯•å·¥ä½œï¼Œå› ä¸ºå…¬å¸çš„è¿ç»´å¯¹åœ¨é˜¿é‡Œäº‘ä¸­è¿è¡Œ Docker æŒæ€€ç–‘çš„æ€åº¦ï¼Œè€Œä¸”è¿™ä¸ªè¿ç§»åŽç»­æ˜¯ç”¨ä¸šä½™æ—¶é—´æ¥å®Œæˆçš„ï¼Œ8 æœˆä¸­æ—¬æˆ‘ä»¬åˆå¿™æ´»äº†ä¸€é˜µå­ï¼Œè¿™ä¸¤å¤©åˆšæ­‡ä¼šè€Œã€‚è¿ç§»ç³»ç»Ÿåº”ç”¨ç³»ç»Ÿéœ€è¦æ³¨æ„çš„äº‹æƒ…å°±æ˜¯å°½é‡å¤šæµ‹è¯•ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 9 æœˆ 20 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**ä½•å¨å¨ï¼ŒActtao æŠ€æœ¯æ€»ç›‘ï¼Œå¤šå¹´ Python å¼€å‘ç»éªŒï¼Œä½¿ç”¨ SaltStackã€Ansible å€’è…¾è¿‡ OpenStack çš„éƒ¨ç½²ã€‚ä»Ž 2014 å¹´åˆå¼€å§‹ä½¿ç”¨ Dockerï¼Œ2015 å¹´åˆæŽ¥è§¦ Mesos åŠå¹´åŽä½¿ç”¨ Ansible åœ¨ OpenStack ä¸­éƒ¨ç½² Mesos é›†ç¾¤è¿è¡Œåˆ°ä»Šå¹´ 8 æœˆåˆã€‚çŽ°åœ¨ç®¡ç†ç»´æŠ¤å…¬å¸ IDC KVM ä¸­å’Œé˜¿é‡Œäº‘ä¸­è¿è¡Œçš„ Mesos é›†ç¾¤**ã€‚

---

### 2016-09-06ï¼šå”¯å“ä¼šæ•°æ®åº“å¤‡ä»½æ¢å¤å®¹å™¨åŒ–é¡¹ç›®å®žè·µç»éªŒæ€»ç»“

> Qï¼šå‘çŽ°çŽ°åœ¨å¾ˆå¤šé‡‡ç”¨æ¡¥æŽ¥ç½‘æ¡¥çš„æ–¹å¼æ”¹å–„ Docker ç½‘ç»œ ï¼Œè¿™ä¸ªå¯æœ‰æµ‹è¯•ï¼Ÿ

Aï¼šæ¡¥æŽ¥ç½‘æ¡¥çš„æ–¹å¼æ˜¯ä¸ªç®€å•çš„æ–¹æ¡ˆï¼Œä½† IP åœ°å€åˆ†é…åªèƒ½åœ¨æœ¬æœºåš IPAMï¼Œæ— æ³•å…¨å±€ç®¡ç†ï¼Œå­˜åœ¨åœ°å€èµ„æºæµªè´¹çš„é—®é¢˜ã€‚

> Qï¼šè¯·é—®æ”¹ä½“ç³»åœ¨å®žæˆ˜ä¸­ç ”å‘çŽ¯å¢ƒï¼Œæµ‹è¯•çŽ¯å¢ƒå’Œé¢„å‘å¸ƒçŽ¯å¢ƒçš„äº¤ä»˜ç‰©æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

Aï¼šMySQL æ•°æ®çš„å¤‡ä»½æ¢å¤èƒ½åŠ›ã€‚

> Qï¼š"å®¹å™¨å¼‚å¸¸é€€å‡º IP åœ°å€ä¸èƒ½é‡Šæ”¾çš„é—®é¢˜ï¼Œè¿™éƒ½éœ€è¦æˆ‘ä»¬è‡ªå·±åŽ»è§£å†³ã€‚"å¯å¦æä¾›ä¸€ä¸ªå¤§è‡´çš„è§£å†³æ€è·¯ï¼Ÿ

Aï¼šè®¡åˆ’é€šè¿‡ libnetwork unix socket è°ƒä¸€ä¸ªå« ReleaseEndpoint çš„ APIï¼Œè¿™æ ·å¯ä»¥ä¿è¯åˆ é™¤æ“ä½œçš„å®Œæ•´æ€§ï¼ŒåŒ…æ‹¬ ovs portã€etcd ep ä¿¡æ¯ã€IP åœ°å€ã€‚

> Qï¼šDocker 1.12 å†…ç½® Docker swarm modeï¼ŒOverlay ç½‘ç»œçš„æ€§èƒ½ç›¸æ¯”å…¶ä»–å¼€æºæ–¹æ¡ˆçš„ä¼˜åŠ£åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šOverlay ç½‘ç»œçš„ä¼˜åŠ¿åœ¨äºŽå¯¹è™šæ‹Ÿç½‘ç»œï¼Œå¤šç§Ÿæˆ·åœºæ™¯æ”¯æŒæ›´å¥½ï¼Œæ²¡æœ‰ 4096 ä¸ªçš„é™åˆ¶ï¼Œ ç„¶è€Œæ²¡æœ‰æ”¯æŒ VXLAN ç¡¬ä»¶çš„æƒ…å†µä¸‹æ— æ³•ç›´æŽ¥è®¿é—®ï¼Œè¿™å¯¹äºŽå¼€å‘ï¼Œé—®é¢˜å®šä½ï¼Œç›‘æŽ§éƒ½æ˜¯ä¸ªéš¾é¢˜ã€‚æ€§èƒ½çš„è¯å¯¹äºŽå®¹å™¨æ¥è¯´ä¸ä¼šæ˜¯ä¸€ä¸ªç“¶é¢ˆã€‚

> Qï¼šåšè¿‡ Mesos 1.0 æµ‹è¯•å—ï¼Ÿ1.0 å·²ç»ä¸ä¼šä¾èµ– Docker daemon äº†ï¼Ÿ

Aï¼šMesos 1.0 ä¸­ä»ç„¶æ”¯æŒ Docker ä½œä¸º Containerizerã€‚å®žéªŒçŽ¯å¢ƒéªŒè¯è¿‡ Mesos + Docker + Netplugin æ˜¯å¯è¡Œçš„ï¼Œç†è®ºä¸Šæ— è®ºç”¨å“ªä¸ª Mesos ç‰ˆæœ¬ï¼Œåªè¦å®ƒä»ç„¶æ”¯æŒ Dockerï¼Œé‚£ä¹ˆå°±å¯ä»¥ç½‘ç»œæ’ä»¶çš„å½¢å¼æ¥è½åœ°ç½‘ç»œå®žçŽ°ã€‚

> Qï¼šå®¹å™¨ä¸€èˆ¬æ˜¯å³ç”¨å³é”€æ¯ï¼Œæƒ³é—®ä¸‹ï¼Œä½ ä»¬åšçš„å®¹å™¨ç›‘æŽ§ï¼Œæ˜¯å¦‚ä½•ä¿è¯æ•°æ®æŒä¹…æ€§çš„ï¼Ÿ

Aï¼šMySQL å¤‡ä»½å‡ºæ¥çš„æ•°æ®æ˜¯ä¿å­˜åœ¨å®¹å™¨å¤–éƒ¨å·ä¸Šï¼Œå³å®¿ä¸»æœºä¸Šçš„ï¼Œå®¹å™¨é”€æ¯å¤–éƒ¨å·å¹¶ä¸ä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥æ•°æ®ä»ç„¶èƒ½å¤Ÿä¿ç•™ä¸‹æ¥ã€‚

> Qï¼šè¯·é—®ä½ ä»¬çš„å®¹å™¨å‘Šè­¦æ˜¯åŸºäºŽä»€ä¹ˆåšçš„ï¼ŒcAdvisor å¹¶ä¸èƒ½æä¾›å‘Šè­¦å§ï¼Ÿ

Aï¼šåŸºäºŽæˆ‘å¸å·²æœ‰çš„ç›‘æŽ§ä½“ç³»ï¼Œå³ Zabbixã€‚

> Qï¼šDevicemapper ä½¿ç”¨çš„æ˜¯ Direct LVM å—ï¼Ÿè®¾å¤‡ç©ºé—´ç”¨æ»¡çš„æƒ…å†µä¸‹å¦‚ä½•æ‰©å®¹ï¼Ÿ

Aï¼šæ˜¯çš„ã€‚æ‰©å®¹å¯ä»¥é€šè¿‡æ·»åŠ ç‰©ç†ç£ç›˜è®¾å¤‡ï¼Œæ‰© VGï¼Œå† resize dm pool å¤§å°ã€‚

> Qï¼šå½“æ‚¨ç”¨åˆ°ä¸Šç™¾å°æœºå™¨çš„æ—¶å€™ï¼Œé•œåƒæ˜¯æå‰ä¸‹è½½å¥½çš„å—ï¼Ÿè¿˜æ˜¯ä¸´æ—¶ä¸‹è½½ï¼Œæœ‰æ²¡æœ‰åšé•œåƒä¸‹è½½åŠ é€Ÿè¿™å—å„¿ï¼Ÿ

Aï¼šé•œåƒæ˜¯ä¿å­˜åœ¨æœ¬åœ° IDC çš„ Registry é‡Œï¼Œæ‰€æœ‰æœºå™¨è®¿é—® Registry é€šè¿‡ç›¸è¿‘çš„ç½‘ç»œï¼Œä¸‹è½½é€Ÿåº¦å¾ˆå¿«ã€‚å¥½çš„åšæ³•æ˜¯å…ˆå…¨å±€ Pull ä¸€æ¬¡å† Run å§ã€‚

> Qï¼šæˆ‘å¯¹å®¹å™¨ä¸­æ”¾æ•°æ®åº“çš„æ€§èƒ½æ¯”è¾ƒæ‹…å¿ƒï¼Œä½ ä»¬çš„æ€§èƒ½è¿™ä¹ˆé«˜ï¼Œä¸»è¦åšäº†ä»€ä¹ˆé…ç½®ï¼Ÿ

Aï¼š å› ä¸ºå®³æ€•äº’ç›¸æŠ¢èµ„æºï¼Œæˆ‘ä»¬ä¸¥æ ¼é™åˆ¶å•ä¸€ä¸»æœºçš„å®¹å™¨æ•°é‡ã€CPUã€å†…å­˜ã€ç£ç›˜éƒ½ä¸è¶…é…ã€‚åœ¨èµ„æºå……è¶³çš„æƒ…å†µä¸‹ï¼ŒMySQL è·‘åœ¨å®¹å™¨é‡Œè·Ÿè·‘åœ¨å¤–é¢æ²¡æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œéƒ½æ˜¯è¿›ç¨‹ã€‚

> Qï¼šå…³äºŽç›‘æŽ§è¿™å—ï¼Œä¸Šæ–‡æåˆ°äº†ä¸¤ä¸ªï¼Œèƒ½ç»™æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹ Zabbix å’Œ cAdvisor çš„åˆ†å·¥å—ï¼Ÿ

Aï¼šZabbix é€šè¿‡è‡ªå·±å†™çš„è„šæœ¬ï¼Œå‘ cAdvisor RESTful æŽ¥å£è¯·æ±‚å®¹å™¨ç›‘æŽ§æ•°æ®ã€‚

> Qï¼šMySQL æ•°æ®åº“å®¹å™¨åŒ–åŽï¼Œæ€§èƒ½å¦‚ä½•ï¼Ÿæ•…éšœæ¢å¤é€Ÿåº¦æ€Žä¹ˆæ ·ï¼Ÿ

Aï¼šä»Žæ•°æ®å¤‡ä»½æ¢å¤çš„è§’åº¦æ¥è¯´ï¼ŒåŸºæœ¬ä¸Žåœ¨ç‰©ç†æœºä¸Šè·‘ç›¸å½“ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 9 æœˆ 6 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«**å¶å‡¯å³°ï¼Œå”¯å“ä¼šäº‘å¹³å°èµ„æ·±å¼€å‘å·¥ç¨‹å¸ˆã€‚åå¹´ IT è¡Œä¸šå·¥ä½œç»éªŒï¼Œå¼€å‘è€å¸æœºï¼Œæˆé•¿åœ¨çˆ±ç«‹ä¿¡ï¼Œæµ‹è¯•ç•Œä¸Žå¼€å‘ç•Œéƒ½æ‰“æ‹¼è¿‡ã€‚æŠ€æœ¯å®žçŽ°å´‡å°š"Simple is the best"ï¼Œ"ä¸ä»¥è§£å†³é—®é¢˜ä¸ºç›®çš„çš„æŠ€æœ¯å¼•è¿›å°±æ˜¯è€æµæ°“"ã€‚çŽ°åœ¨ä¸“æ³¨ OpenStackã€Docker ç­‰äº‘è®¡ç®—ç›¸å…³æŠ€æœ¯çš„è®¾è®¡ä¸Žå¼€å‘å·¥ä½œï¼Œè´Ÿè´£ Docker æ•´ä½“æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡ã€å®¹å™¨ç½‘ç»œã€ç›‘æŽ§ã€æ—¥å¿—ã€æ“ä½œç³»ç»Ÿç­‰æ–¹é¢ï¼Œä¸ºå…¬å¸äº‘è®¡ç®—æŠ€æœ¯åŸºç¡€è®¾æ–½æ¼”è¿›æä¾›æ”¯æŒã€‚**ã€‚

---

### 2016-09-08ï¼šäº‘è®¡ç®—åº”ç”¨æŠ€æœ¯å‘å±•ä¸Žä¼ä¸šå¼‚æž„èµ„æºæ± ç»Ÿä¸€ç®¡ç†æ¡ˆä¾‹åˆ†æž

> Qï¼šCMP æ€Žæ ·å®žçŽ°æ˜“æž„å¤šèµ„æºæ± ç®¡ç†ï¼Œä¸€ä¸ª OpenStackï¼Œä¸€ä¸ª VMwareï¼Ÿ

Aï¼šCMP é’ˆå¯¹æ¯ç§ç±»åž‹çš„èµ„æºæ± æä¾›ç‰¹å®šçš„ driverï¼Œå½“å‰ 4.0 ç‰ˆæœ¬å·²ç»æ”¯æŒ CloudStackã€OpenStackã€VMwareï¼Œå…¬æœ‰äº‘æ”¯æŒé˜¿é‡Œäº‘ã€Amazon ç­‰ã€‚

> Qï¼šCloudStack å’Œ OpenStack ä¹Ÿå±žäºŽäº‘ç®¡å¹³å° ä¸Šå±‚å¥— SkyForm çš„å®šä½ä¹Ÿæ˜¯äº‘ç®¡å¹³å°è¿™æ ·åšçš„åŽŸå› æ˜¯ä»€ä¹ˆï¼Ÿä¼šä¸ä¼šæœ‰äº›è‡ƒè‚¿æˆ–æ˜¯åœ¨åŠŸèƒ½ä¼šæœ‰å†²çªï¼Ÿ

Aï¼šå¯¹ SkyForm CMP æ¥è¯´ï¼ŒOpenStack å’Œ CloudStack åªæ˜¯ä¸€ä¸ªè™šæ‹ŸåŒ–èµ„æºæ± ã€‚SkyForm CMP æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ç®¡ç†å¹³å°ï¼Œä¸ä»…èƒ½ç®¡ç†ä¸åŒç±»åž‹çš„è™šæ‹ŸåŒ–èµ„æºæ± ï¼Œä¼ä¸šç‰ˆ CMP å¹³å°è¿˜èƒ½ç®¡ç†ç‰©ç†æœºèµ„æºæ± ã€‚

> Qï¼šè¯·é—® OpenStack çš„ Keystoneã€Glanceã€Neutron åˆ†åˆ«ä¸Ž VMware å¦‚ä½•ç»“åˆçš„ï¼Ÿ

Aï¼šè¿™ä¸ªé¡¹ç›®çš„ OpenStack èµ„æºæ± ä¸­ï¼Œæˆ‘ä»¬åªä½¿ç”¨äº† KVMã€‚VMware æ˜¯æœ€ä¸ºä¸€ä¸ªå’Œ OpenStack å¹³çº§çš„è™šæ‹ŸåŒ–èµ„æºæ± ã€‚SkyForm CMP åœ¨ä¸Šå±‚ç®¡ç†ç½‘ç»œå’Œé•œåƒã€‚SkyForm CMP å’Œ OpenStack ä½¿ç”¨åŒä¸€å¥— Keystoneã€‚

> Qï¼šçœ‹åˆ°å›¾ä¾‹é‡Œé¢ SkyForm ä¹Ÿæ”¯æŒ Docker å®¹å™¨ å¼€å§‹ä¹Ÿæåˆ°å®¢æˆ·çš„ VM ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ä¸ºä½•ä¸å»ºè®®ç”¨æˆ·ç”¨å®¹å™¨å–ä»£ä¸€éƒ¨åˆ†è™šæ‹Ÿæœºçš„å·¥ä½œå‘¢ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œæˆ‘ä»¬å·²ç»æ”¯æŒå®¹å™¨äº†ã€‚ä½¿ç”¨è™šæ‹Ÿæœºä¸»è¦æ˜¯ç”¨æˆ·ä¸šåŠ¡å†³å®šäº†ï¼Œè¿™ä¸ªé¡¹ç›®ç”¨æˆ·çš„ç¨‹åºéƒ½åœ¨è™šæ‹Ÿæœºé‡Œé¢è·‘çš„ï¼Œè¿˜æ²¡æœ‰å®¹å™¨åŒ–ã€‚

> Qï¼šé•œåƒå¯ä»¥è·¨å¹³å°ï¼Œè·¨èµ„æºæ± ä½¿ç”¨å—ï¼Ÿ

Aï¼šé•œåƒæ˜¯ä¸èƒ½è·¨å¹³å°çš„ï¼Œæ¯”å¦‚ VMware çš„é•œåƒæ˜¯ OVAï¼ŒKVM çš„é•œåƒæ˜¯ qcow2ï¼Œæ˜¯æ— æ³•ç›´æŽ¥ä½¿ç”¨çš„ã€‚è¡¥å……ä¸€ä¸ªåŠŸèƒ½ï¼ŒCMP æ”¯æŒä½¿ç”¨ IOS åˆ›å»ºè™šæ‹Ÿæœºã€‚

> Qï¼šå¥½å¤š OpenStack ç‰ˆæœ¬ä¸­ä¸æ”¯æŒå…‹éš†å’Œå¿«ç…§ï¼ŒSkyForm CMP æ˜¯å¦å®Œå–„è¿‡è¿™äº›åŠŸèƒ½å‘¢ï¼Ÿ

Aï¼šå¯¹äºŽ VMware èµ„æºæ± å’Œ CloudStack èµ„æºæ± ï¼Œå¿«ç…§å’Œå…‹éš†åŠŸèƒ½å·²ç»æ”¯æŒã€‚OpenStack æˆ‘ä»¬æœ‰ä¿®æ”¹è¿‡ï¼Œæ”¯æŒ Ceph å­˜å‚¨çš„å¿«ç…§ï¼Œå¯¹äºŽ san å­˜å‚¨è¿˜éœ€è¦çœ‹å…·ä½“è®¾å¤‡äº†ã€‚

> Qï¼šè¿™å®¶çš„ OpenStack ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç‰ˆæœ¬çš„ OpenStackï¼Œä¸Šåˆ°ç”Ÿäº§çŽ¯å¢ƒäº†ä¹ˆ ï¼Ÿ

Aï¼šå…ˆåŽæœ‰ I ç‰ˆå’Œ K ç‰ˆä¸Šçº¿ã€‚æ˜¯ç”Ÿäº§çŽ¯å¢ƒã€‚

> Qï¼šVMware å°šä¸å…·å¤‡ SDNï¼ŒOpenStack å…·å¤‡ SDN è¿™å—æ˜¯æ€Žä¹ˆè¡¥é½çš„å‘¢ï¼Ÿ

Aï¼šSkyForm CMP æ”¯æŒ VMware åˆ†å¸ƒå¼äº¤æ¢æœºï¼Œå¯ä»¥å®žçŽ°åŸºæœ¬çš„ç½‘ç»œéš”ç¦»å’ŒæŽ§åˆ¶éœ€æ±‚ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œç”¨æˆ·è™šæ‹Ÿæœºéƒ½åœ¨å®¢æˆ·ä¼ä¸šå†…ç½‘ï¼Œè™šæ‹Ÿæœºç½‘å…³ç›´æŽ¥ä½¿ç”¨ç½‘ç»œè®¾å¤‡ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 9 æœˆ 8 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**é«˜é“­ï¼Œå¤©äº‘è½¯ä»¶é«˜çº§å®žæ–½æž¶æž„å¸ˆã€‚ä»Žäº‹ SkyForm äº‘ç®¡ç†å¹³å°çš„å®žæ–½ä¸ŽæŠ€æœ¯æ”¯æŒå·¥ä½œã€‚å¯¹ VMware vSphereã€Citrix XenServerã€KVMã€CloudStackã€OpenStack æœ‰è¾ƒå¤šçš„å®žæ–½éƒ¨ç½²ä¸Žè¿ç»´ç»éªŒã€‚

---

### 2016-08-28ï¼šåŸºäºŽå®¹å™¨æŠ€æœ¯æž„å»ºä¼ä¸šçº§ PaaS äº‘å¹³å°å®žè·µ

> Qï¼šå¼¹æ€§æ‰©å®¹çš„æ—¶å€™æ€Žä¹ˆåŒºåˆ†éœ€è¦åž‚ç›´æ‰©å®¹è¿˜æ˜¯æ°´å¹³æ‰©å®¹ï¼Ÿ

Aï¼šè‡ªåŠ¨æ‰©å®¹æ˜¯æ°´å¹³æ‰©å®¹ï¼Œæ ¹æ®å¹¶å‘é‡ã€CPUã€å†…å­˜çš„å®žæ—¶æ•°æ®åˆ†æžæ¥å®žçŽ°ã€‚

> Qï¼šæ‰€æœ‰çš„æ‰©å®¹éƒ½æ˜¯æ°´å¹³æ‰©å®¹å—ï¼Ÿä¸å¤ªæ¸…æ¥šè‡ªåŠ¨åŒ–çš„åž‚ç›´æ‰©å®¹åº”è¯¥æ€Žä¹ˆåˆ¤æ–­ï¼Œæœ‰ä»€ä¹ˆæƒ³æ³•ä¸ï¼Ÿ

Aï¼šç›®å‰æ‰€æœ‰æ‰©å®¹éƒ½æ˜¯æ°´å¹³æ‰©å±•ï¼Œè¦åž‚ç›´æ‰©å±•åªèƒ½æ‰‹åŠ¨ï¼ŒåŽŸå› æ˜¯åž‚ç›´æ‰©å±•å˜æ›´å†…å­˜ã€CPU åŽæœ‰äº›æƒ…å†µä¸‹éœ€è¦é‡æ–°è¿›è¡Œå®žä¾‹åˆ†å¸ƒã€‚

> Qï¼šæ°´å¹³æ‰©å®¹åªæ˜¯å¢žåŠ å®žä¾‹å°±å¯ä»¥äº†ï¼Œå¯¹å§ã€‚ç¼©å®¹å‘¢ï¼Œæ€Žä¹ˆåˆ¤æ–­å‘¢ï¼Ÿ

Aï¼šç¼©å®¹ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæ ¹æ®æœ€è¿‘ 10 ç§’å†…çš„å¹¶å‘é‡å†³å®šéœ€è¦å¤šå°‘ä¸ªå®žä¾‹ã€‚

> Qï¼šçŽ°åœ¨æ‰©å®¹çš„ä¾æ®æ˜¯åŸºç¡€ç›‘æŽ§æ•°æ®å’Œä¸šåŠ¡çš„ç›‘æŽ§æ•°æ®åŒæ—¶è€ƒè™‘å—ï¼Ÿ

Aï¼šç›®å‰å¹³å°ä¸»è¦åŸºäºŽåŸºç¡€ç›‘æŽ§æ•°æ®æ¥è¿›è¡Œæ‰©å®¹ï¼Œä¸šåŠ¡æ•°æ®å¦‚æžœä¹Ÿæ˜¯å¯¼è‡´åº”ç”¨æ€§èƒ½ç“¶é¢ˆçš„ä¸€ä¸ªå› ç´ çš„è¯ï¼Œçº³å…¥åˆ°æ‰©å®¹ç­–ç•¥é‡Œé¢ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•ã€‚

> Qï¼šæ•°æ®å…±äº«å·çš„è§£å†³æ–¹æ¡ˆæ˜¯å¦‚ä½•è€ƒè™‘çš„ï¼ŒåŸºäºŽ cinder è¿˜æ˜¯ cephï¼Œåˆ›å»ºä¸ªæ•°æ®å…±äº«å·è¦å…ˆæ ¼å¼åŒ–åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ä½•å®žçŽ°å’Œ node èŠ‚ç‚¹æŒ‚è½½å‰çš„å‰æ ¼å¼åŒ–çš„ï¼Œnode èŠ‚ç‚¹æ•…éšœï¼Œå®¹å™¨å‘ç”Ÿé‡ç”Ÿå…±äº«å·å¦‚ä½•æŒ‚è½½åˆ°æ–°èŠ‚ç‚¹ä¸Šå‘¢ï¼Ÿ

Aï¼šå…±äº«å·æ˜¯ç›´æŽ¥æŒ‚åˆ°å®¹å™¨ä¸Šçš„ï¼Œä¸æ˜¯æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Šï¼ŒGlusterfsã€Cephã€NFS ç­‰éƒ½æ”¯æŒã€‚

> Qï¼šç°åº¦å‘å¸ƒåŠŸèƒ½ï¼Œç›®å‰æˆ‘ç†è§£çš„æ˜¯åˆ†ä¸ºæ»šåŠ¨å‡çº§å’Œ AB æµ‹è¯•ï¼Œè¿™ä¸ªç›®å‰å®žçŽ°çš„é‚£ç§ï¼ŒAB æµ‹è¯•å…·ä½“å¦‚ä½•ç†è§£å‘¢ï¼Ÿ

Aï¼šæ‚¨è¯´çš„æ˜¯è“ç»¿å‘å¸ƒå—ï¼Ÿè“ç»¿å‘å¸ƒåº”è¯¥æ˜¯ä¿è¯æ— å®•æœºçš„å‰æä¸‹ï¼Œå°†è€ç‰ˆæ›´æ–°åˆ°æ–°ç‰ˆã€‚

> ï¼±ï¼šè¯·é—®ï¼ŒKubernetes ä¸­çš„ A åŸŸåæŒ‡å‘ä¸€ä¸ªåº”ç”¨ï¼ŒB åŸŸåæŒ‡å‘å¦å¤–ä¸€ä¸ªåº”ç”¨ï¼Œéƒ½è¦ç”¨åˆ° 80 å’Œ 443 ç«¯å£ï¼Œè¿™ä¸ªè¯¥æ€Žä¹ˆåšå‘¢ï¼Ÿ

---

### 2016-08-25ï¼šä¸­è‹±äººå¯¿ä¿é™©æœ‰é™å…¬å¸åŸºäºŽå®¹å™¨æŠ€æœ¯çš„å®žè·µåˆ†äº«

> Qï¼šæ‚¨å¥½ï¼ŒçŽ°åœ¨åŸºäºŽå®¹å™¨çš„è§£å†³æ–¹æ¡ˆä¹Ÿæœ‰å¾ˆå¤šï¼Œæˆ‘æƒ³äº†è§£ä¸‹éƒ¨ç½²åŽï¼Œä½ ä»¬æ˜¯å¦‚ä½•è®¾ç½®ç›‘æŽ§ç³»ç»Ÿçš„ï¼Œå¦‚æžœç›‘æŽ§å®¹å™¨ï¼Œå¯èƒ½ä¼šå› ä¸ºå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸä¸å›ºå®šï¼Œå¯¼è‡´éƒ¨åˆ†ç›‘æŽ§æ•°æ®ä¼šéšç€å®¹å™¨æ¶ˆå¤±ï¼Œå˜æˆæ— ç”¨æ•°æ®ï¼›å¦‚æžœé€šè¿‡å®¿ä¸»æœºç›‘æŽ§ï¼Œé‚£ä¹ˆä½ ä»¬æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼å®žçŽ°çš„ï¼Œæ˜¯é€šè¿‡è‡ªè¡Œå¼€å‘ï¼Œè¿˜æ˜¯ç¬¬ä¸‰æ–¹å¼€æºç¨‹åºï¼Œå¦‚ä½•åšåˆ°èµ„æºã€åº”ç”¨æ•°æ®çš„å‡†ç¡®æ”¶é›†å’Œåˆå¹¶ï¼Ÿ

Aï¼šæ‚¨æçš„é—®é¢˜ä¹Ÿæ˜¯å®žè·µä¸­æœ€æ‹…å¿ƒä¸€äº›é—®é¢˜ï¼Œç”±äºŽå®¹å™¨çš„æŠ€æœ¯å˜åŒ–å¾ˆå¿«ï¼Œç›®å‰ç›‘æŽ§æ–¹é¢çš„é—®é¢˜æˆ‘ä»¬æ›´å¤šä½¿ç”¨ç¬¬ä¸‰æ–¹åŽ‚å•†æä¾›çš„è½¯ä»¶è¿›è¡Œç›‘æŽ§ã€‚ ä¿é™©å…¬å¸ IT æœ¬èº«å¯¹å®¹å™¨ç›¸å…³æŠ€æœ¯ï¼Œæ›´å¤šç›®å‰è¿˜æ˜¯å¤„åœ¨æ‘¸ç´¢å’Œç†Ÿæ‚‰é˜¶æ®µã€‚æˆ‘ä»¬æ›´å¤šæŠŠå®¹å™¨ä½œä¸ºä¸€ç§çµæ´»çš„å·¥å…·ï¼Œå› æ­¤å¯¹äºŽåŽå°ç®¡ç†å’Œç›‘æŽ§ï¼Œæ²¡æœ‰ä½¿ç”¨ Docker è‡ªå¸¦çš„å·¥å…·ã€‚

> Qï¼šè¯·é—®åœ¨ Docker åŒ–è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°çš„æœ€å¤§çš„éš¾é¢˜æ˜¯ä»€ä¹ˆï¼Œæœ€åŽæ˜¯æ€Žä¹ˆè§£å†³çš„ï¼Ÿè°¢è°¢ï¼

Aï¼šæœ€å¤§å›°éš¾è¿˜æ˜¯å¯¹å®¹å™¨çš„ç†è§£é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯ç®¡ç†å±‚åŠè¿ç»´å¼€å‘å®žé™…æ“ä½œäººå‘˜å¦‚ä½•ç†è§£å®¹å™¨ã€‚å®žé™…å®¹å™¨ 2015 å¹´ä¸‹åŠå¹´æˆ‘ä»¬å°±æƒ³ä½¿ç”¨ï¼Œä½†è€ƒè™‘åˆ°å®žé™…çš„æŽ¨å¹¿å›°éš¾ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ä¸€ç›´åœ¨æ‰¾åˆé€‚çš„æœºä¼šï¼Œç›´åˆ°æœ‰åˆé€‚æœºä¼šæ‰ä¼šçœŸæ­£å¼€å§‹åº”ç”¨å’ŒæŽ¨å¹¿ã€‚æˆ‘åœ¨åˆ†äº«ä¸­ä¹Ÿæåˆ°äº†ï¼Œè°¨æ…ŽåŽŸåˆ™ï¼Œå› ä¸ºä¸€æ—¦ç¬¬ä¸€æ­¥æŽ¨å¹¿éƒ¨é¡ºåˆ©ï¼Œé‚£ä¹ˆåŽç»­å›°éš¾å°±å¾ˆå¤§ã€‚æ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸€æ­¥å¹¶æ²¡æœ‰ç»™è‡ªå·±è®¢ç«‹å¤ªé«˜ç›®æ ‡ã€‚

> Qï¼šè§„æ¨¡ä¸ŠåŽ»åŽï¼Œå®¹å™¨å¦‚ä½•è‡ªåŠ¨åŒ–çš„ç®¡ç†å’Œå®¹å™¨é…ç½®æ–‡ä»¶å¦‚ä½•è‡ªåŠ¨åŒ–ç®¡ç†ï¼Ÿè°¢è°¢ï¼

Aï¼šè§„æ¨¡é—®é¢˜æ›´å¤šè¦çœ‹è‡ªèº«æƒ…å†µï¼Œç›®å‰æ›´å¤šä»‹ç»ä¸Šéƒ½åœ¨å¼ºè°ƒå®¹å™¨åœ¨è§„æ¨¡ä¸Šçš„ä¼˜åŠ¿ã€‚ä½†æ­£å¦‚æˆ‘å¼€å§‹æçš„ï¼Œå®žé™…åœ¨ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œè§„æ¨¡æœ¬èº«æ˜¯éšç€ä¸šåŠ¡å‘å±•è€Œå¢žé•¿çš„ã€‚æˆ‘ä»¬ç›®å‰è€ƒè™‘å°±æ˜¯éšç€è§„æ¨¡çš„å¢žé•¿ï¼Œè‡ªèº«å¯¹å®¹å™¨çš„ä½¿ç”¨å’Œç»éªŒç§¯ç´¯ä¹Ÿä¼šéšä¹‹å¢žé•¿ã€‚åŒæ—¶å¯¹äºŽæˆ‘ä»¬è¿™æ ·çš„å¯¿é™©å…¬å¸æ¥è¯´ï¼Œæ›´å¤šé‡‡ç”¨å•†ä¸šè§£å†³æ–¹æ¡ˆã€‚è¿™æ ·æœ‰æ¯”è¾ƒæŒç»­å¯é çš„é•¿æœŸæ”¯æŒï¼Œæ¯•ç«Ÿè¿™ä¸ªæŠ€æœ¯å˜åŒ–å¾ˆå¿«ï¼Œæˆ‘ä»¬æ›´å¤šå…³æ³¨çµæ´»æ€§å’Œæˆ‘ä»¬é€‰å®šçš„ä¼˜åŠ¿çš„å‘æŒ¥ã€‚è‡ªåŠ¨åŒ–ç®¡ç†å’Œå®¹å™¨é…åˆ¶æ–‡ä»¶ï¼Œåªè¦é¡¹ç›®éƒ¨æ˜¯å¾ˆå¤šï¼Œé‚£ä¹ˆé—®é¢˜ä¸å¤§ã€‚å¦‚æžœæ™®éæŽ¨å¹¿çš„è¯ï¼ˆè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸‹ä¸€æ­¥è®¡åˆ’ï¼‰é‚£ä¹ˆå¼€å‘å’Œè¿ç»´äººå‘˜è‡ªèº«çš„èƒ½åŠ›æé«˜æ˜¯è§£å†³è‡ªåŠ¨åŒ–çš„å…³é”®ï¼Œè€Œä¸åªæ˜¯è½¯ä»¶ã€‚

> Qï¼šæ‚¨å¥½ï¼Œèƒ½å¦ä»‹ç»ä¸‹å¾®æœåŠ¡æŠ€æœ¯æ”¹é€ æ–¹é¢çš„ç»éªŒï¼Œå°¤å…¶æ˜¯æ•°æ®æ‹†åˆ†æ–¹é¢ï¼Œå¦‚ä½•ç ´é™¤æ•°æ®åº“ä¹‹é—´çš„è¡¨ä¾èµ–ï¼Œæ¯”å¦‚åœ¨å•ä½“åº”ç”¨é‡Œå¾ˆå¤šåŠŸèƒ½éƒ½æ˜¯ç›´æŽ¥é€šè¿‡æ•°æ®åº“çš„å…³è”æŸ¥è¯¢å®žçŽ°çš„ï¼Œå¦‚æžœè¿›è¡Œå¾®æœåŠ¡æ”¹é€ ï¼Œæ€Žä¹ˆå¤„ç†ç±»ä¼¼çš„å…³è”æŸ¥è¯¢ï¼Ÿå¦å¤–ï¼Œèƒ½å¦ä»‹ç»åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†çš„æŠ€æœ¯æ–¹æ¡ˆï¼Ÿ

Aï¼šæ•°æ®éƒ¨åˆ†æˆ‘åˆ†æ®µæ¥å›žç­”ä¸€ä¸‹ã€‚æ•°æ®æ‹†æœ¬èº«æ›´å¤šæ˜¯ IT å¯¹ä¸šåŠ¡çš„ç†è§£é—®é¢˜ï¼Œä¸­è‹± IT åœ¨è¿™æ–¹é¢æ˜¯æ¯”è¾ƒæ“…é•¿çš„ï¼Œæ¯•ç«Ÿæ˜¯è‡ªå·±çš„ä¸šåŠ¡ã€‚è¿™ç‚¹é¦–å…ˆæˆ‘è®¤ä¸ºæ²¡æœ‰ä»€ä¹ˆé€šç”¨è§£å†³æ–¹æ¡ˆï¼Œå¿…é¡»æ ¹æ®å®žé™…è‡ªèº«æƒ…å†µæ¥è€ƒè™‘ã€‚ä¸­è‹±æƒ…å†µæˆ‘æŽ¥ç€ä»‹ç»ä¸€ä¸‹ã€‚\ å…³è”æŸ¥è¯¢é—®é¢˜ä¼šå¾ˆå¤šï¼Œç‰¹åˆ«æ˜¯æ€§èƒ½ã€‚æ‰€ä»¥æˆ‘ä¹Ÿæåˆ°ï¼Œè¿™ç‚¹å…‰ç”¨æŠ€æœ¯è§£å†³æ–¹æ¡ˆå¾ˆéš¾è§£å†³ï¼Œå¿…é¡»ç»“åˆä¸šåŠ¡é€»è¾‘ï¼Œè€ƒè™‘å¦‚ä½•æŠŠæ•°æ®å‰æŽ¨ã€‚å…³äºŽåˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†ï¼Œç›®å‰æˆ‘ä»¬ä¸å»ºè®®é‡‡ç”¨åˆ†å¸ƒå¼çš„äº‹åŠ¡ç®¡ç†ï¼Œé‚£æ ·åªä¼šå¸¦æ¥æ›´å¤æ‚çš„é€»è¾‘å…³ç³»ã€‚æˆ‘ä»¬æœ€å¤šæ˜¯è€ƒè™‘ Redis çš„é›†ç¾¤éƒ¨ç½²ï¼Œä½†äº‹åŠ¡å¤„ç†éƒ½æ˜¯é›†ä¸­çš„ã€‚å¯¹äºŽå¤æ‚é—®é¢˜ï¼Œæˆ‘ä»¬å°½é‡åŽ»å›žé¿ï¼Œæœ¬èº«é¡¹ç›®å°±æœ‰å¾ˆå¤šæŒ‘æˆ˜ï¼Œä¸å¸Œæœ›åœ¨è¿™æ–¹é¢æœ‰æ›´å¤šä¸ç¨³å®šå› ç´ ã€‚

> Qï¼šæ•°æ®åº“çš„æ•°æ®å‰ç§»åˆ° Redisï¼Œ å¢žåˆ æ”¹ä¹Ÿæ˜¯é€šè¿‡ Redisï¼Ÿ

Aï¼šä¸æ˜¯æ•°æ®åº“å‰ç§»ï¼Œæˆ‘ä»¬ç”±äºŽè€ƒè™‘ä¿¡æ¯å®‰å…¨å’Œåˆè§„çš„è¦æ±‚ï¼Œå®žé™…è¿™æ¬¡æ•°æ®ä¸è½åœ°ã€‚Redis éƒ½æ˜¯ç¼“å­˜æ•°æ®ï¼Œè€Œä¸”ä¸å†™æ–‡ä»¶ç³»ç»Ÿã€‚åªç”¨ä½œæŸ¥è¯¢ï¼Œå¯¹åŽå°æ•°æ®çš„æ›´æ–°åˆ é™¤ï¼Œè¿˜æ˜¯é‡‡ç”¨è¿œç¨‹è°ƒç”¨æœåŠ¡çš„æ–¹å¼ã€‚æ ¹æ®ä¸šåŠ¡åˆ†æžï¼Œæˆ‘ä»¬çš„åº”ç”¨ç»å¤§å¤šæ•°æ˜¯æŸ¥è¯¢ï¼Œå› æ­¤é¦–å…ˆä¿è¯æŸ¥è¯¢é€Ÿåº¦ã€‚

> Qï¼šå¦‚æžœé€šè¿‡æœåŠ¡è°ƒç”¨çš„æ–¹å¼

æ›´æ–°åŽå°æ•°æ®çš„è¯ï¼Œæ€Žä¹ˆåšåˆ°äº‹åŠ¡çš„é›†ä¸­ç®¡ç†çš„å‘¢ï¼Ÿ

Aï¼šç”±äºŽå¯¿é™©å…¬å¸æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿéƒ½æ˜¯é›†ä¸­ç³»ç»Ÿï¼Œäº‹åŠ¡å¤„ç†ä¸€å¼€å§‹å°±æ ¹æ®ä¸šåŠ¡æ¨¡å—å’Œé€»è¾‘åšäº†åˆ’åˆ†ã€‚å› æ­¤åœ¨å†…éƒ¨æœ¬èº«å°±æ˜¯äº‹åŠ¡é€»è¾‘éžå¸¸ä¸¥æ ¼æŽ§åˆ¶ã€‚è¿™é‡Œé¦–å…ˆæ˜¯ä¸šåŠ¡é€»è¾‘å°±æœ‰ä¸¥æ ¼çš„å‰åŽé€»è¾‘é¡ºåºï¼Œä»€ä¹ˆå‰æä¸‹èƒ½åšä»€ä¹ˆä¸èƒ½åšä»€ä¹ˆæœ‰ä¸¥æ ¼åˆ’åˆ†çš„ã€‚åœ¨ DB å±‚é¢çš„äº‹åŠ¡ï¼Œæˆ‘ä»¬ DB æœ¬èº«å°±æ˜¯é›†ä¸­ DBï¼Œä¸æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå› æ­¤ DB æœ¬èº«æŽ§åˆ¶äº‹åŠ¡ï¼Œä¸å­˜åœ¨æŽ§åˆ¶ä¸ä½çš„æƒ…å†µã€‚ä½†å¦‚æžœè°ƒç”¨å¤ªå¤šï¼Œçš„ç¡®ä¼šæœ‰ä¸¥é‡é”çš„é—®é¢˜ï¼Œè¿™ç‚¹åè€Œæ˜¯æˆ‘ä»¬æ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜ã€‚åŒæ—¶é¦–å…ˆä¸šåŠ¡æ—¶æ—¶äº¤äº’é¢‘çŽ‡ä¸æ˜¯é‚£ä¹ˆé«˜ï¼Œå› ä¸ºä¸åƒç”µå•†ï¼Œè¿™ä¸ªé—®é¢˜ä¸çªå‡ºã€‚

> Qï¼šè§„æ¨¡ä¸ŠåŽ»åŽï¼Œæœ‰æ²¡æœ‰æµ‹è¯•è¿‡æ€§èƒ½æ–¹é¢çš„åœºæ™¯ï¼Œæ¯”å¦‚æŸç§é…ç½®çš„ç‰©ç†è®¾å¤‡ï¼Œå¯ä»¥è´Ÿè½½å¤šå°‘å®¹å™¨ï¼Œæ€§èƒ½ç›¸å…³æŒ‡æ ‡å¦‚ä½•ï¼Ÿè°¢è°¢ï¼

Aï¼šç›®å‰æˆ‘ä»¬è¿˜æ²¡æœ‰è¿™æ–¹é¢å®žé™…çš„ç»éªŒã€‚ä½†åœ¨å®žæ–½ä¸­è€ƒè™‘åˆ°è§„æ¨¡çš„é—®é¢˜ï¼Œå› æ­¤è¿™æ¬¡å®žé™…é€‰æ‹©çš„å°±æ˜¯å…¬ç”¨äº‘ï¼Œç›´æŽ¥ä½¿ç”¨äº‘çš„åŸºç¡€æœåŠ¡ã€‚å¦å¤–å…³äºŽæ€§èƒ½å’Œç‰©ç†é…åˆ¶ã€‚è¿™ç‚¹ï¼Œè‡³å°‘ç›®å‰æˆ‘ä»¬é‡åˆ°çš„ä¸»è¦é—®é¢˜æ˜¯å†…å­˜ä¸æ˜¯ CPUã€‚åˆç†åˆ†é…å†…å­˜æ˜¯ä¸ªç»éªŒç§¯ç´¯çš„è¿‡ç¨‹,æˆ‘åœ¨åˆ†äº«é‡Œä¹Ÿæåˆ°äº†ï¼Œæˆ‘ä»¬é‡åˆ°äº†å› ä¸ºé…åˆ¶ä¸åˆç† ELK æ€§èƒ½éžå¸¸å·®çš„æƒ…å†µï¼Œåè€Œåº”ç”¨çŽ¯å¢ƒæœ¬èº«æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ç”±äºŽæˆ‘ä»¬åœ¨è§„æ¨¡ä¸Šæ²¡æœ‰å¤ªå¤šç»éªŒï¼Œå› æ­¤ä¸èƒ½ç»™æ‚¨æ›´å¤šçš„æœ‰ç”¨å»ºè®®ï¼Œè¿™ç‚¹äº’è”ç½‘ä¼ä¸šåº”è¯¥æ›´æœ‰ç»éªŒã€‚

> Qï¼šæ‚¨å¥½ï¼Œè¯·é—®ä½ ä»¬å…¬å¸æ˜¯å¦å­˜åœ¨ä¸€äº› Windows åº”ç”¨ï¼Œé’ˆå¯¹è¿™äº›åº”ç”¨å¦‚ä½•ä½¿ç”¨å®¹å™¨ç»Ÿä¸€éƒ¨ç½²ç®¡ç†ï¼Ÿ

Aï¼šæˆ‘ä»¬æœ‰ Windows åº”ç”¨ï¼Œè‡³å°‘ç›®å‰æˆ‘è®¤ä¸ºç”¨ Docker æ¥ç»Ÿä¸€éƒ¨ç½² Windows åº”ç”¨ä¸å¤ªåˆé€‚ï¼Œæˆ‘ä»¬å†…éƒ¨å¦‚æžœæœ‰è¿™ä¸ªè¦æ±‚ä¼šé€‰æ‹© VMï¼ŒVBOX ä¹Ÿæ˜¯ä¸é”™é€‰æ‹©ã€‚

> Qï¼šæ‚¨æåˆ°ä¸è¿‡åˆ†å¼ºè°ƒæµ‹è¯•è‡ªåŠ¨åŒ–ï¼Œå°½é‡ä¸æ”¹å˜æµ‹è¯•æµç¨‹ï¼Œé‚£ä¹ˆå¯¹äºŽè‡ªåŠ¨æž„å»ºå’Œå•å…ƒæµ‹è¯•çš„è‡ªåŠ¨åŒ–æœ‰æ²¡æœ‰è€ƒè™‘å‘¢ï¼Ÿæ¯•ç«Ÿè¿™äº›æ˜¯æ¯”è¾ƒæ¶ˆè€—äººåŠ›çš„éƒ¨åˆ†ã€‚

Aï¼šè‡ªåŠ¨æž„å»ºæˆ‘è®¤ä¸ºæ¯”è¾ƒçŽ°å®žï¼Œå•å…ƒæµ‹è¯•æœ‰è€ƒè™‘ã€‚ä¸è¿‡æˆ‘ä»¬æµ‹è¯•æ¡ˆä¾‹è¿‡äºŽå¤æ‚ï¼Œç›®å‰çœ‹çŸ­æœŸå®žçŽ°ä¸å¤ªçŽ°å®žã€‚è€Œä¸”æ€§èƒ½ä¹Ÿæ˜¯ä¸ªé—®é¢˜ï¼Œå¦‚æžœä¸‹ä¸€æ­¥è¦åšæˆ‘ä»¬ä¼šæ›´å¤šè€ƒè™‘ä¸€äº›ç‰¹å®šåœºæ™¯ã€‚æ¯”å¦‚äº§å“å‘å¸ƒåŽçš„å›žå½’æµ‹è¯•ï¼Œè¿™ä¸ªæœ‰å¯èƒ½ï¼Œä½†ä¸ä¼šæ˜¯æ™®éåº”ç”¨ã€‚

> Qï¼šè¿™æ¬¡å®¹å™¨åŒ–æ”¹é€ åŽï¼Œå¯¹æ¯”åŽŸæ¥çš„ç³»ç»Ÿæœ‰å“ªäº›æ–¹é¢å…·ä½“çš„æå‡å‘¢ï¼Ÿ

Aï¼šæ€§èƒ½æœ¬èº«æˆ‘è®¤ä¸ºå’Œå®¹å™¨æ²¡ä»€ä¹ˆå…³ç³»ï¼Œè™½ç„¶è¿™æ¬¡æ€§èƒ½æœ‰å¾ˆå¤§æå‡ï¼Œä½†æ›´å¤šæ˜¯å› ä¸ºç”¨äº†å…¬æœ‰äº‘å’Œ Redis åšç¼“å­˜ã€‚å®¹å™¨æ”¹é€ åŽæœ€å¤§æå‡çš„æˆ‘è®¤ä¸ºç›®å‰æ˜¯éƒ¨ç½²å’Œæ›´æ–°çš„æ•ˆçŽ‡ã€‚å¯¹è¿ç»´å·¥ä½œæ•ˆçŽ‡æœ‰éžå¸¸å¤§çš„æå‡ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†åº”ç”¨çŽ¯å¢ƒçš„æ›´æ–°éƒ½è‡ªåŠ¨åŒ–äº†ã€‚è¿™ç‚¹æœ¬è´¨æ€§å˜åŒ–ã€‚

> Qï¼šè¯·é—®ä¸­è‹±äººå¯¿åº”ç”¨æ›´æ–°çš„è‡ªåŠ¨åŒ–æµç¨‹èƒ½åšäº›ä»‹ç»å—ï¼Œæœ‰æ²¡æœ‰å°†åº”ç”¨å’Œé…ç½®åˆ†ç¦»åšæ”¹é€ ï¼Ÿ

Aï¼šæˆ‘ä»¬è¿™æ¬¡æ˜¯ä¸ªå…¨æ–°é¡¹ç›®ï¼Œæ‰€ä»¥ä¸æ¶‰åŠæ”¹é€ ã€‚è‡ªåŠ¨åŒ–éƒ¨åˆ†å°±æ˜¯æ ‡å‡†çš„æŒç»­é›†æˆ Git+Jenkins çš„è‡ªåŠ¨åŒ–ç®¡é“ã€‚Git æ ¹æ®çŽ¯å¢ƒåšäº†ä¸€äº›åˆ†æ”¯ï¼Œéƒ¨ç½²ç›´æŽ¥é‡‡ç”¨ Docker æ–¹å¼ã€‚è¿™æ˜¯ä¸€æ•´å¥—çš„ã€‚Docker ç›¸å…³é…åˆ¶ç›®å‰æ˜¯åœ¨ cSphere é‡Œåšç®¡ç†ï¼Œå®žé™…æˆ‘ä»¬æ²¡å¤ªå¤šæ“å¿ƒè¿™ä¸ªéƒ¨åˆ†ã€‚å¯¹äºŽå¼€å‘æ¥è¯´å®žé™…æ²¡ä»€ä¹ˆå¤ªå¤§å˜åŠ¨ã€‚åªæ˜¯è‡ªåŠ¨åŒ–æž„å»ºåšé€šäº†ã€‚

> Qï¼šæ˜¯å¦å»ºè®®ä¼ä¸šæœ€ä½³å®žè·µæ˜¯ä»Žæ–°å¼€å‘æˆ–é‡æž„åº”ç”¨å¼€å§‹å®¹å™¨åŒ–ï¼Ÿ

Aï¼šè¿™æ˜¯ä¸ªæœ€ä¿é™©æ–¹æ³•ï¼Œä½†æˆ‘è®¤ä¸ºé‡ç‚¹ä¸æ˜¯å…¨æ–°æˆ–è€…é‡æž„ã€‚è€Œæ˜¯æ˜¯ä¸æ˜¯èƒ½å¸¦æ¥å®žé™…æ•ˆç›Šï¼Œæˆ‘è¯´çš„æ˜¯ä¸šåŠ¡æ•ˆæžœã€‚å¯¹äºŽç”¨æˆ·æ¥è¯´å®žé™…å¹¶ä¸äº†è§£å’Œå…³å¿ƒå®¹å™¨æŠ€æœ¯ï¼Œæƒ³æŽ¨å¹¿ä¸€ä¸ªè¿‡ç”¨æˆ·å…³ï¼Œä¸€ä¸ªè¿‡è¿ç»´å’Œå¼€å‘åè°ƒçš„å…³ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 8 æœˆ 25 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**å¼ ç¦ï¼Œä¸­è‹±äººå¯¿ä¿¡æ¯æŠ€æœ¯éƒ¨æ€»ç»ç†ã€‚ä¸­å¤®è´¢ç»å¤§å­¦ä¿é™©ä¸“ä¸šæ¯•ä¸šï¼Œå…·æœ‰ 15 ä»¥ä¸Šçš„å¯¿é™©ä»Žä¸šç»éªŒã€‚é•¿æœŸä»Žäº‹å¯¿é™©ä¸šåŠ¡åŠä¿¡æ¯æŠ€æœ¯ç›¸å…³å·¥ä½œ**ã€‚

---

### 2016-08-18ï¼šç”¨ Harbor å®žçŽ°å®¹å™¨é•œåƒä»“åº“çš„ç®¡ç†å’Œè¿ç»´

> Qï¼šMaster-Slave çš„é•œåƒæž¶æž„ä¸­,å¦‚æžœ Slave Registy ä¸­çš„é•œåƒè¢«åˆ é™¤äº†ï¼Œä¼šä¸ä¼šå†æ¬¡è‡ªåŠ¨ä»Ž Master Reg é‡Œé¢è‡ªåŠ¨åŒæ­¥ï¼Ÿ

Aï¼šå¦‚æžœåœæ­¢åŽå†é‡æ–°å¯åŠ¨å¤åˆ¶ç­–ç•¥ï¼Œå¯ä»¥åŒæ­¥è¢«åˆ é™¤çš„é•œåƒã€‚

> Qï¼šå¯¹äºŽå¤šä¸ªæŠ•äº§åœ°ï¼Œå¤šä¸ªä»“åº“ï¼Œå“ªç§æ–¹å¼çš„é«˜å¯ç”¨æ–¹æ¡ˆå¥½ä¹ˆï¼Ÿç¬¬ä¸€ç§ï¼Œå…±äº«å­˜å‚¨å­˜å‚¨å¯èƒ½ä¼šå‡ºçŽ°å•ç‚¹æ•…éšœä¹ˆï¼Ÿ

Aï¼šå…±äº«å­˜å‚¨åªé€‚åˆåŒä¸€æ•°æ®ä¸­å¿ƒï¼Œå¤šä¸ªäº§åœ°å»¶æ—¶å¤ªå¤§ï¼Œä¸é€‚åˆå…±äº«å­˜å‚¨ã€‚

> Qï¼šRegistry ä¹‹é—´åŒæ­¥æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šRegistry APIã€‚

> Qï¼šåœ¨å­˜å‚¨è¿™å—è€ƒè™‘è¿‡æä¾›æ’ä»¶æ–¹å¼å¯ä»¥è°ƒç”¨å¤–éƒ¨æ¨¡å—ï¼Œæ¯”å¦‚ä»¥æ’ä»¶æ–¹å¼æ”¯æŒ s3 è¿™ç§å¯¹è±¡å­˜å‚¨ï¼Ÿ

Aï¼šHarbor æ”¯æŒå…¶ä»–å­˜å‚¨æ–¹å¼ï¼Œå‚è§ [Harbor æ–‡æ¡£](https://github.com/vmware/harbor/blob/master/docs/installation_guide.md)ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 8 æœˆ 18 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**å¼ æµ·å®ï¼ˆHenryZhangï¼‰ï¼ŒVMware ä¸­å›½ç ”å‘ä¸­å¿ƒäº‘åŽŸç”Ÿåº”ç”¨é¦–å¸­æž¶æž„å¸ˆï¼ŒHarbor å¼€æºä¼ä¸šçº§å®¹å™¨ Registry é¡¹ç›®è´Ÿè´£äººï¼ŒCloud Foundry ä¸­å›½ç¤¾åŒºæœ€æ—©çš„æŠ€æœ¯å¸ƒé“å¸ˆä¹‹ä¸€ã€‚åœ¨ VMware ä¸­å›½ç ”å‘ä¸­å¿ƒå…ˆåŽè´Ÿè´£å¼€æºå¹³å° Cloud Foundryã€å¤§æ•°æ®è™šæ‹ŸåŒ–ã€è½¯ä»¶å®šä¹‰å­˜å‚¨ç­‰é¢†åŸŸçš„æŠ€æœ¯å¸ƒé“å’Œè§£å†³æ–¹æ¡ˆæŽ¨å¹¿ã€‚ç›®å‰ç€é‡å…³æ³¨äº‘åŽŸç”Ÿåº”ç”¨çš„ç ”å‘å·¥ä½œï¼Œå†…å®¹åŒ…æ‹¬ Containerã€PaaSã€IaaS ç­‰æ–¹é¢ã€‚

---

### 2016-08-16ï¼šå®¹å™¨åŒ– ICT èžåˆåˆä½“éªŒ

> Qï¼šç½‘ç»œè½¬å‘æœ‰æ²¡æœ‰é‡åˆ°ç“¶é¢ˆï¼Ÿæœ‰æ²¡æœ‰å°è¯•ä¸€äº›åŠ é€ŸæŠ€æœ¯ï¼Œæ¯”å¦‚ DPDKï¼Ÿ

Aï¼šå› ä¸ºæ˜¯æŽ§åˆ¶é¢ç½‘å…ƒï¼Œç›®å‰æ²¡æœ‰é‡åˆ°ç“¶é¢ˆï¼Œæ²¡æœ‰ç”¨ DPDKï¼Œæˆ‘ä»¬ä¹‹å‰æµ‹è¯•è¿‡è™šæ‹Ÿæœºçš„ï¼Œå› ä¸ºç½‘å…ƒç‰¹ç‚¹ï¼Œä¹Ÿæ˜¯æ²¡æœ‰é…ç½® DPDKï¼Œç›®å‰çš„æµ‹è¯•ä¸Šçœ‹ï¼Œæ€§èƒ½ä¸Šæ²¡æœ‰é—®é¢˜ã€‚

> Qï¼šçŽ°åœ¨æ•°æ®åº“ä¹Ÿæ”¾åœ¨å®¹å™¨ä¸­å—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æ•°æ®åº“é›†ç¾¤ï¼Œæˆ‘ä»¬æ­£åœ¨åšå°†æ•°æ®åº“åˆ†ç¦»çš„å·¥ä½œã€‚

> Qï¼šä½ ä»¬å®žæµ‹çš„å®¹å™¨è¿è¡ŒäºŽè™šæ‹ŸæœºçŽ¯å¢ƒï¼Œæ€§èƒ½å¦‚ä½•ï¼Œä½ ä»¬å®¹å™¨ç½‘ç»œå¦‚ä½•å®žçŽ° NFV äº’è”ï¼Ÿ

Aï¼šå®¹å™¨æ²¡æœ‰åŸºäºŽè™šæ‹ŸæœºçŽ¯å¢ƒï¼Œå› ä¸ºæ˜¯æŽ§åˆ¶é¢ç½‘å…ƒï¼Œæ€§èƒ½æ²¡æœ‰é‡åˆ°ç“¶é¢ˆã€‚

> Qï¼šå®¹å™¨ä¸ä¼šåŒ…æ‰“å¤©ä¸‹ï¼Œä¸Žè™šæœºï¼Œç‰©ç†æœºå¹¶å­˜å¯èƒ½æ˜¯ä¸€æ®µæ—¶é—´å†…çš„ä¸€ç§å¸¸æ€ï¼Œæˆ‘ä»¬æœ‰æ²¡æœ‰åˆ†æžå“ªäº›ä¸šåŠ¡é€‚åˆå®¹å™¨åŒ–ï¼Œå“ªäº›ä¸šåŠ¡ä¸å®œæ”¹å˜ï¼Ÿå¹¶ä¸”åœ¨åˆ©ç”¨ Kubernetes ä½œä¸ºå®¹å™¨çš„ç¼–æŽ’è°ƒåº¦å·¥å…·æ—¶ï¼Œå¦‚ä½•å®žçŽ°å®¹å™¨ä¸Žè™šæœºåº”ç”¨çš„äº’é€šï¼Ÿ

Aï¼šå…¶å®žä¸šåŠ¡ä¸å®œæ”¹å˜ä¸ä»…ä»…æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œä¹Ÿå’Œä¸šåŠ¡åŽ‚å•†æ˜¯å¦æ„¿æ„æ”¹å˜æœ‰å…³ï¼Œæ¯•ç«Ÿä¸€äº›é—ç•™çš„ä¸šåŠ¡å·²ç»åœ¨çŽ°ç½‘è¿è¡Œå¾ˆä¹…äº†ï¼Œå¾ˆéš¾çŸ­æœŸå†…å®¹å™¨åŒ–ã€‚å¦å¤–ï¼Œæˆ‘ä»¬ç¡®å®žç¢°åˆ°äº†éœ€è¦å†…æ ¸ä¼˜åŒ–çš„ä¸šåŠ¡ã€‚æˆ‘ä»¬ç³»ç»Ÿä¸­è¿˜æ²¡æœ‰åšå®¹å™¨å’Œè™šæ‹Ÿæœºåº”ç”¨äº’é€šã€‚

> Qï¼šä¼ ç»Ÿ CT ç½‘ç»œä¸ä»…ä»…æ˜¯ IMS å§ï¼Œå¯¹äºŽ CSã€PSï¼ŒSDN/NFV åŒ–ï¼Œä½ ä»¬æœ‰ä»€ä¹ˆæ€è·¯å—ï¼Ÿ

Aï¼šIMS ä½¿æˆ‘ä»¬å®¹å™¨åŒ–çš„ç¬¬ä¸€ä¸ªå°è¯•ï¼Œå…¶ä»–çš„ç½‘å…ƒä¹Ÿæ­£åœ¨ç ”ç©¶ä¸­ï¼ŒåŽç»­ä¹Ÿä¼šåšç›¸å…³çš„æµ‹è¯•ï¼Œå¦‚æžœæœ‰å…´è¶£ï¼Œä¹Ÿæ¬¢è¿Žå‚åŠ æˆ‘ä»¬åŽé¢çš„æµ‹è¯•ã€‚

> Qï¼šä½ ä»¬çš„èµ„æºæ± ï¼Œæœ‰è·¯ç”±å™¨ï¼Œå®‰å…¨ç»„ï¼Œè´Ÿè½½å‡è¡¡ä¹‹ç±»çš„åŠŸèƒ½å˜›ï¼Ÿè·¯ç”±å™¨ï¼Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥è¢«åˆ†é…å…¬ç½‘ IP å—ï¼Ÿ

Aï¼šæŒ‡çš„æ˜¯å®¹å™¨çš„èµ„æºæ± è¿˜æ˜¯æˆ‘ä»¬å·²æœ‰çš„ç§æœ‰äº‘èµ„æºæ± ï¼Œå·²æœ‰çš„ç§æœ‰äº‘èµ„æºæ± æ˜¯æœ‰çš„ï¼Œä½†æ˜¯å®¹å™¨è¿™ä¸ªåŽŸåž‹ç³»ç»Ÿè¿˜æ²¡æœ‰ã€‚

> Qï¼šç±»ä¼¼ Clearwater çš„å¼€æºé¡¹ç›®è¿˜æœ‰å“ªäº›ï¼Ÿ

Aï¼šNFV æ–¹é¢çš„å—ï¼Œå¦‚æžœæ˜¯ IMSï¼ŒClearwater ä¸šç•Œç”¨çš„æ¯”è¾ƒå¤šï¼ŒNFV å…¶ä»–ç½‘å…ƒå¼€æºé¡¹ç›®å¾ˆå¤šã€‚

> Qï¼šä½ ä»¬çš„è™šæ‹Ÿæœºåº•å±‚ä½¿ç”¨ä»€ä¹ˆè™šæ‹ŸåŒ–æŠ€æœ¯æ”¯æ’‘ï¼Ÿ

Aï¼šè¿™æ¬¡æ¼”ç¤ºï¼Œåº•å±‚ç”¨çš„å°±æ˜¯ Dockerï¼Œæˆ‘ä»¬çš„ç§æœ‰äº‘èµ„æºæ± æœ‰ VMwareã€KVM ä¹Ÿæœ‰ Xenã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 8 æœˆ 16 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**é©¬è½¶æ…§ï¼Œä¸­å›½ç§»åŠ¨é€šä¿¡æœ‰é™å…¬å¸ç ”ç©¶é™¢ç§æœ‰äº‘é¡¹ç›®ç»ç†ï¼Œä¹‹å‰æ›¾ä»» VMware ç ”å‘ä¸­å¿ƒç ”å‘å·¥ç¨‹å¸ˆã€‚ä¸€ç›´å…³æ³¨å¹¶è‡´åŠ›äºŽè™šæ‹ŸåŒ–ã€å®¹å™¨ã€äº‘è®¡ç®—ç­‰ç›¸å…³é¢†åŸŸã€‚**

---

### 2016-08-11ï¼šåº”ç”¨å®¹å™¨åŒ–ä¹‹ Kubernetes å®žè·µ

> Qï¼šè¯·é—®åœ¨ Kubernetes æž¶æž„ä¸‹ æ­å»ºåˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶å¦‚ Dubbo

éœ€è¦å°†ä¸»æœºåœ°å€å’Œæš´éœ²ç«¯å£æ³¨å†Œåˆ° ZooKeeper ä¸Šï¼Œè¿™ä¸ªä¸»æœºåœ°å€å’Œæš´éœ²çš„ç«¯å£ä½ ä»¬æ˜¯æ€Žä¹ˆå¤„ç†çš„ï¼Œå³å®¹å™¨å†…çš„åº”ç”¨å¦‚ä½•èŽ·å– Docker å®¿ä¸»æœºåœ°å€ï¼Ÿ

Aï¼šDubbo æœåŠ¡ä¸éœ€è¦æš´éœ²ä¸»æœºçš„ IP å’Œåœ°å€ï¼Œåªéœ€è¦çŸ¥é“å®¹å™¨åœ°å€å³å¯ã€‚è¿™äº›æœåŠ¡éƒ½æ˜¯æ³¨å†Œåˆ° ZooKeeper ä¸Šé¢ï¼Œé€šè¿‡ ZooKeeper å®ŒæˆæœåŠ¡å‘çŽ°ï¼ŒKubernetes èƒ½å¤Ÿæ ¹æ®æš´éœ²ç«¯å£è¿›è¡Œè°ƒåº¦,å½“ç„¶æœ‰äº›åº”ç”¨è¦æ±‚å®¹å™¨èƒ½èŽ·å–åˆ°å®¿ä¸»æœºçš„ IP åœ°å€ï¼Œè¿™å—æˆ‘ä»¬å¯¹ Kubernetes åšäº†ä¸€äº›ä¿®æ”¹ï¼Œå¯ä»¥åŠ¨æ€æ³¨å…¥è¯¸å¦‚å®¿ä¸»æœº IPï¼Œå®¿ä¸»æœºä¸»æœºåä¿¡æ¯åˆ°å®¹å™¨çš„çŽ¯å¢ƒå˜é‡ä¸­ã€‚

> Qï¼šECP çš„å®šä½å’Œè§£å†³ç›®æ ‡ç›¸æ¯”è¾ƒç›®å‰å¤§å®¶åœ¨ç”¨ä¼ ç»Ÿçš„äº‘å¹³å°è§£å†³æ–¹æ¡ˆæ¥è®²ä¸‹ï¼Ÿ

Aï¼šECP äº§å“å®šä½æ˜¯ä¸€å¥—å®Œæ•´çš„å®¹å™¨è§£å†³æ–¹æ¡ˆï¼Œä»Žå®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œèµ„æºç›‘æŽ§åˆ°æ—¥å¿—åˆ†æžå¤„ç†ï¼Œç›¸æ¯”ä¸Žäº‘å¹³å°è§£å†³æ–¹æ¡ˆç®¡ç†çš„å¯¹è±¡ä¸å†æ˜¯è™šæ‹Ÿæœºï¼Œè€Œæ˜¯å®¹å™¨ï¼Œé¢å‘çš„å¯¹è±¡æ˜¯æœåŠ¡ã€‚

> Qï¼šå…³äºŽå®¹å™¨æœ¬èº«çš„èµ„æºæ€§èƒ½ç›‘æŽ§ï¼Œæ˜¯ç”¨çš„ cAdvisor+Heapster å—ï¼Œå¦‚ä½•èƒ½ä¿æŒ pod é‡å¯ï¼ˆé‡å¯åŽ pod åç§°å˜åŒ–ï¼‰åŽçš„æ•°æ®è¿žç»­æ€§ï¼Œè°¢è°¢ã€‚

Aï¼šèµ„æºç›‘æŽ§ç”¨çš„ä¸æ˜¯ Heapsterï¼ŒECP çš„èµ„æºç›‘æŽ§æ˜¯ç”¨ cAdvisor+ æˆ‘ä»¬è‡ªå·±ç ”å‘çš„é‡‡é›† Agent+Ceilometer+MongoDB+HBase ç­‰æŠ€æœ¯ã€‚å¤ç”¨äº†æˆ‘ä»¬åœ¨åš CMP äº§å“æ—¶çš„æŠ€æœ¯ï¼Œrc ä¸­çš„ pod é‡å»ºåŽä¼šé‡å‘½åï¼Œè¿™å—å¯¹äºŽå•ä¸€ pod æ•°æ®çš„è¿žç»­æ€§è¿˜æ²¡æœ‰è€ƒè™‘ï¼Œæˆ‘ä»¬æ˜¯æŠŠ rc å½“åšä¸€ä¸ªæ•´ä½“è€ƒè™‘çš„ ã€‚

> Qï¼šä½ ä»¬å¯¹å¤–æœåŠ¡çš„è´Ÿè½½å‡è¡¡å¦‚ä½•åšçš„ï¼Ÿæ˜¯ç›´æŽ¥ç”¨ Kubernetes çš„ service å—ï¼Ÿ

Aï¼šå¯¹å¤–è´Ÿè½½å‡è¡¡çŽ°é˜¶æ®µç”¨çš„æ˜¯ Kubernetes çš„ serviceï¼Œè€ƒè™‘åˆ° iptables å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼ŒåŽç»­æˆ‘ä»¬ä¼šè€ƒè™‘ä½¿ç”¨åˆ«çš„æ–¹æ¡ˆï¼Œåœ¨é›†ç¾¤å†…éƒ¨ç›´æŽ¥æŠŠæµé‡è½¬å‘åˆ°å¯¹äºŽçš„ pod ä¸Šã€‚

> Qï¼šè¯·é—® Kubernetes å®¹å™¨å’Œåœ¨å…¶ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºç›‘æŽ§æ˜¯å¦‚ä½•åšçš„ï¼Ÿèƒ½ä»‹ç»ä¸‹å—ï¼Ÿè°¢è°¢ï¼

Aï¼šECP çš„èµ„æºç›‘æŽ§æ˜¯ç”¨ cAdvisor+ æˆ‘ä»¬è‡ªå·±ç ”å‘çš„é‡‡é›† Agent+Ceilometer+MongoDB+HBase ç­‰æŠ€æœ¯ã€‚å¤ç”¨äº†æˆ‘ä»¬åœ¨åš CMP äº§å“æ—¶çš„æŠ€æœ¯ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç”¨ cAdvisor é‡‡é›†åŽŸå§‹æ•°æ®ï¼Œç„¶åŽé€šè¿‡ Ceilometer æŒä¹…åŒ–ï¼Œæä¾›å®žæ—¶æ•°æ®æŸ¥è¯¢ã€å‘Šè­¦ç­‰åŠŸèƒ½ã€‚æ•°æ®ä¼šå®šæœŸè½¬å­˜åˆ° hbase åšåŽ†å²æ•°æ®åˆ†æžã€‚

> Qï¼šè¯·é—®ï¼Œæœ‰åŸºäºŽ Kubernetes çš„å¤šç§Ÿæˆ·å’Œç”¨æˆ·é…é¢å¼€æºå®žçŽ°å˜›ï¼Ÿ

---

### 2016-08-04ï¼šä¼ ç»Ÿé‡‘èž IT å¯¹æ··åˆäº‘ç®¡ç†çš„ä¸€äº›æ€è€ƒ

> Qï¼šä¼ ç»Ÿé‡‘èžè¡Œä¸šå¾ˆå¤šå…³é”®ç³»ç»Ÿæž¶æž„æ¯”è¾ƒç®€å•éƒ½ä¸ºé›†ä¸­å¼æž¶æž„ï¼Œä¸å¥½åšæ¨ªå‘æ‰©å±•ï¼Œä¸é€‚åˆæ”¾åˆ°ç§æœ‰äº‘ä¸Šï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ€è·¯ï¼Ÿ

Aï¼šä»Žæ•°æ®é¢å’Œä¸šåŠ¡åœºæ™¯æ¥ç»†åˆ†ï¼Œå…³é”®ç³»ç»Ÿæ¶‰åŠå®¢æˆ·èµ„æ–™ã€èµ„é‡‘åŠ¨è´¦ç³»ç»Ÿï¼Œä»ç„¶ä¿ç•™åœ¨ä¼ ç»Ÿé›†ä¸­å¼çš„ä¸»æœºå¹³å°ï¼Œä½†æ˜¯ä¼šå°†æŸ¥è¯¢ç±»äº¤æ˜“ä¸‹ç§»åˆ°åŸºäºŽ X86 çš„ç§æœ‰äº‘ä¸Šã€‚

> Qï¼šæ··åˆäº‘å¦‚ä½•è§£å†³å¤šç§Ÿæˆ·æœåŠ¡ä¸Žé‡‘èžè¡Œä¸šç›‘ç®¡è¦æ±‚ç‰©ç†éš”ç¦»ä¹‹é—´çš„çŸ›ç›¾ï¼Ÿ

Aï¼šé‡‘èžè¡Œä¸šç›‘ç®¡è¦æ±‚ç‰©ç†éš”ç¦»åœ¨æ•°æ®ä¸­å¿ƒç½‘ç»œå±‚é¢è¡¨çŽ°ä¸º"2 ç½‘åˆ†ç¦»"ï¼šåŠžå…¬ç½‘å’Œä¸šåŠ¡ç½‘ã€‚ ç›¸å¯¹åº”çš„ï¼Œæ··åˆäº‘çš„å¤šç§Ÿæˆ·ä¹Ÿç»†åˆ†å‡ºå¼€å‘äº‘ã€æµ‹è¯•äº‘å’Œç”Ÿäº§äº‘ç§Ÿæˆ·ã€‚å„ç§Ÿæˆ·çš„èµ„æºå’Œæ“ä½œä¸¥æ ¼è¿›è¡Œéš”ç¦»

> Qï¼šæ‚¨è®¤ä¸ºè¿ç§»åˆ°äº‘çš„æ­¥éª¤åº”è¯¥å¦‚ä½•ï¼Œå“ªäº›é€‚åˆè¿ç§»åˆ°äº‘

Aï¼šåœ¨å®žè·µä¸­ï¼Œå…ˆç†æ¸…åº”ç”¨çš„å®¶åº•ã€‚æ ¹æ®ä¸šåŠ¡åœºæ™¯éœ€è¦å’Œäº‘çš„èƒ½åŠ›ã€å›¢é˜Ÿçš„æŠ€èƒ½æˆé•¿ã€ç›‘ç®¡åº•çº¿ï¼ˆä¸Šå…¬æœ‰äº‘çš„è¯ï¼‰ç­‰ç»´åº¦è¿›è¡Œè¯„ä¼°ï¼Œé€‰æ‹©ä¸Šäº‘çš„åº”ç”¨ã€‚è¿ç§»æ­¥éª¤å…·ä½“çœ‹æ˜¯å¦è¦é‡æž„åº”ç”¨æž¶æž„ï¼Œç›¸åº”è¿ç§»éš¾åº¦ä¸ä¸€ã€‚

> Qï¼šå“ªäº›ä¸šåŠ¡é€‚åˆä½¿ç”¨äº‘æœåŠ¡?äº‘æž¶æž„ä¸Žä¼ ç»Ÿæž¶æž„è‚¯å®šå­˜åœ¨ä¸€ä¸ªå¹¶è¡ŒæœŸï¼Œä¸¤å¥—æž¶æž„å¦‚ä½•èžåˆå¹¶å­˜?

Aï¼šåœ¨ç§æœ‰äº‘ï¼Œäº‘æœåŠ¡ä¸æ˜¯åƒå…¬æœ‰äº‘æœåŠ¡ä¸€æ ·å®Œå¤‡ï¼Œå»ºè®¾æ˜¯æœ‰ä¸ªè¿‡ç¨‹ï¼Œæ‰€ä»¥å‰æœŸå†…éƒ¨ç®¡ç†ç±»ã€å’Œå®¢æˆ·äº¤äº’çš„æ¸ é“ç±»ä¸šåŠ¡é€‚ç”¨ä¸Šäº‘ã€‚

> Qï¼šäº‘æž¶æž„ä¸Žä¼ ç»Ÿæž¶æž„è‚¯å®šå­˜åœ¨ä¸€ä¸ªå¹¶è¡ŒæœŸï¼Œä¸¤å¥—æž¶æž„å¦‚ä½•èžåˆå¹¶å­˜?

Aï¼šçš„ç¡®å­˜åœ¨å¹¶è¡ŒæœŸï¼Œæž¶æž„èŒèƒ½å›¢é˜Ÿå¯ä»¥å‘æŒ¥è¾ƒå¤§ä½œç”¨ï¼Œä¸€ä¸ªä½œç”¨æ˜¯æž¶æž„ç®¡ç†å›¢é˜Ÿå„ç‰‡åŒºå’Œå¼€å‘å›¢é˜Ÿè®¾è®¡è§’è‰²ç®¡ç†å¥½å„äº§å“çš„åº”ç”¨æž¶æž„,å¦å¤–ä¸€ä¸ªä½œç”¨ç»„ç»‡äººæ‰‹å¼€å±•äº‘æž¶æž„çš„è®¾è®¡ã€åŽŸåž‹å¼€å‘ï¼Œå¼•å¯¼äº§å“çš„æž¶æž„è¿›è¡Œæ¼”è¿›ã€‚

> Qï¼šä½ æŒ‡çš„æ··åˆäº‘æ˜¯ä»¥ Oracleã€IBMã€VMware ä¸»å¯¼çš„å•†ä¸šè½¯ä»¶å…¬å¸æä¾›çš„å¹³å°æ¯”å¦‚ O è®°çš„æ•°æ®åº“æ··åˆäº‘ï¼Œè¿˜æ˜¯ä»¥å¼€æºè½¯ä»¶ä¸ºä¸»çš„æ¯”å¦‚ OpenStackã€KVMï¼Œä¸Šé¢è·‘åŸºäºŽå¼€æºçš„ Tomcatã€MySQL ï¼Ÿ

Aï¼šæˆ‘ä»¬ç†è§£çš„æ··åˆäº‘æ˜¯æ›´å¹¿ä¹‰ï¼ŒåŒ…æ‹¬å…¬æœ‰äº‘å’Œç§æœ‰äº‘é¢†åŸŸï¼Œå…¬æœ‰äº‘ä¾‹å¦‚ AWSã€AZUREã€é˜¿é‡Œäº‘ç­‰ï¼Œç§æœ‰äº‘ä¾‹å¦‚ vCloudã€é’äº‘ç­‰ã€‚

> Qï¼šä¼ ç»Ÿé‡‘èžçš„çŽ°æœ‰å•†ä¸šè½¯ä»¶å¦‚ä½•ä¸Žå¼€æºå¹³å°ç»“åˆï¼Ÿ

Aï¼šä»¥é€‰æ‹©äº‘å¹³å°çš„æŠ€æœ¯æ ˆå»ºè®¾äº‘æœåŠ¡ï¼ŒçŽ°æœ‰å•†ä¸šè½¯ä»¶ä¸æ˜¯å¼ºæ±‚ç»“åˆï¼Œç»“åˆæˆæœ¬å¤ªé«˜æˆ–æŠ€æœ¯æž¶æž„ä¸åˆé€‚å°±è¯¥èˆå¼ƒã€‚ä¾‹å¦‚å°æœº WEB åº”ç”¨ä¸Šäº‘ï¼Œå°±ä¼šä»Ž Was æ¢æˆè½»é‡çº§çš„ WEB åº”ç”¨æœåŠ¡å™¨ï¼Œä¾‹å¦‚ Tomcatã€JBossã€‚

> Qï¼šä¼ ç»Ÿé‡‘èžçš„ IT è¿ç»´èƒ½å¦è‡ªå·±æ”¯æ’‘å¼€æºå¹³å°æž„å»ºè‡ªå·±çš„æ··åˆäº‘ï¼Œä»Žä½ çš„è§†è§’çœ‹ä¸­å°åž‹åŸŽå¸‚å•†è¡Œä¾é è‡ªå·±çš„ it è¿ç»´æž„å»ºè‡ªå·±çš„æ··åˆäº‘å½“å‰é˜¶æ®µæ˜¯å¦åˆ‡å®žå¯è¡Œï¼Ÿ

Aï¼šè¿™è¦çœ‹å•ä½çš„å¤§èƒŒæ™¯ï¼Œå¦‚æžœä¸šåŠ¡éƒ¨é—¨æ²¡æœ‰ä¼ å¯¼å¸‚åœºåŽ‹åŠ›åˆ° IT éƒ¨é—¨ï¼Œé‚£ä¹ˆé¢å¯¹ IT å¼€å‘å›¢é˜Ÿï¼Œç”± IT è¿ç»´ä¸»å¯¼å»ºè®¾åŸºäºŽå¼€æºçš„æ··åˆäº‘å¹³å°ä½œä¸ºèµ·ç‚¹ï¼Œä¹Ÿæ˜¯ä¸€ç§å¯è¡Œçš„é€‰æ‹©ã€‚æˆ‘ä»¬çš„å¤§èƒŒæ™¯æ˜¯ä¸šåŠ¡åŽ‹åŠ›çš„ä¼ å¯¼ï¼Œä»¥åŠè‡ªæˆ‘å˜é©çš„é«˜å±‚åŽ‹åŠ›ï¼Œæ‰€ä»¥æ˜¯ç”±æž¶æž„èŒèƒ½å›¢é˜Ÿç‰µå¤´è§„åˆ’è®¾è®¡ï¼Œæ–°å»ºçš„äº‘å¹³å°å›¢é˜Ÿå®žæ–½è½åœ°ã€‚

> Qï¼šè¯·é—®åœ¨äº‘åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯å·²è‡ªè¡Œç ”å‘å¼€æºæŠ€æœ¯ä¸ºä¸»å‘¢ï¼Œè¿˜æ˜¯ä½¿ç”¨è¾ƒä¸ºæˆç†Ÿçš„å•†ç”¨è½¯ä»¶ä¸ºä¸»ã€‚å¦‚ä½•å¹³è¡¡æˆæœ¬ä¸Žæ•ˆçŽ‡çš„å…³ç³»

Aï¼šè´´è¿‘åº”ç”¨çš„éƒ¨åˆ†å»ºè®®è‡ªç ”ï¼Œä¾‹å¦‚å¼€å‘æ¡†æž¶ã€å…¬å…±ç»„ä»¶ã€‚åŸºç¡€è®¾æ–½éƒ¨åˆ†éœ€è¦ç¨³å®šä¸ºä¸»ï¼Œä¾‹å¦‚è™šæ‹ŸåŒ–å¹³å°ã€å¯¹è±¡å­˜å‚¨æœåŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ç­‰ï¼Œä¸€èˆ¬é€‰æ‹©å•†ç”¨è½¯ä»¶æˆ–å¼€æºè½¯ä»¶ä¼ä¸šç‰ˆï¼Œæœ‰äº›åŠ å®¢æˆ·åŒ–å®šåˆ¶ã€‚

> Qï¼šå¦‚æžœæ˜¯æ··åˆäº‘çš„æž¶æž„è¯ä¸æ˜¯åº”å½“è€ƒè™‘å…¬æœ‰äº‘å’Œç§æœ‰äº‘ä¸€è‡´æ€§å—ï¼Ÿï¼Œè€Œåˆšæ‰è¯´çš„ç»“åˆå°±å˜æˆäº†ä¸€ç§ç®€å•çš„åŽ» IOEï¼Œå®¢æˆ·æ€»ä¸èƒ½ç”Ÿäº§è·‘ Wasï¼Œå…¬æœ‰äº‘è·‘ Tomcat å§ï¼Œå¦‚æžœè¿™æ ·æŽ¨åŠ¨æ··åˆäº‘é‚£ä¹ˆæ˜¯ä¸æ˜¯æ„å‘³ç€å…ˆå°±è¦æŽ¨åŠ¨åŽ» IOEï¼Œæ”¹é€ åº”ç”¨ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜å¯ä»¥ç»†åˆ† 2 ç§å±‚æ¬¡æ¥çœ‹ï¼Œæ··åˆäº‘æž¶æž„è®¾è®¡å¯¹åŸºç¡€è®¾æ–½ï¼ˆVMã€å®¹å™¨ã€é•œåƒã€ç½‘ç»œç­‰ï¼‰æ˜¯è¦è¿›è¡ŒæŠ½è±¡ï¼Œè¾¾æˆè¿™ä¸ªå±‚æ¬¡ä¸Šçœ‹ç§æœ‰äº‘å’Œå…¬æœ‰äº‘æ˜¯ä¸€è‡´ çš„ã€‚ å¦å¤–æ··åˆäº‘æž¶æž„è®¾è®¡ä¸Šï¼Œç®¡ç†çš„å¦ä¸€ä¸ªé«˜é˜¶å±‚æ¬¡æ˜¯å¯¹åº”ç”¨æž¶æž„çš„æŠ½è±¡ï¼Œç†æƒ³èƒ½å¤Ÿåšåˆ°åº”ç”¨åœ¨ä¸åŒäº‘ä¸Šè¿›è¡Œæ— ç—›è¿ç§»ã€‚ä¼ ç»Ÿä¸Šåœ¨ IOE ä¸Šçš„ä¸šåŠ¡ç³»ç»Ÿï¼Œå¦‚æžœæœ‰å¼€å‘æ¡†æž¶çš„æ”¯æŒï¼Œä¸”æ¡†æž¶çš„æž¶æž„åšçš„å¥½ï¼Œåˆ™å¼€å‘æ¡†æž¶æ”¹é€ ä¸Šäº‘åŽï¼Œåº”ç”¨ä»£ç æ”¹é€ é‡å¾ˆå°‘ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 8 æœˆ 4 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**ç½—æ–‡æ±Ÿï¼ŒæŸä¼ ç»Ÿé‡‘èž IT æž¶æž„å¸ˆï¼Œå…³æ³¨å’Œ IaaSã€Docker å’Œäº‘ç®¡ç†å…³è”çš„æŠ€æœ¯**ã€‚

---

### 2016-07-28ï¼šSAP Anywhere äº§å“èƒŒåŽ CD çš„å®žçŽ°

Aï¼šDaemonSet æ˜¯ Kubernetes çš„ä¸€ç§åŠŸèƒ½ï¼Œç”¨æ¥æŠŠ POD è°ƒåº¦åˆ°æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ä¸Šã€‚æˆ‘ä»¬çš„ä½¿ç”¨åœºæ™¯æ˜¯æŠŠçœ‹å®¶ç‹—ç¨‹åºè°ƒåº¦åˆ°æ¯ä¸€ä¸ªé›†ç¾¤é‡Œçš„èŠ‚ç‚¹ï¼Œä»¥èµ·åˆ°ç›‘æŽ§ä½œç”¨ã€‚

> Qï¼šä½ ä»¬ä¸»è¦è·‘çš„ä»€ä¹ˆç±»åž‹çš„åº”ç”¨ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ä¸šåŠ¡æ˜¯åŸºäºŽ WEB-UI çš„ ERP äº§å“ã€‚

> Qï¼šè¯·é—® Kubernetes ä½¿ç”¨ health check http è¯·æ±‚çš„æ—¶å€™æœ‰æ²¡æœ‰é‡åˆ°å®¹å™¨å¯èƒ½æœ¬èº«éœ€è¦å¥½ä¹…æ‰èƒ½å¯åŠ¨å®Œæ¯•é‚£ä¹ˆè¿™ä¸ªäººæœºåˆ¶å°±ä¼šä¸€ç›´æ­»å¾ªçŽ¯...è¯·é—®è¿™ä¸ªæœ‰æ²¡æœ‰å¥½çš„æ–¹å¼è§£å†³ï¼Ÿ

Aï¼šKubernetes health check åˆ†æˆ readinessProbe å’Œ livenessProbeã€‚å‰è€…å†³å®šå®¹å™¨æ˜¯å¦ readyï¼ŒåŽè€…å½“æ£€æŸ¥å¤±è´¥åŽç›´æŽ¥æš´åŠ›æ€æ­»å®¹å™¨ã€‚æŸäº›å®¹å™¨å¯åŠ¨è¾ƒæ…¢ï¼Œæ‰€ä»¥éœ€è¦è®¾å®šä¸€ä¸ªç­‰å¾…æ—¶é—´ã€‚æˆ‘ä»¬çš„å®¹å™¨ç­‰å¾…æ—¶é—´æ˜¯ readiness-\>15s, liveness-\>2minã€‚

> Qï¼šåŽæ¥ï¼Œæˆ‘ä»¬æŒ‰åŠŸèƒ½æŠŠåŽŸå…ˆçš„ä¸€ä¸ªé›†ç¾¤æ‹†åˆ†æˆäº†å¤šä¸ªï¼Œåˆ†åˆ«è¿ç»´ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œç¨³å®šæ€§å¤§ä¸ºæå‡ï¼Œè¿™ä¸ªæ€Žä¹ˆæ‹†çš„å‘¢ï¼Ÿ

Aï¼šæ ¹æ®åŠŸèƒ½æ‹†ã€‚æ¯”å¦‚ä¸€ä¸ªé›†ç¾¤ä¸“é—¨è·‘ Jenkinsï¼Œå¦ä¸€ä¸ªé›†ç¾¤ä¸“é—¨è·‘ slow-testã€‚BTWã€slow-test æ˜¯ç”¨æ¥è¿›ä¸€æ­¥éªŒè¯å½“å‰æäº¤æ˜¯å¦å­˜åœ¨ bug çš„ä¸€ç§æµ‹è¯•ï¼Œç”±äºŽè·‘çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥å« slow-testã€‚

> Qï¼šKubernetes API server ç»å¸¸å®•æœº?åˆ°è§„æ¨¡ä¸Šé™äº†ï¼ŸAPI server å¯ä»¥èµ·å¤šä¸ªåšè´Ÿè½½å‡è¡¡å§ï¼ŒAPI server å®•æœºçš„æ—¶å€™ Scheduler å’Œ controller-manager åˆ°ç“¶é¢ˆäº†ä¹ˆï¼Ÿ

Aï¼šæ—©æœŸçš„å®•æœºå¯èƒ½æ˜¯æˆ‘ä»¬è‡ªå·±ä½¿ç”¨ä¸å½“ï¼Œæ¯”å¦‚æŠŠ API server äº¤ç»™æ¯ä¸€ä¸ªå¼€å‘äººå‘˜ï¼ˆæˆ‘ä»¬æœ‰ 200 å¤šäººï¼‰ï¼Œç„¶åŽå¤§å®¶éƒ½åŽ»çŽ© kubectl å„ç§å‘½ä»¤ï¼Œé‡Œé¢æœ‰å‡ ä¸ªå‘½ä»¤æ¯”è¾ƒåƒèµ„æºï¼Œä¸€ç§æ˜¯ port-forwardï¼Œå¦ä¸€ç§æ˜¯ watch kubectl get podã€‚

> Qï¼šå¯¹äºŽåº”ç”¨çš„é…ç½®ä½ ä»¬å¦‚ä½•ç®¡ç†ï¼Ÿ

Aï¼šè¿™æ˜¯ä¸ªå¥½é—®é¢˜ã€‚æˆ‘ä»¬å†…éƒ¨è®¨è®ºçš„æ¯”è¾ƒæ¿€çƒˆã€‚ç›®å‰æœ‰ä¸¤ç§æžç«¯ï¼Œä¸€ç±»äººå€¾å‘äºŽæ¯ä¸ªæœåŠ¡è‡ªå·±ç®¡ç†é…ç½®ï¼›å¦ä¸€ç±»äººå€¾å‘æä¾›ä¸€ä¸ªä¸“é—¨çš„é…ç½®å¾®æœåŠ¡ã€‚å„æœ‰åˆ©å¼Šå§ã€‚

> Qï¼šä¸€ä¸ª DEMO ç³»ç»Ÿæ˜¯å¦åŒ…æ‹¬ä¾èµ–çš„æœåŠ¡ï¼Ÿå¦‚æžœä¾èµ–ï¼Œé‚£å‡å¦‚ DEMO ç³»ç»Ÿä¸­å¤šä¸ªæœåŠ¡éœ€è¦å‘å¸ƒï¼Œè¦æ¯ä¸ªéƒ½èµ·ä¸€å¥— DEMO ç³»ç»Ÿå—ï¼Ÿ

Aï¼šå‰æ–‡æåˆ°æˆ‘ä»¬æœ‰æŽ¥è¿‘ 30 ä¸ªå¾®æœåŠ¡ï¼Œæ˜¯çš„ï¼Œæ¯ä¸€å¥— DEMO ç³»ç»Ÿéƒ½åŒ…å«é‚£ä¹ˆå¤šå¾®æœåŠ¡ï¼Œæ‰€ä»¥åšä¸€å¥— DEMO ç³»ç»ŸæŒº"é‡"çš„ã€‚å½“ç„¶æˆ‘ä»¬åœ¨æ­å»º DEMO ç³»ç»Ÿæ—¶ï¼Œä¸»è¦è¿˜æ˜¯åˆ©ç”¨äº† Kubernetes çš„è°ƒåº¦èƒ½åŠ›æ¥å¹¶è¡Œå¤„ç†ä»»åŠ¡çš„ã€‚

> Qï¼šWeb UI åº”ç”¨æœ‰æ²¡æœ‰æ¶‰åŠåˆ°è´Ÿè½½å‡è¡¡å¯ä»¥ä»‹ç»ä¸€ä¸‹çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬ä½¿ç”¨ Nginx ä½œä¸ºåå‘ä»£ç†ï¼ŒKubernetes çš„ deployment/rs ä½œä¸ºè´Ÿè½½å‡è¡¡ã€‚nginx upstrea/server ç¼–å†™æœåŠ¡çš„å†…éƒ¨åŸŸåï¼Œè¢« SkyDNS è§£æžæˆ cluster IPï¼Œå†è¢« IP tables åš round robin è·¯ç”±åˆ°çœŸå®ž podã€‚

> Qï¼šã€Žæ ¹æ®åŠŸèƒ½æ‹†ã€‚æ¯”å¦‚ä¸€ä¸ªé›†ç¾¤ä¸“é—¨è·‘ Jenkinsï¼Œå¦ä¸€ä¸ªé›†ç¾¤ä¸“é—¨è·‘ slow-testã€‚BTWï¼Œslow-test æ˜¯ç”¨æ¥è¿›ä¸€æ­¥éªŒè¯å½“å‰æäº¤æ˜¯å¦å­˜åœ¨ bug çš„ä¸€ç§æµ‹è¯•ï¼Œç”±äºŽè·‘çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥å« slow-testã€ï¼Œä½ ä»¬åŽŸæ¥æ˜¯æ··åœ¨ä¸€ä¸ªé›†ç¾¤é‡Œçš„å•Šï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œæ—©æœŸæˆ‘ä»¬æ˜¯è·‘åœ¨ä¸€ä¸ªé›†ç¾¤é‡Œçš„ã€‚é‚£æ—¶å€™æˆ‘ä»¬è†œæ‹œ Kubernetesï¼Œè®¤ä¸ºè°·æ­Œå¤§å¸ˆçº§çš„äº§å“ä¸€å®šèƒ½å¾ˆå¥½çš„åˆ©ç”¨å¼‚æž„ç³»ç»Ÿç»„æˆé›†ç¾¤ï¼Œå¹¶ä¸”è‰¯å¥½çš„ç®¡ç†é‡Œé¢çš„åº”ç”¨çš„ã€‚äº‹å®žæ¯”è¾ƒä»¤äººé—æ†¾ï¼Œå½“ç„¶ä¸æŽ’é™¤æˆ‘ä»¬è‡ªå·±ä»£ç çš„é—®é¢˜ï¼Œæ€»ä¹‹è·‘åœ¨ä¸€èµ·æ¯”è¾ƒä¸ç¨³å®šï¼Œè€Œä¸”é‡åˆ°æ•…éšœæ—¶æ¯”è¾ƒéš¾æ¢å¤ï¼ˆå› ä¸ºå½±å“é¢æ¯”è¾ƒå¤§ï¼‰ã€‚

> Qï¼šæ‚¨å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸‹ä½ ä»¬å¼€å‘çš„ DaemonSet å¯ä¸å¯ä»¥ç”¨ Supervisor è¿™æ ·çš„åŽ»æ›¿ä»£ï¼Œå¦‚æžœå¯ä»¥éœ€è¦æ³¨æ„äº›ä»€ä¹ˆï¼Œä¹‹å‰ç›‘æŽ§ Web é‡åˆ°è¿‡ Web æœåŠ¡ 200ï¼Œå®žé™… Web æœåŠ¡å·²ç»æŒ‚èµ·çš„æƒ…å†µï¼Œå¦‚ä½•ç›‘æŽ§ç±»ä¼¼äº‹ä»¶ï¼Ÿ

Aï¼šè¡¥å……ä¸€ä¸‹ç¬¬ä¸€ä¸ªé—®é¢˜çš„ç­”å¤ï¼šç›‘æŽ§ web æœåŠ¡ï¼Œè¿™ä¸ªéœ€è¦æœåŠ¡è‡ªå·±æš´éœ²ï¼ˆå®žçŽ°ï¼‰ä¸€ä¸ªç‰¹æ®Šçš„ APIï¼Œé€šå¸¸å¯ä»¥æ˜¯ /heathï¼Œç„¶åŽæœåŠ¡è‡ªå·±åœ¨ API é‡Œé¢å®Œæˆå¥åº·æ‰«æã€‚é‚£ä¹ˆ k8s å°±çŸ¥é“æœåŠ¡æ˜¯å¦å¤„äºŽåƒµå°¸çŠ¶æ€äº†ã€‚

> Qï¼šä½ ä»¬çš„ Kubernetes API æœ‰æ²¡å¼€å¯ HTTPSï¼Ÿå¦‚æžœå¼€å¯æ˜¯å¦æœ‰åœ¨ Pod è®¿é—® API çš„æ¡ˆä¾‹ä»‹ç»ä¸€ä¸‹ï¼Ÿ

Aï¼šäº‹å®žä¸Šï¼Œæˆ‘ä»¬å¼€å¯äº† HTTPSï¼Œä½†æ˜¯åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨ HTTP ç«¯å£è¿žæŽ¥ API serverã€‚æˆ‘ä»¬ä¸‹ä¸€ä¸ªç›®æ ‡å°±æ˜¯å…¨é¢å¯ç”¨æŽˆä¿¡çš„å®‰å…¨æ¨¡å¼ã€‚è‡³äºŽ Pod è®¿é—® API server åªè¦æœ‰ service token å³å¯ã€‚

> Qï¼šä½ å¥½ï¼ŒæŠŠ Jenkins å’Œ Slow Tests æ‹†åˆ†é›†ç¾¤æ˜¯æŒ‰å‘½åç©ºé—´åˆ†äº†ï¼Œè¿˜æ˜¯å†å•ç‹¬éƒ¨ç½²äº†å¦å¤–ä¸€å¥— Kubernetesï¼Ÿ

Aï¼šæˆ‘è¯´çš„æ‹†åˆ†æ˜¯æŒ‡ç‰©ç†ä¸Šçš„æ‹†åˆ†ï¼Œå˜æˆä¸¤ä¸ª Kubernetes é›†ç¾¤äº†ã€‚è¿™æ–¹é¢æˆ‘ä»¬ä»ç„¶åœ¨æ‘¸ç´¢ï¼Œåˆ°åº•æ˜¯å¤šä¸ªå°é›†ç¾¤å®¹æ˜“ç®¡ç†è¿˜æ˜¯ä¸€ä¸ªå¤§é›†ç¾¤å®¹æ˜“ç®¡ç†ã€‚

> Qï¼šæœ‰è€ƒè™‘è¿‡ä½¿ç”¨ Docker å®˜æ–¹çš„ Swarm å—ï¼Ÿæ–°æ‰‹ï¼Œä¸çŸ¥é“è¯¥é€‰æ‹©å“ªä¸ªã€‚

Aï¼šKubernetes å’Œ Docker Swarm å¤©ç”Ÿå°±æ˜¯ä¸¤ç§æ•™æ´¾ï¼Œæœ‰ç‚¹"æ­£é‚ªä¸ä¸¤ç«‹"çš„å‘³é“ã€‚äº‹å®žä¸Šï¼Œæˆ‘ä»¬æ—©æœŸåšåŽŸåž‹çš„æ—¶å€™æœ‰è€ƒè™‘è¿‡ Mesosphereã€‚ä¸ªäººè§‚ç‚¹ï¼šä»Žç›®å‰çš„å‘å±•æ¥çœ‹ Kubernetes å’Œ Swarm å¾ˆéš¾èµ°åˆ°ä¸€èµ·åŽ»ï¼Œè¿™æ„å‘³ç€é€‰æ‹©å…¶ä¸­ä¹‹ä¸€å¿…ç„¶ä¼šæ”¾å¼ƒå¦ä¸€ä¸ªã€‚è€Œ Kubernetes æ˜¯è°·æ­Œä¸»æŽ¨çš„ï¼Œè€ƒè™‘åˆ°è°·æ­Œå†…éƒ¨ Borg ç³»ç»Ÿæ˜¯ Kubernetes çš„åŽŸåž‹ï¼Œæ¯å¤©è·‘ç€ç™¾ä¸‡çº§çš„åº”ç”¨ï¼Œåº”è¯¥ä¸ä¼šæœ‰é”™çš„ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 7 æœˆ 28 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**é™ˆè´‡å–†ï¼ˆMilesChenï¼‰ï¼Œèµ„æ·±å¼€å‘å·¥ç¨‹å¸ˆã€å…¨æ ˆå·¥ç¨‹å¸ˆã€ç³»ç»Ÿæž¶æž„å¸ˆã€‚ä»Žä¸šåå¹´æœ‰ä½™ï¼Œç›®å‰å°±èŒ SAP ä¸­å›½ç ”ç©¶é™¢ï¼Œæ‹…ä»»æž¶æž„å¸ˆä¸€èŒï¼Œè´Ÿè´£ SAPAnywhere äº§å“çš„ CI/CD å·¥ä½œ**ã€‚

---

### 2016-07-26ï¼šåŸºäºŽ Docker çš„è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘çŽ°

> Qï¼šåŒä¸€ä¸ªåŸŸåæŒ‡å‘ä¸€å°ä¸»æœºå†…çš„å®¹å™¨æœåŠ¡ï¼Œéƒ¨ç½²äº† n ä¸ªç›¸åŒçš„å®¹å™¨ï¼Œæ€Žä¹ˆæ ¹æ®ä»–ä»¬çš„è´Ÿè½½æ¥åˆ†é…åˆ°ä¸åŒçš„å®¹å™¨ä¸­ï¼Ÿ

Aï¼š7 å±‚è´Ÿè½½å‡è¡¡éº»çƒ¦å‚è€ƒä¸‹ [Nginx](http://nginx.org/en/docs/http/load_balancing.html) å’Œ [HAProxy](http://cbonte.github.io/haproxy-dconv/intro-1.6.html#3.3.5) çš„ä½¿ç”¨æ–¹æ³•å³å¯ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬çš„ HAProxy å®¹å™¨è·Ÿå…¶ä»–ç›®æ ‡æœåŠ¡çš„å®¹å™¨æ˜¯ç›´æŽ¥åœ¨åŒä¸€ä¸ªç½‘ç»œé‡Œé¢çš„ã€‚ä½ è¯´çš„æ ¹æ®è´Ÿè½½åˆ†é…ï¼Œå¯ä»¥ä½¿ç”¨æœ€å°è¿žæŽ¥æ•°ç®—æ³•ï¼Œå³ [leastconn](http://cbonte.github.io/haproxy-dconv/1.6/configuration.html#4.2-balance) ç®—æ³•ï¼Œéœ€è¦æŸ¥çœ‹ HAProxy å¸®åŠ©æ‰‹å†Œè¿›è¡Œè®¾ç½®ã€‚

> Qï¼šDocker 1.2 IPVS çš„æ–¹æ¡ˆï¼Œæ˜¯å¦å¯ä»¥å®žçŽ°å®Œå…¨å–ä»£ Keepalived+Nginx çš„æ•ˆæžœï¼Ÿ

Aï¼šä¸èƒ½ï¼Œ IPVS æ˜¯ 4 å±‚åè®®çš„ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œéœ€è¦ 7 å±‚åè®®çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å…±äº«åŒä¸€ä¸ªç«¯å£ï¼Œæä¾› 7 å±‚åè®®è§£æžï¼Œgzip åŽ‹ç¼©ï¼Œcookie æ³¨å…¥ï¼Œsession ä¿æŒç­‰åŠŸèƒ½ã€‚

> Qï¼šæœ‰æ²¡æœ‰è¯„ä¼°è¿‡ Kubernetes åœ¨ host ä¸Šç”¨ iptables åš lb çš„æ–¹æ¡ˆï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨é‚£ç§ï¼Ÿ

Aï¼šå› ä¸ºæˆ‘ä»¬å¸Œæœ›æä¾› 7 å±‚çš„è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ï¼Œiptables çš„æ–¹æ¡ˆæ˜¯åŸºäºŽ 4 å±‚çš„ï¼Œä¸èƒ½å…±äº«åŒä¸€ä¸ªç«¯å£ï¼Œä¸èƒ½æä¾› 7 å±‚åè®®è§£æžï¼ŒåŽ‹ç¼©ï¼Œcookie æ³¨å…¥ï¼Œsession ä¿æŒç­‰åŠŸèƒ½ã€‚

> Qï¼šé—®ä¸‹ç°åº¦å‘å¸ƒå…·ä½“æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šç°åº¦å‘å¸ƒçš„å…·ä½“å®žçŽ°æ–¹å¼å¦‚ä¸‹ï¼š ä¾‹å¦‚æœ‰æœåŠ¡çš„ä¸¤ä¸ªç‰ˆæœ¬ A å’Œ aï¼Œä»–ä»¬ä½¿ç”¨ç›¸åŒçš„è·¯ç”±ï¼ŒæŒ‚åœ¨åŒä¸€ä¸ªåŸŸåï¼ˆä¾‹å¦‚ [www.example.com](http://www.example.com)ï¼‰çš„åŽç«¯ï¼Œä½†æ˜¯ A å’Œ a çš„æƒé‡ä¸ä¸€æ ·ï¼Œé€šè¿‡è°ƒæ•´æƒé‡æ¥åšåˆ°ç°åº¦å‘å¸ƒï¼Œæµé‡åˆ†é…åˆ°ä¸åŒçš„åŽç«¯ã€‚

> Qï¼šè¯·é—® haproxy è®¿é—®å…¶å®ƒä¸»æœºå®¹å™¨ç½‘ç»œæ€Žæ ·é€šä¿¡ï¼Ÿ

Aï¼šä¸€ä¸ªå®¹å™¨é›†ç¾¤æœ‰å¤šå°æœºå™¨ï¼Œé€šè¿‡ [Overlay](https://docs.docker.com/engine/userguide/networking/dockernetworks/#/an-overlay-network) ç½‘ç»œï¼Œå¯ä»¥åšåˆ°è·¨ä¸»æœºèŠ‚ç‚¹åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 7 æœˆ 26 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**è°­æž—åŽï¼Œé˜¿é‡Œå·´å·´é«˜çº§å·¥ç¨‹å¸ˆï¼Œå¤šå¹´ä»¥æ¥ä¸€ç›´å…³æ³¨ç³»ç»ŸæŽ¥å…¥å±‚ç›¸å…³æŠ€æœ¯ï¼ŒåŒ…æ‹¬ DNSï¼Œè´Ÿè½½å‡è¡¡ï¼ŒæœåŠ¡è·¯ç”±å’Œå‘çŽ°ï¼Œçƒ­è¡·å®¹å™¨æŠ€æœ¯**ã€‚

---

### 2016-07-19ï¼šæµ…è°ˆ Docker å®‰å…¨åˆè§„å»ºè®¾

> Qï¼šå®¹å™¨å®‰å…¨å’Œè™šæ‹Ÿæœºçš„å®‰å…¨æœ‰ä»€ä¹ˆå¼‚åŒï¼Ÿ

Aï¼šå®¹å™¨å¯ä»¥åœ¨æ›´ç»†çš„é¢—ç²’åº¦ä¸Šæ¥ä¿æŠ¤åº”ç”¨ï¼Œæ¯”å¦‚è¯´ç‰©ç†æœºå¥½æ¯”å¤§æ¥¼ï¼Œè™šæ‹Ÿæœºå¥½æ¯”ä¸åŒçš„æˆ¿é—´ï¼Œå®¹å™¨å°±æ˜¯é‡Œé¢åŒæˆ¿çš„ç§Ÿæˆ·ï¼Œå¤§æ¥¼åŠæˆ¿é—´ä¿éšœäº†å¤–éƒ¨çš„å®‰å…¨ï¼Œå¦‚æžœä½ ä¸ç›¸ä¿¡åŒå±‹çš„ç§Ÿå®¢ï¼Œåˆ™éœ€è¦ç”¨å®¹å™¨æ¥æ›´å¼ºçš„éš”ç¦»ï¼Œè¿™æ˜¯ 2 ä¸ªä¸åŒè§’åº¦çš„é—®é¢˜ã€‚

> Qï¼šé•œåƒå®‰å…¨ï¼ŒClair æ‰«æé è°±ä¹ˆï¼Ÿ

Aï¼šClair æ˜¯ CoreOS å‘å¸ƒçš„ä¸€æ¬¾å¼€æºå®¹å™¨æ¼æ´žæ‰«æå·¥å…·ã€‚è¯¥å·¥å…·å¯ä»¥äº¤å‰æ£€æŸ¥ Docker é•œåƒçš„æ“ä½œç³»ç»Ÿä»¥åŠä¸Šé¢å®‰è£…çš„ä»»ä½•åŒ…æ˜¯å¦ä¸Žä»»ä½•å·²çŸ¥ä¸å®‰å…¨çš„åŒ…ç‰ˆæœ¬ç›¸åŒ¹é…ã€‚æ¼æ´žæ˜¯ä»Žç‰¹å®šæ“ä½œç³»ç»Ÿçš„é€šç”¨æ¼æ´žæŠ«éœ²ï¼ˆCVEï¼‰æ•°æ®åº“èŽ·å–,å®ƒåå‘äºŽé™æ€æ‰«æï¼Œå³é•œåƒå®‰å…¨ï¼Œå›½é™…ä¸Šå¯¹å®¹å™¨è¿è¡Œæ—¶å®‰å…¨æ–¹æ¡ˆæ¶‰è¶³è¾ƒå°‘ï¼Œå›½å†…å®¹å™¨äº‘å¯¹å®‰å…¨æ›´æ˜¯ç©ºç™½ä¸€ç‰‡ã€‚

> Qï¼šDocker æœ‰ä¸€ä¸ª User Namespace çš„æœºåˆ¶ï¼Œè¿™ç§éš”ç¦»åœ¨æ­£å¼çš„å®‰å…¨è§„èŒƒé‡Œæœ‰ç›¸åº”æè¿°å—ï¼Ÿæœ‰æ²¡æœ‰å°è¯•è¿‡åˆ©ç”¨è¿™ç§æœºåˆ¶å¢žåŠ å®‰å…¨æ€§ï¼Ÿ

Aï¼šDocker çš„å®‰å…¨æ ‡å‡†è§„èŒƒåŸºæœ¬å¤„äºŽç©ºç™½é˜¶æ®µï¼Œå¤§å®¶éƒ½åœ¨æ‘¸ç´¢ï¼Œä¸»è¦æ˜¯å®žè·µç´¯è®¡ã€‚user namespace å¯ä»¥å¢žå¼ºä¸€å®šçš„éš”ç¦»æ€§ï¼Œä½†æ˜¯åˆšæ‰ä¹Ÿæåˆ°ï¼šç”¨ user namespace éš”ç¦»åŽï¼Œå…¶å®žå¤ªå¤šç”¨æˆ·ä¸ä¼šç”¨æ“ä½œæ—¥å¿—ï¼Œç”¨äºŽåŽæœŸè¿½è¸ªåŠå®¡è®¡ã€‚

> Qï¼šèƒ½ä»‹ç»ä¸‹æ²™ç®±ä¸Žå®¹å™¨çš„ä¸åŒå—ï¼Ÿ

Aï¼šæ²™ç®±å’Œå®¹å™¨åªæ˜¯åœ¨å·¥ä½œçš„æ–¹å¼ä¸Šæ¯”è¾ƒç±»ä¼¼ï¼Œä½†æ˜¯åº•å±‚çš„æŠ€æœ¯å®žçŽ°å’Œä»£ç å…¶å®žæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚

> Qï¼šå¦‚ä½•æ‰èƒ½æœ‰æ•ˆçš„æ£€æµ‹å‡ºä¸‹è½½çš„é•œåƒæ˜¯å¦å«æœ‰æœ¨é©¬ç­‰ä¸å®‰å…¨çš„ä¿¡æ¯å‘¢?æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„ç›®å½•ï¼Œå¦‚ä½•ç»™åªè¯»æƒé™ï¼ŒåŽç»­æ•°æ®åº“ä¸€äº›ä¿¡æ¯æƒ³å†™å…¥å®¿ä¸»æœºåˆå¦‚ä½•å®žçŽ°ï¼Ÿ

Aï¼šå¯¹é•œåƒæ‰«æç›®å‰ä¸–é¢ä¸Šè¿˜æ˜¯æœ‰ä¸€äº›äº§å“çš„ï¼Œæ¯”å¦‚è¯´åˆšæ‰æŸä½åŒå­¦æåˆ°çš„ Clairã€‚ æŒ‚è½½åˆ°å®¹å™¨çš„ç›®å½•å¯ä»¥é€šè¿‡ ro å‚æ•°è®¾å®šåªè¯»æƒé™ï¼Œä½†æ˜¯éœ€è¦å†™å…¥çš„ç›®å½•æŒ‚è½½åªè®¾åªè¯»æƒé™ç¨‹åºæ˜¯ä¸èƒ½è¿è¡Œçš„ï¼Œè¿™æ ·å°±æ¶‰åŠåˆ°å®¿ä¸»æœºçš„æ–‡ä»¶å®‰å…¨ï¼Œç›¸ä¿¡å®¿ä¸»æœºçš„å®‰å…¨äº§å“åŠæ–¹æ¡ˆï¼ŒçŽ°åœ¨å·²ç»å¾ˆå¤šï¼Œå°±ä¸å¤è¿°äº†ã€‚

> Qï¼šæœ¨é©¬æ£€æµ‹æ¶‰åŠåˆ°ç‰¹å¾ä»£ç åº“ï¼Œæ£€æµ‹æ¯”è¾ƒéš¾å§ï¼Ÿ

Aï¼šæœ¨é©¬æ£€æµ‹å…¶å®žéƒ½æ˜¯åŸºäºŽç›®å‰çš„æŠ€æœ¯ï¼Œ åªæ˜¯å®¹å™¨çš„æ•°é‡å¯ä»¥è¿œè¿œå¤§äºŽè™šæ‹Ÿæœºï¼Œè¿™æ ·å¯¹æ£€æµ‹çš„æ€§èƒ½å’Œæ—¶æ•ˆæœ‰äº†æ›´é«˜çš„è¦æ±‚ã€‚

> Qï¼šæœ€è¿‘ä¸€ç›´è¢«äººé—®åˆ°å®‰å…¨æ€§çš„é—®é¢˜ï¼Œä½†æ˜¯åªä»Žå•æœºè§’åº¦è€ƒè™‘å®‰å…¨æ€§æ˜¯å¦å·²ç»æ— æ³•æ»¡è¶³åˆ†å¸ƒå¼è®¡ç®—çŽ¯å¢ƒï¼Œæˆ‘ä»¬æ˜¯å¦æ›´åº”è¯¥ä»Žåˆ†å¸ƒå¼è®¡ç®—å¸¦ç»™æˆ‘ä»¬çš„è§„æ¨¡æ•ˆåº”å’Œè‡ªæ„ˆæœºåˆ¶æ¥é‡æ–°å®¡è§† Docker çš„å®‰å…¨æ ‡å‡†ï¼Œè¯·é—®å˜‰å®¾æ˜¯å¦‚ä½•çœ‹å¾…åˆ†å¸ƒå¼è®¡ç®—ä¸­çš„æ•´ä½“å’Œéƒ¨åˆ†ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„å®‰å…¨å…³ç³»ï¼Œè°¢è°¢ã€‚

Aï¼šåˆ†å¸ƒå¼ä¹Ÿæ˜¯ç”±èŠ‚ç‚¹ç»„æˆçš„ï¼Œå•æœºå®‰å…¨æ˜¯åŸºç¡€ï¼Œå¦‚æžœå•æœºå®‰å…¨æ€§éƒ½æ— æ³•æ»¡è¶³ï¼Œåˆ†å¸ƒå¼çš„å®‰å…¨æ›´æ— ä»Žè¯´èµ·ã€‚ å½“ç„¶ï¼Œåˆ†å¸ƒå¼å­˜åœ¨å¤§è§„æ¨¡æ•ˆåº”ï¼ŒèŠ‚ç‚¹æ›´å¤šéœ€è¦å…³æ³¨çš„æ˜¯æ•°æ®çš„å¤„ç†åŠå‚¨å­˜å®‰å…¨ï¼›åœ¨æ»¡è¶³äº†èŠ‚ç‚¹å®‰å…¨åŽï¼Œåˆ†å¸ƒå¼æ›´å¤šçš„åº”è¯¥æ˜¯è€ƒè™‘è·¨èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¼ è¾“å®‰å…¨ï¼Œå°¤å…¶æ˜¯è·¨å…¬ç½‘çš„æ•°æ®ä¼ è¾“ï¼ˆVPN éš§é“ä¹Ÿæ˜¯å±žäºŽè·¨å…¬ç½‘çš„ä¼ è¾“ä¸€ç§ï¼‰ã€‚è‡ªæ„ˆæœºåˆ¶å…¶å®žåº”è¯¥ç®—ä¿éšœä¸šåŠ¡è¿žç»­æ€§çš„ä¸€ç§æ–¹å¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å½’çº³ä¸ºå®‰å…¨çš„ä¸€ç§ã€‚

> Qï¼šè¯·é—® Rancher é™¤äº†ä½¿ç”¨"çŽ¯å¢ƒ"å¤–ï¼Œç›®å‰èƒ½å®Œç¾Žå®žçŽ°ç§Ÿæˆ·éš”ç¦»å—ï¼Ÿ

Aï¼šå¯ä»¥ä½¿ç”¨ä¸»æœºæ ‡ç­¾ + å®¹å™¨ç­–ç•¥çš„æ–¹å¼ï¼Œå°†ä¸åŒç”¨æˆ·ç”¨è™šæ‹Ÿæœºæˆ–ç‰©ç†æœºè¿›è¡Œéš”ç¦»ã€‚ å°±ç›®å‰ Rancher æ¥è¯´ï¼Œä¸åŒçŽ¯å¢ƒæ˜¯æ¯”è¾ƒå¥½çš„éš”ç¦»æ–¹æ¡ˆã€‚

> Qï¼šä¸çŸ¥é“å˜‰å®¾ç»™çš„å®‰å…¨å»ºè®®æ˜¯å¦é€‚ç”¨äºŽ CoreOS è¿™ç§ Docker åŒ–çš„ OSï¼Œè¿˜æ˜¯è¯´è¿™ç±» OS ä¼šæœ‰æ›´å¥½çš„åˆè§„åŠŸèƒ½ï¼Ÿ

Aï¼šCoreOS è¿™ç§ç³»ç»Ÿç¡®å®žæ›´é€‚åˆå®¹å™¨ï¼Œè€Œä¸”æ‰¿è½½çš„åŠŸèƒ½ä¹Ÿæ›´åŠ å°‘ï¼Œç›¸åº”çš„éœ€è¦åˆè§„çš„ç‚¹ä¹Ÿè¶Šå°‘ã€‚ ä½†æ˜¯ä¸æŽ’é™¤æŸäº›åˆè§„è¦æ±‚å¼ºåˆ¶çš„åŠŸèƒ½ç‚¹æ— æ³•æ»¡è¶³ï¼Œè¿™éœ€è¦æ ¹æ®å®žé™…æƒ…å†µæ¥åˆ¤æ–­ã€‚

> Qï¼šé™¤äº†é•œåƒæ‰«æï¼Œè¿˜æœ‰å“ªäº›å®¹å™¨å®‰å…¨éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œå’Œå“ªäº›æˆç†Ÿæ–¹æ¡ˆå‘¢ï¼Ÿ

Aï¼šé™¤äº†é•œåƒæ‰«æï¼Œè¿˜éœ€è¦å…³æ³¨å®¹å™¨è¿è¡Œæ—¶å®‰å…¨ï¼Œå¦‚ç½‘ç»œå®‰å…¨ï¼Œåº”ç”¨ç¨‹åºæ¼æ´žï¼Œé˜²æ­¢è¢«æ”»å‡»ï¼Œå®‰å…¨ç­–ç•¥ç­‰ï¼› ç›¸ä¿¡æŽ¥ä¸‹æ¥æœ‰å®¹äº‘å‘å¸ƒçš„ AppSafe äº§å“ä¸ä¼šè®©å¤§å®¶å¤±æœ›ã€‚

> Qï¼šè™šæ‹Ÿæœºçš„å®‰å…¨æ–¹æ¡ˆæ˜¯å¦ä¹ŸåŒæ ·é€‚ç”¨äºŽå®¹å™¨ï¼Ÿ

Aï¼šåº”è¯¥æ˜¯éƒ¨åˆ†é€‚åˆï¼Œåˆšæ‰æåˆ°å®¹å™¨å’Œè™šæ‹Ÿæœºå…³æ³¨ç‚¹æ˜¯ä¸ä¸€æ ·çš„ã€‚ è™šæ‹Ÿæœºæ›´å¤šæ˜¯ç³»ç»Ÿå®‰å…¨ + åº”ç”¨å®‰å…¨ï¼Œ å®¹å™¨çš„ä¸»è¦å…³æ³¨ç‚¹è¿˜æ˜¯åº”ç”¨å®‰å…¨ï¼Œå¦‚ä»£ç æ¼æ´žï¼Œè½¯ä»¶æ¼æ´žç­‰ç­‰ã€‚

> Qï¼šå¦‚ä½•è¯„ä»· Docker 1.12 ä¸­ Swarm æ¨¡å¼è‡ªå¸¦çš„ TLS è®¤è¯ï¼Ÿ

Aï¼šå¤§å®¶éƒ½çŸ¥é“å‰æ®µæ—¶é—´çš„å¿ƒè¡€æ¼æ´žï¼Œå¤§å®¶ä¹ŸçŸ¥é“ç›®å‰äº’è”ç½‘çŽ¯å¢ƒçš„æƒ…å†µï¼Œ å…¶å®ž TLS è®¤è¯å·²ç»æ˜¯å¾ˆå¤šçŽ¯å¢ƒçš„å¿…å¤‡è¦æ±‚ï¼Œç”šè‡³å¯¹ TLS çš„ç‰ˆæœ¬å·ä¹Ÿæ˜¯ä¸¥æ ¼çš„è¦æ±‚ï¼Œæ¯”å¦‚è¯´æŸäº›è¡Œä¸šå¿…é¡»ä½¿ç”¨ TLS1.2 ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰èƒ½åˆè§„ã€‚Swarm æ¨¡å¼è‡ªå¸¦çš„ TLS è®¤è¯ç›¸ä¿¡ä¹Ÿæ˜¯åŸºäºŽæ­¤ç±»è¦æ±‚ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 7 æœˆ 19 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**è’‹è¿é¾™ï¼Œ[æœ‰å®¹äº‘](http://www.youruncloud.com/)é«˜çº§å’¨è¯¢é¡¾é—®ï¼Œä¸€ä¸ª IT çš„è€å…µï¼Œåå¹´æ¥æ··è¿¹äºŽå­˜å‚¨ã€ä¸‰ç½‘èžåˆã€å¤šå±äº’åŠ¨ã€æ™ºèƒ½ç©¿æˆ´ã€ç¬¬ä¸‰æ–¹æ”¯ä»˜ã€Docker ç­‰è¡Œä¸šï¼›ç»åŽ†è¿‡æµ‹è¯•ã€è¿ç»´ã€å®žæ–½å„å²—ä½å…¨æ–¹ä½çš„æ‘§æ®‹ï¼Œä¾ç„¶æ´»è·ƒåœ¨æŠ€æœ¯çš„é£Žå¤´æµªå°–ä¸Šã€‚ä¹‹å‰åˆ†äº«è¿‡[ã€Šè€å¸æœºå¸¦è·¯ ä½¿ç”¨ Docker å®žçŽ°ä¸èˆ¬é¡ºæ»‘çš„æŒç»­é›†æˆã€‹](http://www.youruncloud.com/blog/78.html)**ã€‚

---

### 2016-07-14ï¼šåº”ç”¨å®¹å™¨ env åŒ–å®žæˆ˜

> Qï¼šMesos è¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œå¦‚æžœå‘çŽ°è¯¥ä»»åŠ¡è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åŠ å¤§èµ„æºï¼ŒMesos å¦‚ä½•åšåˆ°å¯¹ä»»åŠ¡èµ„æºçš„å¼¹æ€§æ‰©å®¹ï¼Ÿå¦‚æžœé‡‡ç”¨ Docker çš„è¯ï¼Œæ˜¯æ–°å»ºæ›´å¤šçš„ Docker å®¹å™¨è¿˜æ˜¯ç›´æŽ¥æ‰©å¤§çŽ°æœ‰ Docker çš„å¤§å°ï¼Ÿ

Aï¼šä¸€èˆ¬æ˜¯æ‰©å±•æ›´å¤šçš„ Docker å®¹å™¨ä¸ªæ•°ï¼Œé™¤éžæ˜¯æŸä¸ªä»»åŠ¡æœ‰æœ€å°èµ„æºè¦æ±‚ï¼Œæ‰è¦æ‰©å¤§å•ä¸ª Docker çš„å¤§å°ã€‚

> Qï¼šå¼€å‘äººå‘˜ä½¿ç”¨çš„æœ¬åœ°çŽ¯å¢ƒå˜é‡å¦‚ä½•ç®¡ç†ï¼Ÿä¾‹å¦‚ä¸€ä¸ªåº”ç”¨ï¼Œæœ‰æ•°æ®åº“ï¼Œæœ‰æœç´¢å¼•æ“Žï¼Œè¿˜æœ‰ä¸¤ä¸ª Java APPï¼Œä¸åŒå¼€å‘å¯èƒ½éœ€è¦å—¯çŽ¯å¢ƒä¸åŒï¼Œä¾‹å¦‚æˆ‘æ˜¯æœç´¢åŠŸèƒ½çš„å¼€å‘ï¼Œéœ€è¦é“¾æŽ¥å…¬å…±çš„æ•°æ®åº“ï¼Œè€Œæœ‰äº›å¼€å‘éœ€è¦è‡ªå·±æœ‰æ•°æ®åº“ï¼Œæœç´¢å¼•æ“Žå´éœ€è¦é“¾æŽ¥å…¬å…±çš„ã€‚è¿™ç§é…ç½®ï¼Œå¦‚ä½•ç®¡ç†ï¼Ÿ

Aï¼šè¿™ç§æœ€å¥½å°†æ•°æ®åº“çŽ¯å¢ƒå˜äº†è¿›è¡ŒåŒºåˆ†ï¼Œé…ç½®ä¸¤ä¸ªæˆ–å¤šä¸ªç±»ä¼¼çŽ¯å¢ƒå˜é‡ã€‚

> Qï¼šè¯·é—® MySQL æ•°æ®åº“æ€Žä¹ˆéš Docker è¿ç§»?å¤‡ä»½å’Œæ¢å¤æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®å—ï¼Ÿ

Aï¼šMySQL çŽ°åœ¨æ˜¯å›ºå®šä¸»æœºä¸»ä»ŽåŒæ­¥ï¼Œæ²¡æœ‰å¯¹ MySQL åšè¿ç§»ï¼Œæˆ‘ä»¬çš„æ•°æ®çŽ°åœ¨å¤‡ä»½æ˜¯å®šæ—¶å…¨å¤‡ä»½ï¼Œæ­£åœ¨å°è¯•ä½¿ç”¨ MariaDB é›†ç¾¤ Galera Cluster ï¼Œä½†è¿˜æ²¡æœ‰ä¸Šç”Ÿäº§ï¼Œå½“ç„¶æœ‰å…±äº«å­˜å‚¨çš„è¯å°±æœ€å¥½ä¸è¿‡å•¦ã€‚

> Qï¼šè¯·é—®çº¿ä¸ŠæœåŠ¡æ›´æ–° war åŒ…ï¼Œå¦‚ä½•èƒ½ä½¿å¯¹å¤–æœåŠ¡ä¸é—´æ–­å—ï¼Ÿ

Aï¼šæ•°äººäº‘ç›®å‰é‡‡ç”¨ä»£ç ç‰ˆæœ¬å’Œé•œåƒç‰ˆæœ¬ç»Ÿä¸€ï¼Œå¯¹å¤–æœåŠ¡ä¸é—´æ–­ï¼Œæ•°äººäº‘ç›®å‰çš„åšæ³•æ˜¯å¯¹åº”ç”¨è¿›è¡Œæ— çŠ¶æ€æ”¹é€ ï¼ŒåŽé€šè¿‡ marathon put æ›´æ–°å®¹å™¨ã€‚

> Qï¼šè¯·é—® é…ç½®æ–‡ä»¶çš„è¯ç”Ÿäº§çŽ¯å¢ƒå’Œå¼€å‘çŽ¯å¢ƒæ€Žä¹ˆåŒºåˆ†ï¼Ÿ

Aï¼šç”Ÿäº§çŽ¯å¢ƒå’Œæµ‹è¯•çŽ¯å¢ƒéƒ½æ˜¯éš”ç¦»çš„ï¼Œé…ç½®æ–‡ä»¶é…ç½®ä¸åŒçš„å‚æ•°å³å¯ã€‚

> Qï¼šè¯·é—®å¯¹ç±»ä¼¼ Java åº”ç”¨ jdbcã€spring.xml ç­‰é…ç½®æ–‡ä»¶å¦‚ä½•ç®¡ç†ï¼Ÿ

Aï¼šXML é…ç½® é€šè¿‡ sed æ›¿æ¢ä¼ å…¥çš„çŽ¯å¢ƒå˜é‡ã€‚

> Qï¼šç”Ÿäº§ä¸Šé…ç½®é¡¹å˜æ›´æ€Žä¹ˆæ“ä½œï¼Ÿ

Aï¼šç”Ÿäº§é…ç½®çš„å€¼éœ€è¦ä¿®æ”¹æ—¶ ï¼Œåœ¨ configcenter é¡µé¢ä¸­ä¿®æ”¹ï¼Œå†è§¦å‘ Jenkins æ›´æ–°é…ç½®æ–‡ä»¶çš„ jobï¼Œ ç”Ÿäº§æ–°çš„é…ç½®æ–‡ä»¶ ï¼Œå†è°ƒç”¨ marathon API æ›´æ–° task è¿›è¡Œæ›´æ–°ã€‚

> Qï¼šä¸šåŠ¡çš„é…ç½®æ˜¯å’ŒçŽ¯å¢ƒé…ç½®æ”¾åœ¨ä¸€èµ·çš„ä¹ˆï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œéƒ½æ˜¯é€šè¿‡ envfile è¿›è¡Œç»Ÿä¸€çš„ã€‚

> Qï¼šè¯·é—®ä½ ä»¬é’ˆå¯¹åº”ç”¨å¼¹æ€§æ‰©å±•æ˜¯è‡ªæ„Ÿåº”çš„å—ï¼Ÿå¦‚æžœæ˜¯ï¼Œè¯·é—®æ˜¯åŸºäºŽä»€ä¹ˆç­–ç•¥åšçš„ï¼Œç›‘æŽ§æŠ¥è­¦è¿˜æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šæ•°äººäº‘æ˜¯é€šè¿‡ç›‘æŽ§æŠ¥è­¦è§¦å‘å¼¹æ€§æ‰©å±•çš„ï¼Œå¦‚ç›‘æŽ§æŽ¥å£è¿”å›žçš„æ—¶é—´ï¼Œå®¹å™¨å†…å­˜ä½¿ç”¨çŽ‡ç­‰ã€‚

> Qï¼šè¯·é—®ä½ ä»¬å¯¹çŽ¯å¢ƒå˜é‡æ˜¯é‡‡ç”¨ä»€ä¹ˆæ ·çš„ç®¡ç†æ–¹æ³•ï¼Ÿæœ‰ç›¸åº”çš„å‘½åè§„èŒƒå—ï¼ŸçŽ¯å¢ƒå˜é‡å¤šäº†ï¼Œä¼šå‡ºçŽ°ç®¡ç†æ–¹é¢çš„é—®é¢˜å§ã€‚

Aï¼šçŽ¯å¢ƒå˜é‡é”®å€¼ç”±å¼€å‘ç»´æŠ¤ï¼Œè¿ç»´éœ€è¦æå‰äº†è§£æ–°å¢žçŽ¯å¢ƒå˜é‡ï¼Œç›®å‰åœ¨é…ç½®ä¸­å¿ƒé‡Œç»´æŠ¤ï¼Œå®¹å™¨çŽ¯å¢ƒå˜é‡å˜é‡å‘½åè§„èŒƒå¾ˆé‡è¦ï¼Œæˆ‘ä»¬ç›®å‰é‡‡ç”¨æœåŠ¡å ï¼‹ éœ€è¿žæŽ¥çš„ç»„ä»¶å ï¼‹ å±žæ€§ è¿›è¡Œå‘½åçš„ï¼Œä¸”çŽ¯å¢ƒå˜é‡å…¨éƒ¨å¤§å†™ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 7 æœˆ 14 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æ–¹å¿—æµ©ï¼Œ92 å¹´çš„ç¨‹åºçŒ¿ï¼Œæ¯•ä¸šä¹‹åŽä¸€ç›´åœ¨æ•°äººäº‘ï¼Œå¯¹ Docker å’Œ Mesos æœ‰æ·±å…¥ç ”ç©¶ï¼Œç›®å‰åšæ•°äººäº‘å¹³å°æ‰“åŒ…éƒ¨ç½²ä»¥åŠéƒ¨åˆ†å®¢æˆ·é¡¹ç›®å®žæ–½å·¥ä½œï¼Œå–œæ¬¢åœ¨å®žè·µä¸­å°è¯•æ–°äº‹ç‰©å¹¶æ€»ç»“**ã€‚

---

### 2016-06-30ï¼š Docker ç½‘ç»œæ–¹æ¡ˆåˆæŽ¢

> Qï¼šä»Žä½ å‘çš„ Marathon json æ–‡ä»¶æ¥çœ‹ï¼Œä½ ä»¬æ˜¯å¯¹ Mesos åº•å±‚çš„ç½‘ç»œåšäº†æ‰©å±•å—ï¼Ÿå®¹å™¨ç½‘ç»œé€šè¿‡\"parameters\"ä¼ é€’ä¸‹åŽ»çš„å—ï¼Ÿ

Aï¼šå°±æ˜¯åˆ©ç”¨ Marathon æ”¯æŒçš„ Docker parameters ä¸‹å‘ï¼Œç­‰åŒäºŽ `docker run ---net dataman xxx`ã€‚

> Qï¼šFelix æ ¹æ®é…ç½®çš„ pool åœ°å€æ®µé…ç½®è·¯ç”±ï¼ŒBGP Client é€šå‘Šè·¯ç”±ï¼Ÿè¯·é—® bgp çš„é‚»å±…å…³ç³»æ˜¯æ€Žä¹ˆå»ºç«‹çš„ï¼Ÿæ˜¯ä¾é  etcd é‡Œçš„ä¿¡æ¯ï¼Ÿ

Aï¼šæ˜¯çš„ï¼ŒFelix é…ç½®æœ¬åœ° Kernel è·¯ç”±ï¼ŒBGP Client è´Ÿè´£åˆ†å‘è·¯ç”±ä¿¡æ¯ï¼›BGP å°è§„æ¨¡éƒ¨ç½²é‡‡å– mesh æ–¹å¼å»ºç«‹ï¼Œæ‰€æœ‰èŠ‚ç‚¹äº’è” n\^2 çš„è”ç³»ï¼Œå¤§è§„æ¨¡éƒ¨ç½²æŽ¨è éƒ¨ç½²ä¸€ä¸ªæˆ–å¤šä¸ª BGP route reflectorï¼Œä¸“é—¨è´Ÿè´£è·¯ç”±ä¿¡æ¯åˆ†å‘ã€‚

> Qï¼šè¯·é—®åœ¨ DataMan è¿™ä¸ªç½‘ç»œä¸­è·¯ç”±ä¿¡æ¯æ˜¯å¦‚ä½•æ›´æ–°çš„ï¼Ÿæˆ‘ä»¬çŸ¥é“ BGP æ˜¯å¯ä»¥è‡ªå·±å‘çŽ°æ”¶æ•›ç½‘ç»œçš„ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œæŽ§åˆ¶å±‚é¢æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ

Aï¼šéšç€ä½¿ç”¨ DatMan è¿™ä¸ªç½‘ç»œçš„å®¹å™¨çš„æ·»åŠ æˆ–è€…åˆ é™¤ï¼ŒFelix è´Ÿè´£æ›´æ–°æœ¬åœ°è·¯ç”±ï¼ŒBGP client è´Ÿè´£å‘å¤–åˆ†å‘ï¼›Calico çš„ BGP å’Œå¹¿åŸŸç½‘çš„ BGP è¿˜æ˜¯æœ‰ä¸åŒï¼Œå®ƒåªæ˜¯ä½¿ç”¨ private AS numï¼Œç›¸å¯¹è‡ªæ²»ï¼Œç½‘ç»œæŽ§åˆ¶å±‚é¢éƒ½æ˜¯å¯ä»¥ç¨‹åºæŽ§åˆ¶çš„ã€‚

> Qï¼šè¯·é—® Calico å¦‚ä½•è§£å†³å¤šç§Ÿæˆ·é‡Œåœ°å€å†²çªçš„é—®é¢˜ï¼Ÿ

Aï¼šå¤šç§Ÿæˆ·å®¹å™¨æ··éƒ¨åœ¨åŒä¸€ä¸»æœºä¸Šæ—¶ï¼Œæ‰€ä½¿ç”¨çš„ Network æœ€å¥½ä¸è¦ç”¨åŒä¸€ä¸ª Pool é‡Œçš„å°±å¥½ï¼Œè¿™æ ·å°±ä¸å¯èƒ½æœ‰å†²çªäº†ã€‚

> Qï¼šå¦‚æžœé›†ç¾¤çš„å®¹å™¨å¾ˆå¤šï¼Œé‚£ä¹ˆç›¸åº”çš„è·¯ç”±è¡¨çš„è§„åˆ™ä¹Ÿä¼šå¢žå¤šï¼Œè¿™æ ·ä¼šä¸ä¼šå¯¹ç½‘ç»œæ€§èƒ½é€ æˆå½±å“ï¼Ÿ

Aï¼šç½‘ç»œæ€§èƒ½ä¸ä¼šæœ‰å¤ªå¤§å½±å“ï¼Œå› ä¸ºå®¹å™¨å¤šæµé‡å¤šç½‘ç»œåŽ‹åŠ›æœ¬æ¥å°±å¤§ï¼Œå€’æ˜¯ä¼šå¢žåŠ ç³»ç»Ÿè´Ÿè½½ï¼Œæ¯•ç«Ÿè¦é…ç½®è·¯ç”±è§„åˆ™ï¼ŒåŒæ­¥ç½‘ç»œä¿¡æ¯ï¼›è¿™éƒ¨åˆ†æˆ‘ä»¬ä¹Ÿå¾ˆå…³å¿ƒï¼Œä½†è¿˜æ²¡æœ‰å…·ä½“çš„æµ‹è¯•ç»“æžœã€‚

> Qï¼šè¿˜æœ‰å°±æ˜¯è·¯ç”±ä¿¡æ¯æ˜¯å­˜æ”¾åœ¨ etcd ä¸­å—ï¼Ÿå¦‚ä½•ä¿è¯è·¯ç”±è¡¨çš„è¯»å–æ€§èƒ½å’Œç»´æŠ¤è·¯ç”±è¡¨çš„ä¿¡æ¯æ›´æ–°ï¼Ÿ

Aï¼šç”Ÿæ•ˆçš„è·¯ç”±è‚¯å®šæ˜¯æœ¬åœ°çš„ï¼ŒEndpoint ç­‰ä¿¡æ¯æ˜¯åœ¨ etcd çš„ï¼›è¿™ä¸¤ä¸ªé—®é¢˜éƒ½æ˜¯ Calico è‡ªèº«è¦è§£å†³çš„é—®é¢˜ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬ä¹Ÿå¾ˆå…³å¿ƒï¼Œä½†è¿˜æ²¡æœ‰å…·ä½“çš„æµ‹è¯•ç»“æžœï¼›

> Qï¼šCalico ä¸‹è·¨å¤šä¸ªè·¯ç”± hop çš„æƒ…å†µï¼Œä¸­é—´è·¯ç”±ä¸éœ€è¦å­¦ä¹ è¿™ä¹ˆå¤šçš„å®¹å™¨è·¯ç”±è¡¨å—ï¼Ÿ

Aï¼šä¸éœ€è¦ï¼Œä¸­é—´è¿‡ç¨‹æ˜¯ä¾èµ–èŠ‚ç‚¹ä¹‹é—´åŽŸæœ‰çš„ç½‘ç»œå»ºè®¾çš„ï¼Œåªè¦ä¸¤ä¸ªèŠ‚ç‚¹äº’é€šï¼Œæ‰€æœ‰çš„ hop éƒ½ä¸éœ€è¦çŸ¥é“ Calico å†…éƒ¨çš„å®¹å™¨è·¯ç”±ä¿¡æ¯ã€‚

> Qï¼šè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ç½‘ç»œç®¡ç†é—®é¢˜ã€‚ç›®å‰ä»Žè®¾å¤‡åŽ‚å•†ç½‘ç«™çœ‹æœ‰å‡ ä¸ªæ”¯æŒ VXLAN æŽ§åˆ¶å™¨çš„ã€‚è¿™äº›æŽ§åˆ¶å™¨èƒ½ä¸èƒ½ä¸Žå®¹å™¨ OVS ååŒï¼Ÿç›®å‰æ¥çœ‹æˆ‘ä»¬è¿™é‡Œä¹°å›½å¤–äº§å“è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚

Aï¼šè¿™ä¸ªè‚¯å®šæ˜¯é—®é¢˜ï¼Œæˆ‘è§‰å¾—ä½œä¸ºå¹³å°æ–¹ï¼Œæˆ‘ä»¬èƒ½åšçš„å¾ˆå°‘ï¼Œå¦‚æžœè¦æ”¹å˜ï¼Œè‚¯å®šæ˜¯è¦ SDN è®¾å¤‡åŽ‚å•†å‘åŠ›ï¼Œå°±åƒæ˜¯å„å®¶éƒ½ä¼šåŽ»ä¸º OpenStack é€‚é…è®¾å¤‡æä¾› driver ä¸€æ ·ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦ Docker æˆ–è€…è¯´å®¹å™¨ç¼–æŽ’ç³»ç»Ÿèƒ½åšåˆ°å¦‚åŒ OpenStack é‚£æ ·çš„è¡Œä¸šæ ‡å‡†çº§ã€‚

> Qï¼šCalico èƒ½å’Œ Flannel æ•´åˆä¹ˆï¼ŒCoreOS ä¸Š Kubelet é‡ŒåŒæ—¶å‡ºçŽ°äº† Calico å’Œ Flannelï¼Ÿ

Aï¼šCalico åœ¨ DockerCon 2016 åº”è¯¥æ˜¯é«˜è°ƒæ‹¥æŠ±äº† Flannelï¼Œä¸¤ä¸ªæ•´åˆå‡ºäº†ä¸€ä¸ªå« canal çš„é¡¹ç›®ï¼Œæœ‰å…´è¶£å¯ä»¥åŽ»æ‰¾æ‰¾çœ‹ã€‚

> Qï¼šæˆ‘æƒ³é—®ä¸€ä¸‹è€å¸ˆï¼Œä½ è¿™ VXLAN çš„æ ‡ç­¾æ˜¯ Calico æ‰“çš„å¯¹å§ï¼Ÿ

Aï¼šCalico æ²¡æœ‰ VXLANï¼ŒCalico çš„ tag ä¼šå¯¹åº”åˆ° ipsetï¼Œiptables ç”¨æ¥ match filter è§„åˆ™ã€‚

> Qï¼šCalico ä¸‹è·¨å¤šä¸ªè·¯ç”± hop çš„æƒ…å†µï¼Œä¸­é—´è·¯ç”±ä¸éœ€è¦å­¦ä¹ è¿™ä¹ˆå¤šçš„å®¹å™¨è·¯ç”±è¡¨å—ï¼Ÿ

Aï¼šä¸éœ€è¦ï¼Œä¸­é—´è¿‡ç¨‹æ˜¯ä¾èµ–èŠ‚ç‚¹ä¹‹é—´åŽŸæœ‰çš„ç½‘ç»œå»ºè®¾çš„ï¼Œåªè¦ä¸¤ä¸ªèŠ‚ç‚¹äº’é€šï¼Œæ‰€æœ‰çš„ hop éƒ½ä¸éœ€è¦çŸ¥é“ Calico å†…éƒ¨çš„å®¹å™¨è·¯ç”±ä¿¡æ¯ã€‚

---

### 2016-06-28ï¼šå…¬æœ‰äº‘ä¸Šçš„å®¹å™¨å®žè·µåˆ†äº«

> Qï¼šè¯·é—®ä½ ä»¬æ˜¯ç”Ÿäº§çŽ¯å¢ƒä¹ˆï¼Œåº”ç”¨ä»£ç æ”¾å®¹å™¨é‡Œè¿˜æ˜¯æŒ‚å·ï¼Œé•œåƒæƒé™å¦‚ä½•æŽ§åˆ¶ï¼ˆæ¯”å¦‚æµ‹è¯•å’Œç”Ÿäº§ï¼‰ï¼Œä»£ç æµ‹è¯•åŽï¼Œä¸Šç”Ÿäº§é…ç½®è‡ªåŠ¨è¿˜æ˜¯æ‰‹åŠ¨ä¿®æ”¹è¿˜æ˜¯æœ‰é…ç½®ä¸­å¿ƒå‘¢ï¼Ÿ

Aï¼šæ‚¨æŒ‡çš„æ˜¯æºç è¿˜æ˜¯ç¼–è¯‘åŽçš„äº§ç‰©ï¼Œæˆ‘ä»¬æ˜¯ç¼–è¯‘åŽçš„äº§ç‰©æ˜¯é•œåƒï¼Œå®¹å™¨ç›´æŽ¥è¿è¡Œï¼Œæµ‹è¯•å’Œç”Ÿäº§æ˜¯éš”ç¦»çš„ï¼Œç›¸å½“äºŽæˆ‘ä»¬ç®¡ç†äº†å››å¥—çŽ¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€é¢„å‘ã€ç”Ÿäº§ï¼‰ï¼Œä»‹è´¨æ˜¯é€šè¿‡è·³æ¿æœºåŒæ­¥çš„ï¼Œæœ‰ç»Ÿä¸€çš„ SCM åšä¸åŒçŽ¯å¢ƒçš„é…ç®¡ã€‚

> Qï¼šKubernetes Master çš„é«˜å¯ç”¨ä½ ä»¬æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šMaster æˆ‘è§‰å¾—æ²¡å¿…è¦åšï¼Œå®•äº†é‡å¯å°±è¡Œï¼Œæ²¡æœ‰æŸå¤±ï¼Œæˆ‘ä»¬å°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œåªè¦ä¿è¯ etcd ç­‰é«˜å¯ç”¨å°±è¡Œã€‚

> Qï¼šä»Žé›†ç¾¤å¤–éƒ¨å¯¹ Kubernetes çš„ Service çš„è®¿é—®æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿæ¯”å¦‚å…¬ç½‘ IP æ˜¯æ€Žä¹ˆç»‘å®šç»™ Service çš„ï¼Ÿ

Aï¼šKubernetes å‘å¸ƒæˆ Serviceï¼Œæ˜¯å¯ä»¥ç»™å®š publicip çš„ï¼Œè¿™ä¸ªæ—¶å€™ä½ å¯ä»¥ç”¨å…¬ç½‘ IP ä½œä¸ºç½‘ç»œæ± ï¼Œå†…éƒ¨æœ‰ä¸€å±‚ç«¯å£æ˜ å°„ã€‚

> Qï¼šKubernetes çŽ°åœ¨è‡ªå·±è¿˜ç¼ºå°‘å¯è§†åŒ–ç¼–æŽ’èƒ½åŠ›ï¼Œé‚£ä¸ª UI ä¹Ÿæ˜¯ä»¥ç›‘æŽ§ä¸ºä¸»ï¼Œä½ ä»¬å®žé™…ä½¿ç”¨ä¸­å¯¹ Kubernetes å¯è§†åŒ–ç¼–æŽ’éœ€æ±‚å¤šå—ï¼Œå¦‚æžœå¤šçš„è¯ç›®å‰æ€Žä¹ˆè§£å†³ï¼Ÿ

Aï¼šæˆ‘ä»¬è‡ªå·±åšäº†éƒ¨åˆ†ç¼–æŽ’ï¼Œç¼–æŽ’ä¸ä¸€å®šéžå¾—æ˜¯å›¾å½¢åŒ–çš„ï¼Œæˆ‘ä»¬ä»¥è¡¨å•ä¸ºä¸»ï¼Œä¸»è¦ç”¨äºŽéƒ¨ç½²ç¼–æŽ’ã€‚

> Qï¼šé˜¿é‡Œäº‘ä¸Šçš„å®¹å™¨èƒ½æä¾›è´Ÿè½½å‡è¡¡å˜›æ¯”å¦‚æˆ‘æœ‰ä¸ªå®¿ä¸»æœºæŒ‚äº†ï¼Ÿ

Aï¼šè¿™ä¸ªä¸æ˜¯é˜¿é‡Œäº‘åšï¼Œè€Œæ˜¯ Kubernetes åšçš„ï¼ŒKubernetes æœ‰ Replication çš„èƒ½åŠ›ã€‚

> Qï¼šè¿™å‡ å¤©é‡åˆ°ä¸ªéœ€æ±‚ï¼Œç”¨æˆ·æƒ³è¦é€šè¿‡ VNC è¿›å…¥å®¹å™¨é‡Œå®‰è£…ä»–çš„åº”ç”¨ï¼Œè¯·é—®ä½ ä»¬ç¢°è§è¿‡å—ï¼Œç½‘ç»œæ–¹é¢æ€Žä¹ˆè§£å†³å‘¢ï¼Œéœ€è¦å°†ç”¨æˆ·ä½¿ç”¨çš„å®¹å™¨é…ç½®ä¸Šå¤–ç½‘çš„ IPï¼Œæˆ‘ä»¬ä¹Ÿç”¨ Flannelï¼Œä½† Flannel ä¼¼ä¹Žä¸è¡Œå§ï¼Ÿ

Aï¼šè¿™ä¸æ˜¯ä¸ªå¥½æ–¹å¼ï¼Œè¿™æ˜¯æŠŠå®¹å™¨å½“è™šæœºç”¨ï¼Œå¦‚æžœçœŸè¦è¿™ä¹ˆåšï¼Œé‚£ Flannel å°±ä¸è¦ç”¨äº†ï¼Œç›´æŽ¥ç«¯å£æ˜ å°„æˆ–è€… Pipeworkï¼Œä½†çœŸä¸å»ºè®®ï¼Œä¼šä¸§å¤±å®¹å™¨çš„å¥½ç‰¹æ€§ã€‚

---

### 2016-06-21ï¼šåŸºäºŽ Docker å®žçŽ° DevOps çš„ä¸€äº›æŽ¢ç´¢

> Qï¼šå¯¹äºŽä¸€äº›ä¸­å°äº’è”ç½‘ä¼ä¸šå°¤å…¶ DevOps äºŒæ¬¡å¼€å‘èƒ½åŠ›ä¸å¼ºçš„ï¼Œåœ¨ä½¿ç”¨ Docker é›†ç¾¤æ–¹é¢æœ‰ä»€ä¹ˆå»ºè®®ï¼Ÿ

Aï¼šä¸€æ¡ DevOps æµæ°´çº¿å¯¹é›†ç¾¤çŽ¯å¢ƒçš„éœ€æ±‚ä¸é«˜ï¼Œæˆ‘ä»¬æ›´åº”è¯¥å…³å¿ƒçš„æ˜¯å¯¹æ¯ä¸€ä¸ªæ­¥éª¤çš„å•ä¸ªå·¥å…·æ€Žä¹ˆåŽ»ä½¿ç”¨å’Œç®¡ç†ï¼Œé›†ç¾¤çŽ¯å¢ƒé€‚ç”¨äºŽéƒ½ä¼šç”¨åˆ°å¤§è§„æ¨¡çš„å®¹å™¨éƒ¨ç½²ä¸­ã€‚è¿˜æ˜¯é‚£å¥è¯ï¼ŒæŠ€æœ¯ä¸åˆ†å¥½åï¼Œé€‰æ‹©æœ€åˆé€‚çš„å°±è¡Œã€‚å¦‚æžœæŠŠå®¹å™¨å½“ä½œè™šæ‹Ÿæœºæ¥è·‘ï¼Œå¯ä»¥è§£å†³ä½ çš„ä¸€äº›é—®é¢˜ï¼Œé‚£å°±è¿™æ ·è·‘åˆå¦‚ä½•å‘¢ï¼ŒæŠ€æœ¯æˆ–è€…å·¥å…·æ˜¯ä¸ºéœ€æ±‚æœåŠ¡çš„ã€‚

> Qï¼šè¿ç»´æŠ•æ‹†å¼€å‘åº”ç”¨æ¶ˆè€—å¤ªå¤§ï¼Œä¸ºä»€ä¹ˆç”¨äº†å®¹å™¨å°±èƒ½è§£å†³ï¼Ÿåªæ˜¯å¼€å‘å’Œè¿è¡Œç”¨äº†åŒä¸€å¥—çŽ¯å¢ƒï¼Œæ€§èƒ½ä½Žä¸‹ä¸€æ ·å¾—é ä¼˜åŒ–ï¼Œå®¢å™¨åªæ˜¯è®©å¤§å®¶åœ¨åŒä¸€ä¸ªå¹³å°ä¸Šå¯¹è¯äº†ã€‚

Aï¼šå¯¹çš„ï¼Œå¦‚æžœåº”ç”¨æœ¬èº«çš„ä»£ç å†™å¾—ä¸å¥½ï¼Œä¸è®ºåœ¨å¼€å‘çŽ¯å¢ƒå’Œè¿ç»´çŽ¯å¢ƒéƒ½ä¼šé€ æˆåº”ç”¨æ¶ˆè€—å¤§çš„é—®é¢˜ã€‚ä½¿ç”¨ DevOps è¿™æ ·çš„æµæ°´çº¿ï¼Œä¸€ä¸ªæ–¹é¢å°±æ˜¯è§£å†³çŽ¯å¢ƒå¼‚æž„çš„é—®é¢˜ã€‚å¥½æ¯”æˆ‘æ˜¯ä¸€ä¸ªå¼€å‘è€…ï¼Œæˆ‘åœ¨ Windows é‡Œé¢å¼€å‘ï¼ŒJava ç”¨çš„æ˜¯ 1.5ã€‚ä½†æ˜¯åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼ŒAPP æœåŠ¡å™¨ç”¨çš„æ˜¯ Linuxï¼ŒJava æ˜¯ 1.6ï¼Œé‚£è¿™æ ·å¯èƒ½ä¼šå¼•èµ·åŠŸèƒ½æ€§çš„é—®é¢˜ã€‚

> Qï¼šæ‚¨å¥½ï¼Œæœ‰äº›ä¼ ç»Ÿåº”ç”¨æ¯”è¾ƒéš¾æ‹†åˆ†ï¼Œä¸Šäº‘çš„è¯éš¾å…ä¼šæŠŠå®¹å™¨åšè™šæ‹Ÿæœºç”¨ï¼Œè¯·é—®åœ¨è¿™ä¸€å—æœ‰å¥½çš„å®žè·µä¹ˆï¼Ÿ

Aï¼šä¼ ç»Ÿåº”ç”¨æ‹†åˆ†ç¡®å®žæ˜¯ä¸ªéš¾é¢˜ï¼Œä»Žå¯ç”¨æ€§å’Œæ€§èƒ½æ–¹é¢è€ƒè™‘æŠŠä¼ ç»Ÿåº”ç”¨æ”¾åˆ°å®¹å™¨å½“ä½œè™šæ‹Ÿæœºè·‘æ˜¯å¯ä»¥çš„ã€‚è¿™ç§åœºæ™¯å®žçŽ°äº†ç¡¬ä»¶çš„èµ„æºçš„é«˜åˆ©ç”¨çŽ‡ï¼Œä½†æ˜¯ç”±äºŽä¼ ç»Ÿåº”ç”¨çš„ç´§è€¦åˆï¼Œå¾ˆéš¾ä»¥åˆ©ç”¨åˆ°å®¹å™¨çš„çµæ´»è¿ç§»å’Œå¼¹æ€§éƒ¨ç½²ã€‚è€Œä¸”éœ€è¦å…³å¿ƒçš„æ˜¯ï¼Œä¼ ç»Ÿåº”ç”¨æ”¾åˆ°å®¹å™¨é‡Œé¢è·‘ï¼Œæ•°æ®ä¿æŠ¤è¿™æ–¹é¢åˆ°åº•å¦‚ä½•åŽ»åšã€‚ç›®å‰æˆ‘è¿™è¾¹æ²¡æœ‰å¾ˆå¥½çš„å®žè·µæ–¹æ¡ˆï¼Œè€Œä¸”è¿™ç§æ¡ˆä¾‹ç¡®å®žæ˜¯å›½å†…æ•´ä¸ª Docker ç•Œéœ€è¦é¢ä¸´çš„ä¸€ä¸ªé—®é¢˜ã€‚

> Qï¼šè™šæœºæˆ–å®¹å™¨ï¼Œä¼ ç»ŸåŒæœºèŠ‚ç‚¹æ¨¡å¼éƒ¨ç½²ï¼Œå‡ºé—®é¢˜é€šè¿‡åŒæœºåˆ‡æ¢ä¸»å¤‡åº”ç”¨è¿˜æœ‰æ„ä¹‰ä¹ˆï¼Ÿ

Aï¼šæœ‰ï¼ŒåŒæœºçƒ­å¤‡æˆ–äº’å¤‡çš„æ–¹æ¡ˆæ˜¯åœ¨ä¼ ç»Ÿ IT çŽ¯å¢ƒä¸­ç»åŽ†äº†æ—¶é—´çš„è€ƒéªŒçš„ã€‚å®¹å™¨çš„å‡ºçŽ°å¹¶ä¸æ˜¯è¦é¢ è¦†ä»¥å‰çš„æ‰€æœ‰ï¼Œè€Œæ˜¯è®©å®¢æˆ·çš„åº”ç”¨åœºæ™¯æ‹¥æœ‰ä¸€ä¸ªå¤šçš„é€‰æ‹©ã€‚

> Qï¼šç›®å‰å®¹å™¨åŒ–çš„éƒ½æ˜¯åº”ç”¨ APP ä¹‹ç±»çš„ï¼Œå¯ä»¥ä½¿ç”¨å®¹å™¨åŒ–ä¸€ä¸ªç±» Unix ç³»ç»Ÿä¹ˆï¼Ÿæ¯”å¦‚å®¹å™¨åŒ–ä¸€ä¸ªè‹¹æžœç³»ç»Ÿèƒ½å®žçŽ°ä¹ˆï¼Ÿ

Aï¼šå®¹å™¨çš„å®šä½å°±æ˜¯åœ¨äºŽ APP çš„å°è£…ï¼Œå°±ç®—æœ‰ CentOS è¿™æ ·çš„é•œåƒä¹Ÿåªæ˜¯ä¸ºäº†æ‹‰å–è¿è¡Œåº”ç”¨éœ€è¦çš„ Bin æ–‡ä»¶å’Œ Lib æ–‡ä»¶ã€‚ä½ è¿™ä¸ªé—®é¢˜æœ‰ç‚¹æ˜¯æƒ³æŠŠå®¹å™¨å½“ä½œè™šæ‹Ÿæœºè·‘äº†ï¼Œå¯ä»¥åŽ»äº†è§£ä¸€ä¸‹ RancherVM æˆ– HyperContainerï¼Œæˆ–è®¸èƒ½å¤Ÿæ»¡è¶³ä½ çš„éœ€æ±‚ã€‚

---

### 2016-06-14ï¼šä¼ ç»Ÿä¼ä¸š PaaS å¹³å°åŠŸèƒ½è®¾è®¡ä¸Žä¸šåŠ¡ä¸Šäº‘æ€è€ƒ

> Qï¼šåœ¨ä½ çš„æ–°ä¸€ä»£ PaaS å¹³å°ä¸­ï¼Œæˆ‘æ€Žä¹ˆå¯¹å…¬å¸çš„å¾ˆå¤šä¸ªä¸åŒçš„åº”ç”¨åšä¸åŒçš„é›†ç¾¤ï¼Œæœ‰äº›é›†ç¾¤åå‘äºŽå¤§é‡çš„ IO å ç”¨ï¼Œæœ‰äº›é›†ç¾¤åå‘äºŽå¤§é‡çš„ç½‘ç»œå ç”¨ï¼Œæœ‰äº›é›†ç¾¤åå‘äºŽå¤§é‡çš„å†…å­˜å ç”¨ï¼Œå¹¶ä¸”å¯ç”¨çš„é›†ç¾¤é—´è¿˜æœ‰é€šä¿¡å’Œäº¤äº’ï¼Œé’ˆå¯¹è¿™äº›ä¸å‡è¡¡çŽ°è±¡è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

Aï¼šæ‰€ä»¥ PaaS å¹³å°ç¡¬ä»¶èµ„æºä¼šé’ˆå¯¹ä¸åŒåº”ç”¨åŽ»åšåŒºåˆ†ï¼Œåœ¨ä¼ä¸šç§æœ‰äº‘å»ºè®¾æ—¶ï¼Œéœ€è¦å¯¹åº”ç”¨è¿›è¡Œæ¢³ç†ï¼Œå°†ä¸åŒçš„åº”ç”¨åˆ†ç±»ï¼Œåº•å±‚é‡‡å–ç›¸åº”é›†ç¾¤æ”¯æ’‘ï¼Œæ¯”å¦‚è®¡ç®—å¯†é›†åž‹ã€IO å¯†é›†åž‹ç­‰ï¼ŒåŒæ—¶ç»¼åˆè€ƒè™‘æ³¢å³°æ³¢è°·ä¸Žä¸šåŠ¡ç‰¹æ€§è¿›è¡Œé…ç½®ã€‚

> Qï¼šå…¬å¸æœ‰å¾ˆå¤š Web ç³»ç»Ÿï¼Œæ¯ä¸€ä¸ª Web ç³»ç»Ÿéƒ½æœ‰è‡ªå·±çš„å­˜å‚¨ã€æ•°æ®åº“ï¼Œæ‰€ä»¥å¦‚æžœèžå…¥ PaaS å¹³å°çš„è¯ï¼Œé¦–å…ˆç¬¬ä¸€ç‚¹è½¯ç¡¬ä»¶é—®é¢˜å¦‚ä½•åšåˆ°å…¨éƒ¨æ»¡è¶³ï¼Œå…¶æ¬¡å°±æ˜¯å°±ç®—æŠŠæˆ‘çš„ DB å±‚æ•´åˆè¿å¾™åˆ°ä½ çš„ PaaS çš„ DB å±‚ï¼Œæˆ‘æ˜¯ä¸æ˜¯è¿˜è¦åšå…¶å®ƒæ–¹é¢çš„æŠ•å…¥ï¼Œæ¯”å¦‚å¼€å‘æˆæœ¬ç­‰ç­‰ï¼Œè¿˜æœ‰å°±æ˜¯ DB çš„å…¼å®¹æ€§æ˜¯ä¸æ˜¯ä¼šæœ‰é—®é¢˜ï¼Ÿ

Aï¼šWeb å±‚æˆ‘ä»¬æŽ¨èåšæ— çŠ¶æ€åŒ–ï¼Œä¸”è¦åšåº”ç”¨ä¸Žæ•°æ®åˆ†ç¦»ï¼Œsession ä¿¡æ¯é›†ä¸­å­˜æ”¾ã€‚DB è¿ç§»åˆ° PaaS å±‚æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ…Žé‡çš„è¿‡ç¨‹ï¼ŒPaaS å±‚ä¼˜å…ˆè€ƒè™‘å¼€æºæ•°æ®åº“ã€‚å¦‚æžœåŽŸå…ˆæ˜¯ MySQL åŸºäºŽ PaaS å¹³å°ä¹Ÿæä¾›çš„ MySQL æ•°æ®åº“æœåŠ¡ï¼Œé‚£ä¹ˆå¼€å‘æˆæœ¬åŸºæœ¬æ¯”è¾ƒå°ï¼Œåªéœ€è€ƒè™‘ç‰ˆæœ¬é—®é¢˜ã€‚

> Qï¼šåŽé¢çš„ OLAP ä¸»è¦çš„ä½œç”¨æ˜¯æ•°æ®æ•´åˆå’Œå­˜å‚¨ä¸Žåˆ†æžï¼Œä½†æ˜¯é¦–å…ˆè¦è§£å†³çš„å°±æ˜¯å„ä¸ªåº”ç”¨çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œè¿˜æœ‰å°±æ˜¯æ•°æ®ä¸­åˆåˆ†ä¸šåŠ¡æ•°æ®å’Œéžä¸šåŠ¡æ•°æ®ï¼Œè¿™äº›é—®é¢˜æ˜¯å„ä¸ªåº”ç”¨çš„å›¢é˜Ÿè‡ªå·±è§£å†³å—ï¼Ÿè¯¥æ€Žä¹ˆè§£å†³ï¼Ÿ

Aï¼šæ•°æ®ä»“åº“å¤§æ•°æ®å¹³å°ä¸­æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ç”± ETL+ æ•°æ®å»ºæ¨¡æ¥è§£å†³ï¼Œåº”ç”¨å›¢é˜Ÿè¦å‚ä¸Žä¸€èµ·è¿›è¡Œæ•°æ®åˆ†æžä¸Žå»ºæ¨¡ã€‚

> Qï¼šè¯·é—® MySQL éƒ¨ç½²æ•°æ®åº”ç”¨èƒ½æ‰¿è½½å¤šå¤§æ•°æ®é‡ï¼Œå“åº”é€Ÿåº¦å¦‚ä½•ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œé‡‡ç”¨è¯»å†™åˆ†ç¦»çš„ MySQL æž¶æž„ï¼Œå‡ åƒä¸‡çš„æ•°æ®è¡¨ï¼ŒåŠæ—¶æŸ¥è¯¢æ²¡é—®é¢˜ï¼Œè¿™ä¹Ÿè¦çœ‹ç¡¬ä»¶é…ç½®ä¸Žæ•°æ®ç´¢å¼•çš„å»ºç«‹ç­‰ã€‚

> Qï¼šæœ‰äº›ä¼ ç»Ÿå…¬å¸ï¼Œæœ‰äº›è½¯ä»¶è®¾å¤‡æ˜¯ä»¥åºåˆ—å·å®‰è£…ä½¿ç”¨çš„ï¼Œæ‰€ä»¥è¿™ä¸€å—èžå…¥ PaaS å¹³å°æ˜¯ä¸æ˜¯ä¸å¤ªå¯èƒ½ï¼Ÿ

Aï¼šæ¯”è¾ƒå›°éš¾ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ License é™åˆ¶çš„é—®é¢˜ï¼Œåœ¨å¼¹æ€§æž¶æž„ä¸­ä¹Ÿæ¯”è¾ƒéš¾ã€‚

> Qï¼šè®² session é›†ä¸­åˆ° Redisï¼Œæ˜¯éœ€è¦åšä»£ç å±‚é¢çš„ä¿®æ”¹å—ï¼Ÿ

Aï¼šè¦ä¿®æ”¹ï¼Œæ¯æ¬¡ session çš„æ“ä½œéƒ½è¦åˆ° Redis ä¸­å¢žåˆ æ”¹ã€‚

> Qï¼šè¯·é—®æž¶æž„æ”¹é€ ä¼šä¸ä¼šå¯¼è‡´åº”ç”¨è¦é‡æ–°å¼€å‘ï¼Ÿ

Aï¼šä¼šï¼Œä»Ž IOE æž¶æž„åˆ° x86 æž¶æž„ï¼Œä»Ž x86 ç‰©ç†æœºåˆ°è™šæ‹Ÿæœºåˆ° Dockerï¼Œåº”ç”¨éœ€è¦ä»¥è¶Šæ¥è¶Šå°çš„æ¨¡å—åŒ–åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œä¹Ÿå°±æ˜¯è¯´é€æ­¥å‘å¾®æœåŠ¡åŒ–è¿‡æ¸¡ã€‚

> Qï¼šä¸ºä»€ä¹ˆ Kubernetes å’Œ Mesos è¦ä¸€èµ·ç”¨å‘¢ï¼Œè€ƒè™‘ç‚¹åœ¨å“ªé‡Œï¼Ÿ

Aï¼šé’ˆå¯¹å•ä¸ªåº”ç”¨ Docker åŒ–ï¼Œæˆ‘ä»¬å¼€å§‹çš„é€‰åž‹å®šä½åœ¨ Kubernetesï¼Œä¸»è¦è€ƒè™‘äº† POD çš„åº”ç”¨åœºæ™¯æ›´ç±»ä¼¼è™šæ‹Ÿæœºï¼Œå¦å¤– Kubernetes çš„æ¨¡å—æ¯”è¾ƒä¸°å¯Œï¼Œåƒè´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘çŽ°ç­‰å·²ç»æˆç†Ÿï¼ŒåŽæ¥ç”¨ Mesos æ˜¯å› ä¸ºéœ€è¦æŠŠå¤§æ•°æ®ä¹‹ç±»çš„åº”ç”¨è¿›è¡Œæ•´åˆã€‚éœ€è¦ Kubernetes/Spark on Mesosã€‚

> Qï¼šåˆ†å¤„äºŽä¸åŒå­ç½‘çš„å®¹å™¨å’Œè™šæ‹Ÿæœºä¹‹é—´ä¸‰å±‚ç½‘ç»œé€šä¿¡å¦‚ä½•è§£å†³çš„ï¼Ÿä¸­é—´è¿˜èµ°ä¼ ç»Ÿä¸‰å±‚äº¤æ¢æœºï¼Ÿ

Aï¼šä¸‰å±‚ç½‘ç»œä¹‹é—´çš„äº’é€šè¿˜æ˜¯èµ°ä¸‰å±‚äº¤æ¢æœºã€‚äºŒå±‚ç»„ç½‘æˆ‘ä»¬åŸºäºŽ OVS+VXLANã€‚

> Qï¼šå¼€å‘å‘¨æœŸè¿‡é•¿æˆ–è€…å®¢æˆ·å¼€å‘èƒ½åŠ›å¼±ä¼šå¯¼è‡´æ•´ä¸ªæž¶æž„æµäº§æœ‰é…å¥—çš„åº”ç”¨æ”¹é€ æ–¹æ¡ˆå—ï¼Ÿ

Aï¼šå¯¹ä¼ ç»Ÿä¼ä¸šè€Œè¨€ï¼Œä¸€å¼€å§‹å°±æ­å»ºä¸€ä¸ªå¤§è€Œå…¨ PaaS æ–¹æ¡ˆæ˜¯ä¸çŽ°å®žçš„ï¼Œæˆ‘ä»¬æŽ¨èä»ŽæŸä¸€ä¸ªå…¸åž‹åº”ç”¨åšèµ·ã€‚æˆ‘ä»¬é’ˆå¯¹äº¤æ˜“æ€§åº”ç”¨ã€åˆ†å¸ƒå¼åº”ç”¨ã€æ‰¹å¤„ç†åº”ç”¨ç­‰åº”ç”¨éƒ½æœ‰é…å¥—æ”¹é€ æ–¹æ¡ˆã€‚

> Qï¼šå¦å¤–å¤§é‡é‡‡ç”¨å¼€æºå·¥å…· å¦‚ä½•è§£å†³ ç‰ˆæœ¬å‡çº§åŠåŽæœŸç»´æŠ¤ï¼Ÿ

Aï¼šä¸€èˆ¬ä¼šè·Ÿåº”ç”¨çš„ä»£ç é…å¥—åšç‰ˆæœ¬å‡çº§ä¸Žç»´æŠ¤ã€‚

> Qï¼šMesos ä½¿ç”¨é›†ä¸­å¼å­˜å‚¨å’Œåˆ†å¸ƒå¼å­˜å‚¨æ•ˆçŽ‡ä¸Šæœ‰ä»€ä¹ˆä¸åŒå—ï¼Ÿ

Aï¼šè¿™ä¸ªçœ‹åº”ç”¨ï¼Œé›†ä¸­å¼å­˜å‚¨åœ¨é›†ç¾¤ä¸­åº”ç”¨æ—¶ï¼Œå¦‚æžœé’ˆå¯¹å•ä¸€ä¸Žåº”ç”¨åˆ’åˆ† Volumeï¼Œæ€§èƒ½ä¼šå¥½ä¸€äº›ï¼Œå¦‚æžœæ˜¯åˆ†å¸ƒå¼åº”ç”¨ï¼Œæ¯”å¦‚ MR ç±»çš„åº”ç”¨ï¼Œåˆ†å¸ƒå¼å­˜å‚¨åè€Œä¼šå¥½ã€‚

> Qï¼šå®¹å™¨å¼¹æ€§ä¼¸ç¼©ç­–ç•¥å…·ä½“æ€Žä¹ˆè€ƒè™‘çš„ï¼ŒCPUï¼Ÿ

Aï¼šCPUã€å†…å­˜ã€IOã€ç”¨æˆ·è¿žæŽ¥æ•°ç­‰éƒ½å¯ä»¥ä½œä¸ºå¼¹æ€§ä¼¸ç¼©çš„ç­–ç•¥ä¾æ®ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 6 æœˆ 14 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**ç‰›ç»§å®¾ï¼Œæ›¾ä»» VMware ç ”å‘ä¸­å¿ƒç ”å‘å·¥ç¨‹å¸ˆï¼ŒIBM å®žéªŒå®¤æœåŠ¡éƒ¨é«˜çº§æŠ€æœ¯ä¸“å®¶ï¼Œç›®å‰åœ¨å¤©äº‘è½¯ä»¶ï¼ˆåŒ—äº¬å¤©äº‘èžåˆ›è½¯ä»¶æŠ€æœ¯æœ‰é™å…¬å¸ï¼‰æ‹…ä»»æŠ€æœ¯æ€»ç›‘ã€‚æ“…é•¿äº‘è®¡ç®—ä¸Žå¤§æ•°æ®ç›¸å…³æŠ€æœ¯ï¼Œé™¤äº†åº•å±‚å¹³å°æŠ€æœ¯ï¼Œå¯¹äº‘è®¡ç®—è§£å†³ IT åº”ç”¨ç³»ç»Ÿçš„å®žé™…é—®é¢˜ã€åº”ç”¨çš„åˆ†å¸ƒå¼æ”¹é€ ã€ä¸šåŠ¡æ”¯æ’‘ç­‰ä¹Ÿæœ‰ä¸°å¯Œçš„ç»éªŒã€‚

---

### 2016-05-31ï¼šç«™åœ¨è¿ç»´çš„è§’åº¦è®²å¦‚ä½•æ‰“é€ ä¸€ä¸ª Docker-Mesos å¹³å°

> Qï¼šæ‚¨å¥½ï¼Œè¯·é—®ä¸€ä¸‹ä½ ä»¬çš„ç›‘æŽ§é‡‡ç”¨çš„æ˜¯ä»€ä¹ˆæ–¹æ¡ˆï¼Ÿå‘çŽ°"å˜æ…¢"åŽçš„åŠ¨ä½œæ˜¯è‡ªåŠ¨çš„è¿˜æ˜¯éœ€è¦äººå·¥ä»‹å…¥çš„å‘¢ï¼Ÿ

Aï¼š1ã€æˆ‘ä»¬ PaaS ä¸Šçš„ SaaS ä¸šåŠ¡çš„æ¡†æž¶ï¼Œç”±å¹³å°éƒ¨ç»Ÿä¸€æä¾›ï¼Œæ¡†æž¶æœ¬èº«é›†æˆäº†å¥åº·æ£€æŸ¥ï¼ˆå­˜æ´»çŠ¶æ€ï¼Œå“åº”æ—¶é—´ï¼‰ï¼›2ã€è¿ç»´å¼€å‘å°ç»„ä¼šé’ˆå¯¹äºŽè¿™äº›æœ‰ä¸€å¥—ç›‘æŽ§ï¼›3ã€å¦å¤–é’ˆå¯¹äºŽå˜æ…¢ï¼Œæˆ‘ä»¬æœ‰ Zabbixã€æ—¥å¿—æ”¶é›†ã€trace ç³»ç»Ÿç»Ÿä¸€æ¥åšæ•°æ®å±•ç¤ºã€åˆ†æžã€æ¯”å¯¹æŠ¥è­¦ã€‚

> Qï¼šè¯·é—®ï¼Œä½ ä»¬çŽ¯å¢ƒçš„å­˜å‚¨ç”¨çš„æ˜¯æœ¬æœºå­˜å‚¨è¿˜æ˜¯åˆ†å¸ƒå¼å­˜å‚¨ï¼Ÿ

Aï¼šç”±äºŽæˆ‘ä»¬çš„ä¸šåŠ¡ç›´æŽ¥èµ°çš„ RDSï¼Œå­˜åœ¨æœ¬åœ°çš„åªæœ‰æ—¥å¿—ï¼Œæˆ‘ä»¬çš„æ—¥å¿—æ˜¯æŒ‚è½½æœ¬åœ°ï¼Œè§„èŒƒäº†å­˜æ”¾çš„æ ¼å¼ï¼Œç»Ÿä¸€æ”¶èµ°æ¥åšæ—¥å¿—åˆ†æžã€trace é—®é¢˜æŽ’æŸ¥ç³»ç»Ÿç­‰ã€‚

> Qï¼šè¯·é—® Docker ä½ ä»¬æ˜¯å¦‚ä½•åšé‰´æƒçš„ï¼Ÿå³æŽ§åˆ¶å“ªäº›äººå¯ä»¥ä½¿ç”¨ Docker Registry å“ªäº›åˆå¯æ‰§è¡Œ push ç­‰æ“ä½œï¼Ÿæ€Žä¹ˆå®žçŽ°çš„ï¼Ÿè°¢è°¢ï¼

Aï¼š1ã€é¦–å…ˆé‰´æƒåˆ†ä¸ºä¸šåŠ¡å±‚å’Œ PaaS å±‚ï¼Œä¸šåŠ¡å±‚æˆ‘ä»¬é…å¥—äº†æ¡†æž¶åŠ API GATEWAY/è®¤è¯ç³»ç»Ÿç­‰æ¥åšä¸šåŠ¡ä¸Šçš„é‰´æƒï¼›2ã€Docker å±‚çš„æˆ‘ä»¬è¿™é‡Œåšçš„æ¯”è¾ƒç®€å•ï¼šæˆ‘ä»¬çš„ Registry åªåšäº†ç®€å•çš„é‰´æƒï¼Œç”±äºŽæˆ‘ä»¬åªä¸ºå†…ç½‘æœåŠ¡ï¼Œæ‰€ä»¥ otheruser éƒ½å…·æœ‰ pull æƒé™ï¼Œæˆ‘ä»¬çš„ push æ“ä½œåªæœ‰å•ç‹¬çš„å‡ å°æœºå™¨ã€æ“ä½œäººå‘˜å¯ä»¥é€šè¿‡ Jenkins æ“ä½œï¼ˆè¿™é‡Œæˆ‘ä»¬åšäº†å°è£…å¼€å‘ï¼‰ã€‚

> Qï¼šå¯ä»¥è®²è®²åœ¨ CentOS 7 è·‘ Java çš„æ—¶å€™ï¼Œå¯¹ JRE å’Œ JDK åšäº†å“ªäº›ä¿®æ”¹å—ï¼Ÿè·‘ Java åº”ç”¨æŒ‰ç†è¯´ JRE å°±å¤Ÿç”¨äº†ä¹ˆï¼Ÿ

Aï¼šç†è®ºä¸Š JRE å°±å¤Ÿäº†ï¼Œä½†æ˜¯ä¸æŽ’é™¤ä¸€äº›å…¶ä»–éœ€è¦ javac ç­‰çš„å˜› O(âˆ©\_âˆ©)O\~ï¼›å¦å¤–ä¿®æ”¹çš„æœ€é‡è¦çš„ç®—æ˜¯å†…å­˜ç»†åˆ†çš„é™åˆ¶äº†ï¼ˆçœ‹ä¸šåŠ¡è¦æ±‚ï¼Œæˆ‘ä»¬å¯¹å•ä¸ªå®¹å™¨ä½¿ç”¨çš„å†…å­˜ä¸¥æ ¼é™åˆ¶ï¼‰ï¼Œä»¥åŠä¸€äº›ç¬¬ä¸‰æ–¹çš„ APM æ€§èƒ½ç›‘æŽ§æ’ä»¶ã€‚

> Qï¼šå¯¹äºŽ Java åº”ç”¨ï¼Œå¦‚ä½•è®¾ç½® DataSourceï¼Ÿæˆ‘çš„æ„æ€çš„æµ‹è¯•çŽ¯å¢ƒå’Œç”Ÿäº§ï¼Œå¦‚æžœç”¨åŒä¸€ä¸ª imageï¼Ÿ

Aï¼šé’ˆå¯¹äºŽä¸åŒçš„çŽ¯å¢ƒï¼Œæˆ‘ä»¬åœ¨ç”¨å°è£…è¿‡çš„ Jenkins æ¥æ‰“ç›¸åº”çš„é•œåƒï¼Œä¹Ÿå°±æ˜¯ä¸åŒçŽ¯å¢ƒçš„é•œåƒåœ¨ build çš„æ—¶å€™çš„æ“ä½œï¼Œå…¶å®žä¸ä¸€æ ·ã€‚é’ˆå¯¹äºŽçŽ¯å¢ƒä¿¡æ¯çš„é…ç½®æ”¾åœ¨ etcd ä¸­ã€‚

> Qï¼šè¯·é—®æ•´ä¸ªé¡¹ç›®ä¸­çš„å¤§æ¦‚æˆæœ¬æ¯”ä¾‹å‘¢ï¼Ÿå¦‚ä½•å®šä¹‰å„ç§æˆæœ¬ï¼Ÿ

Aï¼šè¿™ç‚¹æ¯”è¾ƒéš¾è¯´ï¼Œçœ‹å…¬å¸çš„æ€åº¦å§ï¼Œæ¯”å¦‚ç™¾åº¦å’Œè…¾è®¯å¯¹äºŽæ–°æŠ€æœ¯çš„æŠ•å…¥æ¯”ä¾‹å°±è¿œè¿œä¸åŒã€‚

> Qï¼šè¯·é—®ï¼Œä½¿ç”¨ host æ¨¡å¼ï¼Œä½ ä»¬ç›®å‰æ€Žä¹ˆå®žçŽ°å¯¹ç«¯å£çš„åˆ†é…æŽ§åˆ¶ï¼Ÿ

Aï¼šç«¯å£æ˜¯ç”± Marathon éšæœºåˆ†é…çš„ï¼Œä¸è¿‡å¯ä»¥é’ˆå¯¹ç«¯å£æ®µæ¥åšæŽ§åˆ¶ã€‚ä¸€ä¸ªæœºå™¨å¯ä»¥å¼€å‡ åƒä¸ªç«¯å£ï¼Œä½†æ˜¯å®¹å™¨å°±å¼€ä¸äº†é‚£ä¹ˆå¤šå•¦ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 5 æœˆ 31 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**é™ˆå»¶å®—ï¼Œæ­å·žæ•°äº‘è¿ç»´å·¥ç¨‹å¸ˆï¼Œå·¥ä½œå†…å®¹æ¯”è¾ƒå¤šã€æ‚ï¼šDocker/åŸºç¡€æœåŠ¡/SRE ç­‰ç­‰ã€‚

---

### 2016-05-30ï¼šè™šæ‹ŸåŒ–è€å…µä»‹ç»è™šæ‹ŸåŒ–æŠ€æœ¯

> Qï¼šè™šæœºè¿ç§»æ˜¯å¦æœ‰æ¶‰åŠï¼Ÿä¸è®ºæ˜¯è´Ÿè½½è§¦å‘è¿˜æ˜¯å®¹ç¾è§¦å‘æˆ–è€…ä¸šåŠ¡é€»è¾‘è§¦å‘ã€‚

Aï¼šè´Ÿè½½è§¦å‘çš„æœ‰ DRSï¼Œçœç”µæ¨¡å¼ã€‚åŸºæœ¬è€ƒè™‘æ˜¯è´Ÿè½½é«˜æ—¶å¾€ä½Žè´Ÿè½½ä¸Šè¿ç§»ï¼Œçœç”µæ¨¡å¼åˆ™æ­£å¥½ç›¸åï¼ŒæŠŠè™šæ‹Ÿæœºé›†ä¸­èµ·æ¥ï¼Œå…³é—­é‚£äº›ä¸éœ€è¦çš„è™šæ‹Ÿæœºã€‚

> Qï¼šKVM çš„ Host å†…æ ¸å‚æ•°å¼€å¯ IP è½¬å‘ä½œç”¨æ˜¯å•¥ï¼Œå¦‚æžœä½¿ç”¨çš„æ˜¯æ¡¥æŽ¥ç½‘ç»œæ˜¯å¦ä¸€æ ·éœ€è¦å¼€å¯ï¼Ÿ

Aï¼šä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯éœ€è¦å¼€å¯çš„ï¼Œå¦‚æžœç‰©ç†æœºéœ€è¦ç»™è™šæ‹Ÿæœºç½‘ç»œé€šä¿¡çš„è¯ã€‚

> Qï¼šå®¹å™¨åŒ–å–ä»£è™šæ‹ŸåŒ–çœŸçš„åªæ˜¯æ—¶é—´é—®é¢˜å—ï¼Ÿ

Aï¼šè™šæ‹ŸåŒ–æŠ€æœ¯æºäºŽä»¥ CPU ä¸ºæ ¸å¿ƒçš„ç¡¬ä»¶èƒ½åŠ›æº¢å‡ºï¼Œä¸€è™šå¤šä¹Ÿç»°ç»°æœ‰ä½™ã€‚å¸¦æ¥çš„ç»“æžœï¼š1.é™ä½Ž x86 ç¡¬ä»¶å¹³å°çš„å·®å¼‚æ€§ï¼ŒVM éšä¾¿æ¼‚ç§»ï¼›2.å¯ç»Ÿä¸€ç®¡ç†æ± åŒ–åŽçš„èµ„æºï¼Œæé«˜ç®¡ç†æ€§å’Œåˆ©ç”¨æ•ˆçŽ‡ï¼›3.ä¸åŒ guest os çš„ vm å¯åŒæ—¶è¿è¡Œåœ¨åŒä¸€ä¸ªä¸»æœºé‡Œï¼›4.å„å±‚çº§ï¼Œå„ç§ç±»è½¯ä»¶è¿‘ä¹Žé›¶æˆæœ¬å¾€ä¸Šè¿ç§»ã€‚ æ‰€ä»¥ï¼ŒçŸ­æœŸæœªæ¥æ›´æœ‰å¯èƒ½çš„æ˜¯ï¼šè™šæ‹ŸåŒ–ä¸Žå®¹å™¨å„è´Ÿè´£è‡ªå·±æ“…é•¿çš„éƒ¨åˆ†ï¼Œç”±äºŽæ›´å®¹æ˜“ä¸ŽçŽ°æœ‰ä¸–ç•Œ"å…¼å®¹"ï¼Œè™šæ‹ŸåŒ–å çš„å¸‚åœºä»½é¢å¯èƒ½ä¼šæ›´å¤§ã€‚é•¿æœŸæœªæ¥ï¼Œå½“ç»Ÿä¸€çš„ä¸–ç•Œä»€ä¹ˆéƒ½æä¾›æ—¶ï¼Œå“ªé‡Œéƒ½å¯è¿è¡Œæ—¶ï¼Œè™šæ‹ŸåŒ–ï¼Œå®¹å™¨ï¼Œä½ ï¼Œæˆ‘å¯èƒ½éƒ½å·²ä¸å­˜åœ¨ã€‚

> Qï¼šåŽé¢è®²åˆ°çš„ Docker å…·ä½“ Ceph çš„é«˜å¯ç”¨å’Œè¿ç§»ï¼Œæ˜¯å·²ç»å®žçŽ°äº†ï¼Œè¿˜æ˜¯åªæ˜¯ä¸€ä¸ªè®¾æƒ³ï¼Ÿ

Aï¼šè®¾æƒ³ï¼ŒåŽŸè®¡åˆ’è¿™ä¹ˆåŽ»åšï¼Œä½†æœ‰å…¶ä»–ä¼˜å…ˆçº§çš„äº‹æƒ…å°±æ²¡åšäº†ã€‚

> Qï¼šè¯·é—®æ¡Œé¢è™šæ‹ŸåŒ–æœ‰ä»€ä¹ˆç—›ç‚¹ï¼Œæˆ–è€…éš¾ç‚¹ä¹ˆï¼Ÿ

Aï¼šä¸šåŠ¡ä¸Šçš„ç–¼ç‚¹ï¼š 2ï¼‰åè®®çš„åˆ†æžï¼Œç ”ç©¶ï¼Œä»¥åŠæ”¹è¿›ã€‚

> Qï¼šKVM è™šæ‹ŸåŒ–ä¸­ Linux å†…æ ¸çš„ä¸¤ä¸ªæ¨¡å— kvm å’Œ kvm_intel å…·ä½“èµ·åˆ°ä»€ä¹ˆä½œç”¨ï¼Ÿ

Aï¼šæˆ‘æœ‰æ®µæ—¶é—´æ²¡æœ‰æ‘¸å…·ä½“çš„ä»£ç äº†ï¼Œkvm å’Œ kvm_intel ç»„åˆåœ¨ä¸€èµ·å®Œæˆ KVM å†…æ ¸ç›¸å…³çš„å·¥ä½œã€‚

---

### 2016-05-19ï¼šå®¹å™¨çš„é…ç½®ç®¡ç†

> Qï¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼ŒåŸºç¡€é•œåƒçš„ç»§æ‰¿ç®¡ç†å’Œå¦‚ä½•å¤„ç†å¤šä¸ªæŠ€æœ¯æ ˆçš„åº”ç”¨ç‰ˆæœ¬ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯¹äºŽ CentOS 7ï¼Œåšäº†å…¬å¸çº§åˆ«çš„åŸºç¡€ OS é•œåƒ Aï¼ŒåŸºäºŽè¿™ä¸ªé•œåƒåŠ å…¥äº† JDK æˆä¸ºé•œåƒ Bï¼ŒåŸºäºŽ B åŠ å…¥äº† JBOSS æˆä¸º Cï¼Œåœ¨ C çš„åŸºç¡€ä¸Šå†æž„å»ºé¡¹ç›®çš„ APP é•œåƒ Dã€‚é—®é¢˜æ¥äº† 1ï¼Œæœ‰æ²¡æœ‰åŠžæ³•é’ˆå¯¹ A é•œåƒä¿®æ”¹äº†ï¼ŒBï¼ŒC å’Œ D åŽ»çº§è¿žæ›´æ–°ã€‚2ï¼Œç”±äºŽæ˜¯ç»§æ‰¿å…³ç³»ï¼Œå„å±‚è½¯ä»¶çš„ç‰ˆæœ¬ä¸åŒï¼Œå¯¼è‡´é•œåƒç§ç±»å°±ç‰¹åˆ«å¤šï¼Œä¾‹å¦‚ JDK æœ‰ 3 ç§ï¼Œjboss æœ‰ä¸‰ç§ï¼Œé‚£ä¹ˆé•œåƒ C å°±æœ‰ä¹ç§ï¼ŒæŠ€æœ¯æ ˆæ·±äº†ï¼Œå‘½ååˆæˆä¸ºäº†é—®é¢˜ã€‚æ±‚æŒ‡å¯¼è§£å†³æ€è·¯ï¼Ÿ

Aï¼šé•œåƒå¦‚æžœæ¶‰åŠåˆ°ç»§æ‰¿ï¼Œéœ€è¦é€šè¿‡ Jenkins ä¹‹ç±»çš„å·¥å…·å®žçŽ°é“¾å¼è‡ªåŠ¨æž„å»ºã€‚ Jenkins ä¸­çš„ä»»åŠ¡å¯ä»¥è®¾ç½®è§¦å‘æ¡ä»¶ï¼Œåœ¨æŸä¸ªä»»åŠ¡å®ŒæˆåŽè‡ªåŠ¨è§¦å‘æœ¬ä»»åŠ¡ã€‚ä¾èµ–å…³ç³»å¯ä»¥åœ¨ Jenkins çš„ Jobs é‡Œé¢å®šä¹‰æ¸…æ¥šã€‚ é•œåƒå‘½åé—®é¢˜ï¼Œå¯ä»¥ç”¨é•œåƒå +tag çš„æ–¹å¼ï¼Œå¦‚ï¼štomcat:8-jre-7

> Qï¼šæˆ‘æœ‰ä¸ªé—®é¢˜ã€‚çŽ°åœ¨è¿™ä¸ªå¹³å°åªæ˜¯ Web æœåŠ¡çº§çš„ PaaS å¹³å°ä¹ˆï¼Ÿ

Aï¼šcSphere ç›®å‰é™¤æ”¯æŒ Web æœåŠ¡å¤–ï¼Œè¿˜æ”¯æŒä»»æ„å¤æ‚åº¦çš„ä¼ä¸šçº§åº”ç”¨ã€‚å¯ä»¥å®žçŽ°å¤šä¸ªç›¸äº’å…³è”çš„æœåŠ¡çš„ä¸€é”®å¿«é€Ÿéƒ¨ç½²å’ŒçŽ¯å¢ƒ Cloneã€‚

> Qï¼šæœ‰æ²¡æœ‰æ‰“ç®—å¼€æºä½ ä»¬è¿™å¥—å®¹å™¨çš„é…ç½®ç®¡ç†ç³»ç»Ÿï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬æœ‰ä¼ä¸šç‰ˆå’Œå…è´¹ç‰ˆã€‚å…¶ä¸­å…è´¹ç‰ˆå¯ä»¥æ ¹æ®æˆ‘ä»¬å®˜æ–¹ç½‘ç«™ä¸Šçš„æ–‡æ¡£è‡ªå·±å®‰è£…éƒ¨ç½²ã€‚å¼€æºæ–¹é¢æˆ‘ä»¬ä¸»è¦ä»¥å‘ Docker çš„å¼€æºé¡¹ç›®ä¸­è´¡çŒ®ä»£ç ä¸ºä¸»ã€‚

> Qï¼šè¿™é‡Œ Agent èƒ½å¦ç†è§£æˆé€šè¿‡ä¼™ä¼´è¿›ç¨‹çš„æ–¹å¼æ¥å®žçŽ°çš„é…ç½®ç®¡ç†ï¼Ÿé‚£æ˜¯å¦è¿žå¸¦æœ‰æœåŠ¡å‘çŽ°çš„åŠŸèƒ½ï¼Ÿ

Aï¼šè¿™é‡Œçš„ Agent å°±æ˜¯ cSphere åœ¨æ¯å°ä¸»æœºä¸Šçš„ Agentï¼Œè¯¥ Agent ä¸ŽæŽ§åˆ¶å™¨ååŒå¤„ç†æ‰€æœ‰ç®¡ç†å·¥ä½œï¼ŒåŒ…æ‹¬é…ç½®å¼•æ“Žã€‚é…ç½®å¼•æ“Žæœ¬èº«æ”¯æŒåº”ç”¨ã€æœåŠ¡ã€å®¹å™¨ã€èŠ‚ç‚¹å››ç§å¯¹è±¡çš„å‘çŽ°ï¼Œä¸ä»…ä»…æ˜¯æœåŠ¡å‘çŽ°ã€‚

> Qï¼šè¯·é—®æ®ä½ æ‰€çŸ¥å…¶ä»–ç±»ä¼¼å¹³å°å¦‚ä½•è§£å†³åˆšåˆšæåˆ°çš„é…ç½®é—®é¢˜å‘¢ï¼Ÿ

Aï¼šæ®æˆ‘æ‰€çŸ¥ï¼ŒåŒ…æ‹¬ Docker å®˜æ–¹äº§å“åœ¨å†…çš„ä¸€äº›äº§å“è¿˜æ˜¯ä¸»è¦ä»¥ä¿®æ”¹é…ç½®åŽé‡å¯å®¹å™¨æˆ–è€…é€šè¿‡-v å‚æ•°æ˜ å°„é…ç½®æ–‡ä»¶çš„æ–¹æ³•è§£å†³ã€‚è¿™æ ·åšä¸»è¦é—®é¢˜æ˜¯é…ç½®æ–‡ä»¶çš„æ›´æ–°ä¸Žå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸè”åŠ¨ä¸èµ·æ¥

> Qï¼šè¯·é—®å˜‰å®¾ï¼Œä½ ä»¬è¿™ä¸ªé…ç½®ç®¡ç†ç³»ç»Ÿæ˜¯è‡ªå·±å®Œå…¨ç‹¬ç«‹å¼€å‘çš„ï¼Œè¿˜æ˜¯å€Ÿé‰´äº†å“ªä¸ªå¼€æºé¡¹ç›®ï¼Ÿ

Aï¼šé…ç½®ç®¡ç†ç³»ç»Ÿå®Œå…¨æ˜¯æˆ‘ä»¬è‡ªå·±ç‹¬ç«‹å¼€å‘çš„ã€‚é…ç½®ç®¡ç†çš„ Agent é™¤è´Ÿè´£é…ç½®ç®¡ç†å¤–ï¼Œè¿˜è´Ÿè´£æŽ§åˆ¶å™¨ä¸Žå„ä¸»æœºä¸Šçš„ Docker Daemon çš„é€šä¿¡ã€ç›‘æŽ§æ•°æ®é‡‡é›†ç­‰å·¥ä½œã€‚

> Qï¼šèƒ½å¦è¯¦ç»†è®²è§£ä¸‹ Agent å¦‚ä½•è£…è½½é…ç½®æ–‡ä»¶çš„

Aï¼šDocker 1.9 ä¸ºäº†æ”¯æŒæ‰€è°“çš„"å®Œå…¨å®¢æˆ·ç«¯é•œåƒæž„å»º"èƒ½åŠ›ï¼Œä¸º docker cp å‘½ä»¤æ·»åŠ äº†å‘å®¹å™¨ä¼ æ–‡ä»¶çš„ APIã€‚æˆ‘ä»¬é€šè¿‡è¿™ç§æœºåˆ¶æŠŠé…ç½®æ–‡ä»¶"è£…"åˆ°å®¹å™¨é‡Œ

> Qï¼šCreate -\> ä¸‹å‘é…ç½® Start è¿™æ ·ç¡®ä¿å®¹å™¨å¯åŠ¨ä¹‹å‰å·²ç»åŠ è½½äº†æ­£ç¡®çš„é…ç½®æ–‡ä»¶ã€‚è¿™ä¸€æ­¥çš„ä¸‹å‘é…ç½®æ˜¯æ€Žä¹ˆåšçš„ï¼Œå› ä¸ºé‚£ä¸ªæ—¶å€™å®¹å™¨è¿˜æ²¡å¯åŠ¨ï¼Ÿ

Aï¼šå‘å®¹å™¨é‡Œ copy æ–‡ä»¶å¹¶ä¸éœ€è¦å®¹å™¨å¤„äºŽè¿è¡ŒçŠ¶æ€ï¼Œåªè¦å®¹å™¨å­˜åœ¨å°±èƒ½ copyã€‚

> Qï¼šæ”¯æŒæ‰¹é‡éƒ¨ç½²ä¸Šç™¾å°æœåŠ¡å—ï¼Ÿè‡ªå®šä¹‰éƒ¨ç½²åˆ°ä¸åŒçš„çŽ¯å¢ƒã€‚

Aï¼šcSphere çš„é…ç½®å¼•æ“Žï¼Œæ”¯æŒæ‰¹é‡ä¸‹å‘ï¼Œå¯ä»¥é€‰æ‹©æŸä¸ªæœåŠ¡æˆ–å¤šä¸ªæœåŠ¡ï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹ä¸ªåˆ«å®¹å™¨åšç°åº¦ä¸‹å‘ï¼ŒåŒæ—¶æ”¯æŒä¸Šåƒå®¹å™¨æ²¡æœ‰é—®é¢˜ã€‚å¦å¤–é’ˆå¯¹ä¸åŒçŽ¯å¢ƒéƒ¨ç½²ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ¨¡ç‰ˆåŒ–èƒ½åŠ›ï¼Œè§£å†³çŽ¯å¢ƒä¹‹é—´çš„å¾®å°å·®å¼‚ï¼Œæ—¢å¯ä»¥é€šè¿‡ç”¨æˆ·å®šä¹‰å˜é‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç±»ä¼¼å‘çŽ°çš„æŠ€æœ¯è‡ªåŠ¨è®¡ç®—å‡ºå¯¹åº”å‚æ•°ï¼Œæ¯”å¦‚ MySQL InnoDB çš„ Buffer éœ€è¦æ ¹æ®å†…å­˜åšä¸€ä¸ªå…¬å¼è®¡ç®—ã€‚

> Qï¼šè¯·é—® Agent åœ¨å‘çŽ°æ–°çš„é…ç½®åŽï¼Œé’ˆå¯¹ä¸åŒå®¹å™¨æ˜¯æ‰§è¡Œä¸åŒå‘½ä»¤æ˜¯æ€Žä¹ˆç®¡ç†çš„ï¼Ÿæ‰§è¡Œçš„å‘½ä»¤å’Œå®¹å™¨ä¸­åº”ç”¨è¿è¡ŒçŠ¶æ€æœ‰å…³ç³»å—ï¼Ÿ

Aï¼šåœ¨é…ç½®æ–‡ä»¶ä¸‹å‘åŽæ‰§è¡Œçš„å‘½ä»¤æ˜¯ä¸Žå®¹å™¨æ‰€å±žçš„åº”ç”¨å…³è”çš„ï¼Œè¦æ‰§è¡Œçš„å‘½ä»¤å¹¶ä¸æ˜¯é…ç½®æ–‡ä»¶çš„ä¸€ä¸ªå±žæ€§ã€‚æ¯”å¦‚ï¼šæŸä¸ªé…ç½®æ–‡ä»¶åŒæ—¶åœ¨ A åº”ç”¨å’Œ B åº”ç”¨é‡Œéƒ½ç”¨åˆ°ï¼Œå¯ä»¥é…ç½®ä¸ºåœ¨ A åº”ç”¨ä¸‹å‘åŽæ‰§è¡Œ restart containerï¼ŒåŒæ—¶åœ¨ B åº”ç”¨ä¸­ä¸‹å‘åŽä»€ä¹ˆä¹Ÿä¸å¹²

> Qï¼šcSphere æ˜¯ä¼ä¸š PaaS å¹³å°ï¼Œè¯·é—® Agent ç¨‹åºæ˜¯å¦å¼€æºï¼Ÿå¦‚æžœä¸æ˜¯ä¼ä¸šåœ¨è‡ªå·±çš„æœºå™¨ä¸Šå®‰è£…é—­æºç¨‹åºä¼šä¸ä¼šæœ‰æ‹…å¿§ã€‚

Aï¼šæˆ‘ä»¬çš„å®¢æˆ·æ²¡æœ‰è¿‡è¿™æ–¹é¢æ‹…å¿§ã€‚é¦–å…ˆå®¢æˆ·åŸºæœ¬éƒ½æ˜¯å†…ç½‘ã€‚å…¶æ¬¡å®¢æˆ·åœ¨è¿‡åŽ»å¤§é‡ä½¿ç”¨ vSphereï¼ŒåŒæ ·æ²¡æœ‰è¿™æ ·çš„æ‹…å¿ƒã€‚å®¢æˆ·å…³å¿ƒçš„æ˜¯ä½ çš„äº§å“æ˜¯å¦èƒ½è§£å†³è‡ªå·±çš„å®žé™…é—®é¢˜ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 5 æœˆ 19 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº

**é­ä¸–æ±Ÿï¼Œäº‘æ ˆç§‘æŠ€ï¼ˆå¸Œäº‘ cSphereï¼‰æŠ€æœ¯è´Ÿè´£äººï¼ŒDocker ä»£ç è´¡çŒ®è€…ï¼Œç›®å‰åœ¨ Docker å¼€æºé¡¹ç›®ä¸­ä»£ç è´¡çŒ®é‡å…¨çƒæŽ’å 50 åå·¦å³ã€‚åˆ›ä¸šä¹‹å‰åœ¨æ–°æµªè´Ÿè´£ PasS å¹³å°ï¼ˆSAEï¼‰çš„å„ç§åŸºäºŽ Web çš„æœåŠ¡ç®¡ç†ç³»ç»Ÿçš„è®¾è®¡åŠå¼€å‘ï¼Œå…¨ç¨‹å‚ä¸Žäº† SAE ä»Žæ— åˆ°æœ‰ã€ä»Ž 3 å°è™šæ‹Ÿæœºåˆ°åŽæ¥æ”¯æ’‘ 30 å¤šä¸‡åº”ç”¨å’Œåå‡ äº¿æ—¥ PVï¼ˆ13 å¹´æ•°æ®ï¼‰çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œåœ¨ PaaS å»ºè®¾åŠ DevOps æ–¹é¢ç§¯ç´¯äº†ä¸°å¯Œçš„ç»éªŒã€‚2013 å¹´åº•ç¦»å¼€æ–°æµªï¼Œä¸Žå‰ SAE æ€»ç›‘çŽ‹åˆ©ä¿Šå…ˆç”Ÿä¸€èµ·åˆ›ç«‹äº†äº‘æ ˆç§‘æŠ€ï¼Œä¸»è¦åšåŸºäºŽ Docker çš„ä¼ä¸šçº§ç§æœ‰ PaaS äº§å“ï¼ˆcSphereï¼‰åŠå®¹å™¨ç›¸å…³è§£å†³æ–¹æ¡ˆ**ã€‚

---

### 2016-05-10ï¼šåŸºäºŽ Docker çš„åˆ†å¸ƒå¼æœåŠ¡ç ”å‘å®žè·µ

> Qï¼šç”¨ Jenkins æŒç»­é›†æˆè¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•å¯¹é¡¹ç›®è¿›è¡Œæµ‹è¯•ï¼Ÿ

Aï¼šåœ¨ jenkins ä¸­è¿›è¡Œæµ‹è¯•ï¼Œä¸€èˆ¬ä¸»è¦æ˜¯å·² unit test ä¸ºä¸»ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥è‡ªå·±å†™æµ‹è¯•è„šæœ¬è¿›è¡Œæµ‹è¯•ã€‚

> Qï¼šç ”å‘é‡‡ç”¨ IDE è¿œç¨‹è°ƒè¯•è¿™ä¸ªåœ°æ–¹æˆ‘ä¸æ˜¯å¾ˆæ¸…æ¥šç»†èŠ‚å¯å¦è¯¦ç»†è®²è®²ï¼Ÿ

Aï¼šæˆ‘ä»¬ä½¿ç”¨çš„ Web å®¹å™¨ä¸º Tomcatï¼Œä½ åªéœ€åœ¨ Tomcat ä¸­å¼€å¯è¿œç¨‹è°ƒè¯•ç«¯å£ï¼Œåœ¨ IDE ä¸­è¿›è¡Œé…ç½®å³å¯ã€‚

> Qï¼šæˆ‘ä»¬ä¸é‡‡ç”¨ Marathon å’Œ Swarm çš„åŽŸå› æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šSwarm ç›®å‰è¿˜ä¸æˆç†Ÿï¼Œè¿˜åœ¨å‘å±•ä¸­ï¼ŒåŠŸèƒ½ç›¸å¯¹å¼±ä¸€äº›ã€‚Marathon çš„è¯è¿˜æ˜¯çœ‹ä½¿ç”¨åœºæ™¯ï¼Œå¦‚æžœè¿˜è¦è·‘ä¾‹å¦‚ Hadoop çš„è¯å¯ä»¥é€‰æ‹©ã€‚å¦‚æžœæ˜¯çº¯å®¹å™¨ï¼Œå»ºè®® Kubernetesã€‚

> Qï¼šé—®ä¸‹å¼€å‘ä½¿ç”¨çš„ç›®å½•æŒ‚è½½åˆ°å®¹å™¨æ˜¯åœ¨å®¿ä¸»æœºè¿˜æ˜¯å…±äº«å­˜å‚¨ä¸Šå¼€è¾Ÿå­˜å‚¨ç©ºé—´ï¼Œèƒ½å¦åšåˆ°é’ˆå¯¹æ¯ä¸ªç”¨æˆ·å­˜å‚¨ç©ºé—´å®¹é‡é™åˆ¶ï¼Ÿ

Aï¼šå¼€å‘ä½¿ç”¨çš„å®¿ä¸»æœºåœ¨åŠžå…¬äº‘ä¸­ï¼Œä½¿ç”¨çš„å­˜å‚¨æ˜¯å®¿ä¸»æœºçš„æœ¬åœ°å­˜å‚¨ã€‚

> Qï¼šæµ‹è¯•å’Œç ”å‘æ•°æ®åº“ç”¨çš„æ˜¯åŒæ ·çš„ä¸€å¥—å—ï¼Ÿå¦‚æžœæ•°æ®ä¸ä¸€è‡´ï¼Œæ€Žä¹ˆå¤„ç†å‘¢ï¼Ÿ

Aï¼šæµ‹è¯•å’Œç ”å‘ä½¿ç”¨çš„çŽ¯å¢ƒæ˜¯ä¸€è‡´çš„ï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„æ•°æ®åº“è„šæœ¬ä¹Ÿä¸€è‡´ï¼Œå¦‚æžœå‡ºçŽ°å¯¹åŒä¸€ä¸ªè®¡ç®—èµ„æºæ“ä½œäº§ç”Ÿä¸åŒçš„æ•°æ®ï¼Œé‚£å°±éœ€è¦ç ”å‘å’Œæµ‹è¯•ä¸€èµ·æ¥å®šä½ã€‚é‡‡ç”¨åŒä¸€å¥—çŽ¯å¢ƒçš„ä¸€ä¸ªå¥½å¤„æ˜¯è®©ç ”å‘ä¸å†æœ‰å€Ÿå£ï¼š"æˆ‘çš„çŽ¯å¢ƒæ˜¯å¥½çš„ï¼Œæˆ‘æœ¬åœ°æ— æ³•å¤çŽ°"ï¼

---

### 2016-05-03ï¼šåŸºäºŽ Dockerã€Mesosã€Ceph å…¨æ–°æŠ€æœ¯æ ˆçš„ä¸‰åœ°ä¸‰ä¸­å¿ƒå®¹ç¾ä½“ç³»ä¹‹å¤§äºŒå±‚ç½‘ç»œ

> Qï¼šè¯·æ•™ä¸‹ Overlay æ€§èƒ½å’Œç¨³å®šæ€§å¦‚ä½•ï¼Œé€‚åˆå¤§è§„æ¨¡ç”Ÿäº§åº”ç”¨å—ï¼Ÿä½ æ˜¯å…¨éƒ¨çš„ Overlay å—ï¼Ÿ

Aï¼šæˆ‘æŽ¥è§¦çš„æ€ç§‘ ACI æ˜¯å¯ä»¥å®žçŽ°åœ¨å¤§è§„æ¨¡ç”Ÿäº§åº”ç”¨çš„ï¼Œåœ¨æ•´ä¸ªæ–¹æ¡ˆä¸­ä½¿ç”¨çš„å…¨éƒ¨æ˜¯ Overlay ç½‘ç»œã€‚

> Qï¼šè¯·é—®ï¼Œä½ æ‰€è¯´çš„ Swarm å‘å¸ƒçš„ç½‘å¡ï¼Œæ˜¯ç‰©ç†ç½‘å¡è¿˜æ˜¯è™šæ‹Ÿç½‘å¡ï¼Ÿ

Aï¼šä¸æ˜¯ Swarm å‘å¸ƒçš„ï¼Œæ˜¯ Docker1.9 çš„ä¸€ä¸ªæ–°çš„ç½‘å¡ç‰¹æ€§ï¼Œåœ¨ Docker é‡Œé¢ä½¿ç”¨ docker network -help å¯ä»¥çœ‹åˆ°ã€‚

> Qï¼šè¯·é—® Overlay ä½¿ç”¨çš„æ˜¯ç‰©ç†äº¤æ¢æœºè¿˜æ˜¯è™šæ‹Ÿäº¤æ¢æœºï¼Ÿ

Aï¼šåœ¨æœ¬æ–¹æ¡ˆä¸­ä½¿ç”¨çš„æ˜¯ç‰©ç†äº¤æ¢æœºï¼ŒVTEP æ˜¯éƒ¨ç½²åœ¨ leaf å±‚çš„ç‰©ç†äº¤æ¢æœºä¸Šçš„ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ OVS æ¥ä½œä¸º VTEPï¼Œä¸è¿‡è¿™æ ·åœ¨æ€§èƒ½å’Œç¨³å®šæ€§ä¸å¦‚ç‰©ç†äº¤æ¢æœºã€‚

> Qï¼šè¯·é—®é€šè¿‡ Docker Network åˆ›å»ºçš„ç½‘æ¡¥æ€Žæ ·å¯ä»¥è®© OVS å‘çŽ°å¹¶æŽ§åˆ¶ï¼Ÿ

Aï¼šå½“ Docker Network ä¸ºå®¹å™¨åˆ›å»ºæ–°çš„ç½‘å¡æŽ¥å£åŽï¼Œé€šè¿‡è„šæœ¬è‡ªåŠ¨çš„æŒ‚è½½åˆ° OVS çš„ç½‘æ¡¥ä¸Šã€‚å¯¹ç½‘ç»œçš„ç®¡ç†æ˜¯æ˜¯åœ¨æ›´å®è§‚çš„å±‚é¢è¿›è¡Œçš„ï¼Œæ¢å¥è¯è¯´å®žåœ¨è°ƒåº¦æ¡†æž¶å±‚é¢è¿›è¡Œçš„ï¼Œè°ƒåº¦æ¡†æž¶ä¼šæ ¹æ®è‡ªå·±çš„éœ€æ±‚å°†éœ€è¦çš„ç½‘ç»œé…ç½®å‘ç»™ APICï¼ŒAPIC ä¼šä¸‹å‘ç›¸åº”çš„ç½‘ç»œé…ç½®ç­–ç•¥ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 5 æœˆ 3 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äººèµµè‹±ä¿Šï¼Œæ¥è‡ªåŸŽäº‘ç§‘æŠ€ä¼ä¸šäº‘äº‹ä¸šéƒ¨ï¼Œä»Žäº‹äº‘è®¡ç®—å¤§æ•°æ®äº‘å­˜å‚¨çš„é¡¹ç›®å’¨è¯¢å’Œç®¡ç†å·¥ä½œã€‚

---

### 2016-04-28ï¼šDocker å®¹å™¨å¯¹å­˜å‚¨çš„å®šä¹‰ï¼ˆVolume ä¸Ž Volume Pluginï¼‰

> Qï¼šKubernetes ä¸­æ˜¯å¦æœ‰ Volume çš„å¤„ç†æ¨¡å—ï¼Œæˆ–è€…è¯´ Volume çš„é‡è¦æ€§ï¼Œä»¥åŠå‰é¢æåˆ°çš„å„ç§æ“ä½œï¼Œåœ¨ Kubernetes ä¸­æ˜¯æ€Žä¹ˆä½“çŽ°çš„ï¼Ÿ

Aï¼šKubernetes å€ŸåŠ© Docker Volume å®žçŽ°ä¸€å¥—è‡ªå·±çš„ volume ç®¡ç†æœºåˆ¶ã€‚Kubernetes çš„ç›¸å…³é—®é¢˜ä¸‹ä¸€æ¬¡å†è¯¦ç»†è¯´æ˜Žã€‚

> Qï¼šè¯·æ•™ä¸‹çŽ°åœ¨åˆ†å¸ƒå¼å­˜å‚¨å¾ˆå¤šï¼ŒCephã€CFS ç­‰ï¼Œå“ªä¸ªæ€§èƒ½æ›´å¥½ï¼Œæ›´ç¨³å®šï¼Œé€‚åˆä¸Šç”Ÿäº§ï¼Ÿ

Aï¼š Cephã€Glusterfs éƒ½æœ‰ä¸Šç”Ÿäº§çŽ¯å¢ƒæˆåŠŸçš„æ¡ˆä¾‹ã€‚ å°±è¿ç»´æˆæœ¬æ¥è¯´ Gluster æ›´åŠ ç®€å•ç‚¹ã€‚Ceph çš„è¿ç»´æˆæœ¬è¾ƒé«˜ã€‚ç¨³å®šæ€§ä¸Š Gluster å› ä¸ºè®¾è®¡æ›´ç®€å•ï¼Œæ‰€ä»¥ç¤¾åŒºç‰ˆæœ¬å°±å·²ç»ç¨³å®šäº†ã€‚

> Qï¼šDocker Volume å’Œ Kubernetes volume/persistent volume æ¯”è¾ƒï¼Œæœ‰ä»€ä¹ˆå¼‚åŒï¼Ÿ

Aï¼šKubernetes å€ŸåŠ© Docker Volume å®žçŽ°ä¸€å¥—è‡ªå·±çš„ Volume ç®¡ç†æœºåˆ¶ã€‚

> Qï¼šåº”ç”¨æ—¥å¿—ç®¡ç†æ”¶é›†æ˜¯å¦é€‚ç”¨ Volumeï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆæ³¨æ„çš„åœ°æ–¹ï¼ŸæŽ¨èçš„å…±äº«æ–¹å¼ï¼Ÿä¸åŒåº”ç”¨æ˜¯å¦-v åˆ°ä¸åŒçš„åœ°æ–¹ï¼Ÿ

Aï¼šå®¹å™¨å¦‚æžœéœ€è¦æŒä¹…çš„æ•°æ®ï¼Œä½¿ç”¨ Volume æŒ‚åœ¨åˆ°ç›®æ ‡å­˜å‚¨ä¸Šã€‚æ³¨æ„æ—¥å¿—å¤ªå¤šå¯¹ç³»ç»Ÿèµ„æºçš„å ç”¨ã€‚

> Qï¼šæƒ³é—®ä¸‹æœ‰æ²¡æœ‰ç±»ä¼¼æµ‹è¯•è¿‡ï¼Œæˆ–è€…è¯´ä½ çŽ°åœ¨è§‰å¾—æ€§èƒ½æ¯”è¾ƒå¥½çš„ä¸€äº›æ–¹æ¡ˆï¼Ÿæœ‰æ²¡æœ‰æµ‹è¯•ç”¨ä¾‹çº§æ•°æ®ï¼Ÿ

Aï¼šå­˜å‚¨çš„æ€§èƒ½æ˜¯ä¸Žå®žé™…çš„åº”ç”¨æ˜¯ç›¸å…³è”çš„ã€‚æˆ‘ä»¬å¼€å‘é€‚åˆå®¹å™¨çš„å­˜å‚¨ã€‚

> Qï¼šä¸€ä¸ªå­˜å‚¨ç›˜èƒ½å…±äº«æŒ‚è½½åˆ°å¤šä¸ªå®¹å™¨å—ï¼Ÿ

Aï¼šçœ‹åŽç«¯å­˜å‚¨ç±»åž‹ï¼Œå¦‚ NFSã€Glusterfs æ˜¯æ”¯æŒå­˜å‚¨ç›˜èƒ½å…±äº«æŒ‚è½½å¤šä¸ªå®¹å™¨ã€‚

> Qï¼šRancher åˆšå‡ºï¼Œä¸çŸ¥é“å®ƒè¿™ä¸ª Convoy èƒ½å•ç‹¬ç”¨ä¹ˆï¼Œæ¯”å¦‚è¯´å®‰è£…åœ¨ Ubuntuï¼Ÿ

Aï¼š Convoy ä¸Ž Rancher æ˜¯ç‹¬ç«‹çš„ï¼Œå¯ä»¥ç‹¬ç«‹å®‰è£…åœ¨ Ubuntuã€‚

> Qï¼šè¯·é—®æœ‰ä»€ä¹ˆé™æ€èµ„æºå…±äº«æ•°æ®çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ Web å›¾ç‰‡ï¼Ÿ

Aï¼šOpenStack Swiftã€GlusterFS éƒ½å¯ä»¥ã€‚

> Qï¼šConvoy æˆ– Flocker èƒ½æ”¯æŒ rbd ä¹ˆï¼Ÿ

Aï¼šåŽŸç”Ÿçš„ Convoy ç›®å‰ä¸æ”¯æŒ rbdã€‚çŽ°åœ¨æˆ‘ä»¬åš Convoy æ”¯æŒ rbd çš„åŠŸèƒ½ã€‚

> Qï¼šä¸åŒä¸»æœºä¸Šçš„å®¹å™¨èƒ½åŒæ—¶æŒ‚åˆ°ä¸€ä¸ªå…±äº«å­˜å‚¨ä¸Šå—ï¼Œæœ€å¤šèƒ½æ”¯æŒå¤šå°‘ä¸ªï¼Ÿ

Aï¼šå…±äº«å­˜å‚¨æ”¯æŒå°±å¯ä»¥ï¼ŒNFSã€Glusterfs éƒ½å¯ä»¥æ”¯æŒã€‚

> Qï¼šKubernetes å’Œ Docker Swarm ä¸¤ä¸ªæ›´çœ‹å¥½è°ï¼Œå¦‚æžœåªèƒ½é€‰ä¸€ä¸ªçš„è¯ï¼Ÿ

Aï¼šçœ‹å…·ä½“çš„åº”ç”¨åœºæ™¯ï¼ŒKubernetes ä¼šè¶Šæ¥è¶Šç¨³å®šã€‚Swarm å¯¹å®¹å™¨çš„æ”¯æŒä¼šè¶Šæ¥è¶Šå¥½ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 4 æœˆ 28 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æ±Ÿæ¾ï¼Œæœ‰å®¹äº‘è”åˆåˆ›å§‹äººå…¼ç ”å‘å‰¯æ€»è£ã€‚æ‹¥æœ‰ 16 å¹´çš„å›½å†…å¤–ä¼ä¸šçº§è½¯ä»¶åŸºç¡€æž¶æž„ç ”å‘ç»éªŒï¼Œåœ¨ä¼ä¸šçº§å­˜å‚¨ï¼Œäº‘è®¡ç®—è§£å†³æ–¹æ¡ˆæ–¹é¢æœ‰å¾ˆæ·±çš„æŠ€æœ¯é€ è¯£å’Œè¡Œä¸šç†è§£ã€‚æ›¾ä»»ç¾Žå›½ AITechLtdã€çˆ±å°”å…° Raidtec Ltd é«˜çº§ç³»ç»Ÿæž¶æž„å¸ˆï¼Œå­˜é”‹ç§‘æŠ€ Storwind åˆ›å§‹äººå…¼ CEOã€‚

---

### 2016-04-26ï¼šKubernetes ä»£ç è´¡çŒ®è€…è°ˆ Kubernetes çš„å‘å±•åŠ¨æ€

> Qï¼šè°¢è°¢åˆ†äº« Scheduler çš„æ¼”è¿›ï¼Œæƒ³é—®ä¸€ä¸‹ planning çš„é—®é¢˜ï¼Œé’ˆå¯¹ multiple scheduler å’Œ reschedulerï¼Œæ˜¯è°åœ¨ä¸»å¯¼ï¼Œæœ‰æ—¶é—´çº¿å—ï¼Ÿæµ™å¤§ä¼šå‚ä¸Žè®¾è®¡å’Œå¼€å‘å—ï¼Ÿ

Aï¼šæ®æˆ‘æ‰€çŸ¥ï¼Œç›®å‰ design å’Œ implementation éƒ½æ˜¯ç”± Google ä¸»å¯¼ï¼Œå›½å†…ä¸»è¦æ˜¯åŽä¸ºçš„å›¢é˜Ÿåœ¨å‚ä¸Žå¼€å‘ï¼Œç½‘æ˜“ä¹Ÿæœ‰äººåŠ›æŠ•å…¥ï¼Œå½“ç„¶æžæœ‰å¯èƒ½å­˜åœ¨ä¸€äº›æˆ‘ä¸çŸ¥é“çš„å›¢é˜Ÿã€‚Timeline ä¸Š Multiple Scheduler å·²ç»å®Œæˆäº†æŽ¥å£ï¼Œä½†æ˜¯æœ‰ä¸å°‘ç»†èŠ‚çš„å·¥ä½œè¿˜æ²¡æœ‰å®Œæˆã€‚Rescheduler è¿˜åœ¨ design é˜¶æ®µã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œæµ™å¤§çš„ç¡®æœ‰æ„Ÿå…´è¶£çš„åŒå­¦åœ¨åšç›¸å…³çš„å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä¸ç¡®å®šæœ‰æ²¡æœ‰å‘ç¤¾åŒºè´¡çŒ® code çš„è®¡åˆ’ã€‚

> Qï¼šè¿™äº›è®¨è®ºä¸€èˆ¬éƒ½é›†ä¸­åœ¨å“ªäº›åœ°æ–¹ï¼Ÿæ˜¯å…¬å¼€çš„å—ï¼Ÿ

Aï¼šå¤§å¤šæ•°åœ¨ GitHub ä¸Šå¯ä»¥ trace åˆ°ï¼Œå½“ç„¶ä¹Ÿæœ‰ weekly sig è§†é¢‘ä¼šè®®å’Œ offline discussionã€‚å¦‚æžœæ˜¯ä¸ªäººå¼€å‘è€…çš„è¯ï¼Œå¯ä»¥åœ¨ GitHub ä¸Šçš„ issue/pr é‡Œ comment æˆ–è€…ç›´æŽ¥æäº¤ pr å‚ä¸Žå¼€å‘ã€‚

> Qï¼šKubernetes ç›®å‰è¡¨çŽ°çš„æ¯”è¾ƒå¥½çš„æ‰˜ç®¡æ–¹å¼æ˜¯å®¹å™¨å®‰è£…å—ï¼Ÿè¿˜æœ‰ CoreOS å®˜æ–¹ç»™äº†è¿™ä¹ˆå¤šé€‰æ‹©ä¸çŸ¥é“é€‰ä»€ä¹ˆå¥½ã€‚

Aï¼šdefinitely notã€‚å®¹å™¨å®‰è£…æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„ solutionï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰å¾ˆå¤š bugã€‚CoreOS åº”è¯¥æ˜¯ä¸€ä¸ªæ”¯æ’‘æ€§éžå¸¸é«˜çš„å¹³å°ã€‚æˆ‘æœ¬äººæ˜¯ Ubuntu å¹³å°çš„ maintainer ä¹‹ä¸€ï¼Œå¦‚æžœå¸Œæœ› play with ubuntu çš„åŒå­¦ï¼Œä¹Ÿå¯ä»¥å°è¯•ä¸€ä¸‹ã€‚

> Qï¼šæœªæ¥ horizontal pod autoscaling å°†ä¸ä»…ä»…æ˜¯ä¾æ® CPUï¼Œè¿˜ä¼šæœ‰æ›´å¤šçš„æŒ‡æ ‡ã€‚è¯·é—®å¦‚ä½•å¤„ç†å¯èƒ½çš„çŸ›ç›¾ã€‚å¦‚ CPU è¶…è½½æŒ‡ç¤ºæ‰©å®¹ï¼Œè€Œ memory å¯èƒ½ä½¿ç”¨ä½Žè€ŒæŒ‡ç¤ºå‡å°‘å®¹å™¨æ•°é‡ï¼Ÿ

Aï¼šè¿™æ˜¯ä¸€ä¸ªç­–ç•¥é—®é¢˜ã€‚å¯¹åº”çš„è§£å†³æ–¹æ¡ˆæ— ç–‘ä¼šç‰ºç‰²å…¶ä¸­ä¸€ä¸ªï¼ŒKubernetes æ˜¯å¦å…è®¸ç”¨æˆ·æ¥æŒ‡å®šè¿™ä¸ª priority ä¹Ÿè¿˜å€¼å¾—è®¨è®ºã€‚ä½†æ˜¯å°±ç›®å‰çœ‹æ¥ç”¨æˆ·è¿˜ä¸éœ€è¦è¿‡åˆ†æ‹…å¿ƒï¼Œæ¯•ç«Ÿå®ƒè¿˜æ²¡æœ‰å®žçŽ°ã€‚

> Qï¼šè¿˜æ˜¯é‚£ä¸ªè€é—®é¢˜ï¼Œåœ¨ä¼ä¸šçŽ¯å¢ƒä¸‹ Kubernetes å’Œ Mesos å“ªä¸ªæ›´å¯å–ï¼Ÿ

Aï¼šå¦‚æžœä¸€å®šç”¨äº‹å®žè¯´è¯çš„è¯ï¼Œå½“å‰ Mesos åœ¨ä¼ä¸šä¸­çš„ use case æ— ç–‘æ¯” Kubernetes è¦å¤šã€‚ä½œä¸ºä¸€ä¸ªä¸¤çº§è°ƒåº¦æ¡†æž¶ï¼ŒMesos çš„å®Œå¤‡æ€§ç›¸å½“é«˜ã€‚ä½†æ˜¯æˆ‘ä¸ªäººå¹¶ä¸è®¤ä¸º Kubernetes å°±ç›¸å¯¹ä¸é€‚ç”¨äºŽä¼ä¸šçŽ¯å¢ƒã€‚æ¯•ç«Ÿåœ¨é€‰å– solution çš„æ—¶å€™ï¼Œéœ€è¦è€ƒé‡çš„å®žé™…å› ç´ å¾ˆå¤šã€‚

> Qï¼šå…¶å®žåŽ»å¹´å¼€å¹´çš„æ—¶å€™çŽ©è¿‡ Kubernetesï¼Œç„¶åŽæ˜¯å› ä¸ºç½‘ç»œéƒ¨åˆ†çš„é™åˆ¶å¯¼è‡´é€‰æ‹©äº† Mesosï¼Œæƒ³é—®ä¸‹å®¹å™¨ç½‘ç»œè¿™éƒ¨åˆ† Kubernetes ä½ è§‰å¾—æœ€æˆç†Ÿçš„æ–¹æ¡ˆæ˜¯å“ªä¸€ç§ï¼Ÿ

Aï¼šæˆ‘è‡ªå·±åªçŽ©è¿‡ Flannelï¼ˆåŒ…æ‹¬ UDP å’Œ VXLANï¼‰ï¼Œä½†æ˜¯å®ƒåœ¨æ•ˆçŽ‡ä¸Šå¯èƒ½å¹¶ä¸æ˜¯éžå¸¸å¥½ï¼ŒVXLAN ç›¸å¯¹æ¥è¯´è¦å¥½ä¸€äº›ã€‚æˆ‘æ‰€çŸ¥é“çš„æ–¹æ¡ˆä¸­ï¼ŒCalico åº”è¯¥åšå¾—è¿˜ä¸é”™ã€‚æ‚¨ä¹Ÿå¯ä»¥å°è¯•ä¸€ä¸‹ OpenVSwitchã€‚

> Qï¼šRancher é™¤æ”¯æŒè‡ªå·±çš„ç¼–æŽ’æ–¹æ¡ˆ cattle ä»¥å¤–ï¼Œä¹Ÿæ”¯æŒ Kubernetes å’Œ Docker Swarmã€‚æƒ³å¬å¬ä½ çš„å»ºè®®ï¼Œæ˜¯å¦å¯ä»¥é‡‡ç”¨ Rancher+Kubernetes è¿™æ ·çš„æ–¹æ¡ˆï¼Ÿè°¢è°¢

Aï¼šéžå¸¸æŠ±æ­‰æ²¡æœ‰ä½¿ç”¨ Rancher çš„ç»åŽ†ã€‚ä½†æ˜¯å°±å¤§å¤šæ•°æˆ‘æ‰€çŸ¥é“çš„ cross-platform solution è€Œè¨€ï¼Œé€šå¸¸éƒ½å‡ºäºŽç”Ÿäº§çŽ¯å¢ƒä¸­å…·ä½“çš„éœ€æ±‚ã€‚æ¯”å¦‚æˆ‘çŽ°åœ¨å®žä¹ çš„å…¬å¸çš„ AP ç»„å°±è‡ªå·±å†™äº† docker-on-yarnã€‚åœ¨ solution çš„é€‰å–ä¸Šå¾ˆéš¾è„±ç¦»éœ€æ±‚æ¥è¿›è¡Œè¯„æ–­ã€‚

> Qï¼šçŽ°åœ¨æ‰€æœ‰è°ƒåº¦è§„åˆ™éƒ½æ˜¯é›†ä¸­åœ¨ master æŽ§åˆ¶åˆ†å‘ï¼ŒKunernetes å¯ä¸å¯ä»¥åœ¨ node ä¸Šé¢æ·»åŠ åƒ mesos role çš„æ¦‚å¿µï¼Ÿ

Aï¼šè°ƒåº¦å™¨çš„æ¼”åŒ–ç»åŽ†äº†å¾ˆé•¿æ—¶é—´çš„å‘å±•ï¼Œå„æœ‰åƒç§‹ã€‚Kunernetes é€‰ç”¨çš„å•ä½“è°ƒåº¦å™¨ï¼Œè€Œ Mesos æ˜¯ä¸¤æžè°ƒåº¦æ¡†æž¶ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯æœ‰ç›¸å½“å¤§çš„ gap çš„ã€‚å½“ç„¶çŽ°åœ¨ä¹Ÿæœ‰ Kunernetes å’Œ Mesos çš„é›†æˆï¼Œæœ‰å…´è¶£çš„åŒå­¦ä¹Ÿå¯ä»¥å°è¯•ä¸€ä¸‹ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 4 æœˆ 26 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**ä½•æ€çŽ«ï¼Œæµ™æ±Ÿå¤§å­¦ SEL å®žéªŒå®¤ç ”ç©¶ç”Ÿï¼ŒKubernetesã€Docker ç­‰å®¹å™¨ç›¸å…³å¼€æºé¡¹ç›®çš„ä»£ç è´¡çŒ®è€…ã€‚**

---

### 2016-04-19ï¼šé˜¿é‡Œäº‘å®¹å™¨æœåŠ¡è®¾è®¡å®žè·µ

> Qï¼šé’ˆå¯¹å®¹å™¨è·¨ä¸»æœºé€šè®¯é‡‡ç”¨ vSwitch å’Œ vRouterï¼Œé‚£ä¹ˆå®¹å™¨å’Œ VM åº”ç”¨é€šè®¯ä¹Ÿæ˜¯é‡‡ç”¨æ­¤æ–¹æ³•å—ï¼ŸvRouter è§„æ¨¡å¦‚ä½•ï¼Ÿ

Aï¼šåœ¨å‰é¢è¯´çš„ VPC å®žçŽ°ä¸­ï¼Œå®¹å™¨å’Œ VM æ˜¯å¯ä»¥ç›´æŽ¥é€šä¿¡çš„ã€‚VPC ç›®å‰çš„ vRouter æ”¯æŒ 50 ä¸ªæ¡ç›®ï¼Œä¹Ÿå°±æ˜¯æœ€å¤š 50 ä¸ªç½‘æ®µã€‚

> Qï¼šå„ç§æ‰©å±•å’Œ Plugin æœ‰å¼€æºå—ï¼Ÿ

Aï¼šæœªæ¥æˆ‘ä»¬ä¼šå¼€æºå®‰è£…åœ¨ç”¨æˆ·æœºå™¨ä¸Š Agent å’Œ Plugin ä»£ç ï¼Œç›®å‰è¿˜æœ‰ä¸€äº›çŸ¥è¯†äº§æƒå·¥ä½œéœ€è¦è§£å†³ã€‚

> Qï¼šRegistry çš„ HA æ–¹æ¡ˆèƒ½å¦ä»‹ç»ä¸‹ï¼Ÿ

Aï¼šæˆ‘ä»¬å¼€å‘è¿‡ Registry çš„ OSS storage driverï¼Œå·²ç»æäº¤åˆ°ç¤¾åŒºã€‚åŽç«¯ä½¿ç”¨ OSS å­˜å‚¨ï¼Œç›´æŽ¥å¯å¤šå° Registryï¼ŒæŒ‚ä¸€ä¸ª vip å°±å¥½äº†ã€‚

> Qï¼šæƒ³é—®ä¸‹é˜¿é‡Œçš„æ”¯æŒæ··åˆäº‘å—ï¼Ÿå®¿ä¸»æœºæ˜¯ä¸æ˜¯è¦æ±‚ä¸€å®šæ˜¯é˜¿é‡Œçš„ ECSï¼Ÿ

Aï¼šç›®å‰ä¸»è¦æ”¯æŒé˜¿é‡Œäº‘çŽ¯å¢ƒå’Œä¸“æœ‰äº‘ã€‚å¯¹äºŽå®¿ä¸»æœºåœ¨å¤–é¢çš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ VPC çš„æ–¹å¼æŽ¥å…¥ã€‚

> Qï¼šè·Ÿ Docker hub å…¼å®¹æœ‰å“ªäº›æ–¹é¢ï¼Œhook åŠŸèƒ½æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šæ”¯æŒä»“åº“ç®¡ç†ã€è‡ªåŠ¨æž„å»ºã€åŠ é€Ÿå™¨ç­‰åŠŸèƒ½ã€‚hook æ–¹é¢æ˜¯é€šè¿‡ Registry çš„ Notify å®žçŽ°çš„ã€‚

> Qï¼šé•œåƒå¯¹åˆ†å‘åˆ°å¤šä¸ª Registry å—ï¼Ÿ

Aï¼šOSS æœ¬èº«å¯ä»¥ä¿è¯æ•°æ®çš„é«˜å¯ç”¨ã€‚å¯¹äºŽ Registryï¼Œé‡ç‚¹åœ¨äºŽ Pull/Push é€Ÿåº¦ï¼Œæˆ‘ä»¬åœ¨ä¼šæ¯ä¸ª Region éƒ½éƒ¨ç½² Registryï¼Œå°½å¯èƒ½æä¾›æœ€å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

> Qï¼šDocker æœåŠ¡æœ¬èº«çš„å‡çº§ï¼Œæ€Žä¹ˆè§£å†³çš„ï¼Œéœ€è¦ç”¨æˆ·åœæ­¢çº¿ä¸Šå®¹å™¨å—ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬æ”¯æŒçš„ç¤¾åŒºç‰ˆæœ¬ 1.10 éœ€è¦é‡å¯å®¹å™¨ï¼Œç”¨æˆ·å¯ä»¥è‡ªå·±é€‰æ‹©åˆé€‚çš„æ—¶é—´å‡çº§ã€‚å¯¹äºŽé˜¿é‡Œå†…éƒ¨æˆ‘ä»¬åŒäº‹ä¿®æ”¹è¿‡çš„ alidocker æ˜¯æ— éœ€é‡å¯çš„ã€‚å½“ç„¶ï¼Œéšç€ 1.11 çš„ Docker é‡æž„ï¼Œæœªæ¥ç¤¾åŒºç‰ˆæœ¬ä¹Ÿä¸å†æ˜¯å•ç‚¹å¤±æ•ˆç‚¹ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 4 æœˆ 19 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**å§œç»§å¿ ï¼ŒèŠ±åæˆ’ç©ºï¼Œé˜¿é‡Œäº‘æŠ€æœ¯ä¸“å®¶ï¼Œä¸€ç›´ä¸“æ³¨äºŽäº‘æœåŠ¡å’Œ PaaS å¹³å°ç›¸å…³çš„æž¶æž„å’Œå¼€å‘å·¥ä½œï¼Œç›®å‰è´Ÿè´£é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡çš„æž¶æž„å’Œå¼€å‘ã€‚**

---

### 2016-04-12ï¼šåŒæ¨¡ IT ç»™ä½ çš„ä¼ä¸šè£…ä¸ŠåŒå¼•æ“Ž

> Qï¼šåŒæ¨¡æ¨¡å¼å’Œ DevOps ä»¥åŠç›®å‰æµè¡Œçš„ Docker å®¹å™¨æœ‰ä»€ä¹ˆå…³ç³»å—ï¼Ÿ

Aï¼šé¦–å…ˆåŒæ¨¡æ¨¡å¼æ˜¯ä¸€ä¸ªç®¡ç†ç†å¿µï¼Œå®ƒæŒ‡å¯¼ IT éƒ¨é—¨é‡‡ç”¨çš„ç»„ç»‡æž¶æž„ã€åˆ¶åº¦ã€äººå‘˜æŠ€èƒ½ï¼Œä»¥åŠæŠ€æœ¯ã€‚å¦‚å‰æ‰€è¯´ï¼ŒDevOps å’Œ Docker æŠ€æœ¯ä¼˜åŠ¿å¯ä»¥æ›´æœ‰æ•ˆæŽ¨åŠ¨ä¼ä¸šæå‡ä¸šåŠ¡åˆ›æ–°èƒ½åŠ›ï¼Œå› æ­¤åœ¨æˆ‘è§åˆ°çš„é‡‘èžä¼ä¸šä¸­æ™®éåº”ç”¨åˆ°äº†ä¿¡ç”¨å¡ã€äº’è”ç½‘é‡‘èžç­‰ 2C ç«¯çš„ä¸šåŠ¡ã€‚

> Qï¼šè¿™ä¸ªåŒæ¨¡æ¨¡å¼å’Œç›®å‰å¸¸ç”¨çš„æ•æ·å¼€å‘ï¼ŒCMMI å¼€å‘åœ¨æ“ä½œä¸Šï¼Œäº§å“è´¨é‡ä¿è¯ä¸Šï¼Œå¼€å‘è¿­ä»£ï¼Œæ•ˆçŽ‡ä¸Šæœ‰å“ªäº›ä¸åŒï¼Ÿæˆ–è€…è¯´æœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿä»¥åŠå¦‚ä½•å’Œè¿™äº›å¼€å‘æµç¨‹åä½œï¼Ÿ

Aï¼šå¤§å®¶å¯èƒ½ä»¥å¾€æ¯”è¾ƒå…³æ³¨æŠ€æœ¯ï¼Œè¾ƒå°‘å…³æ³¨ç®¡ç†ä½“ç³»æ–¹é¢çš„å†…å®¹ã€‚åŒæ¨¡ IT ç®¡ç†æ›´å¤šä¾§é‡åœ¨ç®¡ç†ä½“ç³»ï¼Œå®ƒæŒ‡å¯¼ IT éƒ¨é—¨é‡‡ç”¨çš„ç»„ç»‡æž¶æž„ã€åˆ¶åº¦ã€äººå‘˜æŠ€èƒ½ï¼Œä»¥åŠæŠ€æœ¯ã€‚CMMI é‡‡ç”¨äº†ä¼ ç»Ÿçš„ç€‘å¸ƒæ¨¡åž‹ï¼Œè¿™ç§æ–¹å¼é€‚åˆåœ¨æ˜Žç¡®éœ€æ±‚çš„å‰æä¸‹ç¨³æ­¥æŽ¨è¿›å·¥ä½œã€‚ä½†ç”±äºŽå½“å‰å¸‚åœºçŽ¯å¢ƒååˆ†ä¸ç¡®å®šï¼Œéœ€æ±‚çš„ä¸ç¡®å®šæ€§æ˜¯åˆ›æ–°çš„æœ€å¤§æŒ‘æˆ˜ï¼Œå› æ­¤æ¼”åŒ–å‡ºä¸€ç§æŒç»­è¿­ä»£çš„å¼€å‘æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ DevOps å¼ºè°ƒæŒç»­åé¦ˆçš„åŽŸå› ã€‚

> Qï¼šæ€Žä¹ˆç†è§£ ITIL V3 çš„æœåŠ¡é©±åŠ¨ï¼Ÿ

Aï¼šç›¸æ¯” V2ï¼ŒITIL V3 å°è¯•ä»ŽæœåŠ¡æˆ˜ç•¥ã€æœåŠ¡è®¾è®¡ã€æœåŠ¡è½¬æ¢ã€æœåŠ¡è¿è¡Œã€æœåŠ¡æŒç»­æ”¹è¿›äº”ä¸ªæ–¹é¢é˜è¿°æœåŠ¡ç”Ÿå‘½å‘¨æœŸï¼Œä¸€ä¸ªæ¯”è¾ƒæ˜Žæ˜¾çš„ç‰¹ç‚¹å°±æ˜¯é‡ç‚¹å¼ºåŒ–äº†æœåŠ¡ç›®å½•ï¼Œå¹¶ä»ŽæœåŠ¡ç›®å½•å‡ºå‘å°†æœåŠ¡äº¤ä»˜ã€äº‹ä»¶ã€é—®é¢˜ã€å˜æ›´ã€å®¹é‡ç®¡ç†ç­‰æµç¨‹ä¸²è”åœ¨ä¸€èµ·ã€‚

> Qï¼šå®¢æˆ·åœ¨ç¢°åˆ°ç±»ä¼¼çš„ç®¡ç†äº§å“æ—¶ï¼Œé€šå¸¸å¾ˆç•æƒ§ï¼Œä¸ä»…æ”¶æ•ˆç”šå¾®ï¼Œè¿˜å¯èƒ½è¦æ”¹é€ çŽ°æœ‰æµç¨‹ï¼Œåè€Œå¢žåŠ ä»–ä»¬çš„å·¥ä½œé‡ï¼ŒåŽç»­æ›´æ˜¯å¢žå¤§ç®¡ç†æˆæœ¬ï¼Œå¦‚ä½•è¯´æœä»–ä»¬ï¼Ÿ

Aï¼šåŒæ¨¡ IT é¦–å…ˆæ˜¯ä¸€ä¸ªç®¡ç†ç†å¿µï¼Œç„¶åŽåŸºäºŽè¿™ç§ç†å¿µæ¼”å˜æˆç®¡ç†æœ€ä½³å®žè·µã€ç®¡ç†æ–¹æ³•å’Œç®¡ç†æ ‡å‡†ã€‚å…¶æ¬¡ï¼Œç®¡ç†é‡ç‚¹è¦è§£å†³çš„æ˜¯äººã€è´¢ã€ç‰©ï¼Œå¦‚ä½•æœ€å¤§åŒ–åè°ƒä¸‰è€…ï¼Œä½¿å¾—ä¼ä¸šæ•ˆç›Šæœ€å¤§åŒ–ï¼Œæå‡ IT æ•ˆçŽ‡æ‰æ˜¯å…³é”®ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æŽ¨è¿›ä¸€ä¸ªæ–°æ–¹æ³•çš„æ—¶å€™å…³é”®è¦è¯´æ˜Žç™½å¥½å¤„å·²ç»é£Žé™©ï¼Œè®©ç®¡ç†è€…æœ‰ä¸€ä¸ªå…¨é¢äº†è§£ã€‚åœ¨å®žé™…çš„æŽ¨è¿›è¿‡ç¨‹ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯åŸ¹è®­ç†å¿µå¯¼å…¥ï¼Œè®©ä¼ä¸šå†…éƒ¨å…³é”®äººå‘˜è¯´ä¸€ç§è¯­è¨€ï¼Œç»Ÿä¸€æ€æƒ³ï¼Œä½†æœ€è¿‘å‡ å¹´ä¸€ä¸ªæ˜Žæ˜¾çš„å˜åŒ–æ˜¯æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸€ç§æŠ€æœ¯é©±åŠ¨çš„æ¨¡å¼å°†ç®¡ç†ç†å¿µé€šè¿‡å¹³å°è½åœ°ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 4 æœˆ 12 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**å¼ äº®ï¼Œä¸Šæµ·ç¿°çº¬ä¿¡æ¯ç§‘æŠ€æœ‰é™å…¬å¸æŠ€æœ¯æ€»ç›‘å…¼åˆä¼™äººã€‚IT ä»Žä¸šç»éªŒ 14 å¹´ä»¥ä¸Šï¼Œå…ˆåŽä»Žäº‹å¼€å‘ã€æž¶æž„ã€é¡¹ç›®ç®¡ç†ã€æŠ€æœ¯ç®¡ç†ç­‰å²—ä½ï¼Œæ›¾å°±èŒäºŽ IBMï¼Œåœ¨å¤§åž‹ä¼ä¸šæ•°æ®ä¸­å¿ƒè¿ç»´æ–¹é¢ï¼Œç§¯ç´¯äº†è¶…è¿‡ 10 å¹´çš„æž¶æž„å’Œè§„åˆ’ç®¡ç†ç»éªŒï¼Œå…ˆåŽä¸ºäº”å¤§è¡Œã€å†œå•†è¡Œç­‰é‡‘èžæœºæž„æä¾›æ•°æ®ä¸­å¿ƒè¿ç»´ç®¡ç†è§„åˆ’å’Œç®¡ç†å¹³å°è½åœ°å’¨è¯¢åŠå®žæ–½æœåŠ¡ã€‚çƒ­çˆ±å¼€æºæŠ€æœ¯ï¼ŒçŽ°ä¸“æ³¨äºŽ OpenStackã€Dockerã€Cloudifyã€Apache Kylin ç­‰å¼€æºæ–¹æ¡ˆåœ¨ä¼ ç»Ÿä¼ä¸šçš„è½åœ°ã€‚

### 2016-04-05ï¼šæœç‹åŸºäºŽ Docker+Kubernetes çš„ä¸€ç«™å¼è¿ç»´ç®¡ç†å®žè·µ

> Qï¼š"å¯ä»¥åœ¨ Pod ä¸­é…ç½®ä¸€ä¸ªæˆ–å¤šä¸ªæ—¥å¿—æ”¶é›†æ¨¡å—ï¼Œè¯¥éƒ¨åˆ†ç”¨ Flume å®žçŽ°"è¿™å—èƒ½å…·ä½“è¯´ä¸‹å—ï¼Ÿ

Aï¼šæˆ‘ä»¬æŠŠ Flume åšæˆäº†ä¸€ä¸ªé•œåƒï¼Œåˆ©ç”¨ Kubernetes çš„ Empty Directories æ¥æ”¶é›†å…¶ä»–å®¹å™¨äº§ç”Ÿçš„æ—¥å¿—ã€‚

> Qï¼šæˆ‘æƒ³é—®ä¸‹å®¹å™¨å†…ç›‘æŽ§æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿæ¯ä¸ªå®¹å™¨å®‰è£… open-falcon çš„ Agent å—ï¼Ÿ

Aï¼šæ¯ä¸ª Node ä¸Šä¼šå¯åŠ¨ä¸€ä¸ª Agentï¼Œé€šè¿‡ Agent æ”¶é›†ä¸»æœºå’Œå®¹å™¨çš„ä¿¡æ¯ï¼ŒAgent é›†æˆäº† open-falcon çš„ Agent å’Œ cAdvisorã€‚

> Qï¼šè‡ªåŠ¨åŒ–æž„å»ºè¿‡ç¨‹ä¸­ï¼Œå¯¹åº”ç”¨çš„æµ‹è¯•æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šå•å…ƒæµ‹è¯•å¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™å®Œæˆï¼ŒåŠŸèƒ½æµ‹è¯•éœ€è¦å¯åŠ¨éƒ¨ç½²ã€‚

> Qï¼šä½ ä»¬çš„éƒ¨ç½²çŽ¯å¢ƒæ˜¯åŒæ—¶ä½¿ç”¨äº† overlay æ¨¡å¼å’Œ host æ¨¡å¼å—ï¼Œå¯¹äºŽé¢„é˜²æ½œåœ¨çš„å†²çªä½ ä»¬æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¸»è¦å¯¹ç«¯å£å†²çªåšäº†ä¸¥æ ¼é™åˆ¶ï¼Œhost æ¨¡å¼ä¸‹æä¾›äº†è‡ªåŠ¨å¯»æ‰¾ 20000\~21000 æ®µå¯ç”¨ç«¯å£çš„æ’ä»¶ï¼Œoverlay æ¨¡å¼ä¼šæ ¹æ®æ•°æ®åº“ä¸­é…ç½®æ£€æµ‹å†²çªã€‚

> Qï¼šä½¿ç”¨ Kubernetes ç¼–æŽ’å®¹å™¨åŽï¼Œä½ ä»¬æ€Žä¹ˆåšæœåŠ¡å‘çŽ°çš„ï¼Ÿå¦‚ä½•è§£å†³å®¹å™¨é—´äº’ç›¸è°ƒç”¨é—®é¢˜ï¼ŒåŠå®¹å™¨å¤–è°ƒå®¹å™¨å†…æœåŠ¡é—®é¢˜ï¼Ÿ

Aï¼šæˆ‘ä»¬ç”¨ skyDNS åšæœåŠ¡å‘çŽ°ï¼Œå®¹å™¨é—´ç›¸äº’è°ƒç”¨å¯ä»¥ç”¨å†…éƒ¨åŸŸåï¼ŒKubernetes é›†ç¾¤å†…çš„ä¸»æœºé€šè¿‡ä¿®æ”¹ DNS æœåŠ¡å™¨é…ç½®ä¹Ÿå¯ä»¥é€šè¿‡å†…éƒ¨åŸŸåè®¿é—®å®¹å™¨ã€‚

> Qï¼šé¡¹ç›®æœ‰ä»€ä¹ˆç“¶é¢ˆå—ï¼Ÿ

Aï¼šKubernetes çš„éƒ¨ç½²æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬åšçš„æ˜¯ç§æœ‰äº‘ä¸‹çš„ç®¡ç†ï¼Œä¸åŒç³»ç»Ÿä¸‹éƒ¨ç½²ä¼šæœ‰å„ç§å„æ ·çš„é—®é¢˜ã€‚

> Qï¼šåˆšåˆšæåˆ° WebSSH åœ¨ Agent é‡Œå°è£…äº† docker execï¼Œå½“åœ¨ master æ‰§è¡ŒæŸå®¹å™¨çš„å‘½ä»¤æ—¶ï¼Œå…·ä½“æ˜¯å¦‚ä½•æŽ§åˆ¶ Node èŠ‚ç‚¹æ‰§è¡Œ docker exec çš„ï¼ŒAgent å°è£…æ˜¯è‡ªå·±å¼€å‘çš„å—ï¼Œè¿˜æ˜¯å€Ÿç”¨ä¸€äº›ç¬¬ä¸‰æ–¹å·¥å…·ï¼ŒKubernetes å¥½åƒä¹Ÿæœ‰ kubectl execï¼Ÿ

Aï¼šWebSSH æœ‰ Server ç«¯å’Œ Agent ç«¯ï¼ŒAgent åœ¨æ¯ä¸ª Node èŠ‚ç‚¹ä¸Šï¼ŒServer åªè¦ä¸€ä¸ªå°±å¤Ÿäº†ã€‚kubectl ä¹Ÿå¯ä»¥ execï¼Œä¸è¿‡é‡‡ç”¨çš„æ˜¯ Kubernetes è‡ªå®šä¹‰çš„è¿žæŽ¥åè®®ï¼Œæ€§èƒ½ä¹Ÿä¸å¦‚æˆ‘ä»¬ç›®å‰é‡‡ç”¨çš„æ–¹æ¡ˆã€‚

ä»¥ä¸Šå†…å®¹ç”±**æŽä¸–é¾™**æ ¹æ® 2016 å¹´ 4 æœˆ 5 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**åˆ˜è²ï¼Œæœç‹åŒ—äº¬ç ”å‘ä¸­å¿ƒå‰¯ç ”ç©¶å‘˜ï¼Œä¸»è¦è´Ÿè´£ DomeOS ç³»ç»Ÿçš„è®¾è®¡ç ”å‘å·¥ä½œã€‚è‡´åŠ›äºŽç ”ç©¶ Docker ä¸ºä»£è¡¨çš„å®¹å™¨æŠ€æœ¯ï¼Œä¸ºä¼ä¸šçº§ç”¨æˆ·æ‰“é€ æŒç»­äº¤ä»˜å’Œè‡ªåŠ¨è¿ç»´å¹³å°ï¼Œè§£å†³ç”¨æˆ·ä»Žä»£ç è‡ªåŠ¨ç¼–è¯‘æ‰“åŒ…ï¼Œåˆ°çº¿ä¸Šè¿è¡Œç»´æŠ¤çš„å…¨å¥—éœ€æ±‚ã€‚

---

### 2016-03-31ï¼šDCOS ä¸­ç›‘æŽ§å’Œå¼¹æ€§ä¼¸ç¼©æ–¹æ¡ˆç»éªŒåˆ†äº«

> Qï¼šCPU å ç”¨çŽ‡ï¼Œå†…å­˜å ç”¨çŽ‡è¿™äº›æŒ‡æ ‡ä¸ºå•¥è¦æ”¹ cAdvisor çš„ä»£ç å®žçŽ°ï¼Ÿæ—¢ç„¶ä½¿ç”¨äº† Grafana çš„è¯ï¼ŒGrafana æœ¬èº«å°±æœ‰å¯¹æ•°æ®äºŒæ¬¡åŠ å·¥çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ CPU åˆ©ç”¨çŽ‡å¯ä»¥ç›´æŽ¥é€šè¿‡ cAdvisor å‘é€çš„ cpuacctï¼Œusage çš„æ•°æ®åš Derivatives å°±èƒ½å–åˆ° CPU çš„åˆ©ç”¨çŽ‡äº†ã€‚ä¸çŸ¥é“è¿™å—ä½ ä»¬æ˜¯åŸºäºŽä»€ä¹ˆè€ƒè™‘åœ¨ cadvisor é‡ŒåŽ»æå‰ç®—äº†ï¼Ÿ

Aï¼šé¦–å…ˆï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ Grafanaï¼›å…¶æ¬¡ä½ è¯´çš„ä¸é”™ï¼ŒCPU åªæ˜¯æ‰“äº†ä¸€ä¸ªæ¯”æ–¹ï¼Œå…¶å®žæˆ‘ä»¬è®¡ç®—æ›´å¤šçš„æ˜¯ç½‘ç»œä¼ è¾“çš„ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚æ”¶å‘æŠ¥çš„æ•°é‡ï¼Œå¤§å°ï¼Œè¿™äº›éƒ½æ˜¯åœ¨æˆ‘ä»¬å…¬å¸ NFV çš„ä¸šåŠ¡æ¯”è¾ƒå¸¸è§ï¼Œè¿™é‡Œç»™å¤§å®¶åˆ†äº«çš„ä¸»è¦ç›®çš„æ˜¯ï¼Œå¯ä»¥é€šè¿‡ cAdvisor åšä¸€äº›å®šåˆ¶åŒ–çš„å¼€å‘ã€‚ æˆ‘ä»¬ç”¨ cAdvisor çš„ç›®çš„ä¸»è¦æ˜¯ ç»Ÿä¸€ä¿¡æ¯çš„æ”¶é›†ï¼Œå¹¶ä¸æƒ³ç”¨å¤šä¸ªç›‘æŽ§å·¥å…·ï¼Œè¿™æ ·ä¼šæœ‰ç‚¹å¤æ‚ã€‚

> Qï¼šè¯·é—®ï¼Œæ¯ä¸ª Prmetheus ä¼šç®¡ç† 10 ä¸ª Mesos-Slave+cAdvisor çš„èŠ‚ç‚¹ä¿¡æ¯ï¼ŒæŠ“å–é¢‘çŽ‡æ˜¯ 1sï¼Œå¦‚ä½•ä¿è¯åœ¨è§„å®šæ—¶é—´é—´éš”æœé›†å®Œæ‰€æœ‰ç›‘æŽ§ä¿¡æ¯ï¼Œå³å¦‚ä½•ä¿è¯ç›‘æŽ§æŒ‡æ ‡æ˜¯å®žæ—¶æœ‰æ•ˆçš„å‘¢ï¼Ÿ

Aï¼šè¿™ä¸ªç»“æžœå…¶å®žæ˜¯æˆ‘ä»¬ç»è¿‡åå¤æµ‹é‡å¾—å‡ºæ¥çš„ï¼Œæ˜¯æœ‰å‰æï¼Œå°±æ˜¯æˆ‘è¯´çš„æ¯ä¸ª Slave çš„å¤§å°å…¶å®žæ˜¯æœ‰é™åˆ¶çš„ï¼Œæˆ‘ä»¬çš„æ¯ä¸ª Slave åœ¨ 8 CPUï¼Œ 16G å†…å­˜ï¼Œè¿™æ ·ä¿è¯äº†è¿è¡Œçš„å®¹å™¨æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ã€‚æˆ‘è§‰å¾—å¦‚æžœå®¹å™¨è¿‡å¤šï¼Œé‚£ä¹ˆç®¡ç† 10 ä¸ªèŠ‚ç‚¹å¯èƒ½å°±ä¸é€‚åˆï¼ŒæŠ“å–é¢‘çŽ‡ä¹Ÿéœ€è¦è°ƒæ•´ã€‚ ç›®å‰å®˜æ–¹æ²¡æœ‰ç»™å‡º Best Pacticeï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ç»éªŒä¹‹è°ˆã€‚ æµ‹è¯•ä¸‹æ¥ï¼Œæˆ‘ä»¬çš„é…ç½® åŸºæœ¬ä¸Šæ²¡æœ‰å‡ºçŽ°ä¸¢å¤±ä¿¡æ¯çš„æƒ…å†µã€‚

> Qï¼šæƒ³é—®ä¸‹å˜‰å®¾ï¼š1ã€DCOS è¿™å¥—çŽ¯å¢ƒæ˜¯ç”¨çš„ç¤¾åŒºç‰ˆï¼Ÿ2ã€æ–¹ä¾¿é€éœ²ä¸‹é›†ç¾¤è§„æ¨¡ä¹ˆï¼Ÿ

Aï¼šDCOS çš„è¿™å¥—çŽ¯å¢ƒæ˜¯æˆ‘ä»¬å…¬å¸ç ”å‘çš„ï¼Œ ä½†æ˜¯æˆ‘ä»¬å…¬å¸å’Œ Mesosphere çš„ Open DCOS æ˜¯åˆä½œä¼™ä¼´ï¼Œè¿™ä¸ªæ¶ˆæ¯è¿‘æœŸå°±ä¼šå®£å¸ƒã€‚ç›®å‰æˆ‘ä»¬çŽ¯å¢ƒè§„æ¨¡æ˜¯ 50 ä¸ª mesos-slave å·¦å³ã€‚

> Qï¼šè¯·é—®è¿™ä¸ªç³»ç»Ÿæœ¬èº«æ¶ˆè€—å¥½èµ„æºå¤šå°‘ï¼Ÿä¾‹å¦‚é‡‡é›† CPU ç”¨ top å‘½ä»¤ï¼Œtop æœ¬èº«æ˜¯æ¶ˆè€—å¾ˆå¤šèµ„æºã€‚

Aï¼šç›®å‰åœ¨æˆ‘ä»¬çš„çŽ¯å¢ƒå®žæµ‹ä¸‹æ¥ï¼ŒcAdvisor çš„ CPU å ç”¨çŽ‡åœ¨ 1\~5%ï¼› å¦‚æžœå®¹å™¨éžå¸¸æ‹¥æŒ¤çš„æƒ…å†µä¸‹ï¼Œå¼€é”€ä¼šåœ¨ 10% ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ cAdvisor æ˜¯ç”¨ Marathon å¯åŠ¨çš„ï¼Œé…ç½®çš„ CPU æ˜¯ 0.1ã€‚

> Qï¼šè¯·é—®æ¯æ¬¡æ–°å¢žç›‘æŽ§çº¬åº¦æ—¶ï¼Œæ˜¯å¦éœ€è¦åŒæ—¶ä¿®æ”¹ cAdvisor å’Œ Prometheusï¼Œå¦‚ä½•ä¿è¯é€šç”¨åŒ–ï¼Ÿæ˜¯å¦è€ƒè™‘è¿‡å…¶ä»–çš„å®¹å™¨ç›‘æŽ§æ–¹æ¡ˆï¼Œæ¯”å¦‚é€šè¿‡ FUSE åœ¨ç”¨æˆ·æ€ç»Ÿè®¡ï¼Œå…¼å®¹åŽ†å²çš„ç›‘æŽ§å·¥å…·ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œ æ˜¯éœ€è¦ä¿®æ”¹ cAdvisor å’Œ Prometheusï¼Œ è¿™ä¸€ç‚¹ä¹Ÿæ˜¯ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤´ç–¼çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬çš„ä¸»è¦æ˜¯é€šè¿‡ 2 æ–¹é¢æ¥åšçš„ï¼Œç¬¬ä¸€æ–¹é¢æ˜¯æŠ½è±¡æœåŠ¡æ¨¡åž‹æ¥åšçš„ï¼Œè®©ä¸åŒçš„æœåŠ¡æ¨¡åž‹çš„å…±åŒéƒ¨åˆ†å¯ä»¥å…±äº«æˆ‘ä»¬çš„ç›‘æŽ§æŒ‡æ ‡å’Œå‘Šè­¦è§„åˆ™ã€‚ç¬¬äºŒæ˜¯åˆ©ç”¨ç°åº¦å‡çº§çš„æ–¹å¼ï¼Œå¯¹ cAdvisor å’Œ Prometheus æ¥è¿›è¡Œå‡çº§ï¼Œå°½é‡ä¿è¯æœåŠ¡ç›‘æŽ§çš„ä¸ä¸­æ–­ã€‚æ­£å¦‚æˆ‘è¯´çš„ï¼Œæå‰çš„è§„åˆ’éžå¸¸é‡è¦ã€‚å…¶ä»–æ–¹æ¡ˆä¹Ÿæœ‰æ‰€è€ƒè™‘ï¼Œä½†æ˜¯ä½¿ç”¨ä¸‹æ¥è¿˜æ˜¯è§‰å¾— cAdvisor å’Œ Prometheus æ›´åŠ é€‚åˆè‡ªåŠ¨å¼¹æ€§ä¼¸ç¼©ã€‚

---

### 2016-03-29ï¼šåŸºäºŽ Dockerã€Mesosã€Ceph å…¨æ–°æŠ€æœ¯æ ˆçš„ä¸‰åœ°ä¸‰ä¸­å¿ƒå®¹ç¾ä½“ç³»

> Qï¼šæ‚¨è¿™ä¸ªæ¡†æž¶ä¸­ä½¿ç”¨çš„ PaaS æ‰§è¡Œæ¡†æž¶å…·ä½“æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šè¿™ä¸ªæ˜¯å¼€æ”¾çš„ï¼Œå¯ä»¥æ˜¯é©¬æ‹‰æ¾ä¹Ÿå¯ä»¥ Kubernetesï¼Œè¿™ä¸ªéƒ½æ²¡æœ‰å…·ä½“çš„é™å®šçš„ã€‚å› ä¸ºæˆ‘è§‰å¾—è¿™ä¸¤ä¸ªéƒ½æ˜¯æ¯”è¾ƒå¥½çš„æ‰§è¡Œæ¡†æž¶ã€‚

> Qï¼šDocker çš„å…´èµ·æ˜¯å¦ä¼šå½±å“ OpenStack äº‘è®¡ç®—çš„åœ°ä½ä¼šå’Œ OpenStack ç«žäº‰ï¼Œå…±å­˜ï¼ŸOpenStack å·¥ç¨‹å¸ˆå¦‚ä½•é¢å¯¹ Docker æŠ€æœ¯çš„å…´èµ·ï¼ŸUnikernel å‘å±•è¶‹åŠ¿èƒ½å¦å–ä»£ Dockerï¼Ÿ

Aï¼šç«žäº‰è‚¯å®šæ˜¯æœ‰çš„ï¼Œä½†æ˜¯å…±å­˜ä¹Ÿæ˜¯å­˜åœ¨çš„ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªç°åº¦çš„ã€‚æˆ‘è§‰å¾— OpenStack å·¥ç¨‹å¸ˆè¦æ‹¥æŠ± Dockerï¼Œå…¶å®žæˆ‘çš„ä¸»è¦å·¥ä½œå°±æ˜¯å‘å®¢æˆ·è®¾è®¡åŸºäºŽ OpenStack çš„ç§æœ‰äº‘è§£å†³æ–¹æ¡ˆã€‚Unikernel æŠ€æœ¯çš„å¯¹æ‰‹ä¸æ˜¯ Dockerï¼Œæ˜¯å®¹å™¨ã€‚å…·ä½“æ˜¯å¦ä¼šå–ä»£ï¼Œæˆ‘è§‰å¾—ä¸ä¸€å®šã€‚

> Qï¼šVxlan å…·ä½“æ€Žä¹ˆå®žçŽ°ï¼Ÿæ˜¯æ ¸å¿ƒäº¤æ¢æœºæ—æŒ‚å¤§äºŒå±‚è®¾å¤‡å—ï¼Ÿå¦å¤–è¶…è¿œè·ç¦»ï¼Œæ¯”å¦‚åŒ—äº¬ä¸Šæµ·è¿™ä¹ˆåšä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæˆ‘ä»¬çŽ°åœ¨é‡åˆ°å»¶è¿Ÿé—®é¢˜æ¯”è¾ƒå¤§ã€‚

Aï¼šVxLan çš„å®žçŽ°åœ¨ Vswitch ä¸­é€šè¿‡å¯¹æ¯æ¬¡ TCP åŒ…çš„ UDP å°è£…ï¼ŒVswitch æ˜¯åœ¨æ¯ä¸ªå®¿ä¸»æœºä¸Šçš„ã€‚åŒ—äº¬åˆ°ä¸Šæµ·çš„è¯ï¼Œå°±éœ€è¦é€šè¿‡å…‰çº¤ä¸­ç»§ï¼Œè¿™ä¼šæŸè€—ä¸€å®šçš„ä¼ è¾“å¸¦å®½ï¼Œè¿™ä¹ˆè¿œè·ç¦»çš„ä¼ è¾“åªèƒ½ç­‰å¾…å…‰ä¼ è¾“æŠ€æœ¯çš„å‘å±•ä»¥åŠåœ¨åº”ç”¨å±‚é¢è¿›è¡Œå¼¥è¡¥ã€‚ä¸è¿‡åœ¨åº”ç”¨å±‚åŽ»å¼¥è¡¥è¿™ä¸æ˜¯å¾ˆå¥½çš„æ–¹æ¡ˆã€‚

> Qï¼šZK é›†ç¾¤çš„éƒ¨ç½²æ˜¯æ€Žæ ·ï¼Ÿæœ‰åšå“ªäº›è°ƒä¼˜ä¹ˆï¼Ÿå¦å¤–ç½‘ç»œæ–¹é¢æœ‰åšå“ªäº›ç›‘æŽ§ä¹ˆï¼Ÿ

Aï¼šä¸»è¦æ˜¯æ ¹æ®å®žé™…çš„è¯·æ±‚æ—¶å»¶å¯¹ TIMEOUT è¿›è¡Œä¿®æ”¹ï¼Œç½‘ç»œæ–¹é¢çš„ç›‘æŽ§æ˜¯é€šè¿‡ä¸“ä¸šçš„å®‰å…¨è®¾å¤‡è¿›è¡Œã€‚

> Qï¼š é‚£ä¸ªæ•°æ®ä¸­å¿ƒéƒ¨ç½² 3 æœº Mesosmasterï¼Œæ‰€æœ‰æ•°æ®ä¸­å¿ƒå…±äº«ä¸€ä¸ª ZK é›†ç¾¤ï¼Œéš¾é“è¿™ä¸ª ZK é›†ç¾¤å¦‚ä½•åœ¨å¤šæ•°æ®ä¸­å¿ƒéƒ¨ç½²ï¼Œè¿˜æœ‰å› ä¸ºç½‘ç»œå»¶æ—¶å¯¼è‡´ slave æŽ‰äº†åŽï¼Œæˆ–è€… executor æŒ‚äº†åŽæ€Žä¹ˆå¤„ç†å­¤å„¿å®¹å™¨ã€‚

Aï¼šZK æ˜¯æ¯å° Master èŠ‚ç‚¹ä¸Šçš„ï¼Œç”±äºŽä½¿ç”¨äº†å¤§äºŒå±‚ç½‘ç»œï¼Œæ‰€ä»¥æ‰€æœ‰çš„ ZK å°±ç›¸å½“äºŽåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…éƒ¨ç½²çš„ã€‚å¯¹äºŽå­¤å„¿å®¹å™¨ï¼Œæ˜¯ Kill æŽ‰ç„¶åŽæ›¿æ¢çš„ã€‚

> Qï¼šè¯·é—®åœ¨ä½ ä»¬è®¾è®¡çš„æ–¹æ¡ˆä¸­é€šå¸¸å»ºè®®ç”¨æˆ·ç§Ÿç”¨å‡ æ¡è£¸çº¤æ¥å®žçŽ°ä¸‰åœ°ä¸‰ä¸­å¿ƒï¼ŒåŒæ—¶è€ƒè™‘è¿‡ç§Ÿç”¨é•¿è·ç¦»è£¸çº¤ç»™ç”¨æˆ·å¸¦æ¥çš„é•¿æœŸè¿ç»´æˆæœ¬å—ï¼Ÿ

Aï¼šæ©ï¼Œè¿™æ˜¯ä¸ªå¥½é—®é¢˜ï¼Œæˆ‘åœ¨å‡†å¤‡è¿™æ¬¡åˆ†äº«çš„æ—¶å€™ä¹Ÿåœ¨è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚è¿™ä¸ªè®¾è®¡æ–¹æ¡ˆçš„å‰ææ˜¯å®¢æˆ·æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œéœ€è¦æ”¯ä»˜è¿™æ ·çš„æˆæœ¬åŽ»å®žçŽ°ã€‚ä»ŽæŠ€æœ¯çš„è§’åº¦ï¼ŒåŒçº¤æ˜¯æ€§èƒ½ä¸Žç»æµŽæ€§çš„å¹³è¡¡ç‚¹ã€‚

> Qï¼šè¯·é—®å…³äºŽäº‹åŠ¡å¤„ç†çš„è´Ÿè½½è½®è¯¢ï¼Œå¦‚æžœä½¿ç”¨é•¿è¿žæŽ¥ï¼Œå¦‚ä½•ä¿è¯æ¯ä¸ªè¿žæŽ¥è´Ÿè½½æ˜¯å‡åŒ€çš„ï¼ŒåŒæ—¶è¿™é‡Œçš„äº‹åŠ¡æ˜¯æŒ‡å­˜å‚¨å±‚çš„è¿˜æ˜¯åº”ç”¨å±‚çš„ï¼Œå¦‚æžœæ˜¯åº”ç”¨å±‚æ˜¯å¦‚ä½•ä¿è¯äº‹åŠ¡çš„ï¼Ÿ

Aï¼šè¿™ä¸ªç¡®å®žæ¯”è¾ƒéš¾ï¼Œå¯ä»¥é‡‡ç”¨ç±»ä¼¼äºŽä¸€è‡´æ€§å“ˆå¸ŒçŽ¯çš„æ€æƒ³ï¼Œå°±æ˜¯å°½å¯èƒ½å¤šçš„å°†è½®è¯¢çŽ¯è¿›è¡Œåˆ†å‰²ï¼Œè¿™æ ·é•¿è¿žæŽ¥å°±ä¼šå°½å¯èƒ½çš„å‡è¡¡åˆ†é…ã€‚è´Ÿè½½è½®è¯¢æ˜¯åœ¨åº”ç”¨å±‚é¢è¿›è¡Œè½®è¯¢çš„ã€‚

> Qï¼šä½ ä»¬è¿™å¥—æž¶æž„ä¸Šç”Ÿäº§çŽ¯å¢ƒäº†å—ï¼ŸCeph æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œ6 ä¸ªå‰¯æœ¬å»¶è¿Ÿä¼šä¸ä¼šå¤§ï¼Ÿå…­ä¸ªå‰¯æœ¬æ˜¯ä¸æ˜¯æœ‰ç‚¹æµªè´¹å­˜å‚¨ç©ºé—´ï¼Ÿå¤§è§„æ¨¡å†™å…¥çš„æ—¶å€™ IO ä¼šä¸ä¼šæ˜¯ç“¶é¢ˆï¼ˆCeph å…ˆå†™ Journalï¼Œå†å†™ç£ç›˜ï¼‰ï¼Ÿå¦å¤–ï¼Œä½ ä»¬æ˜¯å…¨ SSD å—ï¼Ÿ

Aï¼šè¿™å¥—æž¶æž„æ²¡æœ‰ä¸Šç”Ÿäº§çŽ¯å¢ƒã€‚è¿™æ˜¯æˆ‘ä»¬å…¬å¸åšçš„ä¸€ä¸ªå‰çž»æ€§æ–¹æ¡ˆè®¾è®¡ç ”ç©¶ã€‚åœ¨ Ceph çš„å‰¯æœ¬é…ç½®ä¸­ï¼Œæœ‰ä¸€ä¸ªæœ€å°å‰¯æœ¬æ•°ï¼Œå¯ä»¥å…ˆè®¾ç½®ä¸€ä¸ªæœ€å°å‰¯æœ¬æ•°å®žçŽ°å¿«é€Ÿçš„å†™æ“ä½œã€‚ä¹‹æ‰€ä»¥ 6 å‰¯æœ¬ï¼Œä¸»è¦æ˜¯é˜²æ­¢é¿å…è¿‡åº¦é¢‘ç¹çš„æ•°æ®è¯»åˆ‡æ¢ã€‚åœ¨è¿™ç§æ–¹æ¡ˆä¸‹ï¼Œå»ºè®®å…¨éƒ¨æ˜¯ SSDï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æœ‰é€‰æ‹©æ€§çš„ä½¿ç”¨ SASã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 3 æœˆ 29 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**èµµè‹±ä¿Šï¼Œæ¥è‡ªåŸŽäº‘ç§‘æŠ€ä¼ä¸šäº‘äº‹ä¸šéƒ¨ï¼Œä»Žäº‹äº‘è®¡ç®—å¤§æ•°æ®äº‘å­˜å‚¨çš„é¡¹ç›®å’¨è¯¢å’Œç®¡ç†å·¥ä½œã€‚

---

### 2016-03-22ï¼šå¤ªä¿ DCOS å¹³å°------å¾®ä¿¡é¡¹ç›®å®žè·µ

> Qï¼šæƒ³é—®ä¸‹å˜‰å®¾ï¼Œèµ„æºè°ƒåº¦å±‚ä¸ºå•¥é€‰ç”¨äº† Mesos è€Œä¸æ˜¯ Kubernetesï¼ŸMesos ä½¿ç”¨çš„æ˜¯å¼€æºç‰ˆæœ¬ï¼Ÿä»Žé¡¹ç›®é¢„ç ”åˆ°è½åœ°æŠ•å…¥çš„äººåŠ›æ˜¯å¤šå°‘ï¼ˆå«å¼€å‘ã€æµ‹è¯•ã€è¿ç»´ï¼‰ï¼æ–¹ä¾¿é€éœ²çš„è¯ï¼Ÿ

Aï¼šKubernetes æä¾›çš„é›†æˆåŠŸèƒ½è¾ƒå¤šï¼Œå¯ä»¥æä¾›æ•´ä½“çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æˆ‘ä»¬æœ‰å¾ˆå¤šå†…éƒ¨çš„åº”ç”¨é—´è°ƒç”¨ï¼Œæœ€åŽé€‰å®šäº† HAProxy+Mesos çš„æ–¹å¼ï¼Œè€Œä¸”ä»Žå‰æœŸçš„è¯„æµ‹æ¥çœ‹ Mesos ä¸Ž Marathon é›†æˆæ›´ä¸ºç¨³å®šã€‚

> Qï¼šå®¹å™¨è¿è¡Œ WebLogic çš„æ—¶å€™æœ‰æ²¡æœ‰é‡åˆ°ä»€ä¹ˆå‘å¯ä»¥åˆ†äº«ä¸€ä¸‹å—ï¼Ÿ

Aï¼šå®¹å™¨è¿è¡Œ WebLogic æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†å¦‚æžœç¨‹åºåŒ…è¿‡å¤§ï¼Œå®¹å™¨çš„è‡ªåŠ¨æ¢å¤æ—¶é—´ä¼šè¾ƒé•¿ï¼Œæ‰€ä»¥å»ºè®®æŽ§åˆ¶æ¯ä¸€ç¨‹åºåŒ…çš„å¤§å°ã€‚

> Qï¼šç ”ç©¶æ–°çš„è½¯ä»¶å¦‚ Mesos è¿™ä¹ˆé‡é‡çº§çš„äº§å“ä¹Ÿæ˜¯éœ€è¦å¾ˆå¤§çš„æ—¶é—´æˆæœ¬å’ŒäººåŠ›æˆæœ¬çš„ï¼å¦‚ä½•æƒè¡¡çš„ï¼Ÿ

Aï¼šä¸»è¦è¿˜æ˜¯çœ‹é¢å¯¹çš„é—®é¢˜ï¼Œåœ¨å¾®ä¿¡çº¢åŒ…è¿™æ ·çš„åº”ç”¨åœºæ™¯ä¸­ä¼ ç»ŸæŠ€æœ¯å·²é‡åˆ°ç“¶é¢ˆï¼Œå¿…é¡»è¦å¼•å…¥æ–°æŠ€æœ¯ã€‚ä¸è¿‡æˆ‘ä»¬å¾ˆå¤šæ–°æŠ€æœ¯çš„ç ”å‘æ˜¯å‰æœŸå³è¿›è¡Œï¼Œè¿›è¡Œå‰æœŸçš„æŠ€æœ¯å‚¨å¤‡ã€‚

> Qï¼šæˆ‘ä»¬å‘çŽ°ï¼Œåœ¨ Mesos ä¸­ï¼Œå¦‚æžœä¸»è¿›ç¨‹å…ˆé€€å‡ºï¼Œè€Œå­è¿›ç¨‹è¿˜åœ¨çš„è¯ï¼Œä¼šå¯¼è‡´ task ç›´æŽ¥è¿”å›žï¼Œè€Œæˆ‘ä»¬çš„å®žé™…åº”ç”¨ä¸­æœ‰æ¯”è¾ƒå¤æ‚çš„çˆ¶å­è¿›ç¨‹å…³ç³»ï¼Œé™¤äº†é‡æ–°æ¢³ç†ä¸€ä¸‹å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆåˆ«çš„å¥½çš„åšæ³•ï¼Ÿ

Aï¼šåº”ç”¨ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬æ­£åœ¨ç€æ‰‹åœ¨ Marathon è°ƒåº¦ä¹‹å‰ï¼Œå¦‚ B åº”ç”¨ä¸Ž A åº”ç”¨æœ‰ä¾èµ–å…³ç³»ï¼Œåˆ™å…ˆåˆ¤æ–­ A æ˜¯å¦å¯åŠ¨ï¼ŒA å¦‚æžœæ²¡å¯åŠ¨åˆ™å¯åŠ¨ A å†å¯åŠ¨ Bï¼ŒåŒæ—¶ï¼Œéœ€åˆ¤æ–­ A åº”ç”¨å¯åŠ¨åŽæ˜¯å¦æ»¡è¶³åº”ç”¨æœåŠ¡èƒ½åŠ›ï¼Œæ¯”å¦‚ä¸€ä¸ªå®¹å™¨æ˜¯å¦èƒ½æ‰¿å—åŽ‹åŠ›ã€‚

> Qï¼šè¯·é—®ä¸‹ Docker åœ°å€å¦‚ä½•åˆ†é…å’Œç®¡ç†è·¨ä¸»æœºé€šè®¯ï¼Ÿ

Aï¼šåœ°å€æ˜¯æœ‰å®¹å™¨å¹³å°åŠ¨æ€åˆ†é…ï¼Œè·¨ä¸»æœºé€šè®¯é€šè¿‡ HAProxy è¿›è¡Œåº”ç”¨é—´è°ƒç”¨ã€‚

> Qï¼šä½ ä»¬å¦‚ä½•åšç›‘æŽ§çš„ï¼Ÿå°±æ˜¯çº¢åŒ…æ´»åŠ¨çš„æ—¶å€™å¦‚ä½•ç›‘æŽ§å½“å‰çš„æœåŠ¡å™¨æ€§èƒ½æˆ–è€…æ˜¯æŽ¥å£çš„è®¿é—®é‡ä¹‹ç±»çš„ï¼Ÿ

> Qï¼šèŠä¸€èŠä¸ºä»€ä¹ˆä½¿ç”¨ä¼ ç»Ÿæ–¹æ³• +APM ç›‘æŽ§è€Œä¸ä½¿ç”¨ cAdvisorã€Prometheusã€Docker API æ¥å®žçŽ°ï¼Ÿ

Aï¼šä¸¤ä¸ªé—®é¢˜æˆ‘ä¸€å¹¶å›žç­”ï¼Œå› ä¸ºæˆ‘ä»¬ APM å¹¶ä¸æ˜¯ä»…ä½¿ç”¨åœ¨å®¹å™¨å¹³å°ï¼Œç›®å‰åœ¨ä¼ ç»Ÿå¹³å°ä¹Ÿä½¿ç”¨ï¼Œæ­£å¥½ä¸Šå®¹å™¨å¹³å°å‘çŽ°ä¼ ç»Ÿç›‘æŽ§é‡åˆ°é—®é¢˜ï¼Œå½“æ—¶æˆ‘ä»¬åš APM çš„ poc æœ‰ä¸€æ®µæ—¶é—´ï¼Œå‘çŽ° APM æ­£å¥½å¯ä»¥è§£å†³æ­¤é—®é¢˜ï¼Œæ‰€ä»¥å°±é‡‡ç”¨äº†è¿™ç§æ–¹å¼ã€‚\ å®¹å™¨å¹³å°æœ¬èº«æ˜¯æœ‰æ€§èƒ½å’Œå¯ç”¨æ€§ç›‘æŽ§å·¥å…·ã€‚ç”¨ APM æ˜¯æ›´å¥½çš„è¿›è¡Œåº”ç”¨çš„ç«¯åˆ°ç«¯ç›‘æŽ§ã€‚

> Qï¼šä¼ ç»Ÿè¡Œä¸šè½¬å®¹å™¨ä¸€èˆ¬æ²¡é‚£ä¹ˆå®¹æ˜“ï¼Œä½ ä»¬æœ‰ä»€ä¹ˆè¿‡åº¦æ–¹æ¡ˆå—ï¼Ÿ

Aï¼šæˆ‘ä»¬é’ˆå¯¹æ— çŠ¶æ€çš„åº”ç”¨ã€ä¼ ç»Ÿåº”ç”¨çš„å®¹å™¨åŒ–éƒ½åˆ¶å®šäº†å¯¹åº”çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œå¸®åŠ©ç ”å‘å›¢é˜Ÿè¿›è¡Œåº”ç”¨çš„å®¹å™¨åŒ–è¿ç§»ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 3 æœˆ 22 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æ²ˆå¤§æ–Œï¼Œå¤ªå¹³æ´‹ä¿é™©ä¿¡æ¯æŠ€æœ¯ä¸­å¿ƒé«˜çº§ç»ç†ï¼Œç›®å‰ä¸»è¦è´Ÿè´£ Docker å®¹å™¨æŠ€æœ¯åœ¨å¤ªä¿é›†å›¢çš„è½åœ°ã€æŽ¨å¹¿åŠä¼˜åŒ–å·¥ä½œã€‚18 å¹´ä¿é™©è¡Œä¸š IT ä»Žä¸šç»éªŒï¼Œä¸“æ³¨äºŽåº”ç”¨è¿ç»´é¢†åŸŸã€‚

---

### 2016-03-15ï¼šKubernetes é›†æˆå¤–éƒ¨æœåŠ¡å®žè·µ

> Qï¼šè¯·é—®åœ¨ä¸¾çš„ MySQL æœåŠ¡çš„ä¾‹å­ä¸­ï¼Œè®²åˆ°ä¸æ˜¯é‡‡ç”¨åº”ç”¨ä¸Ž MySQL ä¸€èµ·æ‰“åŒ…æˆå®¹å™¨è¿è¡Œçš„æ–¹å¼ï¼Œè€Œæ˜¯åªéœ€è¦æŠŠåº”ç”¨é“¾æŽ¥ mysql æœåŠ¡çš„çŽ¯å¢ƒå˜é‡æ³¨å†Œåˆ° PaaS å¹³å°ä¸Šé¢å°±å¯ä»¥ä½¿ç”¨ MySQL çš„æœåŠ¡äº†æ˜¯å—ï¼Ÿé‚£ä¹ˆä½ ä»¬å¹³å°ä¸Šé¢ä¸æ˜¯è¿è¡Œå¤šä¸ª MySQL é•œåƒå—ï¼Ÿ

Aï¼šåŽç«¯æœåŠ¡ä¸Ž PaaS åœ¨é€»è¾‘ä¸Šæ˜¯åˆ†å¼€çš„ï¼Œå¯èƒ½ç‹¬ç«‹è¿è¡Œåœ¨å¹³å°é›†ç¾¤å¤–éƒ¨ï¼Œä¹Ÿå¯èƒ½è¿è¡Œåœ¨é›†ç¾¤é‡Œï¼Œä»¥ service çš„å½¢å¼æœåŠ¡ã€‚æ‰€ä»¥æ˜¯å¦è¿è¡Œå¤šä¸ª MySQL å®¹å™¨ï¼Œå–å†³äºŽ servicebroker çš„è®¾è®¡å®žçŽ°ã€‚æ¯ä¸€ç§ servicebroker çš„è®¾è®¡éƒ½ä¸å¿…ç›¸åŒã€‚

> Qï¼šå¦‚æžœæˆ‘æŠŠ MySQL çŽ¯å¢ƒå˜é‡æ³¨å†Œåˆ° PaaS å¹³å°åŽï¼Œæˆ‘åº”ç”¨é“¾æŽ¥ä½ ä»¬å¹³å°ä¸Šé¢çš„ MySQL æœåŠ¡åŽï¼Œå¦‚æžœåŽæœŸåˆ†åº“åˆ†è¡¨å¯ä»¥å—ï¼Ÿè¿˜éœ€è¦é‡æ–°é…ç½®çŽ¯å¢ƒå˜é‡ä¿¡æ¯å—ï¼Ÿ

Aï¼šè¿™ä¸ªå–å†³äºŽåŽç«¯æœåŠ¡æä¾›çš„å¥—é¤ã€‚ä¸åŒå¥—é¤è®¡åˆ’æä¾›ä¸åŒç¨‹åº¦çš„æœåŠ¡ã€‚

> Qï¼š1. Kubernetes è‡ªå®šä¹‰æ‰©å±•å…·ä½“æ€Žä¹ˆåšçš„ï¼Ÿ2.åŽç«¯æœåŠ¡ä½ å¼¹æ€§ä¼¸ç¼©ç›´æŽ¥ç”¨ Kubernetes è‡ªå¸¦çš„ï¼Œè¿˜æ˜¯æœ‰ä»€ä¹ˆæ”¹é€ ï¼Ÿ

Aï¼š1. æ‰©å±• Kubernetes æ˜¯æˆ‘ä»¬å‚è€ƒ Kubernetes çš„ API serverã€Controller è¿™ç§å¼‚æ­¥æœºåˆ¶ç›´æŽ¥åœ¨ Kubernetes ä¸­å¢žåŠ ä»£ç ï¼ŒKubernetes åœ¨æ˜“æ‰©å±•æ€§ä¸Šåšçš„æŒºå¥½ã€‚2. åŽç«¯æœåŠ¡å¯ä»¥è¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸Šï¼Œæˆ–ç‹¬ç«‹è¿è¡Œï¼Œå…¶å¼¹æ€§ä¼¸ç¼©ç”±åŽç«¯æœåŠ¡è‡ªèº«çš„è®¾è®¡æ¥å†³å®šã€‚

> Qï¼šè¯·é—®å®¹å™¨é‡Œçš„çŽ¯å¢ƒå˜é‡æ˜¯ Kubernetes çš„ BackingService è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè¿˜æ˜¯ OpenShift ç‰¹æœ‰çš„ï¼Ÿæ˜¯ä¸æ˜¯å¯ä»¥è¯´å› ä¸º Backing Service ä¼šè‡ªåŠ¨åœ¨å®¹å™¨é‡Œæ³¨å†ŒçŽ¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥æŸäº›åœºæ™¯ä¸‹ä½¿ç”¨èµ·æ¥æ¯”èµ·ç›´æŽ¥ä½¿ç”¨ MongoDB åœ°å€æ¥å¾—æ–¹ä¾¿ï¼Ÿ

Aï¼šæ˜¯å®žä¾‹åœ¨ç»‘å®šçš„æ—¶å€™ç”±æˆ‘ä»¬çš„æ‰©å±•ç”Ÿæˆï¼Œå¹¶æ›´æ–°åˆ° pod é‡Œï¼Œä¸æ˜¯ OpenShift ç‰¹æœ‰çš„ã€‚ç¬¬äºŒä¸ªé—®é¢˜çš„è¯ï¼Œç¡®å®žæ˜¯è¿™æ ·ï¼Œå¤šæ•°æƒ…å†µä¸‹ï¼Œç”¨çŽ¯å¢ƒå˜é‡éƒ½ä¼šå¾ˆæ–¹ä¾¿ã€‚

> Qï¼šKubernetes çš„ Volumeï¼Œä½ ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Œå½“ pod å‘ç”Ÿè¿ç§»åŽï¼Œå¦‚ä½•ä¿è¯ Volume è¿˜æŒ‚åœ¨ pod ä¸Šï¼Ÿ

Aï¼šKubernetes æœ¬èº«æä¾›äº† persistent volume åŠŸèƒ½ï¼Œå¹¶ä¸”æ”¯æŒå¤šç§å­˜å‚¨æœºåˆ¶ã€‚pod è¿ç§»æ—¶ï¼ŒKubernetes ä¼šç»´æŠ¤å…¶å¯¹åº”çš„ Volumeï¼Œæ ¹æ®ä¸åŒçš„å­˜å‚¨ï¼ŒKubernetes æœ‰ä¸åŒçš„è°ƒåº¦å®žçŽ°ã€‚

> Qï¼šçŽ°åœ¨ç”Ÿäº§ä¸Šç”¨ä»€ä¹ˆç›‘æŽ§ï¼Œç›‘æŽ§æœ‰æŠ¥è­¦å—ï¼Œä»€ä¹ˆç²’åº¦çš„ï¼Ÿè¿˜æœ‰å°±æ˜¯æ—¥å¿—æ”¶é›†æ€Žä¹ˆå¤„ç†æœ‰ä»€ä¹ˆæˆç†Ÿçš„æ–¹æ¡ˆå—ï¼Ÿ

Aï¼šæˆ‘ä»¬é‡‡ç”¨äº†å¤šç§ç›‘æŽ§æœºåˆ¶ã€‚ä¸»æœºã€å®¹å™¨ã€å’Œ Kubernetes æœåŠ¡æœ¬èº«ï¼Œæˆ‘ä»¬éƒ½é‡‡å–ä¸åŒçš„ç›‘æŽ§ç­–ç•¥/å·¥å…·ã€‚è‡³äºŽç²’åº¦ï¼Œä¹Ÿè·Ÿç›‘æŽ§çš„å¯¹è±¡æœ‰å…³ã€‚æ—¥å¿—æˆ‘ä»¬ç”¨ ELKã€‚

> Qï¼šKubernetes çš„éƒ¨ç½²å¯å¦åšåˆ°è·¨æ•°æ®ä¸­å¿ƒå—ï¼Ÿå¦‚ä½•å®žçŽ°ï¼Ÿè°¢è°¢ã€‚

Aï¼šKubernetes æ˜¯åˆ†å¸ƒå¼çš„å¼‚æ­¥ç³»ç»Ÿï¼Œç†è®ºä¸Šæ˜¯å¯ä»¥è·¨æ•°æ®ä¸­å¿ƒçš„ã€‚ä½†è€ƒè™‘åˆ°ç½‘ç»œçŽ¯å¢ƒçš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬å½“å‰è¿˜æ²¡æœ‰ä½œè¿™æ–¹é¢çš„å°è¯•ã€‚

ä»¥ä¸Šå†…å®¹æ ¹æ® 2016 å¹´ 3 æœˆ 15 æ—¥æ™šå¾®ä¿¡ç¾¤åˆ†äº«å†…å®¹æ•´ç†ã€‚åˆ†äº«äºº**æŸ´å®—ä¸‰ï¼Œèµ„æ·±æž¶æž„å¸ˆï¼Œ10 å¹´çš„ IT ä»Žä¸šç»éªŒï¼Œåœ¨äº‘è®¡ç®—ã€å¤§æ•°æ®æ–¹é¢åŠå¤§åž‹ä¼ä¸šçº§åº”ç”¨æ‹¥æœ‰ä¸°å¯ŒæŠ€æœ¯æž¶æž„ç»éªŒã€‚è´Ÿè´£åŒ—äº¬äºšä¿¡æ™ºæ…§æ•°æ®ç§‘æŠ€æœ‰é™å…¬å¸å¤§æ•°æ®äº‘å¹³å°çš„æž¶æž„è®¾è®¡åŠå¼€å‘ç®¡ç†ã€‚

---

### 2016-03-04ï¼šDocker åœ¨ä¹è§†çš„å®žè·µä¹‹è·¯

> Qï¼šæƒ³è¯·é—®ä¸€ä¸‹è¿™äº› Docker æ˜¯éƒ¨ç½²åœ¨ç‰©ç†æœºä¸Šè¿˜æ˜¯è™šæ‹Ÿæœºä¸Šï¼Ÿåœ¨æ‰©å®¹çš„æ—¶å€™é™¤äº†å¢žåŠ å†…å­˜ï¼Œèƒ½å¢žåŠ  CPU å—ï¼Ÿ

Aï¼šç‰©ç†æœºå’Œè™šæ‹Ÿæœºéƒ½æœ‰ï¼Œæˆ‘ä»¬æä¾›ä¸€é”®å®‰è£… Docker å’Œå…¶ä»–ç»„ä»¶çŽ¯å¢ƒçš„è„šæœ¬ï¼Œä¸šåŠ¡éƒ¨é—¨å•çº¯æ‰§è¡Œè„šæœ¬å³å¯ã€‚åœ¨æ‰©å®¹æ–¹é¢æˆ‘ä»¬çŽ°åœ¨åªåšäº†å†…å­˜æ‰©å®¹ï¼ŒCPU æ˜¯å…±äº«çš„ã€‚

> Qï¼šé€šè¿‡é•œåƒçš„æž„å»ºè„šæœ¬æ˜¯æ€Žä¹ˆç”Ÿæˆé•œåƒçš„ï¼Ÿåœ¨åŸºç¡€é•œåƒä¸Šæ‰§è¡Œç›¸å…³è„šæœ¬ä¹ˆï¼Ÿä¸€äº›ç«¯å£å­˜å‚¨å·çŽ¯å¢ƒå˜é‡è¿™äº›é•œåƒä¸­çš„ä¿¡æ¯æ˜¯æ€Žä¹ˆè§£å†³çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬å¯¹ Dockerfile è¿›è¡Œäº†å°è£…ï¼Œä¸šåŠ¡å’Œå¼€å‘äººå‘˜ä¸éœ€è¦å…³å¿ƒ Dockerfile è¯­æ³•ï¼Œç›´æŽ¥å†™ä¸€ä¸ªé•œåƒæž„å»ºè„šæœ¬ï¼Œæœ€åŽæ ¹æ®ä¸€å®šçš„è§„åˆ™ç”± Harbor ç”Ÿæˆ Dockerfileï¼Œä¹‹åŽè°ƒç”¨ docker build åŽ»ç”Ÿæˆé•œåƒã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ é•œåƒçš„åç§°ï¼Œç‰ˆæœ¬éƒ½å·²ç»æ ¹æ®è§„åˆ™ç”Ÿæˆ

> Qï¼šèµ„æºå…±äº«çš„æ–¹å¼ï¼Œä¸èƒ½æ˜¯ä¸€ä¸ªéƒ¨é—¨æˆ–è€…å°ç»„å¢žåŠ ä¸€ä¸ªå…¬ç”¨è´¦å·ï¼ŒæŠŠéœ€è¦åˆ†äº«çš„èµ„æºï¼Œpush åˆ°å…¬ç”¨è´¦å·å—ï¼Ÿ

Aï¼šæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨å…¬å…±è´¦å·çš„æ–¹å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é•œåƒä»“åº“çš„æ–¹å¼ï¼Œé•œåƒä»“åº“å¯ä»¥æœ‰å›¢é˜Ÿæˆå‘˜ï¼Œè¾¾åˆ°çš„æ•ˆæžœæ˜¯ä¸€æ ·çš„ã€‚

> Qï¼šæŠ›å¼ƒ Jenkins é‚£ä½ ä»¬å¤šè¯­è¨€æ€Žä¹ˆåŠž Java ç¼–è¯‘å’Œ Golang ç¼–è¯‘è¿™äº›ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒä»€ä¹ˆè¯­è¨€ï¼Œæˆ‘ä»¬çŽ°åœ¨æä¾›äº†ä¸€ä¸ª Java å…¬ç”¨çš„åŸºç¡€é•œåƒï¼Œç¼–è¯‘ä»€ä¹ˆçš„éƒ½å¯ä»¥åœ¨æž„å»ºæ—¶å€™å®Œæˆã€‚ å¦‚æžœéœ€è¦å…¶ä»–è¯­è¨€ï¼Œæ¯”å¦‚ goã€Pythonï¼Œå¯ä»¥æœ‰ä¸šåŠ¡éƒ¨é—¨è‡ªå·±åˆ›å»ºè‡ªå·±çš„åŸºç¡€é•œåƒã€‚

> Qï¼šJenkins é…ç½® jdk å’Œ mavenï¼Œæ˜¯è¦åœ¨å®¹å™¨é‡Œè‡ªå·±å®‰è£…å—ï¼Ÿ

Aï¼šåœ¨æž„å»ºæ—¶å€™ï¼Œè¿™äº›çŽ¯å¢ƒå¯ä»¥åœ¨ä¸šåŠ¡éƒ¨é—¨åŸºç¡€é•œåƒé‡Œï¼Œæå‰å®‰è£…å¥½ã€‚

> Qï¼šåœ¨æž„å»ºæ—¶å€™ï¼Œè¿™äº›çŽ¯å¢ƒå¯ä»¥æå‰å®‰è£…å¥½ï¼Ÿ

Aï¼šåº”ç”¨é‡Œéƒ½æœ‰è‡ªå·±çš„ç‰ˆæœ¬æ¦‚å¿µï¼Œæ¯ä¸ªåº”ç”¨ç‰ˆæœ¬é‡Œæœ‰ï¼šé•œåƒç‰ˆæœ¬ï¼ŒçŽ¯å¢ƒå˜é‡ã€ exportã€Volmue ç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨å›žé€€æˆ–è€…å‡çº§æ—¶å€™ï¼Œæœ€ç»ˆçš„è¡¨çŽ°å½¢å¼å°±æ˜¯æ€æŽ‰æ—§å®¹å™¨ï¼Œæ ¹æ®ç‰ˆæœ¬çš„å‚æ•°åˆ›å»ºæ–°å®¹å™¨ã€‚

> Qï¼šHarbor å’Œ Jenkins æ¯”èµ·æ¥ä½ ä»¬æ˜¯ä¸æ˜¯åŸºäºŽåŽè€…çš„å®žçŽ°æ€è·¯å¼€å‘çš„ç²¾ç®€ç‰ˆï¼Œè§£å†³é—®é¢˜çš„æ–¹æ³•å’Œæ€è·¯å˜äº†å—ï¼Ÿ

Aï¼šåŽŸå› æœ‰å¤šä¸ªï¼Œæˆ‘ä»¬å¸Œæœ› Harbor èƒ½ä»Žä»£ç åˆ°æž„å»ºåˆ°éƒ¨ç½²ä¸€æ°”å‘µæˆï¼Œå¦‚æžœç”¨ Jenkinsï¼Œä¼šç»™ç”¨æˆ·å·²æ–­ç‰‡çš„æ„Ÿè§‰ï¼Œä¸šåŠ¡éƒ¨é—¨ä¸€æ—¦ä¸šåŠ¡å¤šçš„è¯ï¼Œæœ‰å¯èƒ½ä¼šåˆ†ä¸æ¸…å“ªä¸ª Git å¯¹åº”å“ªä¸ª Jenkins é…ç½®ã€‚å­¦ä¹ æˆæœ¬ä¹Ÿæ¯”è¾ƒé«˜ã€‚

> Qï¼šä½ ä»¬è¿™æ ·ï¼Œå¼€å‘äººå‘˜çš„æœ¬åœ°çŽ¯å¢ƒæ˜¯ä¸æ˜¯ä¸éœ€è¦ä½¿ç”¨å®¹å™¨äº†ï¼Ÿ

Aï¼šæœ¬åœ°çŽ¯å¢ƒä¸€èˆ¬ä¸éœ€è¦å®¹å™¨ï¼Œä½†æ˜¯å¦‚æžœå¼€å‘äººå‘˜æƒ³ä½¿ç”¨å®¹å™¨çŽ©çŽ©ï¼Œå¯ä»¥é€šè¿‡æˆ‘ä»¬æä¾›çš„åŸºç¡€é•œåƒåˆ›å»ºä¸€ä¸ªå®¹å™¨å³å¯ã€‚

> Qï¼šæœ€è¿‘åœ¨å­¦ä¹  Magnum å’Œ Kubernetesã€‚æœ‰ä¸€äº›ç–‘é—®æ¯”å¦‚ minionA/B ä¸Šåˆ†åˆ«æœ‰ serviceA çš„ podA/Bã€‚é‚£ä¹ˆè®¿é—® minionA çš„ kube-proxy æ˜¯ä¸æ˜¯ä¹Ÿä¼šè¢«å¯¼æµåˆ° minionB ä¸Šçš„ podB ä¸Šï¼Ÿservice çš„é‡è¦éƒ¨ä»¶ proxy å°±æ˜¯èµ·åˆ°äº†ä¸ªè´Ÿè½½å‡è¡¡å’Œåå‘ä»£ç†çš„ä½œç”¨ã€‚è¿™ä¸ªè§’è‰²æ˜¯ä¸æ˜¯ç›´æŽ¥å¯ä»¥ç”¨ haproxy/nginx è¿™æ ·çš„è½¯ä»¶ä»£æ›¿å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¹Ÿåœ¨ç ”ç©¶ Kubernetesï¼Œä¸æ•¢åšè¿‡å¤šçš„è¯„ä»·ï¼Œæ®è¯´ proxy è¿™å—æ€§èƒ½æœ‰é—®é¢˜ã€‚ åˆšå¼€å§‹æ²¡ç”¨ Kubernetesï¼Œæ˜¯å› ä¸ºä¹‹å‰ä»–è¿˜ä¸æ˜¯å¾ˆç¨³å®šï¼Œå˜åŠ¨ä¹Ÿæ¯”è¾ƒå¿«ã€‚ è´Ÿè½½å‡è¡¡è¿™å—æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„ï¼Œæ•´ä¸ªä¹è§†ç½‘çŽ°åœ¨ 300 å¤šä¸ªåŸŸåéƒ½è·‘åœ¨ä¸Šé¢ã€‚

> Qï¼šè¯·é—®æž„å»ºä¸€æ¬¡å¹³å‡è¦å¤šé•¿æ—¶é—´ï¼Ÿ

Aï¼šçŽ°åœ¨ Javaã€Dubboã€Pythonã€go çš„å¤šï¼Œ ä¸€èˆ¬ 2 åˆ†é’Ÿï¼Œè€Œä¸”æœ‰çš„é•œåƒç”¨æˆ·å¼€å¯äº†è‡ªåŠ¨æž„å»ºåŽï¼Œåœ¨ä»–ä»¬æ²¡æ„è¯†çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½å·²ç»æž„å»ºå®Œæˆã€‚ åˆ°æ—¶å€™å‡çº§æ—¶å€™ï¼Œé€‰æ‹©å¯¹åº”çš„é•œåƒç‰ˆæœ¬å³å¯ã€‚

> Qï¼šä½¿ç”¨äº† harbor ä¹‹åŽï¼ŒDockerfile æ˜¯ä¸æ˜¯ä¸ç”¨å†™äº†ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œç”¨æˆ·å’Œä¸šåŠ¡éƒ¨é—¨åªéœ€è¦å…³å¿ƒåŸºæœ¬çš„å®¹å™¨æ¦‚å¿µï¼ˆexport å’Œ Volumeï¼‰å°±è¡Œï¼Œ ä¸éœ€è¦å†™ Dockerfileã€‚

> Qï¼šApp çš„æ¯ä¸€æ¬¡æäº¤éƒ½æ˜¯ä¸€ä¸ª version å—ï¼Œæ˜¯ä¸æ˜¯æ¯æ¬¡æž„å»ºå®Œæµ‹è¯•å®Œæˆï¼Œå°±å¯ä»¥å‘å¸ƒäº†ï¼Ÿ

Aï¼šApp æ²¡æœ‰æäº¤çš„æ¦‚å¿µï¼Œæ‚¨è¯´çš„åº”è¯¥æ˜¯é•œåƒï¼Œæˆ‘ä»¬è®¾è®¡çš„æ˜¯ä¸€ä¸ªé•œåƒå¯¹åº”ä¸€ä¸ª Git ä»“åº“ä»¥åŠåˆ†æ”¯ã€‚å½“æœ‰ push æˆ–è€… tag æ“ä½œåŽï¼Œä¼šè‡ªåŠ¨è§¦å‘æž„å»ºï¼Œæž„å»ºçš„è¡Œä¸ºæ˜¯æ ¹æ®ç”¨æˆ·å†™çš„é•œåƒæž„å»º shell è„šæœ¬æ¥å†³å®šçš„ã€‚ ä¸€èˆ¬æˆ‘ä»¬å»ºè®®ä¸šåŠ¡éƒ¨é—¨åšå‡ºçš„é•œåƒè·Ÿæµ‹è¯•çŽ¯å¢ƒå’Œç”ŸæˆçŽ¯å¢ƒæ²¡å…³ç³»ã€‚ é•œåƒå°±æ˜¯é•œåƒï¼Œåªæœ‰åº”ç”¨æœ‰æµ‹è¯•çŽ¯å¢ƒå’Œç”Ÿäº§çŽ¯å¢ƒã€‚

> Qï¼šæåˆ°"ç”¨å…¬æœ‰äº‘çš„æ€æƒ³åŽ»æž„å»ºç§æœ‰äº‘"ï¼Œè¯·é—®æ‚¨åœ¨æž„å»ºå…¬æœ‰äº‘å’Œç§æœ‰äº‘æ—¶ï¼Œåœ¨æŠ€æœ¯ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¯ä»¥è°ˆè°ˆæ‚¨çš„çœ‹æ³•å—ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¸»è¦æ˜¯æŠŠæˆ‘ä»¬å†…éƒ¨ç”¨æˆ·ä¹Ÿçœ‹æˆå¤–éƒ¨ç”¨æˆ·åŽ»å¯¹å¾…ï¼Œåœ¨äº§å“è®¾è®¡ä¸Šä¼šè€ƒè™‘è¿™ä¸€ç‚¹ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸€ç›´æ‘¸ç´¢çš„æ–¹å‘ã€‚

> Qï¼šæ‚¨æœ‰ç‰©ç†æœºå’Œè™šæœºï¼Œè¯·é—®æ ¹æ®ä»€ä¹ˆåœºæ™¯é€‰æ‹©è¿è¡Œåœ¨ç‰©ç†æœºè¿˜æ˜¯è™šæœºä¸Šï¼Ÿæ˜¯æ€§èƒ½çš„é€‰æ‹©å—ï¼Ÿ

Aï¼šè¿™å®Œå…¨çœ‹ä¸šåŠ¡æ–¹çš„éœ€æ±‚ï¼ŒHarbor æœ¬èº«ä¸å…³å¿ƒã€‚ å®ƒå…è®¸ä¸šåŠ¡è‡ªå·±åˆ›å»ºç§æœ‰é›†ç¾¤ï¼ŒæŠŠè‡ªå·±çš„è™šæ‹Ÿæœºæˆ–è€…ç‰©ç†ä¸»æœºæ·»åŠ è¿›åŽ»ã€‚

---

### 2016-02-23ï¼šä¸€ä¸ªå…³äºŽä¸å¯å˜åŸºç¡€è®¾æ–½çš„å®žè·µæ¡ˆä¾‹

> Qï¼šä½ ä»¬è¿™å¥—æ–¹æ¡ˆä¸­é‡åˆ°è¿‡å“ªäº›å‘è®©ä½ å°è±¡æ·±åˆ»ï¼Œè¯·ä¸¾ä¸€ä¸¤ä¸ªå…·ä½“å®žä¾‹è¯´æ˜Žï¼Ÿ

Aï¼šä½¿ç”¨ Packer åœ¨å›½å†…è¿›è¡Œæž„å»ºæ—¶ï¼Œå› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œåŽŸå› ï¼Œç»å¸¸ä¼šæœ‰å¤±è´¥çš„é—®é¢˜ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼é¿å…ã€‚æ­¤å¤–ç”±äºŽ Terraform å¹¶éžå®Œå…¨æ”¯æŒæ‰€æœ‰çš„ AWS èµ„æºç®¡ç†ï¼Œå¦‚ Cloudfrontã€Route53 Geo DNSï¼Œä»ç„¶éœ€è¦æ‰‹å·¥ç®¡ç†è¿™äº›ï¼Œä¸è¿‡æœªæ¥ Terraform ä¼šåŠ å…¥è¿™äº›çš„æ”¯æŒã€‚

> Qï¼šæ¯ä¸ª vpc ç»„æ˜¯å®Œå…¨ç‹¬ç«‹çš„æä¾›æœåŠ¡ï¼Ÿèƒ½è¯´ä¸‹è¿™å¥—æŠ€æœ¯åº”å¯¹çš„ä¸šåŠ¡å±‚æ˜¯å“ªä¸ªæ–¹é¢çš„ä¹ˆï¼Ÿ

Aï¼šæ¯ä¸ª VPC ç»„æä¾›çš„æ˜¯ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨åŠŸèƒ½å®žçŽ°ï¼Œä¸Šé¢ä¹Ÿæé«˜äº†æˆ‘ä»¬ä¼šæœ‰ prd-sg-masterï¼Œprd-sg-slaveï¼Œå¯ç”¨äºŽç¾å®¹ã€‚ä¸šåŠ¡å±‚æä¾›çš„ä¸»è¦æ˜¯ HTTP æœåŠ¡åŠå†…éƒ¨ä¾èµ–çš„å¾®æœåŠ¡ã€‚

> Qï¼šè¯·é—®ä¸ºä»€ä¹ˆé€‰ç”¨ Consulï¼Ÿå¾ˆå¤šç±»ä¼¼æ–¹æ¡ˆç”¨çš„ etcdã€‚

Aï¼šConsul å¯¹äºŽ agent çš„èŠ‚ç‚¹çš„å¤±æ•ˆæ›´å‹å¥½ï¼Œæ­¤å¤– Vagrantã€Consulã€Terraform éƒ½æ˜¯ç”± HashiCorp å…¬å¸å¼€å‘çš„ï¼Œå…¶æ–‡æ¡£å’ŒæŠ€æœ¯æ ˆéƒ½å¾ˆå…¨é¢ï¼Œå€¼å¾—åº”ç”¨å®žè·µã€‚

> Qï¼šå¦‚æžœæˆ‘ç”¨äº† Kubernetesï¼Œå¯¹å¤§æ•°æ® Hadoopã€Spark éƒ½æ²¡å•¥éœ€æ±‚ï¼Œæ˜¯å¦è¿˜æœ‰ç”¨ Mesos çš„å¿…è¦å‘¢ï¼Ÿæ¢å¥è¯è¯´ Mesos å’Œ Kubernetes ç»“åˆé’ˆå¯¹çº¯å®¹å™¨å¹³å°æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šKubernetes å’Œ Mesos éƒ½æ˜¯å®¹å™¨ç®¡ç†è°ƒåº¦çš„æ¡†æž¶ï¼ŒMesos çš„ä¼˜åŠ¿æ˜¯æ›´å…·å¯å¼€å‘æ‰©å±•æ€§ã€‚

> Qï¼šè¯·é—®å¯¹äºŽ PHP è¿™ç§å¯ä»¥åŠ¨æ€åŠ è½½ä»£ç çš„æœåŠ¡ï¼Œåœ¨è¿™å¥—ç³»ç»Ÿé‡Œåº”è¯¥æ€Žä¹ˆåº”ç”¨å‘¢ï¼Ÿ

Aï¼šåŠ¨æ€åŠ è½½ä»£ç çš„ä»£ç æºå»ºè®®ä½¿ç”¨å¾®æœåŠ¡çš„æ–¹å¼æä¾›ã€‚

> Qï¼šVagrant åœ¨å®¿ä¸»æœºä½¿ç”¨çš„æ˜¯ NAT æ¨¡å¼è¿˜æ˜¯ bridge ï¼ŸPacker ç›¸å¯¹äºŽ vagrant package å‘½ä»¤ï¼Œä¼˜åŠ¿æ˜¯å“ªäº›ï¼ŸVagrant åœ¨å®¿ä¸»æœºä½¿ç”¨ NAT æ¨¡å¼ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ DNS å‡ºé—®é¢˜çš„å‡ çŽ‡ã€‚

Aï¼šPacker å¯ä»¥ä»Ž ISO é•œåƒå¼€å§‹æž„å»ºä½ çš„ç³»ç»Ÿï¼Œç›¸å¯¹äºŽ Vagrant æ›´çº¯ç²¹ï¼›å®žé™…ä¸Š Vagrant çš„å¤§å¤šæ•° box éƒ½æ˜¯ä»Ž Packer æ‰“åŒ…è¿‡æ¥çš„ã€‚

> Qï¼šæˆ‘åœ¨[ä¸ŠæœŸåˆ†äº«](http://dockone.io/article/996)æ—¶ï¼Œä»‹ç»è¿‡ç±»ä¼¼çš„ Packer+Terraform å·¥å…·ã€‚åœ¨ä½¿ç”¨ Terraform ç®¡ç† AWS èµ„æºæ—¶ï¼Œä½ æåˆ°å¦å¤–çš„è„šæœ¬ç®¡ç†ï¼ˆthor exec:terraform apply)ã€‚è¯·é—®ï¼Œä½ ä¸ºä½•ä¸ç›´æŽ¥è¿è¡Œ Terraform çš„å‘½ä»¤ï¼Œç”¨ thor çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œä½ çš„å“ªä¸ª repo äº†æœ‰ç”¨åˆ° thorï¼Œæˆ‘å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼Ÿ

Aï¼šæˆ‘ä»¬åœ¨è¿è¡Œ Terraform æ—¶éœ€è¦ä¼ é€’å¾ˆå¤šå˜é‡ä»¥åŠç¡¬ç¼–ç å‚æ•°ï¼ŒåŒæ—¶æˆ‘ä»¬ä½¿ç”¨äº† AWS å›½å†…åŒºåŸŸå’Œ AWS å›½é™…åŒºåŸŸï¼Œä»–ä»¬æ˜¯åˆ†å¼€çš„ï¼Œå¯¹åº”çš„ AWS Access Key åŠ SecretKey ä¸åŒï¼ŒThor è„šæœ¬çš„ç›®çš„æ˜¯è®²è¿™äº›å†…å®¹é€šè¿‡é…ç½®æ–‡ä»¶å’ŒçŽ¯å¢ƒå˜é‡çš„çš„æ–¹å¼ä¼ é€’ç»™ Terraformï¼Œä½¿å…¶èƒ½èŽ·å–æ­£ç¡®çš„å‚æ•°å’Œå®šä½æ­£ç¡®çš„æ‰§è¡ŒçŽ¯å¢ƒã€‚

> Qï¼šè¯·é—®æŒç»­é›†æˆé‡‡ç”¨çš„æ˜¯ Jenkins åŠ æ’ä»¶çš„æ–¹å¼å—ï¼ŸæŒç»­é›†æˆçš„ä»£ç é‡‡ç”¨äº†ä»€ä¹ˆæ ·çš„åˆ†æ”¯ç®¡ç†ç­–ç•¥ï¼Ÿ

Aï¼šæ˜¯çš„ï¼ŒæŒç»­é›†æˆé‡‡ç”¨ Jenkins åŠæ’ä»¶ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„åˆ†æ”¯æ˜¯ Git Flow çš„å˜ç§ï¼ŒåŸºäºŽ pull çš„æ¨¡åž‹ã€‚

> Qï¼šå•çº¯çš„ç”¨äºŽ AWS çš„è¯ï¼Œäºšé©¬é€Šè‡ªå®¶çš„ CloudFormation æ”¯æŒçš„åŸºç¡€è®¾æ–½åº”è¯¥æ›´å…¨é¢ï¼Œå¦‚æžœä¸è€ƒè™‘è·¨å¹³å°çš„èƒ½åŠ›ï¼Œè¿˜æœ‰ä»€ä¹ˆç†ç”±é€‰æ‹© Terraform å—ï¼Ÿ

Aï¼šCloudFormation çš„è®¾è®¡å¹¶ä¸å‹å¥½ï¼ŒåŸºäºŽ JSON çš„è¯­æ³•éžå¸¸æ™¦æ¶©ä¸”éš¾äºŽç»´æŠ¤ï¼Œä¸åƒ Terraform ä¸€æ ·ä¸€ç›®äº†ç„¶ã€‚

> Qï¼šè·¨ä¸»æœºç½‘ç»œæ˜¯å’‹è§£å†³çš„å•Šï¼Ÿæ˜¯ç»“åˆäº† Kubernetes å’Œ Mesosã€Docker åŠŸèƒ½å—ï¼Ÿ

Aï¼šæˆ‘ä»¬é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯ Weaveï¼Œæ²¡æœ‰ä½¿ç”¨ Kubernetesã€‚

---

### 2016-02-14ï¼šåŸºäºŽ Docker æ­å»ºè½»é‡çš„ç§æœ‰æž„å»ºçŽ¯å¢ƒ

> Qï¼šæ˜¯å¦ Windows 2016 åŽŸç”Ÿæ”¯æŒ Docker è¿è¡Œä¹‹åŽ Virtualbox/Ubuntu è¿™ä¸€å±‚å°±å¯ä»¥è·³è¿‡äº†ï¼Ÿ

Aï¼šæˆ‘ä»¬ä½¿ç”¨ VBï¼Ubuntu çš„åŽŸå› ä¸æ˜¯å› ä¸º Windows åŽŸç”Ÿä¸æ”¯æŒï¼Œå®žé™…ä¸Š Boot2Docker åœ¨ Win7 ä¸Šå°±å¯ä»¥ç”¨ï¼Œä¸»è¦åŽŸå› æ˜¯å…¬å¸æœºå™¨è¦è£…éžè®¤è¯çš„è½¯ä»¶æµç¨‹æ²¡æƒé™ï¼Œæœ¬åœ°è®¤è¯çš„è™šæ‹Ÿæœºåªæœ‰ VBã€‚ã€‚ã€‚

> Qï¼šOracle Express å’Œ Oracle ä¼ä¸šç‰ˆçš„åŒºåˆ«æ˜¯ï¼Ÿèƒ½å¦å¼€å‘æµ‹è¯•çŽ¯å¢ƒç”¨ Oracle Expressï¼Œç”Ÿäº§çŽ¯å¢ƒç”¨ Oracle ä¼ä¸šç‰ˆï¼Ÿ

Aï¼šOracle Express å’Œ Oracle Enterprise åŒºåˆ«è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œç§æœ‰æž„å»ºçŽ¯å¢ƒç”¨ Express æ˜¯ä¸ºäº†é™åˆ¶èµ„æºå ç”¨ã€‚ä½†æ˜¯é›†æˆå’Œæµ‹è¯•çŽ¯å¢ƒéƒ½æ˜¯ Enterpriseã€‚

> Qï¼šé€‰æ‹©çš„ä»€ä¹ˆæ“ä½œç³»ç»Ÿè¿è¡Œçš„ Docker ï¼Ÿ

Aï¼šUbuntu 14 LTSã€‚

> Qï¼šåœ¨ Docker ç”¨ Oracle æ•°æ®åº“å­˜å‚¨å¦‚ä½•åšï¼Ÿ

Aï¼šé€šè¿‡ Volume æŒ‚ä¸ŠåŽ», ç”±äºŽæ˜¯è¾ƒå°çš„æµ‹è¯•åº“ï¼Œæ‰€ä»¥æ•°æ®é‡ä¸å¤§ã€‚

> Qï¼šè¯·é—®ä½ ä»¬ä¸€ç›´æ˜¯ä½¿ç”¨ Virtual box å—ï¼Œæœ‰æ²¡æœ‰å°è¯•åœ¨ VMware ä¸‹éƒ¨ç½²ï¼Ÿä¸ºä»€ä¹ˆè€ƒè™‘å‰è€…ï¼Ÿè°¢è°¢ï¼

Aï¼šæ²¡æœ‰ç”¨è¿‡ VMwareï¼Œå…³é”®å› ä¸ºå…¬å¸è®¤è¯çš„æ˜¯ Virtual boxï¼Œè€Œä¸”æ˜¯ç‰¹å®šç‰ˆæœ¬çš„ã€‚VMware è¿˜æ˜¯ Virtual boxï¼Œå¯¹äºŽæˆ‘ä»¬çš„éƒ¨ç½²åŒºåˆ«ä¸å¤§ã€‚è¿˜æœ‰ä¸€ä¸ªè€ƒè™‘æ˜¯å¸Œæœ›æœ‰ä¸€ä¸ªæ¾è€¦åˆï¼ˆä¸å¼ºä¾èµ–äºŽç‰¹å®šäº§å“ï¼‰çš„å¼€å‘çŽ¯å¢ƒï¼Œå¹¶ä¸” VIRTUALBOX å¼€æºï¼Œå…è´¹ï¼Œå¤Ÿç”¨ã€‚

> Qï¼šèƒ½åˆ†äº«ä¸‹ jenkins master ä¸Ž jenkins slave ä¸Šä¸Žå„ä¸ª Docker å®¹å™¨æ˜¯æ€Žä¹ˆè°ƒåº¦çš„ï¼Ÿ

Aï¼šJenkins æœ‰ä¸ª Docker çš„æ’ä»¶ï¼Œå¯ä»¥åšåˆ°è¿™ä¸‰è€…é—´çš„è°ƒåº¦åè°ƒã€‚ä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰ç”¨ï¼Œç”±äºŽæˆ‘ä»¬çš„å®žè·µç›¸å¯¹è¿˜æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ï¼Œæ‰€ä»¥éƒ½æ˜¯è‡ªå·±å†™çš„ shell è„šæœ¬ã€‚

> Qï¼šOracle å¯¹èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œä½ ä»¬ç”¨ Docker åšæ€§èƒ½å¦‚ä½•ï¼Œæœ‰å¯¹æ¯”æ•°æ®å—ï¼Ÿ

Aï¼šæˆ‘ä»¬æ²¡æœ‰ç‰¹æ„åšè¿‡æµ‹è¯•ï¼Œä½†ç»è¿‡ä¸€æ®µæ—¶é—´çš„å®žè·µï¼ŒåŸºäºŽ Docker çš„æµ‹è¯•æ¯”åŸºäºŽ Windows æ¡Œé¢çš„æµ‹è¯•é€Ÿåº¦å¿«ã€‚ç¨å¾®é‡åŒ–ä¸€ç‚¹æ¥è¯´ï¼Œç”¨ VIRTUALBOXï¼Œèµ·ä¸€å¥—ç§æœ‰çŽ¯å¢ƒè·‘ ATï¼Œ16G å†…å­˜ï¼Œ2 æ ¸ 4 çº¿ç¨‹çš„å¼€å‘æœºå™¨ï¼Œå†…å­˜å’Œ CPU çš„å ç”¨çŽ‡å°†è¿‘ 80%ã€‚ç”¨ Docker çš„è¯ï¼Œè·‘ä¸€å¥—ç§æœ‰çŽ¯å¢ƒåš ATï¼Œå†…å­˜å’Œ CPU å ç”¨çŽ‡å¤§æ¦‚ 40% å¤šä¸€ç‚¹ï¼ŒåŸºæœ¬ä¸Šèƒ½çœä¸€åŠçš„èµ„æºã€‚

> Qï¼švagrant ç”¨äºŽå¼€å‘çŽ¯å¢ƒï¼ŒDocker ç”¨äºŽç”Ÿäº§çŽ¯å¢ƒï¼Œè¿™é‡Œé¢å“ªä¸ªå‘æœ€å¤šï¼Œä½ ä»¬æ€Žæ ·è§£å†³çš„ï¼Ÿ

Aï¼šçŽ°åœ¨ Docker å¹¶æ²¡æœ‰ç”¨åœ¨ç”Ÿäº§çŽ¯å¢ƒï¼Œåªæ˜¯ç”¨æ¥è¾…åŠ©å¼€å‘å’Œå›žå½’æµ‹è¯•ã€‚æŠ€æœ¯æœ¬èº«çš„å‘å¹¶ä¸å¤šï¼Œå› ä¸ºæˆ‘ä»¬ç”¨çš„æ–¹å¼éƒ½å¾ˆç›´æŽ¥ï¼ŒåŸºæœ¬ä¸ŠæŸ¥ docker docs åŠ  google ä¸€ä¸‹éƒ½èƒ½è§£å†³äº†ã€‚

> Qï¼šä½¿ç”¨å®¹å™¨èµ·ä¸€å¥— AT çŽ¯å¢ƒï¼Œä»£ç æ˜¯é€šè¿‡ Volume æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨å—ï¼Ÿè¿è¡Œçš„è¾“å‡ºï¼Œå¦‚æµ‹è¯•ç»“æžœï¼Œç¼–è¯‘å‡ºçš„ binary æ˜¯æ€Žä¹ˆäº¤ä»˜çš„ï¼Ÿ

Aï¼šå¯¹çš„ï¼Œä»£ç é€šè¿‡ volume æŒ‚è½½ã€‚æˆ‘ä»¬çš„è¾“å‡ºç»“æžœæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶åŒ…å«æµ‹è¯•çš„ç»“æžœï¼Œä»¥åŠæ—¥å¿—ï¼›æ–‡æœ¬æ–‡ä»¶æˆ‘ä»¬ä¼šè‡ªåŠ¨ä¸Šä¼ è‡³ä¸€ä¸ªå…±äº«çš„ä½ç½®ï¼Œè€Œæ—¥å¿—æ˜¯é€šè¿‡ logstash æ”¶é›†ï¼Œå‘é€è‡³ elasticsearchã€‚å…³äºŽ binaryï¼Œæˆ‘ä»¬ AT çš„äº§å‡ºä¸åŒ…æ‹¬ binaryï¼Œæˆ‘ä»¬ä¹Ÿæœ‰æž„å»ºçš„ job ä¼šäº§ç”Ÿ binaryï¼Œè¿™äº›æˆ‘ä»¬ä¼šä¸Šä¼ è‡³ä¸­å¤®å…±äº«ä½ç½®ã€‚

> Qï¼šå¼€å‘æµ‹è¯•çŽ¯å¢ƒä¸‹çš„æ•°æ®åº“æ¯æ¬¡æ˜¯å…¨é‡æž„å»ºè¿˜æ˜¯å¢žé‡æž„å»ºï¼ŸåŸºå‡†æ•°æ®æ˜¯å¦‚ä½•ç®¡ç†å’Œå¯¼å…¥çš„ï¼Ÿ

Aï¼šæ¯æ¬¡éƒ½æ˜¯å…¨é‡æž„å»ºã€‚åŸºå‡†æ•°æ®æ˜¯æ¥è‡ªäºŽç”Ÿäº§çŽ¯å¢ƒï¼Œå¯¹æ•æ„Ÿæ•°æ®è¿›è¡Œæ¸…æ´—åŽå¾—åˆ°ä¸€ä¸ªè½»é‡çš„æµ‹è¯•åº“ï¼Œç„¶åŽå†åº”ç”¨æœ€æ–°çš„ä»£ç ï¼Œå°±æˆäº†æˆ‘ä»¬æ¯å¤©çš„æµ‹è¯•åº“ã€‚è¿™ä¸ªæµ‹è¯•åº“æ˜¯åœ¨ Oracle Enterprise ç‰ˆæœ¬ä¸Šï¼Œé€šè¿‡ Oracle çš„ export/import å¯¼å…¥åˆ°ç§æœ‰æž„å»ºçŽ¯å¢ƒï¼Œè¿™æ ·ä¿è¯æˆ‘ä»¬çš„æ‰€æœ‰æµ‹è¯•çŽ¯å¢ƒéƒ½æ˜¯ä¸€è‡´çš„è€Œä¸”å¹²å‡€ã€‚åŸºå‡†æ•°æ®ä¸æ˜¯æ¯å¤©å¯¼å‡ºçš„ï¼Œå¤§æ¦‚ä¸€å‘¨åˆ°ä¸¤å‘¨æ‰ä¼šåšä¸€æ¬¡ã€‚

---

### 2016-01-30ï¼šIT åŸºç¡€æž¶æž„çš„è‡ªåŠ¨åŒ–ç¼–æŽ’

> Qï¼šTerraform å»ºç«‹ EC2 æ—¶æ€Žä¹ˆç”¨ä¹‹å‰æž„å»ºå¥½çš„é•œåƒï¼Ÿ

Aï¼šä¾‹å­ä¸­ï¼Œ \"source\_ami\": \"ami-de0d9eb7\" å°±æ˜¯å¼•å…¥æºé•œåƒã€‚

> Qï¼špackers æ„Ÿè§‰å°±æ˜¯é•œåƒçš„å°è£…ï¼Œä¸çŸ¥é“æè¿°æ˜¯å¦è´´åˆ‡ï¼Œå®ƒä¸Ž kickstart æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

Aï¼šå¯ä»¥ç†è§£ä¸ºå°è£…ã€‚kickstart æ›´åƒ userdataã€‚

> Qï¼šè¿™ä¸ª Terraform æž„å»ºåŸºç¡€æž¶æž„æ˜¯å¦å¯ä»¥ç†è§£ä¸ºåŸºç¡€åº”ç”¨çŽ¯å¢ƒçš„æ­å»ºï¼Ÿ

Aï¼šæ˜¯åŸºç¡€è®¾æ–½ï¼ˆInfrastructure) çš„æ­å»ºã€‚

> Qï¼šè«‹å•å¦‚æžœåœ¨ AWS ä¸»è¦æœå‹™é‹è¡Œåœ¨ ECS ElasticBeanstalk ç”šè‡³ API Gatewayã€Lambda é€™äº› stackï¼Œæ˜¯å¦é€™äº›å·¥å…·å°±ä¸é©ç”¨äº†ï¼Ÿ

Aï¼šElasticBeanstalk æœ¬èº«å·²ç»æ˜¯é«˜åº¦è‡ªåŠ¨åŒ–äº†ã€‚ ä½†æ˜¯ lambda æ”¯æŒã€‚ å…·ä½“å¯ä»¥æŸ¥çœ‹ï¼š[terraform.io/docs](https://www.terraform.io/docs/providers/aws/index.html)ã€‚

> Qï¼šWindows ç³»ç»Ÿä¹Ÿå¯ä»¥ç”¨ packer åˆ¶ä½œé•œåƒï¼Œåº•å±‚éœ€ä¸éœ€è¦è™šæ‹ŸåŒ–?

Aï¼šå¯ä»¥åœ¨æºé•œåƒä¸Šæ‰©å±•ï¼Œä¹Ÿå¯ä»¥ç›´æŽ¥ç”¨æ“ä½œç³»ç»Ÿçš„ iso æ–‡ä»¶åˆ¶ä½œã€‚

> Qï¼šè¯·é—®è¿™é‡Œé¢ä»‹ç»çš„æ¨¡æ¿ä¸Ž heat çš„æ¨¡æ¿é€šç”¨ä¹ˆï¼Ÿ

Aï¼šæˆ‘æ²¡æœ‰ç”¨è¿‡ heatã€‚ ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªä¸“é—¨çš„æ¯”è¾ƒï¼š[www.terraform.io/cloudformation](https://www.terraform.io/intro/vs/cloudformation.html)ã€‚

> Qï¼šæˆ‘çŽ°åœ¨ç”¨çš„æŠ€æœ¯æ ˆä¹Ÿæ˜¯åŸºäºŽ vagrant+packer+terraformï¼Œä¸Šé¢è®²åˆ° Terraform ä¸æ”¯æŒ AWS VPC Peering è¿™ä¸€ç‚¹æ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸ºæˆ‘çŽ°åœ¨å·²ç»åœ¨ä½¿ç”¨äº†ï¼Œå¯èƒ½æ‚¨ä½¿ç”¨çš„ç‰ˆæœ¬æ¯”è¾ƒè€ã€‚

Aï¼šTerraform é‡Œçš„åŽŸè¯ï¼š `You still have to accept the peering with the AWS Console, aws-cli or aws-sdk-go`.ï¼ˆ[www.terraform.io/docs/](https://www.terraform.io/docs/providers/aws/r/vpc_peering.html)ï¼‰ã€‚

> Qï¼šè¿™ä¸ª Terraform æ˜¯å¦å¯ç”¨äºŽç®¡ç† CPUã€å†…å­˜ç­‰èµ„æºï¼Ÿ

Aï¼šå¯ä»¥å®šä¹‰å’Œæ›´æ–°éœ€è¦çš„èµ„æºç±»åž‹ ï¼ˆinstance typeï¼‰ï¼Œä¸åŒçš„ instance type ä»£è¡¨ä¸åŒçš„ CPU å’Œå†…å­˜ã€‚

> Qï¼šç”¨ packer åˆ¶ä½œä¸€æ¬¡é•œåƒèƒ½ç”¨äºŽç”Ÿäº§æµ‹è¯•å„çŽ¯å¢ƒè¿è¡Œå—ï¼Œä¸åŒçŽ¯å¢ƒé…ç½®å‚æ•°å¯èƒ½ä¸åŒï¼Œpacker å¦‚ä½•æ”¯æŒä¸€æ¬¡æ‰“åŒ…åˆ°å¤„è¿è¡Œçš„é—®é¢˜ï¼Ÿ

Aï¼šä½ å¯ä»¥æŒ‰éœ€å®šåˆ¶ä¸åŒçš„æ¨¡ç‰ˆæ–‡ä»¶å’Œåˆ¶ä½œä¸åŒçš„é•œåƒã€‚

> Qï¼špacker å’Œ vagrant ä½¿ç”¨èµ·æ¥æ„Ÿè§‰å¾ˆåƒå‘€ï¼Œä»–ä»¬çš„ä¸»è¦åŒºåˆ«æ˜¯å•¥ ï¼Ÿ

Aï¼šä½ è¯´çš„æ˜¯ vagrant box å§ï¼Œ packer æ˜¯å¯ä»¥ç”¨æ¥åˆ›å»º vagrant box çš„ã€‚å…·ä½“å‚è€ƒ [www.packer.io/intro/](https://www.packer.io/intro/getting-started/vagrant.html) ã€‚

> Qï¼šå¯ä»¥ç®€å•ä»‹ç»ä¸€ä¸‹æ‚¨è®¤ä¸ºæœ€å¥½ç”¨çš„æœåŠ¡å±‚å’Œåº”ç”¨å±‚çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œä»¥åŠåŽŸå› ã€‚

Aï¼šè¿™ä¸ªè¯é¢˜å¾ˆå¤§ã€‚ ä¸»æµçš„è¯ï¼Œå°±æ˜¯ Puppetã€Ansbileã€Chefã€SaltStackã€‚ æˆ‘ä»¬å…¬å¸ç”¨ Puppet æ¥ç®¡ç†ç³»ç»Ÿé…ç½®ï¼Œç”¨ Ansible ç®¡ç†åº”ç”¨çº§åˆ«çš„é…ç½®ã€‚å› ä¸ºç³»ç»Ÿé…ç½®æ”¹å˜ç›¸å¯¹è¾ƒå°‘ï¼Œæˆ‘ä»¬æ˜¯ level 4 engineering teamï¼Œç”¨ Puppet ç»Ÿä¸€ç®¡ç†ä¸åŒçš„äº‘æœåŠ¡ï¼ˆAWS å’Œå…¬å¸å†…éƒ¨çš„ç§æœ‰äº‘ï¼‰çš„ç³»ç»Ÿé…ç½®ã€‚ ä½†æ˜¯ Puppet ç›¸å¯¹æ¥è¯´ï¼Œå­¦ä¹ æ›²çº¿è¦æ¯” ansbile å›°éš¾å¾ˆå¤šã€‚ å¯¹åº”ç”¨çš„ç®¡ç†ï¼Œéœ€è¦è¾ƒå¤šçš„ä¿®æ”¹ï¼ŒBAUï¼ˆè¿ç»´ï¼‰å›¢é˜Ÿæ¯”è¾ƒå®¹æ˜“æ”¯æŒã€‚æ‰€ä»¥é€‰ç”¨ ansible åšè‡ªåŠ¨é…ç½®ç®¡ç†ã€‚

> Qï¼šè‡ªåŠ¨åŒ–ç¼–ç¨‹èƒ½å®žçŽ° 0 è¿ç»´å—ï¼Ÿ

Aï¼šè¿˜æ˜¯éœ€è¦ DevOpsï¼ˆè‡ªåŠ¨åŒ–è¿ç»´ï¼‰

> Qï¼šåŸºç¡€è®¾æ–½å¯ä»¥ç†è§£ä¸ºä¸­é—´ä»¶ï¼ŸJVM å¯¹äºŽ Hadoop æ¥è¯´æ˜¯åŸºç¡€è®¾æ–½ï¼Ÿè¿™æ ·ç†è§£æ­£ç¡®å—ï¼Ÿ

Aï¼šå¯¹æˆ‘æ¥è¯´ï¼Œjvm å’Œ hadoop éƒ½å±žäºŽåº”ç”¨å±‚çš„ã€‚

> Qï¼špacker åˆ¶ä½œé•œåƒï¼Œä½¿ç”¨æœ¬åœ° shell è„šæœ¬æ–‡ä»¶æ¥æ‰§è¡Œå‘½ä»¤æ„Ÿè§‰è°ƒè¯•å›°éš¾ï¼Œå› ä¸ºå‘½ä»¤æœ‰é”™çš„è¯å¦‚ä½•æ–¹ä¾¿é…åˆç”¨æˆ·ä¿®æ”¹ï¼Ÿä¸ä¼šæ˜¯è®©ç”¨æˆ·çœ‹æ—¥å¿—ç„¶åŽæ”¹è„šæœ¬ä»Žå¤´é‡è¯•ï¼Œå†é”™å†è¯•ï¼Œå¦‚æ­¤åå¤å§ï¼Ÿå¾ˆä½Žæ•ˆå“¦ã€‚

Aï¼šæœ‰å¾ˆå¤šæ–¹æ³•ã€‚ä½†æ˜¯å†™è„šæœ¬æ˜¯æœ€ç›´æŽ¥çš„ã€‚ é•œåƒçš„åˆ¶ä½œç¡®å®žéœ€è¦ä¸æ–­è°ƒè¯•çš„è¿‡ç¨‹ã€‚ è¿™æ˜¯ DevOps å·¥ä½œçš„ä¸€éƒ¨åˆ†ã€‚ é€šå¸¸ä½ å°†åˆ¶ä½œå¥½çš„é•œåƒå‘Šè¯‰å¼€å‘äººå‘˜å³å¯ã€‚

> Qï¼šè„šæœ¬é‡Œç›´æŽ¥ä½¿ç”¨ apt-getï¼Œä¼šä¸ä¼šå¯¼è‡´ä¸åŒæ—¶é—´åˆ›å»ºçš„åŸºç¡€è®¾æ–½ä¸Šè½¯ä»¶ç‰ˆæœ¬å‡ºçŽ°ä¸ä¸€è‡´ï¼Ÿä½ ä»¬è€ƒè™‘è¿‡è‡ªå»ºè½¯ä»¶æºä¿è¯ä¸€è‡´æ€§å—ï¼Ÿ

Aï¼šè¿™å°±æ˜¯ç”¨ packer çš„å¥½å¤„ã€‚ ä½ å¯ä»¥é˜¶æ®µæ€§çš„äº§ç”Ÿä¸åŒçš„é•œåƒï¼Œä¸ä¼šè¦†ç›–ä»¥å‰çš„ã€‚ ç„¶åŽæ–°é•œåƒéœ€è¦åœ¨ devï¼uat çŽ¯å¢ƒä¸‹æµ‹è¯•ã€‚è¿‡å…³åŽï¼Œæ‰å¯ä»¥ç”¨äºŽç”Ÿäº§çŽ¯å¢ƒã€‚ é•œåƒåˆ¶ä½œå®ŒåŽï¼Œé‡Œé¢çš„å†…å®¹ä¸ä¼šæ”¹å˜äº†ã€‚

> Qï¼šå¯ä»¥å¯¹åˆ›æ„çš„èµ„æºå¥åº·çŠ¶å†µè¿›è¡Œç›‘æŽ§ä¹ˆï¼Ÿä¸€æ—¦æœ‰å¼‚å¸¸ï¼Œä¼šæœ‰è‡ªæ„ˆç­–ç•¥ä¹ˆï¼Ÿ

Aï¼šTerraform é‡Œæœ‰éƒ¨åˆ†æ”¯æŒçš„ã€‚æ¯”å¦‚æŸä¸ª security group çš„ inbound è§„åˆ™æœ‰æ”¹å˜ï¼Œè¿è¡Œ terraform plan æ˜¯å¯ä»¥çœ‹åˆ°æœ‰èµ„æºè¢«ä¿®æ”¹ã€‚ å¦‚æžœè¿è¡Œå®žæ–½çš„è¯ï¼Œä¼šä¿®å¤çš„ã€‚

> Qï¼šç¼–æŽ’çš„æ—¶å€™æœ‰æ²¡æœ‰æŠŠç±»ä¼¼ç›‘æŽ§ nagios sensu ä¹‹ç±» agent çš„è€ƒè™‘åœ¨å†…ï¼Ÿ

Aï¼šè¿™ä¸ªå±žäºŽåº”ç”¨å±‚çš„é…ç½®ï¼Œå½’è‡ªåŠ¨åŒ–é…ç½®ç®¡ç†å·¥å…·ï¼Œæ¯”å¦‚ puppetï¼ansible æ¥ç®¡ç†ã€‚

> Qï¼šæŒ‰ç…§æ‚¨çš„å›žå¤ï¼Œä¸åŒæ—¶é—´åˆ›å»ºçš„é•œåƒè¿˜æ˜¯å­˜åœ¨æŸäº›åŒ…ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œæ‚¨æœ‰é’ˆå¯¹æ€§çš„æµ‹è¯•æ–¹æ³•æŽ¨èå—ï¼Œè¿˜æ˜¯åœ¨ uat çŽ¯å¢ƒåº”ç”¨æ²¡é—®é¢˜å°±ç›´æŽ¥ä¸Šç”Ÿäº§ä½¿ç”¨äº†ï¼Ÿ

Aï¼šæˆ‘ä»¬æš‚æ—¶æ˜¯è¿™æ ·ä½¿ç”¨çš„ã€‚dev/uat çŽ¯å¢ƒä¸‹è¿è¡Œæ­£å¸¸å°±æŽ¨åˆ°ç”Ÿäº§çŽ¯å¢ƒã€‚ å¦‚æžœå‡ºäº†é—®é¢˜ï¼Œä¹Ÿå¯ä»¥å¿«é€Ÿå›žæ»šã€‚å…¬å¸å…è®¸æˆ‘ä»¬æ‰¿æ‹…è¿™ä¸ªé£Žé™©çš„ã€‚

> Qï¼š Terraform åœ¨ AWS ä½¿ç”¨ play apply ç­‰åˆ›å»ºå®žä¾‹æ—¶å€™ï¼Œåªæ”¯æŒå•ä¸ª AMI é•œåƒä¹ˆï¼Ÿå¦‚æžœæƒ³è¦åŒæ—¶é…ç½®å¤šä¸ªä¸åŒé•œåƒçš„å®žä¾‹ï¼Œè¯¥æ€Žä¹ˆåŠžï¼Ÿ

Aï¼šä¸æ˜¯çš„ï¼Œå¯ä»¥åˆ›å»ºä»»æ„å¤šä¸ªã€‚åœ¨åˆ›å»ºä¸åŒçš„ ec2 å®žä¾‹æ—¶ï¼ŒæŒ‡å®šä¸åŒçš„æºé•œåƒå³å¯ã€‚

> Qï¼šä½ ä»¬æœ‰æ²¡æœ‰ç±»ä¼¼ cmdb å°†æ‰€æœ‰çš„èµ„æºåŒ…æ‹¬è™šæ‹Ÿæœºçš„ä¿¡æ¯æ”¾åœ¨ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®åº“é‡Œã€‚å¦å¤–ï¼Œä½ ä»¬æœ‰ç”¨æœåŠ¡å‘çŽ°å—ï¼Ÿç”¨çš„ä»€ä¹ˆè½¯ä»¶åšæœåŠ¡å‘çŽ°? æ€Žä¹ˆåšçš„é›†æˆï¼Ÿ

Aï¼šTerraform çš„æ¨¡ç‰ˆæ–‡ä»¶åšçš„å°±æ˜¯åšè¿™ä¸ªäº‹æƒ…å•Šã€‚ é’ˆå¯¹ç¬¬äºŒä¸ªé—®é¢˜ï¼ŒæœåŠ¡å‘çŽ°å±žäºŽåº”ç”¨å±‚çš„ã€‚ å½“ç„¶ä½ å¯ä»¥åœ¨å®šåˆ¶ terraform å®žä¾‹èµ„æºé‡Œçš„ userdata æ—¶ï¼ŒåŠ ä¸€æ¡ æœåŠ¡å‘çŽ°çš„å‘½ä»¤å³å¯ï¼Œè¿™æ ·è¯¥å®žä¾‹å¯åŠ¨åŽï¼Œå‘çŽ°æœåŠ¡è‡ªç„¶å°±æ³¨å†Œäº†è¿™ä¸ªæ–°çš„å®žä¾‹äº†ã€‚

> Qï¼šç”¨æ¨¡ç‰ˆæ–‡ä»¶ç®¡ç†æ˜¯å¦‚ä½•è¿›è¡Œç‰ˆæœ¬æŽ§åˆ¶ï¼ˆversion controlï¼‰çš„ï¼Ÿ

Aï¼šå°±æ˜¯ç”¨ Git ã€‚ å°† Template æ–‡ä»¶å­˜åˆ° Git é‡Œï¼Œ å¯ä»¥æ˜¯å†…éƒ¨çš„ Git æœåŠ¡å™¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å…¬å¸ç”¨çš„ atlassian stashï¼Œ ä¹Ÿå¯ä»¥ç”¨ GitHub ä¹‹ç±»çš„ ã€‚

> Qï¼šè¿™ä¸ªè‡ªåŠ¨åŒ–éƒ¨ç½²çš„å·¥å…·ï¼Œå˜‰å®¾æœ‰å®žè·µè¿‡é€šè¿‡ PaaS è°ƒç”¨ï¼Œå¹¶ä¸”éƒ¨ç½²æˆåŠŸå—ï¼Ÿ

Aï¼šæ²¡æœ‰ã€‚ AWS å±žäºŽ IaaSã€‚

---

### 2016-01-23ï¼šåŸºäºŽ OVS çš„ Docker å¤šä¸»æœºäº’è”è®¾è®¡å’Œå®žè·µ

> Qï¼šæˆ‘è§ä½ æ˜¯ä¸€å°ä¸»æœºåˆ›å»ºäº†ä¸€ä¸ª Vxlanï¼Œå¦‚æžœæœ‰ä¸Šä¸‡å°æœºå™¨ï¼Œå²‚ä¸æ˜¯è¦åˆ›å»ºä¸Šä¸‡ä¸ª Vxlanï¼Ÿ

Aï¼šåˆ›å»ºç½‘ç»œæ˜¯é€šè¿‡ Swarm ç®¡ç†çš„ï¼Œå› æ­¤åªéœ€åˆ›å»ºä¸€æ¬¡ã€‚

> Qï¼šè¿™ä¸ªå¯¹ç½‘ç»œç¡¬ä»¶æœ‰è¦æ±‚ä¹ˆï¼Ÿ

Aï¼šæ²¡æœ‰å…·ä½“çš„è¦æ±‚ï¼Œå€’æ˜¯ç›¸åº”çš„å†…æ ¸ç‰ˆæœ¬è¦ç¼–è¯‘ OVS çš„ Kernel æ¨¡å—ã€‚

> Qï¼šæœ‰æ²¡æœ‰è¯•è¿‡ Docker è‡ªå¸¦çš„ Overlay ç½‘ç»œï¼Œå’Œ OVS æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

Aï¼šDocker è‡ªå¸¦çš„ Overlway ç½‘ç»œï¼Œé€šè¿‡ Serf æä¾›çš„é‚»å±…èŠ‚ç‚¹å‘çŽ°åŠŸèƒ½ï¼Œå¦‚å®žçš„å¹¿æ’­ ARPï¼Œè€Œæˆ‘ä»¬ OVS ç½‘ç»œï¼ŒARP éƒ½è¢«ä»£ç†äº†ã€‚å¦å¤– Overlay éœ€è¦æ›´é«˜çš„å†…æ ¸æ”¯æŒï¼Œåº”è¯¥æ˜¯ 3.19ï¼ŒOVS æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚å¦å¤–æˆ‘ä»¬è¿˜æä¾›å¤šç§Ÿæˆ·å†…ç½‘ç»œåœ°å€å¤ç”¨ã€‚

> Qï¼šæˆ‘ä»¥å‰ OVS å’Œ Docker å®¹å™¨é‡å¯åŽï¼Œå®¹å™¨çš„ IP å˜åŒ–äº†æ€Žä¹ˆåŠžï¼Ÿ

Aï¼šåœ¨ Vxlan ç½‘ç»œé‡Œé¢ï¼Œåœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼ŒIP ä¸å˜ã€‚

> Qï¼šä¸ºä»€ä¹ˆä¸ç›´æŽ¥ä½¿ç”¨å¤§äºŒå±‚ï¼Œå°±åƒä¹‹å‰çš„ IaaSï¼Œ2 ä¸ªä¸»æœºçš„å®¹å™¨åœ¨ Vlan é‡Œé¢å¯ä»¥äº’é€šï¼Ÿ

Aï¼š å…³äºŽ Vlanï¼Œæˆ‘ä»¬ä¹Ÿæœ‰è‡ªå·±çš„ Vlan ç½‘ç»œæ’ä»¶ã€‚Vlan å’Œ Vxlan åœºæ™¯ä¸åŒï¼ŒVxlan çš„ä¼˜åŠ¿æ˜¯å¯ä»¥èŠ‚çœ IP åœ°å€èµ„æºã€‚

---

### 2016-01-15ï¼šå…³äºŽæ··åˆäº‘çš„ä¸€ç‚¹æ€è€ƒ

> Qï¼šæˆ‘çš„æ„Ÿè§‰æ··åˆäº‘æ˜¯ä»Žç§æœ‰äº‘å‘å…¬æœ‰äº‘çš„è¿‡æ¸¡ï¼Œä¹‹æ‰€æœ‰çŽ°åœ¨è¿˜å­˜åœ¨ç§æœ‰äº‘æ˜¯ç”±äºŽä¸€äº› DC çš„åˆ©æ—§å’Œå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼Œè¿™äº›è€ƒè™‘ä¸Žæˆæœ¬å’Œç®¡ç†ä¸Šä¾¿åˆ©å°±çœ‹å­°è½»å­°é‡äº†ã€‚ä¸çŸ¥ç†è§£çš„å¯¹ä¸å¯¹ï¼Ÿ

Aï¼šå…¬æœ‰äº‘æ˜¯ç§æœ‰äº‘å’Œå…¬æœ‰äº‘å‘å±•çš„ç»“åˆã€‚è€Œä¸æ˜¯è¿‡åº¦ã€‚å¤§åž‹ä¼ä¸šæ¶‰åŠåˆ°å›½å®¶å‘½è„‰çš„ä¼ä¸šæ˜¯ä¸ä¼šæŠ›å¼ƒç§æœ‰äº‘çš„ã€‚

> Qï¼šæ‚¨è®¤ä¸ºä½¿ç”¨æ··åˆäº‘é¢ä¸´çš„æœ€å¤§é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šç®¡ç†çš„å¤æ‚ã€‚æ¯å®¶æŽ¥å£ä¸ä¸€æ ·ã€‚å¾ˆéš¾æŠ½è±¡ç»Ÿä¸€ã€‚

> Qï¼šäº†è§£ä¸‹ç›®å‰æ”¯æŒæ··åˆäº‘çš„å¼€æºæ–¹æ¡ˆæœ‰æ²¡æœ‰æ¯”è¾ƒæµè¡Œçš„è§£å†³æ–¹æ¡ˆï¼Ÿå¸Œæœ›èƒ½æä¾›ä¸€äº›æŒ‡å¯¼æ€§çš„å»ºè®®æˆ–æ„è§ã€‚

Aï¼šæ··åˆäº‘è¿˜æ²¡éžå¸¸å®Œå–„çš„å¼€æºæ–¹æ¡ˆï¼ˆæˆ‘çš„äº†è§£ï¼‰ï¼Œå¦‚æžœåªæ˜¯ä»Žç®¡ç†è§’åº¦åšæ··åˆäº‘ï¼Œé‚£ä¹ˆåªæ˜¯è°ƒç”¨ API å°±è¡Œäº†ã€‚å¦‚æžœæ˜¯èµ„æºè§’åº¦ï¼Œé‚£ä¹ˆèµ„æºæ··ç”¨ï¼Œç›®å‰è¿˜æ²¡æ–¹æ¡ˆï¼ˆè¿™ä¸ªé¦–å…ˆæ˜¯ç½‘ç»œä¸Šçš„é—®é¢˜ï¼Œæ¶‰åŠ SDN ç­‰ï¼‰ã€‚

> Qï¼šç›®å‰å¤§å¤šæ•°ä¼ä¸šéƒ½æ˜¯ä¸ºäº†äº‘è€Œäº‘ï¼Œåœ¨æ²¡æœ‰å®Œå–„ç§æœ‰äº‘ CI/CD å’Œå¾®æœåŠ¡åŒ–å‰ï¼Œä¼ä¸šå¦‚ä½•å°†ç¬¨é‡çš„ VM åœ¨æ··åˆäº‘çŽ¯å¢ƒä¸‹éƒ¨ç½²ï¼Ÿ

Aï¼šCI/CDï¼Œè¿™ä¸ªé—®é¢˜ï¼Œåœ¨ PaaS å±‚ï¼Œå¦‚æžœä»Ž PaaS å±‚è°ˆæ··åˆäº‘ï¼Œåˆæ˜¯ä¸€ç§ä¸åŒçš„åšæ³•ã€‚

> Qï¼šæ··åˆäº‘çš„å®‰å…¨æ€§ä¸€èˆ¬æ˜¯æ€Žä¹ˆè€ƒè™‘çš„ï¼Ÿ

Aï¼šå®‰å…¨è¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¤§ã€‚ç®¡ç†è§’åº¦åšåªèƒ½ä¿è¯ç”¨æˆ·åŸºæœ¬æ•°æ®çš„å®‰å…¨ã€‚1.  å¦‚ä½•ç¡®ä¿ä¼ä¸šçš„æ•°æ®åœ¨ç½‘ç»œä¼ è¾“ä¸­ä¸¥æ ¼åŠ å¯†ï¼Œä¿è¯æ•°æ®å³ä½¿èŽ·å–ä¹Ÿæ— æ³•è¿˜åŽŸï¼›2.  ä¿è¯äº‘è®¡ç®—æœåŠ¡å•†åœ¨å¾—åˆ°æ•°æ®æ—¶ä¸å°†ä¼ä¸šæ•°æ®æ³„éœ²å‡ºåŽ»ã€‚ï¼›3.  åœ¨äº‘è®¡ç®—æœåŠ¡å•†å¤„å­˜å‚¨æ—¶ï¼Œå¦‚ä½•ä¿è¯è®¿é—®ç”¨æˆ·ç»è¿‡ä¸¥æ ¼çš„æƒé™è®¤è¯å¹¶ä¸”æ˜¯åˆæ³•çš„æ•°æ®è®¿é—®ï¼ŒåŒæ—¶ä¿è¯ä¼ä¸šåœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å®‰å…¨è®¿é—®åˆ°è‡ªèº«æ•°æ®ã€‚

> Qï¼šå¦‚ä½•çœ‹å¾…ç›®å‰å›½å†…ä¸€äº› CaaS åŽ‚å•†æä¾›çš„è‡ªæœ‰ä¸»æœºç®¡ç†åŠŸèƒ½ï¼Ÿæ˜¯å¦èƒ½ä¸ºæ··åˆäº‘çš„ç®¡ç†æä¾›æ–°çš„æ€è·¯ï¼Ÿ

Aï¼šä¸ªäººçœ‹å¥½ CaaSï¼Œä½†ç›®å‰è¿˜åœ¨å‘å±•é˜¶æ®µï¼Œä¼°è®¡æˆç†Ÿè¿˜éœ€è¦ä¸€ç‚¹æ—¶é—´ç§¯ç´¯ï¼Œç»è¿‡å¸‚åœºæ£€éªŒåŽã€‚æ‰èƒ½ç®—æˆåŠŸã€‚

> Qï¼šå…¬æœ‰äº‘å’Œç§æœ‰äº‘ç½‘ç»œæ‰“é€šåŽå¦‚ä½•è§£å†³å®‰å…¨é—®é¢˜ï¼Œæ˜¯å¦éœ€è¦é˜²ç«å¢™ï¼ŒIPS åšä¸€å®šçš„éš”ç¦»ï¼Ÿ

Aï¼šé˜²ç«å¢™ IPS æˆ‘æ„Ÿè§‰åœ¨å†…éƒ¨éœ€è¦çš„ï¼Œå…¬æœ‰äº‘è¿™äº›æˆ‘ä»¬ä¹Ÿæ— æ³•ç®¡ç†åˆ°ï¼Œå…¬æœ‰äº‘çš„å®‰å…¨éƒ½æ˜¯è½¯ä»¶å®šä¹‰çš„ã€‚

---

### 2016-01-06ï¼šæ€æºåŸºäºŽ Docker å’Œ OpenStack çš„ç§æœ‰äº‘å¹³å°å®žè·µ

> Qï¼šHostname DNS è´µæ–¹ ç”¨ä»€ä¹ˆæ–¹æ¡ˆå›ºå®šï¼Ÿ

Aï¼šé¦–å…ˆ Container åˆ›å»ºä¹‹åˆï¼Œhostname å’Œ DNS éƒ½æ˜¯é€šè¿‡ Docker API æ¥è®¾ç½®çš„ã€‚Hostname æ˜¯ nova instance çš„ nameï¼ŒDNS æ˜¯å…¬å¸å†…éƒ¨è®¾ç½®ã€‚å¦‚æžœæƒ³ä¿®æ”¹ Container é»˜è®¤è®¾ç½®ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬åœ¨å†…éƒ¨é•œåƒé¢„ç•™äº†ä¸€ä¸ªç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹çš„ hostsã€hostnameã€DNS å¦‚æžœå­˜åœ¨éƒ½ä¼šåœ¨ Container å¯åŠ¨åŽä¸»åŠ¨è¦†ç›– Container å¤–éƒ¨æŒ‚è½½çš„å†…å®¹ã€‚

> Qï¼šåœ¨ä½¿ç”¨ Docker åŽ»å°è£… novacompute æ¨¡æ‹Ÿå¤§è§„æ¨¡é›†ç¾¤æµ‹è¯•æ—¶ï¼Œè¿è¡Œä¸€æ®µæ—¶é—´åŽæ€»å‡ºçŽ°éƒ¨åˆ†ä½¿ç”¨ Docker å°è£…çš„ nova compute æœåŠ¡å‡ºçŽ° down çš„çŠ¶æ€ï¼Œä¸çŸ¥é“ä½ ä»¬æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„é—®é¢˜ï¼Ÿ

Aï¼šæˆ‘ä»¬è¿™è¾¹æ²¡æœ‰é‡åˆ°ï¼Œæœ‰æ²¡æœ‰å¯èƒ½æ˜¯æ¨¡æ‹Ÿçš„ nova compute è¿›ç¨‹æ•°é‡è¿‡å¤šæ¶ˆæ¯æœ‰æ‰€ç§¯åŽ‹ã€‚NOVA æ–¹é¢è€ƒè™‘å¢žåŠ  NOVA æ—¶é—´æˆ³è¶…æ—¶è®¾ç½®ã€‚Docker æ–¹é¢å»ºè®® Docker çš„ç½‘ç»œä½¿ç”¨ host æ¨¡å¼ï¼Œå¹¶åœ¨ NOVA é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ä¸åŒçš„ hostï¼Œä»¥ä¾¿æˆä¸ºä¸åŒçš„ hypervisor nodeã€‚

> Qï¼šSahara åœ¨ä½¿ç”¨ Docker æ›¿ä»£ KVM åˆ›å»º Hadoop é›†ç¾¤æ—¶ï¼Œæ˜¯ç›´æŽ¥ä½¿ç”¨ heat åˆ›å»º Dockerï¼Œè¿˜æ˜¯ä½¿ç”¨ nova-dockerï¼ŸSahara ç›¸å…³çš„ä»£ç æ˜¯å¦éœ€è¦æ”¹åŠ¨ï¼Œé‡åˆ°è¿‡å“ªäº›å‘ï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯ä½¿ç”¨ nova docker çš„ driver åˆ›å»º docker container çš„ï¼ŒSahara æœ¬èº«ç›¸å…³çš„ä»£ç æœ‰éƒ¨åˆ†æ”¹åŠ¨ï¼Œä½†æ˜¯ä¸å¤§ï¼Œä¸»è¦æ”¹åŠ¨åœ¨ä½¿ç”¨ container å’Œè™šæœºçš„å·®åˆ«ï¼Œæ¯”å¦‚ hostnameã€cloudinit çš„éƒ¨åˆ†é…ç½®ç­‰ç­‰ã€‚

> Qï¼šDocker çš„ç½‘ç»œæ¨¡å¼ä¸­ï¼Œä¸­é—´æ·»åŠ ä¸€å±‚ linux bridge çš„åŽŸå› æ˜¯ä»€ä¹ˆï¼Œè¿™ä¹ˆåšæ˜¯å¦ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Ÿ

Aï¼šè¿™ä¸ªè¿˜æ˜¯ä¸ºäº†å®‰å…¨ç»„ï¼Œå®žé™…ä¸Šæˆ‘ä»¬æ”¯æŒé…ç½®ä¸¤ç§æ¨¡å¼ï¼Œlinux bridge å¹¶ä¸æ˜¯é»˜è®¤é…ç½®çš„ã€‚OpenvSwitch 2.4 ä»¥åŽå¯ä»¥æ ¹æ®æµè¡¨è®¾ç½®å®‰å…¨ç»„ã€‚

> Qï¼šContainer é™é€Ÿæ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Œæ˜¯å¦æœ‰å¿…è¦é’ˆå¯¹ Container è¿›è¡Œé™é€Ÿï¼Ÿ

Aï¼šæˆ‘ä»¬çš„çŽ¯å¢ƒä¸­ä½¿ç”¨çš„ OpenvSwitchï¼Œé€šè¿‡ veth pair çš„æ–¹å¼å»ºç«‹è™šæ‹Ÿç½‘ç»œè®¾å¤‡çš„å…³ç³»ã€‚é™é€Ÿä¸»è¦æ˜¯ä½¿ç”¨ tcï¼Œæ¯•ç«Ÿ OpenvSwitch çš„é™é€Ÿä¹Ÿæ˜¯ä½¿ç”¨ tc åšçš„ã€‚

> Qï¼šNOVA ç»„ä»¶ä¸­ Docker çš„é«˜çº§ç‰¹æ€§æ— æ³•ä½¿ç”¨ä½ æ€Žä¹ˆçœ‹ï¼Œæ˜¯å¦ä½¿ç”¨ docker api æ¥æŽ§åˆ¶å®¹å™¨ï¼Ÿ

Aï¼šä¸Šé¢å·²ç»è¯´è¿‡è¿™ä¸ªé—®é¢˜äº†ï¼Œå…¶å®žé€šè¿‡ flavor metadata çš„è®¾ç½®ï¼Œnova docker driver å¯ä»¥å®žçŽ°ç”Ÿæˆä¸€ç»„å®¹å™¨ã€‚nova docker è¿™å—è¿‡åŽ»ç¡®å®žæ˜¯ç›´æŽ¥è°ƒç”¨ Docker API çš„ï¼Œä½†æ˜¯ä¸ºäº†åº”å¯¹ä¸æ–­å˜åŒ–çš„ APIï¼Œæˆ‘ä»¬ä½¿ç”¨äº† docker-py ä½œä¸º Clientï¼Œå¹¶åœ¨ nova é…ç½®æ–‡ä»¶ä¸­å¢žåŠ äº† API ç‰ˆæœ¬çš„è®¾ç½®ã€‚ä»Žè€Œå°½å¯èƒ½æ‹¿åˆ° Docker æœ¬èº«å‡çº§å¸¦æ¥çš„ç¦åˆ©ã€‚

> Qï¼šOPS å·²ç»æœ‰è¶…åˆ†è®¾ç½®ï¼Œä½ è®¾ç½®è¶…åˆ†çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šæˆ‘ä»¬ Docker å’Œ KVM éƒ½åœ¨ä¸€ä¸ª openstack å¹³å°ä¸­ï¼Œè€Œ nova çš„è¶…åˆ†å®žåœ¨ NOVA Conductor ä¸­ç”Ÿæ•ˆçš„ã€‚Nova compute Libvirt Driver æ˜¯ç›´æŽ¥ä¸ŠæŠ¥çš„æœåŠ¡å™¨æ ¸æ•°ã€‚è€Œæˆ‘ä»¬è®¤ä¸º Docker åœ¨å¯†åº¦ä¸Šå­˜åœ¨æ¯” KVM å¯†åº¦æ›´é«˜çš„éœ€æ±‚ï¼Œæ‰€ä»¥åœ¨ Compute ä¸Šæ”¯æŒè¶…åˆ†æ˜¯æœ‰å¿…è¦çš„ã€‚

> Qï¼šä½¿ç”¨ CPU share æ˜¯å¦ä¼šå‡ºçŽ°å•ä¸ªå®¹å™¨è´Ÿè½½å¾ˆé«˜çš„åœºæ™¯ï¼Œå‡ºçŽ°è¿™ç§æƒ…å†µå¦‚ä½•å¤„ç†ï¼Ÿ

Aï¼šè¿˜æ˜¯ä¼šå‡ºçŽ°çš„ï¼Œè®°å¾—æœ‰ä¸ªå®¹å™¨ CPU å ç”¨ 1600% çš„åœºæ™¯ï¼ˆ32 æ ¸å¿ƒï¼‰ã€‚é€šå¸¸è¿™ç§æƒ…å†µè¿˜æ˜¯åº”ç”¨å‡ºçŽ°äº†é—®é¢˜ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯é€šè¿‡ cgroup æœ¬èº«çš„å‘½ä»¤è¿›è¡Œé™åˆ¶ã€‚å®¹å™¨é‡å¯ä¹‹åŽè¯¥é™åˆ¶å°±ä¼šä¸¢å¤±ã€‚é™åˆ¶æ–¹æ³•ä¾‹å¦‚ï¼š cgset -r cpuset.cpus=20-23 cpuset:/docker/91d943c55687630dd20775128e2ba70ad1a0c9145799025e403be6c2a7480cb2

> Qï¼šDocker çš„ç›‘æŽ§å’Œ scale-auto æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šç›‘æŽ§æ–¹é¢ç›®å‰ä¸»è¦æ˜¯é€š docker stats api å’Œ éƒ¨åˆ†è„šæœ¬æ¥å®žçŽ°ï¼Œé›†æˆåˆ° Zabbix ä¸­ï¼ŒåŽé¢ä¼šè€ƒè™‘ä½¿ç”¨ CAdvisorã€‚\ åŽè€…ç›®å‰ä¸æ”¯æŒï¼Œè®¡åˆ’ä¸Šä¼šåœ¨ Kubernetes å¹³å°ä¸­æ”¯æŒï¼Œè€Œéž heat æˆ– NOVA ä¸­ã€‚æ¯•ç«Ÿè¿™æ˜¯ Kubernetesã€Mesos å®ƒä»¬çš„ä¸“é•¿ã€‚

> Qï¼šä½ çš„ä¸‰å±‚é•œåƒä¸­ï¼Œç¬¬ä¸€å±‚å’Œç¬¬äºŒå±‚éƒ½æ˜¯ç³»ç»Ÿå±‚ï¼Œä¸ºä»€ä¹ˆä¸åˆå¹¶æˆä¸ºä¸€å±‚ï¼Ÿ

Aï¼šé¦–å…ˆæˆ‘ä»¬çš„ç¬¬ä¸€å±‚é•œåƒå¹¶ä¸æ˜¯é€šè¿‡ dockerfile åˆ›å»ºçš„ï¼Œè€Œæ˜¯ä¾æ®å®˜æ–¹æ–‡æ¡£ä»Ž 0 å»ºç«‹çš„æœ€å°çš„é•œåƒï¼Œè¿™ä¸€å±‚æ˜¯å¾ˆå°‘å˜åŠ¨çš„ã€‚è€Œç¬¬äºŒå±‚çš„è®¾ç½®æ˜¯ä¸ºä¸Šå±‚è®¾è®¡çš„é€šç”¨å±‚ï¼Œæ¶‰åŠåˆ°è¿›ç¨‹ç®¡ç†å™¨ã€SSH è®¾ç½®ã€pam è®¾ç½®ã€å…¥ä¾µæ£€æµ‹è®¾ç½®ã€å¼€æœºåˆå§‹åŒ–è®¾ç½®ã€è¿˜æ˜¯æœ‰å¾ˆå¤§å¯èƒ½å˜åŠ¨çš„ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰å…³é…ç½®éƒ½åº”è¯¥æ”¾å…¥ dockerfile ä»¥ä¾¿ç®¡ç†ã€‚

> Qï¼šnova-docker å¦‚ä½•æ”¯æŒ cloudinitï¼Ÿ

Aï¼šå› ä¸ºåœ¨ novadocker ä¸­å°±æ˜¯å®Œå…¨æ¨¡æ‹Ÿ KVM çš„ç½‘ç»œæ¨¡å¼ï¼Œæ‰€ä»¥ cloudinit é™¤äº†ä¸€äº›å°å¹…é…ç½®å˜æ›´ä¹‹å¤–æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„ã€‚ +

> Qï¼šèƒ½å¦è¯¦ç»†ä»‹ç»ä¸‹ ARP é—®é¢˜ï¼Ÿ

Aï¼šç”±äºŽå»ºç«‹çš„ vm çš„ ip ä¹‹å‰åˆ†é…ç»™äº†å·²ç»åˆ é™¤çš„ vmï¼Œå¯¼è‡´ mac è¢«è®°å½•åœ¨äº¤æ¢æœºä¸Šã€‚æ•°æ®äº¤æ¢ç»è¿‡ 3 å±‚ï¼Œ3 å±‚äº¤æ¢æœºä¼šå°† mac ç›´æŽ¥è¿”å›žç»™ ping çš„ä¸€æ–¹ï¼Œå¯¼è‡´æ— æ³• ping é€šã€ å¯åŠ¨ container åŽé€šè¿‡ arping -c 3 -f -U -I eth0 172.28.19.243 -c 3 å¼€æœºå‘é€å…è´¹ arp æ¥å¤„ç†ã€‚

> Qï¼šNOVA Docker å®žçŽ°äº†çƒ­è¿ç§»å—ï¼Ÿå¦‚ä½•åšå¿«ç…§ï¼Ÿ

Aï¼šçƒ­è¿ç§»ç›®å‰è¿˜æ²¡æœ‰æ”¯æŒï¼Œnova docker å¿«ç…§å°±æ˜¯å°†å®¹å™¨ commit æˆä¸€ä¸ªé•œåƒï¼Œç„¶åŽä½¿ç”¨ glance çš„æŽ¥å£ä¸Šä¼  glance ä¸­ã€‚é€šè¿‡å¿«ç…§å¯ä»¥é‡æ–°å»ºç«‹æ–°çš„ containerã€‚

> Qï¼šnova-docker ä¸æ˜¯æ—©åœ¨ H ç‰ˆæœ¬å°±åºŸå¼ƒäº†å—ï¼Ÿä½ ä»¬è‡ªå·±ç»´æŠ¤çš„ï¼Ÿ

Aï¼šç¡®å®žåºŸå¼ƒäº†ï¼Œæˆ‘ä»¬è‡ªå·±ç»´æŠ¤ã€‚ä¸è¿‡ GitHub ä¸Šæœ‰äº†æ›´æ–°ï¼Œæˆ‘ä»¬åˆšåˆš merge æœºé‚£é‡Œä¸€äº›ç‰¹æ€§ã€‚å¯ä»¥å†å…³æ³¨ä¸€ä¸‹ã€‚

> Qï¼šOpenStack å¦‚ä½•å¯¹ novadocker çŽ¯å¢ƒçš„ container è¿›è¡Œç›‘æŽ§ï¼Ÿåœ¨ç›‘æŽ§æŒ‡æ ‡ä¸Šæ˜¯å¦ä¸Žå…¶ä»– hypervisor driver æœ‰åŒºåˆ«ï¼Ÿ

Aï¼šç›‘æŽ§æ–¹é¢ç›®å‰ä¸»è¦æ˜¯é€š docker stats api å’Œ éƒ¨åˆ†è„šæœ¬æ¥å®žçŽ°ï¼Œé›†æˆåˆ° Zabbix ä¸­ï¼ŒåŽé¢ä¼šè€ƒè™‘ä½¿ç”¨ CAdvisorã€‚ç›‘æŽ§ä¸Šæœ‰ä¸€äº›åŒºåˆ«ã€‚ä¸»è¦æ˜¯ pid\_maxã€docker daemon å­˜æ´»ï¼Œå’Œ Docker è‡ªèº«å­˜å‚¨ pool ç­‰ Docker ç‰¹æœ‰çš„ï¼Œå…¶ä»–æ–¹é¢æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚

> Qï¼šæ‚¨å¥½ï¼Œè´µå…¬å¸åªç»´æŠ¤ Git ä»£ç å’Œé•œåƒå®¹å™¨ã€‚è¯·é—®å‡å¦‚åŒä¸€ä¸ªç¼–è¯‘çŽ¯å¢ƒï¼Œèƒ½ç¼–è¯‘ä¸åŒæ“ä½œç³»ç»Ÿç‰ˆæœ¬çš„åº“å—ï¼Ÿæˆ–è€…é•œåƒã€‚å› ä¸ºåŒä¸€å¥—ä»£ç ä¼šéƒ¨ç½²åˆ°ä¸åŒçš„ç³»ç»Ÿä¸Šï¼Ÿ

Aï¼šæˆ‘ä»¬è¿™æ¡ç¼–è¯‘çŽ¯å¢ƒåªæ˜¯ç”¨æ¥ç¼–è¯‘ OPS æœ¬èº«çš„ï¼Œå¦‚æžœéœ€è¦å¢žåŠ æ–°çš„ç¼–è¯‘çŽ¯å¢ƒï¼Œæˆ‘ä»¬ä¼šå‘ Registry æŽ¨é€ä¸€ä¸ªæ–°çš„ç¼–è¯‘é•œåƒã€‚

> Qï¼šglance ç®¡ç†é•œåƒå’Œå¿«ç…§æ—¶æœ‰æ²¡æœ‰èƒ½ç”¨åˆ° Docker çš„åˆ†å±‚ï¼Ÿå¦‚æžœæœ‰ï¼Œå¦‚ä½•åˆ©ç”¨çš„ï¼Ÿ

Aï¼šæ²¡æœ‰ï¼Œtar åŒ…å½¢å¼ï¼Œcompute èŠ‚ç‚¹ä¸‹è½½ä¹‹åŽ load åˆ° compute èŠ‚ç‚¹ä¸Šã€‚

> Qï¼šç”Ÿäº§çŽ¯å¢ƒç›¸æ¯”æµ‹è¯•çŽ¯å¢ƒæœ‰ä»€ä¹ˆä¸åŒå—ï¼Ÿ

Aï¼šDocker åœ¨ CPU è¶…åˆ†ç³»æ•°ä¸åŒï¼Œç³»ç»Ÿ pid\_max ç­‰è°ƒä¼˜å‚æ•°ç•¥æœ‰ä¸åŒã€‚

> Qï¼šNova Docker å¿«ç…§æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šå°†æ“ä½œçš„ Container commit æˆä¸ºä¸€ä¸ªé•œåƒï¼Œå¹¶ä¸Šä¼ åˆ° glance ä¸­ã€‚

---

### 2015-12-29ï¼šç”¨ Docker å’Œ Git æ­å»ºåœ¨çº¿å¼€å‘çŽ¯å¢ƒ

> Qï¼šé‚£ä¹ˆå¤šçš„å¼€å‘è€…ï¼ŒåŸŸåæ€Žä¹ˆåˆ†é…ï¼Ÿ

Aï¼šç›®å‰ï¼Œæˆ‘æ˜¯é€šè¿‡ Nginx çš„åå‘ä»£ç†æ¥åˆ†é…ä¸åŒçš„å­åŸŸåç»™ä¸åŒå¼€å‘äººå‘˜ã€‚

> Qï¼šåœ¨è¿™ä¸ªä½“ç³»ä¸­å¼€å‘ä¸Žæµ‹è¯•æ˜¯å¦‚ä½•è”ç³»ï¼Ÿ

Aï¼šè¿™å¥—ä½“ç³»ä¸»è¦ä¸“æ³¨äºŽå¼€å‘çš„éƒ¨åˆ†ï¼Œæµ‹è¯•ä¸Žå¼€å‘çš„äº’åŠ¨å¹¶æ²¡æœ‰åœ¨è¿™å¥—ä½“ç³»ä¸­ä½“çŽ°å‡ºæ¥ï¼Œä¸è¿‡æœ‰å¾ˆå¤šæˆåž‹çš„ DevOps ä½“ç³»å¯ä»¥ä½œä¸ºå‚è€ƒã€‚

> Qï¼šäº‘ç«¯å¼€å‘æ˜¯ä¸æ˜¯å¼€å‘çŽ¯å¢ƒæ”¾åœ¨äº‘ä¸Šï¼Œå¼€å‘è€… SSH åˆ°è‡ªå·±çš„å¼€å‘çŽ¯å¢ƒï¼Œæäº¤ä»£ç åŽ Compose æ˜¯è‡ªåŠ¨æ‰§è¡Œè¿˜æ˜¯äººä¸ºæ‰§è¡Œï¼Ÿ

Aï¼šç†æƒ³çŠ¶å†µä¸‹ï¼Œæ˜¯å°†ä¸€ä¸‹ä¸‰ä¸ªéƒ¨åˆ†éƒ½æ”¾å€’äº‘ç«¯ï¼Œç›®å‰æˆ‘åªå®žçŽ°äº†è¿è¡ŒçŽ¯å¢ƒåœ¨äº‘ç«¯ã€‚ Compose çŽ°åœ¨ä¹Ÿæ˜¯æ‰‹åŠ¨ä¹‹è¡Œçš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è„šæœ¬åšåˆ°è‡ªåŠ¨åŒ–åŠŸèƒ½å®Œå¤‡çš„ä»£ç ç¼–è¾‘å™¨ ä¸€ä¸ªåº”ç”¨è¿è¡ŒçŽ¯å¢ƒ ä¸€ä¸ªè°ƒè¯•å·¥å…·ç®±ã€‚

> Qï¼šäº‘ç«¯å¼€å‘ä¼šä¸ä¼šå‡å°‘å¼€å‘è€…çš„å·¥ä½œé‡ï¼Œè®©å…¶æ›´ä¸“æ³¨äºŽä»£ç ä¸Šï¼Œè€Œä¸æ˜¯æµç¨‹çš„åº”ç”¨ä¸Šï¼Ÿ

Aï¼šäº‘ç«¯å¼€å‘ä¼šè®©å¼€å‘äººå‘˜æ›´å°‘çš„ç»åŽ†åŽ»å­¦ä¹ äº†è§£ä¸­é—´ä»¶ï¼Œ ç”¨æ›´å¤šçš„æ—¶é—´ä¸“æ³¨äºŽä¸šåŠ¡åŠŸèƒ½çš„å®žçŽ°ï¼Œä»Žè€Œåšåˆ°è®©å¼€å‘æ›´å…³æ³¨éœ€æ±‚æœ¬èº«ï¼Œè€Œä¸æ˜¯æŠ€æœ¯æœ¬èº«ã€‚ å¦å¤–åœ¨çº¿å¼€å‘çŽ¯å¢ƒå¯ä»¥æé«˜åä½œæ€§ã€‚å› ä¸ºè¿è¡ŒçŽ¯å¢ƒå’Œä»£ç éƒ½åœ¨äº‘ç«¯ï¼Œå¼€å‘äººå‘˜å¯ä»¥å¾ˆå¿«çš„åˆ‡æ¢å…¶ä»–äººçš„å¼€å‘çŽ¯å¢ƒå’Œä»£ç ã€‚

> Qï¼šåœ¨çº¿ IDE åœ¨å®žé™…ä½¿ç”¨ä¸­çš„ä½“éªŒï¼Œå¯è¢«å¼€å‘äººå‘˜çš„æŽ¥å—ç¨‹åº¦å¦‚ä½•ï¼Œå¯¹å„ç±»è¯­è¨€çš„æ”¯æŒæƒ…å†µå‘¢ï¼Ÿ

Aï¼š ç›®å‰çš„å°è¯•åœ¨çº¿ IDE å—ç½‘ç»œï¼Œå’ŒåŠŸèƒ½çš„åˆ¶çº¦ï¼Œä¸èƒ½å®Œå…¨å’Œæœ¬åœ°çš„ IDE ç›¸æ¯”è¾ƒã€‚ ä¸è¿‡å› ä¸º Git çš„è§£è€¦ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€‰æ‹©ä½¿ç”¨æœ¬åœ°çš„ IDE ç¼–è¾‘ä»£ç 

> Qï¼šGit è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œæœ‰æ²¡æœ‰æ›´ç®€å•çš„å·¥å…·ï¼Ÿ

Aï¼šé™¤äº† Git ä¹‹å¤–è¿˜æœ‰ä¸€ç§ sshfs çš„æŠ€æœ¯ï¼Œå¯ä»¥ç›´æŽ¥æ˜ å°„è¿œç«¯ä»£ç åˆ°æœ¬åœ°ã€‚ ä¸è¿‡è€ƒè™‘åˆ°ç‰ˆæœ¬çš„å›žæº¯ï¼Œç”šè‡³å°†æ¥åˆ©ç”¨å¤§æ•°æ®æ¥åˆ†æžå¼€å‘äººå‘˜çš„å¼€å‘è¡Œä¸ºã€‚ Git ä¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚ Git çŽ°åœ¨çš„å¤æ‚æ˜¯å› ä¸ºç›¸åº”çš„è‡ªåŠ¨åŒ–è„šæœ¬æ²¡æœ‰å»ºç«‹ï¼Œåœ¨å»ºç«‹ä¹‹åŽï¼Œå¼€å‘äººå‘˜å¯ä»¥å¿½ç•¥ Git åŒæ­¥çš„éƒ¨åˆ†ã€‚

> Qï¼šä»£ç æäº¤åˆ°äº‘ç«¯åŽï¼Œå®¹å™¨ä¸­æ˜¯æ€Žä¹ˆç”Ÿæ•ˆçš„ï¼Œæ˜¯æŠŠä»£ç ç›®å½•ä½œä¸ºæŒ‚è½½ç‚¹è¿˜æ˜¯å®¹å™¨ä¸­æœ‰è¿›ç¨‹å®žæ—¶åŽ»æ‹‰ï¼Ÿ

Aï¼šæ˜¯çš„ï¼ŒçŽ°åœ¨ä»£ç ä½œä¸ºå·æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„ã€‚

> Qï¼šä½†æ˜¯å¦‚æžœæ˜¯ä»¥æŒ‚è½½çš„æ–¹å¼ï¼Œæ€Žä¹ˆèƒ½é‡çŽ° Commit é•œåƒæ—¶ä¿è¯ä»£ç çš„åŒæ­¥å‘¢ï¼Ÿ

Aï¼šæˆ‘æƒ³è¿™ä¸ªé—®é¢˜å›žåˆ°äº†"è¿™ä¸ªä½“ç³»å…³æ³¨çš„é—®é¢˜åˆ°åº•æ˜¯ä»€ä¹ˆ"ä¸Šã€‚ æˆ‘åˆ†äº«çš„è¿™å¥—ä½“ç³»ä¸“æ³¨äºŽé¡¹ç›®ä¸­çš„å¼€å‘éƒ¨åˆ†ï¼Œå¹¶ä¸ä¸“æ³¨ç‰ˆæœ¬æŽ§åˆ¶ï¼Œæµ‹è¯•å’Œéƒ¨ç½²ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œé¡¹ç›®åº”è¯¥æœ‰å¦å¤–ä¸€ä¸ª Git ä»“åº“æ¥åšç‰ˆæœ¬æŽ§åˆ¶ï¼Œç„¶åŽä¼šæœ‰ä¸“é—¨çš„ build ä½“ç³»ï¼Œæ¥è‡ªåŠ¨ build æŒ‡å®šçš„ä»£ç ã€‚

> Qï¼šCommit é•œåƒæ—¶çš„é•œåƒé‡Œå¹¶æ²¡æœ‰ä»£ç å•Šï¼Ÿæ‰“ç®—ä»»ä½•çŽ¯å¢ƒéƒ½æ˜¯ä»¥æŒ‚è½½çš„æ–¹å¼å—ï¼Ÿè¿™æ ·å¯ç§»å€¼æ€§ä¼šä¸ä¼šå¾ˆå·®ï¼Ÿ

Aï¼šé¦–å…ˆ Container æ˜¯é€šè¿‡é¡¹ç›®è·¯å¾„ä¸‹çš„ dockerfile ç”Ÿæˆçš„ï¼Œ åªæ˜¯åœ¨è¿è¡ŒçŽ¯å¢ƒä¸­åˆæŒ‚åœ¨äº†ä¸€æ¬¡ä»£ç ã€‚ å½“å¼€å‘ç»“æŸåŽï¼Œ å¯ä»¥é€šè¿‡é¡¹ç›®çš„ dockerfile,æ•´ä½“ build ä»£ç å’ŒçŽ¯å¢ƒï¼Œå¹¶éƒ¨ç½²ã€‚

> Qï¼šä¾‹å¦‚é‡‡ç”¨ git flow è¿™æ ·çš„å¤šåˆ†æ”¯å¹¶è¡Œå¼€å‘ï¼Œæ¯ä¸ªåˆ†æ”¯éƒ½è¦æœ‰ä¸€å¥—å¯¹åº”çš„ docker container å—ï¼Ÿå¦‚ä½•æ¥å…³è”åˆ†æ”¯å’Œå®¹å™¨ï¼Ÿ

Aï¼šè¿™æ˜¯ä¸ªå¥½é—®é¢˜ï¼Œé¦–å…ˆ Docker åªæä¾›ä»£ç çš„è¿è¡ŒçŽ¯å¢ƒï¼Œå¦‚æžœä»£ç çš„ä¸åŒåˆ†æ”¯ä½¿ç”¨çš„æ˜¯ä¸åŒçš„è¿è¡ŒçŽ¯å¢ƒï¼Œdocker container æ˜¯åº”è¯¥æ˜¯å¤šå¥—çš„ï¼Œè€Œä¸”ï¼Œä¸åŒçš„ dockerfile æ˜¯åº”è¯¥è·Ÿä»£ç åœ¨ä¸€èµ·çš„ã€‚ å¦‚æžœè¿è¡ŒçŽ¯å¢ƒæ˜¯ç›¸åŒçš„ï¼Œå¯ä»¥ä½¿ç”¨åŒä¸€å¥— docker containerã€‚åªéœ€è¦æŠŠä»£ç åˆ‡æ¢åˆ° Container é‡Œå³å¯ã€‚

> Qï¼šå½“å…ˆå°±ç›®å‰æ¥è¯´ï¼Œåœ¨äº‘ä¸Šéƒ¨ç½²ç¡®å®žå¾ˆå¥½ï¼Œå¯æ˜¯å…³äºŽä¸€äº›ç”Ÿäº§çš„ç§æœ‰æ€§çŽ¯å¢ƒæ˜¯ä¸æ˜¯åœ¨æœ¬åœ°æ¯”äº‘ç«¯æ›´é è°±ï¼Ÿ

Aï¼šæˆ‘ç†è§£è¿™ä¸ªé—®é¢˜åº”è¯¥æ˜¯é—®å°†äº‘ç«¯å¼€å‘çŽ¯å¢ƒéƒ¨ç½²åˆ°å…¬æœ‰äº‘ï¼Œè¿˜æ˜¯ç§æœ‰äº‘ã€‚ æˆ‘ä¸ªäººçš„ç†è§£æ˜¯ï¼Œ ç›®å‰æ¥çœ‹ï¼Œåº”è¯¥éƒ¨ç½²åœ¨ä¼ä¸šå†…éƒ¨çš„ç§æœ‰äº‘ä¸Šï¼Œæ¥é¿å…ä»£ç çš„æ³„éœ²ã€‚

> Qï¼šå½“å‰æ¥è¯´æ­å»ºä¸€ä¸ªç»Ÿä¸€çš„çŽ¯å¢ƒä½¿ç”¨ Kubernetes or SHIPYARD æ­å»ºèµ·æ¥ä¼šæ›´æ–¹ä¾¿ï¼Œè€Œä¸”çŽ°åœ¨ç‰©ç†è®¾å¤‡çš„ä»·æ ¼ä¹Ÿæ›´ä¾¿å®œï¼Œå¯æŽ§ç¨‹åº¦æ›´é«˜ï¼Œåœ¨äº‘ç«¯çœŸçš„æ¯”åœ¨å†…éƒ¨æŽ§åˆ¶å¥½ä¹ˆï¼Ÿ

Aï¼šåŒç¬¬ä¸€ä¸ªé—®é¢˜ä¸€æ ·ï¼Œäº‘ç«¯æŒ‡çš„å¯ä»¥æ˜¯ç§æœ‰äº‘ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¬æœ‰äº‘ã€‚ æˆ‘èµžåŒæé—®è€…çš„è€ƒé‡ï¼Œç§æœ‰äº‘ä¼šæ›´å¥½ä¸€äº›ã€‚

> Qï¼šæ˜¯ä¸æ˜¯å…ˆæäº¤ä»£ç ï¼Œè§¦å‘ hookï¼Œåœ¨å®¹å™¨é‡ŒåŒæ­¥ä»£ç å¹¶ç¼–è¯‘å’Œæ‰§è¡Œã€‚è¿™æ ·æ•ˆçŽ‡ä¼šæ›´é«˜å—ï¼Ÿ

Aï¼šå°†ä»£ç ç¼–è¾‘çŽ¯å¢ƒå’Œè¿è¡ŒçŽ¯å¢ƒè§£è—•ï¼Œ ä½¿ç”¨ Git æ¥åŒæ­¥ï¼Œæ•ˆçŽ‡å—ä¸¤ä¸ªå› ç´ åˆ¶çº¦ï¼š - I/O ä¹Ÿå°±æ˜¯ç½‘ç»œé€Ÿåº¦å’Œç›˜é€Ÿåº¦ã€‚     ä¿è¯ç½‘ç»œé€Ÿåº¦çš„å‰æä¸‹ï¼Œè¿™ä¸ªå› ç´ æ˜¯å¯ä»¥å¿½ç•¥çš„ - Git æœ¬èº«çš„æ•ˆçŽ‡ï¼Œå› ä¸ºæ¯ä¸€æ¬¡ä¿å­˜éƒ½ä¼šæäº¤ Gitï¼ŒGit æœ¬èº«æ˜¯å¢žé‡å­˜å‚¨ï¼Œæ‰€ä»¥æ•ˆçŽ‡ä¹Ÿä¸ä¼šå¤ªä½Žã€‚

> Qï¼šå¯¹ç§æœ‰ä»“åº“æ˜¯å¦ä¹Ÿèƒ½åŒæ ·ç”Ÿæ•ˆï¼Ÿå¯¹äºŽå®¹å™¨ä¸èƒ½è¢«å¤–éƒ¨è®¿é—®çš„è¯ï¼Œhook æœºåˆ¶è¿˜èƒ½åŒæ­¥ä»£ç å—ï¼Ÿ

Aï¼š ç›®å‰è¿™å¥—ä½“ç³»å»ºè®®æ•´ä½“éƒ¨ç½²åœ¨ç§æœ‰äº‘ä¸­ã€‚

> Qï¼šæ¯ä½å¼€å‘è€…éƒ½å…·æœ‰ç›¸åŒçš„å¼€å‘çŽ¯å¢ƒï¼Œè¯¥å¼€å‘çŽ¯å¢ƒæ˜¯ç”¨ Container ä¹ˆï¼Œç½‘ç»œæ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿä¹Ÿå°±æ˜¯è¯´åœ¨å¼€å‘è€…çœ¼é‡Œä½¿ç”¨çš„å°±æ˜¯è™šæ‹Ÿæœºï¼Œå…·æœ‰æ•…å®šçš„ IPã€‚

Aï¼šåº”è¯¥è¯´æ¯ä½å¼€å‘è€…éƒ½æœ‰ç›¸åŒçš„ä»£ç è¿è¡ŒçŽ¯å¢ƒï¼Œè¿™éƒ¨åˆ†æ˜¯é€šè¿‡ Container å®žçŽ°çš„ã€‚ç›®å‰æ˜Žæ²¡æœ‰å¯¹ç½‘ç»œæœ‰å¤ªå¤šçš„è€ƒé‡ï¼Œ åœ¨è§„åˆ’ä¸­ä¼šæœ‰ä¸€ä¸ªç½‘ç»œåˆ†é…çš„ç»„ä»¶ï¼Œä¸ºå¼€å‘äººå‘˜åˆ†é…ä¸åŒçš„å­åŸŸåï¼Œå¹¶è‡ªåŠ¨å°†åŸŸåè·¯ç”±åˆ° container ä¸Šï¼Œè¿™æ ·å¯ä»¥æ›´çµæ´»çš„åˆ†é…ä¸»æœºèµ„æºï¼Œç®¡ç† Containerã€‚

> Qï¼šä»£ç æ”¾åœ¨äº‘ç«¯æ€Žä¹ˆä¿è¯å®‰å…¨ï¼Œé˜²æ­¢ä¼ä¸šä»£ç æ³„æ¼ï¼Ÿ

Aï¼šéƒ¨ç½²åœ¨ç§æœ‰äº‘ä¸Šï¼Œ éœ€è¦å…¬ç½‘è®¿é—®æ—¶ï¼Œä½¿ç”¨ VPNã€‚

> Qï¼šæˆ‘å…¬å¸ä¸»è¦éœ€è¦æ˜¯ C++ ç ”å‘ç”µä¿¡è¡Œä¸šï¼Œä¸é€šçš„çœä»½ï¼Œä¸åŒçš„æœºåž‹éƒ½è¦æ­ç†ä¸€å¥—å¼€å‘æµ‹è¯•çŽ¯å¢ƒï¼Œä½ ä»¬è®²çš„ä¸»è¦æ˜¯ Web å¼€å‘ï¼ŒC++ æ˜¯å¦é€‚åˆäº‘ç«¯å¼€å‘ï¼Ÿ

Aï¼šæˆ‘ä¸»è¦ç ”ç©¶ Web æ–¹å‘ã€‚ åªèƒ½ç®€å•çš„è¯´ä¸€ä¸‹æ€è·¯ï¼Œ C++ çš„ docker image æ˜¯æœ‰çš„ï¼Œä¸»è¦æ˜¯çœ‹ä½ éœ€è¦ä¸€ä¸ªä»€ä¹ˆæ ·çš„è°ƒè¯•çŽ¯å¢ƒã€‚å¦‚æžœå¯ä»¥é€šè¿‡ Web æŸ¥çœ‹ç»“æžœã€‚æˆ‘è§‰å¾—æ˜¯å¯è¡Œçš„ã€‚

> Qï¼šå…³äºŽä½¿ç”¨ Git æ­å»ºæŒç»­é›†æˆçŽ¯å¢ƒæœ‰ä¸€ä¸ªç–‘é—®ï¼Œå°±æ˜¯å¦‚ä½•å¤„ç†åœ¨å¼€å‘çŽ¯å¢ƒå’Œç”Ÿäº§çŽ¯å¢ƒä¸‹ï¼Œä¸ªåˆ«æ–‡ä»¶ä¸åŒçš„æƒ…å†µåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿä¾‹å¦‚ä¸€äº›é…ç½®æ–‡ä»¶ï¼ŒDjango ä¸­çš„ settings.pyï¼Œåœ¨ç”Ÿäº§å’Œå¼€å‘çŽ¯å¢ƒä¸‹ï¼Œå…¶å†…å®¹æ˜¯ä¸åŒçš„ã€‚

Aï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œé…ç½®æ–‡ä»¶æ˜¯è¦ç‹¬ç«‹åœ¨ä»£ç ä¹‹å¤–çš„ï¼Œç”¨ Django ä¸¾ä¾‹ï¼Œ å¯ä»¥ä½¿ç”¨.envã€‚ åœ¨å¼€å‘çŽ¯å¢ƒï¼Œå’Œç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç›´æŽ¥å†™åœ¨ä»£ç é‡Œé¢ã€‚ å¦‚ä½•é…ç½®äº§å“çŽ¯å¢ƒå’Œå¼€å‘çŽ¯å¢ƒï¼Œå¯ä»¥å‚è€ƒä¸€äº›å¥½çš„å®žè·µæ–‡ç« ã€‚ åˆ†ç¦»è¿è¡ŒçŽ¯å¢ƒå’Œä»£ç çš„å®žè·µæ–‡ç« ï¼Œä¸šç•Œæ¯”è¾ƒè®¤åŒçš„æ˜¯"[The 12-Factor App](http://12factor.net/zh_cn/)"è¿™ä¸ªè®¾è®¡æ€è·¯ã€‚

> Qï¼šå¦‚æžœåŽç«¯é‡‡ç”¨é›†ç¾¤æ–¹å¼è¿›è¡Œç®¡ç†ï¼Œè¯·é—®æ‚¨å¯¹åŽç«¯å®¹å™¨èµ„æºä½¿ç”¨çš„é¢„ä¼°ï¼Œä»¥åŠå¯¹æ•´ä¸ªé›†ç¾¤çš„è´Ÿè½½èƒ½åŠ›çš„åˆ¤æ–­ï¼Œæ˜¯å¦‚ä½•è€ƒè™‘çš„ï¼Ÿé¡¹ç›®ä¸åŒï¼Œå¯¹åŽç«¯èµ„æºå½±å“æŒºå¤§ã€‚

Aï¼š ç›®å‰é¡¹ç›®è¿˜å¤„åœ¨æ¦‚å¿µéªŒè¯é˜¶æ®µã€‚ å¯¹äºŽä¸­åž‹çš„ Web é¡¹ç›®ï¼Œå•ä¸ªå¼€å‘äººå‘˜åˆ†é… 1CPU èµ„æºï¼Œ1GB å†…å­˜æ˜¯å®Œå…¨å¯ä»¥æ»¡è¶³éœ€è¦çš„ã€‚

> Qï¼šæœ¬åœ°å¼€å‘å¯ä»¥å¿«é€Ÿåˆ‡æ¢æœ¬åœ° Git çš„ä¸åŒä»£ç ç‰ˆæœ¬æŸ¥çœ‹ï¼Œè¿œç¨‹è¿è¡Œçš„è¯ï¼Œæƒ³è¦æŸ¥çœ‹ä¹‹å‰ä»£ç çš„è¿è¡Œç»“æžœéœ€è¦çœŸçš„å°†ä»£ç åœ¨è¿œç¨‹å…±äº«æœ¬åº“ä¸­å›žæ»šå—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œå› ä¸ºæ¯ä¸ªå¼€å‘éƒ½è‡ªå·±çš„è¿œç¨‹ä»£ç ä»£ç åº“ã€‚ æ‰€ä»¥ï¼Œå›žæ»šå¹¶ä¸ä¼šå½±å“å…¶ä»–äººï¼Œä¹Ÿä¸ä¼šä¸¢å¤±è‡ªå·±çš„ä»£ç ã€‚

---

### 2015-12-22ï¼šåŸºäºŽ Docker å’Œ Git çš„æŒç»­é›†æˆå·¥ä½œæµ

> Qï¼šå¼€å‘æ¯æäº¤ä¸€ä¸ª bugfixï¼Œéƒ½ä¼šè§¦å‘ jinkens åŽ»æž„å»ºé•œåƒï¼Œé‚£ä¹ˆå¤šçš„å¼€å‘è€…ï¼Œå²‚ä¸æ˜¯è¦æž„å»ºå¾ˆå¤šé•œåƒï¼Ÿ

Aï¼šæ²¡æœ‰é”™ï¼Œæˆ‘ä»¬æ˜¯æ¯æ¬¡éƒ½è§¦å‘æž„å»º imageï¼Œç”±äºŽ image æ˜¯åˆ†å±‚çš„ï¼Œåº•å±‚å·²ç»å­˜åœ¨çš„çˆ¶å¯¹è±¡ï¼Œæ˜¯ä¸ç”¨å­˜å‚¨ï¼Œåªå­˜å‚¨å˜åŒ–çš„éƒ¨åˆ†æ‰€ä»¥å†ç”¨çš„ç£ç›˜ç©ºé—´å¾ˆä½Žï¼Œåœ¨ç³»ç»Ÿå¼€å§‹åˆï¼Œæˆ‘åšè¿‡ç»Ÿè®¡ï¼Œ1000 ä¸ª image ä¹Ÿä¸åˆ° 9Gï¼Œè¿™å…¶ä¸­è¿˜æœ‰å¾ˆå¤šåŸºç¡€é•œåƒã€‚

> Qï¼šæƒ³é—®ä¸€ä¸ªé›†ç¾¤ç›¸å…³çš„ï¼Œåƒ Docker éƒ¨ç½²è¿™éƒ¨æ˜¯ç›´æŽ¥è°ƒç”¨ Docker éƒ¨ç½²å®¹å™¨ï¼Œè¿˜æ˜¯é€šè¿‡ Ansible æˆ–å…¶ä»–å·¥å…·ï¼Ÿ

Aï¼šæœ‰äº† Kubernetes ç®¡ç†é›†ç¾¤åŽï¼Œå‘å¸ƒçš„å·¥ä½œå°±æ¯”è¾ƒç®€å•äº†ï¼Œç”¨ä¸ä¸Š Ansibleã€‚ä½†æ˜¯ Ansible è¿˜æ˜¯æœ‰å®ƒçš„ç”¨å¤„çš„ï¼Œæ¯”å¦‚æ¸…ç†é›†ç¾¤ä¸­è¿‡æ—¶çš„ imageï¼Œå’Œå·²ç»é€€å‡ºçš„ Container ç­‰ã€‚

> Qï¼šä½ å¥½ï¼Œä»¥å‰ä¹Ÿåšè¿‡ç±»ä¼¼çš„æœåŠ¡"ç¬¬ä¸‰æ­¥ï¼šJenkins ä¼šæŠŠç›¸åº”çš„ image éƒ¨ç½²åˆ°æœåŠ¡å™¨é›†ç¾¤ä¸­ï¼Œå¼€å‘è€…å°±å¯ä»¥é€šè¿‡ iss001.kingdee è¿™ä¸ªåŸŸåè®¿é—®åˆšåˆšå¯¹åº”åˆ†æ”¯çš„æœåŠ¡äº†"ï¼Œå•ç‹¬ä¸€ä¸ªåˆ†æ”¯è§£å†³äº†å¯¹åº”çš„ bugï¼Œä½†å®žé™…ç”Ÿäº§ä¸­éžå¸¸å®¹æ˜“ä¿®æ”¹ä¸€ä¸ª bug å¼•èµ·å…¶ä»–çš„ bugï¼Œä½ ä»¬æ˜¯æ€Žä¹ˆåŽ»æŠŠæŽ§æ•´ä½“çš„ç¨³å®šæ€§ï¼Ÿå¦‚ä½•æé«˜è¿™ç§å•ä¸ª bug åˆ†æ”¯å•ä¸ªæµ‹è¯•çŽ¯å¢ƒçš„æ„ä¹‰ï¼Ÿ

Aï¼šè¿™ä¸ª pull-request çš„å·¥ä½œæ–¹å¼æ˜¯åº”å¯¹åŠŸèƒ½å¼€å‘çš„ï¼Œå¦‚åƒé•¿æœŸå¼€å‘æŸä¸ª new featureï¼Œä½ åˆšåˆšè¯´çš„ä¸€ä¸ª bug äº§ç”Ÿå¦å¤–ä¸€ä¸ª bugï¼Œæˆ‘ä»¬çš„åšæ³•æ˜¯æœ‰å›žå½’æµ‹è¯•ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª smoke åˆ†æ”¯ï¼ŒæŒç»­ä¸æ–­çš„å¯¹å…¶åšåŠŸèƒ½å›žå½’æµ‹è¯•ï¼Œåªæœ‰é€šè¿‡çš„æ‰èƒ½ cherry pick åˆ° release ä¸Šã€‚

> Qï¼šæµ‹è¯•çŽ¯å¢ƒä¾èµ–çš„ redis/MQ ä¹‹ç±»çš„å¤–éƒ¨æœåŠ¡å¦‚ä½•åšçš„éš”ç¦»?æ¯æ¬¡æµ‹è¯•å•ç‹¬æ‹‰èµ·æ¥ä¸€å¥—å¤–éƒ¨ä¾èµ–çš„æœåŠ¡å—ï¼Ÿ

Aï¼šæˆ‘ä»¬é€šè¿‡å¤šä¸ªæ‰‹æ®µæ¥å®žçŽ°å…±äº«æ•°æ®ï¼šmasterã€smokeã€release åˆ†æ”¯æµ‹è¯•éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸­é—´ä»¶ï¼Œè¦æ˜¯ä¸ç”¨è®¿é—®å…±äº«çš„æ•°æ®ï¼Œå¯ä»¥éƒ¨ç½²å¦‚ MQ imageï¼Œä»£ç å±‚é¢çš„ï¼Œå¦‚ MQ key çš„åç§°åŠ ä¸Šæœºå™¨çš„ IPã€‚

> Qï¼šæœ‰æ²¡æœ‰ç”¨åˆ° Mesosï¼Ÿæ˜¯å¦å®¹æ˜“é‡åˆ°é—®é¢˜ï¼Ÿè¿™æ–¹é¢çš„æ–‡æ¡£å¥½åƒå¹¶ä¸å¤šã€‚

Aï¼šMesos æ˜¯ä¸ªäºŒçº§è°ƒåº¦ï¼Œé€‚ç”¨äºŽåƒå­˜åœ¨å¤šå¥—é›†ç¾¤çš„æƒ…å†µï¼Œæ¥å‡è¡¡èµ„æºï¼Œå¦‚ï¼šéƒ¨ç½²äº† Hadoop å’Œ storm ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ storm æ¥å¤„ç†å®žæ—¶çš„è¯·æ±‚ï¼ŒHadoop åšç¦»çº¿å·¥ä½œã€‚æ™šä¸Šå’Œç™½å¤©å°±å­˜åœ¨ä¸€ç§å¯èƒ½å°±æ˜¯ Hadoop é—²ç½®ï¼Œä½†æ˜¯ storm å¯èƒ½å¾ˆå¿™ï¼Œè¿™æ—¶ Mesos è¿™æ ·çš„äºŒçº§è°ƒåº¦å°±å¯ä»¥å¹³è¡¡èµ„æºï¼ŒèŠ‚çº¦æˆæœ¬ï¼Œæˆ‘ä»¬æš‚æ—¶æ²¡æœ‰è¿™æ ·çš„éœ€æ±‚ã€‚è‡³äºŽæ–‡æ¡£æ–¹é¢æˆ‘ä¹Ÿæ²¡æœ‰æ·±å…¥ç ”ç©¶ï¼Œå»ºè®®çœ‹å®˜æ–¹æ–‡æ¡£ã€‚

---

### 2015-12-15ï¼šå®¹å™¨æœåŠ¡å¦‚ä½•åœ¨ä¼ä¸šå®¢æˆ·è½åœ°ï¼ŸRancher è§£å†³ä¹‹é“åˆ†äº«ã€‚

> Qï¼šrancher-compose å’Œ docker-compose å…³ç³»ï¼Ÿ

Aï¼šrancher-compose æ˜¯å¯¹ docker-compose çš„æ‰©å±•ï¼Œdocker-compose ç›®å‰çš„èƒ½åŠ›å¤ªæœ‰é™ã€‚

> Qï¼šRancher è‡ªå·±æœ‰æŒç»­é›†æˆçš„å·¥å…·ï¼Ÿ

Aï¼šæˆ‘ä»¬æœ¬èº«äº§å“ä¸­ä¸å¸¦ CIï¼Œä½†ä¼šåœ¨ CATALOG é‡Œæä¾›è¿™æ ·çš„å·¥å…·è®©å®¢æˆ·ä¸€é”®éƒ¨ç½²ï¼Œæˆ‘æƒ³è¿™ä¸ªæ¯”ç›´æŽ¥æä¾› CI é›†æˆæ›´ COOL

> Qï¼šRancher äº§å“æ˜¯ä»˜è´¹è¿˜æ˜¯å¼€æºçš„å‘€ï¼Ÿ

Aï¼š æˆ‘ä»¬æ˜¯å¼€æºçš„ï¼Œä½†ä¹Ÿä¼šæœ‰å¯¹åº”çš„ä¼ä¸šç‰ˆï¼Œåƒ CentOS å’Œ RHEL ä¸€æ ·ã€‚

> Qï¼šRancher çš„ç½‘ç»œæ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬ç›®å‰æ˜¯ IPSEC VPN+ åŸºäºŽ DNS çš„æœåŠ¡å‘çŽ°ã€‚

> Qï¼šæˆ‘æŽ¥è§¦ Rancher æœ‰ä¸¤ä¸ªæœˆäº†ï¼Œæ„Ÿè§‰æ˜¯ç›®å‰ Docker ç®¡ç†å¹³å°é‡Œæ¯”è¾ƒå‡ºè‰²çš„ã€‚stackã€service ç®¡ç†é€»è¾‘å¾ˆå¥½ã€‚ä¸è¿‡ç›®å‰è¿˜æ˜¯ 0.4\*ç‰ˆï¼Œè¿­ä»£åº”è¯¥æ¯”è¾ƒé¢‘ç¹ã€‚çŽ°åœ¨ä¸Šä¸šåŠ¡çš„è¯ï¼ŒåŽæœŸå‡çº§ä¼šæœ‰ä»€ä¹ˆå½±å“ä¹ˆï¼Ÿ

Aï¼šå‡çº§éžå¸¸å®¹æ˜“ï¼Œä¸”å‘åŽå…¼å®¹ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šç§‰æ‰¿ CloudStack çš„è®¾è®¡åŽŸåˆ™ã€‚

> Qï¼šç§æœ‰ç½‘ç»œä¸Žå…¬æœ‰äº‘ä¹‹é—´çš„æ•°æ®å®‰å…¨æ˜¯æ€Žä¹ˆæŽ§åˆ¶çš„ï¼Ÿ

Aï¼šé€šè¿‡ ReverseNAT ä¸‹é‡‡ç”¨ IPSec Tunnelï¼Œä¹Ÿå°±æ˜¯æ•°æ®æ˜¯åŠ å¯†çš„ï¼Œä½†è¦å¼€åœ¨æœåŠ¡å™¨é—´å¼€ä¸¤ä¸ª UDP ç«¯å£ã€‚

> Qï¼šè¯·é—® Rancher åœ¨å¤šç§Ÿæˆ·éš”ç¦»æ–¹é¢åšäº†é‚£äº›äº‹ï¼Œé‡‡ç”¨å“ªäº›å®‰å…¨æ‰‹æ®µï¼Ÿ

Aï¼šå®¹å™¨çš„éš”ç¦»æ˜¯å’Œè™šæ‹Ÿæœºä¸å¤ªä¸€æ ·ï¼Œç›®å‰æˆ‘ä»¬ç”¨"çŽ¯å¢ƒ"çš„æ¦‚å¿µåšå¤šç§Ÿæˆ·éš”ç¦»ï¼Œæ¯ä¸ª"çŽ¯å¢ƒ"æœ‰è‡ªå·±çš„å®¹å™¨ä¸»æœºå’Œå®¹å™¨ã€‚

> Qï¼šç›¸æ¯”äºŽ Kubernetesã€Mesos å’Œ Swarmã€Rancher çš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ

Aï¼šæˆ‘ä»¬å’Œä¸Šè¿°å®¹å™¨ç¼–æŽ’ä¸æ˜¯ç«žäº‰å…³ç³»ï¼ˆè™½ç„¶ç›®å‰ç¼–æŽ’æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„ï¼‰ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®ç”¨æˆ·çš„éœ€æ±‚æä¾› Swarmã€Kubernates ç”šè‡³æ˜¯ Mesos çš„ç¼–æŽ’æ–¹å¼ã€‚ä½†å®¹å™¨ç¼–æŽ’ä¸æ˜¯å…¨éƒ¨ä¼ä¸šå®¹å™¨æœåŠ¡å†…å®¹ã€‚

> Qï¼šè¯·é—® Rancher æ˜¯è‡ªå·±å®žçŽ°äº†ä¸€å¥—å®¹å™¨ç®¡ç†å·¥å…·å—ï¼Œèƒ½ä»‹ç»ä¸€ä¸‹ä½ ä»¬ç”¨åˆ°çš„æŠ€æœ¯æ ˆå—ï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯å®Œå…¨è‡ªå·±å®žçŽ°çš„ã€‚å€Ÿé‰´äº†ä¹‹å‰å›¢é˜Ÿåšçš„ CloudStack çš„æˆåŠŸç»éªŒã€‚

> Qï¼šRancher æŽ¨èè¿è¡Œåœ¨ä»€ä¹ˆæ ·çš„å®¿ä¸»æœºä¹‹ä¸Šï¼ŒUbuntu or CentOSï¼Ÿ

Aï¼šéƒ½è¡Œï¼ŒRancher å¯ä»¥ç®¡ç†æ ‡å‡† Docker ä¸»æœºã€‚

> Q: æˆ‘çœ‹æ–°ç‰ˆæœ¬å¤šäº†ä¸€ä¸ªå­˜å‚¨æ±  storage pool è¿™ä¸ªæ˜¯ä»€ä¹ˆä½œç”¨ï¼Œå¯ä»¥æ·»åŠ é›†ç¾¤å­˜å‚¨æ¥ä¾›å®¹å™¨ä½¿ç”¨ä¹ˆï¼Ÿ[rancher.com/how-rancher/rage/](http://rancher.com/how-rancher-storage-services-unleash-the-power-of-software-defined-storage/)ã€‚

> Qï¼šè¯·é—® catalog ç¦»çº¿å¯ä»¥ä½¿ç”¨å—ï¼Ÿ

Aï¼šå¾ˆå¤šä¼ä¸šéƒ½æ˜¯æ²¡æœ‰äº’è”ç½‘è®¿é—®çš„ï¼Œæˆ‘ä»¬æ”¯æŒä»Žæœ¬åœ°é•œåƒåº“ Registry ä¸­æ‹‰ imagesã€‚

> Qï¼šè¯·é—®ä½ ä»¬è·Ÿ Docker å…¬å¸æ˜¯å¦‚ä½•åˆä½œçš„ï¼Ÿæ˜¯ä»€ä¹ˆä¸€ç§å…³ç³»ï¼Ÿä»–ä»¬ä¼šæŽ¨å¹¿ä½ ä»¬çš„äº§å“å—ï¼Ÿ

Aï¼šéƒ½æ˜¯ç¡…è°·å…¬å¸ï¼Œæœ‰æ·±å…¥çš„æŠ€æœ¯åˆä½œï¼Œå¾ˆå¤š Docker ç»„ä»¶å¦‚ libcompose éƒ½æ˜¯æˆ‘ä»¬è´¡çŒ®çš„ã€‚

---

### 2015-12-09ï¼šçŽ©è½¬ Docker é•œåƒå’Œé•œåƒæž„å»º

> Qï¼šäº¬ä¸œç§æœ‰äº‘æ˜¯åŸºäºŽ OpenStackï¼‹Docker å—ï¼Œç½‘ç»œå’Œå­˜å‚¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šæ˜¯çš„ã€‚ç§æœ‰äº‘ç½‘ç»œä½¿ç”¨çš„æ˜¯ VLANã€‚å¹¶æ²¡æœ‰ä½¿ç”¨ç§Ÿæˆ·éš”ç¦»ï¼Œä¸»è¦ä¿è¯æ•ˆçŽ‡ã€‚å­˜å‚¨ä½¿ç”¨çš„æ˜¯äº¬ä¸œè‡ªå·±çš„å­˜å‚¨ã€‚

> Qï¼šé‚£ä¸ªé•œåƒåŽ‹ç¼©ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ

Aï¼šé•œåƒåŽ‹ç¼©æˆ–è€…è¯´åˆå¹¶ï¼Œä¸»è¦æ˜¯å‡å°‘å±‚æ•°ï¼Œå‡å°‘æ‹…å¿§ã€‚å…¶å®žç›®å‰çœ‹ï¼Œå¥½å¤„å¹¶ä¸æ˜Žæ˜¾ã€‚å› ä¸ºå±‚æ•°è¿‡å¤šå¸¦æ¥çš„æ›´å¤šçš„æ˜¯æ‹…å¿§ï¼Œä½†æ²¡æœ‰ç¡®å‡¿è¯æ®è¡¨æ˜Žä¼šå½±å“ç¨³å®šã€‚

> Qï¼šåœ¨çº¿ç¼–è¯‘åº”ç”¨å¹¿æ³›å—ï¼Ÿæˆ‘ä»¬ä¸€èˆ¬å¯èƒ½æ›´å…³æ³¨æœ€åŽçš„ç»“æžœã€‚æœ‰å¾ˆå¤šä»£ç éƒ½æ˜¯å…ˆåœ¨æœ¬åœ°ç¼–è¯‘ï¼ŒæˆåŠŸåŽï¼Œå†å‘å¸ƒåˆ°é•œåƒä¸­çš„ã€‚

Aï¼šè¿™ä¸ªçŽ©æ³•åº”è¯¥è¯´å¹¶ä¸å¹¿æ³›ã€‚ä¸»è¦æ˜¯æˆ‘è‡ªå·±çŽ©çš„æ—¶å€™ï¼Œä¸æƒ³è‡ªå·±åŽ»æ‹‰é•œåƒçš„å…¨éƒ¨å±‚ï¼Œåªå…³æ³¨ç¼–è¯‘ç»“æžœã€‚æ‰€ä»¥è¿™æ ·çŽ©

> Qï¼šå¯¹äºŽ Docker é•œåƒçš„å­˜å‚¨äº¬ä¸œæ˜¯ä½¿ç”¨ä»€ä¹ˆæ–¹å¼å®žçŽ°çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿäº¬ä¸œ Docker ä¸Šæœ‰ä½¿ç”¨å—èƒ½å¦ä»‹ç»ä¸‹ï¼Ÿ

Aï¼šé•œåƒå­˜å‚¨ä½¿ç”¨çš„æ˜¯å®˜æ–¹çš„ registryã€‚v1 ç‰ˆæœ¬ã€‚registry åŽç«¯æ˜¯äº¬ä¸œè‡ªç ”çš„ JFS å­˜å‚¨ã€‚

> Qï¼šä½ ä¹‹å‰æåˆ°äº†"é•œåƒçš„åˆå¹¶ç¼©å‡äº†å±‚æ•°ï¼Œä½†æ˜¯å¼Šç«¯åœ¨äºŽå°†ç”Ÿæˆé•œåƒçš„ Dockerfile ä¿¡æ¯ä¹Ÿæ¶ˆé™¤äº†ï¼ˆä½¿ç”¨ Dockerfile ç”Ÿæˆçš„é•œåƒï¼Œå¯ä»¥é€šè¿‡ dockerhistory è¿›è¡Œå›žæº¯ï¼‰ã€‚"é‚£å¦‚æžœä½¿ç”¨äº† Compress ä¹‹åŽï¼Œåº”è¯¥å¦‚ä½•è¿›è¡Œå›žæº¯ï¼Ÿè¿˜æ˜¯è¯´éœ€è¦èˆå¼ƒè¿™éƒ¨åˆ†åŠŸèƒ½ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œç¡®å®žæ²¡åŠžæ³•å›žæº¯äº†ï¼Œæ‰€ä»¥è¦èˆå¼ƒäº†ã€‚ä¸è¿‡åè¿‡æ¥æƒ³ï¼Œå…¶å®žå¦‚æžœ Dockerfile çš„ ADD å’Œ COPY ä¹‹ç±»çš„åŠŸèƒ½ï¼Œå°±ç®—èƒ½å›žæº¯ï¼Œå…¶å®žæ„ä¹‰ä¹Ÿä¸å¤§ã€‚æ‰€ä»¥æˆ‘è®¤ä¸ºä¿å­˜ Dockerfile æ›´æœ‰æ„ä¹‰ã€‚

> Qï¼šä¸ºä»€ä¹ˆä¸é‡‡ç”¨å°†è¦æ‰§è¡Œçš„å‘½ä»¤åšæˆè„šæœ¬ï¼Œç›´æŽ¥ add è¿›åŽ»æ‰§è¡Œè¿™ç§ï¼Œä¹Ÿèƒ½å‡å°‘å±‚æ•°ï¼Ÿ

Aï¼šè¿™ç§æ–¹æ³•ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚åªæ˜¯ Dockerfile æ›´æ˜¾å¼ä¸€äº›ã€‚åŒç†ï¼Œå…¶å®žåªè¦ä½ åšå¥½é•œåƒï¼Œç›´æŽ¥ export å‡ºåŽ»ï¼Œå°±å¯ä»¥å¾—åˆ°æ‰€æœ‰æ–‡ä»¶äº†ã€‚å†é…ä¸Šé…ç½®æ–‡ä»¶ã€‚è¿™æ ·æ•´ä¸ªå°±åªæœ‰ä¸€å±‚äº†ã€‚

> Qï¼šæˆ‘å¹³æ—¶åœ¨ï¼Œæµ‹è¯•çš„æ—¶å€™å¹¶æ²¡-æœ‰åŽ‹ç¼©è¿‡ï¼Œä¹Ÿä¸çŸ¥é“ï¼ŒåŽ‹ç¼©ä¼šå¸¦æ¥ä»€ä¹ˆé£Žé™©ï¼Œä½†æ˜¯ï¼Œçœ‹ä½ åˆšæ‰è¯´æœ‰å¯èƒ½ä¼šå¸¦æ¥ä¸€å®šçš„é£Žé™©ã€‚ä½ ä»¬é‡åˆ°è¿‡ä¹ˆï¼Ÿ

Aï¼šå› ä¸ºæˆ‘ä»¬çš„é•œåƒéƒ½åšè¿‡åˆå¹¶å±‚ï¼Œæ‰€ä»¥å±‚æ•°å¹¶ä¸å¤šã€‚ä¸åˆå¹¶ä¼šå¸¦æ¥ä»€ä¹ˆé£Žé™©ï¼Œå…¶å®žæ›´å¤šçš„æ˜¯å‡ºäºŽæ€§èƒ½å’Œç¨³å®šæ€§ä¸Šçš„æ‹…å¿§ã€‚è¿™ç§æ‹…å¿§å¯èƒ½æ˜¯å¤šä½™çš„ã€‚ä½†æ˜¯æˆ‘ä»¬å®æ„¿é€‰æ‹©è°¨æ…Žä¸€äº›ã€‚

> Qï¼šé•œåƒçš„åˆå¹¶æ–¹é¢æ€Žä¹ˆæ ·èƒ½æ–¹ä¾¿çš„å‡å°é•œåƒçš„å¤§å°ï¼Œæˆ‘åšçš„é•œåƒæœ‰äº›éƒ½åœ¨ 1G ä»¥ä¸Šï¼Ÿ

Aï¼šå‡å°‘é•œåƒå¤§å°ä¸»è¦è¿˜æ˜¯é åŽ»é™¤ä¸å¿…è¦çš„æ–‡ä»¶ã€‚åˆå¹¶åªèƒ½å‡å°‘å†—ä½™æ–‡ä»¶ï¼Œå¦‚æžœæ¯å±‚çš„æ–‡ä»¶éƒ½ä¸ç›¸åŒï¼Œåˆå¹¶å¹¶ä¸ä¼šç¼©å°é•œåƒçš„å¤§å°ã€‚

> Qï¼šç½‘ç»œè¿™ä¸ªä½¿ç”¨ VLAN èƒ½è¯´è¯¦ç»†ä¸€äº›å—ï¼Œæ˜¯æ¯ä¸ªå®¹å™¨éƒ½æœ‰ä¸€ä¸ªå’Œå®¿ä¸»æœºåŒç½‘æ®µçš„çœŸå®žçš„ç‰©ç† IP å—ï¼Ÿ

Aï¼šæ˜¯çš„ã€‚æ¯ä¸ªå®¹å™¨éƒ½æœ‰ä¸€ä¸ªçœŸå®žçš„ IPã€‚è·Ÿå®¿ä¸»æœºç½‘æ®µä¸åŒã€‚æ˜¯å•ç‹¬çš„å®¹å™¨ç½‘ç»œã€‚è¿™ä¸ªå¯ä»¥å‚è€ƒ neutron ä¸­çš„ Vlan å®žçŽ°ã€‚

> Qï¼šè¿˜æœ‰ï¼ŒæŠŠé•œåƒåŽ‹ç¼©æˆ‘ä¹Ÿè§‰ï¼Œä½†æ˜¯åƒä½ é‚£æ ·æŠŠçˆ¶é•œåƒæ•´ä¸ªåˆå¹¶æˆæ–°é•œåƒè¿™ç‚¹æˆ‘è§‰å¾—æœ‰ç‚¹é—®é¢˜ï¼Œæ¯•ç«Ÿå¤§å®¶çŽ©å®¹å™¨æ—¶éƒ½æ˜¯åœ¨åŸºç¡€é•œåƒä¸Šæ·»åŠ ä¸œè¥¿ï¼Œä½ æŠŠå¸¸ç”¨çš„é•œåƒä¸ºäº†åŽ‹ç¼©ç”Ÿæˆä¸€ä¸ªä¸€æ¬¡æ€§çš„é•œåƒï¼Œä»¥åŽå†ä½¿ç”¨åŸºç¡€é•œåƒåšå…¶ä»–ä¸šåŠ¡æ—¶é‚£ä¸è¿˜å¾—é‡æ–°ä¸‹è½½åŸºç¡€é•œåƒï¼Ÿ

Aï¼šé•œåƒåˆå¹¶å…¶å®žä¸»è¦è¿˜æ˜¯ä¸ºäº†èŽ·å¾—ä¸€ä¸ªåŸºç¡€é•œåƒã€‚ç„¶åŽå¤§å®¶åœ¨åŸºç¡€é•œåƒä¸Šæ·»åŠ ä¸œè¥¿ã€‚åŸºç¡€é•œåƒç›¸å¯¹æ¥è¯´ï¼Œä¸ä¼šè½»æ˜“æ”¹å˜ã€‚

> Qï¼šåœ¨ä½ ä»¬çš„å®žè·µä¸­ï¼Œå¤§è§„æ¨¡éƒ¨ç½²å®¹å™¨æ—¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šä»Ž Registry èŠ‚ç‚¹ä¸‹è½½é•œåƒï¼Œç»™ç½‘ç»œå¸¦æ¥çš„åŽ‹åŠ›å¤§å—ï¼Ÿ

Aï¼šæˆ‘ä»¬åšäº†ä¸€äº›ä¼˜åŒ–ã€‚é¦–å…ˆï¼Œå¤§éƒ¨åˆ†ä¸šåŠ¡ä½¿ç”¨çš„é•œåƒä¼šæå‰æŽ¨é€åˆ°æ¯ä¸ª Docker èŠ‚ç‚¹ä¸Šã€‚å³ä½¿èŠ‚ç‚¹æ²¡æœ‰ï¼ŒRegistry åŽç«¯æŽ¥çš„æ˜¯äº¬ä¸œçš„ JFSï¼Œé€šè¿‡ä¼˜åŒ–ï¼Œä¸´æ—¶åŽ»ä¸‹è½½çš„æ—¶å€™å¯ä»¥ç›´æŽ¥ä»Ž JFS åŽ»æ‹¿é•œåƒæ•°æ®ã€‚æ‰€ä»¥ç½‘ç»œåŽ‹åŠ›å¹¶ä¸å¤§ã€‚

> Qï¼šé•œåƒåŽ‹ç¼©æˆ–è€…åˆå¹¶ä¹‹åŽï¼Œé•œåƒçš„å±‚æ¬¡å‡å°‘äº†ï¼Œä½†æ¯å±‚é•œåƒä¸æ˜¯å˜å¤§äº†å—ï¼Œè¿™å¯¹äºŽå‘å¸ƒä¸æ˜¯ä¼šå ç”¨å¸¦å®½é™ä½Žæ•ˆçŽ‡å—ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜è·Ÿä¸Šä¸ªå·®ä¸å¤šã€‚åˆå¹¶ä¸»è¦æ˜¯ä¸ºåŸºç¡€é•œåƒä½¿ç”¨çš„ã€‚

> Qï¼šä½ ä»¬æ€Žä¹ˆçœ‹å¾… OpenStack å’Œ Docker çš„å…³ç³»ï¼Ÿåœ¨äº¬ä¸œæœªæ¥ä¼šé•¿æœŸä¸¤ä¸ªå¹¶å­˜å—ï¼ŸçŽ°åœ¨ä¸¤ä¸ªæž¶æž„çš„å‘å±•é€Ÿåº¦å’Œç ”å‘åŠ›é‡å¯¹æ¯”å¦‚ä½•ï¼Ÿ

Aï¼šOpenStack å’Œ Docker å¹¶ä¸çŸ›ç›¾ã€‚ç§æœ‰äº‘é‡‡ç”¨ nova docker çš„ç»“åˆæ›´å¤šçš„æ˜¯è¿Žåˆç”¨æˆ·ä¹ äºŽä½¿ç”¨ VM çš„ä¹ æƒ¯ã€‚Magnum ä¹Ÿåœ¨å¿«é€Ÿå‘å±•ä¸­ã€‚æ‰€ä»¥æˆ‘ç›¸ä¿¡äºŒè€…éƒ½æœ‰å­˜åœ¨çš„ä»·å€¼å’Œå‘å±•çš„å¿…è¦ã€‚

> Qï¼šå…³äºŽ dockfile çš„ä¼˜åŒ–ï¼Œä½ ä»¬æœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®æˆ–è€…ç»éªŒï¼Ÿ

Aï¼šä¼¼ä¹Žä¹Ÿæ²¡å¤šå°‘æ–°çš„å»ºè®®ã€‚å‚è€ƒ DockOne çš„ç›¸å…³æ–‡ç« ã€‚[Dockerfile ä¹‹ä¼˜åŒ–ç»éªŒæµ…è°ˆ](http://dockone.io/article/255)ã€[å¤§å®¶åœ¨å†™ dockerfile æ—¶æœ‰å•¥æœ€ä½³å®žè·µï¼Ÿå¸Œæœ›å¾—åˆ°å¤§å®¶çš„å»ºè®®](http://dockone.io/question/683)ã€‚

> Qï¼šæ¯”å¦‚åˆ›å»ºä¸€ä¸ª rabbitmq é•œåƒï¼Œéœ€è¦å®‰è£…å¾ˆå¤šä¾èµ–åŒ…ï¼Œæœ€åŽç¼–è¯‘ï¼Œæœ€åŽç”Ÿæˆçš„é•œåƒ 1.3Gï¼Œåƒè¿™ç§æƒ…å†µï¼Œåœ¨åˆ›å»ºé•œåƒçš„æ—¶å€™èƒ½å¦å‡å°‘é•œåƒçš„å¤§å°å‘¢ï¼Ÿ

Aï¼šå¹¶æ²¡æœ‰ä»€ä¹ˆå¥½çš„åŠžæ³•æ¥å‡å°‘ã€‚å¯èƒ½éœ€è¦ä¸€å®šçš„äººå·¥æˆ–è€…å·¥å…·åŽ»åˆ†æžä¸éœ€è¦çš„æ–‡ä»¶ï¼Œæ¥å‡å°‘é•œåƒçš„å¤§å°ã€‚

> Qï¼šDocker æ˜¯å¦‚ä½•è¿›è¡Œè‡ªåŠ¨æ›´æ–°çš„ï¼Œè‡ªå·±æ­å»ºçš„é•œåƒä»“åº“ï¼Œå¦‚ä½•æ›´æ–°æ–°ç‰ˆæœ¬çš„é•œåƒï¼Ÿ

Aï¼šDocker æˆ‘ä»¬å›ºå®šäº†ä¸€ä¸ªç‰ˆæœ¬ã€‚å¦‚æžœæ²¡å‡ºå¤§é¢ç§¯çš„ä¸¥é‡é—®é¢˜ï¼Œå‡ ä¹Žä¸ä¼šæ›´æ–°ã€‚ç›®å‰æ¥çœ‹ï¼Œè¿è¡Œç¨³å®šã€‚æ‰€ä»¥ä¹Ÿæ²¡æœ‰æ›´æ–°å¿…è¦ã€‚æ–°ç‰ˆæœ¬çš„ Docker æä¾›çš„å¦‚ç½‘ç»œç­‰ï¼Œæš‚æ—¶æˆ‘ä»¬è¿˜ä¸ä¼šå¤§é¢ç§¯è·Ÿè¿›ä½¿ç”¨ã€‚è‡ªå·±çš„é•œåƒä»“åº“ï¼Œå¦‚æžœè¦æ›´æ–°æ–°ç‰ˆæœ¬é•œåƒï¼Œpush è¿›åŽ»å°±å¯ä»¥äº†ã€‚

> Qï¼šä¸€ä¸ªå›°æ‰°æˆ‘æ¯”è¾ƒä¹…çš„é—®é¢˜ï¼Œå¦‚æžœé•œåƒé—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼ŒåŸºç¡€é•œåƒå‘ç”Ÿæ”¹å˜åŽå…¶ä»–é•œåƒä½ ä»¬æ˜¯è·Ÿç€æ›´æ–°çš„å‘¢ï¼Ÿ

Aï¼šåœ¨å†…éƒ¨ç§æœ‰äº‘ä¸­ï¼Œä¸€èˆ¬å¤§å®¶ä½¿ç”¨çš„éƒ½æ˜¯ä¸€ä¸ªåšå¥½çš„ base é•œåƒã€‚è¿™é‡Œé¢å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸€æ—¦è¿™ä¸ª base é•œåƒéœ€è¦æ‰“è¡¥ä¸ï¼Œå½±å“é¢æ¯”è¾ƒå¤§ã€‚é¦–å…ˆå¾ˆå¤š base çš„å­é•œåƒä¼šå—åˆ°å½±å“ã€‚å¦ä¸€æ–¹é¢ï¼Œå°±æ˜¯è¦è€ƒè™‘å·²ç»åœ¨ä½¿ç”¨åŸºäºŽ base æˆ–è€… base å­é•œåƒçš„èŠ‚ç‚¹ã€‚å‰è€…æˆ‘çš„æ–¹æ¡ˆæ˜¯ç›´æŽ¥åœ¨ base é•œåƒä¸­çš„ layerï¼ŒæŠŠéœ€è¦æ‰“è¡¥ä¸çš„æ–‡ä»¶åŠ å…¥è¿›åŽ»ï¼Œé‡æ–°æ‰“åŒ…æ”¾å›žã€‚å¯¹äºŽåŽè€…ï¼Œç›®å‰è¿˜æ²¡æƒ³åˆ°å¾ˆå¥½çš„æ–¹æ³•è§£å†³ã€‚

> Qï¼šåœ¨è¿è¡Œå®¹å™¨çš„æ—¶å€™ï¼Œ1ã€åº”ç”¨é‡Œé¢çš„æ—¥å¿—æˆ–è€…é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨æœ¬åœ°æ˜ å°„æ˜¯ä¸æ˜¯å¥½ç‚¹ï¼Œæˆ‘æ˜¯è€ƒè™‘åˆ°æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—æˆ–è€…ä¿®æ”¹é…ç½®ï¼›2ã€åˆ›å»ºçš„æ•°æ®åº“é•œåƒï¼Œåœ¨è¿è¡Œå®¹å™¨çš„æ—¶å€™æŠŠæ•°æ®æ–‡ä»¶æ˜¯ä¸æ˜¯æ˜ å°„åˆ°æœ¬åœ°æ›´å¥½äº›å‘¢ï¼Ÿ

Aï¼šæ—¥å¿—æˆ‘ä»¬çš„ç¡®æ˜¯ä½¿ç”¨çš„æœ¬åœ°æ˜ å°„ã€‚è€Œä¸”æœ‰çš„ä¸šåŠ¡æ–¹ç‹‚å†™æ—¥å¿—ä¸åŠ çº¦æŸã€‚æ‰€ä»¥æˆ‘ä»¬ç»™æœ¬åœ°æ˜ å°„åšäº†ä¸ª LVMï¼ŒæŒ‚ç»™å®¹å™¨ã€‚åšäº†å®¹é‡ä¸Šçš„é™åˆ¶ã€‚é…ç½®çš„è¯ï¼ŒçŽ°åœ¨æ˜¯æœ‰ä¸€ä¸ªå†…éƒ¨çš„éƒ¨ç½²ç³»ç»Ÿä¼šå¸®ä»–ä»¬éƒ¨ç½²é…ç½®ã€‚æ•°æ®åº“çš„è¯æ˜¯ä¸€ä¸ªé“ç†ï¼Œä¹Ÿæ˜¯æ˜ å°„åˆ°æœ¬åœ°ã€‚ä¹Ÿæœ‰ä¸€éƒ¨åˆ†æŽ¥å…¥äº†äº‘ç¡¬ç›˜ã€‚

> Qï¼šDocker ä¸­ï¼Œæ¯å±‚é•œåƒæ‰“æ ‡ç­¾é‚£æˆ‘è§‰çš„å¾ˆå¥‡æ€ªï¼Œå½“ pull ä¸€ä¸ªé•œåƒæˆ–ç”Ÿæˆä¸€ä¸ªå®¹å™¨æ—¶ï¼Œå®ƒå¦‚ä½•æ‰¾åˆ°ä½ æ‰€å‘½åçš„é•œåƒå±‚ï¼Ÿ

Aï¼šå¹¶ä¸æ˜¯ç»™æ¯å±‚éƒ½æ‰“æ ‡ç­¾ï¼Œè€Œæ˜¯ä½ æ ¹æ®ä½ çš„éœ€è¦æ¥ç»™æŸä¸€å±‚æ‰“æ ‡ç­¾ã€‚è‡³äºŽæ ‡ç­¾å†…å®¹ï¼Œéœ€è¦è‡ªå·±æ¥è¿›è¡ŒæŽ§åˆ¶ã€‚

> Qï¼šå…³äºŽ Compress çš„å®žçŽ°æœ‰äº›ç–‘é—®ï¼Œæ˜¯ä¸æ˜¯åœ¨å®žçŽ°çš„è¿‡ç¨‹ä¸­ï¼Œåªè€ƒè™‘æœ€åŽçš„é•œåƒå’Œå‰ä¸€å±‚çš„ diffï¼Œè¿˜æ˜¯è¯´è¦é€å±‚åš diffï¼Ÿ

Aï¼šæ˜¯åªè€ƒè™‘æœ€åŽçš„é•œåƒå’Œä½ è¦åˆå¹¶åˆ°çš„çˆ¶å±‚é•œåƒåš diffã€‚è¿™æ ·åªè¦åšä¸€æ¬¡ diffï¼Œå°±å¯ä»¥èŽ·å¾—ä¸­é—´çš„æ‰€æœ‰æ–‡ä»¶å˜åŒ–äº†ã€‚

> Qï¼šwrapdocker æ–‡ä»¶çš„å·¥ä½œåŽŸç†æ˜¯ä»€ä¹ˆ?

Aï¼šè¿™ä¸ªå·¥ä½œåŽŸç†ä¸»è¦æ˜¯å‡†å¤‡ä¸€äº› Docker å¯åŠ¨å¿…è¦çš„çŽ¯å¢ƒã€‚æ¯”å¦‚åœ¨ CentOS ä¸‹ï¼Œéœ€è¦ wrapdocker æŠŠ cgroups ç­‰å‡†å¤‡å¥½ç­‰ã€‚ä½ å¯ä»¥å‚è€ƒä¸‹ wrapdocker é‡Œé¢çš„ä»£ç ã€‚

> Qï¼šå®¹å™¨è¿è¡Œåœ¨ç‰©ç†æœºä¸Šï¼Œä¸Ž OpenStack å¹³å°è™šæ‹Ÿæœºæ˜¯åŒä¸€å¥—ç®¡ç†ç³»ç»Ÿï¼Ÿå¦‚ä½•ä¸Žå®¹å™¨çš„é›†ç¾¤ç³»ç»Ÿæ•´åˆï¼Ÿ

Aï¼šæ˜¯åŒä¸€å¥—ç³»ç»Ÿï¼Œéƒ½æ˜¯ç”¨ novaã€‚è™šæ‹Ÿæœº KVM å’Œå®¹å™¨ä¸»è¦æ˜¯é•œåƒç±»åž‹ä¸åŒã€‚åœ¨ nova è°ƒåº¦çš„æ—¶å€™ï¼Œä¼šæ ¹æ®é•œåƒç±»åž‹è°ƒåº¦åˆ° KVM æˆ–è€… Docker èŠ‚ç‚¹è¿›è¡Œåˆ›å»ºã€‚

> Qï¼šåœ¨ä¸€å°ç‰©ç†æœºä¸Šè¿è¡Œ Docker çš„æ•°é‡æ˜¯å¦æœ‰é™å®š è¿˜æ˜¯çœ‹è¿è¡Œçš„åº”ç”¨æ¥å†³å®šï¼Ÿ

Aï¼šæ²¡æœ‰ç‰¹åˆ«åšé™å®šã€‚ä¸»è¦è¿˜æ˜¯ä¸šåŠ¡æ–¹åŽ»ç”³è¯·çš„ã€‚ä¸šåŠ¡æ–¹ä¹ æƒ¯ç”¨å¤§å†…å­˜ï¼Œå¤š CPU çš„ã€‚é‚£è¿™ä¸ªç‰©ç†æœºä¸Šåˆ›å»ºçš„å®¹å™¨æ•°å°±å°‘äº›ã€‚å¤§è‡´è¿™æ ·ã€‚

>> Qï¼šæƒ³äº†è§£ä¸€ä¸‹ï¼Œä½ ä»¬å¯¹é•œåƒçš„ tag æ˜¯æ€Žä¹ˆç®¡ç†çš„ï¼Ÿæ ¹æ®ä»€ä¹ˆæ¥æ‰“çš„ï¼Ÿå¯¹äºŽæ—§çš„é•œåƒä½ ä»¬æ˜¯ä¸¢å¼ƒè¿˜æ˜¯åƒ Git ä¿å­˜ä»£ç ä¸€æ ·ä¸€ç›´ä¿ç•™åœ¨ä»“åº“å‘¢ï¼Ÿ
>>

Aï¼štag ç”±å„ä¸ªç”¨æˆ·æ¥å®šã€‚ä¸åŒçš„ç”¨æˆ·åœ¨ä¸åŒçš„ Repository é‡Œã€‚é•œåƒ tag è‡ªå·±ç®¡ç†ã€‚ä¸è¿‡æˆ‘ä»¬æ›´å¸Œæœ›ä»–ä»¬èƒ½å¤Ÿæ›´åŠ è§„èŒƒä¸€äº›ï¼Œæ¯”å¦‚ç”¨ git çš„ç‰ˆæœ¬å·æ¥æ‰“ tagã€‚

---

### 2015-11-29ï¼šå¾®æœåŠ¡æž¶æž„äº‘ç«¯åº”ç”¨

> Qï¼šè¯·é—®ä½ æ˜¯åŸºäºŽ Docker å’Œ Mesos å—?

Aï¼šç”¨äº† Dockerã€‚

> Qï¼šæ˜¯æ··åˆäº‘æž¶æž„å—?

Aï¼šæ˜¯çš„ï¼Œä¹Ÿå¯ç”¨åœ¨ç§æœ‰äº‘ã€‚

> Qï¼šå¾®æœåŠ¡æ˜¯è°å‘å¸ƒå“ªï¼Ÿ

Aï¼šåªè¦æœ‰ä»£ç å°±å¯ä»¥å‘å¸ƒå¾®æœåŠ¡ï¼Œä¸€èˆ¬ç”±å¾®æœåŠ¡çš„å¼€å‘è€…å‘å¸ƒã€‚

> Qï¼šä¸šåŠ¡ç³»ç»Ÿæ—¥å¿—æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ

Aï¼šç»Ÿä¸€è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºï¼ŒæŒ‰ç§Ÿæˆ·å­˜å‚¨ï¼Œå®žæ—¶æ˜¾ç¤ºåˆ°é¡µé¢ï¼Œå¯ä»¥æŒ‰å¤©ä¸‹è½½ã€‚

> Qï¼šè¯·é—®ä½ ä»¬çš„å®¹å™¨ç®¡ç†ç³»ç»Ÿæ˜¯åŸºäºŽå¼€æºå¹³å°è¿˜æ˜¯è‡ªå·±å¼€å‘çš„ï¼Ÿæœ‰ä½•ä¼˜åŠ¿ï¼Ÿ

Aï¼šç”¨äº†ä¸€éƒ¨åˆ†å¼€æºã€‚ 4.æŒå¼€æºæœåŠ¡å’Œç”¨æˆ·è´¡çŒ®çš„æœåŠ¡ï¼Œç”¨æˆ·é€‰æ‹©ç©ºé—´æ›´å¤§ã€‚

> Qï¼šè¯·é—®ä½ ä»¬çš„æœåŠ¡ã€Œæ°´å¹³ä¼¸ç¼©ã€å’Œã€Œåž‚ç›´ä¼¸ç¼©ã€åˆ†åˆ«é¢å¯¹å“ªç±»åœºæ™¯ï¼Ÿå¦‚ä½•å®žçŽ°ï¼Ÿ

Aï¼šã€Œåž‚ç›´ä¼¸ç¼©ã€å¯¹äºŽæ‰€æœ‰åœºæ™¯éƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚ã€Œæ°´å¹³ä¼¸ç¼©ã€ç”¨åˆ°æ— çŠ¶æ€æœåŠ¡çš„åœºæ™¯ï¼Œè€Œä¸”å¯ä»¥å’Œã€Œåž‚ç›´ä¼¸ç¼©ã€å åŠ ä½¿ç”¨çš„ï¼Œæœ‰çŠ¶æ€æœåŠ¡ä¸æ”¯æŒæ°´å¹³ä¼¸ç¼©ã€‚é’ˆå¯¹ä¸åŒå¾®æœåŠ¡ç±»åž‹ï¼Œåœ¨ç®¡ç†åŽå°é…ç½®å°±å¯ä»¥å®žçŽ°ã€‚

> Qï¼šå¾®æœåŠ¡è·¨å¹³å°å¦‚ä½•è§£å†³ç½‘ç»œå»¶è¿Ÿé—®é¢˜å‘¢ï¼Ÿ

Aï¼šåœ¨ç½‘ç»œä¸ç¨³å®šçš„åœºæ™¯ï¼ŒæœåŠ¡ä¹‹å‰çš„è°ƒç”¨ä¸€å®šè¦ç”¨æ–­è·¯å™¨ï¼Œå¦å¤–åªæœ‰ä¼˜åŒ–ç‰©ç†ç½‘ç»œé“¾è·¯äº†ã€‚

> Qï¼šå¾®æœåŠ¡æ€Žä¹ˆè§£å†³åŽç«¯æ•°æ®åº“çš„éƒ¨ç½²å’Œä¾èµ–é—®é¢˜ï¼Ÿ

Aï¼šåœ¨å¥½é›¨äº‘ï¼Œæ•°æ®åº“ä¹Ÿç®—ç‰¹æ®Šä¸€ç±»å¾®æœåŠ¡ï¼ŒåŒæ ·æœ‰å…¶ä»–å¾®æœåŠ¡çš„ç‰¹æ€§ï¼Œä¸€æ ·å¯ä»¥é€šè¿‡å¾®æœåŠ¡çš„ç‰¹æ€§éƒ¨ç½²å’Œé…ç½®ä¾èµ–å…³ç³»ã€‚

> Qï¼šä»‹ç»ä¸‹æœåŠ¡é—´é€šä¿¡æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šåœ¨æœåŠ¡ä½¿ç”¨ç«¯å®žçŽ°äº†ä¸€ä¸ªé€æ˜Žçš„ä»£ç†ï¼Œå®ƒæ ¹æ®æœåŠ¡æ³¨å†Œçš„ Endpointï¼Œæ‰¾åˆ°è¦ä½¿ç”¨çš„æœåŠ¡ï¼Œå¦‚æžœæ˜¯å¤šä¸ªæœåŠ¡ï¼Œè‡ªåŠ¨å®žçŽ°è´Ÿè½½å‡è¡¡ã€‚

> Qï¼šæ”¯æŒçš„è¯­è¨€æœ‰æ²¡æœ‰ c è¯­è¨€ï¼Ÿ

Aï¼šå¯ä»¥é€šè¿‡ dockfile æ”¯æŒçš„ã€‚

> Qï¼šè¯·é—®ä¸€ä¸‹ docker é€‰ç”¨çš„æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼Ÿæœ‰ç‰¹æ®ŠåŽŸå› ä¹ˆï¼Ÿ

Aï¼šæˆ‘ä»¬æ¯”è¾ƒä¿å®ˆï¼Œç”¨çš„æ˜¯æ¯”è¾ƒç¨³å®šçš„ï¼Œé™¤éžæœ‰ä¸ªå¤§ç‰¹æ€§å¸å¼•æˆ‘ä»¬

> Qï¼šè¯·é—®ä»£ç†æ¨¡å¼æ˜¯æŒ‡ç±»ä¼¼äºŽ API GATEWAY å—ï¼Ÿå…·ä½“ç”¨ä»€ä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šæ˜¯çš„ã€‚æœ‰å¾ˆå¤šç§å®žçŽ°æ–¹å¼ï¼Œå¯ä»¥è‡ªå·±å†™ä»£ç å®žçŽ°ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²ä¸€ä¸ª Nginxã€‚

> Qï¼šä»Žå‰é¢æž¶æž„å›¾çœ‹æ¯ä¸ªå¾®æœåŠ¡çš„æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™æ˜¯å¿…é¡»çš„å—ï¼Ÿ

Aï¼šè¿™æ ·æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œæ¯”å¦‚ä¸šåŠ¡éš”ç¦»ï¼Œç‹¬ç«‹å›¢é˜Ÿç»´æŠ¤ï¼Œä¸šåŠ¡åˆ†åŒºï¼Œç­‰ç­‰ï¼Œä¸æ˜¯å¿…é¡»ï¼Œå…±äº«æ¨¡å¼å°±æ˜¯ç‰¹ä¾‹ã€‚

> Qï¼šèƒ½å¦ç†è§£è§£å†³ã€ŒæœåŠ¡ä¼¸ç¼©ã€é—®é¢˜çš„é‡ç‚¹æ˜¯ã€ŒæœåŠ¡å‘çŽ°ã€å’Œã€ŒçŠ¶æ€å…±äº«ã€ï¼Ÿ

Aï¼šè¿™å—çš„æ ¸å¿ƒä¾èµ–ç¨‹åºå®žçŽ°ï¼Œå¦‚æžœç¨‹åºå®žçŽ°çš„å¥½ï¼Œå°±å¯ä»¥åšåˆ°éžå¸¸å¥½çš„æ°´å¹³ä¼¸ç¼©ï¼Œæˆ‘ä»¬è‡ªå·±çš„æœ‰çŠ¶æ€æœåŠ¡ä¹Ÿæ˜¯å¯ä»¥æ°´å¹³ä¼¸ç¼©çš„ã€‚

> Q: è¯·é—®å½“æ¯ä¸ªæœåŠ¡éƒ½å¯èƒ½åŒæ—¶å­˜åœ¨å¤šä¸ªåœ¨çº¿ç‰ˆæœ¬æ—¶ï¼Œå¦‚ä½•åš ab testingï¼Ÿå¦‚ä½•æŽ§åˆ¶ä¸šåŠ¡è·¯ç”±ï¼Ÿ

Aï¼šab testing æˆ‘ä»¬å½“å‰æ²¡æœ‰å®žçŽ°ï¼Œä¸‹ä¸€æ­¥ä¼šå¼•å…¥è¿™ä¸ªç‰¹æ€§ã€‚æˆ‘ä»¬çš„è®¾è®¡æ€è·¯æ˜¯å®žçŽ°ä¸€ä¸ªæŽ§åˆ¶ç”¨æˆ·è®¿é—®è·¯ç”±çš„å¾®æœåŠ¡ï¼ŒåŒæ—¶æ”¯æŒ ab testingã€‚

> Qï¼šå“ªç§æœåŠ¡æ¨¡å¼ç”¨çš„æœ€å¤šï¼Ÿå¼‚æ­¥æ¶ˆæ¯æ¨¡å¼å—ï¼Ÿ

Aï¼šç”¨çš„æœ€å¤šçš„æ˜¯èšåˆæ¨¡å¼å’Œå¼‚æ­¥æ¶ˆæ¯æ¨¡å¼ã€‚

> Qï¼šå¾®æœåŠ¡åŽç«¯çš„æ•°æ®åº“æ˜¯å¼¹æ€§ä¼¸ç¼©çš„æ€Žä¹ˆåšçš„ï¼ŸMySQLï¼Œmongodb

Aï¼šè¦æ”¯æŒæ°´å¹³ä¼¸ç¼©ï¼Œéœ€è¦éƒ¨ç½²ä¸€ä¸ªæ”¯æŒæ°´å¹³ä¼¸ç¼©çš„æ•°æ®åº“ä¸­é—´ä»¶åšä¸ºå¾®æœåŠ¡ã€‚ åž‚ç›´ä¼¸ç¼©ï¼Œç›´æŽ¥è°ƒæ•´èµ„æºå°±å¯ä»¥äº†ï¼Œå—é™äºŽç‰©ç†æœºçš„èµ„æºå®¹é‡ã€‚

> Qï¼šä¼¸ç¼©çš„æ—¶å€™å¯¹ä¸šåŠ¡å¯ä»¥åšåˆ°å®Œå…¨é€æ˜Žå—ï¼

Aï¼šæ˜¯çš„ã€‚æˆ‘ä»¬çŽ°åœ¨çš„å®žçŽ°æ˜¯å¯¹ä¸šåŠ¡å®Œå…¨é€æ˜Žã€‚

> Qï¼šæœåŠ¡å‘çŽ°ç”¨åˆ°ä»€ä¹ˆï¼ŒConsulã€Dubboï¼Ÿ

Aï¼šè½»é‡çº§å°è£… etcdã€‚

> Qï¼šæ¯ä¸ªå¾®æœåŠ¡å¯¹åº”ä¸€ä¸ªæ•°æ®åº“ï¼Œæ€Žä¹ˆåšåˆ°æ•°æ®å…±äº«å‘¢ï¼Ÿ

Aï¼šæ¯ä¸ªå¾®æœåŠ¡åŽé¢çš„æ•°æ®åº“æ”¯æŒæœ‰çŠ¶æ€æ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯¹å¤–æ•´ä½“æ˜¯ä¸€ä¸ªä¸šåŠ¡æœåŠ¡ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡å…³ç³»æ¥æ¢³ç†æœåŠ¡ç»“æž„ã€‚å¦‚æžœæœ‰ä¸€è‡´æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨å…±äº«æ•°æ®åº“æˆ–æ¶ˆæ¯æœåŠ¡å®žçŽ°ã€‚

> Qï¼šåž‚ç›´ä¼¸ç¼©ï¼Œè°ƒæ•´èµ„æºå°±å¯ä»¥äº†ï¼Œèµ„æºéœ€æ±‚è¶…è¿‡ä¸€å°ç‰©ç†æœºå‘¢ï¼Ÿæ‹†åº“ï¼Ÿ

Aï¼šä¸‰ç§æ–¹å¼ï¼šç¬¬ä¸€ç§ï¼ŒæŠŠä¸šåŠ¡æ‹†çš„å°ï¼Œæ•°æ®åº“åˆ†åº“ã€‚ç¬¬äºŒç§ï¼Œæ•°æ®åº“ shardingã€‚ç¬¬ä¸‰ç§ï¼Œä½¿ç”¨ CQRS æ¨¡å¼ï¼Œé‡æ–°è®¾è®¡å®žçŽ°ã€‚

> Qï¼šæœåŠ¡è°ƒç”¨é“¾çš„äº‹åŠ¡æ€Žä¹ˆä¿è¯çš„ï¼Ÿ

Aï¼šå¯ä»¥é€šè¿‡å…±äº«æ•°æ®åº“ï¼Œä½¿ç”¨æ•°æ®åº“äº‹åŠ¡è§£å†³è°ƒç”¨é“¾äº‹åŠ¡é—®é¢˜ã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å¼‚æ­¥çš„æ¶ˆæ¯æœåŠ¡ï¼Œé€šè¿‡ä¿è¯æ¶ˆæ¯å¯é æ¶ˆè´¹æ¥å®žçŽ°ã€‚

> Qï¼šCQRS æ¨¡å¼çš„ ç»´æŠ¤æˆæœ¬å¾ˆé«˜å•Š æœ‰è¯„ä¼°è¿‡è¿™ç§æ”¹é€ çš„æˆæœ¬å—ï¼Ÿ

Aï¼šæœ‰æ¡†æž¶é‡ç”¨çš„ï¼Œæ¯”å¦‚ AKKAï¼Œæ€§èƒ½å¥‡é«˜ï¼Œå¼€å‘ä¹Ÿå¾ˆç®€å•ã€‚åªæ˜¯å­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡

> Qï¼šèƒ½åˆ†äº«ä¸‹å¦‚ä½•æŠŠæŽ§æä¾›å¾®æœåŠ¡çš„ç»†ç²’åº¦ï¼Œå¾®æœåŠ¡çš„èŒƒå›´å’Œè¾¹ç•Œæ€Žä¹ˆæŽ§åˆ¶ï¼Ÿ

Aï¼šä¸€å®šè¦ç»“åˆå®žé™…ä¸šåŠ¡åœºæ™¯ï¼Œè¿˜è¦çœ‹å›¢é˜Ÿæƒ…å†µï¼Œæˆ‘çš„ç»éªŒæ˜¯ï¼Œå¾®æœåŠ¡çš„ç²’åº¦å’Œå†…éƒ¨äººå‘˜ç®¡ç†å…³è”ã€‚éšç€ä¸šåŠ¡å‘å±•ï¼Œç²’åº¦ä¹Ÿéœ€è¦ä¸æ–­è°ƒæ•´çš„ã€‚è¾¹ç•Œè¦è€ƒè™‘ä¸šåŠ¡æŠ½è±¡çš„åˆç†æ€§ã€‚

---

### 2015-11-25ï¼šæ­å»ºä¼ä¸šç§æœ‰ Docker Registry å®žæˆ˜åˆ†äº«

> Qï¼šç›®å‰æœ‰æ²¡æœ‰å°åˆ°ç›‘æŽ§ Register è¿è¡Œå’Œä½¿ç”¨æƒ…å†µçš„å¥½å¤„ï¼Œæˆ–è€…åœ¨ç»´æŠ¤ç§æœ‰ Register æœ‰æ²¡æœ‰é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Ÿ

Aï¼šèƒ½å¤Ÿå®žæ—¶ç›‘æŽ§ Registryï¼Œå°±èƒ½è§‚å¯Ÿç”¨æˆ·çš„è¡Œä¸ºï¼Œå½“æˆ‘ä»¬åœ¨è´Ÿè½½é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæœ‰æ•ˆä¿æŒ Registry ç¨³å®šè¿è¡Œã€‚ç»´æŠ¤ç§æœ‰çš„ Registry çš„é—®é¢˜ï¼Œå°±æ˜¯è¦è·Ÿè¿›å®˜æ–¹çš„æ›´æ–°ï¼Œçœ‹çœ‹æ˜¯å¦ä¹Ÿéœ€è¦åŒæ­¥ã€‚

> Qï¼šRancher å®žé™…ä¸Šæ˜¯åŸºäºŽ Docker çš„å¼€æº PaaSï¼ŒåŸºäºŽå®¹å™¨æŠ€æœ¯çš„å¼€æº PaaS å¾ˆå¤šï¼Œæ¯”å¦‚ Deisã€Flynn ç­‰ï¼Œä½†æ˜¯ Rancher è·Ÿè¿™äº›é¡¹ç›®ä¸åŒçš„åœ°æ–¹æ˜¯ï¼Œå®ƒå°½å¯èƒ½çš„å’Œ Docker ç”Ÿæ€åœˆå·¥å…·å…¼å®¹ã€‚è¯·é—®å½“åˆä¸ºä»€ä¹ˆä¼šé€‰æ‹© Rancherï¼Œåœ¨ä½ çœ‹æ¥ï¼ŒRancher æœ€å¸å¼•ä½ çš„åœ°æ–¹æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šRancher çš„ UI æ¯”è¾ƒæ–¹ä¾¿äºŽä¸Šæ‰‹å’Œä½¿ç”¨ã€‚è€Œä¸” Rancher çš„æ¦‚å¿µä¹Ÿæ›´æŽ¥è¿‘ Docker composeï¼Œç›®å‰å®˜æ–¹çš„æ–‡æ¡£ä¹Ÿæ¯”è¾ƒé½å…¨ã€‚

> Qï¼šFlowdock+Hubot è¿™ç§æ–¹å¼ä¸‹çš„ç›‘æŽ§æ˜¯å¦å¿…é¡»ç”¨ Sensuï¼Œæ˜¯å¦æ”¯æŒé‡‡ç”¨ zabbix ä½œç›‘æŽ§ï¼ŒZabbix çš„è¿œç¨‹è„šæœ¬å¯ä»¥å®žçŽ°ä¸€äº›è‡ªåŠ¨é‡å¯ç­‰ç­‰æ“ä½œ?

Aï¼šSensu ä¸æ˜¯å¿…é¡»çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨ä½ ç†Ÿæ‚‰çš„ç›‘æŽ§æœåŠ¡ï¼Œæ¯”å¦‚ Zabbixã€‚

> Qï¼šFlowdock+Hubot åœ¨ä¸€äº›å®‰å…¨æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„ç”Ÿäº§çŽ¯å¢ƒä¸Šæ˜¯å¦å¯ç”¨ï¼Œå…¶å‘å¸ƒçš„å‘½ä»¤é‡‡ç”¨ä»€ä¹ˆæ–¹å¼è¿žæŽ¥åˆ°å®¹å™¨\\è™šæ‹Ÿæœºæˆ–è€…ä¸»æœºä¸Šï¼Ÿè¦ä¸è¦å»ºç«‹ SSH å…å¯†ç è¿žæŽ¥ä¹‹ç±»çš„æ“ä½œï¼Ÿ

Aï¼šHubot æ˜¯æ‹‰å– Flowdock çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ Hubot å¯ä»¥éƒ¨ç½²åœ¨å…¬å¸é˜²ç«å¢™å†…ã€‚ç›®å‰ Hubot ä½¿ç”¨ docker  remote API æ¥æŽ§åˆ¶è™šæ‹Ÿæœºä¸Šçš„å®¹å™¨ã€‚

> Qï¼šè¯·æ•™ä¸€ä¸‹ï¼ŒRancher å¯ä»¥ç†è§£ä¸º Compose çš„å¢žå¼ºç‰ˆå—ï¼Œç‰¹åˆ«æ˜¯å¯è§†åŒ–éƒ¨åˆ†ï¼Ÿ

Aï¼š Rancher è‡ªå·±æœ‰ä¸€å¥— rancher-composeï¼Œæä¾› load balance å’Œ auto scalingï¼Œå¯ä»¥ç®—æ˜¯ Compose çš„å¢žå¼ºç‰ˆã€‚å¯è§†åŒ–éƒ¨åˆ†ï¼Œæ˜¯ Rancher çš„ä¸€ä¸ª Featureã€‚

> Qï¼šRancher çš„ lb æ˜¯ç”¨çš„ HAProxy ä¹ˆï¼Ÿ

Aï¼šæ˜¯çš„ã€‚

> Qï¼šæœ‰æ²¡æœ‰åšè¿‡æ¨ªå‘æ¯”è¾ƒï¼ŒKubernetes å’Œ Swarm+Composeï¼ŒRancher+Composeï¼Œåœ¨è¿™å‡ ç§é€‰æ‹©é—´åšè¿‡æ¯”è¾ƒï¼Œæˆ–è€…è¯´ä¸ºä»€ä¹ˆæœ€ç»ˆé€‰æ‹©äº† Rancherï¼Ÿ

Aï¼šæœ€åˆæ˜¯é€‰æ‹© Swarm+Composeï¼Œä½†æ˜¯ç”±äºŽé‚£ä¸ªæ—¶å€™çš„ Swarm ä¸å¤ªç¨³å®šï¼Œæœ‰ bugï¼Œé›†ç¾¤ç®¡ç†å·¥ä½œä¸èµ·æ¥ã€‚Rancher éƒ¨ç½²æ–¹ä¾¿ï¼Œæ“ä½œç®€å•ï¼Œæ‰€ä»¥å°±ç”¨äº†å®ƒã€‚

> Qï¼šRancher çš„ç½‘ç»œå…·ä½“æ˜¯æ€Žä¹ˆåšçš„å‘¢ï¼Ÿ

Aï¼šæ®ç›®å‰äº†è§£ï¼Œæ˜¯ overlay æ¨¡å¼ã€‚å„ä¸»æœºä¹‹é—´é‡‡ç”¨ IPsec Tunneling æ¥å®žçŽ°é€šä¿¡ï¼Œä½¿ç”¨ udp çš„ 500 å’Œ 4500 ç«¯å£ã€‚å¯åŠ¨æ—¶åœ¨å„ä¸ªä¸»æœºéƒ¨ç½²å®¹å™¨ä¹‹å‰å¯åŠ¨ä¸€ä¸ª Network Agent ç®¡ç†å®¹å™¨ç½‘ç»œã€‚å…·ä½“å¯ä»¥å‚çœ‹æ–‡æ¡£ï¼šdocs.rancher.com

> Qï¼šrancher master å¦‚ä½•å®žçŽ°çš„é«˜å¯ç”¨ï¼Ÿä¹‹å‰çœ‹äº†æ–‡æ¡£æ­å»ºä¹‹åŽï¼Œcpu ç­‰ç›‘æŽ§å›¾æ— æ³•æ˜¾ç¤ºäº†

Aï¼šé€šè¿‡ rancher-compose æä¾› load balance å’Œ auto scaling å®žçŽ°é«˜å¯ç”¨ã€‚ç›‘æŽ§å›¾æ— æ³•æ˜¾ç¤ºä¹Ÿæ˜¯æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜ï¼Œç›®å‰æ­£åœ¨è§£å†³ã€‚

> Qï¼šä»Žæè¿°çœ‹ Rancher çš„ç½‘ç»œç±»ä¼¼äºŽ weave å§ï¼Œç»™æ¯ä¸ªå®¹å™¨åˆ†é…å›ºå®š IPï¼Œå¯¹é›†ç¾¤è§„æ¨¡æ¯”è¾ƒå¤§çš„æˆ–è€… IP åœ°å€æ®µå—é™çš„ä¼¼ä¹Žä¸å¤ªå¤Ÿç”¨ï¼Ÿ

Aï¼šä»Žæˆ‘ä»¬ç›®å‰çš„ç»éªŒæ¥çœ‹ï¼Œçš„ç¡®æœ‰è¿™æ ·çš„é™åˆ¶ï¼Œå¦‚æžœæœ‰å¤§è§„æ¨¡é›†ç¾¤çš„éœ€æ±‚ä¸‹ï¼Œéœ€è¦é‡æ–°è¯„ä¼° Rancher æ¥ç®¡ç†å’Œéƒ¨ç½²ã€‚

> Qï¼š Hubot æ˜¯ä¸æ˜¯ä¹Ÿæ”¯æŒéžå®¹å™¨æ–¹å¼çš„éƒ¨ç½²ï¼Œæ¯”å¦‚éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸Šï¼Ÿ

Aï¼šå¯ä»¥ï¼Œå¯ä»¥å‚ç…§ [hubot.github.com](https://hubot.github.com)ã€‚

> Qï¼šHubot ä½¿ç”¨ docker remote API æ˜¯å¦é‡‡ç”¨äº†å®‰å…¨ç­–ç•¥ï¼Œå¦å¤– Docker Registry é‡‡ç”¨äº†ä½•ç§å®‰å…¨ç­–ç•¥ï¼Ÿ

Aï¼šRemote API ä½¿ç”¨äº† TLS éªŒè¯ã€‚ç›®å‰æˆ‘ä»¬çš„ private registry ä½¿ç”¨äº† LDAP+token ä½œä¸ºå®‰å…¨è®¤è¯ã€‚

> Qï¼šåœ¨éƒ¨ç½²æ–¹é¢å¾ˆé‡è¦çš„æ˜¯åŠ¨æ€ä¼¸ç¼©å’Œç°åº¦å‘å¸ƒï¼Œåœ¨è¿™ä¸¤æ–¹é¢ä½ ä»¬æ˜¯æ€Žä¹ˆè€ƒè™‘çš„ï¼ŸRancher åœ¨è¿™ä¸¤ä¸ªæ–¹é¢æœ‰æ”¯æŒå—ï¼Ÿ

Aï¼šé€šè¿‡ rancher-compose æä¾› load balance å’Œ auto scaling å®žçŽ°åŠ¨æ€ä¼¸ç¼©ã€‚å…¶ä»–æ–¹é¢ï¼Œè¿˜æ²¡æœ‰è€ƒè™‘è¿‡ã€‚

> Qï¼šRancher çš„ç®¡ç†æ•°æ®æ˜¯ä¸æ˜¯éƒ½æ”¾åœ¨äº† MySQL é‡Œé¢ï¼ŸMySQL éœ€è¦æ­å»ºåœ¨ç‰©ç†æœºä¸Šå—ï¼Ÿ

Aï¼šMySQL æ˜¯ rancher server è‡ªå·±æä¾›çš„ï¼Œæ— éœ€æ‰‹å·¥éƒ¨ç½²ã€‚

> Qï¼šRancher èƒ½æ”¯æŒäº‘å­˜å‚¨å—ï¼Ÿ

Aï¼šæœ€æ–°ç‰ˆæœ¬çš„ Rancher å¯¹ Docker volume æ’ä»¶æœ‰äº†æ”¯æŒï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥å®žçŽ° Container çš„æ•°æ®å­˜å‚¨ç®¡ç†ã€‚

> Qï¼šè¯·é—®ä½ ä»¬å®žè·µæˆ–äº†è§£åˆ°çš„åŸºäºŽ Rancher çš„é›†ç¾¤è§„æ¨¡æœ‰å¤šå¤§ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬çš„ä½¿ç”¨è§„æ¨¡æ¯”è¾ƒå°ï¼Œè¿˜æ²¡æœ‰è¿™æ–¹é¢çš„å‡†ç¡®æ•°æ®ã€‚

> Qï¼šä»Žä»‹ç»çœ‹æ•´ä¸ªç³»ç»Ÿæ˜¯æ­å»ºåœ¨ OpenStack ä¸Šçš„ï¼Œé‡‡ç”¨ Swift ä½œä¸ºå­˜å‚¨ï¼Œé‚£ Docker çš„éƒ¨ç½²æ˜¯ä¸æ˜¯é‡‡ç”¨çš„ nova-docker å‘¢ï¼Ÿå®¹å™¨æ˜¯éƒ¨ç½²åœ¨ç‰©ç†æœºä¸Šè¿˜æ˜¯è™šæœºä¸Šçš„ï¼Œå¦‚æžœæ˜¯è™šæ‹Ÿæœºé‡‡ç”¨çš„æ˜¯å“ªç§ hypervisorï¼Œæ€§èƒ½æ–¹é¢å¦‚ä½•ï¼Œæœ‰æ²¡æœ‰åšè¿‡ç›¸å…³çš„åŽ‹æµ‹ï¼Ÿ

Aï¼šDocker æ˜¯éƒ¨ç½²åœ¨ KVM çš„è™šæ‹Ÿæœºä¸Šï¼Œä½¿ç”¨çš„ä¼ä¸šç§æœ‰äº‘å¹³å°ï¼Œç›®å‰æ²¡æœ‰åšè¿‡æ€§èƒ½æµ‹è¯•ã€‚

> Qï¼šRancher å®žé™…åº”ç”¨ä¸­æœ‰å“ªäº›è¦ç‰¹åˆ«æ³¨æ„çš„é—®é¢˜ï¼Œéº»çƒ¦åˆ†äº«ä¸‹ï¼Ÿ

Aï¼šRancher ç‰ˆæœ¬æ›´æ–°å¿«ï¼Œè¾ƒä½Žçš„ç‰ˆæœ¬ä¼šæœ‰å¾ˆå¤š bugã€‚

> Qï¼šæœ‰è€ƒè™‘è¿‡å‡çº§é—®é¢˜ä¹ˆï¼Ÿæ¯”å¦‚ Registry ä»Ž v1 å‡çº§åˆ° v2ï¼Ÿæˆ–è€… docker å‡çº§åˆ° 1.9ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„å°±æ˜¯ v2ï¼Œä½¿ç”¨ rancher upgrade æ¥å‡çº§ã€‚ å‡çº§ Docker çš„æˆæœ¬è¾ƒå¤§ï¼Œç›®å‰è¿˜æ²¡æœ‰ç›¸å…³æœ€ä½³å®žè·µã€‚

> Qï¼š Rancher ä¸­æ–‡èµ„æ–™å¤šå˜›ï¼Œæœ‰æŽ¨èå˜›ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬çœ‹çš„éƒ½æ˜¯å®˜æ–¹è‹±æ–‡æ–‡æ¡£ï¼Œè¿™æ ·èƒ½çœ‹åˆ°æœ€æ–°çš„ä¿¡æ¯ï¼Œä¸­æ–‡æ–‡æ¡£æ²¡æœ‰å…³æ³¨ã€‚

---

### 2015-11-17ï¼š æŽ¥è§¦ AWS è¿‘ 5 å¹´ï¼Œè°ˆè°ˆæˆ‘çš„è¿ç»´ç»éªŒ

> Qï¼šè¯·é—®æ‚¨è§‰å¾— AWS å’Œå›½å†…çš„äº‘åŽ‚å•†ç›¸æ¯”ï¼Œæœ€å¤§çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šä»Žå…¨çƒçš„è§’åº¦æ¥çœ‹ï¼Œæ ¹æ® Gartner Reportï¼Œæ˜¯æœ€é¢†å…ˆçš„äº‘æœåŠ¡ã€‚å¯¹äºŽåŠŸèƒ½è€Œè¨€ï¼ŒAWS çš„æœåŠ¡å¤šï¼Œè´¨é‡ä¸Šä¹˜ã€‚å¯¹äºŽä¸šåŠ¡éœ€æ±‚åœ¨æµ·å¤–çš„ï¼ŒAWS æ›´ä¸ºé‡è¦ã€‚æœ‰äº›å›½å†…çš„äº‘æœåŠ¡ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æ¨¡ä»¿ç€ AWS èµ·æ¥çš„ã€‚

> Qï¼š é˜² DDoS æž¶æž„éƒ½éœ€è¦è‡ªå·±æ­å»ºï¼ŒAWS æ²¡æœ‰æä¾›å¤–å±‚åŒ…è£…å¥½çš„æœåŠ¡ä¹ˆï¼Ÿ

Aï¼šAWS å†…ç½®çš„æœåŠ¡ä¸­å·²ç»æä¾›äº†é˜²èŒƒ DDoS çš„èƒ½åŠ›ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½å¤Ÿç”¨ï¼Œåªæ˜¯é’ˆå¯¹åº”ç”¨å±‚çš„æ”»å‡»ï¼Œéœ€è¦é¢å¤–çš„æœåŠ¡ã€‚å¦å¤–æœ‰å¾ˆå¤šå®‰å…¨åŽ‚å•†å’Œ AWS æœ‰åˆä½œï¼Œåœ¨ AWS Market å¯ä»¥å¾—åˆ°ç›¸åº”çš„å®‰å…¨æœåŠ¡ã€‚

> Qï¼šä½ ä»¬ç”¨è¿‡ ECS æœåŠ¡å—ï¼ŒåŠŸèƒ½ä¸Šèƒ½å¦æ»¡è¶³ä½ ä»¬çš„åº”ç”¨éœ€æ±‚ï¼Ÿ

Aï¼šæˆ‘ä»¬ç›®å‰æ­£åœ¨å°è¯•é‡‡ç”¨ ECS çš„æ–¹å¼æ¥éƒ¨ç½²æˆ‘ä»¬çš„æœåŠ¡ï¼Œ10 æœˆä»½çš„ reInvent å¤§ä¼šå‘å¸ƒäº† Private  Registry è¿˜æœ‰ ecs-cli ç­‰ä¸€äº›å·¥å…·ï¼Œä¼šä½¿ ECS æ›´æ˜“ä½¿ç”¨ã€‚

> Qï¼šå‰ç«¯æ”¾ä¸åŒ az è¿˜å¥½è¯´ï¼ŒåŽç«¯æ•°æ®åº“ä¸åŒ az æ€Žä¹ˆæžï¼Ÿ

Aï¼šæ•°æ®åº“å¦‚æžœæ˜¯è‡ªå·±åœ¨ EC2 ä¸Šéƒ¨ç½²çš„è¯ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨çš„ Cassandraï¼Œå¤šå°åŒæ ·å¯ä»¥é‡‡ç”¨ä¸åŒ AZï¼Œè‡³äºŽ AWS æœ¬èº«çš„æ•°æ®åº“æœåŠ¡ RDSã€Auroraã€DynamoDBï¼Œé‡Œé¢æœ‰ä¸€ä¸ª multi-AZ çš„åŠŸèƒ½ã€‚

> Qï¼šå¦å¤–ç›®å‰å¾ˆå¤šå…¬å¸éƒ½é‡‡ç”¨äº†äº‘æœåŠ¡ï¼Œå¾ˆå¤šè¿ç»´åŒå­¦æ¯”è¾ƒå…³æ³¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯ä¼šå¯¹è¿ç»´æˆå‘˜å¸¦æ¥äº†ä¸€å®šçš„å½±å“ï¼Œå› ä¸ºå¾ˆå¤šå·¥ä½œä½¿ç”¨äº‘æœåŠ¡å°±å¯ä»¥è§£å†³ã€‚ä¸€ç§è§‚ç‚¹æ˜¯ï¼Œä¸Šäº‘ï¼Œæ˜¯è¿ç»´äººå‘˜çš„ä¸€ä¸ªæœºä¼šï¼Œå› ä¸ºä½¿ç”¨äº‘æœåŠ¡åœ¨æŸä¸ªæ–¹é¢æ¥è¯´ï¼Œå¯¹è¿ç»´äººå‘˜çš„è¦æ±‚åˆæé«˜äº†ã€‚ç›®å‰ç†Ÿæ‚‰ AWS çš„è¿ç»´äººå‘˜å¹¶ä¸å¥½æ‹›ã€‚è¯·é—®ï¼Œæ‚¨æ˜¯æ€Žä¹ˆæƒ³çš„ï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ·±æœ‰ä½“ä¼šï¼ŒDocker ä¼šè¿™ä¹ˆç«ï¼Œé‡Œé¢ä¹Ÿæœ‰è¿™ä¸€å±‚å…³ç³»ã€‚

> Qï¼šè‡ªåŠ¨ä¼¸ç¼©æœåŠ¡å¯¹äºŽç”¨æˆ·è¿™è¾¹éœ€è¦åšå“ªäº›å‡†å¤‡ï¼Œå¦‚ä½•ä¿è¯ä»£ç æŒç»­æ›´æ–°ï¼Œè‡ªåŠ¨ä¼¸ç¼©ä¹Ÿæ˜¯å¯ç”¨çš„ï¼Œå°±æ˜¯æˆ‘æ€Žæ ·ä¿¡ä»»è‡ªåŠ¨æ‰©å®¹å‡ºçš„æœºå™¨ï¼Ÿ

Aï¼šä¸»è¦è¿˜å¾—è¦æ±‚æœºå™¨ä¸­çš„æœåŠ¡å®žçŽ°æ— çŠ¶æ€ï¼Œä¿¡ä»»æ˜¯å»ºç«‹åœ¨æµ‹è¯•å’Œç›‘æŽ§çš„åŸºç¡€ä¸Šã€‚ä»£ç æŒç»­æ›´æ–°æ˜¯å¦ä¸€ä¸ªé—®é¢˜ï¼ŒæŒç»­å‘å¸ƒçš„é—®é¢˜ï¼Œè¿™ä¸ªçŽ°æœ‰çš„è§£å†³æ–¹æ¡ˆä¹Ÿè›®å¤šçš„ï¼Œå¯ä»¥çº¿ä¸‹è®¨è®ºã€‚

> Qï¼šäºšé©¬é€Šäº‘çš„æ•…éšœçŽ‡å¤§æ¦‚æœ‰å¤šå°‘ï¼Œä¼ä¸šçº§åº”ç”¨çš„ä»·æ ¼æ˜¯å¦å¯ä»¥æŽ¥å—ï¼Ÿ

Aï¼šç›®å‰æ ¹æ®æˆ‘ä»¬ä½¿ç”¨çš„æœåŠ¡æ¥çœ‹ï¼Œæ•…éšœçŽ‡ä¸é«˜ï¼Œç¨³å®šæ€§å’Œè´¨é‡éƒ½è›®é«˜çš„ï¼Œå‰©ä¸‹çš„éƒ½æ˜¯ä¸€äº›å°é—®é¢˜ï¼Œ2012 å¹´çš„æ—¶å€™æ›¾æœ‰ 5 ä¸ªå¤§é—®é¢˜ï¼ˆAWS ä¸“é—¨è§£é‡ŠåŽŸå› çš„ï¼‰ã€‚å¯¹äºŽä»·æ ¼å¯èƒ½è¦å…·ä½“é—®é¢˜å…·ä½“çœ‹ï¼Œå¯¹äºŽæˆ‘ä»¬è€Œè¨€ï¼Œä¹Ÿåšä¼ä¸šçº§åº”ç”¨ï¼Œ7 ä¸ªåœ°åŒºçš„éƒ¨ç½²ï¼Œè¿˜æ˜¯èƒ½æŽ¥å—çš„ã€‚

> Qï¼šè¯·é—®æœ‰æ²¡æœ‰éƒ¨ç½²å°†ä¼ä¸šè‡ªå·±æ•°æ®ä¸­å¿ƒå’Œ AWS ä¸ŠæœåŠ¡äº’è”ï¼ŒæŽ¨èæ–¹å¼æ˜¯ï¼Ÿ

Aï¼šå…¬å¸é‡Œå…¶ä»–éƒ¨é—¨æ˜¯æœ‰çš„ï¼Œé€šè¿‡ VPN çš„æ–¹å¼æ›´å®‰å…¨ã€‚

> Qï¼šè¯·é—® ECS æ˜¯å¦åªæœ‰æä¾› CDã€COã€CI éƒ¨åˆ†æ˜¯å¦åªèƒ½æ˜¯ç”¨æˆ·è‡ªå·±å®šåˆ¶å’Œå¯¹æŽ¥ï¼Œè¿˜æœ‰é¢„è®¡ ECS ä»€ä¹ˆæ—¶å€™ä¼šåœ¨ä¸­å›½ç«™ç‚¹å‘å¸ƒå‘¢ï¼Ÿ

Aï¼šAWS æœ¬èº«æœ‰æä¾› code deployã€code pipelineã€code commit æŒç»­å‘å¸ƒçš„æœåŠ¡ï¼Œå¯ä»¥å’Œ ECS ä¸€èµ·ä½¿ç”¨ï¼Œæ–°å‘å¸ƒçš„ Private  Registry ä¹Ÿä¼šå¯¹ ECS çš„ CI/CD å¸¦æ¥å¸®åŠ©ã€‚ä¸­å›½ç«™ç‚¹çš„æƒ…å†µï¼Œä¸äº†è§£ã€‚

> Qï¼šè¯·é—®è€å¸ˆæ˜¯å¦çŸ¥é“ç›®å‰äºšé©¬é€Šåœ¨å›½å†…æ•°æ®ä¸­å¿ƒéƒ¨ç½²è¿›å±•æ€Žæ ·ï¼Ÿ

Aï¼šæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ï¼Œæ‰€ä»¥å…·ä½“çš„ç»†èŠ‚ä¸å¤ªäº†è§£ã€‚ä¼¼ä¹Žæ˜¯æœ‰é™å¼€æ”¾ï¼Œä¹‹å‰åŽ» reInvent å¼€ä¼šï¼Œæœ‰ä¸€ä¸ªä¸­å›½ä¸“åœºï¼Œå¾ˆå¤šå›½å†…çš„å…¬å¸éƒ½åœ¨ä½¿ç”¨äº†ã€‚

> Qï¼šä½ ä»¬æœ‰è€ƒè™‘è¿‡ç°åº¦å‘å¸ƒå—ï¼ŒAWS ä¸Šå¯¹æ­¤æ˜¯å¦æœ‰ç›¸åº”æ”¯æŒï¼Ÿ

Aï¼šæœ‰åœ¨ä½¿ç”¨ï¼Œç²’åº¦çŽ°åœ¨è¿˜æ¯”è¾ƒç²—ä¸€ç‚¹ã€‚ä¸€æ–¹é¢éœ€è¦ä¾é åº”ç”¨ç¨‹åºæœ¬èº«ï¼Œå¯ä»¥åšåˆ°é…ç½®ç®¡ç†ã€‚AWS çš„æ”¯æŒï¼Œè¿˜æ˜¯éœ€è¦é€šè¿‡æž¶æž„è®¾è®¡æ¥åšåˆ°ï¼Œæ¯”å¦‚ Router53 æ”¯æŒå¸¦æƒå€¼çš„ DNSï¼Œå¦å¤–è¿˜æœ‰ä»Šå¹´å‘å¸ƒçš„ API Gateway ä¹Ÿå¯ä»¥æ‹¿æ¥å¸®å¿™ã€‚

> Qï¼šç›®å‰ AWS çš„ä¸€ä¸ªè¶‹åŠ¿æ˜¯æŽ¨å¹¿åŸºäºŽäº‹ä»¶çš„æœåŠ¡ï¼Œå°±æ˜¯é€æ­¥å¼±åŒ–æœåŠ¡å™¨çš„æ¦‚å¿µï¼Œæ ¹æ®äº‹ä»¶è¿›è¡Œç›¸å…³æœåŠ¡ï¼Œè¿™ä¹Ÿæ˜¯é¢†å…ˆå…¶å®ƒäº‘åŽ‚å•†çš„ä¸€ä¸ªæ–¹é¢ï¼Œè¯·é—®é’ˆå¯¹è¿™ä¸€ç‚¹ï¼Œæ‚¨æ˜¯æ€Žä¹ˆæƒ³çš„ï¼Ÿ

Aï¼šæœ¬æ¥æˆ‘ä¹Ÿæƒ³èŠèŠ lambda è¿™ä¸ªæœåŠ¡ï¼Œè€ƒè™‘åˆ°æ—¶é—´çš„é—®é¢˜ï¼Œæ²¡æœ‰è®¨è®ºåˆ°ã€‚è¿™ç¡®å®žæ˜¯ä¸€ä¸ªè›®å¥½çš„æƒ³æ³•ã€‚æˆ‘äº†è§£çš„ä¿¡æ¯æ˜¯ï¼Œæ¬§æ´²ã€åŒ—ç¾Žæœ‰è›®å¤šçš„å…¬å¸é‡‡ç”¨äº†è¿™ç§æ— æœåŠ¡å™¨çš„æ–¹å¼ï¼ŒåŸºæœ¬ä¸Šä¸ç”¨è‡ªå·±æ¥ç®¡ç† EC2 æœºå™¨ï¼Œåšå¥½ç›‘æŽ§å°±å¯ä»¥ã€‚å¥½å¤„å°±æ˜¯å¿«ï¼Œåå¤„å°±æ˜¯å’Œ AWS è€¦åˆå¤ªç´§ã€‚

---

### 2015-11-11ï¼š ä¸€ç¯‡æ–‡ç« å¸¦ä½ äº†è§£ Cloud Native

> Qï¼šå¦‚ä½•è¾¾åˆ°åˆ†äº«è€å¸ˆè¿™ç§æŠ€æœ¯æ·±åº¦ã€å¹¿åº¦ã€ç†å¿µï¼Ÿ

Aï¼šè¿‡å¥–äº†ï¼Œè°¢è°¢ã€‚æœ‰å‡ ç‚¹å¯ä»¥å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹ï¼š1.  æŠ€æœ¯éƒ½æ˜¯æ…¢æ…¢ç§¯ç´¯è¿‡æ¥çš„ï¼Œä½ åšçš„ä¹…äº†ï¼Œè‡ªç„¶çŸ¥é“çš„å°±å¤šäº›ï¼ŒåšæŠ€æœ¯è´µåœ¨åšæŒã€‚2.  å¤šå’Œä¸€äº›å¤§ç‰›å­¦ä¹ å’Œäº¤æµå¾ˆé‡è¦ï¼Œæœ€ç›´æŽ¥çš„å°±æ˜¯å¤šå‘ä½ çš„ç›´æŽ¥é¢†å¯¼è¯·æ•™ï¼›3.  å¤šå­¦ä¹ ï¼Œæ¯å¤©åšæŒå­¦ä¹ ï¼›4.  å¹³å°å¾ˆé‡è¦ï¼Œæœ‰ä¸ªå¾ˆå¥½çš„å‘å±•å¹³å°å¯ä»¥è®©ä½ å¤šå­¦ä¹ å¾ˆå¤šå†…å®¹ã€‚

> Qï¼šå”¯å“ä¼šå±žäºŽåº·å¨å®šå¾‹ä¸­å“ªç±»å…¬å¸ï¼Œå¯¹ä¿ƒè¿› Cloud Native éƒ½ä½œäº†å“ªäº›ç»„ç»‡ç»“æž„ä¸Šçš„è°ƒæ•´ï¼Ÿ

Aï¼šä¸ºäº†æŽ¨è¡Œ Cloud Nativeï¼Œæˆ‘ä»¬æˆç«‹ä¸“é—¨çš„äº‘è®¡ç®—éƒ¨é—¨ã€‚ä½†æ˜¯ä¸ºäº†æŽ¨è¡Œäº‘ï¼Œæˆ‘ä»¬éœ€è¦å’Œå‘¨è¾¹å„ä¸ªéƒ¨é—¨æ‰“äº¤é“ã€‚æŽ¨è¡Œ IaaS è¿˜å¥½è¯´ï¼Œå› ä¸ºè¿™å—åŸºæœ¬ä¸Šæ˜¯æ ‡å‡†åŒ–çš„ä¸œä¸œï¼Œä½†æ˜¯åœ¨æŽ¨è¡Œ CIã€CD æ—¶ç¢°åˆ°å¾ˆå¤šé—®é¢˜ã€‚CIã€CD æ˜¯å’Œä¸šåŠ¡å¯†åˆ‡ç›¸å…³çš„ï¼Œè§„èŒƒçš„æŽ¨è¡Œï¼Œå¿…ç„¶ä¼šç»™å¤§å®¶å¸¦æ¥é¢å¤–çš„å·¥ä½œé‡ã€‚é’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬æ˜¯è”åˆå¤šä¸ªéƒ¨é—¨ä¸€èµ·æžï¼Œé¡¹ç›®åˆ¶è¿ä½œã€‚

> Qï¼šåœ¨å®žé™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œ12 å› å­æ˜¯å®šæ€§çš„è¿˜æ˜¯å®šé‡çš„ï¼Œå¦‚ä½•æ£€æµ‹ï¼Ÿ

Aï¼šåº”è¯¥æ˜¯å®šæ€§å’Œå®šé‡ç»“åˆæ›´ä¸ºåˆé€‚ã€‚æ¯”å¦‚ä»£ç ç»Ÿä¸€æ”¾å…¥ Git åº“ï¼Œè¿™ä¸ªæ˜¯å®šæ€§ã€‚ä½†æ˜¯ä»£ç æäº¤æ¬¡æ•°ï¼Œä»£ç åœˆå¤æ‚åº¦å¤§å°ï¼ŒCI æˆåŠŸçŽ‡ç­‰å°±æ˜¯å®šé‡çš„ã€‚

> Qï¼šé’ˆå¯¹ç§»åŠ¨ç«¯çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä½ ä»¬æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿä½ ä»¬çš„æœåŠ¡å‘çŽ°æ˜¯å¦‚ä½•åšçš„ï¼Ÿ

Aï¼šç§»åŠ¨ç«¯çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œè¿™å—äº†è§£æœ‰é™ï¼Œæš‚æ—¶æ— æ³•ç­”å¤ä½ ã€‚æœåŠ¡å‘çŽ°ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ¨¡å¼ï¼šDNS ä¼ ç»Ÿæ¨¡å¼ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯åŸºäºŽè‡ªç ” OSP å¼€æ”¾å¹³å°çš„æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘çŽ°æ¨¡å¼ã€‚

> Qï¼šç°åº¦å‘å¸ƒé‡‡ç”¨çš„ä»€ä¹ˆç­–ç•¥ï¼Œæ˜¯ AB ä¸¤ä¸ªé›†ç¾¤è½®æµæ›¿æ¢çš„æ–¹å¼å—ï¼Ÿ

Aï¼šç›®å‰æ˜¯æŒ‰æ‰¹æ¬¡åˆ†æ‰¹å‘å¸ƒçš„ï¼Œæ¯”å¦‚ 50 ä¸ªèŠ‚ç‚¹ï¼Œå…ˆå‡çº§ 1 ä¸ªï¼Œå†å‡çº§ 20ï¼Œæœ€åŽå‡çº§ 29 ä¸ªã€‚

> Qï¼šè‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯æ€Žä¹ˆåšçš„ï¼Œå°¤å…¶æ˜¯ Web åº”ç”¨çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œé‡‡ç”¨çš„ä»€ä¹ˆå·¥å…·ï¼Ÿ

Aï¼šæˆ‘çŸ¥é“çš„æœ‰ Test linkã€‚

> Qï¼šè¿™äº›äº‘ä¸Šçš„æ•°æ®åº“æ˜¯å¦‚ä½•éƒ¨ç½²çš„ï¼Œå¤„ç†çš„æ•°æ®è§„æ¨¡æœ‰å¤šå¤§ï¼Œäº‹åŠ¡åžåé‡å¤šå°‘ï¼Œæ‰©å®¹è¿™å—å¦‚ä½•å®žè·µçš„ï¼Ÿ

Aï¼šDB æœ‰ä¸“é—¨çš„éƒ¨ç½²å·¥å…·ï¼Œå¯¹äºŽè§„æ¨¡å’Œäº‹åŠ¡åžåé‡ã€æ‰©å®¹é—®é¢˜ï¼Œè¿™ä¸ªæ¯”è¾ƒæ•æ„Ÿï¼Œå¯ä»¥çº¿ä¸‹ä¸“é—¨äº¤æµã€‚

> Qï¼šè¯·é—®ï¼Œå”¯å“ä¼šç›®å‰äº‘ä¸Šç”¨çš„æ˜¯ä»€ä¹ˆæ•°æ®åº“ï¼Ÿ

Aï¼šMySQLã€MongoDBã€‚

> Qï¼šè¯·æ•™ä¸€ä¸‹ï¼ŒåŽå°æ•°æ®åº“æ˜¯å¦‚ä½•åˆ†ç¦»çš„ï¼Œæ¯”å¦‚ï¼Œæ˜¯ä¸æ˜¯å…ˆä»Žç”¨æˆ·å¾®æœåŠ¡ä¸­æ‹¿ç”¨æˆ·åˆ—è¡¨ï¼Œåœ¨ç”¨ç”¨æˆ· ID åŽ»å•†å“å¾®æœåŠ¡ä¸­åŽ»æ‹¿è¿™ä¸ªç”¨æˆ·çš„å•†å“åˆ—è¡¨ï¼Ÿ

Aï¼šåŽå° DB é“¾æŽ¥ä¿¡æ¯ä¸€èˆ¬å¯ä»¥ä½œä¸ºçŽ¯å¢ƒå˜é‡æ³¨å…¥ App ä¸­ã€‚

> Qï¼šåœ¨åŸºç¡€è®¾æ–½ä¸Šæ‚¨åŒæ—¶ä½¿ç”¨äº†è™šæ‹Ÿæœºå’Œ Dockerï¼Œè¯·é—®è¿™ä¸¤ç§åŸºç¡€è®¾æ–½æ‰¿è½½ä¸šåŠ¡ä¹Ÿä¸åŒå—ï¼Ÿ

Aï¼šè™šæ‹Ÿæœºç›®å‰æ˜¯å¼€å‘æµ‹è¯•çŽ¯å¢ƒç”¨ã€‚Docker åŽç»­ä¼šç›´æŽ¥ç”¨åœ¨ç”Ÿäº§çŽ¯å¢ƒï¼Œä¸»è¦æ˜¯æ— çŠ¶æ€ App ç”šè‡³ç¼“å­˜ã€‚å…¶å®ž VM å¤§éƒ¨åˆ†åœºæ™¯éƒ½å¯ä»¥ä½¿ç”¨ Docker ä»£æ›¿ã€‚

> Qï¼šåœ¨æœåŠ¡æ³¨å†Œå’Œå‘çŽ°çš„å›¾é‡Œ Consumers åº”è¯¥ä¸ä¼šç›´æŽ¥è¿žæŽ¥ Producer å§ï¼Œä¸€èˆ¬ä¼šé€šè¿‡ä¼ä¸šæ²»ç† esg è¿žæŽ¥ï¼Ÿ

Aï¼šProducer å’Œ Consumer ä¹‹é—´ä¸€èˆ¬è¿˜æœ‰ä¸ª LBã€‚

> Qï¼šèƒ½æŠŠé¢„å‘å¸ƒçŽ¯å¢ƒç†è§£ä¸ºé›†æˆæµ‹è¯•çŽ¯å¢ƒå—ï¼Ÿ

Aï¼šé¢„å‘å¸ƒæ˜¯ä¸Šçº¿å‰çš„ä¸€ä¸ªçŽ¯èŠ‚ï¼Œé“¾æŽ¥çš„ DB éƒ½æ˜¯çº¿ä¸ŠçœŸå®žçŽ¯å¢ƒçš„ã€‚é›†æˆæµ‹è¯•çŽ¯å¢ƒï¼Œè¿˜åœ¨é¢„å‘å¸ƒçŽ¯èŠ‚çš„å‰é¢ã€‚

> Qï¼šä½œä¸ºçŽ¯å¢ƒå˜é‡åˆ°ç»ˆç«¯ DB å®‰å…¨æ€§å¦‚ä½•ä¿è¯ï¼Œéš¾é“æ˜¯æ¯ä¸ªç”¨æˆ·ä¸€ä¸ª DBï¼Ÿ

Aï¼šä¸€èˆ¬æ˜¯åŽå° service é“¾æŽ¥ DB çš„å§ï¼Œç”¨æˆ·æ˜¯æ— æ³•æŽ¥è§¦ DB çš„ã€‚

> Qï¼šé‚£ä¸ªåŠ¨æ€æ›´æ–°é…ç½®çš„æœåŠ¡æ˜¯éœ€è¦å¯åŠ¨ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹åŽ»æ›´æ–°å—ï¼Ÿ

Aï¼šä¸€èˆ¬æ¥è¯´ï¼Œclient éƒ½ä¼šå®‰è£…ä¸€ä¸ªé…ç½® agentï¼Œå®ƒæ¥è´Ÿè´£ä»Žé…ç½® server pull é…ç½®è¿›è¡Œæ›´æ–°ã€‚

> Qï¼šæ€Žä¹ˆç†è§£ç‰ˆæœ¬æŽ§åˆ¶çš„åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œä¸»è¦æ˜¯é…ç½®çš„å“ªäº›ä¿¡æ¯ï¼Ÿ

Aï¼šæ¯”å¦‚ Nginx é…ç½®ï¼ˆç«¯å£ã€vhost ç­‰ï¼‰ã€tomcat é…ç½®ã€DB é“¾æŽ¥ä¿¡æ¯ã€ç¼“å­˜é“¾æŽ¥ä¿¡æ¯ç­‰ç­‰ã€‚

> Qï¼š12 å› å­æ˜¯å¦è¿‡äºŽä¸¥æ ¼ï¼Œå˜‰å®¾çš„è¡¨æ ¼é‡Œå…³äºŽåº”ç”¨æ— çŠ¶æ€ä¹Ÿåªæ˜¯éƒ¨åˆ†æ»¡è¶³ï¼Ÿ

Aï¼š12 å› å­ä¸»è¦é’ˆå¯¹ App çš„ï¼Œå®ƒä¸é€‚ç”¨äºŽ service å±‚é¢ï¼Œæ¯”å¦‚å¯¹äºŽ dbï¼Œmc çš„æœåŠ¡æ˜¯ä¸é€‚åˆçš„ã€‚

> Qï¼šGateway å®žçŽ°æ˜¯ä½¿ç”¨å¼€æºæ¡†æž¶ï¼ˆkongã€loopbackï¼‰è¿˜æ˜¯è‡ªå·±å®žçŽ°ï¼Ÿ

Aï¼šæ—¢å¯ä»¥è‡ªå·±å®žçŽ°ï¼ˆæ¯”å¦‚ Javaã€Nginxï¼‰ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨å¼€æºçš„ï¼Œæ¯”å¦‚ Zuulã€‚

> Qï¼šå¿…è¦æ—¶è¿›è¡Œåè®®è½¬æ¢ï¼ˆæ¯”å¦‚ Http è½¬ä¸º AMQPï¼‰ï¼Ÿ

Aï¼šæ¯”å¦‚å¤–éƒ¨æ˜¯é€šè¿‡ http rest è¯·æ±‚çš„ï¼Œæ‹¿åˆ°è¿™ä¸ªè¯·æ±‚åŽï¼ŒæŠŠå‚æ•°å°è£…ï¼Œç„¶åŽä»¥ mq çš„æ–¹å¼å‘ç»™åŽå°å…¶ä»–æœåŠ¡ã€‚

> Qï¼šå¾®æœåŠ¡ä¸€å®šæ˜¯æ— çŠ¶æ€çš„å—ï¼Ÿ

Aï¼šè¿™ä¸ªä¸ä¸€å®šçš„ã€‚

> Qï¼šèƒ½ä»‹ç» OpenStack åœ¨é¡¹ç›®ä¸­æ€Žä¹ˆå’Œ Docker ç­‰ç»“åˆä½¿ç”¨çš„å—ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬çš„ CI é‡‡ç”¨ Dockerï¼ŒDocker ç›´æŽ¥è·‘åœ¨ VMï¼ˆVM ç”± OpenStack åˆ›å»ºï¼‰ä¸Šã€‚å¯¹äºŽ OpenStack åº•å±‚å’Œ Docker å¦‚ä½•ç»“åˆï¼Œç›®å‰è¿˜åœ¨æ–¹æ¡ˆè¯„ä¼°ä¸­ã€‚

---

### 2015-11-08ï¼šç»†èŠ‚ ï½œ è°ˆè°ˆ CoreOS çš„ etcd

> Qï¼šè¯·é—®ä¸‹ etcd ç›®å‰çš„å¹¶å‘è¿žæŽ¥æ˜¯å¤šå°‘ï¼Œæ”¯æŒå¤šå°‘ç›®å½•ï¼Ÿ

Aï¼šè¿™ä¸ªè¦çœ‹ä½ è‡ªèº«çš„æœåŠ¡å™¨æƒ…å†µã€‚ç›®å‰æ¯ä¸ª watch éƒ½ä¼šå ç”¨ä¸€ä¸ª tcp èµ„æºå’Œä¸€ä¸ª go routine èµ„æºï¼Œå¤§æ¦‚è¦æ¶ˆè€— 30-40kbã€‚etcd 3 åšäº†å¾ˆå¤šä¼˜åŒ–ã€‚æ”¯æŒç›®å½•å’Œ key æ˜¯ç±»ä¼¼çš„ï¼Œç›®å‰å¯ä»¥åšåˆ° 100k å·¦å³çš„å° keyã€‚

> Qï¼šetcd æœªæ¥çš„ç‰ˆæœ¬ä¼šåƒ ZooKeeper ä¸€æ ·æ”¯æŒä¸´æ—¶èŠ‚ç‚¹å—ï¼Ÿ

Aï¼šç›®å‰ etcd æ”¯æŒ ttl keyï¼Œetcd 3 ä¼šæ”¯æŒ leaseï¼Œlease å¯ä»¥ lease åˆ°å¤š keyï¼Œlease åˆ°æœŸä¼šæŠŠæ‰€æœ‰ key è‡ªåŠ¨åˆ é™¤ã€‚ç›¸å½“äºŽ group ä¸€äº› ttl keysã€‚ZooKeeper çš„ä¸´æ—¶èŠ‚ç‚¹ä»Žæˆ‘çœ‹æ¥æ˜¯ä¸€ä¸ª broken çš„åŠŸèƒ½ã€‚

> Qï¼šetcd åœ¨å…¶ä»– OS åƒ CentOS ä¸Šæ€§èƒ½ä¼šæœ‰æŠ˜æ‰£å—ï¼Ÿ

Aï¼šetcd å¯¹ CoreOS æœ¬èº«æ²¡æœ‰ä»»ä½•ä¾èµ–ï¼Œæ‰€ä»¥ä¸ä¼šã€‚

> Qï¼šetcd 2 å’Œ ZooKeeper ç›¸æ¯”ä¼˜åŠ¿åœ¨å“ªäº›æ–¹é¢ï¼Ÿ

Aï¼šå’Œ ZooKeeper çš„è®¾è®¡ç†å¿µå’Œæ–¹å‘ä¸å¤ªä¸€æ ·ã€‚ç›®å‰ etcd ç€é‡äºŽ go stack å’Œ cloud  infra é¢†åŸŸã€‚å¾ˆå¤šä¸Šå±‚ç³»ç»Ÿä¾‹å¦‚ Kubernetesã€CloudFoundryã€Mesos ç­‰éƒ½å¯¹ç¨³å®šæ€§ã€æ‰©å±•æ€§æœ‰æ›´é«˜çš„è¦æ±‚ã€‚ç”±äºŽç†å¿µçš„ä¸åŒï¼Œå¯¼è‡´äº†å¾ˆå¤šè®¾è®¡çš„ä¸åŒã€‚æ¯”å¦‚ etcd ä¼šæ”¯æŒç¨³å®šçš„ watch è€Œä¸æ˜¯ç®€å•çš„ one  time trigger watchï¼Œå› ä¸ºå¾ˆå¤šè°ƒåº¦ç³»ç»Ÿæ˜¯éœ€è¦å¾—åˆ°å®Œæ•´åŽ†å²è®°å½•çš„ã€‚etcd æ”¯æŒ mvccï¼Œå› ä¸ºå¯èƒ½æœ‰ååŒç³»ç»Ÿéœ€è¦æ— é”æ“ä½œç­‰ç­‰ã€‚åœ¨æ€§èƒ½ä¸Šä»ŠåŽ etcd å¯èƒ½ä¹Ÿè¦åšæ›´å¤šå·¥ä½œï¼Œå› ä¸º container infra æœ‰æ›´å¤šçš„å¤§è§„æ¨¡åœºæ™¯ã€‚

> Qï¼šetcd èƒ½æ”¾åˆ° Docker é‡Œä¹ˆï¼Œæœ‰æ²¡æœ‰è¿™æ–¹é¢æ¡ˆä¾‹ï¼Ÿ

Aï¼š[coreos/etcd.md](https://github.com/coreos/etcd/blob/master/Documentation/docker_guide.md)ã€‚

> Qï¼šetcd ä¸Ž Consul æ¯”ï¼Œæœ‰ä»€ä¹ˆç‰¹è‰²å’Œå·®å¼‚ï¼Ÿ

Aï¼šConsul æ˜¯ä¸ª full stack çš„å·¥å…·ã€‚etcd åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¸€è‡´æ€§ kvã€‚æˆ‘ä»¬è®¤ä¸ºèƒ½æŠŠä¸€è‡´æ€§ kv è¿™ä»¶äº‹æƒ…å®Œæ•´çš„åšå¥½å·²ç»ä¸å®¹æ˜“äº†ã€‚ æˆ‘ä»¬å¸Œæœ›ä¸Šå±‚çš„ç³»ç»Ÿå¯ä»¥åœ¨ etcd ä¸Šæ­å»ºï¼Œè€Œä¸æ˜¯è®© etcd æœ¬èº«æœåŠ¡æœ€ç»ˆç”¨æˆ·ã€‚å¦å¤–åœ¨æŸäº›ç¨‹åº¦ä¸Šè€Œè¨€ï¼ŒConsul å¹¶ä¸ç€é‡ä¿è¯è‡ªèº«çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚HashiCorp è‡ªå·±çš„è°ƒåº¦ç³»ç»Ÿ nomad ä¹Ÿå¹¶æ²¡æœ‰é‡‡ç”¨ Consulã€‚è¿™äº›å·®åˆ«å¯¼è‡´äº†å¾ˆå¤šè®¾è®¡ã€å®žçŽ°ä¸Šçš„ä¸åŒã€‚

> Qï¼šè¯·é—® Kubernetes ä¸­ä½¿ç”¨ etcd ä¸»è¦ç”¨æ¥åšä»€ä¹ˆï¼Ÿ

Aï¼šå­˜å‚¨é‡è¦çš„é›†ç¾¤ä¿¡æ¯å’Œåšç›¸å…³ç»„å»ºä¹‹é—´çš„åè°ƒã€‚

> Qï¼šetcd åœ¨ n å°ï¼ˆn å¤§äºŽç­‰äºŽ 3ï¼‰æœºå™¨ç»„æˆçš„é›†ç¾¤ä¸‹ï¼Œæ€§èƒ½å¦‚ä½•ï¼Œæ€§èƒ½ä¼šéšæœºå™¨æ•°ä¸‹é™ä¹ˆï¼Ÿ

Aï¼šå†™æ€§èƒ½ä¼šçš„ã€‚etcd 3 åšäº†ç›¸å…³ä¼˜åŒ–ï¼Œåˆ†é…äº†ä¸€äº›å†™ loadï¼Œetcd 2 ä¸‹é™ä¸€äº›ã€‚

> Qï¼šå¤– Masters å®žæ•ˆåŽï¼Œè¦å¤šä¹…æ‰èƒ½é€‰å‡ºæ–°çš„ Masters æ¢å¤å†™ï¼Ÿ

Aï¼šå¯ä»¥æ ¹æ®æœåŠ¡çŽ¯å¢ƒè‡ªè¡Œè®¾ç½®ã€‚é»˜è®¤çš„ timeout æ˜¯ 1 ç§’ï¼Œ2 ç§’å†…å¯ä»¥é€‰å‡ºã€‚å¦‚æžœç½‘ç»œç»å¸¸ä¸ç¨³å®šï¼Œæˆ–è€…æœåŠ¡å™¨å¿™ï¼Œå¯ä»¥æé«˜åˆ° 5 ç§’ï¼Œ10 ç§’å†…é€‰å‡ºã€‚

---

### 2015-11-06ï¼šDocker 1.9 æ–°ç‰¹æ€§è§£è¯»

> Qï¼šè¯·é—® ovs å’Œ vxlan åœ¨åžåå’Œå»¶è¿Ÿæ–¹é¢æœ‰æ€§èƒ½æŸå¤±å—ï¼Œæœ‰æ— æµ‹è¯•æŒ‡æ ‡ï¼Ÿ

Aï¼šæŸå¤±è‚¯å®šæ˜¯æœ‰çš„ï¼Œä½†æ˜¯å…·ä½“çš„æŒ‡æ ‡ï¼ŒDocker æ–¹é¢æ²¡æœ‰ç»™å‡ºæµ‹è¯•ç»“æžœã€‚

> Qï¼šæœ¬åœ°åŒ–åˆ›å»º images å’‹æ ·äº†ï¼Œovs æ˜¯æœ¬åœ°åŒ–å—ï¼Œç‰©ç†ç½‘å¡éœ€è¦å¤šå°‘å¸¦å®½ï¼Ÿ

Aï¼šè¿™ä¸ªæœ¬æ¬¡æ›´æ–°æ²¡æœ‰æåˆ°ã€‚ovs çš„é…ç½®ä¼šæœ¬åœ°åŒ–ï¼Œå…·ä½“ç‰©ç†ç½‘å¡å¤šå¤§ Docker å®˜æ–¹æ²¡æœ‰ç»™å‡ºè¯´æ˜Žã€‚

> Qï¼š1.9 ä¹‹åŽå®¹å™¨çš„ç½‘ç»œæ ˆæ˜¯åœ¨å®¹å™¨å¯åŠ¨ä¹‹å‰å°±é…ç½®å¥½äº†è¿˜æ˜¯å¯åŠ¨ä¹‹åŽï¼Œä¹‹å‰ç‰ˆæœ¬çš„ Dockerï¼Œç½‘ç»œåˆå§‹åŒ–æ˜¯åœ¨å®¹å™¨å¯åŠ¨å‰è¿˜æ˜¯å¯åŠ¨åŽï¼Ÿ

Aï¼šç½‘ç»œæ ˆå¯åŠ¨ä¹‹å‰å°±ä¼šé…ç½®ï¼Œå¯åŠ¨æ—¶å€™è¿›è¡ŒåŠ è½½ã€‚ä¹‹å‰çš„ Docker ä¹Ÿæ˜¯è¿™æ ·ã€‚

> Qï¼šdockerdaemon ä¸ºè·¨ä¸»æœºç½‘ç»œå¢žåŠ äº†å“ªäº›é…ç½®é¡¹ï¼Œè·¨ä¸»æœºç½‘ç»œçš„ä¿¡æ¯å­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜å¤ªå…·ä½“äº†ï¼Œéœ€è¦ä»”ç»†çœ‹çœ‹ä»£ç æ‰çŸ¥é“ï¼Œæˆ‘åªæ˜¯å¤§æ¦‚çœ‹äº†ä¸€ä¸‹ï¼Œæ¯•ç«Ÿç½‘ç»œè¿™éƒ¨åˆ†æ›´æ–°å¤ªå¤šäº†ã€‚

> Qï¼šè¯·é—®ä»Ž 1.9 å¼€å§‹ Docker å°±æ”¯æŒ ovs äº†ä¹ˆï¼Œovs è¿˜æ˜¯éœ€è¦è‡ªè¡Œå®‰è£…å§ï¼Ÿ

Aï¼š1.9 å¼€å§‹ä½¿ç”¨ ovs å®žçŽ° networking éƒ¨åˆ†ï¼Œåº•å±‚è¿˜æ˜¯è°ƒç”¨çš„ ovsã€‚ovs éœ€è¦è‡ªå·±å®‰è£…ã€‚

> Qï¼šä¹Ÿå°±æ˜¯è¯´ä»Ž 1.9 ä»¥åŽ ovs å°±æ˜¯ç›´æŽ¥é€šè¿‡éš§é“ä½¿ç”¨ï¼Œè€Œä¸æ˜¯é€šè¿‡ route æ¥å®žçŽ°ï¼Œå¯¹ä¹ˆï¼Ÿ

Aï¼šå¯ä»¥è¿™æ ·ç†è§£ã€‚

> Qï¼šè¯·é—® volume ç‰¹æ€§çŽ°åœ¨æœ‰ç±»ä¼¼ kubernetes persist volume çš„åŠŸèƒ½å—ï¼Œå¯¹æŽ¥ç¬¬ä¸‰æ–¹å­˜å‚¨ï¼Ÿ

Aï¼šçŽ°åœ¨çš„ volume è¿˜æ˜¯å¯¹æŽ¥æœ¬åœ°æ–‡ä»¶å¤¹çš„ï¼Œæ‹¥æœ‰äº†å­å‘½ä»¤ï¼Œæ›´å¤šçš„æ˜¯æ–¹ä¾¿ä½¿ç”¨å’Œç®¡ç†ã€‚

> Qï¼š1.9 ç‰ˆæœ¬ç‰¹æ€§ï¼Œæ˜¯ä¸æ˜¯æ›´å®¹æ˜“å»ºç«‹å›ºå®š IP ç±»è™šæ‹Ÿæœºçš„å®¹å™¨ï¼Ÿ

Aï¼šæ˜¯çš„ã€‚

> Qï¼šè·¨ä¸»æœºçš„å®¹å™¨ç½‘ç»œæ˜¯ç”± Docker daemon æ¥ç»´æŠ¤çš„å—ï¼Ÿ

Aï¼šæ˜¯é€šè¿‡ daemon ç»´æŠ¤çš„ã€‚

> Qï¼šDocker1.9 çš„ CRIU æ–¹æ¡ˆç›¸å¯¹å‰å‡ ä¸ªç‰ˆæœ¬æœ‰å“ªäº›æ”¹è¿›ï¼Œæ–°ç‰ˆæœ¬ä½¿ç”¨çƒ­è¿ç§»æœ‰å“ªäº›å‘ï¼Ÿ

Aï¼šDocker è¿˜æ˜¯ä¸èƒ½çƒ­è¿ç§»ï¼ŒrunC æ‰å¯ä»¥ã€‚

> Qï¼šè·¨ä¸»æœºç½‘ç»œåŠŸèƒ½æ˜¯å…¨éƒ¨åœ¨ docker engine å®žçŽ°çš„ä¹ˆï¼Œè¿˜æ˜¯éœ€è¦ä¾èµ–å®‰è£…å¥½çš„ ovs ç›¸å…³çŽ¯å¢ƒï¼Ÿ

Aï¼šåº•å±‚è¿˜æ˜¯è°ƒç”¨ ovsã€‚

> Qï¼šå¦‚æžœå®¹å™¨é‡å¯æˆ–é‡æ–°ç”Ÿæˆå¯¹å·²ç»æž„å»ºçš„è™šæ‹Ÿç½‘ç»œæœ‰å½±å“å—ï¼Ÿ

Aï¼šæ²¡æœ‰å½±å“ã€‚

> Qï¼šD èƒ½ä¸èƒ½ç»™ä¸ª 1.9 ç½‘ç»œæ–°ç‰¹æ€§çš„å®žé™…ä½¿ç”¨çš„ä¾‹å­ï¼Ÿ

Aï¼šæˆ‘ä¸Šé¢ç»™çš„é‚£ä¸ªæ‰§è¡Œæµå¤§æ¦‚å°±å’Œå®žé™…ä½¿ç”¨çš„ä¾‹å­ç±»ä¼¼ï¼Œå°±æ˜¯åˆ›å»º Networkï¼Œç„¶åŽåˆ›å»º epï¼Œåˆ›å»ºæ²™ç›’ï¼Œå°† ep è£…å…¥æ²™ç›’ä¸­ã€‚å®žé™…ä½¿ç”¨çš„ä¾‹å­å¯ä»¥å‚è€ƒ Docker å®˜æ–¹æ–‡æ¡£ã€‚

> Qï¼šå¤šä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªå­˜å‚¨å¦‚ä½•è§£å†³åŒæ—¶å†™çš„é—®é¢˜ï¼Ÿ

Aï¼šå…¶å®žæœ¬è´¨ä¸Š Docker çš„æ•°æ®å·å°±æ˜¯ä¸€ä¸ª bindmountï¼Œå…¶å·¥ä½œåŽŸç†å’Œ Linux ä¸»æœºä¸Šçš„å…±äº«å·åŽŸç†ä¸€è‡´ã€‚

---

### 2015-11-04ï¼š è˜‘è‡è¡—åŸºäºŽ Docker çš„ç§æœ‰äº‘å®žè·µ

> Qï¼šè¯·é—®å®¹å™¨é—´çš„è´Ÿè½½å‡è¡¡æ˜¯å¦‚ä½•åšçš„ï¼Ÿ

Aï¼šå®¹å™¨é—´çš„è´Ÿè½½å‡è¡¡ï¼Œæ›´å¤šæ˜¯ PaaS å’Œ SaaS å±‚é¢çš„ã€‚æˆ‘ä»¬çš„ P å±‚æ”¯æŒ 4 å±‚å’Œ 7 å±‚çš„åŠ¨æ€è·¯ç”±ï¼Œé€šè¿‡åŸŸåçš„æ–¹å¼ï¼Œæˆ–è€…åå­—æœåŠ¡æ¥æš´éœ²å‡ºå¯¹å¤–çš„æŽ¥å£ã€‚æˆ‘ä»¬èƒ½å¤Ÿåšåˆ°åŸºäºŽå®¹å™¨çš„ç°åº¦å‡çº§ï¼Œå’Œå¼¹æ€§ä¼¸ç¼©ã€‚

> Qï¼šè¯·é—®ä½ ä»¬çš„ OpenStack æ˜¯è¿è¡Œåœ¨ CentOS 6.5 ä¸Šçš„å—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œä½†æ˜¯æˆ‘ä»¬é’ˆå¯¹ OpenStack å’Œ Docker ä¾èµ–çš„åŒ…è¿›è¡Œäº†å‡çº§ã€‚æˆ‘ä»¬ç»´æŠ¤äº†å†…éƒ¨çš„ yum æºã€‚

> Qï¼šè¯·é—®å®¹å™¨ IP æ˜¯é™æ€ç¼–æŽ’è¿˜æ˜¯åŠ¨æ€èŽ·å–çš„ï¼Ÿ

Aï¼šè¿™ä¸ªè·Ÿè¿ç»´æ‰€ç®¡ç†çš„ç½‘ç»œæ¨¡å¼æœ‰å…³ï¼Œæˆ‘ä»¬å†…éƒ¨çš„ç½‘ç»œæ²¡æœ‰ DHCP æœåŠ¡ï¼Œå› æ­¤å¯¹äºŽ IaaS å±‚ï¼Œå®¹å™¨çš„ IP æ˜¯é™æ€åˆ†é…çš„ã€‚å¯¹äºŽ PaaS å±‚æ¥è¯´ï¼Œå¦‚æžœæœ‰ DHCP æœåŠ¡ï¼Œå®¹å™¨çš„ App æ‰€æš´éœ²å‡ºæ¥ IP å’Œç«¯å£å°±å¯ä»¥åšåˆ°åŠ¨æ€çš„ã€‚

> Qï¼šè¯·é—®ä½ ä»¬å½“æ—¶éƒ¨ç½²çš„æ—¶å€™æœ‰æ²¡æœ‰å°è¯•è¿‡ç”¨ Ubuntuï¼Œæœ‰æ²¡æœ‰ç ”ç©¶è¿‡ä¸¤ä¸ªç³»ç»Ÿé—´çš„åŒºåˆ«ï¼Œå¦å¤–è¯·é—®ä½ ä»¬åœ¨ OpenStack ä¸Šæ˜¯æ€Žæ ·å¯¹è¿™äº›è™šæ‹Ÿæœºç›‘æŽ§çš„ï¼Ÿ

Aï¼šå½“ç„¶ï¼Œå®¹å™¨çš„æ•°æ®æ˜¯éœ€è¦ä»Ž cgroups é‡Œæ¥å–ï¼Œè¿™éƒ¨åˆ†æå–æ•°æ®çš„å·¥ä½œï¼Œæ˜¯æˆ‘ä»¬æ¥å®žçŽ°çš„ã€‚

> Qï¼šå®¹å™¨é—´çš„ç½‘ç»œé€‰åž‹æœ‰ä»€ä¹ˆå»ºè®®ï¼Œæ®è¯´é‡‡ç”¨è™šæ‹Ÿç½‘å¡æ¯”ç‰©ç†ç½‘å¡æœ‰ä¸å°çš„æ€§èƒ½æŸå¤±ï¼ŒDocker è‡ªå¸¦çš„ weaves å’Œ ovs èƒ½èƒœä»»å—ï¼Ÿ

Aï¼šå®¹å™¨çš„ç½‘ç»œä¸å»ºè®®ç”¨é»˜è®¤çš„ NAT æ–¹å¼ï¼Œå› ä¸º NAT ä¼šé€ æˆä¸€å®šçš„æ€§èƒ½æŸå¤±ã€‚ä¹‹å‰æˆ‘çš„åˆ†äº«ä¸­æåˆ°è¿‡ï¼Œä¸éœ€è¦å¯åŠ¨ iptablesï¼ŒDocker çš„æ€§èƒ½æŽ¥è¿‘ç‰©ç†æœºçš„ 95%ã€‚Docker çš„ weaves åº•å±‚åº”è¯¥è¿˜æ˜¯é‡‡ç”¨äº†ç½‘æ¡¥æˆ–è€… OpenvSwitchã€‚å»ºè®®å¯ä»¥çœ‹ä¸€ä¸‹ nova-docker çš„æºç ï¼Œè¿™æ ·ä¼šæ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚

> Qï¼šé™æ€ IP é€šè¿‡ LXC å®žçŽ°çš„å—ï¼Ÿ

Aï¼šé™æ€ IP çš„å®žçŽ°æ˜¯åœ¨ nova-docker çš„ novadocker/virt/docker/vifs.py ä¸­å®žçŽ°çš„ã€‚å®žçŽ°çš„åŽŸç†å°±æ˜¯é€šè¿‡ ip å‘½ä»¤æ·»åŠ  veth  pairï¼Œç„¶åŽç”¨ ip link set/ip netns exec ç­‰ä¸€ç³»åˆ—å‘½ä»¤æ¥å®žçŽ°çš„ï¼Œè®¾ç½®çš„åŽŸç†å’Œ weaves ç±»ä¼¼ã€‚

> Qï¼šå®¹å™¨å†…çš„è¿›ç¨‹ gdb ä½ ä»¬æ€Žä¹ˆå¼„çš„ï¼ŒæŠŠ gdb æ‰“åŒ…åˆ°å®¹å™¨å†…å—ï¼Ÿ

Aï¼š å®¹å™¨å†…çš„ gdb ä¸ä¼šæœ‰é—®é¢˜çš„ï¼Œå¯ä»¥ç›´æŽ¥ `yum install gdb`ã€‚

> Qï¼šå…±äº«å­˜å‚¨èƒ½ç›´æŽ¥ mount åˆ°å®¹å™¨é‡Œå—ï¼Ÿ

Aï¼š è™½ç„¶æ²¡è¯•è¿‡ï¼Œä½†è¿™ä¸ªé€šè¿‡ docker -v çš„æ–¹å¼åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚

> Qï¼šä¸å¯åŠ¨ Docker Daemon çš„æƒ…å†µä¸‹ï¼Œç¦»çº¿æ¢å¤ Docker ä¸­çš„æ•°æ®æ˜¯å’‹åšåˆ°çš„ï¼Ÿ

Aï¼š ç¦»çº¿æ¢å¤çš„åŽŸç†æ˜¯ç”¨ dmsetup create å‘½ä»¤åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ dm è®¾å¤‡ï¼Œæ˜ å°„åˆ° Docker å®žä¾‹æ‰€ç”¨çš„ dm è®¾å¤‡å·ï¼Œé€šè¿‡ mount è¿™ä¸ªä¸´æ—¶è®¾å¤‡ï¼Œå°±å¯ä»¥æ¢å¤å‡ºåŽŸæ¥çš„æ•°æ®ã€‚

> Qï¼šDocker çš„è·¨ç‰©ç†æœºå†·è¿ç§»ï¼Œæ”¯æŒåŠ¨æ€çš„ CPU æ‰©å®¹ï¼ç¼©å®¹ï¼Œç½‘ç»œ IO ç£ç›˜ IO çš„é™é€Ÿï¼Œæ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Œèƒ½å…·ä½“è¯´è¯´å—ï¼Ÿ

Aï¼šDocker çš„å†·è¿ç§»æ˜¯é€šè¿‡ä¿®æ”¹ nova-dockerï¼Œæ¥å®žçŽ° OpenStack è¿ç§»çš„æŽ¥å£ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨ä¸¤å°ç‰©ç†æœºé—´é€šè¿‡ docker commitï¼Œdocker push åˆ°å†…éƒ¨çš„ registryï¼Œç„¶åŽ docker pull snapshot æ¥å®Œæˆçš„ã€‚åŠ¨æ€çš„ CPU æ‰©å®¹ï¼ç¼©å®¹ï¼Œç½‘ç»œ IO ç£ç›˜ IO çš„é™é€Ÿä¸»è¦æ˜¯é€šè¿‡ novadocker æ¥ä¿®æ”¹ cgroups ä¸­çš„ cpusetã€iopsã€bps è¿˜æœ‰ TC çš„å‚æ•°æ¥å®žçŽ°çš„ã€‚

> Qï¼šè¯·é—®ä½ ä»¬æœªæ¥ä¼šä¸ä¼šè€ƒè™‘ä½¿ç”¨ Magnum é¡¹ç›®ï¼Œè¿˜æ˜¯ä¼šé€‰æ‹© Swarmï¼Ÿ

Aï¼šè¿™äº›éƒ½æ˜¯æˆ‘ä»¬å¤‡é€‰çš„æ–¹æ¡ˆï¼Œå¯èƒ½ä¼šè€ƒè™‘ Swarmã€‚å› ä¸º Magnum åº•å±‚è¿˜æ˜¯è°ƒç”¨äº† Kubernetes è¿™æ ·çš„é›†ç¾¤ç®¡ç†æ–¹æ¡ˆï¼Œä¸Žå…¶ç”¨ Magnumï¼Œä¸å¦‚ç›´æŽ¥é€‰æ‹© Swarm æˆ–è€…æ˜¯ Kubernetesã€‚å½“ç„¶ï¼Œè¿™åªæ˜¯æˆ‘ä¸ªäººçš„çœ‹æ³•ã€‚

> Qï¼šä½ ä»¬çš„ä¸šåŠ¡æ˜¯åŸºäºŽåŒä¸€ä¸ªé•œåƒä¹ˆï¼Œå¦‚æžœæ˜¯ä¸åŒçš„é•œåƒï¼Œé‚£ä¹ˆè®¡ç®—èŠ‚ç‚¹å¦‚ä½•ä¿è¯å®¹å™¨èƒ½å¤Ÿå¿«é€Ÿå¯åŠ¨ï¼Ÿ

Aï¼šè¿ç»´ä¼šç»´æŠ¤ä¸€å¥—ç»Ÿä¸€çš„åŸºç¡€é•œåƒã€‚å…¶ä»–ä¸šåŠ¡çš„é•œåƒä¼šåŸºäºŽè¿™ä¸ªé•œåƒæ¥åˆ¶ä½œã€‚æˆ‘ä»¬åœ¨åˆå§‹åŒ–è®¡ç®—èŠ‚ç‚¹çš„æ—¶å€™å°±ä¼šé€šè¿‡ docker pull æŠŠåŸºç¡€é•œåƒæ‹‰åˆ°æœ¬åœ°ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šå…¬å¸é€šç”¨çš„åšæ³•ï¼Œæ®æˆ‘äº†è§£ï¼Œè…¾è®¯ã€360 éƒ½æ˜¯ç±»ä¼¼çš„åšæ³•ã€‚

> Qï¼šåšçƒ­è¿ç§»ï¼Œæœ‰æ²¡æœ‰è€ƒè™‘ç»§ç»­ä½¿ç”¨ä¼ ç»Ÿå…±äº«å­˜å‚¨çš„æ¥åšï¼Ÿ

Aï¼šåˆ†å¸ƒå¼å­˜å‚¨å’Œå…±äº«å­˜å‚¨éƒ½åœ¨è€ƒè™‘èŒƒå›´å†…ï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥ï¼Œå°±è®¡åˆ’åšå®¹å™¨çš„çƒ­è¿ç§»ã€‚

> Qï¼šè¯·é—®ä½ ä»¬æ˜¯ç›´æŽ¥å°†å…¬ç½‘ IP ç»‘å®šåˆ°å®¹å™¨å—ï¼Œè¿˜æ˜¯é€šè¿‡å…¶ä»–æ–¹å¼æ˜ å°„åˆ°å®¹å™¨çš„ç§æœ‰ IPï¼Œå¦‚æžœæ˜¯æ˜ å°„å¦‚ä½•è§£å†³åŽŸæœ¬äºŒå±‚çš„ VLAN éš”ç¦»ï¼Ÿ

Aï¼šå› ä¸ºæˆ‘ä»¬æ˜¯ç§æœ‰äº‘ï¼Œä¸æ¶‰åŠ floating ip çš„é—®é¢˜ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¤ä¸ºæ˜¯å…¬ç½‘ IPã€‚VLAN çš„äºŒå±‚éš”ç¦»å®Œå…¨å¯ä»¥åœ¨äº¤æ¢æœºä¸Šä½œã€‚æˆ‘ä»¬ç”¨ Open vSwitch åˆ’åˆ†ä¸åŒçš„ VLANï¼Œå°±å®žçŽ°äº† Docker å®¹å™¨å’Œç‰©ç†æœºçš„ç½‘ç»œéš”ç¦»ã€‚

> Qï¼šDevice mapper dm-thin discard é—®é¢˜èƒ½è¯´çš„è¯¦ç»†äº›å—ï¼Ÿ

Aï¼š4 æœˆä»½çš„æ—¶å€™ï¼Œæœ‰ä¸¤å°å®¿ä¸»æœºç»å¸¸æ— æ•…é‡å¯ã€‚é¦–å…ˆæƒ³åˆ°çš„æ˜¯æŸ¥çœ‹/var/log/messages æ—¥å¿—ï¼Œä½†æ˜¯åœ¨é‡å¯æ—¶é—´ç‚¹é™„è¿‘æ²¡æœ‰æ‰¾åˆ°ä¸Žé‡å¯ç›¸å…³çš„ä¿¡æ¯ã€‚è€ŒåŽåœ¨/var/crash ç›®å½•ä¸‹ï¼Œæ‰¾åˆ°äº†å†…æ ¸ crash çš„æ—¥å¿— vmcore-dmesg.txtã€‚æ—¥å¿—çš„ç”Ÿæˆæ—¶é—´ä¸Žå®¿ä¸»æœºé‡å¯æ—¶é—´ä¸€è‡´ï¼Œå¯ä»¥è¯´æ˜Žå®¿ä¸»æœºæ˜¯å‘ç”Ÿäº† kernel crash ç„¶åŽå¯¼è‡´çš„è‡ªåŠ¨é‡å¯ã€‚"kernel BUG at drivers/md/persistent-data/dm-btree-remove.c:181!"ã€‚ä»Žå †æ ˆå¯ä»¥çœ‹å‡ºåœ¨åš dm-thin çš„ discard æ“ä½œï¼ˆprocessprepared discardï¼‰ï¼Œè™½ç„¶ä¸çŸ¥é“å¼•èµ· bug çš„æ ¹æœ¬åŽŸå› ï¼Œä½†æ˜¯ç›´æŽ¥åŽŸå› æ˜¯ discard æ“ä½œå¼•å‘çš„ï¼Œå¯ä»¥å…³é—­ discard support æ¥è§„é¿ã€‚åœ¨ä»Šå¹´ CNUTCon çš„å¤§ä¼šä¸Šï¼Œè…¾è®¯å’Œå¤§ä¼—ç‚¹è¯„åœ¨åˆ†äº«ä»–ä»¬ä½¿ç”¨ Docker çš„æ—¶å€™ä¹Ÿæåˆ°äº†è¿™ä¸ª crashï¼Œä»–ä»¬çš„è§£å†³æ–¹æ³•å’Œæˆ‘ä»¬å®Œå…¨ä¸€æ ·ã€‚

> Qï¼šé˜ˆå€¼ç›‘æŽ§å’Œå‘Šè­¦é‚£å—ï¼Œæœ‰é«˜ä¸­ä½Žå¤šç§çº§åˆ«çš„å‘Šè­¦å—ï¼Œå¦‚æžœå½“å‰å‡ºçŽ°ä½Žçº§å‘Šè­¦ï¼Œæ˜¯å¦ä¼šé‡‡å–ä¸€äº›é™åˆ¶ç”¨æˆ·æŽ¥å…¥æˆ–è€…ç æŽ‰å½“å‰ç”¨æˆ·æ­£åœ¨ä½¿ç”¨çš„ä¸šåŠ¡ï¼Œè¿˜æ˜¯ä»»ç”±äº‹æ€å‘å±•ï¼Ÿ

Aï¼šå‘Šè­¦è¿™å—ï¼Œè¿ç»´æœ‰ä¸“é—¨çš„ PE è´Ÿè´£çº¿ä¸Šä¸šåŠ¡çš„ç¨³å®šæ€§ã€‚å½“å‡ºçŽ°å‘Šè­¦æ—¶ï¼Œä¸šåŠ¡æ–¹å’Œ PE ä¼šåŒæ—¶æ”¶åˆ°å‘Šè­¦ä¿¡æ¯ã€‚å¦‚æžœæ˜¯å½±å“å•ä¸ªè™šæ‹Ÿæœºçš„ï¼ŒPE ä¼šå‘ŠçŸ¥ä¸šåŠ¡æ–¹ï¼Œå¦‚æžœä¸¥é‡çš„ï¼Œç”šè‡³å¯ä»¥åŠæ—¶ä¸‹æŽ‰ä¸šåŠ¡ã€‚æˆ‘ä»¬ä¼šå’Œ PE åˆä½œï¼Œè®©ä¸šåŠ¡æ–¹åŠæ—¶å°†ä¸šåŠ¡è¿ç§»èµ°ã€‚

> Qï¼šä½ ä»¬è‡ªç ”çš„ container tools æœ‰æ²¡æœ‰å¼€æºï¼ŒGitHub ä¸Šæœ‰æ²¡æœ‰ä½ ä»¬çš„ä»£ç ï¼Œå¦‚ä½•è¿˜æ²¡å¼€æºï¼ŒåŽæœŸæœ‰æœ›å¼€æºå—ï¼Œå…³äºŽç›‘æŽ§å®¹å™¨çš„ç»†ç²’åº¦ï¼Œä½ ä»¬æ˜¯å¦‚ä½•è€ƒè™‘çš„ï¼Ÿ

Aï¼šè™½ç„¶æˆ‘ä»¬ç›®å‰è¿˜æ²¡æœ‰å¼€æºï¼Œå•æˆ‘è§‰å¾—å¼€æºå‡ºæ¥çš„æ˜¯å®Œå…¨æ²¡é—®é¢˜çš„ï¼Œè¯·å¤§å®¶ç­‰æˆ‘ä»¬çš„å¥½æ¶ˆæ¯ã€‚å…³äºŽç›‘æŽ§å®¹å™¨çš„ç»†ç²’åº¦ï¼Œä¸»è¦æƒ³æ³•æ˜¯åœ¨å®¿ä¸»æœºå±‚é¢æ¥ç›‘æŽ§å®¹å™¨çš„å¥åº·çŠ¶æ€ï¼Œè€Œå®¹å™¨å†…éƒ¨çš„ç›‘æŽ§ï¼Œæ˜¯ç”±ä¸šåŠ¡æ–¹æ¥åšçš„ã€‚

> Qï¼šè¯·é—®å®¹å™¨çš„ layer æœ‰å…³å¿ƒè¿‡å±‚æ•°ä¹ˆï¼Œåº•å±‚çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ ext4 ä¹ˆï¼Œæœ‰ä¼˜åŒ–ç­–ç•¥ä¹ˆï¼Ÿ

Aï¼šå½“ç„¶æœ‰å…³å¿ƒï¼Œæˆ‘ä»¬é€šè¿‡åˆå¹¶é•œåƒå±‚æ¬¡æ¥ä¼˜åŒ– docker pull é•œåƒçš„æ—¶é—´ã€‚åœ¨ docker pull æ—¶ï¼Œæ¯ä¸€å±‚æ ¡éªŒçš„è€—æ—¶å¾ˆé•¿ï¼Œé€šè¿‡å‡å°å±‚æ•°ï¼Œä¸ä»…å¤§å°å˜å°ï¼Œdocker pull æ—¶é—´ä¹Ÿå¤§å¹…ç¼©çŸ­ã€‚

> Qï¼šå®¹å™¨çš„ memcg æ— æ³•å›žæ”¶ slab cacheï¼Œä¹Ÿä¸å¯¹ dirty cache é‡è¿›è¡Œé™åˆ¶ï¼Œæ›´å®¹æ˜“å‘ç”Ÿ OOM é—®é¢˜ã€‚è¿™ä¸ªç¼“å­˜é—®é¢˜ä½ ä»¬æ˜¯æ€Žä¹ˆå¤„ç†çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬æ ¹æ®å®žé™…çš„ç»éªŒå€¼ï¼ŒæŠŠä¸€éƒ¨åˆ†çš„ cache å½“åš used å†…å­˜æ¥è®¡ç®—ï¼Œå°½é‡é€¼è¿‘çœŸå®žçš„ä½¿ç”¨å€¼ã€‚å¦å¤–é’ˆå¯¹å®¹å™¨ï¼Œå†…å­˜æŠ¥è­¦é˜ˆå€¼é€‚å½“è°ƒä½Žã€‚åŒæ—¶æ·»åŠ å®¹å™¨ OOM çš„å‘Šè­¦ã€‚å¦‚æžœå‡çº§åˆ° CentOS 7ï¼Œè¿˜å¯ä»¥é…ç½® kmem.limit\_in\_bytes æ¥åšä¸€å®šçš„é™åˆ¶ã€‚

> Qï¼šèƒ½è¯¦ç»†ä»‹ç»ä¸‹ä½ ä»¬å®¹å™¨ç½‘ç»œçš„éš”ç¦»ï¼Ÿ

Aï¼šè®¿é—®éš”ç¦»ï¼Œç›®å‰äºŒå±‚éš”ç¦»æˆ‘ä»¬ä¸»è¦ç”¨ VLANï¼ŒåŽé¢ä¹Ÿä¼šè€ƒè™‘ VXLAN åšéš”ç¦»ã€‚ç½‘ç»œæµæŽ§ï¼Œæˆ‘ä»¬æ˜¯å°±æ˜¯ä½¿ç”¨ OVS è‡ªå¸¦çš„åŸºäºŽ port çš„ QoSï¼Œåº•å±‚ç”¨çš„è¿˜æ˜¯ TCï¼ŒåŽé¢è¿˜ä¼šè€ƒè™‘åŸºäºŽ flow çš„æµæŽ§ã€‚

> Qï¼šè¯·é—®ä½ ä»¬è¿™ä¸€å¥—éƒ½æ˜¯ç”¨çš„ CentOS6.5 å—ï¼Œè¿™æ ·æŠ€æœ¯çš„å®žçŽ°ã€‚æ˜¯è¿ç»´è¿˜æ˜¯å¼€å‘å‚ä¸Žçš„å¤šï¼Ÿ

Aï¼šç”Ÿäº§çŽ¯å¢ƒä¸Šç¨³å®šæ€§æ˜¯ç¬¬ä¸€ä½çš„ã€‚CentOS6.5 ä¸»è¦æ˜¯è¿ç»´è´Ÿè´£å…¨å…¬å¸çš„ç»Ÿä¸€ç»´æŠ¤ã€‚æˆ‘ä»¬ä¼šç»™è¿ç»´åœ¨å¤§ç‰ˆæœ¬å‡çº§æ—¶æå»ºè®®ã€‚åŒæ—¶åšå¥½è™šæ‹ŸåŒ–æœ¬èº«çš„ç¨³å®šæ€§å·¥ä½œã€‚

> Qï¼šè¯·é—®å®¹å™¨å’Œå®¹å™¨ç›´æŽ¥æ˜¯æ€Žä¹ˆé€šä¿¡çš„?ç½‘ç»œæ€Žä¹ˆè®¾ç½®ï¼Ÿ

Aï¼šä½ æ˜¯æŒ‡åŒä¸€å°ç‰©ç†æœºä¸Šçš„å—ï¼Ÿæˆ‘ä»¬ç›®å‰è¿˜æ˜¯é€šè¿‡ IP æ–¹å¼æ¥è¿›è¡Œé€šä¿¡ã€‚å…·ä½“çš„ç½‘ç»œå¯ä»¥é‡‡ç”¨ç½‘æ¡¥æ¨¡å¼ï¼Œæˆ–è€… VLAN æ¨¡å¼ã€‚æˆ‘ä»¬ç”¨ Open vSwitch æ”¯æŒ VLAN æ¨¡å¼ï¼Œå¯ä»¥åšåˆ°å®¹å™¨é—´çš„éš”ç¦»æˆ–è€…é€šä¿¡ã€‚

> Qï¼šä½ ä»¬æ˜¯ä½¿ç”¨ nova-api çš„æ–¹å¼é›†æˆ Dcoker å—ï¼ŒDocker çš„é«˜çº§ç‰¹æ€§æ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼Œå¦‚ docker-apiï¼Œå¦å¤–ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ Heat é›†æˆ Dockerï¼Ÿ

Aï¼šæˆ‘ä»¬æ˜¯ç”¨ nova-docker è¿™ä¸ªå¼€æºè½¯ä»¶å®žçŽ°çš„ï¼Œnova-docker æ˜¯ StackForge ä¸Šä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå®ƒåšä¸º nova çš„ä¸€ä¸ªæ’ä»¶ï¼Œæ›¿æ¢äº†å·²æœ‰çš„ libvirtï¼Œé€šè¿‡è°ƒç”¨ Docker çš„ RESTful æŽ¥å£æ¥æŽ§åˆ¶å®¹å™¨çš„å¯åœç­‰åŠ¨ä½œã€‚ä½¿ç”¨ Heat è¿˜æ˜¯ NOVA æ¥é›†æˆ Docker ä¸šç•Œç¡®å®žä¸€ç›´å­˜åœ¨äº‰è®®çš„ï¼Œæˆ‘ä»¬æ›´å¤šçš„æ˜¯è€ƒè™‘æˆ‘ä»¬è‡ªèº«æƒ³è§£å†³çš„é—®é¢˜ã€‚Heat æœ¬èº«ä¾èµ–çš„å…³ç³»è¾ƒä¸ºå¤æ‚ï¼Œå…¶å®žä¸šç•Œç”¨çš„ä¹Ÿå¹¶ä¸å¤šï¼Œå¦åˆ™ç¤¾åŒºå°±ä¸ä¼šæŽ¨å‡º Magnum äº†ã€‚

> Qï¼šç›®å‰ä½ ä»¬æœ‰æ²¡æœ‰å®¹å™¨è·¨ DC çš„å®žè·µæˆ–ç±»ä¼¼çš„æ–¹å‘ï¼Ÿ

Aï¼šæˆ‘ä»¬å·²ç»åœ¨å¤šä¸ªæœºæˆ¿éƒ¨ç½²äº†å¤šå¥—é›†ç¾¤ï¼Œæ¯ä¸ªæœºæˆ¿æœ‰ä¸€å¥—ç‹¬ç«‹çš„é›†ç¾¤ï¼Œåœ¨æ­¤ä¹‹ä¸Šï¼Œæˆ‘ä»¬å¼€å‘äº†è‡ªå·±çš„ç®¡ç†å¹³å°ï¼Œèƒ½å¤Ÿå®žçŽ°å¯¹å¤šé›†ç¾¤çš„ç»Ÿä¸€ç®¡ç†ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬æ­å»ºäº† Docker Registry V1ï¼Œå†…éƒ¨å‡†å¤‡å‡çº§åˆ° Docker Registry V2ï¼Œèƒ½å¤Ÿå®žçŽ° Docker é•œåƒçš„è·¨ DC mirror åŠŸèƒ½ã€‚

> Qï¼šæˆ‘çŽ°åœ¨ä¹Ÿåœ¨æŽ¨è¿› Docker çš„æŒç»­é›†æˆä¸Žé›†ç¾¤ç®¡ç†ï¼Œä½†å‘çŽ°å®¹å™¨å¤šäº†ç®¡ç†ä¹Ÿæ˜¯ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚å®¹å™¨çš„å¼¹æ€§ç®¡ç†ä¸Žèµ„æºç›‘æŽ§ï¼ŒKubernetesã€Mesos å“ªä¸ªæ¯”è¾ƒå¥½ä¸€äº›ï¼Œå¦‚æžœç”¨åœ¨ä¸šåŠ¡ä¸Šï¼Œé‚£å¯¹å¤–çš„åŸŸåè§£æžå¦‚ä½•åšå‘¢ï¼Œå› ä¸ºéƒ½æ˜¯é€šè¿‡å®¿ä¸»æœºæ¥é€šä¿¡ï¼Œè€Œå®ƒåªæœ‰ä¸€ä¸ªå¯¹å¤– IPï¼Ÿ

Aï¼šå¯¹äºŽ Kubernetes å’Œ Mesos æˆ‘ä»¬è¿˜åœ¨é¢„ç ”é˜¶æ®µï¼Œæˆ‘ä»¬ç›®å‰çš„ P å±‚è°ƒåº¦æ˜¯è‡ªç ”çš„ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ etcd æ¥ç»´æŠ¤å®žä¾‹çš„çŠ¶æ€ï¼Œç«¯å£ç­‰ä¿¡æ¯ã€‚å¯¹äºŽ 7 å±‚çš„å¯ä»¥é€šè¿‡ Nginx æ¥è§£æžï¼Œå¯¹äºŽ 4 å±‚ï¼Œéœ€è¦ä¾èµ–äºŽ naming æœåŠ¡ã€‚æˆ‘ä»¬å†…éƒ¨æœ‰è‡ªç ”çš„ naming æœåŠ¡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è§£å†³è¿™äº›é—®é¢˜ã€‚å¯¹å¤–è™½ç„¶åªæœ‰ä¸€ä¸ª IPï¼Œä½†æ˜¯æš´éœ²çš„ç«¯å£æ˜¯ä¸åŒçš„ã€‚

> Qï¼šä½ ä»¬æœ‰è€ƒè™‘ä½¿ç”¨ Hyper Hypernetes å—ï¼Ÿå®žçŽ°å®¹å™¨ä¸Žå®¿ä¸»æœºå†…æ ¸éš”ç¦»åŒæ—¶ä¿è¯å¯åŠ¨é€Ÿåº¦?

Aï¼šHyper æˆ‘ä»¬ä¸€ç›´åœ¨å…³æ³¨ï¼ŒHyper æ˜¯ä¸ªå¾ˆä¸é”™çš„æƒ³æ³•ï¼Œæœªæ¥ä¹Ÿä¸æŽ’é™¤ä¼šä½¿ç”¨ Hyperã€‚å…¶å®žæˆ‘ä»¬æœ€å¸Œæœ› Hyper å®žçŽ°çš„æ˜¯çƒ­è¿ç§»ï¼Œè¿™æ˜¯ç›®å‰ Docker è¿˜åšä¸åˆ°çš„ã€‚

> Qï¼šä½ ä»¬å®¿ä¸»æœºä¸€èˆ¬ç”¨çš„ä»€ä¹ˆé…ç½®ï¼Ÿç‹¬ç«‹ä¸»æœºè¿˜æ˜¯äº‘æœåŠ¡å™¨ï¼Ÿ

Aï¼šæˆ‘ä»¬æœ‰è‡ªå·±çš„æœºæˆ¿ï¼Œç”¨çš„æ˜¯ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼Œç‰©ç†æœºã€‚

> Qï¼šå®¹å™¨è·¨ host é€šä¿¡ä½¿ç”¨å“ªä¸€ç§è§£å†³æ–¹æ¡ˆï¼Ÿ

Aï¼šå®¹å™¨è·¨ host å°±å¿…é¡»ä½¿ç”¨ 3 å±‚æ¥é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯ IPï¼Œå®¹å™¨å¯ä»¥æœ‰ç‹¬ç«‹çš„ IPï¼Œæˆ–è€…å®¿ä¸»æœº IPï¼‹ ç«¯å£æ˜ å°„çš„æ–¹å¼æ¥å®žçŽ°ã€‚æˆ‘ä»¬ç›®å‰ç”¨çš„æ¯”è¾ƒå¤šçš„è¿˜æ˜¯ç‹¬ç«‹ ip çš„æ–¹å¼ï¼Œæ˜“äºŽç®¡ç†ã€‚

> Qï¼šæ„Ÿè§‰è´µå…¬å¸å¯¹ Docker çš„ä½¿ç”¨æ¯”è¾ƒåƒè™šæ‹Ÿæœºï¼Œä¸ºä»€ä¹ˆä¸ç›´æŽ¥è€ƒè™‘ä»Žå®¹å™¨çš„è§’åº¦æ¥ä½¿ç”¨ï¼Œæ˜¯åŽ†å²åŽŸå› ä¹ˆï¼Ÿ

Aï¼šæˆ‘ä»¬é¦–å…ˆè€ƒè™‘çš„æ˜¯ç”¨æˆ·çš„æŽ¥å—ç¨‹åº¦å’Œæ”¹é€ çš„æˆæœ¬ã€‚ä»Žç”¨æˆ·çš„è§’åº¦æ¥è¯´ï¼Œä»–å¹¶ä¸å…³å¿ƒä¸šåŠ¡æ˜¯è·‘åœ¨å®¹å™¨é‡Œï¼Œè¿˜æ˜¯è™šæ‹Ÿæœºé‡Œï¼Œä»–æ›´å…³å¿ƒçš„æ˜¯åº”ç”¨çš„éƒ¨ç½²æ•ˆçŽ‡ï¼Œå¯¹åº”ç”¨æœ¬èº«çš„ç¨³å®šæ€§å’Œæ€§èƒ½çš„å½±å“ã€‚ä»Žå®¹å™¨çš„è§’åº¦ï¼Œä¸€äº›ä¸šåŠ¡æ–¹å·²æœ‰çš„åº”ç”¨å¯èƒ½éœ€è¦æ¯”è¾ƒå¤§çš„æ”¹é€ ã€‚æ¯”å¦‚æ—¥å¿—ç³»ç»Ÿï¼Œå…¨é“¾è·¯ç›‘æŽ§ç­‰ç­‰ã€‚å½“ç„¶ï¼Œæœ€ä¸»è¦çš„æ˜¯å¯¹å·²æœ‰è¿ç»´ç³»ç»Ÿçš„å†²å‡»ä¼šæ¯”è¾ƒå¤§ã€‚å®¹å™¨çš„ç®¡ç†å¯¹è¿ç»´æ¥è¯´æ˜¯ä¸ªæŒ‘æˆ˜ï¼Œè¿ç»´çš„æŽ¥å—æ˜¯éœ€è¦ä¸€ä¸ªè¿‡ç¨‹çš„ã€‚å½“ç„¶ï¼ŒæŠŠ Docker å½“æˆå®¹å™¨æ¥å°è£…åº”ç”¨ï¼Œæ¥å®žçŽ° PaaS çš„éƒ¨ç½²å’ŒåŠ¨æ€è°ƒåº¦ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ï¼Œäº‹å®žä¸Šæˆ‘ä»¬ä¹Ÿåœ¨å¾€è¿™ä¸ªæ–¹å‘åŠªåŠ›ã€‚è¿™ä¸ªä¹Ÿéœ€è¦ä¸šåŠ¡æ–¹æŠŠåº”ç”¨è¿›è¡Œæ‹†åˆ†ï¼Œå®žçŽ°å¾®æœåŠ¡åŒ–ï¼Œè¿™ä¸ªéœ€è¦ä¸€ä¸ªè¿‡ç¨‹ã€‚

> Qï¼šå…¶å®žæˆ‘ä»¬ä¹Ÿæƒ³ç”¨å®¹å™¨å½“è™šæ‹Ÿæœºä½¿ç”¨ã€‚ä½ ä»¬ç”¨è™šæ‹Ÿæœºè·‘ä»€ä¹ˆä¸­é—´ä»¶ï¼Ÿæˆ‘ä»¬æƒ³è§£å†³æµ‹è¯•å…³é”®å¯¹å¤§é‡ç›¸å¯¹ç‹¬ç«‹çŽ¯å¢ƒ WebLogic çš„çŸ›ç›¾ï¼Ÿ

Aï¼šæˆ‘ä»¬è·‘çš„ä¸šåŠ¡æœ‰å¾ˆå¤šï¼Œä»Žå‰å°çš„ä¸»ç«™ Webï¼Œåˆ°åŽç«¯çš„ä¸­é—´ä»¶æœåŠ¡ã€‚æˆ‘ä»¬çš„ä¸­é—´ä»¶æœåŠ¡æ˜¯å¦å¤–å›¢é˜Ÿè‡ªç ”çš„äº§å“ï¼Œå®žçŽ°å‰åŽå°ä¸šåŠ¡é€»è¾‘çš„åˆ†ç¦»ã€‚

> Qï¼šè´µå…¬å¸ç”¨ OpenStack åŒæ—¶ç®¡ç† Docker å’Œ KVM æ˜¯å¦æœ‰è‡ªå·±å¼€å‘ Web é…ç½®ç•Œé¢ï¼Œè¿˜æ˜¯å•çº¯ç”¨ API ç®¡ç†ï¼Ÿ

Aï¼šæˆ‘ä»¬æœ‰è‡ªç ”çš„ Web ç®¡ç†å¹³å°ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ä¸€ä¸ªå¹³å°ç®¡ç†å¤šä¸ªé›†ç¾¤ï¼Œå¹¶ä¸”å¯¹æŽ¥è¿ç»´ã€æ—¥å¿—ã€ç›‘æŽ§ç­‰ç³»ç»Ÿï¼Œå¯¹å¤–æš´éœ²ç»Ÿä¸€çš„ API æŽ¥å£ã€‚

> Qï¼šä¸Šé¢åˆ†äº«çš„ä¸€ä¸ªæ¡ˆä¾‹ä¸­ï¼Œå…³äºŽ 2.6 å†…æ ¸ namespace çš„ bugï¼Œè¿™ä¸ªä½Žç‰ˆæœ¬çš„å†…æ ¸å¯ä»¥å®‰è£… Docker çŽ¯å¢ƒå—ï¼ŒDocker ç›®å‰å¯¹ procfs çš„éš”ç¦»è¿˜ä¸å®Œå–„ï¼Œä½ ä»¬å¼€å‘çš„ container tools æ˜¯åŸºäºŽåº”ç”¨å±‚çš„è¿˜æ˜¯éœ€è¦ä¿®æ”¹å†…æ ¸ï¼Ÿ

Aï¼šå®‰è£…å’Œä½¿ç”¨åº”è¯¥æ²¡é—®é¢˜ï¼Œä½†å¦‚æžœä¸Šç”Ÿäº§çŽ¯å¢ƒï¼Œæ˜¯éœ€è¦å…¨é¢çš„è€ƒè™‘çš„ï¼Œä¸»è¦è¿˜æ˜¯ç¨³å®šæ€§å’Œéš”ç¦»æ€§ä¸å¤Ÿï¼Œä½Žç‰ˆæœ¬çš„å†…æ ¸æ›´å®¹æ˜“é€ æˆç³»ç»Ÿ crash æˆ–è€…å„ç§ä¸¥é‡çš„é—®é¢˜ï¼Œæœ‰äº›å…¶å®žä¸æ˜¯ bugï¼Œè€Œæ˜¯åŠŸèƒ½ä¸å®Œå–„ï¼Œæ¯”å¦‚å®¹å™¨å†…åˆ›å»ºç½‘æ¡¥ä¼šå¯¼è‡´ crashï¼Œå°±æ˜¯ network namespace å†…æ ¸æ”¯æŒä¸å®Œå–„å¼•èµ·çš„ã€‚æˆ‘ä»¬å¼€å‘çš„ container tools æ˜¯åŸºäºŽåº”ç”¨çš„ï¼Œä¸éœ€è¦ä¿®æ”¹å†…æ ¸ã€‚

> Qï¼šå…³äºŽå†—ç¾æ–¹é¢æœ‰æ²¡æœ‰æ›´è¯¦ç»†çš„ä»‹ç»ï¼Œæ¯”å¦‚ç¦»çº¿çŠ¶æ€å¦‚ä½•å®žçŽ°æ•°æ®æ¢å¤çš„ï¼Ÿ

Aï¼šç¦»çº¿çŠ¶æ€å¦‚ä½•å®žçŽ°æ¢å¤æ•°æ®ï¼Œè¿™ä¸ªæˆ‘åœ¨ä¹‹å‰å·²ç»å›žç­”è¿‡äº†ï¼Œå…·ä½“æ¥è¯´ï¼Œæ˜¯ç”¨ dmsetup create å‘½ä»¤åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ dm è®¾å¤‡ï¼Œæ˜ å°„åˆ° docker å®žä¾‹æ‰€ç”¨çš„ dm è®¾å¤‡å·ï¼Œé€šè¿‡ mount è¿™ä¸ªä¸´æ—¶è®¾å¤‡ï¼Œå°±å¯ä»¥æ¢å¤å‡ºåŽŸæ¥çš„æ•°æ®ã€‚å…¶ä»–çš„å†—ç¾æ–¹æ¡ˆï¼Œå› ä¸ºå†…å®¹æ¯”è¾ƒå¤šï¼Œå¯ä»¥å†å¦å¤–ç»„ç»‡ä¸€æ¬¡åˆ†äº«äº†ã€‚ä½ å¯ä»¥å…³æ³¨ä¸€ä¸‹ [mogu.io](http://mogu.io/)ï¼Œåˆ°æ—¶å€™æˆ‘ä»¬ä¼šåˆ†äº«å‡ºæ¥ã€‚

> Qï¼šè´µå…¬å¸ç›®å‰çº¿ä¸Šå®¹å™¨åŒ–çš„ç³»ç»Ÿï¼Œæ— çŠ¶æ€ä¸ºä¸»è¿˜æ˜¯æœ‰çŠ¶æ€ä¸ºä¸»ï¼Œåœ¨åœºæ™¯é€‰æ‹©ä¸Šæœ‰ä»€ä¹ˆè€ƒè™‘æˆ–éš¾ç‚¹ï¼Ÿ

Aï¼šäº’è”ç½‘å…¬å¸çš„åº”ç”¨ä¸»è¦æ˜¯ä»¥æ— çŠ¶æ€çš„ä¸ºä¸»ã€‚æœ‰çŠ¶æ€çš„ä¸šåŠ¡å…¶å®žä»Žä¸šåŠ¡å±‚é¢ä¹Ÿå¯ä»¥æ”¹é€ æˆéƒ¨åˆ†æœ‰çŠ¶æ€ï¼Œæˆ–è€…å®Œå…¨ä¸çŠ¶æ€çš„åº”ç”¨ã€‚ä¸å¤ªæ˜Žç™½ä½ è¯´çš„åœºæ™¯é€‰æ‹©ï¼Œä½†æˆ‘ä»¬å°½é‡æ»¡è¶³ä¸šåŠ¡æ–¹çš„å„ç§éœ€æ±‚ã€‚

---

### 2015-10-28ï¼š OCI æ ‡å‡†å’Œ runC åŽŸç†è§£è¯»

> Qï¼šå¯¹å®¹å™¨çƒ­è¿ç§»å¬å¾—æ¯”è¾ƒå°‘ï¼Œä¹Ÿæ¯”è¾ƒå¥½å¥‡ï¼Œæƒ³é—®é—®çƒ­è¿ç§»çš„æ—¶å€™å®¹å™¨ä¾èµ–çš„æ–‡ä»¶ç³»ç»Ÿæ€Žä¹ˆè§£å†³ï¼Œæ˜¯ç›´æŽ¥ copy åˆ°ç›®æ ‡æœºå—ï¼Œå¯å¦ä½¿ç”¨å…¬å…±ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿè§£å†³å‘¢ï¼Œè¿˜æœ‰å¯¹ç›®æ ‡æœºæœ‰ä»€ä¹ˆç‰¹æ®Šè¦æ±‚å—ï¼Ÿ

Aï¼šä¾èµ–æ–‡ä»¶ç³»ç»Ÿè¦ä¿æŒä¸€è‡´ã€‚æœ€å¥½äº‹å…ˆåœ¨ç›®æ ‡æœºé¢„ç½®æ–‡ä»¶ç³»ç»Ÿã€‚æœ‰äº›å®¹å™¨æ¶‰åŠåˆ°ä¸èƒ½è¿ç§»çš„è®¾å¤‡ä¹‹ç±»çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨åˆ™ä¸èƒ½è¢«è¿ç§»ã€‚ç›®æ ‡æœºçš„ OS ä½æ•°è¦ä¸€æ ·ã€‚

> Qï¼šè§£ runCï¼Œé—®ä¸‹å’Œ Docker å¯¹æ¯”ï¼Œæœ‰é‚£äº›ä¸åŒï¼Œåˆæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ

Aï¼šrunC çš„ä¼˜åŠ¿ä½“çŽ°åœ¨è½»é‡çº§å’Œæ ‡å‡†åŒ–ï¼Œè¿™æ˜¯ Docker æ²¡æœ‰çš„ã€‚è€Œ Docker é‚£ä¸€å¥—åºžå¤§çš„ä½“ç³»ï¼Œä¹Ÿæ˜¯ runC æ²¡æœ‰çš„ã€‚

> Qï¼šdumpfiles æ˜¯å¯ä»¥æŒä¹…åŒ–çš„å—ï¼Œè¿˜æ˜¯ä»…ä»…ç”¨äºŽä¸€æ¬¡æ€§çš„çƒ­è¿ç§»äº¤æ¢ï¼Ÿ

Aï¼šä¿å­˜åœ¨ç¡¬ç›˜ï¼Œå¯ä»¥è¿›è¡Œå¤šæ¬¡ä½¿ç”¨ã€‚

> Qï¼šCRIU çƒ­è¿ç§»ç½‘ç»œé…ç½®ä¿¡æ¯ä¼šä¿å­˜ä¹ˆï¼Œè¿˜æœ‰å°±æ˜¯å¤§æ¦‚çƒ­è¿ç§»å»¶æ—¶æ˜¯å¤šå°‘ï¼Ÿ

Aï¼šåªè¦è®¾å®šäº†å‚æ•°å°±ä¼šä¿å­˜ï¼Œçƒ­è¿ç§»çš„å»¶æ—¶è¿™ä¸ªè¦çœ‹ä½ é…å¥—è®¾æ–½å’Œé…å¥—è½¯ä»¶ã€‚

> Qï¼šæˆ‘å¯¹è¿™ä¸ªçƒ­è¿ç§»æ²¡äº†è§£è¿‡ã€‚æƒ³é—®ä¸‹ï¼Œè¿™ä¸ªçƒ­è¿ç§»ä¸»è¦æ˜¯è¿ç§»é…ç½® rootfs ä¹ˆï¼Œèƒ½è¿ç§»å½“å‰çš„å®¹å™¨çŠ¶æ€ä¹ˆï¼Œæ¯”å¦‚æ­£åœ¨è¿›è¡Œçš„è®¡ç®—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œè¿™ä¸ªè¦åœ¨å¯¹åº”çš„æœºå™¨ä¸Šæœ‰å¯¹åº”çš„ rootfs æ‰èƒ½è¿ç§»ã€‚çŠ¶æ€ä»€ä¹ˆçš„éƒ½å¯ä»¥è¿ç§»ã€‚

> Qï¼šé‚£æ˜¯ä¸æ˜¯æ„å‘³ç€æˆ‘å¯ä»¥åˆ©ç”¨ CRIU å·¥å…·æŠŠå®¹å™¨å›ºåŒ–ä¸‹æ¥ï¼Œç±»ä¼¼äºŽè™šæ‹Ÿæœºçš„å¿«ç…§ï¼Œä»¥ä¾¿åœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»è¿›è¡Œæ¢å¤æˆ–è€…è¿ç§»ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œå°±æ˜¯è¿™æ ·ã€‚ä»¥çš„ï¼Œå®¹å™¨å†…çš„çŠ¶æ€éƒ½å¯ä»¥è¿ç§»ã€‚

---

### 2015-10-20ï¼šä¸­å…´è½¯åˆ›ï¼ˆZTEsoftï¼‰åŸºäºŽ Jenkins å’Œ Docker çš„ CI å®žè·µ

> Qï¼šä½ å¥½ï¼Œé—®ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‰æ®µæ—¶é—´ä¹ŸæŠŠ Dubbo æ¡†æž¶è¿è¡Œåœ¨ Docker é‡Œé¢ï¼Œä¹Ÿæ˜¯é‡‡ç”¨ä½ ä»¬çŽ°åœ¨çš„æŠŠå®¿ä¸»æœºå’Œç«¯å£ä½œä¸ºçŽ¯å¢ƒå˜é‡ä¼ å…¥çš„æ–¹å¼å®žçŽ°çš„ï¼Œæˆ‘æ¯”è¾ƒæƒ³äº†è§£çš„æ˜¯åŽç»§ä½ ä»¬æœ‰ä»€ä¹ˆæ›´å¥½çš„æ–¹å¼å®žçŽ°ï¼Œæˆ‘çœ‹ä½ æåˆ°äº†åŸºäºŽ OVS çš„æ–¹æ¡ˆï¼Ÿ

Aï¼šæœ‰ä¸¤ç§è§£å†³åŠžæ³•ï¼š1.  ä¸€ç§æ˜¯å°†æ˜¾å¼ä¼ é€’çŽ¯å¢ƒå˜é‡åšæˆéšå¼çš„è‡ªåŠ¨èŽ·å–å®¿ä¸»æœºå’Œç«¯å£ï¼Œä»Žè€Œå‡å°‘é…ç½®å·¥ä½œï¼›2.  å¦ä¸€ç§åˆ™æ˜¯é€šç”¨çš„ Open vSwitchï¼ˆOVSï¼‰æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸Ž Dubbo æ— å…³çš„ã€‚

> Qï¼šå®¹å™¨ä¸­çš„ Dubbo æ³¨å†Œé—®é¢˜ï¼Œæ‰©å±• Dubbo çš„ protocol é…ç½®ï¼Œå¢žåŠ  publishhost å’Œ publishport è§£å†³äº†æ³¨å†Œé—®é¢˜ï¼Œèƒ½ä¸èƒ½è¯´çš„è¯¦ç»†ä¸€ç‚¹ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬ç¡¬ç¼–ç äº† Dubbo çš„ protocolï¼Œåœ¨é‡Œé¢åŠ äº†ä¸¤ä¸ªå­—æ®µï¼Œè¿™ç§æ‰©å±•æ–¹å¼æœ‰ç‚¹é‡Žè›®ï¼Œä½† Dubbo æœ¬èº«æä¾›çš„æ‰©å±•æ–¹å¼ç›®å‰å¾ˆéš¾æ”¯æŒä¼ é€’çŽ¯å¢ƒå˜é‡æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨è€ƒè™‘å°†çŽ¯å¢ƒå˜é‡éšå¼èŽ·å–ï¼Œè¿™æ ·å°±ä¸ç”¨ç¡¬ç¼–ç äº†ã€‚

> Qï¼šä½ ä»¬ç”¨çš„è¿˜æ˜¯ç«¯å£æ˜ å°„å§ï¼Œé‚£ä¹ˆä¹Ÿä¼šå­˜åœ¨å¾ˆå¤šä¸ªç«¯å£çš„é—®é¢˜å§ï¼Œåƒ IP å¯ä»¥è®¿é—®ä¸€æ ·ï¼Ÿ

Aï¼šåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä½œç«¯å£æ˜ å°„æ˜¯è¿è¥å•†çš„è¦æ±‚ï¼Œä»–ä»¬è¦æ±‚èƒ½é€šè¿‡é…ç½®æ¥è®¾ç½®æ¯ä¸ªå®¹å™¨çš„ç«¯å£æ˜ å°„ï¼Œè¿™ä¸Žä»–ä»¬çŽ°æœ‰çš„è¿ç»´æ–¹å¼æœ‰å…³ï¼Œä¸€å¼€å§‹æˆ‘ä»¬è€ƒè™‘çš„æ˜¯ docker çš„è‡ªåŠ¨ç«¯å£æ˜ å°„ï¼Œå½“ç„¶è¿™ç§éœ€æ±‚å°†æ¥è‚¯å®šæ˜¯è¶‹åŠ¿ï¼Œæˆ‘ä»¬çš„"äº‘åº”ç”¨ç®¡ç†å¹³å°"ä¸­ä¹Ÿæœ‰è€ƒè™‘ã€‚

> Qï¼šä¸ºä½•è€ƒè™‘ Dubbo è€Œä¸æ˜¯ etcd åšæœåŠ¡å‘çŽ°ï¼ŒDubbo çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šé€‰ä¸­ Dubbo æ˜¯å¾ˆå¶ç„¶çš„ï¼Œå…¬å¸æœ¬èº«æœ‰ ESB äº§å“ï¼Œä½†ç›¸å¯¹æ¥è¯´æ¯”è¾ƒé‡ï¼Œä¸€èˆ¬ç”¨äºŽå¤šä¸ªäº§å“é—´çš„è°ƒç”¨ï¼Œè€Œ Dubbo æˆ‘ä»¬ä¸€èˆ¬ç”¨äºŽäº§å“å†…éƒ¨å¤šä¸ªæ¨¡å—ä¹‹é—´çš„è°ƒç”¨ï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„æœåŠ¡æ€»çº¿ï¼ŒDubbo è¿™ç§æ–¹å¼ä¸ä¾èµ–äºŽç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿï¼Œetcd å¹¶ä¸æ˜¯æ‰€æœ‰æ“ä½œç³»ç»Ÿéƒ½èƒ½æ”¯æŒçš„å§ï¼Œå½“ç„¶æˆ‘ä¹Ÿæ²¡æœ‰å¯¹ etcd ä½œæ·±å…¥çš„ç ”ç©¶ã€‚

> Qï¼šJenkins çš„ slave æ˜¯é€‰ç”¨äº†è™šæ‹Ÿæœºè¿˜æ˜¯ç›´æŽ¥ç‰©ç†æœºï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ Jenkins çš„ master å’Œ slave éƒ½æ˜¯ç”¨çš„è™šæ‹Ÿæœºã€‚

> Qï¼šä»£ç æäº¤ä¸ŠåŽ»ï¼Œå¦‚æžœæµ‹è¯•æœ‰é—®é¢˜ï¼Œå›žæ»šæ˜¯è‚¿ä¹ˆå¤„ç†ï¼Œä¹Ÿæ˜¯é€šè¿‡ Jenkinsï¼Ÿ

Aï¼šè¿™é‡Œè¦åˆ†æƒ…å†µæ¥è¯´ï¼Œä¸€ç§æ˜¯æµ‹è¯•å‘çŽ°é—®é¢˜ï¼Œæå•å­ç»™å¼€å‘ä¿®æ”¹ï¼Œå¼€å‘ä¿®æ”¹å®Œä»£ç æäº¤åˆ° scmï¼Œç„¶åŽè§¦å‘ Jenkins ä¸‹ä¸€è½®çš„ç¼–è¯‘å’Œéƒ¨ç½²ï¼›å¦ä¸€ç§æƒ…å†µæ˜¯å¦‚æžœæŸæ¬¡éƒ¨ç½²å¤±è´¥ï¼Œåˆ™ä¼šç”¨éƒ¨ç½²å‰çš„å¤‡ä»½ç›´æŽ¥è¿˜åŽŸã€‚

> Qï¼šè¯·é—®ç”¨çš„ Registry V1 è¿˜æ˜¯ V2 ï¼Œåˆ†å¸ƒå¼å­˜å‚¨ç”¨çš„ä»€ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠ  Nginx ä»£ç†ï¼Ÿ

Aï¼šç›®å‰æˆ‘ä»¬ç”¨çš„æ˜¯ V1ã€‚ç”Ÿäº§çŽ¯å¢ƒå¤šæ˜¯é›†ç¾¤çŽ¯å¢ƒï¼Œéœ€è¦åŠ  Nginx ä½œåˆ†å‘ã€‚ç›®å‰åº”ç”¨ä¸­åˆ†å¸ƒå¼å­˜å‚¨ç”¨çš„å¹¶ä¸å¤šï¼Œä¸€èˆ¬æ¥è¯´ç”¨ hdfs æ¥å­˜å‚¨ä¸€äº›æ—¥å¿—ä¾¿äºŽåŽé¢åˆ†æžï¼Œä¹Ÿæœ‰ç”¨ FastDFS å’Œ MongoDB çš„ã€‚

> Qï¼šåº•å±‚äº‘å¹³å°ç”¨çš„æ˜¯ç§æœ‰äº‘ï¼Ÿ

Aï¼šåº•å±‚å¹³å°ä¸€å¼€å§‹æƒ³ç”¨ç§æœ‰äº‘ï¼Œä½†è¿è¥å•†å·²ç»æœ‰äº† vCenter çš„çŽ¯å¢ƒï¼Œå› æ­¤åŽæ¥æˆ‘ä»¬æ”¹ç”¨ Ansible æ¥ç®¡ç†å„ç±»ç‰©ç†æœºå’Œè™šæœºï¼Œç”¨ Docker API æ¥ç®¡ç†å®¹å™¨ã€‚

> Qï¼šDubbo å®žçŽ°çš„æœåŠ¡å‘çŽ°æ˜¯å¦å…·å¤‡ failover åŠŸèƒ½ï¼Œè‡ªåŠ¨æ£€æµ‹å¹¶è¿ç§»å¤±è´¥å®¹å™¨ï¼Ÿ

Aï¼šDubbo ç›®å‰ä¸å…·å¤‡è¿ç§»å®¹å™¨çš„åŠŸèƒ½ï¼Œå…¶ failover æ˜¯é€šè¿‡è´Ÿè½½å‡è¡¡å’Œå¿ƒè·³è¿žæŽ¥æ¥æŽ§åˆ¶çš„ï¼Œè‡ªåŠ¨æ£€æµ‹å’Œå®¹å™¨è¿ç§»æˆ‘ä»¬ä¸€èˆ¬ä¼šè€ƒè™‘æ”¾åœ¨ç›‘æŽ§ç³»ç»Ÿé‡Œé¢æ¥åšï¼Œå¦‚æžœæ”¾åœ¨ Dubbo é‡Œé¢ä¼šåŠ é‡ Dubboï¼Œåªæ‰€ä»¥ç”¨ Dubbo ä¹Ÿæ˜¯è€ƒè™‘åˆ°å®ƒçš„è½»ä¾¿æ€§ã€‚

> Qï¼šèƒ½å¦è°ˆä¸‹å¯¹ Jenkins+Mesos çš„çœ‹æ³•ï¼Œè¿™ä¸ªæ¶‰åŠåˆ° docker-in-docker çš„å¿…è¦æ€§ï¼Ÿ

Aï¼šMesos æˆ‘ä»¬æ‰åˆšåˆšæŽ¥è§¦ï¼Œæˆ‘äº†è§£çš„ä¸å¤ªå¤šï¼Œè‡³äºŽ docker-in-docker æˆ‘è§‰å¾—ç”Ÿäº§ä¸Šå¾ˆéš¾ç”¨ï¼Œå› ä¸ºæ€§èƒ½æ–¹é¢æŸå¤±æ¯”è¾ƒä¸¥é‡ï¼Œæˆ‘ä»¬åšè¿‡æ€§èƒ½æµ‹è¯•ï¼Œéž `--net=host`{.prettyprint}æ–¹å¼çš„å®¹å™¨æ€§èƒ½æŸå¤±æŽ¥è¿‘ 30%ã€‚

> Qï¼šèƒ½å…·ä½“ä»‹ç»ä¸‹åˆ©ç”¨ Dockerfile æ‰“åŒ…é•œåƒå—ï¼Œjar åŒ…ä¹Ÿæ˜¯åœ¨è¿™ä¸€æ­¥ç¼–è¯‘å‡ºæ¥çš„å—ï¼Œè¿™æ ·å‘å¸ƒå‡ºåŽ»çš„é•œåƒä¼šæ—¢åŒ…æ‹¬ä»£ç åˆåŒ…å« jar åŒ…å§ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„é•œåƒä¸­æ˜¯ä¸åŒ…å«ä»£ç çš„ï¼Œé•œåƒé‡Œé¢æ˜¯äº§å“åŒ…ï¼Œç¼–è¯‘æ˜¯åœ¨æ‰“é•œåƒä¹‹å‰åšçš„ã€‚

> Qï¼šå¯¹ä¸ç”Ÿäº§çŽ¯å¢ƒä¸­ä¸é€‚åˆä»¥å®¹å™¨è¿è¡Œçš„ç»„ä»¶ï¼ŒJenkins+Docker æ˜¯å¦å°±æ²¡æœ‰ä¼˜åŠ¿äº†ï¼Ÿ

Aï¼šå¼€å‘å’Œæµ‹è¯•çŽ¯å¢ƒè¿˜æ˜¯å¾ˆæœ‰ä¼˜åŠ¿çš„ï¼Œå½“ç„¶æœ‰äº›æœ‰å¤§é‡ IO æ“ä½œçš„æœåŠ¡å…¶å®žä¸é€‚åˆæ”¾åœ¨å®¹å™¨é‡Œé¢ï¼Œè¿™ä¸»è¦æ˜¯æ€§èƒ½æ–¹é¢çš„è€ƒè™‘ã€‚

> Qï¼šäº‘å¹³å°æ˜¯æ€Žä¹ˆç®¡ç†å®¹å™¨çš„ï¼Œæœ‰æ²¡æœ‰ä½¿ç”¨ Docker ç”Ÿæ€ç³»ç»Ÿç›¸å…³çš„ç»„ä»¶ï¼Ÿ

Aï¼šç›®å‰æ²¡æœ‰ç”¨åˆ° Swarm\\Compose ä¹‹ç±»çš„ç»„ä»¶ï¼Œå°†æ¥è¦çœ‹è¿™å—çš„å‘å±•äº†ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šå¼•å…¥ k8s æˆ–è€… Mesos æ¥ä½œç®¡ç†ï¼Œè¿™äº›ç›®å‰éƒ½åœ¨è€ƒè™‘å½“ä¸­

> Qï¼šåœ¨æ€Žä¹ˆåˆ¤æ–­éƒ¨ç½² Docker æœåŠ¡ä¸å¯ç”¨ï¼Œä¸å¯ç”¨åŽè‡ªåŠ¨è¿ç§»è¿˜æ˜¯å¦‚ä½•æ“ä½œï¼Ÿ

Aï¼šç›®å‰äº‘åº”ç”¨å¹³å°åªåœ¨å‘å¸ƒæ—¶æ‰å¯¹ Docker å®¹å™¨è¿›è¡ŒçŠ¶æ€æ£€æµ‹ï¼Œå¦‚æžœæ£€æµ‹åˆ°å¤±è´¥ï¼Œä¼šæ ¹æ®æŒ‡å®šçš„å®¹å™¨æ•°ç›®è¿›è¡Œé‡æ–°åˆ›å»ºã€‚åŽç»­æˆ‘ä»¬ä¼šæŠŠå¯¹å®¹å™¨çŠ¶æ€çš„æŒç»­æ£€æµ‹ç»Ÿä¸€æ”¾åˆ°ç›‘æŽ§ç³»ç»Ÿä¸­ã€‚

> Qï¼šæˆ‘æ˜¯ä¸æ˜¯å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œä½ ä»¬çš„ Jenkins æ˜¯ä¸»è¦ç”¨æ¥ CIï¼Œè€Œå®žé™…é›†ç¾¤ç®¡ç†åˆ™æ˜¯äº‘åº”ç”¨å¹³å°åšçš„ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œè¿™ä¸ªæ˜¯ä¸¥æ ¼åˆ†å·¥çš„ï¼Œå½“æ—¶ä½œäº‘åº”ç”¨ç®¡ç†å¹³å°æ—¶ï¼Œæ˜¯ä»¥æµ‹è¯•äº¤ä»˜ç‰©ä¸ºèµ·å§‹ç‚¹çš„ï¼Œè¿™é‡Œçš„æµ‹è¯•äº¤ä»˜ç‰©å°±æ˜¯ CI çš„äº§ç‰©ï¼Œå®¹å™¨æ–¹å¼ä¸‹å°±æ˜¯é•œåƒäº†ã€‚

> Qï¼šæˆ‘å¯ä»¥ç†è§£ Docker æ˜¯éƒ¨ç½²åœ¨å®žä½“æœºï¼Œå®žä½“æœºä¸Šéƒ½æœ‰ä¸€ä¸ª agent çš„ä¸œè¥¿è´Ÿè´£ä¸Žç®¡ç†ç«¯é€šä¿¡ï¼Œä¸»è¦è´Ÿè´£ Docker çš„ç®¡ç†ï¼ˆå®‰è£…ï¼Œéƒ¨ç½²ï¼Œç›‘æŽ§ç­‰ï¼‰å—ï¼Ÿ

Aï¼šæˆ‘ä»¬çš„ Docker ç›®å‰éƒ½æ˜¯éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸Šçš„ï¼Œæ“ä½œç³»ç»Ÿæ˜¯ Redhat7.1ï¼Œä½ æ‰€è°“çš„ agent å…¶å®žåº”è¯¥å°±æ˜¯ Docker daemon å§ã€‚

- å¾æ–°å¤ï¼šè¿™ä¸ªæˆ‘è¡¥å……ä¸€ä¸‹ï¼Œä½œä¸º Jenkins çš„ slaveï¼Œä¼šå‘ slave é‡Œé¢å¯åŠ¨ä¸€ä¸ª agent æ¥æ‰§è¡Œç›¸å…³è„šæœ¬å‘½ä»¤çš„ã€‚è¿™ä¸ªå±žäºŽ Jenkins çš„åŠŸèƒ½ï¼Œå¯ä»¥åŽ»ä½“éªŒä¸‹ã€‚

> Qï¼šä¸€ä¸ªåº”ç”¨å¤šä¸ªå®¹å™¨ä½ ä»¬æ€Žä¹ˆè´Ÿè½½å‡è¡¡ï¼Ÿ

Aï¼šå‰é¢å…¶å®žå›žç­”è¿‡ï¼Œè¦åŠ  Nginx çš„ã€‚

> Qï¼šåˆ©ç”¨ Dockerfile æ‰“åŒ…é•œåƒå¹¶ä¸Šä¼ åˆ° Registry æ›´åƒæ˜¯ CD çŽ¯èŠ‚çš„äº‹æƒ…ï¼Œé‚£åœ¨å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•çŽ¯å¢ƒæ˜¯å¦æœ‰åˆ©ç”¨åˆ° Docker å‘¢ï¼Œæ˜¯å¦ä½¿ç”¨ Jenkins ä¸­ Docker ç›¸å…³çš„æ’ä»¶äº†ï¼Ÿ

Aï¼šå½“å‰é¡¹ç›®çš„å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•éƒ½ç”¨åˆ° docker å®¹å™¨çš„ã€‚Jenkins ä¸­æ²¡æœ‰ç”¨ Docker æ’ä»¶ï¼Œè¯•è¿‡æ„Ÿè§‰éƒ½ä¸å¤ªæˆç†Ÿï¼Œç›®å‰è¿˜æ˜¯ Docker å‘½ä»¤è¡Œæœ€æ–¹ä¾¿ã€‚

> Qï¼šå¼€å§‹çš„æ—¶å€™æœ‰è®²å¦‚æžœæ²¡æœ‰ Docker è‡ªåŠ¨éƒ¨ç½²ä¼šè‡ªåŠ¨éƒ¨ç½²ï¼Œè¿™ä¸ªæ˜¯å¦‚ä½•éƒ¨ç½²çš„ï¼Ÿ

Aï¼šè¿™ä¸ªå‰é¢è®²è¿‡ï¼Œæ˜¯é€šè¿‡ lftp è„šæœ¬æ¯”å¯¹ç¼–è¯‘çŽ¯å¢ƒä¸Žå¾…éƒ¨ç½²çš„è¿œç¨‹ç›®å½•ã€‚

> Qï¼šä¹Ÿå°±æ˜¯ä½ ä»¬åœ¨è™šæ‹Ÿæœºé‡Œé¢éƒ¨ç½²çš„ Dockerï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œå½“å‰çš„é¡¹ç›®æ˜¯åœ¨è™šæ‹Ÿæœºé‡Œé¢éƒ¨ç½² Docker çš„ï¼Œä½†æˆ‘ä¸ªäººè§‚ç‚¹ä»Žé•¿è¿œçœ‹æ¥ï¼Œå…¶å®žåœ¨ç‰©ç†æœºä¸Šéƒ¨ç½² Docker ä¼šæ›´å¥½ï¼Œæ‰€ä»¥çŽ°åœ¨å¾ˆå¤šç§æœ‰äº‘æ¯”å¦‚ OpenStackã€CloudStack éƒ½èƒ½æ”¯æŒç›´æŽ¥ç®¡ç†å®¹å™¨ï¼Œä¸è¿‡ç›®å‰è™šæ‹Ÿæœºè¿˜æ˜¯ä¸èƒ½ç¼ºå°‘çš„ï¼Œå®¹å™¨çš„éš”ç¦»æ€§ä¸å¦‚ VMã€‚

> Qï¼šå¦‚æžœç”¨ nat æ¨¡å¼ å®¹å™¨å¦‚ä½•æŒ‡å®š IP å•Šï¼Ÿ

Aï¼šä¸éœ€è¦æŒ‡å®šå®¹å™¨ IPï¼Œåªéœ€è¦æ˜ å°„ç«¯å£ã€‚

> Qï¼šæœ‰é€šè¿‡ Dubbo åšæœåŠ¡è·¯ç”±ä¹ˆï¼Ÿ

Aï¼šDubbo æœ¬èº«å°±æœ‰æœåŠ¡è·¯ç”±çš„åŠŸèƒ½ã€‚

---

### 2015-10-17ï¼šDocker Registry V1 to V2

> Qï¼šæƒ³é—®ä¸‹ï¼Œé‚£ä½ ä»¬çš„ layer æ•°æ®æ˜¯ä¸æ˜¯è¦å­˜ä¸¤ä»½ï¼ŒV1ã€V2 å„ä¸€ä»½ï¼Ÿ

Aï¼šæ˜¯è¦åˆ†å¼€å­˜ä¸¤ä»½çš„ï¼Œå› ä¸ºä»–ä»¬çš„æ ¼å¼å…¶å®žéƒ½æ˜¯ä¸ä¸€æ ·çš„ä¸€ä¸ªæ˜¯ tar åŒ…ä¸€ä¸ªæ˜¯ gzip åŒ…ï¼Œä½†å†…å®¹ä¸€æ ·ã€‚

> Qï¼šä¸ºå•¥ tar å˜ä¸º gzip ä¼šè€—è´¹ CPU å’Œç½‘ç»œï¼Œä¸å°±æ˜¯ä¸åŒçš„åŽ‹ç¼©æ ¼å¼ä¹ˆ?

Aï¼šç½‘ç»œå…¶å®žæ˜¯èŠ‚çœçš„ï¼Œä½†æ˜¯åŽ‹ç¼©æ˜¯å¾ˆè€— CPU çš„ tar å…¶å®žå¹¶ä¸å¤ªæ¶ˆè€—ã€‚

> Qï¼šV1 å¦‚æžœåšäº›ä¼˜åŒ–ï¼Œä¸€æ¬¡èŽ·å– Ancestryï¼Œç„¶åŽå¹¶è¡Œä¸‹è½½ layerï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æé«˜åžåé‡ä¹ˆï¼Ÿ

Aï¼šç†è®ºä¸Šæ˜¯è¿™æ ·çš„ï¼Œæˆ‘çœ‹ 1.8 çš„ä»£ç åœ¨ pull v1 ä¹Ÿä¸€æ¬¡ä¼šæ‹¿åˆ°æ‰€æœ‰çš„ Image ID ä½†æ˜¯å¹¶æ²¡æœ‰åŽ»å¹¶è¡Œä¸‹è½½ï¼Œä¼°è®¡ Docker è‡ªå·±æŠŠè¿™å—æ”¾å¼ƒäº†å§ã€‚

> Qï¼šè¯·é—®ï¼Œæ‚¨æåˆ°çš„åˆ©ç”¨ Registry çš„ hookï¼Œæ¥èŽ·å– image æ›´æ–°çš„ä¿¡æ¯ï¼ŒæŒ‡çš„æ˜¯åˆ©ç”¨ Registry çš„ notification APIï¼Ÿ

Aï¼šV2 æ˜¯è¿™æ ·ï¼ŒV1 æ˜¯è‡ªå·±åœ¨ Registry é‚£é‡Œåšäº†ä¸ª hookã€‚

> Qï¼šè¯·é—®å…³äºŽé•œåƒåˆ é™¤çš„é—®é¢˜ï¼ŒV2 çš„åˆ é™¤æ„Ÿè§‰å‘å¾ˆå¤šï¼Œå¦‚ä½•åˆ é™¤ï¼Œè¿˜æœ‰ï¼Œå¦‚æžœåŒä¸€ä¸ªé•œåƒåç§°åŠç‰ˆæœ¬ä½†æ˜¯å†…å®¹å¹¶ä¸åŒçš„é•œåƒé‡å¤ pushï¼Œæœ‰æ²¡æœ‰åŠžæ³•æ£€æµ‹ï¼Œä»¥åŠåŒæ­¥ï¼Ÿ

Aï¼šæˆ‘ä»¬ç”¨çš„ AWS å¯¹è±¡å­˜å‚¨ï¼Œå­˜å‚¨è¿˜æ¯”è¾ƒä¾¿å®œï¼Œæ‰€ä»¥æ²¡å¤ªå…³æ³¨ï¼ŒGitHub ä¸Šæœ‰ä¸€ä¸ª v2 gc çš„é¡¹ç›®å¯ä»¥åˆ é™¤æ— ç”¨é•œåƒï¼Œå®˜æ–¹å«ç€åšåœæœº gcï¼Œå«äº†å¥½ä¹…äº†ï¼Œç›®å‰è¿˜æ²¡å®žçŽ°ï¼Œåªèƒ½è‡ªå·±é€ è½®å­äº†ï¼›é‡å¤ push å’Œåˆšæ‰æåˆ°çš„ä¹±åºç±»ä¼¼ï¼Œæˆ‘ä»¬ä¼šä¿è¯è¿™ç§æƒ…å†µæ˜¯ä¸²è¡Œçš„ã€‚

> Qï¼šV2 è¿™ä¹ˆä¸æˆç†Ÿï¼Œçœ¼ä¸‹ä¸Šè¿˜æ˜¯ä¸ä¸Šï¼Œpush åˆ° V2 registry çš„ image èƒ½ä¸èƒ½æŸ¥è¯¢ï¼Ÿ

Aï¼šæˆ‘ä»¬å½“åˆçš„æƒ³æ³•æ˜¯ç…§ç€ Docker è¿™ä¹ˆä»»æ€§çš„æ€åº¦ï¼Œæ²¡å‡† 1.8 å°±ä¸æ”¯æŒ V1 äº†ï¼Œæ‰€ä»¥å°±èµ¶ç´§è°ƒç ”ç”¨ä¸Šäº†ã€‚æŸ¥è¯¢æ²¡æœ‰ç›´æŽ¥çš„ APIï¼Œæˆ‘ä»¬å¾ˆå¤š tar æ²¡æœ‰çš„ API éƒ½æ˜¯è‡ªå·±é€ è½®å­é€ å‡ºæ¥çš„ã€‚

> Qï¼šV2.1 åŽï¼ŒRegistry æä¾›ä¸€ä¸ªå« catalog APIï¼Œå…·æœ‰ä¸€å®š image æœç´¢çš„åŠŸèƒ½ï¼Œä½†è¿˜ä¸å¤Ÿå®Œç¾Žï¼Ÿ

Aï¼šcatalog ä¼šéåŽ†æ•´ä¸ªå­˜å‚¨æ¶ˆè€—è¿˜æ˜¯è›®å¤§çš„ï¼Œå¯ä»¥é€šè¿‡ catalog åšç¦»çº¿ï¼Œç„¶åŽ notify åšå®žæ—¶æ›´æ–°æ¥å®žçŽ° search çš„ä¸€ä¸ªç´¢å¼•ã€‚

> Qï¼šè¯·é—®ï¼Œçµé›€äº‘çš„ registry backend storage æ˜¯ä»€ä¹ˆç±»åž‹ï¼Œæ–‡ä»¶ç³»ç»Ÿä¹ˆï¼Œç†ç”±æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šç›´æŽ¥ AWS åœ¨ä¸­å›½çš„ s3ï¼Œç›®å‰å®˜æ–¹æ”¯æŒçš„æœ€å¥½çš„ï¼Œä¸ç”¨è‡ªå·±é€ è½®å­ï¼Œå°±é…±ç´«ã€‚

> Qï¼šé’ˆå¯¹ V2 çš„ auth æ–¹å¼ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®ï¼Œå¯¹äºŽå¹³å°ç±»çš„å¼€å‘ï¼Ÿ

Aï¼šæˆ‘çš„å»ºè®®æ˜¯ä½¿ç”¨ token auth çš„æ–¹å¼ï¼Œè™½ç„¶å¤æ‚ä¸€æ­¥åˆ°ä½ï¼Œå¯ä»¥åšä¸€äº›å¤æ‚çš„æƒé™è®¤è¯ã€‚ç±»ä¼¼çš„é¡¹ç›®è¿˜æ˜¯ï¼š[https://github.com/SUSE/Portus](https://github.com/SUSE/Portus)ï¼Œä¸è¿‡å»ºè®®æ¯æ¬¡ Docker ç‰ˆæœ¬æ›´æ–°éƒ½è·Ÿç€æµ‹ä¸€éã€‚

> Qï¼šæœ‰æ²¡æœ‰ç±»ä¼¼ docker auth çš„é¡¹ç›®ï¼Ÿ

Aï¼š[SUSE/Portus](https://github.com/SUSE/Portus) ä¸€ä¸ªå¼€æºçš„ auth serverï¼Œä½†æ˜¯æ¯”è¾ƒå‘çš„æ˜¯ Docker Engine è€å˜ï¼Œä¸€å‡çº§å¯èƒ½å°±ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬è‡ªå·±çš„ auth server ä¹Ÿæ”¹äº†å¥½å‡ æ¬¡ã€‚

> Qï¼šç”± V1 å‡çº§åˆ° V2ï¼Œä¸ºä»€ä¹ˆéžå¾—æŠŠæ—§ä»“åº“ä¸Šçš„é•œåƒè¿ç§»åˆ°æ–°çš„ V2 è¿™ä¹ˆæŠ˜è…¾ï¼Œç›´æŽ¥ä¸¤ä¸ªç‰ˆæœ¬å¹¶å­˜ä¸€æ®µæ—¶é—´ä¸è¡Œå—ï¼Œæ–°ä¸Šä¼ ç”¨æ–°çš„ V2 çš„ urlï¼Œå¦‚æžœè¦å›žé€€æ—§ç‰ˆæœ¬æ—§åº“ä¸Šé•œåƒ url ä¹Ÿè¿˜æœ‰å§ï¼Œä¸€æ®µæ—¶é—´åŽæ—§åº“å°±èƒ½é€€å½¹äº†ï¼Ÿ

Aï¼šå› ä¸ºæˆ‘ä»¬æœ‰ç”¨æˆ·çš„ push è€Œç”¨æˆ·å¾ˆå¤šè¿˜åœ¨ç”¨æ—§ç‰ˆæœ¬ï¼Œä¹Ÿæœ‰ç”¨æˆ·å‘çŽ°æ–°ç‰ˆæœ¬ä¸åˆé€‚å›žæ»šçš„ï¼Œå¦‚æžœåªé¡¾ä¸€å¤´ç”¨æˆ·ä¸€å˜å°±å‘çŽ°é•œåƒæ²¡äº†ã€‚

> Qï¼šalauda äº‘ push çš„æ—¶å€™ 443 ç«¯å£æ‹’ç»è¿žæŽ¥æ€Žä¹ˆåŠžï¼Ÿ

Aï¼šè¿™ä¸ªåº”è¯¥ä¸ä¼šå§......ï¼Œå¯ä»¥å…ˆä¸‹å†è”ç³»å¤çŽ°ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ä¸¤ä¸ªç‰ˆæœ¬ Registry éƒ½æ˜¯èµ° HTTPS çš„ã€‚

> Qï¼šV2 å¥½åƒä»ç„¶æ²¡æœ‰è§£å†³ Registry æœ€å¤§çš„ç—›ï¼šå•ç‚¹ï¼Œä½ ä»¬æ€Žä¹ˆå¯¹å¾…è¿™ä¸ªé—®é¢˜çš„ï¼Ÿ

Aï¼šRegistry ä¸€ç›´éƒ½æ˜¯å¯ä»¥æ°´å¹³æ‰©å±•çš„ï¼Œåªæ˜¯ä¸€ä¸ª HTTP çš„æœåŠ¡å™¨æ˜¯æ— çŠ¶æ€çš„ä¸å­˜åœ¨å•ç‚¹é—®é¢˜ã€‚

> Qï¼šä¼ä¸šç§æœ‰äº‘åœºæ™¯ä¸‹ç”¨å¤šä¸ª Registry å®žçŽ° HA è¯¥å¦‚ä½•é€‰æ‹©åŽç«¯å­˜å‚¨ï¼Œäº¬ä¸œçš„ Speedy æ˜¯å¦åˆé€‚ï¼Ÿ

Aï¼šRegistry æœ‰ Swift çš„ driver ç§æœ‰äº‘å¯ä»¥è€ƒè™‘ï¼Œæˆ–è€…æ ¹æ®å·²æœ‰çš„æƒ…å†µé€‰æ‹©è‡ªå·±çš„å­˜å‚¨è‡ªå·±å†™ä¸ª driver ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå†™çš„éš¾åº¦å…¶å®žä¸å¤§ï¼Œä¸ƒç‰›é‚£ä¸ªä¸€ä¸ªä¸‹åˆå°±èƒ½å†™å‡ºæ¥ã€‚è¦æ±‚ä¸é«˜çš„è¯è¿˜æ˜¯ä¸éš¾çš„ã€‚äº¬ä¸œçš„ä¸æ˜¯å¤ªäº†è§£ï¼Œæˆ‘è§‰å¾—ä¸»è¦çœ‹çŽ°æœ‰çš„æŠ€æœ¯æ¡†æž¶å’Œäº§å“é€‰ä¸€ä¸ªæ˜“ä¸Šæ‰‹çš„å°±è¡Œã€‚æŠŠ Registry æ°´å¹³æ‰©å±•æŒ‚è½½ lb åŽé¢å°±å¥½äº†ã€‚

> Qï¼šV1 å·²ç»è¢«å®˜æ–¹ deprecatedï¼ŒV2 ä»ç„¶ç¼ºå°‘ä¸€äº›åŸºæœ¬çš„ç®¡ç† APIï¼Œè¯·é—®çŽ°åœ¨ç§æœ‰ Registry å‡çº§åˆ° V2 æ˜¯å¦è¿˜ä¸ºæ—¶è¿‡æ—©ï¼Ÿ

Aï¼šçœ‹éœ€æ±‚äº†å§ï¼Œæˆ‘è§‰å¾—è¦æ˜¯ç¨³å®šè€ƒè™‘ deprecated ä¹Ÿæ²¡å•¥å½±å“ï¼ŒV2 çš„å¾ˆå¤šå¥½å¤„ç¡®å®žåœ¨ç§æœ‰äº‘è¡¨çŽ°ä¸å‡ºæ¥ï¼Œåè€Œä¼šæœ‰ä¸€äº›è¡¨çŽ°ä¸å¦‚ V1 çš„åœ°æ–¹ã€‚

> Qï¼šç”¨ä¸ƒç‰›æµ·å¤–åŠ é€Ÿä¹‹å‰ç”¨å“ªç§æ–¹æ¡ˆçš„ï¼Ÿ

Aï¼šæˆ‘å…ˆç­”ä¸€ä¸‹è¿™ä¸ªå§ï¼Œè¿™ä¸ªæŒºæœ‰æ„æ€çš„ï¼Œæˆ‘ä»¬å‘çŽ°ä¸€ä¸ª tcp çš„æ‹¥å¡žç®—æ³•æ˜¯ç”¨äºŽå«æ˜Ÿé€šä¿¡çš„ï¼Œå«æ˜Ÿè¿™ç§é«˜å»¶è¿Ÿé«˜ä¸¢åŒ…çš„æ‹¥å¡žç®—æ³•è²Œä¼¼è¿˜è›®åˆé€‚å›½å¤–å¾€å›½å†…ä¼ æ•°æ®ã€‚

---

### 2015-10-14ï¼šä¼ä¸šçº§äº‘å¹³å°çš„å®žè·µå’Œæ€è€ƒ

> Qï¼šä½ è®¤ä¸ºé¢å‘èµ„æºå’Œé¢å‘åº”ç”¨æž¶æž„çš„åŒºåˆ«æ˜¯ï¼Ÿ

Aï¼šä¸€ä¸ªå…³æ³¨çš„èµ„æºçš„ä¾›ç»™ï¼Œä¸€ä¸ªå…³æ³¨åº”ç”¨çš„æž¶æž„ã€å®žçŽ°ç¬¬ 2 ä¸ªå…¶ä¸­ä¼šæœ‰ä¸€éƒ¨åˆ†èµ„æºçš„ç”³è¯·ã€ç®¡ç†é—®é¢˜ã€‚é¢å‘åº”ç”¨æ›´å…³æ³¨ä¸šåŠ¡ï¼Œæ‰€ä»¥ä¸Šå±‚çš„åº”ç”¨å¾€å¾€å«åšè´Ÿè½½ç®¡ç†ç³»ç»Ÿæˆ–ä»»åŠ¡ç®¡ç†ç³»ç»Ÿã€‚

> Qï¼šå¤§æ•°æ® HDFS æ˜¯åœ¨è™šæ‹Ÿæœº VM é‡Œé¢è¿˜æ˜¯çœŸå®žç‰©ç†æœºé‡Œé¢ï¼Ÿ

Aï¼šå»ºè®®ä¸è¦ä½¿ç”¨è™šæ‹Ÿæœºï¼Œé™¤éžèƒ½å°† IOPS æžåˆ°ç±»ä¼¼ç‰©ç†æœºçš„ç¨‹åº¦ï¼Œæˆ–è€…å°±æ˜¯ç”¨æ¥åšç®—æ³•éªŒè¯ï¼Œè¦ä¸å¯¹å­˜å‚¨ç³»ç»Ÿå†²å‡»å¤ªå¤§ã€‚

> Qï¼šç›®å‰ä½œè€…åˆ†äº«çš„ä¸€èˆ¬éƒ½æ˜¯åŸºäºŽäº’è”ç½‘ï¼Œé’ˆå¯¹ä¼ä¸šçº§å…¶å®žä¹Ÿæœ‰ç±»ä¼¼çš„æŠ€æœ¯ï¼Œå…·ä½“æœ‰å“ªäº›ï¼Œæ€Žä¹ˆå®žçŽ°ï¼Ÿ

Aï¼šæˆ‘ä»‹ç»çš„ç¬¬ä¸€ä¸ªäº§å“ EGO å°±æ˜¯å®Œå…¨é¢å‘ä¼ä¸šçš„ï¼Œä¸»è¦ç»™é‡‘èžç­‰é¢†åŸŸä½¿ç”¨ï¼Œæ¯”å¦‚èŠ±æ——é“¶è¡Œï¼Œå€’é—­çš„é›·æ›¼å…„å¼Ÿç­‰ï¼ŒçŽ°åœ¨ä¹Ÿåœ¨ç”µä¿¡ç­‰è¡Œä¸šä½¿ç”¨ï¼Œäº’è”ç½‘è¡Œä¸šåŸºæœ¬æ²¡æœ‰ç”¨æˆ·ã€‚

> Qï¼šåœ¨æœåŠ¡åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæž¶æž„å¦‚ä½•åŒæ—¶å…¼é¡¾è€çš„éžæœåŠ¡åŒ–çš„éƒ¨ä»¶å’ŒæœåŠ¡åŒ–çš„æœåŠ¡ï¼Ÿ

Aï¼šå…¶å®žæˆ‘ä»¬æœ‰ä¸ªå®žè·µå°±æ˜¯ï¼Œæœ‰çš„æœåŠ¡æˆ–éƒ¨ä»¶å°±è®©å®ƒéšç€æ—¶é—´ over å§ã€‚é‡è¦çš„è€ƒè™‘äº‘åŒ–ï¼Œå®žåœ¨ä¸è¡Œè€ƒè™‘ç›–ä¸ªå¸½å­å°è£…æˆæœåŠ¡ï¼Œå°±æ˜¯ç»å…¸çš„è®¾è®¡æ¨¡å¼ä¸­çš„é—¨é¢ï¼Œadapter ç­‰çš„åœ¨æœåŠ¡å±‚é¢çš„ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å«åšæœåŠ¡ç½‘å…³ä¹‹ç±»çš„ã€‚

> Qï¼šä½ ä»¬æ˜¯å¦‚ä½•å¯¹é›†ç¾¤èµ„æºåšåˆ°ç»†ç²’åº¦çš„ç®¡ç†çš„ï¼Œèƒ½è¯´è¯´ä½ ä»¬é‡åˆ°è¿‡å“ªäº›å‘å—ï¼Ÿ

Aï¼šä¸»è¦é€šè¿‡è®¾è®¡äº†èµ„æºç»„å’Œå„ç§èµ„æº tag æ¥è¿‡æ»¤èµ„æºï¼ŒåŒæ—¶è®¾è®¡äº†ä¸€ç§è§„åˆ™è¯­è¨€å’Œå¼•æ“Žæ”¯æŒ selectã€orderï¼Œæ”¯æŒå„ç§æ•°å­¦è¿ç®—å’Œä¸Žã€æˆ–éžçš„é€»è¾‘å…³ç³»æ¥è®©ç”¨æˆ·å®šä¹‰èµ„æºçš„éœ€æ±‚ã€‚æœ€å¤§çš„å‘å…¶å®žå°±æ˜¯èµ„æºç²’åº¦å®šä¹‰æœ‰ç‚¹é—®é¢˜ï¼Œä¸€åº¦éƒ½å‡ºçŽ°é›¶ç‚¹å‡ ä¸ª slot çš„æƒ…å†µï¼Œå…¶å®žç®€å•ç‚¹å°±å¥½äº†ï¼Œç”šè‡³éšæœºåˆ†é…éƒ½ä¼šæœ‰ä¸ªå¾ˆå¥½çš„æ•ˆæžœï¼Œæ¯•ç«Ÿè¿™ä¸ªå®‡å®™ä¹Ÿæ˜¯æ··æ²Œçš„ï¼Œå‘µå‘µã€‚å½“ç„¶åªæ˜¯ä¸ªäººçš„çœ‹æ³•ï¼Œå…¶ä»–äººä¸ä¸€å®šåŒæ„ã€‚

> Qï¼šä½ ä»¬è‚¯å®šæœ‰è€ƒè™‘è¿‡ç¡¬ä»¶èµ„æºä½¿ç”¨æƒ…å†µè´Ÿè½½çš„é—®é¢˜ï¼ŒDocker å®¹å™¨ä¸Šå‰æ®µæ—¶é—´å€’æ˜¯å‡ºäº†ç›‘æŽ§å®ï¼Œå¯ä»¥ç›‘æŽ§å®¹å™¨çš„å„ç§èµ„æºä½¿ç”¨æƒ…å†µï¼Œä½†æ˜¯æƒ³é—®ä¸‹ä»Šå¤©æ‚¨æåˆ°çš„"åº”ç”¨çš„èµ„æºä½¿ç”¨æƒ…å†µ"ï¼Œä½ ä»¬æ˜¯åšçš„å®žæ—¶ç›‘æŽ§å—ï¼Ÿè¿™ä¸ªæ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ

Aï¼šåŽŸæ¥ EGO çš„è°ƒåº¦ç­–ç•¥ä¸€ç›´æœ‰ä¸ªåŸºäºŽè´Ÿè½½çš„è§„åˆ™ï¼ŒLIM ä¼šå‡†å®žæ—¶çš„æ”¶é›†ç³»ç»Ÿçš„è´Ÿè½½ï¼ŒåŒ…æ‹¬ CPUã€MEMã€DISK ç­‰ä¿¡æ¯ç„¶åŽæ±‡æ€»åˆ° master LIM ä¾› EGO master ä½¿ç”¨ã€‚å¤©äº‘çš„ç³»ç»Ÿæž„å»ºäº†ä¸€å¥—è‡ªå·±çš„ç›‘æŽ§ä½“ç³»ã€ä¹Ÿæ”¯æŒ zabbix é‡‡é›†ä¿¡æ¯ï¼Œè¿˜æ”¯æŒåçš„ APM å…¬å¸ newrelic çš„ agent åè®®ï¼Œå¦å¤–ä¹Ÿå¼€æ”¾äº† APIï¼Œå¯ä»¥è‡ªå·±å®šåˆ¶ç›‘æŽ§é‡‡é›†ç³»ç»Ÿã€‚ç›‘æŽ§å®æˆ‘ä»¬ä¹Ÿçœ‹è¿‡ï¼Œç±»ä¼¼çš„éƒ½æœ‰å‡ ä¸ªï¼Œä¸è¿‡è¿™æ˜¯åº”ç”¨å¼€å‘å›¢é˜Ÿéœ€è¦è‡ªå·±é€‰æ‹©çš„ã€‚

> Qï¼šAuto Scaling è¿‡ç¨‹ä¸­æ˜¯éœ€è¦åœæ­¢æœåŠ¡å—ï¼Ÿ

Aï¼šä¸éœ€è¦åœæ­¢æœåŠ¡ï¼Œå‚è€ƒ AWS å’Œå…·ä½“ä¸šåŠ¡ï¼Œæˆ‘ä»¬è®¾è®¡äº†å¤šä¸ª AutoScaling groupï¼Œä¸€éƒ¨åˆ†ç”¨äºŽç³»ç»ŸåŸºæœ¬è¿è¡Œéœ€è¦çš„æœ€å°‘çš„èµ„æºï¼Œå…¶ä»–åˆ™ä¸ºåŠ¨æ€æ”¹å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šä¿ç•™æœ€å°‘çš„æœåŠ¡èŠ‚ç‚¹ã€‚

> Qï¼šå¤©äº‘çš„äº‘å¹³å°å¦‚ä½•è§£å†³å•ç‚¹é—®é¢˜ï¼Œé™¤äº†çƒ­å¤‡å†·å¤‡ï¼Œå®žçŽ°äº†åˆ†å¸ƒå¼å—ï¼Œæ€Žä¹ˆå®žçŽ°çš„ï¼Œåˆ†å¸ƒå¼çš„äº‹åŠ¡æ€Žä¹ˆå¤„ç†çš„ï¼Ÿ

Aï¼šå¤©äº‘äº‘å¹³å°ä¸€å¼€å§‹å°±æ˜¯ Load Balance æ¨¡å¼è®¾è®¡ï¼Œç±»ä¼¼ OpenStackï¼Œå•ç‚¹ä¸»è¦å°±æ˜¯æ•°æ®åº“ã€‚DB çš„é—®é¢˜ä¹Ÿæ˜¯é‡‡ç”¨å¸¸è§„çš„åšæ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨ç±»ä¼¼ etcdã€zk çš„æ–¹å¼ï¼Œä¸è¿‡è§„æ¨¡å¤§ä¸äº†ã€‚

> Qï¼šæˆ‘è§‰å¾—äº‘å¹³å°æœ€å¸å¼•äººæ˜¯å¼¹æ€§è°ƒåº¦ï¼Œèƒ½å¦å°±å¼¹æ€§è°ƒåº¦å¦‚ä½•å®žçŽ°è¿™ä¸ªé—®é¢˜ï¼Œåˆ†äº«äº›ç»éªŒç»™æˆ‘ä»¬ï¼Ÿ

Aï¼šä¸ªäººå»ºè®®ï¼Œå¤šç ”ç©¶ä¸€ä¸‹ AWS çš„ autoScaling æœåŠ¡ï¼Œæ¯”å¦‚ QingCloud çš„è°ƒåº¦æœåŠ¡å…¶å®žä¹Ÿæ˜¯å®ƒçš„ç®€åŒ–ç‰ˆã€‚å®ƒæ”¯æŒå®šæ—¶ã€æ‰‹åŠ¨ã€è§„åˆ™é©±åŠ¨ç­‰è§¦å‘æ–¹å¼ï¼Œå¯¹æ‰§è¡Œçš„åŠ¨ä½œä¹Ÿæœ‰å¾ˆå¤šå¯é…ç½®çš„æ–¹å¼ï¼Œæ¯”å¦‚å‘æ¶ˆæ¯ã€è‡ªåŠ¨æ‰§è¡ŒåŠ¨ä½œç­‰ã€‚

> Qï¼šEGO ä¸­å¯¹å®¹é”™æœºåˆ¶æ˜¯æ€Žä¹ˆç†è§£çš„ä¹ˆï¼Œèƒ½å¦è®²ä¸‹ï¼Ÿ

Aï¼šEGO çš„å®¹é”™åˆ†äº† 2 éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ç³»ç»Ÿæœ¬èº«çš„ï¼Œä¸»è¦é å…±äº«å­˜å‚¨æ¥ä¿å­˜æ ¸å¿ƒæ•°æ®ï¼Œç„¶åŽæ¯ä¸ªæ¨¡å—åšåˆ°å¯ä»¥éšæ„é‡å¯ã€‚åº”ç”¨ä¸»è¦é å…¶ä¸­çš„ egoscï¼Œå®ƒä¼šç›‘è§†åº”ç”¨çš„æ¨¡å—ï¼Œåšåˆ°æŒ‰ç…§å®šä¹‰çš„è§„åˆ™æ‰§è¡Œé‡å¯ç­‰åŠ¨ä½œï¼Œåº”ç”¨æœ¬èº«çš„æ•°æ®ä¸€è‡´é—®é¢˜ï¼Œåˆ™è¦åº”ç”¨è‡ªå·±å¤„ç†ã€‚

> Qï¼šèƒ½ä»‹ç»ä¸‹ Symphony åœ¨ DCOS ä¸­çš„ä½œç”¨ä¹ˆï¼Ÿ

Aï¼šSymphony æ•´ä½“æ˜¯ä¸ª SOA çš„ä»»åŠ¡æˆ–è´Ÿè´£ç®¡ç†ç³»ç»Ÿï¼Œåº•å±‚éœ€è¦ä¸€ä¸ªèµ„æºç®¡ç†ç³»ç»Ÿï¼Œç±»ä¼¼ Hadoopã€Habase ä¸Ž Yarn çš„å…³ç³»ã€‚

> Qï¼šEGO æ ¸å¿ƒ Master å®ƒæ˜¯åŸºäºŽæ’ä»¶çš„æž¶æž„ï¼Œæ”¯æŒçƒ­æ’æ‹”å—ï¼Ÿ

Aï¼šæ²¡æœ‰é‡‡ç”¨çƒ­æ’æ‹”ã€‚å› ä¸ºç³»ç»Ÿçš„æ¯ä¸ªç»„ä»¶éƒ½èƒ½å¤Ÿåšåˆ°é‡å¯ä¸ä¸¢æ•°æ®ï¼Œå¯åŠ¨æ—¶ä¼šå’Œç›¸å…³æ¨¡å—åŒæ­¥æ•°æ®å¹¶çº æ­£ä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œæ‰€ä»¥å¯¹ç³»ç»Ÿç¨³å®šè¿è¡Œæ²¡æœ‰å½±å“ï¼Œç±»ä¼¼ Google çš„æ€è·¯ï¼Œåšåˆ°æ¯ä¸ªç‚¹éƒ½èƒ½å¾ˆå®¹æ˜“çš„é‡å¯ã€‚

> Qï¼šèƒ½å¦ä»‹ç»ä¸€ä¸ªå…¸åž‹çš„è°ƒåº¦å™¨å®žçŽ°ç­–ç•¥?å¦‚ä½•è€ƒè™‘èµ„æºå’Œéœ€æ±‚çš„ï¼Ÿ

Aï¼šç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†æ‰€æœ‰çš„èµ„æºè¯·æ±‚å…ˆæ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œç„¶åŽé’ˆå¯¹è¯·æ±‚é‡‡ç”¨èƒŒåŒ…ç®—æ³•ï¼Œæˆ–è€…çº¿æ€§è§„åˆ’ç®—æ³•æ¥æ‰¾ä¸€ä¸ªæ¬¡ä¼˜è§£å°±è¡Œã€‚å› ä¸ºè¦è¿‘å®žæ—¶çš„ç»™å‡ºèµ„æºåˆ†é…ç»“æžœï¼Œæ‰€ä»¥æ²¡æœ‰æœ€ä¼˜è§£ã€‚

> Qï¼šäº‘å¹³å°çš„å®¹ç¾æŽªæ–½æ˜¯æ€Žä¹ˆæ ·ï¼Œæœ‰ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆï¼Ÿ

Aï¼šå®¹ç¾å…³é”®è¿˜æ˜¯æ•°æ®ï¼Œå…³é”®åœ¨ä¼ä¸šçš„å­˜å‚¨è®¾è®¡ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰å¤ªå¤šå»ºè®®ã€‚

> Qï¼šDocker ç½‘ç»œé€‰æ‹©æ˜¯ host è¿˜æ˜¯ natï¼Œæ€§èƒ½æŸå¤±åˆ†åˆ«æ˜¯å¤šå°‘ï¼Ÿ

Aï¼šDocker ç½‘ç»œçœŸå®žåªåœ¨è‡ªå·±çŽ¯å¢ƒç®¡ç†è‡ªå·± SkyForm ä½¿ç”¨è¿‡ï¼Œå…¶ä»–çš„éƒ½æ˜¯å®žéªŒå®¤çŽ¯å¢ƒï¼Œæ²¡æœ‰çœŸå®žçº¿ä¸ŠçŽ¯å¢ƒæµ‹è¯•ï¼Œæ²¡æ³•ç»™å‡ºå®žé™…æ•°æ®ï¼Œå»ºè®®åŽ»çœ‹ä¸€ä¸‹æ–°æµªã€é›ªçƒç­‰å…¬å¸çš„å»ºè®®ã€‚å½“å‰åªæ˜¯åœ¨ä¸€äº›é¡¹ç›®ä¸­å®žéªŒ Dockerï¼Œæ²¡æœ‰å¤§è§„æ¨¡åŽ»æŽ¨ã€‚

> Qï¼šç›®å‰æˆ‘ä»¬éƒ½æå€¡æœåŠ¡æŠ½è±¡ã€ç»„åˆåŒ–ï¼Œæˆ‘ä»¬ç›®çš„æ˜¯ä¸ºäº†å‘ç¨³å®šã€ä¾¿æ·çš„æ–¹å‘è¿›å–ï¼Œé‚£ä¹ˆï¼Œæˆ‘æƒ³é—®æ˜¯ç€é‡ç®¡ç†ï¼Œè¿˜æ˜¯ç€é‡æŠ€æœ¯åŠŸèƒ½æ–¹å‘å‘¢ï¼Ÿ

Aï¼šå…·ä½“åˆ†æžï¼Œå»ºè®®æŒ‰ç…§å»ºè®¾ã€å®žç”¨ã€è¿ç»´ã€ä¼˜åŒ–ç®¡ç†çš„æ¬¡åºæ¥è€ƒè™‘ã€‚

---

### 2015-10-08ï¼šå®¹å™¨å’Œ IaaSï¼šè°åŠ¨äº†è°çš„å¥¶é…ª

> Qï¼šå®¹å™¨å½“åšè™šæœºï¼ŒCloudFoundry çŽ°åœ¨èƒ½å¾ˆå¥½çš„æ”¯æŒ Docker Hub çš„ç”¨æ³•å—ï¼Œå¦‚ä½•åšåˆ°çš„ï¼Ÿ

Aï¼šå¾ˆæŠ±æ­‰æˆ‘ä¸æ˜¯å®¹å™¨çš„ä¸“å®¶ï¼Œå¯¹å„ä¸ªå®¹å™¨ç¼–æŽ’ç³»ç»Ÿäº†è§£ä¹Ÿæœ‰é™ã€‚ç¬¬ä¸€ä¸ªé—®é¢˜æˆ‘æ— æ³•å›žç­”ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰ç ”ç©¶è¿‡ CloudFoundry å¯¹ Docker Hub æ˜¯å¦‚ä½•æ”¯æŒçš„ã€‚ä½†ä»ŽæŠ€æœ¯ä¸Šæ¥è¯´ï¼ŒIaaS æ”¯æŒ Docker Hub æ²¡æœ‰æŠ€æœ¯éšœç¢ã€‚æˆ‘ä»¥å¤§å®¶ç†Ÿæ‚‰çš„ OpenStack ä¸¾ä¾‹ï¼ŒGlance å®Œå…¨è¢« Docker Hub åšæˆä¸€ä¸ªåŽç«¯ï¼Œç”¨æˆ·æ— éœ€ä¸Šä¼  imageï¼Œåªè¦è¾“å…¥è‡ªå·±çš„è´¦å·ï¼Œå°±å¯ä»¥æµè§ˆå’Œä¸‹è½½ image åˆ° cinder è¿™æ ·çš„å—å­˜å‚¨æœåŠ¡ã€‚å°†æ¥ ZStack å¯¹ Docker Hub çš„æ”¯æŒä¹Ÿæ˜¯è¿™ä¸ªæ€è·¯ï¼Œå³æŠŠ Docker Hub åšæˆæˆ‘ä»¬çš„ backup storage çš„ä¸€ä¸ªåŽç«¯æ’ä»¶ã€‚

> Qï¼šã€ŽMesos æ˜¯åœ¨å¤§è§„æ¨¡é›†ç¾¤ç”Ÿäº§çŽ¯å¢ƒä¸­è¿è¡Œ Docker çš„é»„é‡‘æ­æ¡£ã€‚ã€å¯¹è¿™å¥è¯ä½ çš„çœ‹æ³•æ˜¯ï¼Ÿä½ æåˆ°çš„å®¹å™¨ç¼–æŽ’ç³»ç»Ÿï¼Œæ˜¯å¦æŒ‡ Mesosï¼Œè¿˜æ˜¯æŒ‡ Docker Swarm æˆ– Kubernetes?

Aï¼šæˆ‘æŒ‡çš„å®¹å™¨ç¼–æŽ’ç³»ç»Ÿä¸»è¦å°±æ˜¯ k8sã€Mesosã€Rancher è¿™äº›ã€‚ä»–ä»¬çš„ä¸»è¦æ–¹å‘è¿˜æ˜¯å¥”ç€ App-Centric åŽ»çš„ã€‚è‡³äºŽè°æ˜¯ Docker çš„é»„é‡‘æ­æ¡£æˆ‘ä¸çŸ¥é“ï¼Œæˆ‘æ„Ÿè§‰æ¯å®¶éƒ½è¯´è‡ªå·±æ˜¯æœ€ä½³é€‰æ‹©å’Œé»„é‡‘æ­æ¡£ã€‚å½“ç„¶è¿™æ˜¯å› ä¸ºä»–ä»¬å¯¹æˆ‘å›½çš„æ–°å¹¿å‘Šæ³•ä¸å¤ªäº†è§£ã€‚

> Qï¼šå®¹å™¨é€‚é…ä¸åŒçš„ IaaSï¼šå®¹å™¨æ˜¯å¯¹æ“ä½œç³»ç»Ÿçš„è™šæ‹ŸåŒ–ï¼Œå¯¹ç½‘ç»œã€è®¡ç®—ã€å­˜å‚¨çš„é€‚é…æ˜¯æ“ä½œç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½ï¼Œå®¹å™¨é€‚é…ä¸åŒçš„ IaaS åº”è¯¥è‡ªç„¶å°±æœ‰çš„åŠŸèƒ½å§ï¼Ÿ

Aï¼šå®¹å™¨é€‚é… IaaS ä¸»è¦æ˜¯æŒ‡å®¹å™¨çš„ç¼–æŽ’ç³»ç»Ÿå¯ä»¥é€šè¿‡ IaaS çš„ API åŽ»èŽ·å–è‡ªå·±éœ€è¦çš„è®¡ç®—ã€ç½‘ç»œã€å­˜å‚¨çš„èµ„æºã€‚ä¾‹å¦‚é€šè¿‡ IaaS çš„ API åŽ»åˆ›å»ºè™šæœºï¼Œæ‹¿åˆ°è™šæœºçš„ IP åœ°å€åŽ»éƒ¨ç½²å®¹å™¨ï¼›åˆä¾‹å¦‚ä½¿ç”¨åˆ›å»ºç§æœ‰ç½‘ç»œç­‰åŠŸèƒ½ã€‚å¥½çš„ IaaS å¿…å®šæ˜¯æä¾›å…¨ API ç»™å®¹å™¨ç¼–æŽ’ç³»ç»Ÿä½¿ç”¨çš„ã€‚è¿™æ ·å®¹å™¨ç¼–æŽ’ç³»ç»Ÿå¯ä»¥ä¸“æ³¨å¾€ä¸Šåšï¼Œåš DevOps çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯æŠŠç²¾åŠ›æµªè´¹åœ¨ç®¡ç†å­˜å‚¨ã€ç½‘ç»œè¿™äº›å®ƒè‡ªå·±ä¸åˆ é™¤çš„ä¸œè¥¿ã€‚æ¯”å¦‚è¯´å®¹å™¨ç¼–æŽ’ç³»ç»ŸåŽ»ç¼–ç¨‹ç¡¬ä»¶äº¤æ¢æœºé…ç½®ç½‘ç»œï¼Œæˆ‘è®¤ä¸ºå°±æ˜¯æ–¹å‘èµ°åäº†ï¼Œæ˜¯åœ¨åš IaaS çš„ä¸œè¥¿ã€‚

> Qï¼šèƒ½ä¸èƒ½è¯¦ç»†ç‚¹è§£é‡Šä¸€ä¸‹ App-Centric æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ

Aï¼šApp-Centric è¦è§£é‡Šæ¸…æ¥šæ¯”è¾ƒéš¾ï¼Œè¿™ä¸ªè·Ÿ Microservicesã€Cloud-Native Apps ä¸€æ ·ã€‚è¦ç”¨ç®€å•çš„å‡ å¥è¯è§£é‡Šæ¸…æ¥šæ˜¯æ¯”è¾ƒéš¾çš„ã€‚æˆ‘ä¸ªäººç®€å•ç†è§£æ˜¯ï¼ŒApp-Centric çš„ç¼–æŽ’ç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯åº”ç”¨çš„çš„éƒ¨ç½²ã€ç®¡ç†ã€å‘å¸ƒã€æŒç»­é›†æˆï¼Œä¸€åˆ‡åŠŸèƒ½ä»¥åº”ç”¨ä¸ºä¸­å¿ƒè®¾è®¡ã€‚å¦‚æžœç¼–æŽ’ç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯ç®¡ç†è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œçš„ç¡¬ä»¶èµ„æºï¼Œé‚£è¿™ä¸ªæ˜¯ iaas çš„ç¼–æŽ’ç³»ç»Ÿï¼Œå°±ä¸æ˜¯ App-Centric çš„ã€‚

> Qï¼šé—®ä¸€ä¸‹è½»é‡çº§çš„ IaaSï¼Œé™¤äº† ZStack è¿˜æœ‰å“ªä¸ªæ¯”è¾ƒæˆç†Ÿï¼Ÿ

Aï¼šæˆ‘å½“ç„¶æƒ³è¯´æ˜¯ ZStackã€‚æˆ‘çœ‹åˆ°åŽé¢æœ‰å‡ ä¸ªå…³äºŽé—® ZStack çš„é—®é¢˜ï¼Œä¸ºäº†é¿å…åœ¨è¿™æ¬¡åˆ†äº«ä¸Šæ‰“å¹¿å‘Šï¼Œæˆ‘å°±ä¸è¯¦ç»†è®²äº†ã€‚æ¬¢è¿Žå¤§å®¶è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ zstack.org/cnï¼Œæˆ‘ä»¬æœ‰ 16 ç¯‡æŠ€æœ¯æ–‡ç« è®²æˆ‘ä»¬çš„ä¸åŒå’Œä¼˜åŠ¿ã€‚å¦å¤–å…³äºŽè·Ÿ OpenStack å’Œ CloudStack çš„å¯¹æ¯”ï¼Œå¤§å®¶ç™¾åº¦ä¸€ä¸‹ ZStackã€OpenStackã€CloudStack å°±å¯ä»¥æœåˆ°å‡ ç¯‡ä¸šå†…äººå£«å†™çš„å¯¹æ¯”æ–‡ç« ã€‚

> Qï¼šè™½ç„¶æœ‰äº¬ä¸œå’Œ 360 æ¡ˆä¾‹ï¼Œä½†ä½ æ”¯æŒæŠŠå®¹å™¨å½“è™šæ‹Ÿæœºä½¿ç”¨å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿå¾ˆå¤šäººæ›¾ç»å¾ˆè´¨ç–‘è¿™ç§æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æˆ‘ä¹Ÿåå¯¹ã€‚

Aï¼šè¿™ä¸ªé—®é¢˜å¾ˆéš¾è¯´æ”¯æŒå’Œä¸æ”¯æŒï¼Œæˆ‘åˆšæ‰ä¹Ÿè¯´äº†ï¼ŒæŠ€æœ¯äººå‘˜æœ‰è‡ªå·±çš„æƒ…æ€€å’Œåˆè¡·ï¼Œä½†å¸‚åœºæ˜¯ç”¨è„šæŠ•ç¥¨çš„ã€‚ç”¨æˆ·é€‰æ‹©äº†è¿™æ ·çš„æ–¹å¼ä¸€å®šæœ‰ä»–è‡ªå·±çš„ç†ç”±ï¼Œæ²¡æœ‰å¯¹é”™ä¹‹åˆ†ã€‚è¿ç»´äººå‘˜æœ‰ä¸€å¥è¯å«æ²¡æœ‰ç»å¯¹å¥½çš„æŠ€æœ¯ï¼Œåªæœ‰æœ€é€‚åˆçš„æŠ€æœ¯ã€‚å…¶å®žå¾ˆå®¹æ˜“ç†è§£ä¸ºå•¥å¤§å®¶ä¼šæŠŠå®¹å™¨å½“è™šæœºç”¨ï¼Œå› ä¸ºå·²æœ‰çš„å­˜é‡ç³»ç»Ÿéƒ½æ˜¯åŸºäºŽè™šæœºè®¾è®¡çš„ï¼Œè¦ä¸ºäº†å®¹å™¨çš„å‡ºçŽ°è€Œé‡å†™ä¸šåŠ¡ç³»ç»Ÿï¼Œæˆ‘è®¤ä¸ºé™¤éžæœ‰å·¨å¤§çš„ç—›ç‚¹ï¼Œå¦åˆ™å¾ˆå°‘æœ‰å…¬å¸ä¼šä¸»åŠ¨åŽ»è¿™ä¹ˆåšã€‚å½“ç„¶ï¼Œå¾ˆå¤šæ–°å…´äº’è”ç½‘å…¬å¸ï¼Œåœ¨æ²¡æœ‰åŽ†å²åŒ…è¢±çš„æƒ…å†µä¸‹ï¼Œæˆ‘éžå¸¸èµžåŒä»¥æ–°çš„æ–¹å¼åŽ»æž„å»ºä¸šåŠ¡ç³»ç»Ÿï¼Œä½†è¿™ä¹Ÿä¸æ˜¯é‚£ä¹ˆå®¹æ˜“çš„ã€‚å€Ÿ Netflix å›¢é˜Ÿçš„ä¸€å¥è¯è¯´ï¼šä½ çœ‹åˆ°äº†æˆ‘ä»¬çŽ°åœ¨å¾®æœåŠ¡åšçš„è¿™ä¹ˆå¥½ï¼Œæ˜¯å› ä¸ºæˆ‘æ²¡å‘Šè¯‰æˆ‘ä»¬å¡«è¿‡å¤šå°‘å‘ã€‚

> Qï¼šè¯·é—® IaaS+APP æ˜¯æ€Žæ ·çš„ä¸€ä¸ªæž¶æž„å‘¢ï¼Œåœ¨æ‚¨æœ€åŽä¸€æ®µåˆ†äº«é‡Œ"å› ä¸ºå¤§éƒ¨åˆ†è¿ç»´äººå‘˜å’Œå¼€å‘äººå‘˜ï¼Œæœ€ç†Ÿæ‚‰çš„è¿˜æ˜¯ä»¥è™šæœºçš„æ–¹å¼æž„å»ºåº”ç”¨ï¼Œå½“å®¹å™¨å¸¦æ¥äº†æ›´å¿«ã€å¯†åº¦æ›´é«˜ï¼Œæ›´è½»é‡çº§çš„è™šæ‹ŸåŒ–æŠ€æœ¯æ—¶ï¼Œå¤§é‡çš„å­˜é‡ç³»ç»Ÿè¿˜æ˜¯ä»¥ä»–ä»¬æœ€ç†Ÿæ‚‰çš„æ–¹å¼ï¼Œå°±æ˜¯è™šæœºæ–¹å¼æ¥ä½¿ç”¨å®¹å™¨æŠ€æœ¯ã€‚è¿™ä¸ªçŽ°å®žï¼Œä¸ºä¼ ç»Ÿ IaaS å¸¦æ¥äº†å·¨å¤§çš„æœºä¼šã€‚"ï¼Œå¯ä»¥ç®€å•ä»‹ç»ä¸‹"ä¸ºä¼ ç»Ÿ IaaS å¸¦æ¥äº†å·¨å¤§çš„æœºä¼š"ä¸­æœ‰å“ªäº›æœºä¼šå—ï¼Ÿ

Aï¼šè¿™ä¸ªå·¨å¤§çš„æœºä¼šå°±æ˜¯è®©æˆ‘ä»¬åæ€å¤§è€Œé‡çš„ IaaS ç³»ç»Ÿåˆ°åº•æ˜¯ä¸æ˜¯å®¢æˆ·æ‰€éœ€è¦çš„ï¼ŒIaaS ç³»ç»Ÿè‡ªèº«æ˜¯å¦éœ€è¦åšå‡æ³•åšè™šæ‹ŸåŒ– +ã€‚å› ä¸ºæˆ‘ä»¬çœ‹åˆ°ä½¿ç”¨å®¹å™¨çš„å¾ˆå¤šå…¬å¸ï¼Œä»–ä»¬æ²¡æœ‰ SDNï¼Œæ²¡æœ‰åˆ†å¸ƒå¼å­˜å‚¨ï¼Œä¸€æ ·æŠŠä¸šåŠ¡æ¬è¿åˆ°å®¹å™¨ä¸Šäº†ï¼Œè¿è¡Œçš„å¾ˆå¥½ã€‚é‚£ä¹ˆçŽ°åœ¨å¤§è€Œé‡ IaaS ç³»ç»Ÿè®¾è®¡ï¼Œæ˜¯ä¸æ˜¯è·¯èµ°åäº†ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯èƒ½å¤ŸæŠŠ IaaS ç®€åŒ–ï¼Œæä¾›æœ€æ–¹ä¾¿ã€æœ€å¯é ã€æœ€å®¹æ˜“çš„æ–¹å¼è®©å®¹å™¨ä½¿ç”¨ IaaSï¼Œè€Œä¸æ˜¯è®©å®¹å™¨å› ä¸º IaaS çš„å¤§è€Œé‡æ‹’ç» IaaS è€Œè‡ªå·±åŽ»åš IaaS çš„åŠŸèƒ½ã€‚

- æž—å¸†ï¼šå®¹å™¨å’Œè™šæ‹Ÿæœºæœ¬è´¨ä¸Šåªæ˜¯å®žçŽ°è™šæ‹ŸåŒ–çš„ä¸¤ç§æ–¹å¼ï¼Œä¸€å¼€å§‹åˆè¡·ä¸åŒï¼Œä¹‹åŽç”±äºŽç”¨æˆ·ä¹ æƒ¯è€Œäº§ç”Ÿä¸€äº›äº¤å‰ï¼Œæœ€ç»ˆè€Œè¨€å®¹å™¨çš„åº”ç”¨åœºæ™¯è¿˜æ˜¯ä¼šè¶‹äºŽ PaaS åŒ–çš„ã€‚æ²¡è®°é”™çš„è¯ï¼Œåœ¨äº¬ä¸œå’Œ 360 çš„ä¾‹å­é‡Œï¼Œæ˜¯å…ˆç»è¿‡äº† Docker åšè™šæ‹Ÿæœºè¿™æ ·çš„è¿‡æ¸¡æ—¶æœŸå§ï¼Œä½†æœ€ç»ˆçš„ç›®æ ‡åŒæ ·æ˜¯çœŸæ­£å°†å®¹å™¨çš„åˆ†å¸ƒå¼è°ƒåº¦ã€ç¼–æŽ’çš„ä¼˜åŠ¿å‘æŒ¥å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯èµ°å‘ç±»ä¼¼ PaaS çš„æ–¹å‘ã€‚

> Qï¼šæˆ‘çš„ç†è§£æ˜¯å®¹å™¨åšè™šæ‹Ÿæœºä½¿ç”¨è¿™ä¸ªè¿‡ç¨‹æ›´å¤šçš„å­˜åœ¨äºŽäº§å“åº•å­å·²ç»æ¯”è¾ƒé‡çš„ä¼ä¸šï¼Œå¾ˆå¤šäº’è”ç½‘ä¼ä¸šä¼šç›´æŽ¥ä»Žå®¹å™¨çš„ PaaS æ¨¡å¼å¼€å§‹ï¼Œä¸çŸ¥é“ä½ æ€Žä¹ˆçœ‹è¿™ä¸ªè§‚ç‚¹ï¼Ÿ

Aï¼šnova-docker ä¸çƒ­æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè¿™ç§è™šæœºç”¨æ³•ä¸æ˜¯å®¹å™¨ç¤¾åŒºçš„ä¸»æµã€‚k8sã€Mesos æ˜¯ä¸»æµã€‚ä½†å¤§å®¶è¦è®¤è¯†åˆ°å¼€å‘è€…åœˆå­é‡Œçš„çƒ­å¹¶ä¸ä»£è¡¨å¸‚åœºçƒ­ï¼ŒæŠ€æœ¯åœˆæ˜¯ä¸€ä¸ªæœ€å®¹æ˜“è‡ª high çš„ç¾¤ä½“ã€‚å½“ Hype Cycle è¿‡æ¸¡åˆ°è°·åº•æ—¶å¤§å®¶æ‰èƒ½çœ‹æ¸…æ¥šåˆ°åº•å¸‚åœºéœ€è¦çš„æ˜¯ä»€ä¹ˆæŠ€æœ¯ã€‚ZStack ç›®å‰æ²¡æœ‰è®¡åˆ’æŽ¨å‡º k8s è¿™æ ·çš„ç¼–æŽ’ç³»ç»ŸåŠŸèƒ½ï¼ŒæŠ€æœ¯ä¸Šä¸æ˜¯é—®é¢˜ï¼Œæˆ‘ä»¬çš„æž¶æž„æ˜¯ç¼–æŽ’ç³»ç»Ÿçš„é€šç”¨è®¾è®¡ï¼Œç”¨åŒè¡Œçš„è¯„ä»·è¯´ä½ ä»¬åŽ»åš 12306 éƒ½æ²¡é—®é¢˜ã€‚æˆ‘ä»¬çš„ä¸»è¦çš„è€ƒè™‘æ˜¯è¦ä¸“æ³¨ï¼Œå½“ä¸€ä¸ªè½¯ä»¶å·ç§°ä»€ä¹ˆéƒ½èƒ½åšï¼Œä»€ä¹ˆåŠŸèƒ½éƒ½æœ‰çš„æ—¶å€™ï¼Œé€šå¸¸æ„å‘³ç€å®ƒä»€ä¹ˆéƒ½åšä¸å¥½ï¼Œç”¨æˆ·ä¹Ÿä¼šæžä¸æ¸…æ¥šè¿™ä¸ªè½¯ä»¶åˆ°åº•è¦è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚ä½†æˆ‘ä»¬ä¹‹åŽä¸€å®šä¼šæŽ¨å‡ºè™šæ‹Ÿæœºç”¨æ³•çš„å®¹å™¨é›†æˆï¼Œè¿™ä¸ªå¯¹æˆ‘ä»¬æ¥è¯´éžå¸¸ç®€å•ï¼Œè€Œä¸”ä¹Ÿçœ‹åˆ°å¾ˆå¤šç”¨æˆ·åœ¨è¿™æ ·ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€å®šä¼šåŽ»åšã€‚

> Qï¼šæ€Žä¹ˆç†è§£ä»€ä¹ˆæ˜¯è½»é‡çº§çš„ IaaSï¼Œå’ŒçŽ°åœ¨çš„ä¼šæœ‰å“ªäº›å˜åŒ–å’ŒåŒºåˆ«ï¼Ÿ

Aï¼šè¿™ä¸ªå‰é¢ä¸€ä¸ªé—®é¢˜è°ˆåˆ°äº†ã€‚å³çŽ°åœ¨å¤§è€Œé‡çš„ IaaS è®¾è®¡ä¸ä¸€å®šæ˜¯å¸‚åœºéœ€è¦çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒOpenStack åœ¨æ–°ç‰ˆæœ¬é‡Œé¢åŽ»æŽ‰äº† nova-networkï¼Œéƒ¨ç½²ä¼ ç»Ÿçš„æ‰å¹³ç½‘ç»œä¹Ÿéœ€è¦ç”¨ neutronsï¼Œè¿™ä¸ªæˆ‘è®¤ä¸ºå°±æ˜¯é‡äº†ã€‚è½»é‡çº§çš„ IaaS å°±æ˜¯è¦ä½¿ç”¨æœ€ç¨³å®šã€æœ€ç®€å•çš„æŠ€æœ¯åŽ»å®žçŽ°ç”¨æˆ·çš„ä½¿ç”¨åœºæ™¯ã€‚è€Œä¸æ˜¯æœŸæœ›ç”¨ä¸€ç§æŠ€æœ¯å°±èƒ½å¤Ÿè§£å†³æ‰€æœ‰åœºæ™¯ï¼Œè¿™æ ·åªä¼šè¶Šåšè¶Šé‡ï¼Œè¶Šåšè¶Šå¤æ‚ã€‚

> Qï¼šé—®ä¸€ä¸ªè®¡ç®—çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„ç¨‹åºéœ€è¦ç”¨åˆ°å¤§é‡çš„ GPU èµ„æºï¼Œå®¹å™¨ç†è®ºä¸Šåº”è¯¥æ˜¯å¯ä»¥å’Œ CPU/å­˜å‚¨ä¸€æ ·é«˜æ•ˆçŽ‡ä½¿ç”¨çš„å§ï¼Œæœ‰ä»€ä¹ˆé™åˆ¶å—ï¼Ÿ

Aï¼šç†è®ºä¸Šæ˜¯å¯ä»¥çš„ï¼ŒCPU/å­˜å‚¨çš„ä½¿ç”¨æ•ˆçŽ‡å³ä½¿ç”¨ä¼ ç»Ÿè™šæ‹ŸåŒ–ä¹Ÿå·²ç»æ¯”è¾ƒé«˜äº†ï¼Œä½† IO ç›¸å¯¹äºŽå®¹å™¨æ¥è¯´ï¼Œè·¯å¾„å¤ªé•¿æœ‰æ€§èƒ½æŸå¤±ã€‚ä½¿ç”¨å®¹å™¨æ˜¯å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä»¥å‰ HPC ç”¨ä¸€ä¸ªä¸€å°ç‰©ç†æœºä¸€ä¸ªå®¹å™¨çš„æ–¹æ¡ˆã€‚

> Qï¼šä½ æ€Žä¹ˆçœ‹ hyper.sh å’Œ clear container ç­‰è¶…è½»é‡çº§ hypervisor å¯¹å®¹å™¨æŠ€æœ¯çš„å½±å“ï¼Ÿ

Aï¼šhyper.shã€clear container è§£å†³çš„ä¸»è¦æ˜¯å®¹å™¨çš„éš”ç¦»æ€§ã€å®‰å…¨æ€§çš„é—®é¢˜ã€‚å®ƒä»¬æ²¡æ”¹å˜å®¹å™¨ç¤¾åŒºå€¡å¯¼çš„ä¸»æµã€‚æ¯”å¦‚ hyper.sh çš„ç”¨æ³•è·Ÿ Docker å°±å¾ˆç±»ä¼¼ã€‚æ‰€ä»¥æˆ‘è®¤ä¸ºä»–ä»¬æ˜¯å¯¹å®¹å™¨ç¤¾åŒºçš„è¡¥å……ã€‚å½“ç„¶ï¼ŒåŠä¸ªæœˆå‰æˆ‘ä¹Ÿåœ¨è·Ÿ Intel çš„è™šæ‹ŸåŒ–å›¢é˜Ÿæ²Ÿé€šï¼Œå»ºè®®ä»–ä»¬åšè½»é‡çº§çš„è™šæœºï¼Œå› ä¸ºæˆ‘ä»¬æ„Ÿè§‰åˆ°å¸‚åœºå¯¹è¿™ä¸ªçš„éœ€æ±‚è¿˜æ˜¯å¾ˆå¼ºçš„ã€‚

> Qï¼šZStack è·Ÿ OpenStack ä¸‹çš„ Magnum æœ‰ä»€ä¹ˆç›¸åŒç‚¹å’ŒåŒºåˆ«ï¼Ÿ

Aï¼šå®Œå…¨æ²¡æœ‰ç›¸åŒç‚¹ã€‚æˆ‘ä»¬è¿˜æ˜¯çº¯ IaaSï¼Œæ²¡æœ‰ä¸ºå®¹å™¨åšç‰¹åˆ«çš„ç¼–æŽ’ç³»ç»Ÿã€‚

> Qï¼šå› ä¸ºæˆ‘æ˜¯ HPC å‡ºèº«ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œç®—æ³•å¼€å‘ç»•ä¸è¿‡åŽ»çš„ Intel Cluster Studio æ€Žä¹ˆåŠžï¼ŒæŽˆæƒæ€Žä¹ˆå¤„ç†ã€‚æˆ‘ä»¬åœ¨å¼€å‘ç®—æ³•çš„æ—¶å€™éœ€è¦æ·±åº¦ä¾èµ– MKL ä½ ä»¬æ˜¯æ€Žä¹ˆå¤„ç†çš„ã€‚å¦å¤–å°±æ˜¯ GPGPU computing è²Œä¼¼è¿˜æ²¡æ­£å¼æ”¯æŒï¼Œè¿™æ–¹é¢å®¹å™¨æŠ€æœ¯æ€Žä¹ˆå¤„ç†å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬åªæ˜¯æä¾›è®¡ç®—èµ„æºï¼Œåº”ç”¨å±‚é¢ã€ä¸šåŠ¡å±‚é¢æ˜¯ç”¨æˆ·è‡ªå·±éœ€è¦è§£å†³çš„ã€‚æˆ‘ä¸è®¤ä¸ºå®¹å™¨å¯ä»¥å¸®åŠ©è§£å†³è¿™äº›é—®é¢˜ã€‚

> Qï¼šç›®å‰ ZStack æœ‰æ²¡æœ‰ä»€ä¹ˆæˆåŠŸæ¡ˆä¾‹å—ï¼Ÿ

Aï¼šæœ‰çš„ï¼Œæˆ‘ä»¬å·²ç»æœ‰å®¢æˆ·ä½¿ç”¨å¼€æºç‰ˆç”Ÿäº§ä¸Šçº¿å‡ ä¸ªæœˆäº†ã€‚

> Qï¼šæˆ‘çš„ç†è§£æ˜¯å®¹å™¨åšè™šæ‹Ÿæœºä½¿ç”¨è¿™ä¸ªè¿‡ç¨‹æ›´å¤šçš„å­˜åœ¨äºŽäº§å“åº•å­å·²ç»æ¯”è¾ƒé‡çš„ä¼ä¸šï¼Œå¾ˆå¤šäº’è”ç½‘ä¼ä¸šä¼šç›´æŽ¥ä»Žå®¹å™¨çš„ PaaS æ¨¡å¼å¼€å§‹ï¼Œä¸çŸ¥é“ä½ æ€Žä¹ˆçœ‹è¿™ä¸ªè§‚ç‚¹ï¼Ÿ

Aï¼šè¿™ä¸ªå–å†³äºŽä¼ä¸šçš„åŽ†å²åŒ…è¢±å¤šé‡ã€‚è€ç‰Œäº’è”ç½‘å…¬å¸çš„ä¸šåŠ¡ç³»ç»Ÿä¹Ÿå¾ˆæˆç†Ÿç¨³å®šäº†ï¼Œè¦å®Œå…¨æ”¹æˆå®¹å™¨çš„ PaaS æ¨¡å¼ï¼Œä¾‹å¦‚å®¹å™¨å•è¿›ç¨‹ï¼Œä¸æ˜¯ç”¨ SSHï¼Œæˆ‘ä¸ªäººè§‰å¾—è¿˜æ˜¯æœ‰ä¸€å®šéš¾åº¦ï¼Œè€Œä¸”ä¼ä¸šåˆ‡æ¢çš„æ„æ„¿ä¹Ÿä¸è§å¾—å¼ºçƒˆï¼Œä½†åœ¨æ–°ä¸šåŠ¡ç³»ç»Ÿé‡Œé¢ä½¿ç”¨ PaaS çš„å®¹å™¨æ¨¡å¼æ˜¯éžå¸¸å¯èƒ½çš„ï¼Œæˆ‘ä¹ŸçŸ¥é“å¾ˆå¤šå…¬å¸æ­£åœ¨è¿™ä¹ˆåšã€‚

> Qï¼šå¦‚ä½•æ‘†è„±ç½‘ç»œçš„ä¾èµ–æ¥åˆ›å»ºä¸ª Docker çš„ image å‘¢ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæ˜¯ Docker ç”¨æˆ·è‡ªå·±çš„åŸºæœ¬æƒåˆ©ï¼Ÿ

Aï¼šè¿™ä¸ªåŸºæœ¬æƒåˆ©æˆ‘è§‰å¾—è¿˜æ˜¯è¦é—® GFWã€‚å›½å¤–çš„å¼€å‘äººå‘˜æ˜¯éžå¸¸éš¾ç†è§£æœ‰äº›ä»–ä»¬è®¤ä¸ºè·Ÿæ°´ç”µä¸€æ ·æ™®åŠçš„åŸºç¡€è®¾æ–½åœ¨æŸäº›åœ°æ–¹è¿˜æ˜¯å¾ˆå›°éš¾çš„ã€‚

> Qï¼šæˆ‘è®¤ä¸º PaaS å’Œ IaaS æ˜¯ä¸å¯åˆ†çš„ï¼ŒçŽ°åœ¨äººä¸ºåˆ†å¼€æ˜¯æœ‰é—®é¢˜çš„ï¼Œé•¿ä¹…å¿…ç„¶å’ŒäºŒä¸ºä¸€ï¼Œæ¥¼ä¸»æ€Žä¹ˆçœ‹ï¼Ÿåœ¨åˆäºŒä¸ºä¸€çš„å‰æä¸‹ï¼Œä¹Ÿä¸å­˜åœ¨å®¹å™¨å’Œ IaaS ä¹‹äº‰äº†ã€‚

Aï¼šå…¶å®žä»Žç”¨æˆ·çš„å±‚é¢æ¥è¯´ä»–ä»¬æ˜¯ä¸åˆ†çš„ï¼Œä»–ä»¬åªå…³å¿ƒè‡ªå·±çš„ä¸šåŠ¡ã€‚ä½†ä»Žå¼€å‘äººå‘˜çš„è§’åº¦æ¥è¯´è¿˜æ˜¯è¦åˆ†çš„ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯ç†æ¸…æ¥šè‡ªå·±è½¯ä»¶çš„ç•Œé™ï¼Œå¯¹è½¯ä»¶çš„æž¶æž„å’Œè®¾è®¡éƒ½éžå¸¸é‡è¦ã€‚æœªæ¥çš„äº§å“å¯ä»¥æä¾› IaaS å’Œ PaaS æ‰“åŒ…çš„äº§å“äº¤ä»˜ç»™å®¢æˆ·ï¼Œä½†å¼€å‘è‡ªå·±è¿˜æ˜¯è¦åˆ†æ¸…æ¥šäº§å“é‡Œé¢é‚£äº›æ˜¯ IaaS çš„ä¸œè¥¿ï¼Œå“ªäº›æ˜¯ PaaS çš„ä¸œè¥¿ï¼Œå¦è€…å¾ˆéš¾åšäº§å“ï¼Œåšè®¾è®¡ã€‚

> Qï¼šçœŸæ­£ App-Centric çš„æ˜¯ SaaSï¼Œå®¹å™¨ç¼–æŽ’é¡¶å¤šç®— PaaSï¼Œæˆ–è€…è¯´æ˜¯ PaaS+IaaSï¼ˆPaaSã€IaaS ç›¸äº’ä¾å­˜çš„ï¼‰ï¼Œè·Ÿ SaaS æ²¡å•¥å…³ç³»å§ï¼Ÿ

Aï¼šè¿™ä¸ªå‰é¢ä¹Ÿå›žç­”äº†ã€‚ç¼–æŽ’ç³»ç»Ÿçš„ App-Centric æˆ‘è®¤ä¸ºæ˜¯æŒ‡ç¼–æŽ’ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å›´ç»•ä»€ä¹ˆæœåŠ¡ä»€ä¹ˆè®¾è®¡çš„ã€‚å›´ç»•éƒ¨ç½²ã€åˆ†å‘ã€ç®¡ç†ã€è¿ç»´ã€æŒç»­é›†æˆçš„åº”è¯¥ç®— App-Centric çš„ç¼–æŽ’ç³»ç»Ÿã€‚å›´ç»•è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œçš„ç®— IaaSã€‚

> Qï¼šä½ è®¤ä¸ºä»¥åŽçš„è¶‹åŠ¿æ˜¯å®¹å™¨åªè¦é…åˆè½»é‡çº§åˆ« IaaSï¼ŸSDN é‚£äº›ç½‘ç»œå­˜å‚¨éƒ½ä¸ç”¨è€ƒè™‘ï¼Œé‚£é‡ IaaS åˆåº”ç”¨åœ¨ä»€ä¹ˆåœºæ™¯?

Aï¼šæˆ‘æ˜¯æŒ‡å¤§éƒ¨åˆ†ç”¨æˆ·åœºæ™¯ä½¿ç”¨è½»é‡çº§çš„ IaaS+ å®¹å™¨å°±è¶³å¤Ÿäº†ã€‚å› ä¸ºçŽ°åœ¨å¾ˆå¤šå®¹å™¨åº”ç”¨ä¹Ÿæ²¡æœ‰ä½¿ç”¨åˆ° SDNã€SDS è¿™äº›æŠ€æœ¯ï¼Œä¹Ÿå·²ç»éžå¸¸æµè¡Œäº†ã€‚SDNã€SDS è§£å†³äº†å¾ˆå¤šä¼ ç»ŸæŠ€æœ¯çš„ç—›ç‚¹ï¼Œå½“ç„¶ä»–ä»¬ä¹Ÿä¸æ˜¯é“¶å­å¼¹ï¼Œå¯¹ç”¨æˆ·çš„è¦æ±‚ä¹Ÿæ˜¯æ¯”è¾ƒé«˜çš„ã€‚æ‰€ä»¥æˆ‘çš„çœ‹æ³•æ˜¯ä¸èƒ½ç”¨æ–°æŠ€æœ¯åŽ»ç¡¬å¥—æ‰€æœ‰çš„åœºæ™¯ã€‚é‡çš„ IaaS æˆ‘è®¤ä¸ºé€‚åˆå…¬æœ‰äº‘åœºæ™¯ã€å¤§è§„æ¨¡ç§æœ‰äº‘åœºæ™¯çš„å®¹å™¨ä½¿ç”¨ï¼Œéœ€è¦ç”¨æˆ·æœ‰è¾ƒå¼ºçš„ IT è¿ç»´å›¢é˜Ÿï¼Œè§£å†³å¤æ‚çŽ¯å¢ƒä¸‹å¤šç§Ÿæˆ·çš„å®¹å™¨ä½¿ç”¨é—®é¢˜ã€‚

---

### 2015-10-02ï¼šæš´èµ°æ¼«ç”»çš„ Docker å®žè·µ

> Qï¼šç»Ÿè®¡æŸä¸ªæ¿å—åŒæ—¶åœ¨çº¿äººæ•°çš„å˜åŒ–è¶‹åŠ¿ã€‚

Aï¼šç”¨æˆ·æ¯æ¬¡è®¿é—®éƒ½æœ‰æ—¥å¿—ï¼Œæ—¥å¿—é‡ŒåŒ…æ‹¬è®¿é—®å†…å®¹ä»¥åŠç”¨æˆ·æ ‡è¯†ã€‚é¦–å…ˆ spark stream ä»Žæ—¥å¿—é‡ŒæŠ½å–å‡ºç‰¹å®šæ¿å—ä¸åŒç”¨æˆ·çš„è®¿é—®äº‹ä»¶ï¼Œä»¥ç§’ä¸ºå•ä½åˆå¹¶ç›¸åŒç”¨æˆ·äº‹ä»¶ã€‚

> Qï¼šè¯·é—® Docker æ˜¯éƒ¨ç½²åœ¨è£¸æœºè¿˜æ˜¯è™šæ‹Ÿæœºï¼ŒDocker çš„ç®¡ç†ç”¨çš„ä»€ä¹ˆï¼Ÿéƒ¨ç½²æ˜¯äººå·¥å—ï¼Ÿ

Aï¼šDocker æ˜¯è·‘åœ¨å›½å†…æŸäº‘ä¸»æœºä¸Šçš„ï¼Œæ‰€ä»¥åº”è¯¥ç®—è™šæœºã€‚

> Qï¼šä¼ ç»Ÿå…³ç³»æ•°æ®åº“æ€Žä¹ˆ Docker åŒ–çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬ä¼ ç»Ÿå…³ç³»æ•°æ®åº“å¹¶æ²¡æœ‰ Docker åŒ–ï¼Œä¸€æ–¹é¢æˆ‘ä»¬ç›´æŽ¥ç”¨çš„äº‘ä¸»æœºæä¾›çš„ sql æ•°æ®åº“æœåŠ¡ï¼Œå¦ä¸€æ–¹é¢ï¼Œä¹Ÿè®¸è¿™éƒ¨åˆ†åŽŸæœ‰çš„æ–¹æ¡ˆå¤ªæˆç†Ÿï¼ŒçŸ­æœŸ Docker å®Œå…¨å–ä»£å¯èƒ½æ¯”è¾ƒå›°éš¾ã€‚

> Qï¼šæ¯å°æœºå™¨ä¸Šéƒ½éƒ¨ç½² Logstashï¼Œé‚£ filter éƒ¨åˆ†åœ¨å“ªå¤„ç†ï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨ syslog æ¥è½¬å‘æ—¥å¿—åˆ°æ—¥å¿—æœåŠ¡å™¨ï¼Ÿ

Aï¼šfilter éƒ¨åˆ†æ˜¯é€šè¿‡ spark stream æ¥åšçš„ï¼ŒLogstash çº¯ç²¹æ”¶é›†è½¬å‘ï¼Œkafka æ˜¯ä¸€ä¸ª MQ ç³»ç»Ÿï¼Œè€Œä¸”å®žæ—¶åˆ†æžä»Ž Kafka åˆ° spark stream å¾ˆæ–¹ä¾¿ã€‚

> Qï¼šå¦‚ä½•åšå¾®æœåŠ¡æ‹†åˆ†çš„ï¼Œç»éªŒæ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šè¿™ä¸ªé—®é¢˜æˆ‘æ„Ÿè§‰æœ‰ç‚¹å¤§ï¼Œæˆ‘å°è¯•å›žç­”ä¸‹ï¼šå…ˆåšå¥½è¯¦ç»†çš„è®¡åˆ’ï¼Œå°½é‡ä¿è¯æœåŠ¡çš„å¹³ç¨³è¿‡æ¸¡ï¼Œå¿…è¦çš„æ—¶å€™ï¼Œè€ç³»ç»Ÿå’Œæ–°ç³»ç»ŸåŒæ—¶ä¿ç•™ä¸€æ®µæ—¶é—´ã€‚

> Qï¼šDocker ç”¨çš„æ—¶å€™å¯ä»¥æŒ‚è½½å­˜å‚¨ï¼Ÿå°±æ˜¯æƒ³æŠŠé™æ€çš„ç½‘ç«™å›¾æ–‡æ•°æ® Docker åŒ–ï¼Œè¿™äº›é™æ€æ–‡ä»¶æˆ‘ä»¬å­˜å‚¨åœ¨å•ç‹¬çš„åˆ†å¸ƒå¼å­˜å‚¨å’Œé˜µåˆ—ä¸­ï¼Œèµ°çš„ nfs åè®®å’Œç§æœ‰ api çš„å½¢å¼ã€‚

Aï¼šè¿™ä¸ªæ”¾ image é‡Œå¥½åƒä¸æ˜¯å¥½ä¸»æ„ï¼Œè¦ä¸ç”¨ä¸€äº›åˆ†å¸ƒå¼çš„å­˜å‚¨æ–¹æ¡ˆï¼Œè¦ä¸ç”¨äº‘å­˜å‚¨æœåŠ¡?

> Qï¼š"ä¸€ä»½ copy å­˜åˆ° hdfs é‡Œ"è€ƒè™‘è¿‡å…¶ä»–çš„å­˜å‚¨å—ï¼Ÿ

Aï¼šSpark æœ‰æ–¹ä¾¿çš„å¯¹ hdfs çš„æŽ¥å£ï¼Œä¸”äº‘æœåŠ¡å•†æœ‰çŽ°æˆçš„ hdfs æœåŠ¡æä¾›ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç”¨äº†ã€‚

> Qï¼šä¸ºä»€ä¹ˆé€‰æ‹© Logstashï¼Œè€Œä¸é€‰æ‹© Flumeï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆå·®å¼‚ï¼Œæ¯”å¦‚å¯¹å®‰è£…ç«¯çš„èµ„æºå¼€é”€æŠ•å…¥äº§å‡ºæ¯”ç­‰ï¼Ÿ

Aï¼šæœ€è¿‘åœ¨ç ”ç©¶ç”¨ hekaï¼Œå¼€å§‹ç”¨ Logstash çš„è¯æ˜¯å› å›¢é˜Ÿæœ¬èº«çš„çŸ¥è¯†åå¥½(Ruby å›¢é˜Ÿ)ã€‚

> Qï¼šæˆ‘è§‰å¾—åœ¨æ•°æ®æœåŠ¡éƒ¨åˆ†è®²äº†å¤ªå¤šï¼Œæˆ‘æ›´æƒ³çŸ¥é“ Docker åœ¨å¼€å‘ï¼Œæµ‹è¯•æˆ–ç”Ÿäº§çŽ¯å¢ƒæ€Žä¹ˆä½¿ç”¨ï¼Œåˆ©ç”¨ä»€ä¹ˆæ–¹å¼ç®¡ç† Docker é›†ç¾¤ï¼Œéƒ¨ç½²æœåŠ¡ï¼Ÿæ¯”å¦‚é‚£ä¸ª shell+etcd æ¥å¯åŠ¨ Docker æ˜¯æ€Žä¹ˆå›žäº‹ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ä¸€äº› Docker ç”Ÿæ€ç›¸å…³çš„å¼€æºå·¥å…·ï¼Œæ¯”å¦‚ k8sã€swarm ä¹‹ç±»ï¼Ÿ

Aï¼šå…³äºŽä¸ºä»€ä¹ˆæ²¡ç”¨ k8sã€‚æˆ‘å¼€å§‹ä¹Ÿè¯´äº†ï¼Œé€‰æ‹©æŠ€æœ¯æž¶æž„ä¸å…‰è¦è€ƒè™‘æŠ€æœ¯æœ¬èº«ï¼Œè¿˜è¦è€ƒè™‘å›¢é˜Ÿèµ„æºï¼Œä»¥åŠçŽ°æœ‰çš„é™åˆ¶ã€‚æˆ‘ä»¬ç”¨çš„å›½å†…çš„äº‘ä¸»æœºï¼Œè¿™æ ·çš„å‰æä¸‹è¦åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ç”¨ k8s æœ¬èº«å°±ä¸å¤ªå¯èƒ½ã€‚å¦å¤–æŠ€æœ¯å›¢é˜Ÿäººæ‰‹ä¹Ÿå¾ˆæ¬ ç¼ºã€‚

> Qï¼šè¯·é—® Docker å®¹å™¨æ˜¯å¦‚ä½•è¿›è¡Œè¿œç¨‹éƒ¨ç½²å’Œè‡ªåŠ¨éƒ¨ç½²çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬ç”¨äº†ä¼ ç»Ÿçš„éƒ¨ç½²å·¥å…·(Ansible)ã€‚

> Qï¼šAnsible å¦‚ä½•èŽ·å– Docker ä¸»æœºåˆ—è¡¨ï¼Œæ‰€æœ‰çš„ Docker å®¹å™¨ï¼Ÿ

Aï¼šAnsible æ˜¯æ“ä½œäº‘ä¸»æœºçš„ï¼Œå°±å’Œä»¥å‰çš„ç”¨æ³•ä¸€æ ·ã€‚

> Qï¼šè¯·é—® ping nginx èŽ·å¾—ç”¨æˆ·ç‚¹å‡»æ˜¯æ€Žä¹ˆåšçš„ï¼Œå¯ä»¥è¯¦ç»†ä»‹ç»ä¸‹å—ï¼Ÿ

Aï¼šå°†æŸäº›ç»Ÿè®¡æ•°æ®æ”¾åœ¨ ping æŽ¥å£çš„å‚æ•°é‡Œï¼Œè¿™æ ·å®šåˆ¶ nginx çš„æ—¥å¿—å¯ä»¥è®°å½•ä¸‹æ¥ã€‚

> Qï¼šååžƒåœ¾ç³»ç»Ÿæ•°æ®åº“çš„æ•°æ®æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼è¿›å…¥ Kafka çš„ï¼Œoggã€sqoop å—ï¼Ÿ

Aï¼šæ ·æœ¬æ•°æ®çš„è¯æ˜¯ rails ç¨‹åºæŽ¨è¿› mq çš„ã€‚

> Qï¼šæœç´¢å¼•æ“Žé€‰ Elasticsearch è€Œä¸æ˜¯ Solrï¼Œå¯ä»¥è®²ä¸€ä¸‹è¿™æ ·é€‰æ‹©éƒ½æœ‰å“ªäº›è€ƒè™‘å—ï¼Ÿ

Aï¼šElasticsearch ä¸ä»…ä»…æ˜¯ä¸ªæœç´¢å¼•æ“Žï¼Œæ›´æ˜¯æˆ‘ä»¬ç”¨æ¥åšç»“æžœèšåˆçš„ databaseï¼Œè€Œä¸”æœ‰å¾ˆå¥½çš„æ°´å¹³æ‰©å±•ç‰¹æ€§ã€‚

---

### 2015-09-23ï¼šåŸºäºŽ Docker å’Œ Java çš„æŒç»­é›†æˆå®žè·µ

> Qï¼šCI è¿‡ç¨‹ä¸­ test éœ€è¦è¿žæŽ¥æ•°æ®åº“çš„ä»£ç æ—¶ï¼Œæ‚¨åœ¨å†™æµ‹è¯•æ¡ˆä¾‹æ–¹é¢æœ‰å“ªäº›ç»éªŒåˆ†äº«ï¼Ÿ

Aï¼šå•å…ƒæµ‹è¯•ä¸èƒ½ä¾èµ–å¤–éƒ¨èµ„æºï¼Œç”¨ mockï¼Œæˆ–è€…ç”¨ h2 ç­‰å†…å­˜æ•°æ®åº“æ›¿ä»£ã€‚é›†æˆæµ‹è¯•çš„æ—¶å€™æ˜¯ä»ŽæŽ¥å£å±‚ç›´æŽ¥è°ƒç”¨æµ‹è¯•çš„ï¼Œæµ‹è¯•ç”¨ä¾‹å¯¹æ•°æ®åº“æ— æ„ŸçŸ¥ã€‚

> Qï¼šè¯·é—®éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒæ˜¯è‡ªåŠ¨è§¦å‘è¿˜æ˜¯éœ€è¦æ‰‹åŠ¨å®¡æ‰¹ï¼ŸSQL æ‰§è¡Œæˆ–å›žæ»šæ˜¯å¦è‡ªåŠ¨åŒ–ï¼Ÿ

Aï¼šå½“å‰æ˜¯éœ€è¦æ‰‹åŠ¨è§¦å‘ã€‚SQL æ›´æ–°å½“å‰æ²¡åšåˆ°è‡ªåŠ¨åŒ–ï¼Œè¿™å—æ­£åœ¨æ”¹è¿›ï¼Œå› ä¸ºéƒ¨ç½²ç§æœ‰çŽ¯å¢ƒéœ€è¦ã€‚SQL ä¸æ”¯æŒå›žæ»šï¼Œä»£ç åšå…¼å®¹ã€‚Docker é•œåƒå›žæ»šæ²¡æœ‰è‡ªåŠ¨åŒ–ã€‚

> Qï¼š é—®ä¸€ä¸‹ä½ ä»¬çš„ Redis å†…å­˜ç‰ˆæ˜¯ç”¨çš„ä»€ä¹ˆï¼Ÿ

Aï¼šæˆ‘ä»¬ç”¨çš„å†…å­˜ç‰ˆçš„ redis æ˜¯ [spullara/redis-protocol](https://github.com/spullara/redis-protocol) ä¸­çš„ server å®žçŽ°ã€‚ä¸è¿‡è¿™ä¸ªå®žçŽ°éƒ¨åˆ†åŠŸèƒ½æ²¡æ”¯æŒï¼Œæ¯”å¦‚ lua è„šæœ¬ï¼Œæˆ‘ä»¬è‡ªå·±åšäº†æ”¹è¿›ã€‚

> Qï¼šä»‹ç»ä¸‹ workflow å¸¦æ¥çš„å¥½å¤„ã€‚

Aï¼šworkflow çš„å¥½å¤„æˆ‘é‚£ç¯‡æ–‡ç« ä¸­æœ‰è¯´æ˜Žï¼Œå¦‚æžœæ²¡æœ‰ workflowï¼Œæ‰€æœ‰çš„æ­¥éª¤éƒ½åœ¨åŒä¸€ä¸ªé…ç½®çš„ä¸åŒ step å®žçŽ°ï¼Œå¦‚æžœåŽé¢çš„å¤±è´¥ï¼Œè¦é‡æ–°ä»Žå¤´å¼€å§‹ã€‚workflow å¯ä»¥ä¸­é€”å¼€å§‹ï¼Œå¹¶ä¸”æ¯ä¸€æ­¥éª¤å®Œæˆéƒ½ä¼šè§¦å‘é€šçŸ¥ã€‚

> Qï¼šh2 å¹¶ä¸å®Œå…¨å…¼å®¹ MySQL è„šæœ¬ï¼Œä½ ä»¬å¦‚ä½•å¤„ç†çš„ï¼Ÿ

Aï¼šæˆ‘ä»¬é€šè¿‡ä¸€äº› hack çš„åŠžæ³•ï¼Œä¼šæŽ¢æµ‹ä¸‹æ•°æ®åº“æ˜¯ä»€ä¹ˆç±»åž‹çš„ï¼Œæ›¿æ¢æŽ‰ä¸€äº›ä¸å…¼å®¹çš„ SQLï¼Œè¿›è¡Œå®¹é”™ã€‚

> Qï¼šè¯·é—®ä½ ä»¬åœ¨æž„å»ºçš„æ—¶å€™ï¼Œä½ è¯´æœ‰äº›éœ€è¦åŠä¸ªå°æ—¶å·¦å³ï¼Œé‚£ä¹ˆæž„å»ºè¿‡ç¨‹çš„è¿›åº¦ç›‘æŽ§å’Œå¥åº·ç›‘æŽ§ä½ ä»¬æ€Žä¹ˆåšçš„å‘¢ï¼Œå¦‚æžœæœ‰ build å¤±è´¥äº†æ€Žä¹ˆå¤„ç†å‘¢ï¼Ÿ

Aï¼šCI çš„æ¯ä¸€æ­¥éƒ½æœ‰è¿›åº¦çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å›¢é˜Ÿé€šè®¯å·¥å…·å¯ä»¥å’Œ CI é›†æˆï¼Œå¦‚æžœå¤±è´¥ä¼šå‘æ¶ˆæ¯åˆ°ç¾¤é‡Œé€šçŸ¥å¤§å®¶ã€‚

> Qï¼šcleanup è„šæœ¬åšå“ªäº›ï¼Ÿ

Aï¼šä¸»è¦æ˜¯æ¸…ç†æ—§çš„ Docker é•œåƒï¼Œä»¥åŠæ¸…ç†è‡ªåŠ¨åŒ–æµ‹è¯•äº§ç”Ÿçš„åžƒåœ¾æ•°æ®ã€‚

> Qï¼šè¯·é—®ä½ ä»¬æ–‡ä»¶å­˜å‚¨æ€Žä¹ˆè§£å†³çš„å‘¢ï¼Œä½¿ç”¨è‡ªå·±çš„ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿè¿˜æ˜¯äº‘æœåŠ¡ï¼Ÿ

Aï¼šæ–‡ä»¶ç³»ç»Ÿæ”¯æŒå¤šç§ storage é…ç½®ï¼Œå¯ä»¥æ˜¯æœ¬åœ°ç›®å½•ï¼ˆä¾¿äºŽæµ‹è¯•ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿äº‘æœåŠ¡ï¼ˆæ¯”å¦‚ s3ï¼‰ã€‚

> Qï¼šåˆšæ‰è¯´ä½ ä»¬èƒ½é€šè¿‡ä¸€é”®éƒ¨ç½²ï¼Œä½†æ˜¯ä¸­é—´æ— æ³•ç›‘æŽ§ï¼Œæµ‹è¯•çŽ¯å¢ƒå¯ä»¥è¿™ä¹ˆçŽ©ï¼Œé‚£ç”Ÿäº§çŽ¯å¢ƒä½ ä»¬æ˜¯æ€Žä¹ˆåšçš„å‘¢ï¼Ÿè¿˜æœ‰ä½ ä»¬åŽç»­çš„æ”¹é€ æ–¹å‘æ˜¯è‡ªå·±å¼€å‘ï¼Ÿè¿˜æ˜¯é‡‡ç”¨é›†æˆç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Ÿ

Aï¼šç”Ÿäº§çŽ¯å¢ƒ shell å½“å‰åªèƒ½æ˜¯å¤šåŠ é”™è¯¯åˆ¤æ–­ã€‚è¿™å—æˆ‘ä»¬åœ¨æ”¹è¿›ï¼Œæ¯”å¦‚é€šè¿‡ ansible ç­‰å·¥å…·ï¼Œä»¥åŠä½¿ç”¨ Kubernetes å†…ç½®çš„ rolling-updateã€‚è‡ªåŠ¨åŒ–éƒ¨ç½²è¿™å—è¿˜æ²¡æœ‰å¥½çš„å¼€æºå·¥å…·ã€‚

> Qï¼šä½ ä»¬çš„æµ‹è¯•ç”¨äº†å¾ˆå¤šä»£æ›¿æ–¹æ¡ˆã€å¦‚ h2 ä»£ MySQLï¼Œè¦ä¿è¯æµ‹è¯•æ•ˆæžœï¼Œé™¤äº†ä½ ä»¬ç”¨çš„ hack æ–¹æ³•ä¹‹å¤–ï¼Œæ˜¯ä¸æ˜¯ä»Žå†™ä»£ç çš„æ—¶å€™å°±å¼€å§‹åšäº†æ–¹ä¾¿æµ‹è¯•çš„è®¾è®¡ï¼Ÿ

Aï¼šå¯¹ã€‚è¿™ä¹Ÿæ˜¯æˆ‘æ–‡ç« ä¸­åˆ†äº«çš„è§‚ç‚¹ä¹‹ä¸€ã€‚æµ‹è¯•ç”¨ä¾‹çš„ç¼–å†™äººå‘˜è¦æœ‰ä¸šåŠ¡ä»£ç çš„ä¿®æ”¹æƒé™ï¼Œæœ€å¥½æ˜¯åŒä¸€ä¸ªäººã€‚è¦åšè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä¸šåŠ¡ä»£ç å¿…é¡»è¦ç»™æµ‹è¯•ç•™å„ç§é’©å­ä»¥åŠåŽé—¨ã€‚

> Qï¼šè¯·é—®ä½ ä»¬çš„é›†ç¾¤åº”ç”¨ç¼–æŽ’æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šä¸Šé¢è¯´äº†ï¼Œè¿˜æ²¡ç”¨åˆ°ç¼–æŽ’ã€‚ä¸€ç›´ç­‰ç¼–æŽ’å·¥å…·çš„æˆç†Ÿã€‚æ­£åœ¨æµ‹è¯• k8sã€‚

> Qï¼šä½ ä»¬åšè¿™ä¸ªé¡¹ç›®é€‰åž‹æ˜¯å‡ºäºŽä»€ä¹ˆè€ƒè™‘çš„ï¼Œä»‹ç»é‡Œæœ‰æåˆ°ä½¿ç”¨ä¸€äº›è„šæœ¬æ¥ç®¡ç†å®¹å™¨è§£å†³å¼€å‘å’Œæµ‹è¯•å„ç§é—®é¢˜ï¼Œæ„Ÿè§‰è¿™ç§ç®¡ç†å®¹å™¨æ–¹å¼è¿‡äºŽç®€å•ä¼šå¸¦æ¥ç®¡ç†é—®é¢˜ï¼Œä¸ºä½•ä¸ç”¨ç¬¬ä¸‰æ–¹å¼€æºé¡¹ç›®æ¥åšäºŒæ¬¡å¼€å‘ï¼Œå¦‚ï¼šKubernetesï¼›å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸‹ä¸€æ­¥æœ‰æ²¡æœ‰è€ƒè™‘å¦‚ä½•è®©ä½ çš„ Docker å’Œäº‘æœåŠ¡å¹³å°ç»“åˆï¼Œè¦è§£å†³è¿è¥æˆæœ¬é—®é¢˜ï¼ˆDocker æœ€å¤§å¸å¼•åŠ›åœ¨è¿™é‡Œï¼‰ï¼Œè€Œä¸åªæ˜¯è§£å†³å¼€å‘æµ‹è¯•é—®é¢˜ï¼Ÿ

Aï¼šå› ä¸ºæˆ‘ä»¬æœ€æ—©ç”¨çš„æ—¶å€™ k8s 1.0 è¿˜æ²¡æœ‰ï¼Œå˜åŒ–å¤ªå¤§ï¼Œåˆ›ä¸šå›¢é˜Ÿæ²¡ç²¾åŠ›è·Ÿè¿›ï¼Œè„šæœ¬æ˜¯ç²—æš´ç®€å•çš„åŠžæ³•ã€‚ä¸€ç›´åœ¨ç­‰å¾…å„ç§åŸºäºŽ Docker çš„äº‘è§£å†³æ–¹æ¡ˆå‘€ï¼Œè‚¯å®šè€ƒè™‘ç»“åˆã€‚

> Qï¼šå¯¹äºŽ Docker storage åˆ†åŒºç”¨å®Œé—®é¢˜ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œä½ ä»¬æ˜¯ä½¿ç”¨ Docker å®˜æ–¹æä¾›çš„ Registry ä»“åº“å—ï¼Œå¦‚ä½•è§£å†³ä»“åº“å•ç‚¹é—®é¢˜ï¼Œè¿™æœºå™¨è¦æ˜¯æ•…éšœäº†æ€Žä¹ˆåŠžï¼Ÿ

Aï¼šRegistry ç”¨çš„æ˜¯å®˜æ–¹çš„ï¼ŒåŽç«¯å­˜å‚¨æ˜¯æŒ‚è½½åˆ° s3 ä¸Šçš„ã€‚æ²¡æœ‰ s3,æŽ¨èä½¿ç”¨äº¬ä¸œç”°çªå›¢é˜Ÿå¼€æºçš„ [Speedy](https://github.com/jcloudpub/speedy)ï¼Œå®žçŽ°äº†åˆ†å¸ƒå¼å­˜å‚¨ã€‚

> Qï¼šé™¤äº†ä»‹ç»çš„ Java ç›¸å…³çš„ CI æ–¹æ¡ˆï¼Œå¯¹äºŽ C/C++ å¼€å‘è¯­è¨€æœ‰æ²¡æœ‰æŽ¨èçš„ CI æ–¹æ¡ˆï¼Ÿ

Aï¼šTeamcity/Jenkins ç­‰ CI å·¥å…·æ”¯æŒä»»ä½•è¯­è¨€çš„ã€‚å…¶å®žä»»ä½•è¯­è¨€çš„ CI éƒ½å·®ä¸å¤šï¼Œå•å…ƒæµ‹è¯•ï¼Œé›†æˆæµ‹è¯•ã€‚å…³é”®è¿˜åœ¨äºŽä¾èµ–çŽ¯å¢ƒçš„å‡†å¤‡ä»¥åŠé›†æˆæµ‹è¯•ç”¨ä¾‹çš„ç®¡ç†ã€‚

> Qï¼šæˆ‘çœ‹åˆ°ä½ ä»¬ä¸ºäº†æ–¹ä¾¿æµ‹è¯•å’Œè°ƒè¯•ä¼šæœ‰ç‹¬ç«‹çš„é›†åˆ Docker çŽ¯å¢ƒï¼Œè¿™ç§çŽ¯å¢ƒå’Œä¸Šçº¿çŽ¯å¢ƒå…¶å®žæ˜¯æœ‰å·®åˆ«çš„ï¼Œè¿™æ ·æµ‹è¯•çš„ç»“æžœèƒ½å¤Ÿä»£è¡¨çº¿ä¸ŠçŽ¯å¢ƒå—ï¼Ÿè¿™ç§é—®é¢˜æ€Žä¹ˆçœ‹å¾…ï¼Ÿ

Aï¼šæ‰€ä»¥æˆ‘ä»¬æœ‰å¤šä¸ªæµç¨‹ã€‚æ¸…ç†æ•°æ®çš„æµ‹è¯•çŽ¯å¢ƒï¼Œä»¥åŠä¸æ¸…ç†çŽ¯å¢ƒçš„æ²™ç®±çŽ¯å¢ƒã€‚ä½†è¿™ä¹Ÿä¸èƒ½é¿å…ä¸€éƒ¨åˆ†çº¿ä¸ŠçŽ¯å¢ƒçš„æ•°æ®å¯¼è‡´çš„ bugã€‚å¦å¤–å°±æ˜¯é…åˆç°åº¦ä¸Šçº¿æœºåˆ¶ã€‚å½“å‰æˆ‘ä»¬çš„ç°åº¦æ˜¯é€šè¿‡ä»£ç ä¸­çš„å¼€å…³å®žçŽ°çš„ï¼Œä½¿ç”¨è¿™ç§æ–¹æ¡ˆçš„ä¹Ÿå¾ˆå¤šï¼Œæ¯”å¦‚ facebook çš„ Gatekeeperã€‚

> Qï¼šè¯·é—® Grouk æœ‰æ¶‰åŠå‰ç«¯ï¼ˆNode.js æ–¹é¢çš„ï¼‰å¹¶ç»“åˆ Docker çš„ CI/CD ç»åŽ†å—ï¼Œå¯ä»¥åˆ†äº«ä¸‹å—ï¼Ÿ

Aï¼šè¿™æˆ‘ä»¬ä¹Ÿåœ¨å°è¯•ã€‚å½“å‰ js çš„æµ‹è¯•ä¸»è¦è¿˜æ˜¯åŸºäºŽ [ariya/phantomjs](https://github.com/ariya/phantomjs)ï¼Œçº¯ç²¹çš„ js åº“æ¯”è¾ƒæ–¹ä¾¿æµ‹è¯•ï¼Œä½†å¦‚æžœç‰µæ‰¯åˆ°ç•Œé¢ï¼Œå°±æ¯”è¾ƒå¤æ‚äº›äº†ã€‚

---

### 2015-09-15ï¼šMesos åœ¨åŽ»å“ªå„¿ç½‘çš„åº”ç”¨

> Qï¼šMesos å’Œ Yarn çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ

Aï¼šMesos çš„ä¸»è¦ç›®æ ‡å°±æ˜¯åŽ»å¸®åŠ©ç®¡ç†ä¸åŒæ¡†æž¶ï¼ˆæˆ–è€…åº”ç”¨æ ˆï¼‰é—´çš„é›†ç¾¤èµ„æºã€‚æ¯”å¦‚è¯´ï¼Œæœ‰ä¸€ä¸ªä¸šåŠ¡éœ€è¦åœ¨åŒä¸€ä¸ªç‰©ç†é›†ç¾¤ä¸ŠåŒæ—¶è¿è¡Œ Hadoopï¼ŒStorm åŠ Sparkã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒçŽ°æœ‰çš„è°ƒåº¦å™¨æ˜¯æ— æ³•å®Œæˆè·¨æ¡†æž¶é—´çš„å¦‚æ­¤ç»†ç²’åº¦çš„èµ„æºå…±äº«çš„ã€‚Hadoop çš„ YARN è°ƒåº¦å™¨æ˜¯ä¸€ä¸ªä¸­å¤®è°ƒåº¦å™¨ï¼Œå®ƒå¯ä»¥å…è®¸å¤šä¸ªæ¡†æž¶è¿è¡Œåœ¨ä¸€ä¸ªé›†ç¾¤é‡Œã€‚ä½†æ˜¯ï¼Œè¦ä½¿ç”¨æ¡†æž¶ç‰¹å®šçš„ç®—æ³•æˆ–è€…è°ƒåº¦ç­–ç•¥çš„è¯å°±å˜å¾—å¾ˆéš¾äº†ï¼Œå› ä¸ºå¤šä¸ªæ¡†æž¶é—´åªæœ‰ä¸€ç§è°ƒåº¦ç®—æ³•ã€‚æ¯”å¦‚è¯´ï¼ŒMPI ä½¿ç”¨çš„æ˜¯ç»„è°ƒåº¦ç®—æ³•ï¼Œè€Œ Spark ç”¨çš„æ˜¯å»¶è¿Ÿè°ƒåº¦ã€‚å®ƒä»¬ä¸¤ä¸ªåŒæ—¶è¿è¡Œåœ¨ä¸€ä¸ªé›†ç¾¤ä¸Šä¼šå¯¼è‡´ä¾›æ±‚å…³ç³»çš„å†²çªã€‚è¿˜æœ‰ä¸€ä¸ªåŠžæ³•å°±æ˜¯å°†é›†ç¾¤ç‰©ç†æ‹†åˆ†æˆå¤šä¸ªå°çš„é›†ç¾¤ï¼Œç„¶åŽå°†ä¸åŒçš„æ¡†æž¶ç‹¬ç«‹åœ°è¿è¡Œåœ¨è¿™äº›å°é›†ç¾¤ä¸Šã€‚å†æœ‰ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ä¸ºæ¯ä¸ªæ¡†æž¶åˆ†é…ä¸€ç»„è™šæ‹Ÿæœºã€‚æ­£å¦‚ Regola å’Œ Ducom æ‰€è¯´çš„ï¼Œè™šæ‹ŸåŒ–è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ€§èƒ½ç“¶é¢ˆï¼Œå°¤å…¶æ˜¯åœ¨é«˜æ€§èƒ½è®¡ç®—ï¼ˆHPCï¼‰ç³»ç»Ÿä¸­ã€‚è¿™æ­£æ˜¯ Mesos é€‚åˆçš„åœºæ™¯------å®ƒå…è®¸ç”¨æˆ·è·¨æ¡†æž¶æ¥ç®¡ç†é›†ç¾¤èµ„æºã€‚

Mesos æ˜¯ä¸€ä¸ªåŒå±‚è°ƒåº¦å™¨ã€‚åœ¨ç¬¬ä¸€å±‚ä¸­ï¼ŒMesos å°†ä¸€å®šçš„èµ„æºæä¾›ï¼ˆä»¥å®¹å™¨çš„å½¢å¼ï¼‰ç»™å¯¹åº”çš„æ¡†æž¶ã€‚æ¡†æž¶åœ¨ç¬¬äºŒå±‚æŽ¥æ”¶åˆ°èµ„æºåŽï¼Œä¼šè¿è¡Œè‡ªå·±çš„è°ƒåº¦ç®—æ³•æ¥å°†ä»»åŠ¡åˆ†é…åˆ° Mesos æ‰€æä¾›çš„è¿™äº›èµ„æºä¸Šã€‚å’Œ Hadoop

YARN çš„è¿™ç§ä¸­å¤®è°ƒåº¦å™¨ç›¸æ¯”ï¼Œæˆ–è®¸å®ƒåœ¨é›†ç¾¤èµ„æºä½¿ç”¨æ–¹é¢å¹¶ä¸æ˜¯é‚£ä¹ˆé«˜æ•ˆã€‚ä½†æ˜¯å®ƒå¸¦æ¥äº†çµæ´»æ€§------æ¯”å¦‚è¯´ï¼Œå¤šä¸ªæ¡†æž¶å®žä¾‹å¯ä»¥è¿è¡Œåœ¨ä¸€ä¸ªé›†ç¾¤é‡Œã€‚è¿™æ˜¯çŽ°æœ‰çš„è¿™äº›è°ƒåº¦å™¨éƒ½æ— æ³•å®žçŽ°çš„ã€‚å°±ç®—æ˜¯ Hadoop

YARN ä¹Ÿåªæ˜¯å°½é‡äº‰å–åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸Šæ”¯æŒç±»ä¼¼ MPI è¿™æ ·çš„ç¬¬ä¸‰æ–¹æ¡†æž¶è€Œå·²ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œéšç€æ–°æ¡†æž¶çš„è¯žç”Ÿï¼Œæ¯”å¦‚è¯´ Samza æœ€è¿‘å°±è¢« LinkedIn å¼€æºå‡ºæ¥äº†------æœ‰äº† Mesos è¿™äº›æ–°æ¡†æž¶å¯ä»¥è¯•éªŒæ€§åœ°éƒ¨ç½²åˆ°çŽ°æœ‰çš„é›†ç¾¤ä¸Šï¼Œå’Œå…¶å®ƒçš„æ¡†æž¶å’Œå¹³å…±å¤„ã€‚

> Qï¼šåŸºç¡€æž¶æž„é‡Œé¢ï¼Œæ•°æ®æŒä¹…åŒ–æ€Žä¹ˆåšçš„ï¼Ÿä½¿ç”¨æ˜¯ä¹ˆæž¶æž„çš„å­˜å‚¨ï¼Ÿ

Aï¼šæŒä¹…åŒ–å‰¥ç¦»åœ¨é›†ç¾¤å¤–éƒ¨ï¼ŒMesos 0.23 æä¾›äº†æŒä¹…åŒ–çš„æ”¯æŒï¼Œä½†æ˜¯æ²¡æ•¢ä¸Šåˆ°ç”Ÿäº§çŽ¯å¢ƒä¸­ã€‚

> Qï¼šStorm on Mesosï¼Œå¿«å¯ç”¨äº†å—ï¼Ÿæ˜¯å¦è·Ÿ Spark on Mesos åšè¿‡æ¯”è¾ƒï¼Ÿ

Aï¼šStorm on Mesos çš„ä»£ç åœ¨ GitHub å¯ä»¥æ‰¾åˆ°ï¼Œè¯´å®žè¯åªæ˜¯åŸºç¡€åŠŸèƒ½ï¼Œè®¸å¤šèµ„æºçš„æŽ§åˆ¶å’Œ attributes çš„ä¸œè¥¿éƒ½æ²¡æœ‰åšï¼Œè€Œä¸”æˆ‘ä»¬çš„æµ‹è¯•å‘çŽ° storm on mesos çš„æ¶ˆæ¯ ack ç‰¹åˆ«æ…¢ã€‚ä¸å»ºè®®ç›´æŽ¥æ‹¿æ¥å°±è·‘ã€‚

> Qï¼šå‘å¸ƒç”¨çš„ä¸šåŠ¡é•œåƒæ˜¯æ€Žä¹ˆåˆ¶ä½œçš„ï¼Œå¹³å°æœ‰ç›¸å…³åŠŸèƒ½æ”¯æŒå—ï¼Ÿè¿˜æ˜¯ç”¨æˆ·æ‰‹å·¥åšå¥½ä¸Šä¼ ï¼Ÿ

Aï¼šJenkins build çš„é•œåƒï¼Œå¯ä»¥ç”¨ Jenkins on Mesos è¿™ä¸ªæ¡†æž¶ï¼Œå®‰è£… Docker å’Œ mesos æ’ä»¶å°±å¯ä»¥å¼€å§‹ç”¨äº†ã€‚

> Qï¼šåšè¿™ä¹ˆä¸ªå¹³å°ç”¨å¤šå¤§è§„æ¨¡çš„å›¢é˜Ÿå¼€å‘çš„ï¼Ÿç”¨äº†å¤šä¹…ï¼Ÿ

Aï¼šå¼€å§‹ 2 ä¸ªäººï¼Œæœ€å¤šçš„æ—¶å€™ 5 ä¸ªäººï¼ŒçŽ°åœ¨ä¿æŒåœ¨ 4 ä¸ªäººã€‚ä»Ž 5 æœˆä»½åˆ°çŽ°åœ¨ä¸€ç‚¹ä¸€ç‚¹æµ‹è¯•ï¼Œæ‰©å®¹æ…¢æ…¢å †å‡ºæ¥çš„ã€‚

> Qï¼šé•œåƒå­˜å‚¨å•æœºåº”è¯¥æ˜¯ä¸è¡Œçš„ï¼Œä½ ä»¬æ˜¯æ€Žä¹ˆç®¡ç†é•œåƒçš„ï¼Ÿ

Aï¼šé•œåƒæ”¾ swift é‡Œäº†ã€‚

> Qï¼šDocker é‡‡ç”¨ host æ–¹å¼ï¼Œæ˜¯ä»€ä¹ˆè€ƒè™‘æˆ–è€…é™åˆ¶ï¼Œæ•ˆæžœæ€Žä¹ˆæ ·ï¼Ÿ

Aï¼šå¹³å°æœ¬èº«å°±æ˜¯å¤§åžåé‡çš„ï¼Œbridge æ¨¡å¼æ€§èƒ½æµ‹è¯•éƒ½åä½Žï¼Œå°±é€‰æ‹©äº† host æ¨¡å¼è·‘äº†ã€‚

> Qï¼šMesos çš„è°ƒåº¦ç®—æ³•æ˜¯æ€Žæ ·çš„ï¼Ÿæœ‰æ²¡æœ‰åšå®¹å™¨çš„é«˜å¯ç”¨ï¼Ÿ

Aï¼šåŒå±‚è°ƒåº¦ï¼Œåº•å±‚ offer ä¸€ä¸ªèµ„æºåˆ—è¡¨ç»™ frameworkï¼Œframework æ ¹æ® CPU å’Œå†…å­˜åŽ»åˆ—è¡¨ä¸­è¿‡æ»¤ï¼Œé€‰ä¸­åˆé€‚çš„ slave éƒ¨ç½²ï¼Œframework å±‚çš„è°ƒåº¦å¯ä»¥éšæ„å®žçŽ°ã€‚Marathon å·²ç»å¸®å¿™åšäº†é«˜å¯ç”¨ã€‚

> Qï¼šä½¿ç”¨æ•ˆæžœå¦‚ä½•ï¼Ÿ600 å®¹å™¨éƒ¨åœ¨å¤šå°‘å°æœºå™¨ä¸Šï¼ŒCPU å’Œå†…å­˜ä½¿ç”¨çŽ‡å¤šå°‘ï¼Ÿæœ‰ä»€ä¹ˆæå‡èµ„æºä½¿ç”¨çŽ‡çš„ç­–ç•¥å—ï¼Ÿ

Aï¼šæ•ˆæžœè¾¾åˆ°é¢„æƒ³äº†ï¼Œ600 å°åˆ†éƒ¨åœ¨äº†æ··åˆé›†ç¾¤ä¸Šï¼Œæœ‰ VM å’Œå®žä½“æœºï¼Œå…¨éƒ¨æŠ˜ç®—çš„è¯å¤§æ¦‚ 30 å°å·¦å³å§ï¼Œç›®å‰èµ„æºè¿˜æœ‰å¯Œä½™ï¼Œä¸»è¦æ˜¯é¢„ç•™ bufferã€‚ä¸æŽ¨èè·‘è™šæ‹Ÿæœºï¼ŒMesos çš„èµ„æºåˆ†é…å°±æ˜¯ä¸€åˆ€åˆ‡ï¼Œå³ä½¿æ²¡ç”¨ä¹Ÿç®—çš„ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºåˆ©ç”¨çŽ‡ä¼šå¾ˆä½Žã€‚

> Qï¼šmesos åœ¨å“ªä¸€å±‚é¢å®žæ–½äº† paxos æŠ•ç¥¨ï¼Ÿ

Aï¼šleader çš„é€‰ä¸¾ï¼Œmesos å…¶å®žæ˜¯ä¸¤å¥—é€‰ä¸¾ï¼Œå³ä½¿ zk æŒ‚äº† mesos master ä¹Ÿå¯ä»¥è‡ªå·±é€‰ä¸¾ leaderã€‚

> Qï¼šä¸ºä»€ä¹ˆé€‰æ‹© hekaï¼Œè€Œä¸æ˜¯ fluendï¼Œç„¶åŽ logstash æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ

Aï¼šfluent å’Œ heka æˆ‘ä»¬éƒ½åœ¨ç”¨ï¼Œéƒ½æ˜¯æ”¶å®¹å™¨æ—¥å¿—ï¼Œheka å¯ä»¥ä»Žå®¹å™¨çš„ ENV é‡Œè¯»æ›´å¤šä¸œè¥¿å‡ºæ¥ã€‚æ¢ logstash ä¸»è¦çœ‹é‡äº† heka çš„ç›‘æŽ§ï¼Œèµ„æºå ç”¨å’Œå¤„ç†é€Ÿåº¦ã€‚

> Qï¼šä¼šæ¶‰åŠæ•°æ®å·çš„è¿ç§»å—ï¼Œæœ‰ä»€ä¹ˆå¥½è§£å†³æ–¹æ¡ˆï¼Ÿ

Aï¼šç›®å‰å¹³å°é‡Œæ²¡æœ‰æŒä¹…åŒ–çš„ä¸œè¥¿ã€‚è¿™å—ä¸æ•¢è¯´ç”¨ä»€ä¹ˆåˆé€‚ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡å¼€å§‹å°è¯•ã€‚

> Qï¼šé•œåƒåšæˆä»£ç åº“å’Œè¿è¡ŒçŽ¯å¢ƒå…·ä½“æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä¸ºä»€ä¹ˆè¿è¡ŒçŽ¯å¢ƒæ–¹å¼åˆé€‚ï¼Ÿ

Aï¼šé•œåƒå…·ä½“åšæˆä»€ä¹ˆæ ·è¦æ ¹æ®è‡ªå·±çš„åº”ç”¨æ¥åˆ¤æ–­ï¼Œæˆ‘ä»¬ç”¨çš„ logstashã€statsd ä»€ä¹ˆçš„ï¼Œéƒ½æ˜¯é…ç½®æ–‡ä»¶æè¿°æµç¨‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº†è¿è¡ŒçŽ¯å¢ƒçš„æ–¹å¼ã€‚

> Qï¼šé•œæ–¹å¼åƒåšæˆä»£ç åº“å’Œè¿è¡ŒçŽ¯å¢ƒå…·ä½“æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

Aï¼šä»£ç åº“å°±æ˜¯è¯´ä½ æŠŠä½ å·¥ç¨‹çš„ä»£ç ï¼Œé…ç½®ä»€ä¹ˆçš„éƒ½å…¨éƒ¨æ‰“æˆä¸€ä¸ªé•œåƒã€‚è¿è¡ŒçŽ¯å¢ƒå°±æ˜¯æœ‰ä¸€äº› bin æˆ–è€… Javaã€PHP è¿™äº›å·¥å…·çš„ï¼Œå¯åŠ¨åŽæ‰ä¸‹è½½ä»£ç ï¼Œé…ç½®ã€‚

> Qï¼šä½ ä»¬ä¼šä¸ä¼šé‡åˆ°è·¨æœºæˆ¿çš„ MesOS é—®é¢˜å•Šï¼Œå¦‚æžœè·¨æœºæˆ¿ï¼Œæ€Žä¹ˆåŠžï¼Ÿ

Aï¼šæœ‰è·¨æœºæˆ¿çš„æƒ…å†µï¼Œæˆ‘ä»¬æœºæˆ¿é—´æœ‰ logstash ä¸“é—¨è½¬å‘æ—¥å¿—æµé‡ï¼Œç»Ÿä¸€ç®¡æŽ§ã€‚

> Qï¼šæ¯”å¦‚æ•°æ®åº“åˆå§‹åŒ–çš„è„šæœ¬ï¼Œåšåœ¨é•œåƒé‡Œåˆé€‚è¿˜æ˜¯æœ‰å…¶ä»–æ–¹å¼æ¯”è¾ƒå¥½ï¼Ÿ

Aï¼šdb çš„æ•°æ®æ–‡ä»¶å…¶å®žæŒºéš¾è„±ç¦»å¤–å±‚çš„åº”ç”¨å•ç‹¬è¯´çš„ï¼Œå› ä¸ºæœ‰ä¸šåŠ¡çº¿ä»£ç å¼•èµ·çš„ schema å˜æ›´ï¼Œæœ€å¥½å…ˆè§£å†³ db ci çš„é—®é¢˜ï¼Œç„¶åŽå†è€ƒè™‘æ•°æ®ä½•æ—¶åŠ è½½ï¼Œå¯ä»¥æ˜ å°„ä¸Šå¯¹åº” schema çš„æ—¶å€™ï¼Œdb æ–‡ä»¶å¯ä»¥å…ˆä»Ž swift ç­‰å…±äº«å­˜å‚¨ç›´æŽ¥ä¸‹è½½åˆ°æœ¬åœ°ä½¿ç”¨ï¼Œæˆ–è€…ç”¨è„šæœ¬é‡æ–°åˆå§‹åŒ–ä¹Ÿå¯ä»¥ï¼Œæˆ‘ä»¬çš„å¿«é€Ÿ rebuild çŽ¯å¢ƒæ­£åœ¨è¯•éªŒã€‚ä¸šåŠ¡çº¿è¿˜ä¸æ•¢è¿™ä¹ˆæ¥ã€‚

> Qï¼šç”¨è¿è¡ŒçŽ¯å¢ƒæ–¹å¼ï¼Œå®¹å™¨å¯åŠ¨åŽå†æ‹‰ä»£ç å’Œé…ç½®ï¼Œä¸ç¬¦åˆ Docker è®¾è®¡é•œåƒçš„åˆè¡·å§ï¼Œæ€Žä¹ˆåšåˆ°ä¸€å¤„æ‰“åŒ…åˆ°å¤„è¿è¡Œï¼Œé•œåƒä¸æ˜¯å®Œæ•´å¯æ‰§è¡Œçš„ï¼Ÿ

Aï¼šä¸»è¦æ˜¯ä»£ç åº“ç‰ˆæœ¬å’Œé•œåƒçš„ tag å¦‚ä½•æ˜ å°„ï¼Œä¸ºäº†ç®€å•ç‚¹å¯ä»¥è€ƒè™‘å¯åŠ¨åŽä¸‹è½½ä»£ç ï¼Œå¦‚æžœä»£ç å·²ç»ç¼–è¯‘å¥½æ”¾åˆ°äº†å…±äº«å­˜å‚¨é‡Œç›´æŽ¥ä¸‹è½½ä»£ç åŒ…ä¹Ÿå¯ä»¥ã€‚æˆ‘ä»¬ç›®å‰æ²¡æœ‰è€ƒè™‘è¿‡æŠŠä»£ç åº“ç‰ˆæœ¬å’Œé•œåƒ tag æ˜ å°„è¿™ä¸ªé—®é¢˜ã€‚

> Qï¼šMesos èµ„æºç»Ÿè®¡ä¼šå‡ºçŽ°ä¸Žå®žé™…ä¸ç¬¦ï¼Œä½ ä»¬çš„è§£å†³æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šè¦çœ‹æ˜¯ä»€ä¹ˆèµ„æºäº†ï¼ŒMesos çš„åˆ’èµ„æºçš„æ ¼å­å±žäºŽä¸€åˆ€åˆ‡çš„æ–¹å¼ï¼Œå³ä½¿ä½ æ²¡ç”¨æ»¡ä¹Ÿä¼šè¢«å½’å…¥å·²ä½¿ç”¨çš„èµ„æºé‡Œï¼Œå¦‚æžœä»Žè¿™ä¸ªè§’åº¦çœ‹ï¼Œå®žé™…è¿è¡Œçš„èµ„æºå’Œ Mesos å†…ä¸ŠæŠ¥çš„èµ„æºç¡®å®žä¸ä¸€è‡´ï¼Œä½†æ˜¯è€ƒè™‘åˆ°è®¡ç®—èµ„æºçš„å‘¨æœŸæ€§ï¼Œçªå‘æ€§ï¼Œè¿˜æ˜¯æŽ¨èä»¥ Mesos ä¸ŠæŠ¥çš„èµ„æºä¸ºå‡†ã€‚æˆ‘ä»¬è‡ªå·±è·‘åœ¨ Mesos ä¸Šçš„ç›‘æŽ§ framework æœ¬èº«ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ã€‚

> Qï¼šcAdvisor å¥½åƒåªèƒ½ç›‘æŽ§å•æœºå®¹å™¨æƒ…å†µï¼Œé‚£å¯¹äºŽé›†ç¾¤çš„å®¹å™¨ç›‘æŽ§ï¼Œä½¿ç”¨ ca æ€Žä¹ˆå¤„ç†å‘¢ï¼Ÿ

Aï¼šæˆ‘ä»¬ç›®å‰æ˜¯ cAdvisor èšåˆå¥½ä»¥åŽå‘ç»™æˆ‘ä»¬çš„å…¬å¸çš„ç›‘æŽ§å¹³å°ï¼Œç”±ç›‘æŽ§å¹³å°ç»Ÿä¸€å¤„ç†ã€‚æœ€æ–°ç‰ˆå·²ç» merge äº†è®¸å¤š storage-driver äº†ï¼Œstatsd å€¼å¾—è¯•ä¸€ä¸‹ã€‚

---

### 2015-09-08ï¼šDocker ä¸‰å‰‘å®¢ä¹‹ Swarm ä»‹ç»

> Qï¼šKubernetes å’Œ Swarm ç›¸æ¯”è¾ƒæ¥çœ‹å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ

Aï¼šä¸€ä¸ªå¾ˆ Open çš„è¯é¢˜ï¼Œæ ¹æ®ç‰¹ç‚¹ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„å°± OKã€‚Swarm å¯¹å¤–æä¾› Docker APIï¼Œè‡ªèº«è½»é‡ã€å­¦ä¹ æˆæœ¬ã€äºŒæ¬¡å¼€å‘æˆæœ¬éƒ½æ¯”è¾ƒä½Žï¼Œè‡ªèº«æ˜¯æ’ä»¶å¼æ¡†æž¶ã€‚ä»ŽåŠŸèƒ½ä¸Šè®²ï¼ŒSwarm æ˜¯ Kubernetes çš„ä¸€ä¸ªå­é›†ï¼Œä¸ªäººæ„Ÿè§‰ï¼ŒCompose+Swarm=Kubernetesã€‚

> Qï¼šSwarm æœ€ç»ˆç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œåªæ˜¯ä¸ºäº†ç®¡ç†å®¹å™¨å—ï¼Œæœ‰æ²¡æœ‰è€ƒè™‘è¿‡æå‡èµ„æºåˆ©ç”¨çŽ‡ï¼Œä¼šæŠŠèµ„æºå¼¹æ€§ä¼¸ç¼©åšä¸Šæ¥å—ï¼Œæœ€ç»ˆæŠŠæ‰€æœ‰æœºå™¨è´Ÿè½½æå‡ï¼Œé˜²æ­¢æœ‰äº›ä½Žè´Ÿè½½æˆ–ç©ºè´Ÿè½½æµªè´¹èµ„æºï¼Ÿ

Aï¼šAuto-scaling èƒ½åŠ›ï¼Œä¸ªäººæ„Ÿè§‰åŽè¾¹å¯èƒ½é€šè¿‡ Compose æ¥å®žçŽ°ï¼Œæ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥åœ¨ Swarm ç¤¾åŒºæä¸€ä¸ª proposalã€‚

> Qï¼šSwarm å¯¹èŠ‚ç‚¹çš„é€‰å–æ˜¯å¦å¯å®šåˆ¶åŒ–ï¼ŒæŒ‡çš„æ˜¯ç­–ç•¥é€‰æ‹©ï¼Œæ„Ÿè§‰åªæœ‰è¿™ä¸‰ç§ä¸å¤Ÿå¼ºå¤§ï¼Ÿ

Aï¼šå¯ä»¥ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„ç‰¹ç‚¹å®žçŽ°å¯¹åº” APIã€‚

> Qï¼šè°ƒç”¨ Swarm API åŠ Swarm è°ƒ Docker API å®‰å…¨è®¤è¯æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿ

Aï¼šå®‰å…¨è¿™éƒ¨åˆ†æ˜¯é€šè¿‡ SSL åè®®å®žçŽ°é€šä¿¡å®‰å…¨ä»¥åŠè®¤è¯ï¼Œæ”¯æŒ Swarm å¯¹å¤–ï¼ˆæ¯”å¦‚ä¸Ž Clientï¼‰ä¹‹é—´çš„æä¾›é€šä¿¡å®‰å…¨ï¼ŒåŒæ—¶ Swarm ä¸Ž Docker Engine ä¹‹é—´çš„ä¹Ÿæ”¯æŒé€šä¿¡å®‰å…¨ã€‚

> Qï¼šSwarm æ€Žä¹ˆè·¨èŠ‚ç‚¹ linkï¼Ÿ

Aï¼šç›®å‰ä¸æ”¯æŒè·¨èŠ‚ç‚¹ï¼Œå¦‚æžœä½¿ç”¨äº† linkï¼Œåˆ›å»ºçš„å®¹å™¨å’Œ link çš„å®¹å™¨ä¼šè¢«è°ƒåº¦åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚

> Qï¼šSwarm çš„è°ƒåº¦ç³»ç»Ÿä¹Ÿæ˜¯æ’ä»¶å½¢å¼ï¼Ÿå¯ä»¥ä½¿ç”¨ Mesos çš„èµ„æºè°ƒåº¦å—ï¼Ÿ

Aï¼šSwarm è°ƒåº¦å™¨æ˜¯æ’ä»¶å½¢å¼ã€‚Mesos é‡‡ç”¨ä¸¤å±‚è°ƒåº¦æ¡†æž¶ï¼Œç¬¬ä¸€å±‚ï¼Œç”± mesos å°†ç¬¦åˆæ¡†æž¶çš„èµ„æºä¸ŠæŠ¥ç»™æ¡†æž¶ï¼Œç¬¬äºŒå±‚ï¼Œæ¡†æž¶ï¼ˆswarmï¼‰è‡ªèº«çš„è°ƒåº¦å™¨å°†èµ„æºåˆ†é…ç»™ä»»åŠ¡ã€‚

> Qï¼šSwarm IP æ˜¯æ€Žä¹ˆç®¡ç†çš„ï¼ŸSwarm ä¸‹çš„å„ä¸ªèŠ‚ç‚¹æ˜¯åŠ¨æ€åˆ†é… IP çš„ä¹ˆï¼Ÿ

Aï¼šå½“å‰ç½‘ç»œéƒ¨åˆ†è¿˜æ˜¯ç”¨ docker-engine è‡ªèº«çš„èƒ½åŠ›ï¼ŒåŽç»­ä¼šå’Œ libnetwork è¿›è¡Œé›†æˆï¼Œå…·ä½“æ€Žä¹ˆç®¡ç†æ­£åœ¨è®¨è®ºä¸­ã€‚

> Qï¼šç½‘ç»œéƒ¨åˆ†é›†æˆé™¤äº† libnetwork è¿˜æœ‰å…¶ä»–è®¡åˆ’æˆ–è€…è€ƒè™‘å—ï¼Ÿ

Aï¼šlibnetwork è‡ªèº«ä¹Ÿæä¾›äº† plugin æœºåˆ¶ï¼Œä¸ªäººç†è§£ï¼Œå’Œå…¶ä»–ç½‘ç»œé¡¹ç›®å¾ˆå¥½é›†æˆã€‚

---

### 2015-09-02ï¼šç•…è°ˆ PaaS

> Qï¼šå¼€æºåŠ¿å¿…å¼•å…¥å®‰å…¨é—®é¢˜ã€‚Cloud Foundry çš„å®‰å…¨ä¿æŠ¤æœºåˆ¶ï¼Ÿ

Aï¼šCloud Foundry å¯¹äºŽåº”ç”¨æœ‰ä¸ªå®‰å…¨ç»„çš„ç‰¹æ€§ï¼Œå¯ä»¥æŽ§åˆ¶åº”ç”¨å®¹å™¨çš„è®¿é—®ã€‚ä½†æ˜¯å®žé™…ä¸Šèƒ½åŠ›ä¸å¼ºï¼Œå®¹å™¨å®‰å…¨è¿™å—ä¸€ç›´æ˜¯è¢«æ‹…å¿ƒçš„åœ°æ–¹ã€‚

> Qï¼šCloud Foundry çš„ DEAï¼Œå³åº”ç”¨çš„è¿è¡Œæ—¶èŠ‚ç‚¹ï¼Œæ˜¯è™šæ‹Ÿçš„æ“ä½œç³»ç»Ÿä¹ˆï¼ŸWarden å¯¹åº•å±‚çš„æ“ä½œç³»ç»Ÿæœ‰å’Œè¦æ±‚ï¼ŸWarden å¦‚ä½•å®žçŽ°çš„éš”ç¦»æ€§ï¼Ÿ

Aï¼šDEA æ˜¯ä¸ªæœåŠ¡ï¼Œå…¶å®žè¿˜æ˜¯ Linux ç³»ç»Ÿ Warden å¯¹å†…æ ¸æœ‰è¦æ±‚ï¼Œå®žçŽ°åŽŸç†å’Œ Docker ç±»ä¼¼ã€‚

> Qï¼šva/spring/web åº”ç”¨å¾ˆå®¹æ˜“åœ¨ Docker/Kubernetes çŽ¯å¢ƒè¿è¡Œï¼Œå¦‚æžœè¦è¿ç§»åˆ° CFï¼Œå·¥ä½œé‡å¤§å—ï¼Ÿ

Aï¼šCF V2 å·¥ä½œé‡åº”è¯¥æŒºå¤§ï¼ŒV3 çš„è¯å› ä¸ºæ”¯æŒ Dockerï¼Œæ‰€ä»¥è¿˜å¥½ã€‚

> Qï¼šå…³äºŽ k8s ä¸­ Flannel å’Œ Weave ä¸¤è€…å“ªä¸ªæ›´é€‚åˆç”Ÿäº§çŽ¯å¢ƒï¼Ÿ

Aï¼šè¿™ä¸ªæˆ‘æœ€è¿‘æ­£åœ¨åˆ†æžï¼Œæ„Ÿè§‰ Flannel å’Œ Weave éƒ½è¿˜ä¸æˆç†Ÿï¼ŒæŽ¨è OVSã€‚

> Qï¼šDocker æ—¢ç„¶æ˜¯ namespace éš”ç¦»çš„ï¼Œå°±ç®—ä¸å®‰å…¨åº”è¯¥ä¹Ÿå½±å“ä¸æ˜¯å¾ˆå¤§å§ï¼Ÿ

Aï¼šå…¶å®žå¦‚æžœä½ æ¸…æ¥šåŽŸç†ï¼Œå¾ˆå®¹æ˜“è¿›å…¥åˆ°å®¹å™¨çŽ¯å¢ƒä¸­çš„ï¼Œæ²¡åŠžæ³•ï¼Œå®‰å…¨æ˜¯ä¸ªå¤§é—®é¢˜ã€‚

> Qï¼šk8s å¯ä»¥å®žçŽ°åº”ç”¨çš„è‡ªä¸»è¿ç§»å—ï¼Ÿ

Aï¼šç›®å‰æ²¡æœ‰ Pod è¿ç§»çš„ APIã€‚

> Qï¼šCloudFoundary ä¸­ç›‘æŽ§éƒ¨åˆ†æœ‰æ’ä»¶æœºåˆ¶ä¹ˆï¼Ÿ

Aï¼šæ”¯æŒå¯¼å…¥åˆ°å„ç§ç¬¬ä¸‰æ–¹ç›‘æŽ§ç³»ç»Ÿã€‚

> Qï¼šPod ç›´æŽ¥é€šä¿¡éœ€è¦å¼€é€šéš§é“ä¹ˆï¼Ÿæ¢å¥è¯è¯´ä»–ä»¬ä¹‹é—´æ˜¯å¦‚ä½•å®žçŽ°é€šä¿¡çš„ï¼Ÿ

Aï¼šå®¹å™¨è·¨ä¸»æœºçš„é€šä¿¡ï¼Œæ˜¯å¯¹ Docker çš„å¢žå¼ºï¼Œåƒ Flannelã€ovs ç­‰ã€‚

> Qï¼šPaaS çš„ä¸‰ä¸ªå…¸åž‹ä»£è¡¨ï¼š Cloud Foundryã€Docker å’Œ Kubernetesï¼Œæœ€è¿‘çš„ DaoCloudã€çµé›€äº‘ã€æ—¶é€Ÿäº‘ç­‰ä»¥ Docker ä¸ºæ ¸å¿ƒæå‡ºäº†æ–°çš„ CaaS æ¦‚å¿µã€‚CaaS å’Œ PaaS éƒ½ä½¿ç”¨äº† Dockerï¼ŒKubernetes ç­‰æŠ€æœ¯ï¼Œæ‚¨æ˜¯æ€Žä¹ˆç†è§£ PaaS å’Œ CaaS çš„ï¼Ÿ

Aï¼šCaaS å®¹å™¨å³æœåŠ¡ï¼Œæˆ‘çš„ç†è§£å°±æ˜¯ PaaSï¼Œåªä¸è¿‡ä¸»æ‰“è¿™ Docker å®¹å™¨ï¼Œæ‰€ä»¥å« CaaSã€‚

> Qï¼šDocker åœ¨ CentOS ä¸Šä½¿ç”¨ devicemapperï¼Œæ®è¯´å®¹æ˜“ä½¿ç³»ç»Ÿ crashï¼Œå¯¹äºŽå…¶ä»–çš„æ–‡ä»¶ç³»ç»Ÿæœ‰æ²¡æœ‰æŽ¨èï¼Œbrtfs å’Œ aufs å“ªä¸ªæ›´å¥½ï¼Ÿ

Aï¼šaufs æ˜¯å†…æ ¸ä¸æŽ¥å—çš„ï¼Œå¬è¯´æ˜¯å› ä¸ºä»£ç å¤ªä¹±ã€‚

> Qï¼šå¯¹äºŽç®¡ç† Docker è¿™ä»¶äº‹æƒ…ï¼Œé™¤äº† Kubernetesï¼Œ OpenStackï¼ˆIaaS é˜µè¥ï¼‰ï¼ŒYARNï¼ˆHadoop é˜µè¥ï¼‰ä¹Ÿå¼€å§‹å‘åŠ›ï¼Œæ€Žä¹ˆçœ‹å¾…è¿™å‡ è€…é—´çš„ç«žäº‰ï¼Ÿ

Aï¼šæ²¡æœ‰ä»»ä½•æŠ€æœ¯æ˜¯é“¶å¼¹ï¼Œä¸åŒéœ€æ±‚ä¸åŒè®¾è®¡ã€‚å½“ç„¶å¤§å®¶éƒ½æƒ³å æ®åˆ¶é«˜ç‚¹äº†ï¼Œè¿™å°±æ˜¯è¿ä½œäº†ã€‚

> Qï¼šk8s çŽ°åœ¨å…·å¤‡ auto scaling èƒ½åŠ›å—ï¼Œæ¯”å¦‚åº”ç”¨å“åº”æ—¶é—´å˜é•¿ï¼Œk8s å¯ä»¥è‡ªåŠ¨æ‰©å®¹ï¼Ÿ

Aï¼šæ²¡æœ‰ã€‚

> Qï¼šå¦‚æžœå°† Flannel æ›¿æ¢æˆ ovs æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ›¿æ¢æŽ‰ kube-proxyï¼Œå¦‚æžœæ˜¯é‚£ä¼šä¸ä¼šå½±å“é›†ç¾¤ä¸­ SVC çš„ä½¿ç”¨ï¼Ÿ

Aï¼šflannel/ovs å’Œ kube-proxy çš„ä½œç”¨æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯ä»¥çœ‹ä¸‹ [dockone.io/article/545](http://dockone.io/article/545)ã€‚

---

### 2015-08-26ï¼šä¸€ç¯‡æ–‡ç« å¸¦ä½ äº†è§£ Flannel

> Qï¼šæ•°æ®ä»Žæºå®¹å™¨ä¸­å‘å‡ºåŽï¼Œç»ç”±æ‰€åœ¨ä¸»æœºçš„ docker0 è™šæ‹Ÿç½‘å¡è½¬å‘åˆ° flannel0 è™šæ‹Ÿç½‘å¡ï¼Œè¿™ç§ P2P å®žé™…ç”Ÿäº§ä¸­æ˜¯å¦å­˜åœ¨ä¸¢åŒ…ï¼Œæˆ–è€…æ­¤æœºåˆ¶æœ‰é«˜å¯ç”¨ä¿éšœä¹ˆï¼Ÿ

Aï¼šåªæ˜¯æœ¬æœºçš„ P2P ç½‘å¡ï¼Œæ²¡æœ‰ç»è¿‡å¤–éƒ¨ç½‘ç»œï¼Œåº”è¯¥è¿˜æ¯”è¾ƒç¨³å®šã€‚ä½†æˆ‘è¿™é‡Œæ²¡æœ‰å…·ä½“æ•°æ®ã€‚

> Qï¼šUDP æ•°æ®å°è£…ï¼Œè½¬å‘çš„å½¢å¼ä¹Ÿæ˜¯ UDP ä¹ˆï¼Ÿæˆ‘ä»¬ä¸€èˆ¬çŸ¥é“ UDP å‘é€æ•°æ®æ˜¯æ— çŠ¶æ€çš„ï¼Œå¯é ä¹ˆï¼Ÿ

Aï¼šè½¬å‘çš„æ˜¯ UDPï¼Œé«˜å¹¶å‘æ•°æ®æµæ—¶å€™ä¹Ÿè®¸ä¼šæœ‰é—®é¢˜ï¼Œæˆ‘è¿™é‡ŒåŒæ ·æ²¡æœ‰æ•°æ®ã€‚

> Qï¼šå®žé™…ä¸Šï¼Œkubernates æ˜¯æ·¡åŒ–äº†å®¹å™¨ ipï¼Œå¤–å›´ç”¨æˆ·åªéœ€å…³æ³¨æ‰€è°ƒç”¨çš„æœåŠ¡ï¼Œå¹¶ä¸å…³å¿ƒå…·ä½“çš„ ipï¼Œè¿™é‡Œ fannel å°† IP åˆ†å¼€ä¸”å”¯ä¸€ï¼Œè¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿæœ‰å®žé™…åº”ç”¨çš„ä¸šåŠ¡åœºæ™¯ä¹ˆï¼Ÿ

Aï¼š IP å”¯ä¸€æ˜¯ Kubernetes èƒ½å¤Ÿç»„ç½‘çš„æ¡ä»¶ä¹‹ä¸€ï¼Œä¸æŠŠç½‘ç»œæ‹‰é€šåŽé¢çš„äº‹æƒ…éƒ½ä¸å¥½æ•´ã€‚

> Qï¼šFlannel é€šè¿‡ Etcd åˆ†é…äº†æ¯ä¸ªèŠ‚ç‚¹å¯ç”¨çš„ IP åœ°å€æ®µåŽï¼Œå·å·çš„ä¿®æ”¹äº† Docker çš„å¯åŠ¨å‚æ•°ï¼šé‚£ä¹ˆå¦‚æžœå¢žåŠ èŠ‚ç‚¹ï¼Œæˆ–åˆ é™¤èŠ‚ç‚¹ï¼Œè¿™äº›åœ°å€æ®µï¼ˆETCD ä¸Šï¼‰ä¼šåŠ¨æ€å˜åŒ–ä¹ˆï¼Ÿå¦‚æžœä¸æ˜¯åŠ¨æ€å˜åŒ–ï¼Œä¼šé€ æˆ IP åœ°å€çš„æµªè´¹ä¹ˆï¼Ÿ

> Qï¼šsudo mk-docker-opts.sh -i è¿™ä¸ªå‘½ä»¤å…·ä½“å¹²ä»€ä¹ˆäº†ï¼Ÿéž coreos ä¸Šä½¿ç”¨ flannel æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

Aï¼šç”Ÿæˆäº†ä¸€ä¸ª Docker å¯åŠ¨çš„çŽ¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œé‡Œé¢ç»™ Docker å¢žåŠ äº†å¯åŠ¨å‚æ•°ã€‚

> Qï¼šå®¹å™¨ IP éƒ½æ˜¯å›ºå®šçš„å—ï¼Ÿå¤–ç½‘ä¸Žç‰©ç†ä¸»æœºèƒ½ ping é€šï¼Œä¹Ÿèƒ½ ping é€šæ‰€æœ‰ Docker é›†ç¾¤çš„å®¹å™¨ IPï¼Ÿ

Aï¼šä¸æ˜¯å›ºå®šçš„ï¼ŒIP åˆ†é…è¿˜æ˜¯ Docker åœ¨åšï¼ŒFlannel åªæ˜¯åˆ†é…äº†å­ç½‘ã€‚

> Qï¼šFlannel çš„èƒ½å¦å®žçŽ° VPNï¼Ÿä½ ä»¬æœ‰æ²¡æœ‰ç ”ç©¶è¿‡ï¼Ÿ

Aï¼š åº”è¯¥ä¸èƒ½ï¼Œå®ƒè¦æ±‚è¿™äº›å®¹å™¨æœ¬æ¥å°±åœ¨ä¸€ä¸ªå†…ç½‘é‡Œé¢ã€‚

> Qï¼šFlannl æ˜¯è°å¼€å‘çš„ï¼Ÿå…¨æ˜¯å¯¹ k8s çš„äºŒæ¬¡å¼€å‘å—ï¼Ÿ

Aï¼š CoreOS å…¬å¸ï¼Œä¸æ˜¯ k8s çš„äºŒæ¬¡å¼€å‘ï¼Œç‹¬ç«‹çš„å¼€æºé¡¹ç›®ï¼Œç»™ k8s æä¾›åŸºç¡€ç½‘ç»œçŽ¯å¢ƒã€‚

> Qï¼šFlannel æ”¯æŒéžå°åŒ…çš„çº¯è½¬å‘å—ï¼Ÿè¿™æ ·æ€§èƒ½å°±ä¸ä¼šæœ‰æŸå¤±äº†ï¼Ÿ

Aï¼šéžå°è£…æ€Žæ ·è·¯ç”±å‘¢ï¼Ÿå‘å‡ºæ¥çš„ TCP åŒ…æœ¬èº«å¹¶æ²¡æœ‰åœ¨ç½‘ç»œé—´è·¯ç”±çš„ä¿¡æ¯ï¼Œåˆ«å¿˜äº†ï¼Œä¸¤ä¸ª Flannel ä¸æ˜¯ç›´è¿žçš„ï¼Œéš”ç€æ™®é€šçš„å±€åŸŸç½‘ç»œã€‚

> Qï¼š Flanel çŽ°åœ¨åˆ°å“ªä¸ªç‰ˆæœ¬äº†ï¼ŒåŽç»­ç‰ˆæœ¬æœ‰ä»€ä¹ˆä¾§é‡ç‚¹ï¼Ÿæ€§èƒ½ä¼˜åŒ–ï¼Œè¿˜æ˜¯åŠŸèƒ½æ‰©å±•ï¼Ÿ

Aï¼šè¿˜æ²¡åˆ° 1.0ï¼Œåœ¨ GitHub ä¸Šé¢æœ‰ä»–ä»¬çš„å‘å±•è®¡åˆ’ï¼Œæ€§èƒ½æ˜¯å¾ˆå¤§çš„ä¸€éƒ¨åˆ†ã€‚

> Qï¼š å°±æ˜¯åœ¨ CoreOS ä¸­ï¼Œå®¢æˆ·è¿˜éœ€è¦å®‰è£… Flannel å—ï¼Ÿ

Aï¼šä¸éœ€è¦ï¼Œåœ¨å¯åŠ¨çš„ Cloudinit é…ç½®é‡Œé¢ç»™ Etcd å†™å…¥ Flannel é…ç½®ï¼Œç„¶åŽåŠ ä¸Š flanneld.service command: start å°±å¯ä»¥äº†ï¼Œå¯åŠ¨å®Œç›´æŽ¥å¯ç”¨ï¼Œæ–‡æ¡£è¿žæŽ¥æˆ‘ä¸æ‰¾äº†ï¼Œæœ‰è¿™æ®µé…ç½®ï¼ŒçŽ°æˆçš„ã€‚

> Qï¼š å¯ä¸å¯ä»¥ç›´æŽ¥ç”¨å‘½ä»¤æŒ‡å®šæ¯ä¸ªä¸»æœºçš„ ip èŒƒå›´ï¼Œç„¶åŽåš gre éš§é“å®žçŽ°èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ï¼Ÿè¿™æ ·ä¹Ÿå¯ä»¥å®žçŽ°ä¸åŒä¸»æœºä¸Šçš„å®¹å™¨ ip ä¸åŒä¸”å¯ä»¥ç›¸äº’é€šä¿¡å§ï¼Ÿ

Aï¼šè¿˜ä¸æ”¯æŒæŒ‡å®šå“ªä¸ªèŠ‚ç‚¹ç”¨é‚£æ®µ IPï¼Œä¸è¿‡è²Œä¼¼å¯ä»¥åœ¨ Etcd æ‰‹æ”¹ã€‚

> Qï¼š Flannel åªæ˜¯è´Ÿè´£é€šä¿¡æœåŠ¡ï¼Œé‚£æ˜¯ä¸æ˜¯è¿˜è¦å®‰è£… k8sï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œk8s æ˜¯å•ç‹¬çš„ã€‚

> Qï¼šçŽ°åœ¨ Docker çš„ç½‘ç»œç»„ä»¶è¿˜æœ‰ä»€ä¹ˆå¯ä»¥é€‰æ‹©æˆ–è€…æŽ¨èçš„?

Aï¼šOverlay ç½‘ç»œçš„å¸¸ç”¨å°±æ˜¯ Flannel å’Œ Weaveï¼Œå…¶ä»– OVS ä¹‹ç±»çš„å¦è¯´äº†ã€‚

---

### 2015-08-19ï¼š360 çš„å®¹å™¨åŒ–ä¹‹è·¯

> Qï¼šå¼€å‘è‡ªå·±çš„è°ƒåº¦ç³»ç»Ÿå¤§æ¦‚èŠ±äº†å¤šä¹…ï¼Œæœ‰é‡åˆ°ç‰¹åˆ«çš„æŠ€æœ¯éš¾ç‚¹å—ï¼Ÿ

Aï¼šå¤§çº¦ 2 ä¸ªå·¥ç¨‹å¸ˆä¸€ä¸ªæœˆæ ·å­ï¼Œæ²¡æœ‰å¤ªå¤šå¾—å›°éš¾ã€‚å› ä¸ºè°ƒåº¦é€»è¾‘æ¯”è¾ƒç®€å•ã€‚

> Qï¼šæ‚¨åˆšæ‰è¯´ï¼Œé€šè¿‡ç»‘å®šç‹¬ç«‹çš„ IP å°±å¯ä»¥ç›´æŽ¥ä½¿ç”¨ SSH äº†ã€‚

Aï¼šé€šè¿‡ç»‘å®šç‹¬ç«‹çš„ IP å°±å¯ä»¥ç›´æŽ¥ä½¿ç”¨ SSH äº†ï¼Œå®˜æ–¹å…³äºŽ network é‚£ç¯‡æ–‡æ¡£æœ‰ä»‹ç»å®žçŽ°æ–¹æ¡ˆã€‚

> Qï¼šä¸€èˆ¬ Docker çš„æœåŠ¡å°è£…æ˜¯ no daemon çš„ï¼Œè¿™æ—¶å¦‚æžœé‡å¯æœåŠ¡ï¼Œå®¹å™¨ä¹Ÿä¼šé€€å‡ºçš„ï¼Œå¦‚ä½• debugï¼Ÿ

Aï¼šå¯ä½¿ç”¨ supvirsod æˆ–è€… monit ç­‰å°† no daemon å°è£…ä¸€ä¸‹ã€‚

> Qï¼šä½ ä»¬æœåŠ¡çš„æ³¨å†Œå‘çŽ°ç”¨çš„æ˜¯ä»€ä¹ˆï¼Ÿ

Aï¼šæˆ‘ä»¬åŸºç¡€æž¶æž„ç»„å¼€å‘äº†ä¸€ä¸ªï¼Œåå­—å« QConfï¼Œå·²[ç»å¼€æºåœ¨ GitHub ä¸Š](https://github.com/Qihoo360/QConf)ã€‚

> Qï¼šä½ è¯´ Zabbix åšçš„ä¸€ä¸ªå®¹å™¨ç›‘æŽ§ï¼Œé‚£æœ‰æ²¡æœ‰ä¸€ä¸ªåŸºäºŽå®¿ä¸»æœºçš„ç›‘æŽ§æ–¹å¼ï¼Ÿå› ä¸ºæ®æˆ‘æ‰€çŸ¥ä½ è¿™æ ·çš„è¯æ¯ä¸ªå®¹å™¨éƒ½è¦è¿è¡Œä¸€ä¸ªä»£ç†å§ã€‚

Aï¼šæˆ‘ä»¬å°±æ˜¯ä½¿ç”¨å®¿ä¸»æœºé‡Œå®‰è£… Zabbix ä»£ç†ï¼Œé€šè¿‡ Zabbix è‡ªå‘çŽ°æ¥åŠ¨æ€èŽ·å–å®¹å™¨åˆ—è¡¨ï¼Œå†åŸºäºŽè‡ªå®šä¹‰çš„ç›‘æŽ§è„šæœ¬èŽ·å¾—æ¯ä¸ªå®¹å™¨çš„ç›‘æŽ§æ•°å€¼ã€‚

> Qï¼šä½ ä»¬çš„é‚£äº›ä¸šåŠ¡è·‘åœ¨ Docker é‡Œäº†ï¼Ÿ

Aï¼šç›®å‰ 360 çš„å¾ˆå¤š Web2.0 ä¸šåŠ¡å·²ç»è·‘åœ¨äº†ä¸Šé¢ï¼Œåƒå½±è§†ã€æ–°é—»ã€å…è´¹ WIFI ç­‰ã€‚

> Qï¼šDocker å»ºè®®æ— çŠ¶æ€ï¼Œé‚£ä¹ˆæ˜¯å¦æ„å‘³ç€ä¸å»ºè®®å­˜æ”¾æ•°æ®ï¼Ÿæ¯”å¦‚ MySQLï¼Œè¿˜æ˜¯è¯´é€šè¿‡-v æ¥è§£å†³ï¼Ÿ

Aï¼šè¿™å…¶å®žæ˜¯æ•°æ®å­˜å‚¨é—®é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼å­˜å‚¨æ¥å­˜å‚¨æ•°æ®ï¼Œåªè¦æ•°æ®å’Œé€»è¾‘åˆ†ç¦»å®¹å™¨å°±æ— çŠ¶æ€äº†ã€‚

> Qï¼šDocker å»ºè®®æ— çŠ¶æ€ï¼Œé‚£ä¹ˆæ˜¯å¦æ„å‘³ç€ä¸å»ºè®®å­˜æ”¾æ•°æ®ï¼Ÿæ¯”å¦‚ MySQLï¼Œè¿˜æ˜¯è¯´é€šè¿‡-v æ¥è§£å†³ï¼Ÿ

Aï¼šæˆ‘ç†è§£å°±æ˜¯å®¹å™¨æ— çŠ¶æ€å°±æ˜¯åŸºäºŽé•œåƒåˆ›å»ºçš„é©¬ä¸Šå°±èƒ½çº¿ä¸Šä½¿ç”¨ã€‚

> Qï¼šçº¿ä¸Š Docker çš„ç¨³å®šæ€§å¦‚ä½•ï¼Ÿ

Aï¼šç›®å‰è¿è¡Œéƒ½å¾ˆç¨³å®šï¼Œæ²¡æœ‰å‡ºçŽ°å®¹å™¨å¼‚å¸¸å´©æºƒç­‰æƒ…å†µã€‚

> Qï¼šContainer ä¸­è·‘å¤šä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆ PID ä¸º 1 çš„è¿›ç¨‹ä½ ä»¬æ˜¯ç”±ä»€ä¹ˆæŽ§åˆ¶çš„ï¼Œç›´æŽ¥ç”±å¯¹åº”çš„åº”ç”¨ç¨‹åºè¿˜æ˜¯å…¶ä»–ä»€ä¹ˆï¼Ÿ

Aï¼šä¹‹å‰ç”¨äº† supervisord çŽ°åœ¨ä½¿ç”¨ S6ã€‚

> Qï¼šRegistry é¢å¯¹å¤§é‡çš„å¹¶å‘ï¼Œæœ‰æµ‹è¯•å‡ºå¤§è‡´çš„æ€§èƒ½å æ¯”å—ï¼Œæ•´ä¸ª registry æ˜¯ mirror è¿˜æ˜¯å…¶ä»–æž¶æž„ï¼Ÿ

Aï¼šRegistry ç›®å‰æˆ‘ä»¬æ›´æ–°åˆ°äº† V2ï¼Œæˆ‘ä»¬æµ‹è¯• V2 åœ¨é«˜å¹¶å‘ pull å’Œ push ä¸Šæ€§èƒ½éžå¸¸å¥½ï¼Œé•œåƒå­˜å‚¨ä½¿ç”¨å…±äº«å­˜å‚¨ï¼Œè¿™æ · Registry ä¹Ÿå¯ä»¥æ¨ªå‘æ‰©å±•ã€‚

> Qï¼šå¦‚æžœå®¹å™¨é…ç½®ç”¨æˆ·å¯ä»¥ç›´æŽ¥è®¿é—®çš„ IPï¼Œåœ¨å®¿ä¸»è™šæ‹Ÿæœºä¸­æ˜¯å¦å¯ä»¥åŸºäºŽ Open vSwitch å®žçŽ°ï¼Œå¦åˆ™ä¼šå¤ªä¾èµ–è™šæ‹Ÿæœºç½‘ç»œï¼Ÿ

Aï¼šè¿™ä¸ªå¯ä»¥çš„ï¼Œå®žé™…ä¸Šæˆ‘ä»¬ä¹Ÿæµ‹è¯•è¿‡æ²¡é—®é¢˜ï¼Œå½“æ—¶åŸºäºŽç¨³å®šæ€§è€ƒè™‘æ²¡æœ‰ä½¿ç”¨ã€‚

> Qï¼šå¥‡è™Žçš„ CPU é…é¢ç®¡ç†æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šè¿™ä¸ª Docker 1.7 å·²ç»å®žçŽ°äº†ï¼Œæˆ‘ä»¬å’Œå®˜æ–¹çš„å®žçŽ°æ€è·¯æ˜¯ä¸€è‡´çš„ã€‚

> Qï¼šå…³äºŽå®¹å™¨ä¸­æ•°æ®å­˜å‚¨æ˜¯æ€Žä¹ˆåšçš„ï¼Œå¦‚æžœæ˜¯å…±äº«å­˜å‚¨å¦‚ä½•è¿›è¡Œå¯¹åº”ï¼Ÿ

Aï¼šå¯ä»¥è¯•è¯• GlusterFS æˆ–è€… Cephã€‚

> Qï¼šå®¹å™¨ç»‘ IPï¼Œå®¹å™¨é‡å¯åŽ IP è¦é‡æ–°ç»‘å§ï¼ŒIP ä¼šå˜å—ï¼Ÿ

Aï¼šéœ€è¦é‡æ–°ç»‘ï¼Œå¯åšæˆè‡ªåŠ¨åŒ–è„šæœ¬ã€‚

---

### 2015-08-12ï¼šé—²è°ˆ Kubernetes çš„ä¸»è¦ç‰¹æ€§å’Œç»éªŒåˆ†äº«

> Qï¼škubelet æœ¬èº«ä¹Ÿè·‘åœ¨ pod é‡Œå—ï¼Ÿ

Aï¼šå¯ä»¥è·‘åœ¨å®¹å™¨é‡Œï¼Œä¹Ÿå¯ä»¥è·‘åœ¨ host ä¸Šï¼Œå¯ä»¥å°è¯• hyperkube çš„é›†æˆå·¥å…·ã€‚

> Qï¼šroollback çš„å…·ä½“æœºåˆ¶æ˜¯ï¼Ÿ

Aï¼šæ„Ÿè§‰åº”è¯¥é€šè¿‡ lablelï¼Œå†ä¸€ä¸ªä¸ªæ›¿æ¢å·²ç»å‡çº§çš„ podï¼Œä¸è¿‡è¿˜æ²¡ä»”ç»†ç ”ç©¶è¿‡ã€‚

> Qï¼šMesos å’Œ Kubernetes åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæ„Ÿè§‰æœ‰å¾ˆå¤šé‡åˆçš„åœ°æ–¹ã€‚

Aï¼šMesos å’Œ Kubernetes ä¾§é‡ç‚¹ä¸åŒï¼Œç¡®å®žæœ‰ä¸€äº›é‡åˆçš„åœ°æ–¹ï¼›mesos æ›´æ“…é•¿èµ„æºç®¡ç†ï¼Œæ”¯æŒä¸Šå±‚ frameworkï¼Œk8s åŽŸç”Ÿä¸ºå®¹å™¨è®¾è®¡ï¼Œæ›´å…³æ³¨ app ç›¸å…³çš„ä¸€äº›é—®é¢˜ã€‚

> Qï¼š"æ¯”å¦‚ç”¨ HAProxyï¼Œç›´æŽ¥å¯¼æµåˆ° service çš„ endpoints æˆ–è€… Pods ä¸Š"ï¼Œhaproxy å¦‚ä½•å¯¼æµåˆ° Pod ä¸Šï¼ŒpodIP ä¸æ˜¯ä¸å›ºå®šçš„å—ï¼Ÿ

Aï¼šå¯ä»¥é€šè¿‡ watch etcd æˆ–è€… api server çš„æ–¹å¼ï¼Œç›‘å¬å˜åŒ–æ¥æ›´æ–° haproxyï¼›kubeproxy æ”¹ç”¨ haproxyï¼Œåªæ˜¯ external loadbalancer çš„æ–¹å¼ï¼›å¦‚æžœè¦æ›¿æ¢ï¼Œéœ€è¦é‡æ–°å¼€å‘ã€‚

> Qï¼šæœ‰æ²¡æœ‰å¯ä»¥æŽ¨èçš„åˆ†å¸ƒå¼ Volume æ–¹æ¡ˆï¼Ÿä½ ä»¬ä½¿ç”¨èµ·æ¥æ€§èƒ½å¦‚ä½•ï¼Ÿ

Aï¼šåˆ†å¸ƒå¼ volumeï¼Œå¯ä»¥å°è¯• rbdï¼Œæ€§èƒ½çš„è¯å°±éœ€è¦è‡ªå·±å¤šå¤šæµ‹è¯•ï¼Œä¸æ–­è°ƒä¼˜äº†ï¼›æœ‰ç”¨æˆ·æåˆ°åœ¨ä½¿ç”¨ moosefs åšå­˜å‚¨ï¼Œå¯¹ glusterfs çš„æ”¯æŒä¹Ÿå¾ˆå¤šã€‚

> Qï¼šk8s çš„æ’ä»¶è§„èŒƒå—ï¼Ÿè¿˜æ˜¯ç›´æŽ¥ç¡¬æ”¹ï¼Ÿ

Aï¼šæœ‰äº›è¿˜æ˜¯æ¯”è¾ƒè§„èŒƒçš„ï¼Œå¯ä»¥ plugin æ–¹å¼ï¼›æœ‰äº›è¿˜éœ€è¦åŽç»­ç‰ˆæœ¬çš„è°ƒæ•´ï¼Œå¦åˆ™è¦åŠ¨æºç äº†ã€‚

> Qï¼š k8s å¦‚ä½•ç›‘å¬ docker çš„äº‹ä»¶ï¼Œæ¯”å¦‚ï¼šåœ¨æ„å¤–é€€å‡ºå‰ï¼Œæƒ³æŠ›å‡ºä¸€äº›é¢å¤–çš„äº‹ä»¶ï¼Œé€šçŸ¥ lb å¦‚ä½•åšï¼Ÿ

Aï¼šä¸ç¡®å®šè¿™ä¸ªæ˜¯ç›‘å¬ docker çš„å“ªäº›äº‹ä»¶ï¼Œå† podï¼Œrc å±‚é¢å¯ä»¥è¿›è¡Œ watchã€‚

> Qï¼šk8s å¦‚ä½•è®¾ç½®å„ä¸ª pod çš„ä¾èµ–å’Œå¯åŠ¨é¡ºåºï¼Ÿ

Aï¼šç›®å‰æ²¡çœ‹åˆ°å¾ˆå¥½çš„æŽ§åˆ¶ Pod çš„ä¾èµ–å’Œå¯åŠ¨é¡ºåºçš„æœºåˆ¶å¯ä»¥åœ¨åº”ç”¨å±‚é¢é¿å…è¿™äº›ä¾èµ–å’Œé¡ºåºé—®é¢˜ã€‚

> Qï¼šé—®ä¸€ä¸‹ k8s é›†ç¾¤å†…éƒ¨å®¹å™¨é—´ç½‘ç»œè¿™å—çš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Œç±»ä¼¼ flannel è¿™ç±»æ–¹æ¡ˆçš„æ€§èƒ½é—®é¢˜æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Ÿ

Aï¼šç›®å‰ flannel æœ‰å…¶ä»–çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä½† flannel éƒ¨ç½²æ¯”è¾ƒæ–¹ä¾¿ï¼Œè´´è¿‘ Kubernetes çš„æ•´ä½“å·¥ä½œæ¨¡å¼ï¼›æ€§èƒ½ä¸Šï¼Œå¦‚æžœåšè”æœºå†…ç½‘ï¼Œæ€»ä¼šæœ‰æŸè€—ï¼Œè¿™ä¸ªéœ€è¦å–èˆäº†ï¼›æœ‰ç”¨æˆ·åæ˜ ï¼ŒåŽä¸ºçš„æµ‹è¯•ç»“æžœè¯´ ovs æ¯” flannel å¥½ï¼Œä½†æ˜¯è‡ªå·±æ²¡æœ‰å®žé™…æµ‹è¯•è¿‡ï¼›flannel çš„æ€§èƒ½å¯ä»¥çœ‹ coreos å®˜ç½‘çš„ blogï¼Œä¸Šé¢æœ‰æµ‹è¯•æŠ¥å‘Šã€‚

> Qï¼šå…ˆç”¨å®¹å™¨åšè½»é‡çº§è™šæ‹Ÿæœºï¼Œå®¹å™¨é—´å¯ä»¥é€šè¿‡ hsotname è®¿é—®ï¼Œä¸çŸ¥å¦‚ä½•åŠ¨æ‰‹ï¼Ÿ

Aï¼šk8 ä¸Šçš„å†…ç½‘ DNSï¼ˆkube2dns + skydnsï¼‰ åº”è¯¥å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ã€‚

> Qï¼šæœ‰æ²¡æœ‰å¥½çš„ç›‘æŽ§å·¥å…·ï¼Ÿ

Aï¼šå¯ä»¥å‚è€ƒ DockOne ä¸Šçš„å¦å¤–ä¸€ç¯‡[æ–‡ç« ](http://dockone.io/article/397)ã€‚

---

### 2015-06-17ï¼šOpenStack Magnum ç¤¾åŒºåŠé¡¹ç›®ä»‹ç»

> Qï¼šæˆ‘è§‚å¯Ÿåˆ° k8s é‡Œé¢çš„ cloud-provider é‡Œé¢æœ‰äº† OpenStack çš„æ’ä»¶ã€‚æƒ³é—®ä¸‹ï¼Œè¿™ä¸ª cloud-provider åœ¨ magnum é‡Œæ˜¯å¦æœ‰ä½¿ç”¨ï¼Ÿå¦‚æžœä½¿ç”¨äº†ï¼Œæ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿ

Aï¼šçŽ°åœ¨ Magnum åœ¨å’Œ Kubernetes ç¤¾åŒºåˆä½œï¼Œè¿™ä¸ªæ˜¯ Kubernetes ç¤¾åŒºè´¡çŒ®ç»™ Magnum ç¤¾åŒºçš„ï¼Œä½†æ˜¯çŽ°åœ¨è¿˜æ²¡ç”¨ã€‚

> Qï¼šmagnum çŽ°åœ¨æ˜¯å¯ä»¥åˆ›å»º swarm é›†ç¾¤ï¼Œä½†æ˜¯ Swarm æ²¡æœ‰ pod/service/Replication Controller çš„æ¦‚å¿µï¼Œè¿™ä¸ª magnum åŽæœŸä¼šæœ‰è¿™æ–¹é¢çš„è®¡åˆ’æŠŠè¿™äº›æ¦‚å¿µå¼•å…¥ Swarm é›†ç¾¤ä¹ˆï¼Ÿ

Aï¼šæš‚æ—¶æ²¡æœ‰ï¼ŒçŽ°åœ¨ Magnum è¿˜æ˜¯åˆ†å¼€ç®¡ç† k8s å’Œ Swarm å¯¹è±¡çš„ï¼Œmagnum api ç«¯çš„è°ƒç”¨å°±å¯ä»¥æŒ‡å®šç”¨æˆ·ç”¨çš„æ˜¯ k8s è¿˜æ˜¯ Swarmã€‚

> Qï¼šmagnum å¯ä»¥ä½œä¸ºç‹¬ç«‹æ¨¡å—ä½¿ç”¨å—ï¼Ÿ

Aï¼šçŽ°åœ¨è¿˜ä¸è¡Œï¼Œå› ä¸ºéœ€è¦ä¾èµ– heat å’Œ keystoneã€‚

> Qï¼šæˆ‘çœ‹ä½ çš„å‘½ä»¤æˆªå›¾ï¼Œæƒ³é—®ä¸‹åº•å±‚æž¶æž„æ˜¯ OpenStack å—ï¼Ÿ

Aï¼šæ˜¯çš„ï¼ŒMagnum æ˜¯ OpenStack ç”Ÿæ€åœˆçš„ä¸€å‘˜ï¼Œä¸»æ‰“ Container Serviceã€‚

> Qï¼šæž¶æž„å›¾ä¸­å·¦è¾¹æœ€ä¸‹é¢é‚£ä¸ª micro os æ˜¯ Docker å¼•æ“Žçš„è½½ä½“ï¼Ÿè¿™æ˜¯ç›¸å½“äºŽè¿˜æ˜¯è¦èµ·ä¸€ä¸ªå®žä¾‹å—ï¼Ÿèƒ½ä¸èƒ½åŽ»æŽ‰è¿™ä¸ªè½½ä½“ï¼Œç”± OpenStack ç›´æŽ¥æä¾›ç»Ÿä¸€çš„ Docker å¼•æ“Žã€‚

Aï¼šå› ä¸ºçŽ°åœ¨ micro os å·²ç»æä¾›äº†ï¼Œæ‰€ä»¥ç¤¾åŒºæš‚æ—¶ä¹ˆæœ‰è®¡åˆ’é€šè¿‡ OpenStack åŽ»æä¾›ï¼Œå¯èƒ½ä¸æƒ³é‡å¤é€ è½®å­ã€‚

> Qï¼šMagnum æ”¯æŒ GUI çš„ L ç‰ˆä»€ä¹ˆæ—¶å€™å‡º ï¼Œä¼šåŒºåˆ†ä¸ªäººç‰ˆå’Œä¼ä¸šç‰ˆå—ï¼Œä¼šæ”¶è´¹å—ï¼Ÿ

Aï¼šL ç‰ˆä¼šæœ‰ä¸ª draft çš„ guiï¼Œä¸æ”¶è´¹çš„ï¼ŒOpenStack ç¤¾åŒºéƒ½æ˜¯å…è´¹çš„ã€‚

> Qï¼šbay å¯ä»¥åŠ¨æ€æ‰©å®¹å—ï¼Ÿ

Aï¼šå¯ä»¥ï¼Œé€šè¿‡ magnum bay-updateã€‚

> Qï¼šåœ¨ magnum çš„ç½‘ç»œè§£å†³ä¸Š libnetwork å’Œ Neutron åŒºåˆ«åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œå„è‡ªçš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼ŒçŽ°åœ¨æœ‰å“ªäº›éš¾ç‚¹éœ€è¦è§£å†³ï¼Ÿ

Aï¼šè¿™ä¸ªæˆ‘è¿˜åœ¨è°ƒæŸ¥ çŽ°åœ¨è¿˜æ²¡æœ‰ä¸€äº›ç»“è®º å…·ä½“çš„å¯ä»¥å…³æ³¨è¿™ä¸ª [bp](https://blueprints.launchpad.net/magnum) spec/native-docker-network,æˆ‘ä¼šå®šæœŸçš„åŽ» append ä¸€äº›è°ƒæŸ¥ç»“æžœ.å¸Œæœ›å¯¹ç½‘ç»œæ„Ÿå…´è¶£çš„äººå‚ä¸Žåˆ° [native-docker-network](https://blueprints.launchpad.net/magnum/%3Espec/native-docker-network) è¿™ä¸ª bp çš„è®¨è®ºä¸­æ¥ã€‚

> Qï¼šMagnum çš„ Blueprint å†™ç€"Add support for mesos bay type"ï¼Œbay type æ”¯æŒ mesos, k8s,swarmï¼Œè¿™ä¸ªä»¥åŽçœŸçš„èƒ½åšåˆ°ç»Ÿä¸€æŠ½è±¡å—ï¼Ÿè¿™ä¸‰è€…ä¹‹é—´å·®å¼‚åŒ–è¿˜ä¸å°ã€‚Magnum ç¤¾åŒºæ˜¯æ€Žä¹ˆè€ƒè™‘çš„ï¼Ÿ

Aï¼šè¿™æ˜¯ä¸ªéžå¸¸éš¾è§£çš„é—®é¢˜ï¼Œè¿™ä¸ªå¯èƒ½è¿˜å¾—éœ€è¦åœ¨å¼€å‘ä¸­ï¼Œå’Œç¤¾åŒºè®¨è®ºï¼Œçœ‹èƒ½ä¸èƒ½æœ‰ä¸€ä¸ªæŠ˜ä¸­çš„åŠžæ³•ï¼šèƒ½æŠ½è±¡çš„å°½é‡æŠ½è±¡ï¼Œä¸èƒ½æŠ½è±¡çš„å†å®šåˆ¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ OpenStack ML è®¨è®ºã€‚

> Qï¼šMagnum ç›¸å¯¹ Kubernetes çš„ä¼˜åŠ¿ï¼Ÿ

Aï¼šmagnum ç›¸å¯¹ä¸Ž Kubernetes çš„ä¼˜åŠ¿ä¸»è¦æœ‰è¿™ä¹ˆå‡ ä¸ªï¼š1ï¼‰å¤šç§Ÿæˆ·ï¼Œä¸åŒçš„ç§Ÿæˆ·æœ‰ä¸åŒ bayï¼Œbaymodel ç­‰ç­‰

2ï¼‰OpenStack ä¸º Kubernetes æä¾›åº•å±‚çš„åŸºç¡€è®¾æ–½æœåŠ¡ï¼ŒOpenStack è´Ÿè´£ IaaSï¼ŒKubernetes è´Ÿè´£ PaaSï¼ŒMagnum è´Ÿè´£è”é€š Kubernetes å’Œ OpenStackã€‚

> Qï¼šmagnum æ²¡æœ‰æ˜¾å¼åˆ›å»º master nodeï¼Œæ˜¯ä¸æ˜¯åˆ›å»º bay çš„æ—¶å€™å°±åˆ›å»ºäº† k8s/swarm çš„ master èŠ‚ç‚¹ï¼Ÿå¤šä¸ª k8s/swarm luster å°±æ˜¯åˆ›å»ºå¤šä¸ª bay å°± ok äº†ï¼Ÿ

Aï¼šç­”æ¡ˆéƒ½æ˜¯ yesï¼ŒMagnum ä¼šè‡ªåŠ¨åˆ›å»º Master èŠ‚ç‚¹ã€‚

---

### 2015-06-03ï¼šæ–°æµª SCE Docker æœ€ä½³å®žè·µ

> Qï¼šå¦‚ä½•å®žçŽ°è·¨æœºéƒ¨ç½²ï¼Ÿ

Aï¼šshipyard å’Œ swarm éƒ½å¯ï¼Œå½“ç„¶è¿˜æœ‰å…¶å®ƒæ–¹æ¡ˆã€‚shipyard æœ‰ä¸é”™çš„ web UIï¼Œæ”¯æŒ container å¤šæœºéƒ¨ç½²ï¼Œè°ƒåº¦åŸºäºŽ tagï¼Œè¿˜å¯ä»¥ scaleã€‚swarm è°ƒåº¦ç­–ç•¥æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥ä¾æ®ä½ æŒ‡å®šçš„ filterã€weighter è¿›è¡Œè°ƒåº¦éƒ¨ç½²ã€‚

> Qï¼šCompose èƒ½å¦å®žçŽ°è·¨æœºç¼–æŽ’ï¼Ÿ

Aï¼šä¸è¡Œã€‚ç›®å‰åªæ”¯æŒå•æœºç¼–æŽ’ã€‚

> Qï¼šcontainer ç›‘æŽ§æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ

Aï¼šcadvisor åš container ç›‘æŽ§ã€‚ç›‘æŽ§è¿™éƒ¨åˆ†ä¹Ÿæ˜¯æœ‰ä¸€å®šå·¥ä½œéœ€è¦åŽ»æƒ³åŽ»åšçš„ï¼Œæ¯”å¦‚è¯´å¯ä»¥è€ƒè™‘å’Œ EK ç»“åˆææ¥ï¼Œæä¾›ä¸€ä¸ªç‹¬ç«‹çš„ docker é›†ç¾¤ç›‘æŽ§è§£å†³æ–¹æ¡ˆå‡ºæ¥ã€‚

> Qï¼šå¦‚ä½•å¯¹æŸä¸€å®¹å™¨è¿›è¡Œæ‰©å®¹ï¼Ÿ

Aï¼šç›®å‰æ²¡æœ‰æ¯”è¾ƒå¥½çš„è§£å†³åŠžæ³•ï¼Œæˆ‘ä»¬çš„å»ºè®®çš„åšæ³•æ˜¯åˆ äº†å†å¯ä¸ªå¤§çš„ã€‚

> Qï¼šSCE æ–¹æ¡ˆä¸­ï¼Œdocker container å¤§æ¦‚æ˜¯è·‘åœ¨é‚£ä¸€å±‚ï¼Ÿ

Aï¼šå¤§æ¦‚çš„æ ˆæ˜¯ IaaSï¼ŒCaaSï¼ŒSCE docker container æ˜¯è·‘åœ¨ CaaSã€‚

---

### 2015-05-20ï¼šAppC å’Œ Docker çš„å¯¹æ¯”

> Qï¼šå…³äºŽé•œåƒçš„é—®é¢˜æ˜¯å¦å¯ä»¥åŸºäºŽæœ¬åœ°æºæ¥åˆ›å»ºï¼Ÿæˆ‘ä¸ªäººè§‰å¾—æœ¬åœ°æºå¯¹äºŽä¼ä¸šæ¥è¯´å¾ˆé‡è¦ã€‚

Aï¼šAppC çš„é•œåƒåˆ›å»ºæ–¹å¼ä¸å¤ªä¸€æ ·ï¼ŒçŽ°åœ¨è¿˜ä¸æ”¯æŒç”¨ç¼–å†™ Dockerfile è¿™æ ·çš„æ–¹å¼åˆ›å»ºï¼Œè€Œæ˜¯æŠŠæ–‡ä»¶æ”¾åˆ°æŒ‡å®šç»“æž„çš„ç›®å½•ï¼Œç„¶åŽç›´æŽ¥ç”¨ actool å·¥å…·æ‰“åŒ…åˆ›å»ºã€‚

> Qï¼šèƒ½æ”¯æŒä¸åŒçš„å‘è¡Œç‰ˆï¼Ÿ

Aï¼šAppC æ˜¯è·¨ç³»ç»Ÿçš„ï¼Œåªæ˜¯ä¸€ä¸ªæ ‡å‡†ã€‚Rkt å¯ä»¥åœ¨ä»»æ„çš„ Linux å‘åž‹ç‰ˆä½¿ç”¨ã€‚

> Qï¼šRkt çš„æœ€å°é•œåƒæ˜¯ï¼Ÿ

Aï¼šRkt çš„æœ€å°é•œåƒå¯ä»¥å°åˆ°é‡Œé¢åªæœ‰ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºã€‚

> Qï¼š"ä¿¡å™ªæ¯”"çš„æ¦‚å¿µä¸æ˜¯å¾ˆæ˜Žç™½ã€‚

Aï¼šå†…å®¹"ä¿¡å™ªæ¯”"å°±æ˜¯è¯´å®žé™…ç”¨æˆ·è¦çš„æ–‡ä»¶å’Œå…¶ä»–è¾…åŠ©æ–‡ä»¶çš„æ¯”ä¾‹ã€‚

> Qï¼šRkt å®¹å™¨å¯ä»¥èµ·å¤šè¿›ç¨‹å—ï¼Ÿ

Aï¼šå’Œ Docker ä¸€æ ·çš„ï¼Œå…¥å£å‘½ä»¤åªèƒ½ä¸€ä¸ªï¼Œé‡Œé¢å¯ä»¥åŽå°è¿è¡Œå¤šä¸ªè¿›ç¨‹ã€‚

> Qï¼š"ä½† Docker çš„è¿™ç§è¿›ç¨‹è¿è¡Œæ¨¡åž‹ï¼Œä½¿å¾—ä¸è®ºæ˜¯é€šè¿‡è¿›ç¨‹æ ‘è¿˜æ˜¯ cgroup æ ‘éƒ½æ— æ³•çœ‹å‡ºåˆ›å»ºå®¹å™¨çš„ Docker ä»¤è¡Œä¸Žå®¹å™¨æœ¬èº«æœ‰ä»»ä½•å…³ç³»ã€‚å› æ­¤è®¸å¤šä»»åŠ¡ç®¡ç†å·¥å…·å¦‚æžœä¸å¯¹ Docker è¿›ç¨‹è¿›è¡Œç‰¹åˆ«å¯¹å¾…ï¼Œå°±æ— æ³•æ­£å¸¸çš„ç®¡ç†é€šè¿‡ Docker å¯åŠ¨çš„å®¹å™¨é‡Œçš„è¿›ç¨‹ã€‚"è¿™é‡Œæåˆ°çš„ä»»åŠ¡å·¥å…·å¯¹ Docker è¿›ç¨‹ç‰¹åˆ«å¯¹å¾…ï¼Œé€šå¸¸éœ€è¦æ€Žä¹ˆå¤„ç†ï¼Œæ‰å¯ä»¥æ–¹ä¾¿ç”¨æˆ·çš„ä»»åŠ¡å·¥å…·å¯¹ Docker å¯åŠ¨å®¹å™¨é‡Œçš„è¿›ç¨‹è¿›è¡Œç®¡ç†ï¼Ÿ

Aï¼šå°±æ˜¯è¯´åœ¨æ¯”å¦‚ç»“æŸå®¹å™¨è¿›ç¨‹çš„æ—¶å€™ï¼Œä¸èƒ½é€šè¿‡å¯åŠ¨å®¹å™¨çš„å‘½ä»¤æ‰€åœ¨çš„ pid æˆ–è€… cgroup æ¥è·Ÿè¸ªå®¹å™¨å†…çš„è¿›ç¨‹ï¼Œè€Œè¦å’Œ Docker åŽå°æœåŠ¡è¿›ç¨‹åŽ»å–ã€‚

> Qï¼šé‚£ Rkt çš„æ—¥å¿—ç½‘ç»œç­‰æ˜¯æ€Žä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ

Aï¼šè¿™ä¸ª Rkt å°±æ’’æ‰‹ä¸ç®¡ï¼Œè®©ç”¨æˆ·è‡ªå·±é€‰æ‹©å…¶ä»–å·¥å…·ï¼Œæ¯”å¦‚ Kubernetes æˆ–è€… Mesos è¿™äº›æ¡†æž¶éƒ½å¯ä»¥ç”¨ï¼ŒAppC ç›®çš„å°±æ˜¯åšçº¯ç²¹å…³æ³¨å®¹å™¨æœ¬èº«åŠŸèƒ½ï¼ˆçŽ¯å¢ƒéš”ç¦»ï¼‰çš„å®¹å™¨ã€‚

> Qï¼šRkt è¿è¡Œè‡ªå·±çš„é•œåƒå’Œ Docker çš„é•œåƒæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ

Aï¼šé•œåƒæ ¼å¼ä¸Šæœ‰äº›åŒºåˆ«ï¼Œä¸è¿‡å…¶å®žä¸¤è€…åº”è¯¥æ˜¯å¾ˆå®¹æ˜“è½¬æ¢çš„ï¼ŒDocker å®¹å™¨åˆ° AppC å®¹å™¨è½¬æ¢çš„å·¥å…·å·²ç»æœ‰äº†ï¼Œåè½¬çš„è¿˜æ²¡æœ‰ï¼Œä¼°è®¡ Docker çŽ°åœ¨è‡ªå·±æ˜¯ä¸»æµï¼Œä¹Ÿæ²¡æ‰“ç®—åšè¿™ç§äº‹æƒ…ã€‚

> Qï¼šRkt æœ‰æä¾› Restful çš„ API å—ï¼Ÿ Aï¼šæ²¡æœ‰ï¼Œå› ä¸ºè¦å®žçŽ° Restful

API å°±å¿…éœ€è¦æœ‰ä¸€ä¸ªå¸¸é©»åŽå°çš„è¿›ç¨‹ï¼Œè¿™æ ·å°±è¿èƒŒäº† Rkt åšçº¯ç²¹çš„å®¹å™¨å·¥å…·ï¼Œå¹¶å°½å¯èƒ½çš„å‡å°‘å¯¹ç³»ç»Ÿå…¥ä¾µæ€§çš„è®¾è®¡æ„å›¾äº†ã€‚

> Qï¼šæ„Ÿè§‰ Rkt+CoreOS å’Œ Docker+Machine/Swarm/Compose è¿™ä¸¤ç§ç»„åˆéƒ½åœ¨åšé›†ç¾¤çš„äº‹æƒ…ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œå…¶å®žæ˜¯å­˜åœ¨ä¸€å®šç«žäº‰å…³ç³»çš„ã€‚åªä¸è¿‡ CoreOS è§‰å¾— Docker è¶Šåšè¶Šå¤æ‚ï¼Œä¸ç¬¦åˆä»–ä»¬çš„åº”ç”¨åœºæ™¯ï¼Œå°±æ–°å»ºäº†ä¸€å¥—ï¼Œé¡ºä¾¿æ”¹è¿›ä¸€äº› Docker çš„å°æ¯›ç—…ã€‚ä½† CoreOS ä¾ç„¶ä¼šå¯¹ Docker è§£å†³æ–¹æ¡ˆç»§ç»­æä¾›é•¿æœŸæ”¯æŒã€‚

> Qï¼šRkt èƒ½ä½¿ç”¨ Docker çš„é•œåƒå—ï¼Ÿ

Aï¼šèƒ½ï¼ŒRkt æ”¯æŒç›´æŽ¥ä¸‹è½½ DockerHub æˆ–å…¶ä»– Docker Repo çš„é•œåƒï¼Œåªæ˜¯ä¸‹è½½åŽä¼šè‡ªåŠ¨è½¬æ¢æˆ AppC æ ¼å¼å­˜å‚¨åˆ°æœ¬åœ°ã€‚

---

### 2015-05-12ï¼šDocker Registry çš„å®šåˆ¶å’Œæ€§èƒ½åˆ†æž

> Qï¼š2.0 çš„æ€§èƒ½ä¹Ÿæ²¡ä»€ä¹ˆå˜åŒ–å•Šï¼Œä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ

Aï¼šå®¢æˆ·ç«¯ä¼˜åŒ–æœ‰é™ï¼Œåœ¨è¶…è¿‡ 100 ä¸ªèŠ‚ç‚¹åŒæ—¶ pull ä¸€ä¸ªé•œåƒæ—¶ï¼Œ2.0 æœåŠ¡ç«¯èµ„æºå ç”¨å°‘ã€‚

> Qï¼šæœåŠ¡ç«¯çš„å¹¶å‘ç“¶é¢ˆåœ¨å“ªé‡Œï¼Ÿ

Aï¼šæœåŠ¡ç«¯çš„ä»£ç è¿˜æ²¡åšè¿‡æ›´å¤šçš„åˆ†æžï¼Œä»Žç»éªŒåˆ¤æ–­ä¸»è¦è¿˜æ˜¯ IOï¼Œpython çš„å†…å­˜å ç”¨æ¯”è¾ƒå¤šã€‚

> Qï¼šè€ƒè™‘è¿‡å¤šæœºæˆ¿ image å­˜å‚¨ CDN æ²¡ï¼Ÿ

Aï¼šè¿™ä¸ªè¿˜çœŸæ²¡è€ƒè™‘è¿‡ï¼Œç›®å‰æˆ‘ä»¬çš„é•œåƒæœåŠ¡æ˜¯ä¸ªå†…éƒ¨ PaaS å¹³å°ç”¨çš„ï¼Œåªè¦ä¿è¯é›†ç¾¤æ‰€åœ¨æœºæˆ¿èƒ½å¿«é€Ÿè®¿é—®å°±è¡Œã€‚

> Qï¼šé‚£è¿˜ä¸å¦‚æ¯æœºæˆ¿åŠ ç¼“å­˜ï¼Ÿ

Aï¼šæ˜¯çš„ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ registry çš„ mirror æœºåˆ¶ï¼Œç”¨äº† mirror åŽå¯ä»¥ä¸€ä¸ªç‚¹ pushï¼Œå…¶ä»–ç‚¹ pullã€‚

> Qï¼šä½ ä»¬çš„è°ƒåº¦å™¨æ˜¯è‡ªå·±å¼€å‘çš„å—ï¼Ÿ

Aï¼šæˆ‘ä»¬åº•å±‚ç”¨çš„æ˜¯ Kubernetesï¼Œè°ƒåº¦å™¨åšä¸€å®šçš„ä¿®æ”¹ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯å¤šä¸ªå¯ç”¨åŸŸã€‚

> Qï¼šå†…éƒ¨çš„ PaaS æœ‰æ²¡æœ‰åšèµ„æºé™åˆ¶ã€ç½‘ç»œéš”ç¦»ï¼Ÿ

Aï¼šæœ‰ï¼Œç›®å‰æˆ‘ä»¬çš„ Docker æ˜¯è·‘åœ¨ kvm ä¸Šã€‚

> Qï¼šæ˜¨å¤©ç½‘æ˜“å¥½å¤šæœåŠ¡æ–­ç‰‡äº†ï¼Œæ®è¯´æ˜¯ç½‘ç»œæ”»å‡»ï¼Œé‚£è¿™äº›æœåŠ¡æœ‰è·‘åœ¨ Docker ä¸Šå—ï¼Ÿ

Aï¼šæ–­ç‰‡æ˜¯å› ä¸º BGP çš„æ ¸å¿ƒäº¤æ¢æœºé—®é¢˜ï¼Œæˆ‘ä¹Ÿå¾ˆå¥½å¥‡æ˜¯ä»€ä¹ˆå¼•èµ·çš„ï¼Œç›®å‰è¿˜æ²¡æœ‰ç»„ç»‡å’Œä¸ªäººå£°ç§°å¯¹æ­¤äº‹è´Ÿè´£ã€‚

> Qï¼šæœ‰æ²¡æœ‰è€ƒè™‘è¿‡ nova-dockerï¼Ÿ

Aï¼šç¤¾åŒºä¸æ˜¯å¾ˆæ´»è·ƒï¼Œæˆ‘ä»¬æ²¡æœ‰é‡‡ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼Œä½†å¯¹äºŽä¸­å°å…¬å¸æ¥è¯´è¿™æ˜¯æœ€å¿«çš„æ–¹æ¡ˆã€‚

> Qï¼šä¸ºå•¥ä¸è€ƒè™‘è‡ªå·±å®žçŽ°è°ƒåº¦å™¨ï¼Ÿ

Aï¼šå¿™ä¸è¿‡æ¥ï¼Œæˆ‘ä»¬ä¹Ÿæƒ³åšå•Šï¼Œè¿™ä¸ªæ”¾åœ¨åŽé¢å®žçŽ°ã€‚

> Qï¼šæˆ‘ä»¬å‡†å¤‡åœ¨æŸå…¬æœ‰äº‘ä¸Šè·‘ Docker é›†ç¾¤ã€‚

Aï¼šå…ˆè¿™ä¹ˆç”¨å‘—ï¼Œæˆ‘è§‰å¾— Docker çš„ä¼˜åŠ¿å°±æ˜¯åº•å±‚å¹³å°æ— å…³ï¼Œä»ŠåŽæ¢äº†åº•å±‚è¿ç§»ä¹Ÿæ²¡æœ‰é‚£ä¹ˆå›°éš¾ã€‚
