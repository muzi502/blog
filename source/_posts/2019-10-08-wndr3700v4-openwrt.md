---
title: wndr3700v4  åˆ· openwrt ä¸€äº›å°ä¼˜åŒ–
date: 2019-10-08
categories: ææœº
slug:  wndr3700v4-openwrt
tag:
  - openwrt
copyright: true
comment: true
---

## 1. WNDR3700V4 æ‰©å±•åˆ†åŒºå¤§å°

åˆ·å®Œ `OpenWrt-18.06.0` åï¼Œæ ¹åˆ†åŒºåªåˆ©ç”¨äº† 14 MBï¼Œå¤§å¤šæ•°å¸–å­éƒ½æ˜¯é€šè¿‡ä¿®æ”¹æºç åˆ†åŒºè¡¨ï¼Œé‡æ–°ç¼–è¯‘å›ºä»¶è€Œå…¨éƒ¨åˆ©ç”¨å‰©ä½™ç©ºé—´ï¼Œä¸è¿‡è¿™æ ·åšå¯ä»¥ä¸€åŠ³æ°¸é€¸ã€‚ä½†å¾ˆå®¹æ˜“å˜ç –ï¼Œè€Œä¸”åˆ·å›åŸå‚å˜ç –çš„æ¦‚ç‡æå¤§ã€‚ç´¢æ€§è¿˜æ˜¯ä¸åŠ¨åˆ†åŒºè¡¨ï¼Œç›´æ¥é‡æ–°æ–°å»ºä¸€ä¸ªåˆ†åŒºå³å¯ã€‚é‡æ–°å»ºç«‹ä¸€ä¸ªåˆ†åŒºå‘ä¹Ÿæ¯”è¾ƒå¤š ğŸ˜‚

```bash
root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
/dev/root                 2.5M      2.5M         0 100% /rom
tmpfs                    61.0M      6.7M     54.4M  11% /tmp
/dev/ubi0_1              14.0M      8.1M      5.1M  61% /overlay
overlayfs:/overlay       14.0M      8.1M      5.1M  61% /
tmpfs                   512.0K         0    512.0K   0% /dev
```

[Create ubifs volumes in Linux (OpenWRT](http://geekwagner.blogspot.com/2019/02/create-ubifs-volumes-in-linux-openwrt.html)

When using a router flashed with OpenWRT, you may find that the capacity of the filesystem is much smaller than the real capacity. For example, the router I use is Netgear WNDR4300 which has a 128MB Nand flash. But when using the 'df -h' command to inspect the space usage status, I surprisingly found that the space of the total mounting point '/' is only 14MB.

So to find out the reason and try to expand usable space, I used the command "dmesg" and "cat /proc/mtd" to collect the information of mtd devices.

Then, make the ubifs I need.

```bash
ubiformat /dev/mtd11
ubiattach -p /dev/mtd11
ubimkvol /dev/ubi1 -N data -s 90MiB
mount -t ubifs ubi1:data /opt
Finally, add the following lines to /etc/rc.local to make it mount when router starts.
ubiattach -p /dev/mtd11
mount -t ubifs ubi1:data /opt
```

å®Œæ´»åçš„åˆ†åŒºä¿¡æ¯

```bash
root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
/dev/root                 2.5M      2.5M         0 100% /rom
tmpfs                    61.0M      6.7M     54.4M  11% /tmp
/dev/ubi0_1              14.0M      8.1M      5.1M  61% /overlay
overlayfs:/overlay       14.0M      8.1M      5.1M  61% /
tmpfs                   512.0K         0    512.0K   0% /dev
ubi1:data                81.4M      4.9M     72.3M   6% /opt

```

## 2.ä¿®æ”¹ opkg é»˜è®¤å®‰è£…è·¯å¾„

å‚ç…§å®˜æ–¹ Wiki  [opkg](https://openwrt.org/zh/docs/techref/opkg)

```bash
/etc/opkg.conf
src/gz snapshots http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages
dest root /
dest opt /opt
lists_dir ext /var/opkg-lists
option overlay_root /overlay

opkg install zsh git -d opt

# æ·»åŠ ç¯å¢ƒå˜é‡
export LD_LIBRARY_PATH="/opt/lib:/opt/usr/lib"
export PATH=/usr/bin:/usr/sbin:/bin:/sbin:/opt/usr/bin:/opt/bin
```

## 3.å®‰è£… frpc å¹¶è®¾ç½®å¼€æœºè‡ªå¯

å…ˆå»ç°åœ¨è‡ªå·±è·¯ç”±å™¨æ¶æ„ç›¸åŒçš„ç¼–è¯‘ ipk åŒ…ï¼Œå¦‚æœä¸æ¸…æ¥šè‡ªå·±è·¯ç”±å™¨èŠ¯ç‰‡çš„æ¶æ„ï¼Œå½“ä½ ä½¿ç”¨ opkg install å®‰è£…è½¯ä»¶çš„æ—¶å€™è½¯ä»¶æºçš„ url é‡Œæœ‰ä½ çš„èŠ¯ç‰‡æ¶æ„ã€‚
[openwrt-frp](https://github.com/kuoruan/openwrt-frp/releases)

æˆ‘çš„ wndr3700v4 æ˜¯ mips_24kc çš„æ¶æ„

```bash
wget https://github.com/kuoruan/openwrt-frp/releases/download/v0.29.0-1/frpc_0.29.0-1_mips_24kc.ipk
opkg install frpc_0.29.0-1_mips_24kc.ipk -d opt
ln -s /opt/usr/bin/frpc /usr/bin/frpc
```

å¯èƒ½ä¼šæŠ¥é”™ ğŸ˜‚ éœ€è¦å®‰è£… `libustream-openssl  ca-bundle ca-certificates` è¿™ä¸‰ä¸ªåŒ…

```bash
root@OpenWrt:/opt# wget https://github.com/kuoruan/openwrt-frp/releases/download/v0.29.0-1/frpc_0.29.0-1_mips_24kc.ipk
wget: SSL support not available, please install one of the libustream-.*[ssl|tls] packages as well as the ca-bundle and ca-certificates packages.

opkg install libustream-openssl  ca-bundle ca-certificates
```

## 4.å®‰è£… git

æ ¹åˆ†åŒºå‰©ä½™ç©ºé—´å¤ªå°äº†ï¼Œäºæ˜¯å°±å®‰è£…åœ¨å•ç‹¬çš„åˆ†åŒº opt åˆ†åŒº ä¸‹

```bash
opkg install git -d opt
```

```bash
ln -s /opt/usr/bin/git-upload-pack /usr/bin/git-upload-pack
ln -s /opt/usr/bin/git-upload-archive /usr/bin/git-upload-archive
ln -s /opt/usr/bin/git-receive-pack /usr/bin/git-receive-pack
ln -s /opt/usr/bin/git-receive-pack /usr/bin/git
```

## 5. https

```bash
opkg install libustream-openssl  ca-bundle ca-certificates
```
