---
title: N1 ÁõíÂ≠êÂà∑ÂÖ• OpenWrt Âπ∂ÈÉ®ÁΩ≤ K3s
date: 2020-03-08
updated: 2020-03-08
slug:
categories: Âà∑Êú∫
tag:
  - ËΩØË∑ØÁî±
  - OpenWrt
  - K3s
copyright: true
comment: true
---

## K3s

ÂéªÂπ¥ÁöÑÊó∂ÂÄôÂê¨‰∫Ü Rancher ÁöÑÁõ¥Êí≠ÂàÜ‰∫´ËÆ≤  [k3sÂú®ËæπÁºòËÆ°ÁÆó‰∏≠ÁöÑÂ∫îÁî®ÂÆûË∑µ](http://dockone.io/article/9384)ÔºåÂ∞±ÊÑüËßâÂæàÂ•ΩÁé©ÂÑøÔºåÂΩìÊó∂ÂØπ K3s ËøòÊòØÂæàÊÑüÂÖ¥Ë∂£ÔºåÊó†Â•àÂΩìÊó∂ÊâãÂ§¥Ê≤°ÊúâÂêàÈÄÇÁöÑÂºÄÂèëÊùøÂèØÁé©ÔºåÂ∞±Ê≤°ÊÑøÊÑèËä±Èí±ÂÜç‰π∞ÂùóÊ†ëËéìÊ¥æÂêÉÁÅ∞üòÇ„ÄÇÁõ¥Âà∞‰∏äÂë®Êú´ÁöÑÊó∂ÂÄô‰∏ÄÊ¨°Êú∫‰ºöÂæó‰ª•ÈáçÊñ∞ËÆ§ËØÜ‰∫Ü‰∏Ä‰∏ã [K3s](https://github.com/rancher/k3s) ÊâÄ‰ª•Â∞±ÊÉ≥Êâæ‰∏™ËÆæÂ§áÊù•Áé©Áé© K3s„ÄÇ‰∫éÊòØ‰∏úÊåëË•øÈÄâÂ∞±ÈÄâÂÆö‰∫ÜÊñêËÆØ N1 Ôºå‰ºòÁÇπÂ§öÂ§öÔºå‰∏ç‰ªÖÂèØ‰ª•ÂÅöË∑ØÁî±Âô®ËøòËÉΩË∑ë docker „ÄÅËøòËÉΩÂÅö NAS Á≠âÁ≠âÔºå‰∏§‰∏™Â≠óÁúüÈ¶ôüòÇ„ÄÇ‰πãÂâçÊàë‰∏ÄÁõ¥‰ΩøÁî® `R6300V2` Âà∑‰∫ÜÊ¢ÖÊûó‰ª•ÂèäÂè¶‰∏ÄÂè∞ `WNDR3700V4` Âà∑‰∫Ü `OpenWrt` ÂÅöÈÄèÊòé‰ª£ÁêÜÔºåÂú® `ESXi` ‰∏ä‰πüË£Ö‰∫Ü‰∏™ `OpenWrt` ËΩØË∑ØÁî±ÁªôÂÜÖÁΩëÁöÑËôöÊãüÊú∫ÂÅöÈÄèÊòé‰ª£ÁêÜÔºå‰ΩÜËøòÊòØÂøÉÊúâ‰∏çÁîòÊÉ≥Êâæ‰∏ÄÂè∞ÊÄßËÉΩÊõ¥Â•Ω‰∏ÄÁÇπÁöÑËÆæÂ§áÊù•ÂÅöÊóÅË∑ØÁΩëÂÖ≥„ÄÇÁªº‰∏äÂ∞±ÁßçËçâ‰π∞‰∫ÜÊó©Â∑≤ÁªèË¢´Â§ßÂÆ∂Áé©ÁÉÇ‰∫ÜÁöÑ [N1ÁõíÂ≠ê](https://pockies.github.io/2019/03/07/phicomm-n1/)„ÄÇ

## ÂºÄÁÆ±

### Â§ñÂåÖË£Ö

![image-20200308170852893](https://blog.k8s.li/img/20200308170852893.png)

### Êé•Âè£

![image-20200308170909549](https://blog.k8s.li/img/20200308170909549.png)

### ÂºÄÊú∫ÁîªÈù¢

![image-20200308170935704](https://blog.k8s.li/img/20200308170935704.png)

### ÁîµËßÜÁ≥ªÁªü

![image-20200308171000114](https://blog.k8s.li/img/20200308171000114.png)

### ÈÖçÁΩÆ

#### ÊãÜÊú∫

![image-20200309141919253](https://blog.k8s.li/img/20200309141919253.png)

#### CPU

- Amlogic S905ÔºåARM Cortex-A53ÔºåÂõõÊ†∏ 2GHzÔºåGPU ÊòØ ARM Mali‚Ñ¢-450ÔºåÊîØÊåÅ 4K@60fps Á°¨‰ª∂Ëß£Á†ÅÔºåHDMI 2.0„ÄÇ
- Âè¶Â§ñÊîØÊåÅ AES Âä†ÂØÜËß£ÂØÜÔºåÊâÄ‰ª•Âú®‰∏äÈù¢Ë∑ëÁöÑ SS/SSR ÁöÑÂä†ÂØÜÁÆóÊ≥ïÈÄÇÂêàÈÄâÊã© AES ÂñΩ„ÄÇ

```ini
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# cat /proc/cpuinfo
processor       : 0
model name      : ARMv8 Processor rev 4 (v8l)
BogoMIPS        : 48.00
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd03
CPU revision    : 4

processor       : 1
model name      : ARMv8 Processor rev 4 (v8l)
BogoMIPS        : 48.00
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd03
CPU revision    : 4

processor       : 2
model name      : ARMv8 Processor rev 4 (v8l)
BogoMIPS        : 48.00
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd03
CPU revision    : 4

processor       : 3
model name      : ARMv8 Processor rev 4 (v8l)
BogoMIPS        : 48.00
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd03
CPU revision    : 4
```

#### RAM

- ÂÜÖÂ≠òËäØÁâá RAMÔºöK4B4G1646E ÔºåDDR3-1866MHzÔºåÂÜÖÂ≠òÂÆπÈáè 512MBÔºõÂâçÂêé‰∏ÄÂÖ±Êúâ 4 È¢óÔºåÊÄªÂÜÖÂ≠ò 2GB„ÄÇ

```bash
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# cat /proc/meminfo
MemTotal:        1851688 kB
MemFree:         1278128 kB
MemAvailable:    1639036 kB
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# dmesg | grep Memory
[    0.000000] Memory: 924744K/1911808K available (12926K kernel code, 1108K rwdata, 5116K rodata, 640K init, 748K bss, 69560K reserved, 917504K cma-reserved)
```

#### ROM

- KLM8G1GEMEÔºå8GB eMMC„ÄÇ

```bash
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# fdisk -l /dev/mmcblk1
Disk /dev/mmcblk1: 7.3 GiB, 7818182656 bytes, 15269888 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x7db7c786

Device         Boot   Start      End  Sectors  Size Id Type
/dev/mmcblk1p1      1433600  1695743   262144  128M  c W95 FAT32 (LBA)
/dev/mmcblk1p2      1695744  2744319  1048576  512M 83 Linux
/dev/mmcblk1p3      2744320 15269887 12525568    6G 83 Linux
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# lsblk
NAME         MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
mmcblk1      179:0    0  7.3G  0 disk
‚îú‚îÄmmcblk1p1  179:1    0  128M  0 part /boot
‚îú‚îÄmmcblk1p2  179:2    0  512M  0 part /
‚îî‚îÄmmcblk1p3  179:3    0    6G  0 part /mnt/mmcblk1p3
mmcblk1boot0 179:32   0    4M  1 disk
mmcblk1boot1 179:64   0    4M  1 disk
```

#### net

- ÂçÉÂÖÜ `1Gbps/Full` ÁΩëÂç°‰ª•Âèä 2.4GHz/5GHz ÁöÑÊó†Á∫øÁΩëÂç°
- ÁúãÂà∞ `RTL8211F` ÊàëÂì≠‰∫ÜÔºåÁ´üÁÑ∂ÊòØËûÉËüπÂç°ÔºåÊéÄÊ°åÂÑøüò°
- WIFI ËäØÁâáÔºöÂ±èËîΩÁΩ©ÊòØÁÑäÊ≠ªÁöÑÔºåÊâÄ‰ª•‰∏çÊ∏ÖÊ•ö„ÄÇÂè™Áü•ÈÅìÊòØÂèåÈ¢ë 1x1mimo Áî®ÊîØÊåÅ 5G acÔºå2.4G ËøûÊé•ÈÄüÁéá 65MbpsÔºå5G ËøûÊé•ÈÄüÁéá 390Mbps„ÄÇ‰∏∫‰ªÄ‰πà‰∏çÊòØ 72m Âíå 433mÔºåÂõ†‰∏∫ No SGI„ÄÇ

> ÔºàN1‰∏çÊîØÊåÅ RTL8153ÔºåÊòØÂõ†‰∏∫Á°¨‰ª∂‰æõÁîµÁöÑÂéüÂõ†Ôºå‰∏çÊòØÈ©±Âä®ÁöÑÂéüÂõ†Ôºå‰πüÊúâ‰∏™Âà´ÁΩëÂèãËØ¥ËÉΩÊîØÊåÅÁöÑÔºåÂèØËÉΩÂõ†‰∏∫ rtl8153 ‰πüÊúâ‰∏çÂêåÁâàÊú¨Ôºå‰ΩÜÊîØ ÊåÅAX88179ÔºåÈÄüÁéá 200m Â∑¶Âè≥, Âõ†Ê≠§‰ªéÊÄßËÉΩ‰∏äËÄÉËôëÔºåN1‰∏çÂª∫ËÆÆÂ§ñÊé•‰ªª‰ΩïÁΩëÂç°ÔºåÁõ¥Êé•Áî®ÂçïÁΩëÂç°ÂÅöÊóÅË∑ØÁî±‰πüËÉΩËææÂà∞ 750m Â∑¶Âè≥Ôºâ

```ini
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# dmesg | grep net
[    0.000000] Kernel command line: root=UUID=69fd696a-85a4-4ec8-b604-4cefd053cbc1 rootfstype=btrfs rootflags=compress=zstd console=ttyAML0,115200n8 console=tty0 no_console_suspend consoleblank=0 fsck.fix=yes fsck.repair=yes net.ifnames=0 cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory swapaccount=1
[    0.691325] audit: initializing netlink subsys (disabled)
[    5.131043] meson8b-dwmac c9410000.ethernet: IRQ eth_wake_irq not found
[    5.136694] meson8b-dwmac c9410000.ethernet: IRQ eth_lpi not found
[    5.142854] meson8b-dwmac c9410000.ethernet: PTP uses main clock
[    5.148731] meson8b-dwmac c9410000.ethernet: no reset control found
[    5.155366] meson8b-dwmac c9410000.ethernet: User ID: 0x11, Synopsys ID: 0x37
[    5.162029] meson8b-dwmac c9410000.ethernet:         DWMAC1000
[    5.167192] meson8b-dwmac c9410000.ethernet: DMA HW capability register supported
[    5.174594] meson8b-dwmac c9410000.ethernet: RX Checksum Offload Engine supported
[    5.182017] meson8b-dwmac c9410000.ethernet: COE Type 2
[    5.187192] meson8b-dwmac c9410000.ethernet: TX Checksum insertion supported
[    5.194171] meson8b-dwmac c9410000.ethernet: Wake-Up On Lan supported
[    5.200586] meson8b-dwmac c9410000.ethernet: Normal descriptors
[    5.206426] meson8b-dwmac c9410000.ethernet: Ring mode enabled
[    5.212198] meson8b-dwmac c9410000.ethernet: Enable RX Mitigation via HW Watchdog Timer
[    5.428271] Initializing XFRM netlink socket
[    5.521946] bridge: filtering via arp/ip/ip6tables is no longer available by default. Update your scripts to load br_netfilter if you need this.
[   11.076508] meson8b-dwmac c9410000.ethernet eth0: PHY [0.2009087f:00] driver [RTL8211F Gigabit Ethernet]
[   11.083720] meson8b-dwmac c9410000.ethernet eth0: No Safety Features support found
[   11.088006] meson8b-dwmac c9410000.ethernet eth0: PTP not supported by HW
[   11.094588] meson8b-dwmac c9410000.ethernet eth0: configuring for phy/rgmii link mode
[   19.250095] meson8b-dwmac c9410000.ethernet eth0: PHY [0.2009087f:00] driver [RTL8211F Gigabit Ethernet]
[   19.265579] meson8b-dwmac c9410000.ethernet eth0: No Safety Features support found
[   19.267519] meson8b-dwmac c9410000.ethernet eth0: PTP not supported by HW
[   19.274244] meson8b-dwmac c9410000.ethernet eth0: configuring for phy/rgmii link mode
[   19.411257] netlink: 4 bytes leftover after parsing attributes in process `iw'.
[   19.595853] ieee80211 phy0: brcmf_net_attach: couldn't register the net device
[   19.597447] ieee80211 phy0: brcmf_ap_add_vif: Registering netdevice failed
[   21.019546] meson8b-dwmac c9410000.ethernet eth0: Link is Up - 1Gbps/Full - flow control rx/tx
[ 1047.556475] meson8b-dwmac c9410000.ethernet eth0: Link is Down
[ 1047.772626] meson8b-dwmac c9410000.ethernet eth0: PHY [0.2009087f:00] driver [RTL8211F Gigabit Ethernet]
[ 1047.785569] meson8b-dwmac c9410000.ethernet eth0: No Safety Features support found
[ 1047.787510] meson8b-dwmac c9410000.ethernet eth0: PTP not supported by HW
[ 1047.794242] meson8b-dwmac c9410000.ethernet eth0: configuring for phy/rgmii link mode
[ 1051.459018] meson8b-dwmac c9410000.ethernet eth0: Link is Up - 1Gbps/Full - flow control rx/tx
[ 1241.984013] netlink: 4 bytes leftover after parsing attributes in process `iw'.
[ 1346.112897] meson8b-dwmac c9410000.ethernet eth0: Link is Down
[ 1346.295582] meson8b-dwmac c9410000.ethernet eth0: PHY [0.2009087f:00] driver [RTL8211F Gigabit Ethernet]
[ 1346.312202] meson8b-dwmac c9410000.ethernet eth0: No Safety Features support found
[ 1346.314172] meson8b-dwmac c9410000.ethernet eth0: PTP not supported by HW
[ 1346.320888] meson8b-dwmac c9410000.ethernet eth0: configuring for phy/rgmii link mode
[ 1349.769672] meson8b-dwmac c9410000.ethernet eth0: Link is Up - 1Gbps/Full - flow control rx/tx
```

#### htop

ÂêºÂêºÂêºÔºåÂ±ÖÁÑ∂ËøòËÉΩË∑ë Docker ÔºåÈÇ£ K3s ‰πüËÇØÂÆöÊ≤°ÈóÆÈ¢òÂï¶Ôºà

![image-20200308180733757](https://blog.k8s.li/img/20200308180733757.png)

## ÂáÜÂ§á

È¶ñÂÖàÂáÜÂ§á‰∏™Âà∑Êú∫ËøáÁ®ã‰∏≠ÈúÄË¶ÅÁöÑÊ∏ÖÂçï ~~Âà´Áúã‰Ω†‰ªäÂ§©ÈóπÂæóÊ¨¢ÔºåÂ∞èÂøÉ‰ªäÂêéÊãâÊ∏ÖÂçï~~

- USB ÂÖ¨ÂØπÂÖ¨Êï∞ÊçÆÁ∫øÔºàÂçñÂÆ∂Ëµ†ÈÄÅ‰∫ÜÁ∫ø
- ÁΩëÁ∫øÊàñ WiFiÔºåÁΩëÁ∫øÊúâÊó∂Ëé∑Âèñ‰∏çÂà∞Ê≠£Á°ÆÁöÑ IP ÔºåÂèØ‰ª•ÂÄüÂä© WiFi
- HDMI Á∫ø‰ª•ÂèäÊòæÁ§∫Âô®ÔºåÈúÄË¶ÅËøõÂÖ•ÁõíÂ≠êÁ≥ªÁªüÊâãÂä®ÂºÄÂêØ adb
- Android SDK Âπ≥Âè∞Â∑•ÂÖ∑ [Platform-tools](https://developer.android.com/studio/releases/platform-tools)
- ÈïúÂÉèÂÜôÂÖ•Â∑•ÂÖ∑ [Rufus](https://github.com/pbatard/rufus) Êàñ [Roadkils DiskImage](https://www.roadkil.net/program.php?ProgramID=12)
- OpenWrt ÈïúÂÉè [N1_Openwrt_R20.2.15_k5.4.23-amlogic-flippy-28+o.7z](https://disk.longe.xyz/N1/Openwrt/28%2Bo%E7%89%88N1_OP_U%E7%9B%98%E7%9B%B4%E5%88%B7%E5%8C%85/N1_Openwrt_R20.2.15_k5.4.23-amlogic-flippy-28%2Bo.7z)

> Openwrt_U ÁõòÁõ¥Âà∑ÂåÖÔºöÈìæÊé•Ôºöhttps://pan.baidu.com/s/1K0bNItsY1-Br4o1EsRokkg ÊèêÂèñÁ†ÅÔºölidf

### Êé®ËçêËµÑÊ∫ê

Âà∑Êú∫ËøáÁ®ã‰∏≠ÁöÑËµÑÊ∫êÊù•Ëá™‰ª•‰∏ãÔºåÂèØ‰ª•ÂéªËøôÈáåÊâæÊõ¥Â§ö‰Ω†ÊÉ≥Ë¶ÅÁöÑÔºå‰ªñ‰ª¨ÁöÑÊïôÁ®ã‰πü‰ºöÊØîÊàëÊõ¥‰ºòÁßÄ‰∏Ä‰∫õÔºåËÄå‰∏î B Á´ô‰∏ä‰πüÊúâËßÜÈ¢ëÔºåËßÜÈ¢ëËÆ≤Ëß£ÁöÑË¶ÅÊõ¥Â•Ω„ÄÇÂÜôËøôÁØáÂçöÂÆ¢‰πüÂè™ÊòØ‰∏∫‰∫ÜËÆ∞ÂΩï‰∏Ä‰∏ãüòÇ

- [Pi&N1 Google Drive](https://drive.google.com/drive/folders/1XvhPCwodZzCfV83oW3DXegAvDOrHW7iV)
- [‰∏âÂçÉÈóÆ](https://github.com/real-pin1group/3000web/wiki)
- [t.me/PIN1Group](https://t.me/PIN1Group)
- [Pi&N1‰∫§ÊµÅÁæ§ÈÄöÁü•È¢ëÈÅì](https://t.me/NewPiN1Channel)
- [Â±±Â∞èÁÇÆÁΩëÁõò](https://disk.longe.xyz/)
- [Phicomm N1Âà∑openwrtË∑ØÁî±Âõ∫‰ª∂ËØ¶ÁªÜÁ¨îËÆ∞.pdf](https://disk.longe.xyz/N1/OpenWrt/%E3%80%902019-6-20%E3%80%91Phicomm%20N1%E5%88%B7openwrt%E8%B7%AF%E7%94%B1%E5%9B%BA%E4%BB%B6%E8%AF%A6%E7%BB%86%E7%AC%94%E8%AE%B0.pdf)
- [28+oÁâàN1_OP_UÁõòÁõ¥Âà∑ÂåÖ](https://disk.longe.xyz/N1/OpenWrt/28%2BoÁâàN1_OP_UÁõòÁõ¥Âà∑ÂåÖ/)
- [[2020-3-8]‚òÖ29+ÁâàN1_OP_UÁõòÁõ¥Âà∑ÂåÖÔºåÂèäË¥ùÂ£≥‰∫ë_OP_Á∫øÂà∑ÂåÖÔºåÂÜÖÊ†∏5.4](https://www.right.com.cn/forum/thread-981406-1-1.html)

## Âà∑Êú∫

### ÂºÄÂêØ ADB

![image-20200309085941030](https://blog.k8s.li/img/20200309085941030.png)

Â∞Ü HDMI Á∫øËøûÊé•Âà∞ÁõíÂ≠êÁöÑ HDMI Âè£ÔºåÂ∞Ü USB ÂÖ¨ÂØπÂÖ¨ÁöÑÊï∞ÊçÆÁ∫øÂàÜÂà´ÊèíÂú®ÁõíÂ≠êÁöÑÈù†Ëøë HDMI Âè£ÁöÑ USB ÔºåÂè¶‰∏ÄÂ§¥ÊèíÂú® PC ÁöÑ USB Âè£ÔºåÂÜçÂ∞ÜÈº†Ê†áËøûÊé•Âà∞ÁõíÂ≠êÁöÑÂè¶‰∏Ä‰∏™ USB Âè£„ÄÇÊèíÂ•Ω‰∏äËø∞ÁöÑÁ∫øÁºÜ‰πãÂêéÊèí‰∏äÁîµÊ∫êÂºÄÊú∫ÔºåÁî±‰∫éÁõíÂ≠êÊ≤°ÊúâÁîµÊ∫êÂºÄÂÖ≥ÊâÄ‰ª•Âè™ËÉΩÈÄöËøáÊèíÊãîÁîµÊ∫êÁöÑÊñπÂºèÂºÄÂÖ≥Êú∫„ÄÇÂºÄÊú∫‰πãÂêé‰ºöËá™Âä®ËøõÂÖ•Âà∞ÁîµËßÜÁõíÂ≠êÁ≥ªÁªüÁöÑÈ°µÈù¢ÔºåÁÑ∂ÂêéÊå™Âä®Èº†Ê†áÔºåÂú® `Âõ∫‰ª∂ÁâàÊú¨`  ÈÇ£ÈáåÁãÇÁÇπÈº†Ê†áÂõõ‰∏ãÂºÄÂêØ `ADB` Ë∞ÉËØïÊ®°Âºè„ÄÇÂ±èÂπï‰∏≠Èó¥‰ºöÂºπÂá∫‰∏™ÁÅ∞Ëâ≤ÁöÑÊñπÊ°ÜÊèêÁ§∫`ÊâìÂºÄ adb`

> PSÔºöÊèêÂà∞ adb Âí±Â∞±‰∏çÁî±Ëá™‰∏ªÂú∞ÊÉ≥Ëµ∑‰∫ÜÂéªÂπ¥‰∏ñÁïå‰∫îÁôæÂº∫‰ªñÂÆ∂ÁöÑÂè∑Áß∞Ë¶ÅÂèñ‰ª£ Android „ÄÅËá™‰∏ªÁ†îÂèë„ÄÅÂæÆÂÜÖÊ†∏„ÄÅÈù¢ÂêëÁ°ÆÂÆö[Êó∂Âª∂](https://zh.wikipedia.org/wiki/Êó∂Âª∂)„ÄÅÂàÜÂ∏ÉÂºè„ÄÅÂΩ¢ÂºèÂåñÈ™åËØÅ„ÄÅÂ§öÂú∫ÊôØÔºõÂ§ßÂêçÈºéÈºéÁöÑÂìÑÊáµÔºàPPTÔºâÊìç‰ΩúÁ≥ªÁªüÁ´üÁÑ∂‰πüÊúâ ADB ÔºàÂÅ∑Á¨ë

Âú®ËøôÈáåÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÊàë‰ΩøÁî®ÁΩëÁ∫øËøûÊé•ÁõíÂ≠êÂíåË∑ØÁî±Âô®ÂêéÔºåÂ±èÂπï‰∏äÊòæÁ§∫ÁöÑ IP Âπ∂‰∏çÊòØÊàëÊú¨Âú∞ÂÜÖÁΩëÁöÑ IP ÔºåËøô‰∏ÄÁÇπÂæàÂ•áÊÄ™ÔºåËÄå‰ΩøÁî®Êó†Á∫øËøûÊé•Âà∞ÊàëÁöÑÊó†Á∫øË∑ØÁî±Âô®ÂêéÂéªËÉΩËé∑ÂèñÂà∞Ê≠£Â∏∏ÁöÑÂÜÖÁΩë IP ÔºåÊâÄ‰ª•Â¶ÇÊûú‰Ω†‰ΩøÁî®ÁΩëÁ∫øËøûÊé•Êó∂‰πüÈÅáÂà∞ËøôÊ†∑ÁöÑÊÉÖÂÜµÔºå‰∏çÂ¶®Â∞ùËØï‰∏Ä‰∏ã‰ΩøÁî®Êó†Á∫øËøûÊé•„ÄÇ

![image-20200308171341327](https://blog.k8s.li/img/20200308171341327.png)

### PC ‰∏äËøûÊé• ADB ËøõÂÖ• fastboot Ê®°Âºè

‰∏äËø∞Ë¶ÅÂ∞ÜÁõíÂ≠êÁöÑ HMDI Êé•ÂÖ•ÊòæÁ§∫Âô®Âπ∂Êèí‰∏äÈº†Ê†áÔºåÂ∞±ÊòØ‰∏∫‰∫ÜÂú® ADB Ê®°Âºè‰∏ãËøõÂÖ• fastboot Ê®°ÂºèÔºåËÄå fastboot Ê®°ÂºèÂíåÊàë‰ª¨ÊôÆÈÄöÁöÑ Android Âà∑Êú∫Êó∂ÁöÑ fastboot ‰∏ÄÊ†∑Ôºå‰ΩïÂÜµËøô‰∏™ÁõíÂ≠ê‰πüÊòØÂü∫‰∫é Android ÁöÑÔºåÊâÄ‰ª•ÂòõÔºåÂíå Android Âà∑Êú∫Â§ßÂêåÂ∞èÂºÇ„ÄÇÁÑ∂Âêé‰∏ãËΩΩÂ•Ω Android SDK Âπ≥Âè∞Â∑•ÂÖ∑ [Platform-tools](https://developer.android.com/studio/releases/platform-tools) Âπ∂Ëß£ÂéãÂà∞ÂêàÈÄÇÁöÑ‰ΩçÁΩÆÔºåÊåâ‰Ωè `shift` ÈîÆ‰πãÂêéÈº†Ê†áÂè≥ÈîÆÁÇπÂáª`Âú®Ê≠§Â§ÑÊâìÂºÄ Powershell Á™óÂè£` ÔºåÊé•ÁùÄÂú®ËØ•ÂëΩ‰ª§Ë°å‰∏ãËæìÂÖ• `adb.exe connect IP` ÔºåËøôÈáåÁöÑ IP Âç≥‰∏∫Â±èÂπï‰∏äÊòæÁ§∫ÁöÑ IP ÔºåËøûÊé•ÊàêÂäü‰πãÂêé‰ºöÊúâÊèêÁ§∫Â∑≤ÁªèËøûÊé•„ÄÇÁÑ∂ÂêéÂÜçËøêË°å `adb.exe shell reboot fastboot` ËøõÂÖ• fastboot Ê®°Âºè„ÄÇËøô‰∏ÄÊ≠•ÂíåÊàë‰ª¨Áªô Android ÊâãÊú∫Âà∑Êú∫Êó∂‰ø∫ÁîµÊ∫êÈîÆ+Èü≥ÈáèÈîÆÔºåËøõÂÖ• fastboot Ê®°Âºè‰∏ÄÊ†∑ÁöÑÈÅìÁêÜÔºåÂè™‰∏çËøáÁõíÂ≠êÊ≤°ÊúâÈü≥ÈáèÈîÆÂíåÂºÄÊú∫ÈîÆÔºåÊâÄ‰ª•Ë¶Å‰ΩøÁî® adb ÁöÑÊñπÂºèËøõÂÖ•Âà∞ fastboot „ÄÇ

```powershell
PS D:\Desktop> adb.exe connect 192.168.0.105
connected to 192.168.0.105:5555
PS D:\Desktop\N1> adb.exe shell reboot fastboot
```

### Âà∑ÂÖ•ÈôçÁ∫ßÈïúÂÉè

ÁõíÂ≠êÈáçÂêØËøõÂÖ• fastboot Ê®°Âºè‰πãÂêéÔºåPC ‰∏ä‰ºöÊèêÁ§∫ÊèíÂÖ•Êñ∞ËÆæÂ§áÔºåÂπ∂ÂèÆÂíöÂìç‰∏Ä‰∏ãÔºå‰πãÂêé‰ºöËá™Âä®ÂÆâË£Ö‰∏äÈ©±Âä®Á®ãÂ∫è„ÄÇ

Âè≥ÈîÆËÆ°ÁÆóÊú∫-->ÁÆ°ÁêÜ--> ËÆæÂ§áÁÆ°ÁêÜÂô® `LeMobile Android Device` ‰∏ãÁöÑ `Android ADB Interface` „ÄÇÂ¶ÇÊûúÊ≤°ÊúâÂá∫Áé∞ËØ•ËÆæÂ§áÁöÑËØùÔºåÂèØ‰ª•‰∏ãËΩΩ‰∏™È©±Âä®ÂÆâË£ÖÁ®ãÂ∫èÊù•Áªô‰Ω†Ë£Ö‰∏äËØ•ËÆæÂ§áÁöÑÈ©±Âä®„ÄÇ‰ΩøÁî® `fastboot devices -l` ÂëΩ‰ª§Êù•Êü•ÁúãËØ•ËÆæÂ§áÊòØÂê¶Ê≠£Â∏∏ËøûÊé•‰∏ä„ÄÇ

![image-20200308152333262](https://blog.k8s.li/img/20200308152333262.png)

```powershell
PS D:\Desktop\N1> fastboot devices -l
1234567890             fastboot
```

#### Ê†°È™åÈïúÂÉè

```ini
Mode                LastWriteTime         Length Name
----          -------------   ------ ----
-a----   2020/3/7     17:53       14191104 boot.img
-a----   2020/3/7     17:53         672256 bootloader.img
-a----   2020/3/7     17:53            605 hash.txt
-a----   2020/3/7     17:53       18295296 recovery.img
# Âà∑Êú∫‰πãÂâçË¶ÅÂÖàÊ†°È™åÈïúÂÉèÊòØÂê¶ÂÆåÊï¥ÊàñËÄÖË¢´ÁØ°ÊîπÔºåÂÖªÊàêÂ•Ω‰π†ÊÉØüòã
PS D:\Desktop\N1> cat .\hash.txt
Êñá‰ª∂: N1_V2.19_imgs\bootloader.img
Â§ßÂ∞è: 672256 Â≠óËäÇ
‰øÆÊîπÊó∂Èó¥: 2018Âπ¥5Êúà25Êó• ÊòüÊúü‰∫î, 23:09:08
MD5: 80BD2EFED2F76B6ECA56F7E026549E1A
SHA1: 3A1FFCADF062748CA1D00EB80E73F2175B160A0D
CRC32: 34BA154A

Êñá‰ª∂: N1_V2.19_imgs\recovery.img
Â§ßÂ∞è: 18295296 Â≠óËäÇ
‰øÆÊîπÊó∂Èó¥: 2018Âπ¥5Êúà25Êó• ÊòüÊúü‰∫î, 23:09:19
MD5: CAC6ED1DED5BB1D9CFAD39B2B1C6CD8A
SHA1: B468A3134B376A5295C1FD5857343128D0AC056C
CRC32: AA11C424

Êñá‰ª∂: N1_V2.19_imgs\boot.img
Â§ßÂ∞è: 14191104 Â≠óËäÇ
‰øÆÊîπÊó∂Èó¥: 2018Âπ¥5Êúà25Êó• ÊòüÊúü‰∫î, 23:09:46
MD5: 75DA954D0C4CBCD4A86CEE501B40C5AA
SHA1: 1A0D04DB8FB57F252C72C909A3268B6B2C3BD241
CRC32: 547D7823

# Windows CMD ‰∏ãÂèØ‰ΩøÁî® certUtil Êù•ËÆ°ÁÆóÊñá‰ª∂ÁöÑ HASH ÂÄº
PS D:\Desktop\N1> certUtil -hashfile .\recovery.img
SHA1 hash of .\recovery.img:
b468a3134b376a5295c1fd5857343128d0ac056c
CertUtil: -hashfile command completed successfully.
PS D:\Desktop\N1> certUtil -hashfile .\boot.img
SHA1 hash of .\boot.img:
1a0d04db8fb57f252c72c909a3268b6b2c3bd241
CertUtil: -hashfile command completed successfully.
PS D:\Desktop\N1> certUtil -hashfile .\bootloader.img
SHA1 hash of .\bootloader.img:
3a1ffcadf062748ca1d00eb80e73f2175b160a0d
CertUtil: -hashfile command completed successfully.
```

#### ËæìÂÖ•ÈôçÁ∫ßÂåÖÈïúÂÉè

```bash
# ÁÑ∂ÂêéÊ†πÊçÆÂØπÂ∫îÁöÑÂàÜÂå∫Âà∑ÂÖ•ÂØπÂ∫îÁöÑÈïúÂÉèÔºåËøôÁÇπ‰∏çË¶ÅÊêûÊ∑∑Ôºå‰∏çÁÑ∂‰ºöÂèòÁ†ñÁöÑ
PS D:\Desktop\N1> fastboot flash bootloader bootloader.img
Sending 'bootloader' (656 KB)                      OKAY [  0.037s]
Writing 'bootloader'                               OKAY [  0.075s]
Finished. Total time: 0.118s
PS D:\Desktop\N1> fastboot flash boot boot.img
Sending 'boot' (13858 KB)                          OKAY [  0.620s]
Writing 'boot'                                     OKAY [  0.666s]
Finished. Total time: 1.290s
PS D:\Desktop\N1> fastboot flash recovery recovery.img
Sending 'recovery' (17866 KB)                      OKAY [  0.802s]
Writing 'recovery'                                 OKAY [  0.869s]
Finished. Total time: 1.684s
PS D:\Desktop\N1>
```

### Â∞Ü OpenWrt Âà∑ÂÖ• EMMC

ÈôçÁ∫ßÊàêÂäü‰πãÂêéÊàë‰ª¨Â∞±ÂèØ‰ª•ÂºÄÊú∫ËøõÂÖ•Á∫øÂà∑Ê®°ÂºèÔºå‰ªéËÄåÂèØ‰ª•ÈÄâÊã©‰ªé U ÁõòËÆæÂ§áÂêØÂä®Ôºå‰πãÊâÄ‰ª•ÈôçÁ∫ß‰πüÊòØÂõ†‰∏∫ËøôÔºåÈ´òÁâàÊú¨ÁöÑÂõ∫‰ª∂Â±èËîΩ‰∫ÜËøô‰∏ÄÂäüËÉΩ„ÄÇÊàë‰ª¨Êó†Ê≥ïÁõ¥Êé•Â∞Ü OpenWrt ÁöÑÈïúÂÉèÂÜôÂÖ•Âà∞ÁõíÂ≠êÁöÑ EMMC Â≠òÂÇ®‰∏≠ÔºåË¶ÅËøõÂÖ•Âà∞‰∏Ä‰∏™Âè´ Armbian ÁöÑÂµåÂÖ•ÂºèÁ≥ªÁªü‰∏≠ÔºåÂú® Armbian Á≥ªÁªüÈáåÂ∞Ü OpenWrt ÈïúÂÉèÂÜôÂÖ•Âà∞ EMMC Â≠òÂÇ®ËÆæÂ§á‰∏≠„ÄÇËÄå‰πüÊúâ‰∏Ä‰∫õÂ§ß‰Ω¨Â∞Ü‰∫åËÄÖÁöÑÈïúÂÉèÁªìÂêàÂú®‰∏ÄËµ∑Ôºå‰πüÂ∞±ÊòØÂèØ‰ª•‰ΩøÁî®ËØ•ÈïúÂÉèÂú® U ÁõòÊ®°Âºè‰∏ãÂ∞Ü OpenWrt ÈïúÂÉèÂÜôÂÖ•Âà∞ EMMC ‰∏≠ÔºåÂπ∂‰∏îÂáÜÂ§áÂ•Ω‰∫ÜËá™Âä®ÂÜôÂÖ•ÁöÑËÑöÊú¨ÔºåÊØîËæÉÊñπ‰æø„ÄÇËØ•ÈïúÂÉèÂèØ‰ª•‰ªé [29+ÁâàN1_OP_UÁõòÁõ¥Âà∑ÂåÖÔºåÂèäË¥ùÂ£≥‰∫ë_OP_Á∫øÂà∑ÂåÖÔºåÂÜÖÊ†∏5.4](https://www.right.com.cn/forum/thread-981406-1-1.html) ÊâæÂà∞„ÄÇ

#### ÂÜôÂÖ• U ÁõòÈïúÂÉè

ÊàëÂÜôÂÖ• U ÁõòÁöÑÈïúÂÉèÊòØ N1_**Openwrt_R20.2.15_k5.4.23-amlogic-flippy-28+.img** ‰πüÂ∞±ÊòØ `N1-Openwrt_UÁõòÁõ¥Âà∑ÂåÖ` ÔºåÂÜôÂÖ•Â∑•ÂÖ∑‰ΩøÁî®  [Rufus](https://github.com/pbatard/rufus) Êàñ [Roadkils DiskImage](https://www.roadkil.net/program.php?ProgramID=12) ÈÉΩÂèØ‰ª•ÔºåÂ∞±ÂíåÊàë‰ª¨Âπ≥Êó∂Âà∂‰ΩúÂêØÂä®Áõò‰∏ÄÊ†∑„ÄÇ

#### ‰ªé update Ê®°ÂºèÂêØÂä® Armbian

Ë¶ÅÊãîÊéâ USB ÂÖ¨ÂØπÂÖ¨ÁöÑÁ∫øÔºåÁõíÂ≠êÂºÄÊú∫Âêé‰ΩøÁî® bat ËÑöÊú¨ËøõÂÖ•Á∫øÂà∑Ê®°ÂºèÔºåÂú® update Ê®°Âºè‰∏ãÊâçÂèØ‰ª•‰ªéÊàë‰ª¨ÂàöÂàöÂÜôÂÖ•ÁöÑÈïúÂÉè U Áõò‰∏≠ÂêØÂä®„ÄÇÂ¶ÇÊûú‰Ω†‰∏ãËΩΩÂ•Ω Google Drive ‰∏äÁöÑËµÑÊ∫êÁöÑËØùÔºåÂ∑•ÂÖ∑Âú® `/Áé©Ê≥ï0--ÂêÑÁßçÁé©Ê≥ïÂøÖÂ§áÂ∑•ÂÖ∑/2---ËøõÁ∫øÂà∑Ê®°ÂºèÂ∑•ÂÖ∑---ÂêØÂä®UÁõòÁ≥ªÁªüÂâçË¶ÅÂÖàËøõÁ∫øÂà∑Ê®°Âºè/ËøõÁ∫øÂà∑Ê®°ÂºèÂ∑•ÂÖ∑` ‰∏ãÁöÑ

```powershell
@echo off
echo Êú¨Â∑•ÂÖ∑ÈÄöËøáadbËøûÊé•‰ΩøN1ÈáçÂêØËøõÂÖ•Á∫øÂà∑Ê®°Âºè!
echo ËØ∑ÂÖàÁî®usbÂèåÂÖ¨Â§¥Á∫øËøûÊé•ÁõíÂ≠êÂíåÁîµËÑë!
echo made by webpad
set /p ip=ËØ∑ËæìÂÖ•ÁõíÂ≠êÁöÑÂÜÖÁΩëIPÂú∞ÂùÄÔºö
adb kill-server
if "%ip%" == "" echo ÊèêÁ§∫ÔºöËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑIPÂú∞ÂùÄ && goto end
echo ÂºÄÂßãÈÄöËøáÁΩëÁªúËøõË°åADBËøûÊé•‚Ä¶‚Ä¶
adb connect %ip%
adb devices -l | findstr "p230"
if %ERRORLEVEL% NEQ 0 echo ËøûÊé•ÊµãËØïÂ§±Ë¥•ÔºÅËØ∑Á°Æ‰øùÂ∑≤ÂºÄÂêØËøúÁ®ãË∞ÉËØïÔºÅ&&goto end
echo *
echo *
echo *
echo ÁõíÂ≠êÂ∑≤ÈáçÂêØËøõÂÖ•Á∫øÂà∑Ê®°ÂºèÔºåËã•windowsÂèëÁé∞‰∫ÜÊñ∞ËÆæÂ§áÔºåËØ∑Âú®ËÆæÂ§áÁÆ°ÁêÜÂô®‰∏≠ÊâãÂä®ÂÆâË£ÖÈ©±Âä®ÔºåÊ≠§Á™óÂè£ÂèØ‰ª•ÂÖ≥Èó≠...
adb shell reboot update
del adbshell.txt >nul 2>nul

:end
echo Êåâ‰ªªÊÑèÈîÆÈÄÄÂá∫...
pause > nul
```

ÊâßË°åÂÆåËØ•ËÑöÊú¨Âêé**ÊèêÁ§∫ÊàêÂäüËøõÂÖ•Á∫øÂà∑Ê®°ÂºèÊó∂Â∞±È©¨‰∏äÊèíÂà∑Â•ΩÈïúÂÉèÁöÑ U Áõò** ‰∏çË¶ÅÈîôËøáÊó∂Êú∫(„ÄÇ„Éª‚àÄ„Éª)„Éé

ÂÖ∂ÂÆûËøô‰∏™Â∑•ÂÖ∑‰πüÂ∞±ÊòØ‰∏ÄÊù° `adb shell reboot update` Êåá‰ª§ËÄåÂ∑≤Ôºå`abd connect  IP ` ËøûÊé•Âà∞ÁõíÂ≠ê‰πãÂêéÔºåÁÑ∂ÂêéÂÜçÊâßË°å `adb shell reboot update` ÔºåÁÑ∂ÂêéÂÜçÊèíÂÖ•ÂàöÂàöÂÜôÂ•ΩÈïúÂÉèÁöÑ U Áõò„ÄÇÊèí‰∏ä HMDI Á∫øËøûÊé•ÊòæÁ§∫Âô®Â∞±‰ºöÁúãÂà∞ÊéßÂà∂ÁªàÁ´ØËæìÂá∫ÁùÄÂêØÂä®ÊµÅÁ®ãÁöÑÁîªÈù¢Ôºå‰∏äÈù¢ËøòÊúâÂõõÂè™Â∞è‰ºÅÈπÖÔºåËøôÂ∞±ËØ¥ÊòéÊàë‰ª¨ÊàêÂäüËøõÂÖ•‰∫Ü Armbian Á≥ªÁªü

#### Â∞Ü OpenWrt ÂÜôÂÖ•Âà∞ EMMC Â≠òÂÇ®‰∏≠

```bash
cd /root
./inst-to-emmc.sh
```

ËØ•ËÑöÊú¨ÊàêÂäüÊâßË°åÂêéÔºåÈáçÂêØÊãîÊéâ U ÁõòÂ∞±ÂèØ‰ª•Áõ¥Êé•ËøõÂÖ•Âà∞ OpenWrt Á≥ªÁªü‰∏≠‰∫ÜÔºöÔºâ

## OpenWrt ‰∏äÁöÑ‰∏Ä‰∫õÂ∞è‰ºòÂåñ

‰ΩøÁî®  `ifconfig eth0 192.168.0.211 netmask 255.255.255.0` ‰øÆÊîπ eth0 ÁöÑ IP Ôºå‰ΩÜ‰æùÊóßÊó†Ê≥ï ping ÈÄö 192.168.0.1 ÁΩëÂÖ≥ÔºåËøòÈúÄË¶Å‰øÆÊîπ‰∏Ä‰∏ã LAN Âè£ÁöÑÈÖçÁΩÆ„ÄÇ

### ‰øÆÊîπ IP

Áî±‰∫é LAN Âè£ÈªòËÆ§ÁöÑÊòØ `192.168.1.1` ÔºåÂ¶ÇÊûú‰Ω†ÁöÑÁΩëÁªú‰∏çÊòØÂú®ËØ•ÁΩëÊÆµ‰∏ãÁöÑËØùÂ∞±Ëøû‰∏ç‰∏äËØ•ËÆæÂ§áÔºåÊâÄ‰ª•Â¶ÇÊûú‰∏çÊòØÈááÁî®Áõ¥ËøûÁΩëÁ∫øÁöÑËØùÔºåËÄåÊòØÂ∞ÜÁõíÂ≠êËøûÊé•Âú®Ë∑ØÁî±Âô®ÔºåËøôÊó∂Â∞±ÈúÄË¶ÅÊâãÂä®‰øÆÊîπ‰∏Ä‰∏ãÈªòËÆ§ÁöÑÈÖçÁΩÆÊâçËÉΩËøûÊé•Âà∞ÁõíÂ≠ê„ÄÇ

```yaml
config interface 'lan'
        option type 'bridge'
        option ifname 'eth0'
        option proto 'static'
        option netmask '255.255.255.0'
        option dns '119.29.29.29'
        option gateway '192.168.0.1'
        option delegate '0'
        option ipaddr '192.168.0.211'
```

‰øÆÊîπ‰∏Ä‰∏ã lan ÁΩëÂè£ÁöÑ IP ‰∏∫‰Ω†ÂÜÖÁΩëÂèØËÆøÈóÆÂà∞ÁöÑ IP Âç≥ÂèØÔºåËøôÊ†∑Êàë‰ª¨Â∞±ÂèØ‰ª•‰ΩøÁî®ËØ• IP ËÆøÈóÆ OpenWrt Á≥ªÁªü‰∫Ü

### ÂÆâË£ÖÂøÖÂ§áÂ∑•ÂÖ∑

```bash
# È¶ñÂÖà‰øÆÊîπ‰∏Ä‰∏ã opkg Ê∫êÔºåÈªòËÆ§Áªô‰øÆÊîπ‰∏∫‰∏≠ÁßëÂ§ßÁöÑ‰ª£ÁêÜÈïúÂÉèÁ´ô‰∫ÜÔºåËøôÁÇπ‰∏çÈîô
‚ï≠‚îÄroot@OpenWrt /mnt
‚ï∞‚îÄ# opkg update
Downloading https://openwrt.proxy.ustclug.org/snapshots/targets/armvirt/64/packages/Packages.gz
Updated list of available packages in /var/opkg-lists/openwrt_core
Downloading
```

- git  ËøôÊòØÂøÖÈ°ªÁöÑÂëÄ
- ca-bundle Âíå ca-certificatesÔºåhttps ÂøÖÈ°ªË¶ÅÁî®Âà∞ÁöÑ
- git-http Â¶ÇÊûú‰∏çË£ÖÁöÑËØùÂú® git clone https ÁöÑ repo Êó∂‰ºöÊèêÁ§∫ [‚ÄúUnable to find remote helper for 'https'‚Äù during git clone](https://stackoverflow.com/questions/8329485/unable-to-find-remote-helper-for-https-during-git-clone)
- zsh Âíå oh-my-zshÔºåÂº∫Â§ßÁöÑ shell ‰∏çÁî®Â∫üËØùüòã

```bash
‚ï≠‚îÄroot@OpenWrt /mnt
‚ï∞‚îÄ# opkg install git zsh git-http ca-bundle ca-certificates wget curl
Package git (2.25.1-1) installed in root is up to date.
Package zsh (5.7.1-1) installed in root is up to date.
Package git-http (2.25.1-1) installed in root is up to date.
Package ca-bundle (20190110-2) installed in root is up to date.
Package ca-certificates (20190110-2) installed in root is up to date.
Upgrading wget on root from 1.20.3-2 to 1.20.3-3...
Downloading https://openwrt.proxy.ustclug.org/snapshots/packages/aarch64_generic/packages/wget_1.20.3-3_aarch64_generic.ipk
Multiple packages (librt and librt) providing same name marked HOLD or PREFER. Using latest.
Upgrading curl on root from 7.66.0-1 to 7.68.0-1...
Downloading https://openwrt.proxy.ustclug.org/snapshots/packages/aarch64_generic/base/curl_7.68.0-1_aarch64_generic.ipk
Configuring curl.
Configuring wget.
```

#### zsh Ë∏©Âùë

ÂÆâË£ÖÂÆå oh-my-zsh ‰πãÂêéÔºå‰∏ç‰ºöÂ∏Æ‰Ω†‰øÆÊîπ `/etc/passwd` ‰∏≠ÁöÑÈÖçÁΩÆÔºåÈúÄË¶ÅÊâãÂä®‰øÆÊîπÔºåÁÑ∂ÂêéÊàëËøòÊòØÊåâÁÖßÂæÄÂ∏∏ÁöÑ‰øÆÊîπÊñπÊ≥ïÔºö

`root:x:0:0:root:/root:/bin/zsh`

Á¨¨‰∫åÂ§©ÊàëÂºÄÂºÄÂøÉÂøÉÂú∞ ssh ÁôªÂΩïÊó∂ÔºåÂΩìÂú∫ÁøªËΩ¶‰∫ÜÔºåÂÆÉ‰ºöÊèêÁ§∫`Permission denied, please try again.` ÔºåÂí¶ÊàëÂØÜÁ†ÅÂ∞±ÊòØËøô‰∏™ÂëÄ„ÄÇ

```bash
debug1: Next authentication method: password
root@192.168.0.211's password:
debug1: Authentications that can continue: publickey,password,keyboard-interactive
Permission denied, please try again.
root@192.168.0.211's password:
```

ÁÑ∂ÂêéÊàëÈÄöËøá OpenWrt ÁöÑ web ÁÆ°ÁêÜÈ°µÈù¢ËÉΩÊ≠£Â∏∏ÁôªÂΩïÔºåÂú® web ÁÆ°ÁêÜ‰∏≠ÁöÑ `TTYD ÁªàÁ´Ø`‰∏≠Â∞ùËØïÁôªÂΩïÔºåÁÑ∂ÂêéÂ∞±‰ºöÊèêÁ§∫‰Ω† `connection closed` ÔºåÁúãÊù•ÊâæÂà∞ÈóÆÈ¢òÁöÑÂéüÂõ†‰∫ÜÔºåÁî®Êà∑ÁôªÂΩïÊó∂Êó†Ê≥ïÊâßË°åÂÆÉÁöÑ shell ÊâÄËá¥„ÄÇÊØîËæÉÂ•ΩÁöÑËß£ÂÜ≥ÂäûÊ≥ïÂ∞±ÊòØÂú® web ÁÆ°ÁêÜÈ°µÈù¢ `Á≥ªÁªü ‚Äì> Â§á‰ªΩ/ÂçáÁ∫ß`ÈÇ£ÈáåÂ§á‰ªΩÈÖçÁΩÆÊñá‰ª∂ ‚Äì>ÊääÂ§á‰ªΩ‰∏ãËΩΩ‰∏ãÊù• ‚Äì> ~~ÁÑ∂ÂêéËß£ÂåÖÂêé‰øÆÊîπÈÖçÁΩÆÊñá‰ª∂ÂÜçÊâìÂåÖ~~ Áõ¥Êé•‰ΩøÁî® vim ÊâìÂºÄ tar ÂåÖ‰øÆÊîπ `/etc/passwd` ‚Äì> ÂÜç‰∏ä‰º†ÊÅ¢Â§çÈÖçÁΩÆÊñá‰ª∂Âç≥ÂèØ„ÄÇÊõ≤Á∫øÊïëÂõΩ „Å§Ôπè‚äÇ ‰∏çËøáÂú®Ê≠§ÈúÄË¶ÅÊ≥®ÊÑè‰∏Ä‰∏ãÂ§á‰ªΩÊñá‰ª∂ÁöÑÁõÆÂΩïÁªìÊûÑÔºåËß£ÂåÖÂâçÁõÆÂΩïÁªìÊûÑÊòØ‰ªÄ‰πàÊ†∑ÔºåÈáçÊñ∞ÊâìÂåÖ‰πãÂêéÁöÑÁõÆÂΩïÁªìÊûÑ‰πüÊòØ‰ªÄ‰πàÊ†∑„ÄÇ

```bash
OpenWrt login: root
Password:
login: can't execute '/bin/zsh': No such file or directory
```

Âú® Debian Âíå Ubuntu ÂèëË°åÁâà‰∏≠ zsh ‰ºöÈªòËÆ§ÂÆâË£ÖÂú® `/bin/zsh` ‰∏ãÔºåÂπ∂ÂàõÂª∫‰∏Ä‰∏™ `/usr/bin/zsh` ÁöÑ‰∏Ä‰∏™ËΩØÈìæÊé•„ÄÇ

```bash
‚ï≠‚îÄdebian@debian /mnt/d/Desktop
‚ï∞‚îÄ$ ls -alh /bin/zsh
-rwxr-xr-x 1 root root 842K Feb  5  2019 /bin/zsh
‚ï≠‚îÄdebian@debian /mnt/d/Desktop
‚ï∞‚îÄ$ ls -alh /usr/bin/zsh
lrwxrwxrwx 1 root root 8 Aug 31  2019 /usr/bin/zsh -> /bin/zsh
```

ËÄåÂú® OpenWrt ‰∏≠Âç¥ÈªòËÆ§ÂÆâË£ÖÂú®‰∫Ü `/usr/bin/zsh` ‰∏ãÔºå‰πüÊ≤°Êúâ‰∏∫ `/bin/zsh` ÂàõÂª∫‰∏Ä‰∏™ËΩØÈìæÊé•Ôºå‰πüÂ∞ùËØïËøá‰ΩøÁî®scp ÁöÑÊñπÂºèÂ∞Ü `/usr/bin/zsh` Â§çÂà∂Âà∞ `/bin/zsh` ÔºåÊ≤°ÊÉ≥Âà∞ scp ‰πüÈúÄË¶ÅÁî®Êà∑ÁöÑ shell Á®ãÂ∫èÊù•ÊâßË°åüòê

```bash
# OpenWrt ‰∏ã zsh ÁöÑÂÆâË£ÖË∑ØÂæÑ‰∏∫ /usr/bin/zsh ËÄå‰∏çÊòØ‰º†ÁªüÂèëÁõ∏Áâà‰∏≠ÁöÑ /bin/zsh
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# where zsh
/usr/bin/zsh

# Â∞ùËØï‰ΩøÁî® scp Â§çÂà∂‰∏Ä‰ªΩ zsh Âà∞ /bin/zsh Ôºå‰∏çÂæóË°åÔºÅüòÇ
‚ï≠‚îÄdebian@debian ~
‚ï∞‚îÄ$ scp root@192.168.0.211:/usr/bin/zsh root@192.168.0.211:/bin/zsh
root@192.168.0.211's password:
Permission denied, please try again.
```

### ÈÉ®ÁΩ≤‰∏Ä‰∏ã K3s

ËøôÈáåÂè™ÊòØÁÆÄÂçïÁöÑÈÉ®ÁΩ≤ËØïÁî®‰∏Ä‰∏ãÔºåÂêéÊúüÊàë‰ºöËØ¶ÁªÜËÆ≤‰∏Ä‰∏ãÂÖ≥‰∫é K3s ÁöÑÂÜÖÂÆπ„ÄÇ

#### ÂÆòÊñπËÑöÊú¨

Ê†πÊçÆÂÆòÊñπÁöÑËÑöÊú¨‰∏ÄÂè•ÂëΩ‰ª§Ë°å`curl -sfL https://get.k3s.io | sh -`Â∞±ËÉΩË∑ëËµ∑ K3s Âá∫Êù•ÔºåÊØîËµ∑ÈöîÂ£ÅÁöÑ K8s Ë¶ÅÁÆÄÂçïÂæàÂ§öÂæàÂ§ö„ÄÇ‰ΩÜÊòØËÑöÊú¨‰∏ÄÊâßË°åÂ∞±ÁøªËΩ¶‰∫ÜüòÇ

```bash
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# curl -sfL https://get.k3s.io | sh -
[ERROR]  Can not find systemd or openrc to use as a process supervisor for k3s
```

Áî±‰∫é OpenWrt Ê≤°Êúâ systemd Âíå OpenRC Êù•ÁÆ°ÁêÜËøõÁ®ãÔºåÊâÄ‰ª•Êó†Ê≥ïÈÄöËøáËÑöÊú¨ÁöÑÊñπÂºè‰∏ÄÈîÆÈÉ®ÁΩ≤ÔºåÂè™ËÉΩ‰∫åËøõÂà∂ÈÉ®ÁΩ≤Âï¶„ÄÇÂõ†‰∏∫ systemd ÂØπ‰∫é OpenWrt Êù•ËÆ≤Ëøá‰∫éÂ§çÊùÇËáÉËÇøÔºåÂØπ‰∫éÂá†ÂçÅ MB ÁîöËá≥Âá† MB Â≠òÂÇ®Á©∫Èó¥ÁöÑË∑ØÁî±Âô®Êù•ËØ¥ÂÆûÂú®ÊòØË£Ö‰∏ç‰∏ã„ÄÇÊâÄ‰ª• OpenWrt ‰ΩøÁî®ÁöÑ init Á≥ªÁªüÊòØ `procd`

> Whereas desktop distributions use [glib](https://en.wikipedia.org/wiki/GLib)+[dbus](https://en.wikipedia.org/wiki/D-Bus)+[udev(part of systemd)](https://en.wikipedia.org/wiki/udev), OpenWrt uses [libubox](https://openwrt.org/docs/techref/libubox)+[ubus](https://openwrt.org/docs/techref/ubus)+[hotplug2](https://openwrt.org/docs/techref/hotplug_legacy). This provides some pretty awesome functionality without requiring huge libraries with huge dependencies (*cough* glib).

#### ‰∫åËøõÂà∂ÈÉ®ÁΩ≤

Âú® K3s ÁöÑ release È°µÈù¢‰∏ãËΩΩÂà∞ [k3s-arm64](https://github.com/rancher/k3s/releases/download/v1.17.3%2Bk3s1/k3s-arm64) ‰∫åËøõÂà∂Êñá‰ª∂„ÄÇÊàëÊîæÂú®‰∫Ü `/opt/bin/` ÁõÆÂΩï‰∏ãÔºåÂπ∂Âú® `.zshrc` ËøΩÂä† `export PATH=/opt/bin:$PATH` ÁéØÂ¢ÉÂèòÈáè„ÄÇ

#### usage

```bash
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# k3s
NAME:
   k3s - Kubernetes, but small and simple

USAGE:
   k3s [global options] command [command options] [arguments...]

VERSION:
   v1.17.3+k3s1 (5b17a175)

COMMANDS:
   server        Run management server
   agent         Run node agent
   kubectl       Run kubectl
   crictl        Run crictl
   ctr           Run ctr
   check-config  Run config check
   help, h       Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --debug        Turn on debug logs [$K3S_DEBUG]
   --help, -h     show help
   --version, -v  print the version
```

#### check-config

ÂêØÂä®‰∏Ä‰∏™ K3s ÈõÜÁæ§‰πãÂâçÁ∫ø check config ‰∏Ä‰∏ã‰∏ãüòã

```yaml
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# k3s check-config
INFO[0000] Preparing data dir /var/lib/rancher/k3s/data/a61d93bc56bb3dd34b5ca93517164f5b503e16b6c7414e87b11cf336eeb8ebd7

Verifying binaries in /var/lib/rancher/k3s/data/a61d93bc56bb3dd34b5ca93517164f5b503e16b6c7414e87b11cf336eeb8ebd7/bin:
- sha256sum: good
- links: good

System:
- /usr/sbin iptables v1.8.3 (legacy): ok
- swap: disabled
- routes: ok

Limits:
- /proc/sys/kernel/keys/root_maxkeys: 1000000

modprobe: module configs not found in modules.dep
info: reading kernel config from /proc/config.gz ...

Generally Necessary:
- cgroup hierarchy: properly mounted [/sys/fs/cgroup]
- CONFIG_NAMESPACES: enabled
- CONFIG_NET_NS: enabled
- CONFIG_PID_NS: enabled
- CONFIG_IPC_NS: enabled
- CONFIG_UTS_NS: enabled
- CONFIG_CGROUPS: enabled
- CONFIG_CGROUP_CPUACCT: enabled
- CONFIG_CGROUP_DEVICE: enabled
- CONFIG_CGROUP_FREEZER: enabled
- CONFIG_CGROUP_SCHED: enabled
- CONFIG_CPUSETS: enabled
- CONFIG_MEMCG: enabled
- CONFIG_KEYS: enabled
- CONFIG_VETH: enabled (as module)
- CONFIG_BRIDGE: enabled
- CONFIG_BRIDGE_NETFILTER: enabled (as module)
- CONFIG_NF_NAT_IPV4: missing (fail)
- CONFIG_IP_NF_FILTER: enabled
- CONFIG_IP_NF_TARGET_MASQUERADE: enabled (as module)
- CONFIG_NETFILTER_XT_MATCH_ADDRTYPE: enabled (as module)
- CONFIG_NETFILTER_XT_MATCH_CONNTRACK: enabled
- CONFIG_NETFILTER_XT_MATCH_IPVS: enabled (as module)
- CONFIG_IP_NF_NAT: enabled
- CONFIG_NF_NAT: enabled
- CONFIG_NF_NAT_NEEDED: missing (fail)
- CONFIG_POSIX_MQUEUE: enabled

Optional Features:
- CONFIG_USER_NS: enabled
- CONFIG_SECCOMP: enabled
- CONFIG_CGROUP_PIDS: enabled
- CONFIG_BLK_CGROUP: enabled
- CONFIG_BLK_DEV_THROTTLING: enabled
- CONFIG_CGROUP_PERF: enabled
- CONFIG_CGROUP_HUGETLB: enabled
- CONFIG_NET_CLS_CGROUP: enabled (as module)
- CONFIG_CGROUP_NET_PRIO: enabled
- CONFIG_CFS_BANDWIDTH: enabled
- CONFIG_FAIR_GROUP_SCHED: enabled
- CONFIG_RT_GROUP_SCHED: enabled
- CONFIG_IP_NF_TARGET_REDIRECT: enabled (as module)
- CONFIG_IP_SET: enabled
- CONFIG_IP_VS: enabled (as module)
- CONFIG_IP_VS_NFCT: enabled
- CONFIG_IP_VS_PROTO_TCP: enabled
- CONFIG_IP_VS_PROTO_UDP: enabled
- CONFIG_IP_VS_RR: enabled (as module)
- CONFIG_EXT4_FS: enabled
- CONFIG_EXT4_FS_POSIX_ACL: enabled
- CONFIG_EXT4_FS_SECURITY: enabled
- Network Drivers:
  - "overlay":
    - CONFIG_VXLAN: enabled (as module)
      Optional (for encrypted networks):
      - CONFIG_CRYPTO: enabled
      - CONFIG_CRYPTO_AEAD: enabled
      - CONFIG_CRYPTO_GCM: enabled
      - CONFIG_CRYPTO_SEQIV: enabled
      - CONFIG_CRYPTO_GHASH: enabled
      - CONFIG_XFRM: enabled
      - CONFIG_XFRM_USER: enabled
      - CONFIG_XFRM_ALGO: enabled
      - CONFIG_INET_ESP: enabled
      - CONFIG_INET_XFRM_MODE_TRANSPORT: missing
- Storage Drivers:
  - "overlay":
    - CONFIG_OVERLAY_FS: enabled

STATUS: 2 (fail)

```

ÂèëÁé∞ `ONFIG_NF_NAT_IPV4: missing (fail)` Âíå `CONFIG_NF_NAT_NEEDED: missing (fail)` Â§±Ë¥•‰∫ÜüôÉÔºåÂÖà‰∏çÁÆ°ÁúãÁúãËÉΩ‰∏çËÉΩË∑ëËµ∑Êù•ÂÜçËØ¥„ÄÇ

#### ÂàõÂª∫ K3s ÈõÜÁæ§

Ê†πÊçÆ K3s ÁöÑÊñáÊ°£Ôºå‰ΩøÁî® `k3s server`  ÈÄâÈ°πÂ∞±ËÉΩÂàõÂª∫‰∏Ä‰∏™ K3s ÈõÜÁæ§

```bash
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# k3s server
INFO[2020-03-08T20:17:00.103499172+08:00] Starting k3s v1.17.3+k3s1 (5b17a175)
INFO[2020-03-08T20:17:00.112443368+08:00] Kine listening on unix://kine.sock
INFO[2020-03-08T20:17:01.572347551+08:00] Active TLS secret  (ver=) (count 7): map[listener.cattle.io/cn-10.43.0.1:10.43.0.1 listener.cattle.io/cn-127.0.0.1:127.0.0.1 listener.cattle.io/cn-192.168.0.212:192.168.0.212 listener.cattle.io/cn-kubernetes:kubernetes listener.cattle.io/cn-kubernetes.default:kubernetes.default listener.cattle.io/cn-kubernetes.default.svc.cluster.local:kubernetes.default.svc.cluster.local listener.cattle.io/cn-localhost:localhost listener.cattle.io/hash:089b0c6a0b78e5f9d3a33b154e97185f644ed693bee80d4559c47e00f19af2f8]
INFO[2020-03-08T20:17:01.591244044+08:00] Running kube-apiserver --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=unknown --authorization-mode=Node,RBAC --basic-auth-file=/var/lib/rancher/k3s/server/cred/passwd --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction --etcd-servers=unix://kine.sock --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=k3s --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key
Flag --basic-auth-file has been deprecated, Basic authentication mode is deprecated and will be removed in a future release. It is not recommended for production environments.
I0308 20:17:01.593861    9319 server.go:622] external host was not specified, using 192.168.0.212
I0308 20:17:01.594884    9319 server.go:163] Version: v1.17.3+k3s1
I0308 20:17:04.485872    9319 plugins.go:158] Loaded 11 mutating admission controller(s) successfully in the following order: NamespaceLifecycle,LimitRanger,ServiceAccount,NodeRestriction,TaintNodesByCondition,Priority,DefaultTolerationSeconds,DefaultStorageClass,StorageObjectInUseProtection,MutatingAdmissionWebhook,RuntimeClass.
I0308 20:17:04.485954    9319 plugins.go:161] Loaded 7 validating admission controller(s) successfully in the following order: LimitRanger,ServiceAccount,Priority,PersistentVolumeClaimResize,ValidatingAdmissionWebhook,RuntimeClass,ResourceQuota.
I0308 20:17:04.491004    9319 plugins.go:158] Loaded 11 mutating admission controller(s) successfully in the following order: NamespaceLifecycle,LimitRanger,ServiceAccount,NodeRestriction,TaintNodesByCondition,Priority,DefaultTolerationSeconds,DefaultStorageClass,StorageObjectInUseProtection,MutatingAdmissionWebhook,RuntimeClass.
I0308 20:17:04.491084    9319 plugins.go:161] Loaded 7 validating admission controller(s) successfully in the following order: LimitRanger,ServiceAccount,Priority,PersistentVolumeClaimResize,ValidatingAdmissionWebhook,RuntimeClass,ResourceQuota.
I0308 20:17:04.592193    9319 master.go:267] Using reconciler: lease
I0308 20:17:04.699310    9319 rest.go:115] the default service ipfamily for this cluster is: IPv4
W0308 20:17:06.161374    9319 genericapiserver.go:404] Skipping API batch/v2alpha1 because it has no resources.
W0308 20:17:06.212135    9319 genericapiserver.go:404] Skipping API discovery.k8s.io/v1alpha1 because it has no resources.
W0308 20:17:06.264606    9319 genericapiserver.go:404] Skipping API node.k8s.io/v1alpha1 because it has no resources.
W0308 20:17:06.361403    9319 genericapiserver.go:404] Skipping API rbac.authorization.k8s.io/v1alpha1 because it has no resources.
W0308 20:17:06.379432    9319 genericapiserver.go:404] Skipping API scheduling.k8s.io/v1alpha1 because it has no resources.
W0308 20:17:06.447661    9319 genericapiserver.go:404] Skipping API storage.k8s.io/v1alpha1 because it has no resources.
W0308 20:17:06.550084    9319 genericapiserver.go:404] Skipping API apps/v1beta2 because it has no resources.
W0308 20:17:06.550168    9319 genericapiserver.go:404] Skipping API apps/v1beta1 because it has no resources.
I0308 20:17:06.599929    9319 plugins.go:158] Loaded 11 mutating admission controller(s) successfully in the following order: NamespaceLifecycle,LimitRanger,ServiceAccount,NodeRestriction,TaintNodesByCondition,Priority,DefaultTolerationSeconds,DefaultStorageClass,StorageObjectInUseProtection,MutatingAdmissionWebhook,RuntimeClass.
I0308 20:17:06.600017    9319 plugins.go:161] Loaded 7 validating admission controller(s) successfully in the following order: LimitRanger,ServiceAccount,Priority,PersistentVolumeClaimResize,ValidatingAdmissionWebhook,RuntimeClass,ResourceQuota.
I0308 20:17:16.394308    9319 dynamic_cafile_content.go:166] Starting client-ca-bundle::/var/lib/rancher/k3s/server/tls/client-ca.crt
I0308 20:17:16.394308    9319 dynamic_cafile_content.go:166] Starting request-header::/var/lib/rancher/k3s/server/tls/request-header-ca.crt
I0308 20:17:16.395251    9319 dynamic_serving_content.go:129] Starting serving-cert::/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt::/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key
I0308 20:17:16.397910    9319 secure_serving.go:178] Serving securely on 127.0.0.1:6444
I0308 20:17:16.398017    9319 tlsconfig.go:219] Starting DynamicServingCertificateController
I0308 20:17:16.398379    9319 autoregister_controller.go:140] Starting autoregister controller
I0308 20:17:16.398459    9319 cache.go:32] Waiting for caches to sync for autoregister controller
I0308 20:17:16.398723    9319 available_controller.go:386] Starting AvailableConditionController
I0308 20:17:16.398794    9319 cache.go:32] Waiting for caches to sync for AvailableConditionController controller
I0308 20:17:16.399089    9319 crdregistration_controller.go:111] Starting crd-autoregister controller
I0308 20:17:16.399288    9319 shared_informer.go:197] Waiting for caches to sync for crd-autoregister
I0308 20:17:16.399546    9319 crd_finalizer.go:263] Starting CRDFinalizer
I0308 20:17:16.399790    9319 controller.go:85] Starting OpenAPI controller
I0308 20:17:16.400002    9319 customresource_discovery_controller.go:208] Starting DiscoveryController
I0308 20:17:16.400341    9319 naming_controller.go:288] Starting NamingConditionController
I0308 20:17:16.400638    9319 establishing_controller.go:73] Starting EstablishingController
I0308 20:17:16.400854    9319 nonstructuralschema_controller.go:191] Starting NonStructuralSchemaConditionController
I0308 20:17:16.401201    9319 apiapproval_controller.go:185] Starting KubernetesAPIApprovalPolicyConformantConditionController
I0308 20:17:16.402017    9319 cluster_authentication_trust_controller.go:440] Starting cluster_authentication_trust_controller controller
I0308 20:17:16.402094    9319 shared_informer.go:197] Waiting for caches to sync for cluster_authentication_trust_controller
I0308 20:17:16.403447    9319 apiservice_controller.go:94] Starting APIServiceRegistrationController
I0308 20:17:16.403537    9319 cache.go:32] Waiting for caches to sync for APIServiceRegistrationController controller
I0308 20:17:16.403681    9319 controller.go:81] Starting OpenAPI AggregationController
I0308 20:17:16.418176    9319 dynamic_cafile_content.go:166] Starting client-ca-bundle::/var/lib/rancher/k3s/server/tls/client-ca.crt
I0308 20:17:16.419045    9319 dynamic_cafile_content.go:166] Starting request-header::/var/lib/rancher/k3s/server/tls/request-header-ca.crt
I0308 20:17:16.606683    9319 shared_informer.go:204] Caches are synced for cluster_authentication_trust_controller
I0308 20:17:16.613199    9319 cache.go:39] Caches are synced for autoregister controller
I0308 20:17:16.614373    9319 cache.go:39] Caches are synced for AvailableConditionController controller
I0308 20:17:16.614504    9319 shared_informer.go:204] Caches are synced for crd-autoregister
I0308 20:17:16.616912    9319 cache.go:39] Caches are synced for APIServiceRegistrationController controller
E0308 20:17:16.633217    9319 controller.go:150] Unable to perform initial Kubernetes service initialization: Service "kubernetes" is invalid: spec.clusterIP: Invalid value: "10.43.0.1": cannot allocate resources of type serviceipallocations at this time
E0308 20:17:16.639707    9319 controller.go:155] Unable to remove old endpoints from kubernetes service: StorageError: key not found, Code: 1, Key: /registry/masterleases/192.168.0.212, ResourceVersion: 0, AdditionalErrorMsg:
I0308 20:17:17.394171    9319 controller.go:107] OpenAPI AggregationController: Processing item
I0308 20:17:17.394300    9319 controller.go:130] OpenAPI AggregationController: action for item : Nothing (removed from the queue).
I0308 20:17:17.394391    9319 controller.go:130] OpenAPI AggregationController: action for item k8s_internal_local_delegation_chain_0000000000: Nothing (removed from the queue).
I0308 20:17:17.431078    9319 storage_scheduling.go:133] created PriorityClass system-node-critical with value 2000001000
I0308 20:17:17.445315    9319 storage_scheduling.go:133] created PriorityClass system-cluster-critical with value 2000000000
I0308 20:17:17.445429    9319 storage_scheduling.go:142] all system priority classes are created successfully or already exist.
I0308 20:17:18.939225    9319 controller.go:606] quota admission added evaluator for: roles.rbac.authorization.k8s.io
I0308 20:17:19.103599    9319 controller.go:606] quota admission added evaluator for: rolebindings.rbac.authorization.k8s.io
W0308 20:17:19.434785    9319 lease.go:224] Resetting endpoints for master service "kubernetes" to [192.168.0.212]
I0308 20:17:19.438264    9319 controller.go:606] quota admission added evaluator for: endpoints
INFO[2020-03-08T20:17:19.626006745+08:00] Running kube-scheduler --bind-address=127.0.0.1 --kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig --leader-elect=false --port=10251 --secure-port=0
INFO[2020-03-08T20:17:19.629360634+08:00] Running kube-controller-manager --allocate-node-cidrs=true --bind-address=127.0.0.1 --cluster-cidr=10.42.0.0/16 --cluster-signing-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.crt --cluster-signing-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --leader-elect=false --port=10252 --root-ca-file=/var/lib/rancher/k3s/server/tls/server-ca.crt --secure-port=0 --service-account-private-key-file=/var/lib/rancher/k3s/server/tls/service.key --use-service-account-credentials=true
I0308 20:17:19.655674    9319 controllermanager.go:161] Version: v1.17.3+k3s1
I0308 20:17:19.657868    9319 deprecated_insecure_serving.go:53] Serving insecurely on [::]:10252
INFO[2020-03-08T20:17:19.658915754+08:00] Waiting for cloudcontroller rbac role to be created
INFO[2020-03-08T20:17:19.664219593+08:00] Creating CRD addons.k3s.cattle.io
INFO[2020-03-08T20:17:19.686759095+08:00] Creating CRD helmcharts.helm.cattle.io
W0308 20:17:19.691464    9319 authorization.go:47] Authorization is disabled
W0308 20:17:19.691548    9319 authentication.go:92] Authentication is disabled
I0308 20:17:19.691602    9319 deprecated_insecure_serving.go:51] Serving healthz insecurely on [::]:10251
INFO[2020-03-08T20:17:19.762954369+08:00] Waiting for CRD helmcharts.helm.cattle.io to become available
INFO[2020-03-08T20:17:20.280122513+08:00] Done waiting for CRD helmcharts.helm.cattle.io to become available
INFO[2020-03-08T20:17:20.320314726+08:00] Writing static file: /var/lib/rancher/k3s/server/static/charts/traefik-1.81.0.tgz
INFO[2020-03-08T20:17:20.321243908+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/coredns.yaml
INFO[2020-03-08T20:17:20.321700333+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/aggregated-metrics-reader.yaml
INFO[2020-03-08T20:17:20.322113756+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/metrics-apiservice.yaml
INFO[2020-03-08T20:17:20.322546305+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/metrics-server-deployment.yaml
INFO[2020-03-08T20:17:20.322947895+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/metrics-server-service.yaml
INFO[2020-03-08T20:17:20.323365277+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/resource-reader.yaml
INFO[2020-03-08T20:17:20.323768992+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/traefik.yaml
INFO[2020-03-08T20:17:20.324187832+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/ccm.yaml
INFO[2020-03-08T20:17:20.324764300+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/local-storage.yaml
INFO[2020-03-08T20:17:20.325164932+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/auth-delegator.yaml
INFO[2020-03-08T20:17:20.325563897+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/metrics-server/auth-reader.yaml
INFO[2020-03-08T20:17:20.325996113+08:00] Writing manifest: /var/lib/rancher/k3s/server/manifests/rolebindings.yaml
INFO[2020-03-08T20:17:20.527152139+08:00] Starting k3s.cattle.io/v1, Kind=Addon controller
INFO[2020-03-08T20:17:20.529057920+08:00] Node token is available at /var/lib/rancher/k3s/server/token
INFO[2020-03-08T20:17:20.529286008+08:00] To join node to cluster: k3s agent -s https://192.168.0.212:6443 -t ${NODE_TOKEN}
INFO[2020-03-08T20:17:20.527299933+08:00] Waiting for master node  startup: resource name may not be empty
INFO[2020-03-08T20:17:20.725057527+08:00] Waiting for cloudcontroller rbac role to be created
I0308 20:17:20.810135    9319 controller.go:606] quota admission added evaluator for: addons.k3s.cattle.io
INFO[2020-03-08T20:17:20.830872877+08:00] Starting helm.cattle.io/v1, Kind=HelmChart controller
INFO[2020-03-08T20:17:20.831652182+08:00] Starting batch/v1, Kind=Job controller
INFO[2020-03-08T20:17:20.832798326+08:00] Starting /v1, Kind=Service controller
INFO[2020-03-08T20:17:20.833998971+08:00] Starting /v1, Kind=Pod controller
INFO[2020-03-08T20:17:20.835217450+08:00] Starting /v1, Kind=Endpoints controller
INFO[2020-03-08T20:17:20.836690891+08:00] Starting /v1, Kind=Secret controller
INFO[2020-03-08T20:17:20.838569298+08:00] Starting /v1, Kind=Node controller
```

#### ÈõÜÁæ§Áä∂ÊÄÅ

```bash
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# ks cluster-info
Kubernetes master is running at https://127.0.0.1:6443
CoreDNS is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
Metrics-server is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/https:metrics-server:/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
```

```bash
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# ks get node
NAME      STATUS   ROLES    AGE     VERSION
openwrt   Ready    master   5m26s   v1.17.3+k3s1
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# ks get pod -n kube-system
NAME                                      READY   STATUS              RESTARTS   AGE
metrics-server-6d684c7b5-8gv8j            1/1     Running             0          5m20s
local-path-provisioner-58fb86bdfd-h8jkk   1/1     Running             0          5m20s
svclb-traefik-9kwxx                       0/2     ContainerCreating   0          3m29s
helm-install-traefik-nw9td                0/1     Completed           2          5m20s
coredns-d798c9dd-62sb9                    1/1     Running             0          5m20s
traefik-6787cddb4b-p6hs9                  1/1     Running             0          3m30s
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# ks describe node
Name:               openwrt
Roles:              master
Labels:             beta.kubernetes.io/arch=arm64
                    beta.kubernetes.io/instance-type=k3s
                    beta.kubernetes.io/os=linux
                    k3s.io/hostname=openwrt
                    k3s.io/internal-ip=192.168.0.212
                    kubernetes.io/arch=arm64
                    kubernetes.io/hostname=openwrt
                    kubernetes.io/os=linux
                    node-role.kubernetes.io/master=true
                    node.kubernetes.io/instance-type=k3s
Annotations:        flannel.alpha.coreos.com/backend-data: {"VtepMAC":"ca:8f:da:03:f3:e5"}
                    flannel.alpha.coreos.com/backend-type: vxlan
                    flannel.alpha.coreos.com/kube-subnet-manager: true
                    flannel.alpha.coreos.com/public-ip: 192.168.0.212
                    node.alpha.kubernetes.io/ttl: 0
                    volumes.kubernetes.io/controller-managed-attach-detach: true
CreationTimestamp:  Sun, 08 Mar 2020 20:17:23 +0800
Taints:             <none>
Unschedulable:      false
Lease:
  HolderIdentity:  openwrt
  AcquireTime:     <unset>
  RenewTime:       Sun, 08 Mar 2020 20:23:44 +0800
Conditions:
  Type                 Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message
  ----               ------  -----------------               ------------------              ------                     -------
  NetworkUnavailable   False   Sun, 08 Mar 2020 20:17:38 +0800   Sun, 08 Mar 2020 20:17:38 +0800   FlannelIsUp                  Flannel is running on this node
  MemoryPressure       False   Sun, 08 Mar 2020 20:19:54 +0800   Sun, 08 Mar 2020 20:17:23 +0800   KubeletHasSufficientMemory   kubelet has sufficient memory available
  DiskPressure         False   Sun, 08 Mar 2020 20:19:54 +0800   Sun, 08 Mar 2020 20:17:23 +0800   KubeletHasNoDiskPressure     kubelet has no disk pressure
  PIDPressure          False   Sun, 08 Mar 2020 20:19:54 +0800   Sun, 08 Mar 2020 20:17:23 +0800   KubeletHasSufficientPID      kubelet has sufficient PID available
  Ready                True    Sun, 08 Mar 2020 20:19:54 +0800   Sun, 08 Mar 2020 20:17:34 +0800   KubeletReady                 kubelet is posting ready status
Addresses:
  InternalIP:  192.168.0.212
  Hostname:    openwrt
Capacity:
  cpu:                4
  ephemeral-storage:  925844Ki
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  hugepages-32Mi:     0
  hugepages-64Ki:     0
  memory:             1851688Ki
  pods:               110
Allocatable:
  cpu:                4
  ephemeral-storage:  900661043
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  hugepages-32Mi:     0
  hugepages-64Ki:     0
  memory:             1851688Ki
  pods:               110
System Info:
  Machine ID:                 96581db4e82a9fb36b0553115e64de1a
  System UUID:
  Boot ID:                    87856a60-0482-4ca3-a144-2ec073e1d2c7
  Kernel Version:             5.4.23-amlogic-flippy-28+
  OS Image:                   OpenWrt SNAPSHOT
  Operating System:           linux
  Architecture:               arm64
  Container Runtime Version:  containerd://1.3.3-k3s1
  Kubelet Version:            v1.17.3+k3s1
  Kube-Proxy Version:         v1.17.3+k3s1
PodCIDR:                      10.42.0.0/24
PodCIDRs:                     10.42.0.0/24
ProviderID:                   k3s://openwrt
Non-terminated Pods:          (5 in total)
  Namespace                   Name                                       CPU Requests  CPU Limits  Memory Requests  Memory Limits  AGE
  ---------                 ----                                     ------------  ----------  ---------------  -------------  ---
  kube-system                 metrics-server-6d684c7b5-8gv8j             0 (0%)        0 (0%)      0 (0%)           0 (0%)         6m10s
  kube-system                 local-path-provisioner-58fb86bdfd-h8jkk    0 (0%)        0 (0%)      0 (0%)           0 (0%)         6m10s
  kube-system                 svclb-traefik-9kwxx                        0 (0%)        0 (0%)      0 (0%)           0 (0%)         4m19s
  kube-system                 coredns-d798c9dd-62sb9                     100m (2%)     0 (0%)      70Mi (3%)        170Mi (9%)     6m10s
  kube-system                 traefik-6787cddb4b-p6hs9                   0 (0%)        0 (0%)      0 (0%)           0 (0%)         4m20s
Allocated resources:
  (Total limits may be over 100 percent, i.e., overcommitted.)
  Resource           Requests   Limits
  --------         -------- ------
  cpu                100m (2%)  0 (0%)
  memory             70Mi (3%)  170Mi (9%)
  ephemeral-storage  0 (0%)     0 (0%)
Events:
  Type     Reason                   Age                    From                 Message
  ----   ------                 ----                 ----               -------
  Normal   Starting                 6m24s                  kubelet, openwrt     Starting kubelet.
  Warning  InvalidDiskCapacity      6m24s                  kubelet, openwrt     invalid capacity 0 on image filesystem
  Normal   NodeHasSufficientPID     6m23s (x2 over 6m24s)  kubelet, openwrt     Node openwrt status is now: NodeHasSufficientPID
  Normal   NodeHasSufficientMemory  6m23s (x2 over 6m24s)  kubelet, openwrt     Node openwrt status is now: NodeHasSufficientMemory
  Normal   NodeHasNoDiskPressure    6m23s (x2 over 6m24s)  kubelet, openwrt     Node openwrt status is now: NodeHasNoDiskPressure
  Normal   NodeAllocatableEnforced  6m23s                  kubelet, openwrt     Updated Node Allocatable limit across pods
  Normal   Starting                 6m23s                  kube-proxy, openwrt  Starting kube-proxy.
  Normal   NodeReady                6m13s                  kubelet, openwrt     Node openwrt status is now: NodeReady
```

## ÁªìÊùüÂï¶

ÂÖ≥‰∫é OpenWrt ÊúÄÈáçË¶ÅÁöÑ`ÈÄèÊòé‰ª£ÁêÜÊóÅË∑ØÁΩëÂÖ≥` ËøòÊ≤°ÊúâËÆ≤Âà∞ÔºåÁ®çÂêéÂÜçÊõ¥Êñ∞‰∏Ä‰∏ãÔºåÊØïÁ´üÊàë‰π∞‰∫ÜÊòØÁé©ÂÑø K3s ÁöÑüòÇ„ÄÇÊÄª‰πãËøô‰∏™ÂûÉÂúæËøòÊòØÂÄºÂæóÊç°ÁöÑÔºåÂáÜÂ§áÂÜçÊç°Âá†Âè∞ÔºüÈÉ®ÁΩ≤‰∏™ K3s ÈõÜÁæ§ÔºüÈ´òÂèØÁî®Ôºü‰∫îËäÇÁÇπÔºü‰ª® master ‰ø© nodeÔºüÔºàÈÄÉ

‰∏çËøáÊÑèÂ§ñÂèëÁé∞ËØ•ÁõíÂ≠êÁöÑ USB Âè£Á´üÁÑ∂ÊîØÊåÅ‰ΩøÁî® echo ÂëΩ‰ª§Êù•‰øÆÊîπ `/sys/bus/usb/devices/usb1/power/level` ÁöÑÂÄºÊù•ÊéßÂà∂ USB ÁöÑÁîµÊ∫êÁä∂ÊÄÅÔºåËøôÊ†∑‰ªéUSB Âè£ÂºïÂá∫Ê≠£Ë¥üÊûÅÊé•Âú®ÁªßÁîµÂô®‰∏äÔºåËøôÂ∞±ÊòØ‰∏Ä‰∏™ÈÄöËøáÁΩëÁªúÊéßÂà∂ÁöÑÂºÄÂÖ≥„ÄÇÊàëÂú® `R6300V2` Âíå `WNDR3700V4` ‰∏äÊ¢¶ÂØê‰ª•Ê±ÇÊ≤°ÊúâÁöÑÂäüËÉΩÂ±ÖÁÑ∂Âú®Ëøô‰∏™Á†¥ÁõíÂ≠ê‰∏äÊúâ„ÄÇÊÑèÂ§ñÊî∂Ëé∑ÔºÅ

```bash
‚ï≠‚îÄroot@OpenWrt ~
‚ï∞‚îÄ# tree /sys/bus/usb/devices/usb1/power/
/sys/bus/usb/devices/usb1/power/
‚îú‚îÄ‚îÄ active_duration
‚îú‚îÄ‚îÄ autosuspend
‚îú‚îÄ‚îÄ autosuspend_delay_ms
‚îú‚îÄ‚îÄ connected_duration
‚îú‚îÄ‚îÄ control
‚îú‚îÄ‚îÄ level
‚îú‚îÄ‚îÄ runtime_active_time
‚îú‚îÄ‚îÄ runtime_status
‚îú‚îÄ‚îÄ runtime_suspended_time
‚îú‚îÄ‚îÄ wakeup
‚îú‚îÄ‚îÄ wakeup_abort_count
‚îú‚îÄ‚îÄ wakeup_active
‚îú‚îÄ‚îÄ wakeup_active_count
‚îú‚îÄ‚îÄ wakeup_count
‚îú‚îÄ‚îÄ wakeup_expire_count
‚îú‚îÄ‚îÄ wakeup_last_time_ms
‚îú‚îÄ‚îÄ wakeup_max_time_ms
‚îî‚îÄ‚îÄ wakeup_total_time_ms
```

ÊúÄÂêéÁ•ùÂ§ßÂÆ∂ **Happy Hacking**
