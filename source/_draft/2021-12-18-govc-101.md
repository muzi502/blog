---
title: ESXi/vCenter è‡ªåŠ¨åŒ–ç®¡ç†å·¥å…· govc ä½¿ç”¨è®°å½•
date: 2021-12-12
updated:
slug:
categories:
tag:
copyright: true
comment: true
---

æœ€è¿‘ç”±äºå·¥ä½œåŸå› éœ€è¦åœ¨ ESXi ä¸»æœºä¸Šå®Œæˆä¸€äº›å‚æ•°é…ç½®ã€è™šæ‹Ÿäº¤æ¢æœº/ç½‘åˆ›å»ºã€è™šæ‹Ÿæœºåˆ›å»ºã€VIB å®‰è£…ã€PCI ç›´é€šã€è™šæ‹Ÿæœºåˆ›å»ºç­‰å·¥ä½œï¼Œäºæ˜¯æŠ½ç©ºæ•´ç†äº†ä¸€ä¸‹åœ¨ä½¿ç”¨ govc æ—¶è¸©çš„ä¸€äº›å‘ã€‚

## govc

[govc](https://github.com/vmware/govmomi/tree/master/govc) æ˜¯ VMware å®˜æ–¹ [govmomi](https://github.com/vmware/govmom) åº“çš„ä¸€ä¸ªå°è£…å®ç°ã€‚ä½¿ç”¨å®ƒå¯ä»¥å®Œæˆå¯¹ ESXi ä¸»æœºæˆ– vCenter çš„ä¸€äº›æ“ä½œã€‚æ¯”å¦‚åˆ›å»ºè™šæ‹Ÿæœºã€ç®¡ç†å¿«ç…§ç­‰ã€‚åŸºæœ¬ä¸Šèƒ½åœ¨ ESXi æˆ– vCenter ä¸Šçš„æ“ä½œï¼Œåœ¨ govmomi ä¸­éƒ½æœ‰å¯¹åº”çš„å®ç°ã€‚

ä½¿ç”¨ govc è¿æ¥ ESXi ä¸»æœºæˆ– vCenter å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡æˆ–è€…å‘½ä»¤è¡Œå‚æ•°ã€‚

```shell
Options:
  -cert=                           Certificate [GOVC_CERTIFICATE]
  -dc=                             Datacenter [GOVC_DATACENTER]
  -debug=false                     Store debug logs [GOVC_DEBUG]
  -dump=false                      Enable Go output
  -host=                           Host system [GOVC_HOST]
  -host.dns=                       Find host by FQDN
  -host.ip=                        Find host by IP address
  -host.ipath=                     Find host by inventory path
  -host.uuid=                      Find host by UUID
  -json=false                      Enable JSON output
  -k=false                         Skip verification of server certificate [GOVC_INSECURE]
  -key=                            Private key [GOVC_PRIVATE_KEY]
  -persist-session=true            Persist session to disk [GOVC_PERSIST_SESSION]
  -tls-ca-certs=                   TLS CA certificates file [GOVC_TLS_CA_CERTS]
  -tls-known-hosts=                TLS known hosts file [GOVC_TLS_KNOWN_HOSTS]
  -trace=false                     Write SOAP/REST traffic to stderr
  -u=https://root@esxi.yoi.li/sdk  ESX or vCenter URL [GOVC_URL]
  -verbose=false                   Write request/response data to stderr
  -vim-namespace=vim25             Vim namespace [GOVC_VIM_NAMESPACE]
  -vim-version=7.0                 Vim version [GOVC_VIM_VERSION]
  -xml=false                       Enable XML output
```

é€šè¿‡ `GOVC_URL` ç¯å¢ƒå˜é‡æŒ‡å®š ESXi ä¸»æœºæˆ– vCenter çš„ URLï¼Œç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç å¯è®¾ç½®åœ¨ GOVC_URL ä¸­æˆ–è€…å•ç‹¬è®¾ç½® `GOVC_USERNAME` å’Œ `GOVC_PASSWORD`ã€‚å¦‚æœ https è¯ä¹¦æ˜¯è‡ªç­¾çš„åŸŸåæˆ–è€… IP å¯ä»¥é€šè¿‡è®¾ç½® `GOVC_INSECURE=true` è¯ä¹¦çš„æ ¡éªŒã€‚

```shell
$ export GOVC_URL="https://root:password@esxi.k8s.li"
$ export GOVC_INSECURE=true
$ govc about
FullName:     VMware ESXi 7.0.2 build-17867351
Name:         VMware ESXi
Vendor:       VMware, Inc.
Version:      7.0.2
Build:        17867351
OS type:      vmnix-x86
API type:     HostAgent
API version:  7.0.2.0
Product ID:   embeddedEsx
UUID:
```
## è·å–ä¸»æœºä¿¡æ¯

- `govc host.info`

é€šè¿‡ host.info è‡ªå‘½å‘½ä»¤å¯ä»¥å¾—åˆ° ESXi ä¸»æœºçš„åŸºæœ¬ä¿¡æ¯ï¼Œ

- Path: å½“å‰ä¸»æœºåœ¨é›†ç¾¤ä¸­çš„èµ„æºè·¯å¾„
- Manufacturer: ç¡¬ä»¶è®¾å¤‡åˆ¶é€ å•†
- Logical CPUs: é€»è¾‘ CPU çš„æ•°é‡ï¼Œä»¥åŠ CPU çš„åŸºç¡€é¢‘ç‡
- Processor type: CPU çš„å…·ä½“å‹å·ï¼Œç”±äºæˆ‘çš„æ˜¯ ES ç‰ˆçš„ E-2126Gï¼Œæ‰€ä»¥æ— æ³•æ˜¾ç¤ºå‡ºå…·ä½“çš„å‹å·ğŸ¤£
- CPU usage:  CPU ä½¿ç”¨çš„è´Ÿè½½æƒ…å†µ
- Memory:  ä¸»æœºå®‰è£…çš„å†…å­˜å¤§å°
- Memory usage:  å†…å­˜ä½¿ç”¨çš„è´Ÿè½½æƒ…å†µ
- Boot time: å¼€æœºæ—¶é—´
- State:  è¿æ¥çŠ¶æ€

```bash
$ govc host.info
Name:              hp-esxi.lan
  Path:            /ha-datacenter/host/hp-esxi.lan/hp-esxi.lan
  Manufacturer:    HPE
  Logical CPUs:    6 CPUs @ 3000MHz
  Processor type:  Genuine Intel(R) CPU 0000 @ 3.00GHz
  CPU usage:       3444 MHz (19.1%)
  Memory:          32613MB
  Memory usage:    26745 MB (82.0%)
  Boot time:       2021-12-05 06:11:53.42802 +0000 UTC
  State:           connected
```

å¦‚æœåŠ ä¸Š -json å‚æ•°ä¼šå¾—åˆ°ä¸€ä¸ªè‡³å°‘ 3w è¡Œçš„ json è¾“å‡ºï¼Œé‡Œé¢åŒ…å«çš„ ESXi ä¸»æœºçš„æ‰€æœ‰ä¿¡æ¯

```bash
â•­â”€root@esxi-debian-devbox ~
â•°â”€# govc host.info -json=true > host_info.json
â•­â”€root@esxi-debian-devbox ~
â•°â”€# wc host_info.json
  34522   73430 1188718 host_info.json
â•­â”€root@esxi-debian-devbox ~
â•°â”€# govc host.info -json | jq '.HostSystems[0].Summary.Hardware'
{
  "Vendor": "HPE",
  "Model": "ProLiant MicroServer Gen10 Plus",
  "Uuid": "30363150",
  "OtherIdentifyingInfo": [
    {
      "IdentifierValue": "                                ",
      "IdentifierType": {
        "Label": "Asset Tag",
        "Summary": "Asset tag of the system",
        "Key": "AssetTag"
      }
    },
    {
      "IdentifierValue": "",
      "IdentifierType": {
        "Label": "Service tag",
        "Summary": "Service tag of the system",
        "Key": "ServiceTag"
      }
    },
    {
      "IdentifierValue": "",
      "IdentifierType": {
        "Label": "Enclosure serial number tag",
        "Summary": "Enclosure serial number tag of the system",
        "Key": "EnclosureSerialNumberTag"
      }
    },
    {
      "IdentifierValue": "",
      "IdentifierType": {
        "Label": "Serial number tag",
        "Summary": "Serial number tag of the system",
        "Key": "SerialNumberTag"
      }
    },
    {
      "IdentifierValue": "PSF:                                                           ",
      "IdentifierType": {
        "Label": "OEM specific string",
        "Summary": "OEM specific string",
        "Key": "OemSpecificString"
      }
    },
    {
      "IdentifierValue": "Product ID: ",
      "IdentifierType": {
        "Label": "OEM specific string",
        "Summary": "OEM specific string",
        "Key": "OemSpecificString"
      }
    },
    {
      "IdentifierValue": "OEM String: ",
      "IdentifierType": {
        "Label": "OEM specific string",
        "Summary": "OEM specific string",
        "Key": "OemSpecificString"
      }
    }
  ],
  "MemorySize": 34197471232,
  "CpuModel": "Genuine Intel(R) CPU 0000 @ 3.00GHz",
  "CpuMhz": 3000,
  "NumCpuPkgs": 1,
  "NumCpuCores": 6,
  "NumCpuThreads": 6,
  "NumNics": 4,
  "NumHBAs": 3
}
```

å¦‚æœåŠ ä¸Š -dump å‚æ•°ï¼Œåˆ™ä¼šä»¥ Golang ç»“æ„ä½“çš„æ ¼å¼æ¥è¾“å‡ºï¼Œè¾“å‡ºçš„å†…å®¹ä¹Ÿæ˜¯åŒ…å«äº† ESXi ä¸»æœºçš„æ‰€æœ‰ä¿¡æ¯ï¼Œç”¨å®ƒå¯ä»¥æ¯”è¾ƒæ–¹ä¾¿åœ°å®šä½æŸä¸ªä¿¡æ¯çš„ç»“æ„ä½“ï¼Œè¿™ä¸€ç‚¹å¯¹åŸºäº govmomi æ¥å¼€å‘å…¶ä»–çš„åŠŸèƒ½æ¥è¯´ååˆ†æ–¹ä¾¿ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å­—å‘½ä»¤éƒ½æ”¯æŒ json æ ¼å¼çš„è¾“å‡ºã€‚

```golang
mo.HostSystem{
    ManagedEntity: mo.ManagedEntity{
        ExtensibleManagedObject: mo.ExtensibleManagedObject{
            Self:           types.ManagedObjectReference{Type:"HostSystem", Value:"ha-host"},
            Value:          nil,
            AvailableField: nil,
        },
        Parent:        &types.ManagedObjectReference{Type:"ComputeResource", Value:"ha-compute-res"},
        CustomValue:   nil,
        OverallStatus: "green",
        ConfigStatus:  "yellow",
        ConfigIssue:   []types.BaseEvent{
            &types.RemoteTSMEnabledEvent{
                HostEvent: types.HostEvent{
                    Event: types.Event{
                        Key:             1,
                        ChainId:         0,
                        CreatedTime:     time.Now(),
                        UserName:        "",
                        Datacenter:      (*types.DatacenterEventArgument)(nil),
                        ComputeResource: (*types.ComputeResourceEventArgument)(nil),
                        Host:            &types.HostEventArgument{
                            EntityEventArgument: types.EntityEventArgument{
                                EventArgument: types.EventArgument{},
                                Name:          "hp-esxi.lan",
                            },
                            Host: types.ManagedObjectReference{Type:"HostSystem", Value:"ha-host"},
                        },
                        Vm:                   (*types.VmEventArgument)(nil),
                        Ds:                   (*types.DatastoreEventArgument)(nil),
                        Net:                  (*types.NetworkEventArgument)(nil),
                        Dvs:                  (*types.DvsEventArgument)(nil),
                        FullFormattedMessage: "SSH for the host hp-esxi.lan has been enabled",
                        ChangeTag:            "",
                    },
                },
            },
        },
```

## é…ç½® ESXi ä¸»æœºå‚æ•°

## å¼€å¯ ssh æœåŠ¡

```shell

```

## åˆ›å»ºè™šæ‹Ÿäº¤æ¢æœºå’Œç«¯å£ç»„

## åˆ›å»ºè™šæ‹Ÿæœº

## å¯¼å…¥ ova è™šæ‹Ÿæœº

ä¸»æµçš„ Linux å‘è¡Œç‰ˆæä¾› ova æ¨¡ç‰ˆçš„å¹¶ä¸å¤šï¼Œè™½ç„¶ ova ä½œä¸ºä¸€ç§å¼€å‘çš„è™šæ‹Ÿæœºæ¨¡ç‰ˆæ ‡å‡†ï¼Œä½†æ˜¯å¤§å®¶å¥½åƒéƒ½ä¸æ€ä¹ˆä½¿ç”¨ã€‚æ¯”å¦‚åŸºæœ¬ä¸Šéƒ½ä¼šæä¾› qcow2 æˆ–è€… raw æ ¼å¼çš„æ™¯è±¡ã€‚ä½† ESXi ä¸Šåªèƒ½ä½¿ç”¨ VMDK çš„é•œåƒï¼ŒäºŒè€…éœ€è¦ä¸€å®šçš„è½¬æ¢æ‰è¡Œã€‚

- [bionic-server-cloudimg-amd64.ova](https://cloud-images.ubuntu.com/bionic/current/bionic-server-cloudimg-amd64.ova)
- [focal-server-cloudimg-amd64.ova ](https://cloud-images.ubuntu.com/focal/current/focal-server-cloudimg-amd64.ova)

## æ‰§è¡Œ Guest ä¸»æœºå‘½ä»¤

## å…‹éš†è™šæ‹Ÿæœº

## è™šæ‹Ÿæœºå¿«ç…§
